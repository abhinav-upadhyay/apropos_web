<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
MIRRORING-PORTS(7)</title>
</head>
<body>
<div class="mandoc">
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">mirroring-ports</b> &#8212; <span class="desc">how to build a mirror for ports distfiles</span></div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="name">OpenBSD Ports Collection</b> offers some powerful tools to mirror software sources.<div class="spacer">
</div>
<a class="link-man" href="../html1/dpb.html">dpb(1)</a> features a <b class="flag">-F</b> option which is explicitly designed for mirroring distfiles.<div class="spacer">
</div>
If run with <b class="flag">-F</b> <i class="arg">jobs</i>, <b class="name">dpb</b> will<ul style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-bul">
<li class="list-bul" style="margin-top: 1.00em;">
Limit itself to fetching distfiles, and not build any packages.</li>
<li class="list-bul" style="margin-top: 1.00em;">
Disregard any architecture or broken annotation, and try to fetch every distfile.</li>
<li class="list-bul" style="margin-top: 1.00em;">
Fetch files to a temporary copy named <i class="file">some_file.part</i> using <b class="cmd">ftp -C</b> to resume interrupted downloads.</li>
<li class="list-bul" style="margin-top: 1.00em;">
Keep a global list of sha256 checksums as <i class="file">${DISTDIR}/distinfo</i>, and use that to refetch files when the ports tree records a changing checksum.</li>
<li class="list-bul" style="margin-top: 1.00em;">
Produces a log of old distfiles in <i class="file">${DISTDIR}/history</i>,</li>
<li class="list-bul" style="margin-top: 1.00em;">
Create sha256 links under <i class="file">${DISTDIR}/by_cipher/sha256</i> as per <a class="link-man" href="../html1/link-checksum.html">link-checksum(1)</a>'s former duties.</li>
</ul>
<div class="spacer">
</div>
For partial distfiles collections, <b class="name">dpb</b> can also be run with <b class="flag">-D</b><i class="arg">HISTORY_ONLY</i> to scan the full ports tree and update <i class="file">${DISTDIR}/history</i> without fetching anything.</div>
<div class="section">
<h1 id="x46494c4553">FILES</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="file">${DISTDIR}/distinfo</i></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
a cache of known distfiles with their respective checksums.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="file">${DISTDIR}/history</i></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
List of files appearing in <i class="file">${DISTDIR}/distinfo</i> that seem to no longer be required by the ports tree. <a class="link-man" href="../html1/dpb.html">dpb(1)</a> will append to this file each time it is run on the whole tree (option <b class="flag">-a</b>) and only if the ports tree scan finishes without error. Each line is of the form<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
timestamp SHA256 (file) = sha</pre>
<div class="spacer">
</div>
denoting the first fime a file/sha entry was no longer seen in the ports tree.</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html1/clean-old-distfiles.html">clean-old-distfiles(1)</a>, <a class="link-man" href="../html1/dpb.html">dpb(1)</a>, <a class="link-man" href="../html7/ports.html">ports(7)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The new integrated <b class="flag">-F</b> option to <a class="link-man" href="../html1/dpb.html">dpb(1)</a> was introduced in <span class="unix">OpenBSD&#160;5.1</span>, replacing the original infrastructure introduced in <span class="unix">OpenBSD&#160;2.7</span>.</div>
<div class="section">
<h1 id="x43415645415453">CAVEATS</h1> Changing checksums is a recurring problem that is outside the direct control of the <span class="unix">OpenBSD</span> Project. Some software distributors change distribution files without warning, without changing the file name proper. Once the problem has been identified, the port maintainer should usually contact the software author to fix the problem or, if the software author is unresponsive, the maintainer should use <span class="env">DIST_SUBDIR</span> to provide some state to guard against shifting checksums.<div class="spacer">
</div>
However, a more robust approach is also needed, so that ports users can depend on distfiles mirrors to carry what they need irrespective of those synchronization issues. The <i class="file">${DISTFILES}/by-cipher/sha256</i> directory provides more persistent access to the distfiles, indexed through the actual checksums that the files should match. Provided mirroring is run sufficiently often, two versions of the same distfile with respective checksums cksum1 and cksum2 will be available under the names <i class="file">${DISTFILES}/sha256/c1/cksum1/distfile</i> and <i class="file">${DISTFILES}/sha256/c2/cksum2/distfile</i>.<div class="spacer">
</div>
If <span class="env">REFETCH</span> is set to true, <a class="link-man" href="../html5/bsd.port.mk.html">bsd.port.mk(5)</a> will try to retrieve files under that naming scheme as a last resort.</div>
</div>
</body>
</html>

