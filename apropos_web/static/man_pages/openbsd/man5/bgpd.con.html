<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
BGPD.CONF(5)</title>
</head>
<body>
<div class="mandoc">
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">bgpd.conf</b> &#8212; <span class="desc">Border Gateway Protocol daemon configuration file</span></div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <a class="link-man" href="../html8/bgpd.html">bgpd(8)</a> daemon implements the Border Gateway Protocol version 4 as described in RFC 4271.</div>
<div class="section">
<h1 id="x53454354494f4e53">SECTIONS</h1> The <b class="name">bgpd.conf</b> config file is divided into five main sections.<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">Macros</span></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
User-defined variables may be defined and used later, simplifying the configuration file.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">Global Configuration</span></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
Global settings for <a class="link-man" href="../html8/bgpd.html">bgpd(8)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">Routing Domain Configuration</span></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
The definition and properties for BGP MPLS VPNs are set in this section.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">Neighbors and Groups</span></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
<a class="link-man" href="../html8/bgpd.html">bgpd(8)</a> establishes sessions with <span class="emph">neighbors</span>. The neighbor definition and properties are set in this section, as well as grouping neighbors for the ease of configuration.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">Filter</span></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
Filter rules for incoming and outgoing <span class="emph">UPDATES</span>.</dd>
</dl>
<div class="spacer">
</div>
With the exception of macros, the sections should be grouped and appear in <b class="name">bgpd.conf</b> in the order shown above.<div class="spacer">
</div>
The current line can be extended over multiple lines using a backslash (&#8216;\&#8217;). Comments can be put anywhere in the file using a hash mark (&#8216;#&#8217;), and extend to the end of the current line. Care should be taken when commenting out multi-line text: the comment is effective until the end of the entire block.<div class="spacer">
</div>
Argument names not beginning with a letter, digit, or underscore must be quoted.<div class="spacer">
</div>
Additional configuration files can be included with the <b class="cmd">include</b> keyword, for example:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
include &quot;/etc/bgpd/bgpd-10.0.0.1.filter&quot;</pre>
</div>
<div class="section">
<h1 id="x4d4143524f53">MACROS</h1> Macros can be defined that will later be expanded in context. Macro names must start with a letter, digit, or underscore, and may contain any of those characters. Macro names may not be reserved words (for example, <b class="cmd">AS</b>, <b class="cmd">neighbor</b>, or <b class="cmd">group</b>). Macros are not expanded inside quotes.<div class="spacer">
</div>
For example:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
peer1=&quot;1.2.3.4&quot; 
neighbor $peer1 { 
	remote-as 65001 
}</pre>
</div>
<div class="section">
<h1 id="x474c4f42414c20434f4e46494755524154494f4e">GLOBAL CONFIGURATION</h1> There are quite a few settings that affect the operation of the <a class="link-man" href="../html8/bgpd.html">bgpd(8)</a> daemon globally.<div class="spacer">
</div>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">AS</b> <i class="arg">as-number</i> [<span class="opt"><i class="arg">as-number</i></span>]</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Set the local <span class="emph">autonomous system</span> number to <i class="arg">as-number</i>. If the first AS number is a 4-byte AS it is possible to specify a secondary 2-byte AS number which is used for neighbors which do not support 4-byte AS numbers. The default for the secondary AS is 23456.<div class="spacer">
</div>
The AS numbers are assigned by local RIRs, such as:<div class="spacer">
</div>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
AfriNIC</dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
for Africa</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
APNIC</dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
for Asia Pacific</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
ARIN</dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
for North America and parts of the Caribbean</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
LACNIC</dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
for Latin America and the Caribbean</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
RIPE NCC</dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
for Europe, the Middle East, and parts of Asia</dd>
</dl>
<div class="spacer">
</div>
For example:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
AS 65001</pre>
<div class="spacer">
</div>
sets the local AS to 65001.<div class="spacer">
</div>
The AS numbers 64512 &#8211; 65534 are designated for private use. The AS number 23456 is a specially designated Autonomous System Number and should not be used. 4-byte AS numbers are specified as two numbers separated by a dot (ASDOT format), for example:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
AS 3.10</pre>
<div class="spacer">
</div>
or as a large number (ASPLAIN format), for example:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
AS 196618</pre>
<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">connect-retry</b> <i class="arg">seconds</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Set the number of seconds before retrying to open a connection. This timer should be sufficiently large in EBGP configurations. The default is 120 seconds.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">dump</b> [<span class="opt"><b class="cmd">rib</b> <i class="arg">name</i></span>] (<b class="cmd">table</b>|<b class="cmd">table-mp</b>|<b class="cmd">table-v2</b>) <i class="arg">file</i> [<span class="opt"><i class="arg">timeout</i></span>]</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">dump</b> (<b class="cmd">all</b>|<b class="cmd">updates</b>) (<b class="cmd">in</b>|<b class="cmd">out</b>) <i class="arg">file</i> [<span class="opt"><i class="arg">timeout</i></span>]</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Dump the RIB, a.k.a. the <span class="emph">routing information base</span>, and all BGP messages in Multi-threaded Routing Toolkit (MRT) format. It is possible to dump alternate RIB with the use of <i class="arg">name</i>.<div class="spacer">
</div>
For example, the following will dump the entire table to the <a class="link-man" href="../html3/strftime.html">strftime(3)</a>-expanded filename. Only the <b class="cmd">table-v2</b> format is able to dump a multi-protocol RIB correctly. Both <b class="cmd">table</b> and <b class="cmd">table-mp</b> formats are more or less limited when handling multi-protocol entries and are only left around to support 3rd party tools not handling the new format. The timeout is optional:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
dump table &quot;/tmp/rib-dump-%H%M&quot; 300</pre>
<div class="spacer">
</div>
Similar to the table dump, but this time all BGP messages and <span class="emph">state transitions</span> will be dumped to the specified file:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
dump all in &quot;/tmp/all-in-%H%M&quot; 300</pre>
<div class="spacer">
</div>
As before, but only the <span class="emph">UPDATE</span> messages will be dumped to the file:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
dump updates in &quot;/tmp/updates-in-%H%M&quot; 300</pre>
<div class="spacer">
</div>
It is also possible to dump outgoing messages:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
dump all out &quot;/tmp/all-out-%H%M&quot; 300 
# or 
dump updates out &quot;/tmp/updates-out-%H%M&quot; 300</pre>
<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">fib-priority</b> <i class="arg">prio</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Set the routing priority to <i class="arg">prio</i>. The default is 48.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">fib-update</b> (<b class="cmd">yes</b>|<b class="cmd">no</b>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
If set to <b class="cmd">no</b>, do not update the Forwarding Information Base, a.k.a. the kernel routing table. The default is <b class="cmd">yes</b>.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">holdtime</b> <i class="arg">seconds</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Set the holdtime in seconds. The holdtime is reset to its initial value every time either a <span class="emph">KEEPALIVE</span> or an <span class="emph">UPDATE</span> message is received from the neighbor. If the holdtime expires the session is dropped. The default is 90 seconds. Neighboring systems negotiate the holdtime used when the connection is established in the <span class="emph">OPEN</span> messages. Each neighbor announces its configured holdtime; the smaller one is then agreed upon.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">holdtime min</b> <i class="arg">seconds</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The minimal accepted holdtime in seconds. This value must be greater than or equal to 3.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">listen on</b> <i class="arg">address</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Specify the local IP address <a class="link-man" href="../html8/bgpd.html">bgpd(8)</a> should listen on.<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
listen on 127.0.0.1</pre>
<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">log updates</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Log received and sent updates.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">network</b> <i class="arg">address</i><code class="lit">/</code><i class="arg">prefix</i> [<span class="opt"><b class="cmd">set ...</b></span>]</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">network</b> (<b class="cmd">inet</b>|<b class="cmd">inet6</b>) <b class="cmd">static</b> [<span class="opt"><b class="cmd">set ...</b></span>]</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">network</b> (<b class="cmd">inet</b>|<b class="cmd">inet6</b>) <b class="cmd">connected</b> [<span class="opt"><b class="cmd">set ...</b></span>]</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Announce the specified network as belonging to our AS. If set to <b class="cmd">connected</b>, routes to directly attached networks will be announced. If set to <b class="cmd">static</b>, all static routes will be announced.<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
network 192.168.7.0/24</pre>
<div class="spacer">
</div>
It is possible to set default <span class="emph">AS path attributes</span> per <b class="cmd">network</b> statement:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
network 192.168.7.0/24 set localpref 220</pre>
<div class="spacer">
</div>
See also the <i class="link-sec"><a class="link-sec" href="#x41545452494255544520534554">ATTRIBUTE SET</a></i> section.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">nexthop</b> <b class="cmd">qualify</b> <b class="cmd">via</b> (<b class="cmd">bgp</b>|<b class="cmd">default</b>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
If set to <b class="cmd">bgp</b>, <a class="link-man" href="../html8/bgpd.html">bgpd(8)</a> may use BGP routes to verify nexthops. If set to <b class="cmd">default</b>, bgpd may use the default route to verify nexthops. By default bgpd will only use static routes or routes added by other routing daemons like <a class="link-man" href="../html8/ospfd.html">ospfd(8)</a>.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">rde</b> <b class="cmd">med</b> <b class="cmd">compare</b> (<b class="cmd">always</b>|<b class="cmd">strict</b>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
If set to <b class="cmd">always</b>, the <span class="emph">MULTI_EXIT_DISC</span> attributes will always be compared. The default is <b class="cmd">strict</b>, where the metric is only compared between peers belonging to the same AS.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">rde</b> <b class="cmd">rib</b> <i class="arg">name</i> [<span class="opt"><b class="cmd">no</b> <b class="cmd">evaluate</b></span>]</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">rde</b> <b class="cmd">rib</b> <i class="arg">name</i> [<span class="opt"><b class="cmd">rtable</b> <i class="arg">number</i></span>]</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Create an additional RIB named <i class="arg">name</i>. It is possible to disable the decision process per RIB with the <b class="cmd">no</b> <b class="cmd">evaluate</b> flag. If a <b class="cmd">rtable</b> is specified, routes will be exported to the given kernel routing table. Currently the routing table must belong to the default routing domain and nexthop verification happens on table 0. Routes in the specified table will not be considered for nexthop verification. <b class="cmd">Adj-RIB-In</b> and <b class="cmd">Loc-RIB</b> are created automatically and used as default.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">rde</b> <b class="cmd">route-age</b> (<b class="cmd">ignore</b>|<b class="cmd">evaluate</b>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
If set to <b class="cmd">evaluate</b>, the best path selection will not only be based on the path attributes but also on the age of the route, giving preference to the older, typically more stable, route. In this case the decision process is no longer deterministic. The default is <b class="cmd">ignore</b>.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">route-collector</b> (<b class="cmd">yes</b>|<b class="cmd">no</b>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
If set to <b class="cmd">yes</b>, the route selection process is turned off. The default is <b class="cmd">no</b>.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">router-id</b> <i class="arg">address</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Set the router ID to the given IP address, which must be local to the machine.<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
router-id 10.0.0.1</pre>
<div class="spacer">
</div>
If not given, the BGP ID is determined as the biggest IP address assigned to the local machine.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">rtable</b> <i class="arg">number</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Work with the given kernel routing table instead of the default table, <i class="arg">0</i>. Note that table 0 is used for nexthop verification. Routes in the specified table will not be considered for nexthop verification. This is the same as using the following syntax:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
rde rib Loc-RIB rtable number</pre>
<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">socket</b> &#8220;<i class="arg">path</i>&#8221; [<span class="opt"><b class="cmd">restricted</b></span>]</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Create a control socket at <i class="arg">path</i>. If <b class="cmd">restricted</b> is specified a restricted control socket will be created. By default <i class="file">/var/run/bgpd.sock</i> is used and no restricted socket is created.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">transparent-as</b> (<b class="cmd">yes</b>|<b class="cmd">no</b>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
If set to <b class="cmd">yes</b>, <span class="emph">AS paths</span> to EBGP neighbors are not prepended with the local AS. The default is <b class="cmd">no</b>.</dd>
</dl>
</div>
<div class="section">
<h1 id="x524f5554494e4720444f4d41494e20434f4e46494755524154494f4e">ROUTING DOMAIN CONFIGURATION</h1> <a class="link-man" href="../html8/bgpd.html">bgpd(8)</a> supports the setup and distribution of Virtual Private Networks. It is possible to import and export prefixes between routing domains. Each routing domain is specified by an <b class="cmd">rdomain</b> section, which allows properties to be set specifically for that rdomain:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
rdomain 1 { 
	descr &quot;a rdomain&quot; 
	rd 65002:1 
	import-target rt 65002:42 
	export-target rt 65002:42 
	network 192.168.1/24 
	depend on mpe0 
}</pre>
<div class="spacer">
</div>
There are several routing domain properties:<div class="spacer">
</div>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">depend on</b> <i class="arg">interface</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Routes added to the rdomain will use this interface as the outgoing interface. Normally this will be an MPLS Provider Edge, <a class="link-man" href="../html4/mpe.html">mpe(4)</a>, interface that is part of the rdomain. Local networks will be announced with the MPLS label specified on the interface.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">descr</b> <i class="arg">description</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Add a description. The description is used when logging but has no further meaning to <a class="link-man" href="../html8/bgpd.html">bgpd(8)</a>.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">export-target</b> <i class="arg">subtype</i> <i class="arg">as-number</i>:<i class="arg">local</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">export-target</b> <i class="arg">subtype</i> <i class="arg">IP</i>:<i class="arg">local</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Specify an extended community which will be attached to announced networks. More than one <b class="cmd">export-target</b> can be specified. See also the <i class="link-sec"><a class="link-sec" href="#x41545452494255544520534554">ATTRIBUTE SET</a></i> section for further information about the encoding. The <i class="arg">subtype</i> should be set to <i class="arg">rt</i> for best compatibility with other implementations.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">fib-update</b> (<b class="cmd">yes</b>|<b class="cmd">no</b>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
If set to <b class="cmd">no</b>, do not update the Forwarding Information Base, a.k.a. the kernel routing table. The default is <b class="cmd">yes</b>.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">import-target</b> <i class="arg">subtype</i> <i class="arg">as-number</i>:<i class="arg">local</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">import-target</b> <i class="arg">subtype</i> <i class="arg">IP</i>:<i class="arg">local</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Only prefixes matching one of the specified <b class="cmd">import-targets</b> will be imported into the rdomain. More than one <b class="cmd">import-target</b> can be specified. See also the <i class="link-sec"><a class="link-sec" href="#x41545452494255544520534554">ATTRIBUTE SET</a></i> section for further information about the encoding of extended communities. The <i class="arg">subtype</i> should be set to <i class="arg">rt</i> for best compatibility with other implementations.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">network</b> <i class="arg">arguments ...</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Define which networks should be exported into this VPN. See also the <b class="cmd">nexthop</b> section in <i class="link-sec"><a class="link-sec" href="#x474c4f42414c20434f4e46494755524154494f4e">GLOBAL CONFIGURATION</a></i> for further information about the arguments.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">rd</b> <i class="arg">as-number</i>:<i class="arg">local</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">rd</b> <i class="arg">IP</i>:<i class="arg">local</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The sole purpose of the Route Distinguisher <b class="cmd">rd</b> is to ensure that possible common prefixes are distinct between VPNs. The <b class="cmd">rd</b> is neither used to identify the origin of the prefix nor to control into which VPNs the prefix is distributed to. The <i class="arg">as-number</i> or <i class="arg">IP</i> of a <b class="cmd">rd</b> should be set to a number or IP that was assigned by an appropriate authority. Whereas <i class="arg">local</i> can be chosen by the local operator.</dd>
</dl>
</div>
<div class="section">
<h1 id="x4e45494748424f525320414e442047524f555053">NEIGHBORS AND GROUPS</h1> <a class="link-man" href="../html8/bgpd.html">bgpd(8)</a> establishes TCP connections to other BGP speakers called <span class="emph">neighbors</span>. Each neighbor is specified by a <b class="cmd">neighbor</b> section, which allows properties to be set specifically for that neighbor:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
neighbor 10.0.0.2 { 
	remote-as 65002 
	descr &quot;a neighbor&quot; 
}</pre>
<div class="spacer">
</div>
Multiple neighbors can be grouped together by a <b class="cmd">group</b> section. Each <b class="cmd">neighbor</b> section within the <b class="cmd">group</b> section inherits all properties from its group:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
group &quot;peering AS65002&quot; { 
	remote-as 65002 
	neighbor 10.0.0.2 { 
		descr &quot;AS65002-p1&quot; 
	} 
	neighbor 10.0.0.3 { 
		descr &quot;AS65002-p2&quot; 
	} 
}</pre>
<div class="spacer">
</div>
Instead of the neighbor's IP address, an address/netmask pair may be given:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
neighbor 10.0.0.0/8</pre>
<div class="spacer">
</div>
In this case, the neighbor specification becomes a <span class="emph">template</span>, and if a neighbor connects from an IP address within the given network, the template is <span class="emph">cloned</span>, inheriting everything from the template but the remote address, which is replaced by the connecting neighbor's address. With a template specification it is valid to omit <b class="cmd">remote-as</b>; <a class="link-man" href="../html8/bgpd.html">bgpd(8)</a> will then accept any AS the neighbor presents in the <span class="emph">OPEN</span> message.<div class="spacer">
</div>
There are several neighbor properties:<div class="spacer">
</div>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">announce</b> (<b class="cmd">all</b>|<b class="cmd">none</b>|<b class="cmd">self</b>|<b class="cmd">default-route</b>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
If set to <b class="cmd">none</b>, no <span class="emph">UPDATE</span> messages will be sent to the neighbor. If set to <b class="cmd">default-route</b>, only the default route will be announced to the neighbor. If set to <b class="cmd">all</b>, all generated <span class="emph">UPDATE</span> messages will be sent to the neighbor. This is usually used for <span class="emph">transit AS's</span> and <span class="emph">IBGP</span> peers. The default value for <span class="emph">EBGP</span> peers is <b class="cmd">self</b>, which limits the sent <span class="emph">UPDATE</span> messages to announcements of the local AS. The default for IBGP peers is <b class="cmd">all</b>.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">announce</b> (<b class="cmd">IPv4</b>|<b class="cmd">IPv6</b>) (<b class="cmd">none</b>|<b class="cmd">unicast</b>|<b class="cmd">vpn</b>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
For the given address family, control which subsequent address families (at the moment, only <span class="emph">none</span>, which disables the announcement of that address family, <span class="emph">unicast</span>, and <span class="emph">vpn</span>, which allows the distribution of BGP MPLS VPNs, are supported) are announced during the capabilities negotiation. Only routes for that address family and subsequent address family will be announced and processed.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">announce as-4byte</b> (<b class="cmd">yes</b>|<b class="cmd">no</b>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
If set to <b class="cmd">no</b>, the 4-byte AS capability is not announced and so native 4-byte AS support is disabled. The default is <b class="cmd">yes</b>.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">announce capabilities</b> (<b class="cmd">yes</b>|<b class="cmd">no</b>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
If set to <b class="cmd">no</b>, capability negotiation is disabled during the establishment of the session. This can be helpful to connect to old or broken BGP implementations. The default is <b class="cmd">yes</b>.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">announce refresh</b> (<b class="cmd">yes</b>|<b class="cmd">no</b>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
If set to <b class="cmd">no</b>, the route refresh capability is not announced. The default is <b class="cmd">yes</b>.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">announce restart</b> (<b class="cmd">yes</b>|<b class="cmd">no</b>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
If set to <b class="cmd">no</b>, the graceful restart capability is not announced. Currently only the End-of-RIB marker is supported and announced by the <b class="cmd">restart</b> capability. The default is <b class="cmd">yes</b>.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">demote</b> <i class="arg">group</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Increase the <a class="link-man" href="../html4/carp.html">carp(4)</a> demotion counter on the given interface group, usually <i class="arg">carp</i>, when the session is not in state <span class="emph">ESTABLISHED</span>. The demotion counter will be increased as soon as <a class="link-man" href="../html8/bgpd.html">bgpd(8)</a> starts and decreased 60 seconds after the session went to state <span class="emph">ESTABLISHED</span>. For neighbors added at runtime, the demotion counter is only increased after the session has been <span class="emph">ESTABLISHED</span> at least once before dropping.<div class="spacer">
</div>
For more information on interface groups, see the <b class="cmd">group</b> keyword in <a class="link-man" href="../html8/ifconfig.html">ifconfig(8)</a>.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">depend on</b> <i class="arg">interface</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The neighbor session will be kept in state <span class="emph">IDLE</span> as long as <i class="arg">interface</i> reports no link. For <a class="link-man" href="../html4/carp.html">carp(4)</a> interfaces, no link means that the interface is currently <span class="emph">backup</span>. This is primarily intended to be used with <a class="link-man" href="../html4/carp.html">carp(4)</a> to reduce failover times.<div class="spacer">
</div>
The state of the network interfaces on the system can be viewed using the <b class="flag">show interfaces</b> command to <a class="link-man" href="../html8/bgpctl.html">bgpctl(8)</a>.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">descr</b> <i class="arg">description</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Add a description. The description is used when logging neighbor events, in status reports, for specifying neighbors, etc., but has no further meaning to <a class="link-man" href="../html8/bgpd.html">bgpd(8)</a>.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">down</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Do not start the session when bgpd comes up but stay in <span class="emph">IDLE</span>.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">dump</b> (<b class="cmd">all</b>|<b class="cmd">updates</b>) (<b class="cmd">in</b>|<b class="cmd">out</b>) <i class="arg">file</i> [<span class="opt"><i class="arg">timeout</i></span>]</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Do a peer specific MRT dump. Peer specific dumps are limited to <b class="cmd">all</b> and <b class="cmd">updates</b>. See also the <b class="cmd">dump</b> section in <i class="link-sec"><a class="link-sec" href="#x474c4f42414c20434f4e46494755524154494f4e">GLOBAL CONFIGURATION</a></i>.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">enforce neighbor-as</b> (<b class="cmd">yes</b>|<b class="cmd">no</b>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
If set to <b class="cmd">yes</b>, <span class="emph">AS paths</span> whose <span class="emph">leftmost AS</span> is not equal to the <span class="emph">remote AS</span> of the neighbor are rejected and a <span class="emph">NOTIFICATION</span> is sent back. The default value for IBGP peers is <b class="cmd">no</b> otherwise the default is <b class="cmd">yes</b>.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">holdtime</b> <i class="arg">seconds</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Set the holdtime in seconds. Inherited from the global configuration if not given.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">holdtime min</b> <i class="arg">seconds</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Set the minimal acceptable holdtime. Inherited from the global configuration if not given.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">ipsec</b> (<b class="cmd">ah</b>|<b class="cmd">esp</b>) (<b class="cmd">in</b>|<b class="cmd">out</b>) <b class="cmd">spi</b> <i class="arg">spi-number authspec</i> [<span class="opt"><i class="arg">encspec</i></span>]</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Enable IPsec with static keying. There must be at least two <b class="cmd">ipsec</b> statements per peer with manual keying, one per direction. <i class="arg">authspec</i> specifies the authentication algorithm and key. It can be<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
sha1 &lt;key&gt; 
md5 &lt;key&gt;</pre>
<div class="spacer">
</div>
<i class="arg">encspec</i> specifies the encryption algorithm and key. <b class="cmd">ah</b> does not support encryption. With <b class="cmd">esp</b>, encryption is optional. <i class="arg">encspec</i> can be<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
3des &lt;key&gt; 
3des-cbc &lt;key&gt; 
aes &lt;key&gt; 
aes-128-cbc &lt;key&gt;</pre>
<div class="spacer">
</div>
Keys must be given in hexadecimal format.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">ipsec</b> (<b class="cmd">ah</b>|<b class="cmd">esp</b>) <b class="cmd">ike</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Enable IPsec with dynamic keying. In this mode, <a class="link-man" href="../html8/bgpd.html">bgpd(8)</a> sets up the flows, and a key management daemon such as <a class="link-man" href="../html8/isakmpd.html">isakmpd(8)</a> is responsible for managing the session keys. With <a class="link-man" href="../html8/isakmpd.html">isakmpd(8)</a>, it is sufficient to copy the peer's public key, found in <i class="file">/etc/isakmpd/local.pub</i>, to the local machine. It must be stored in a file named after the peer's IP address and must be stored in <i class="file">/etc/isakmpd/pubkeys/ipv4/</i>. The local public key must be copied to the peer in the same way. As <a class="link-man" href="../html8/bgpd.html">bgpd(8)</a> manages the flows on its own, it is sufficient to restrict <a class="link-man" href="../html8/isakmpd.html">isakmpd(8)</a> to only take care of keying by specifying the flags <b class="flag">-Ka</b>. This can be done in <a class="link-man" href="../html8/rc.conf.local.html">rc.conf.local(8)</a>. After starting the <a class="link-man" href="../html8/isakmpd.html">isakmpd(8)</a> and <a class="link-man" href="../html8/bgpd.html">bgpd(8)</a> daemons on both sides, the session should be established.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">local-address</b> <i class="arg">address</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
When <a class="link-man" href="../html8/bgpd.html">bgpd(8)</a> initiates the TCP connection to the neighbor system, it normally does not bind to a specific IP address. If a <b class="cmd">local-address</b> is given, <a class="link-man" href="../html8/bgpd.html">bgpd(8)</a> binds to this address first.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">log no</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Disable neighbor specific logging.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">log updates</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Log received and sent updates for this neighbor.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">max-prefix</b> <i class="arg">number</i> [<span class="opt"><b class="cmd">restart</b> <i class="arg">number</i></span>]</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Terminate the session after <i class="arg">number</i> prefixes have been received (no such limit is imposed by default). If <b class="cmd">restart</b> is specified, the session will be restarted after <i class="arg">number</i> minutes.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">multihop</b> <i class="arg">hops</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Neighbors not in the same AS as the local <a class="link-man" href="../html8/bgpd.html">bgpd(8)</a> normally have to be directly connected to the local machine. If this is not the case, the <b class="cmd">multihop</b> statement defines the maximum hops the neighbor may be away.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">passive</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Do not attempt to actively open a TCP connection to the neighbor system.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">remote-as</b> <i class="arg">as-number</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Set the AS number of the remote system.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">rib</b> <i class="arg">name</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Bind the neighbor to the specified RIB.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">route-reflector</b> [<span class="opt"><i class="arg">address</i></span>]</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Act as an RFC 4456 <span class="emph">route-reflector</span> for this neighbor. An optional cluster ID can be specified; otherwise the BGP ID will be used.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">set</b> <i class="arg">attribute ...</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Set the <span class="emph">AS path attributes</span> to some default per <b class="cmd">neighbor</b> or <b class="cmd">group</b> block:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
set localpref 300</pre>
<div class="spacer">
</div>
See also the <i class="link-sec"><a class="link-sec" href="#x41545452494255544520534554">ATTRIBUTE SET</a></i> section. Set parameters are applied to the received prefixes; the only exceptions are <b class="cmd">prepend-self</b>, <b class="cmd">nexthop no-modify</b> and <b class="cmd">nexthop self</b>. These sets are rewritten into filter rules and can be viewed with &#8220;bgpd -nv&#8221;.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">softreconfig</b> (<b class="cmd">in</b>|<b class="cmd">out</b>) (<b class="cmd">yes</b>|<b class="cmd">no</b>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Turn soft reconfiguration on or off for the specified direction. If soft reconfiguration is turned on, filter changes will be applied on configuration reloads. If turned off, a BGP session needs to be cleared to apply the filter changes. Enabling <b class="cmd">softreconfig in</b> will raise the memory requirements of <a class="link-man" href="../html8/bgpd.html">bgpd(8)</a> because the unmodified <span class="emph">AS path attributes</span> need to be stored as well. The default is <b class="cmd">yes</b>.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">tcp md5sig password</b> <i class="arg">secret</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">tcp md5sig key</b> <i class="arg">secret</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Enable TCP MD5 signatures per RFC 2385. The shared secret can either be given as a password or hexadecimal key.<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
tcp md5sig password mekmitasdigoat 
tcp md5sig key deadbeef</pre>
<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">transparent-as</b> (<b class="cmd">yes</b>|<b class="cmd">no</b>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
If set to <b class="cmd">yes</b>, <span class="emph">AS paths</span> to EBGP neighbors are not prepended with the local AS. The default is inherited from the global <b class="cmd">transparent-as</b> setting.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">ttl-security</b> (<b class="cmd">yes</b>|<b class="cmd">no</b>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Enable or disable ttl-security. When enabled, outgoing packets are sent using a TTL of 255 and a check is made against an incoming packet's TTL. For directly connected peers, incoming packets are required to have a TTL of 255, ensuring they have not been routed. For multihop peers, incoming packets are required to have a TTL of 256 minus multihop distance, ensuring they have not passed through more than the expected number of hops. The default is <b class="cmd">no</b>.<div class="spacer">
</div>
There is currently only partial support for ttl-security with IPv6: the TTL of outgoing packets is set, but no check is made for the TTL of incoming packets.</dd>
</dl>
</div>
<div class="section">
<h1 id="x46494c544552">FILTER</h1> <a class="link-man" href="../html8/bgpd.html">bgpd(8)</a> has the ability to <b class="cmd">allow</b> and <b class="cmd">deny</b> <span class="emph">UPDATES</span> based on <span class="emph">prefix</span> or <span class="emph">AS path attributes</span>. In addition, <span class="emph">UPDATES</span> may also be modified by filter rules.<div class="spacer">
</div>
For each <span class="emph">UPDATE</span> processed by the filter, the filter rules are evaluated in sequential order, from first to last. The last matching <b class="cmd">allow</b> or <b class="cmd">deny</b> rule decides what action is taken.<div class="spacer">
</div>
The following actions can be used in the filter:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">allow</b></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
The <span class="emph">UPDATE</span> is passed.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">deny</b></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
The <span class="emph">UPDATE</span> is blocked.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">match</b></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
Apply the filter attribute set without influencing the filter decision.</dd>
</dl>
</div>
<div class="section">
<h1 id="x504152414d4554455253">PARAMETERS</h1> The rule parameters specify the <span class="emph">UPDATES</span> to which a rule applies. An <span class="emph">UPDATE</span> always comes from, or goes to, one neighbor. Most parameters are optional, but each can appear at most once per rule. If a parameter is specified, the rule only applies to packets with matching attributes.<div class="spacer">
</div>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="arg">as-type as-number</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This rule applies only to <span class="emph">UPDATES</span> where the <span class="emph">AS path</span> matches. The <i class="arg">as-number</i> is matched against a part of the <span class="emph">AS path</span> specified by the <i class="arg">as-type</i>. <i class="arg">as-number</i> may be set to <b class="cmd">neighbor-as</b>, which is expanded to the current neighbor remote AS number. <i class="arg">as-type</i> is one of the following operators:<div class="spacer">
</div>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">AS</b></dt>
<dd class="list-tag" style="margin-left: 11.00ex;">
(any part)</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">peer-as</b></dt>
<dd class="list-tag" style="margin-left: 11.00ex;">
(leftmost AS number)</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">source-as</b></dt>
<dd class="list-tag" style="margin-left: 11.00ex;">
(rightmost AS number)</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">transit-as</b></dt>
<dd class="list-tag" style="margin-left: 11.00ex;">
(all but the rightmost AS number)</dd>
</dl>
<div class="spacer">
</div>
Multiple <i class="arg">as-number</i> entries for a given type or <i class="arg">as-type as-number</i> entries may also be specified, separated by commas or whitespace, if enclosed in curly brackets:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
deny from any AS { 1, 2, 3 } 
deny from any { AS 1, source-as 2, transit-as 3 } 
deny from any { AS { 1, 2, 3 }, source-as 4, transit-as 5 }</pre>
<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">community</b> <i class="arg">as-number</i><code class="lit">:</code><i class="arg">local</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">community</b> <i class="arg">name</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This rule applies only to <span class="emph">UPDATES</span> where the <b class="cmd">community</b> path attribute is present and matches. Communities are specified as <i class="arg">as-number</i>:<i class="arg">local</i>, where <i class="arg">as-number</i> is an AS number and <i class="arg">local</i> is a locally significant number between zero and <code class="lit">65535</code>. Both <i class="arg">as-number</i> and <i class="arg">local</i> may be set to &#8216;*&#8217; to do wildcard matching. Alternatively, well-known communities may be given by name instead and include <b class="cmd">BLACKHOLE</b>, <b class="cmd">NO_EXPORT</b>, <b class="cmd">NO_ADVERTISE</b>, <b class="cmd">NO_EXPORT_SUBCONFED</b>, and <b class="cmd">NO_PEER</b>. Both <i class="arg">as-number</i> and <i class="arg">local</i> may be set to <b class="cmd">neighbor-as</b>, which is expanded to the current neighbor remote AS number.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">ext-community</b> <i class="arg">subtype</i> <i class="arg">as-number</i>:<i class="arg">local</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">ext-community</b> <i class="arg">subtype</i> <i class="arg">IP</i>:<i class="arg">local</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">ext-community</b> <i class="arg">subtype</i> <i class="arg">numvalue</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This rule applies only to <span class="emph">UPDATES</span> where the <span class="emph">extended community</span> path attribute is present and matches. Extended Communities are specified by a <i class="arg">subtype</i> and normally two values, a globally unique part (e.g. the AS number) and a local part. See also the <i class="link-sec"><a class="link-sec" href="#x41545452494255544520534554">ATTRIBUTE SET</a></i> section for further information about the encoding.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
(<b class="cmd">from</b>|<b class="cmd">to</b>) <i class="arg">peer</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This rule applies only to <span class="emph">UPDATES</span> coming from, or going to, this particular neighbor. This parameter must be specified. <i class="arg">peer</i> is one of the following:<div class="spacer">
</div>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">any</b></dt>
<dd class="list-tag" style="margin-left: 11.00ex;">
Any neighbor will be matched.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="arg">address</i></dt>
<dd class="list-tag" style="margin-left: 11.00ex;">
Neighbors with this address will be matched.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">group</b> <i class="arg">descr</i></dt>
<dd class="list-tag" style="margin-left: 11.00ex;">
Neighbors in this group will be matched.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">AS</b> <i class="arg">as-number</i></dt>
<dd class="list-tag" style="margin-left: 11.00ex;">
Neighbors with this AS will be matched.</dd>
</dl>
<div class="spacer">
</div>
Multiple <i class="arg">peer</i> entries may also be specified, separated by commas or whitespace, if enclosed in curly brackets:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
deny from { 128.251.16.1, 251.128.16.2, group hojo }</pre>
<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
(<b class="cmd">inet</b>|<b class="cmd">inet6</b>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Match only routes in the IPv4 or IPv6 address families, respectively. <b class="cmd">inet</b> is an alias for &#8220;prefix 0.0.0.0/0 prefixlen &gt;= 0&#8221;; <b class="cmd">inet6</b> is an alias for &#8220;prefix ::/0 prefixlen &gt;= 0&#8221;.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">max-as-len</b> <i class="arg">len</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This rule applies only to <span class="emph">UPDATES</span> where the <span class="emph">AS path</span> has more than <i class="arg">len</i> elements.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">max-as-seq</b> <i class="arg">len</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This rule applies only to <span class="emph">UPDATES</span> where a single <span class="emph">AS number</span> is repeated more than <i class="arg">len</i> times.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">nexthop</b> <i class="arg">address</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This rule applies only to <span class="emph">UPDATES</span> where the nexthop is equal to <i class="arg">address</i>. The <i class="arg">address</i> can be set to <span class="emph">neighbor</span> in which case the nexthop is compared against the address of the neighbor. Nexthop filtering is not supported on locally announced networks and one must take into consideration previous rules overwriting nexthops.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">prefix</b> <i class="arg">address</i><code class="lit">/</code><i class="arg">len</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">prefix</b> <i class="arg">address</i><code class="lit">/</code><i class="arg">len</i> <b class="cmd">prefixlen</b> <i class="arg">range</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">prefix</b> <i class="arg">address</i><code class="lit">/</code><i class="arg">len</i> <b class="cmd">or-longer</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This rule applies only to <span class="emph">UPDATES</span> for the specified prefix.<div class="spacer">
</div>
Multiple entries may be specified, separated by commas or whitespace, if enclosed in curly brackets:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
deny from any prefix { 192.168.0.0/16, 10.0.0.0/8 or-longer }</pre>
<div class="spacer">
</div>
Multiple lists can also be specified, which is useful for macro expansion:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
good=&quot;{ 192.168.0.0/16, 172.16.0.0/12, 10.0.0.0/8 }&quot; 
bad=&quot;{ 224.0.0.0/4 prefixlen &gt;= 4, 240.0.0.0/4 prefixlen &gt;= 4 }&quot; 
ugly=&quot;{ 127.0.0.1/8, 169.254.0.0/16 }&quot; 
 
deny from any prefix { $good $bad $ugly }</pre>
<div class="spacer">
</div>
Prefix length ranges are specified by using these operators:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
=	(equal) 
!=	(unequal) 
&lt;	(less than) 
&lt;=	(less than or equal) 
&gt;	(greater than) 
&gt;=	(greater than or equal) 
-	(range including boundaries) 
&gt;&lt;	(except range)</pre>
<div class="spacer">
</div>
&gt;&lt; and - are binary operators (they take two arguments). For instance, to match all prefix lengths &gt;= 8 and &lt;= 12, and hence the CIDR netmasks 8, 9, 10, 11 and 12:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
prefixlen 8-12</pre>
<div class="spacer">
</div>
Or, to match all prefix lengths &lt; 8 or &gt; 12, and hence the CIDR netmasks 0&#8211;7 and 13&#8211;32:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
prefixlen 8&gt;&lt;12</pre>
<div class="spacer">
</div>
This will match all prefixes in the 10.0.0.0/8 netblock with netmasks longer than 16:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
prefix 10.0.0.0/8 prefixlen &gt; 16</pre>
<div class="spacer">
</div>
<b class="cmd">or-longer</b> is a shorthand for:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
<b class="cmd">prefix</b> <i class="arg">address</i><code class="lit">/</code><i class="arg">len</i> <b class="cmd">prexiflen</b> <b class="cmd">&gt;=</b> <i class="arg">len</i></pre>
<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">quick</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
If an <span class="emph">UPDATE</span> matches a rule which has the <b class="cmd">quick</b> option set, this rule is considered the last matching rule, and evaluation of subsequent rules is skipped.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">rib</b> <i class="arg">name</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Apply rule only to the specified RIB. This only applies for received updates, so not for rules using the <i class="arg">to peer</i> parameter.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">set</b> <i class="arg">attribute ...</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
All matching rules can set the <span class="emph">AS path attributes</span> to some default. The set of every matching rule is applied, not only the last matching one. See also the following section.</dd>
</dl>
</div>
<div class="section">
<h1 id="x41545452494255544520534554">ATTRIBUTE SET</h1> <span class="emph">AS path attributes</span> can be modified with <b class="cmd">set</b>.<div class="spacer">
</div>
<b class="cmd">set</b> can be used on <b class="cmd">network</b> statements, in <b class="cmd">neighbor</b> or <b class="cmd">group</b> blocks, and on filter rules. Attribute sets can be expressed as lists.<div class="spacer">
</div>
The following attributes can be modified:<div class="spacer">
</div>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">community</b> [<span class="opt"><i class="arg">delete</i></span>] <i class="arg">as-number</i>:<i class="arg">local</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">community</b> [<span class="opt"><i class="arg">delete</i></span>] <i class="arg">name</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Set or delete the <span class="emph">COMMUNITIES</span> AS path attribute. Communities are specified as <i class="arg">as-number</i>:<i class="arg">local</i>, where <i class="arg">as-number</i> is an AS number and <i class="arg">local</i> is a locally-significant number between zero and <code class="lit">65535</code>. Alternately, well-known communities may be specified by name: <b class="cmd">NO_EXPORT</b>, <b class="cmd">NO_ADVERTISE</b>, <b class="cmd">NO_EXPORT_SUBCONFED</b>, or <b class="cmd">NO_PEER</b>. For <b class="flag">delete</b>, both <i class="arg">as-number</i> and <i class="arg">local</i> may be set to &#8216;*&#8217; to do wildcard matching.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">ext-community</b> [<span class="opt"><i class="arg">delete</i></span>] <i class="arg">subtype</i> <i class="arg">as-number</i>:<i class="arg">local</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">ext-community</b> [<span class="opt"><i class="arg">delete</i></span>] <i class="arg">subtype</i> <i class="arg">IP</i>:<i class="arg">local</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">ext-community</b> [<span class="opt"><i class="arg">delete</i></span>] <i class="arg">subtype</i> <i class="arg">numvalue</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Set or delete the <span class="emph">Extended Community</span> AS path attribute. Extended Communities are specified by a <i class="arg">subtype</i> and normally two values, a globally unique part (e.g. the AS number) and a local part. The type is selected depending on the encoding of the global part. Two-octet AS Specific Extended Communities and Four-octet AS Specific Extended Communities are encoded as <i class="arg">as-number</i>:<i class="arg">local</i>. Four-octet encoding is used if the <i class="arg">as-number</i> is bigger then 65535 or if the AS_DOT encoding is used. IPv4 Address Specific Extended Communities are encoded as <i class="arg">IP</i>:<i class="arg">local</i>. Opaque Extended Communities are encoded with a single numeric value. Currently the following subtypes are supported:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
rt       Route Target 
soo      Source of Origin 
odi      OSPF Domain Identifier 
ort      OSPF Route Type 
ori      OSPF Router ID 
bdc      BGP Data Collection</pre>
<div class="spacer">
</div>
Not all type and subtype value pairs are allowed by IANA and the parser will ensure that no invalid combination is created.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">localpref</b> <i class="arg">number</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Set the <span class="emph">LOCAL_PREF</span> AS path attribute. If <i class="arg">number</i> starts with a plus or minus sign, <span class="emph">LOCAL_PREF</span> will be adjusted by adding or subtracting <i class="arg">number</i>; otherwise it will be set to <i class="arg">number</i>. The default is 100.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">med</b> <i class="arg">number</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">metric</b> <i class="arg">number</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Set the <span class="emph">MULTI_EXIT_DISC</span> AS path attribute. If <i class="arg">number</i> starts with a plus or minus sign, <span class="emph">MULTI_EXIT_DISC</span> will be adjusted by adding or subtracting <i class="arg">number</i>; otherwise it will be set to <i class="arg">number</i>.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">origin</b> (<b class="cmd">igp</b>|<b class="cmd">egp</b>|<b class="cmd">incomplete</b>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Set the <span class="emph">ORIGIN</span> AS path attribute to mark the source of this route as being injected from an igp protocol, an egp protocol or being an aggregated route.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">nexthop</b> (<i class="arg">address</i>|<b class="cmd">blackhole</b>|<b class="cmd">reject</b>|<b class="cmd">self</b>|<b class="cmd">no-modify</b>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Set the <span class="emph">NEXTHOP</span> AS path attribute to a different nexthop address or use blackhole or reject routes. If set to <span class="emph">no-modify</span>, the nexthop attribute is not modified. Unless set to <span class="emph">self</span>, the nexthop is left unmodified for IBGP sessions. <span class="emph">self</span> forces the nexthop to be set to the local interface address.<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
set nexthop 192.168.0.1 
set nexthop blackhole 
set nexthop reject 
set nexthop no-modify 
set nexthop self</pre>
<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">pftable</b> <i class="arg">table</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Add the prefix in the update to the specified <a class="link-man" href="../html4/pf.html">pf(4)</a> table, regardless of whether or not the path was selected for routing. This option may be useful in building realtime blacklists.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">prepend-neighbor</b> <i class="arg">number</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Prepend the neighbor's AS <i class="arg">number</i> times to the <span class="emph">AS path</span>.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">prepend-self</b> <i class="arg">number</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Prepend the local AS <i class="arg">number</i> times to the <span class="emph">AS path</span>.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">rtlabel</b> <i class="arg">label</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Add the prefix to the kernel routing table with the specified <i class="arg">label</i>.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">weight</b> <i class="arg">number</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The <span class="emph">weight</span> is used to tip prefixes with equally long AS paths in one or the other direction. A prefix is weighed at a very late stage in the decision process. If <i class="arg">number</i> starts with a plus or minus sign, the <span class="emph">weight</span> will be adjusted by adding or subtracting <i class="arg">number</i>; otherwise it will be set to <i class="arg">number</i>. <span class="emph">Weight</span> is a local non-transitive attribute and a bgpd-specific extension. For prefixes with equally long paths, the prefix with the larger weight is selected.</dd>
</dl>
</div>
<div class="section">
<h1 id="x46494c4553">FILES</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/etc/bgpd.conf</i></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
<a class="link-man" href="../html8/bgpd.html">bgpd(8)</a> configuration file</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html3/strftime.html">strftime(3)</a>, <a class="link-man" href="../html4/ipsec.html">ipsec(4)</a>, <a class="link-man" href="../html4/pf.html">pf(4)</a>, <a class="link-man" href="../html4/tcp.html">tcp(4)</a>, <a class="link-man" href="../html8/bgpctl.html">bgpctl(8)</a>, <a class="link-man" href="../html8/bgpd.html">bgpd(8)</a>, <a class="link-man" href="../html8/ipsecctl.html">ipsecctl(8)</a>, <a class="link-man" href="../html8/isakmpd.html">isakmpd(8)</a>, <a class="link-man" href="../html8/rc.conf.local.html">rc.conf.local(8)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="name">bgpd.conf</b> file format first appeared in <span class="unix">OpenBSD&#160;3.5</span>.</div>
</div>
</body>
</html>

