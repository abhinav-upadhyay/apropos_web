<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
IKED.CONF(5)</title>
</head>
<body>
<div class="mandoc">
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">iked.conf</b> &#8212; <span class="desc">IKEv2 configuration file</span></div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> <b class="name">iked.conf</b> is the configuration file for <a class="link-man" href="../html8/iked.html">iked(8)</a>, the Internet Key Exchange version 2 (IKEv2) daemon for IPsec. IPsec itself is a pair of protocols: Encapsulating Security Payload (ESP), which provides integrity and confidentiality; and Authentication Header (AH), which provides integrity. The IPsec protocol itself is described in <a class="link-man" href="../html4/ipsec.html">ipsec(4)</a>.<div class="spacer">
</div>
In its most basic form, a flow is established between hosts and/or networks, and then Security Associations (SA) are established, which detail how the desired protection will be achieved. IPsec uses flows to determine whether to apply security services to an IP packet or not. <a class="link-man" href="../html8/iked.html">iked(8)</a> is used to set up flows and establish SAs automatically, by specifying &#8216;ikev2&#8217; policies in <b class="name">iked.conf</b> (see <i class="link-sec"><a class="link-sec" href="#x4155544f4d41544943204b4559494e4720504f4c4943494553">AUTOMATIC KEYING POLICIES</a></i>, below).<div class="spacer">
</div>
Alternative methods of setting up flows and SAs are also possible using manual keying or automatic keying using the older ISAKMP/Oakley a.k.a. IKEv1 protocol. Manual keying is not recommended, but can be convenient for quick setups and testing. See <a class="link-man" href="../html5/ipsec.conf.html">ipsec.conf(5)</a> and <a class="link-man" href="../html8/isakmpd.html">isakmpd(8)</a> for more information about manual keying and ISAKMP support.</div>
<div class="section">
<h1 id="x494b45442e434f4e462046494c4520464f524d4154">IKED.CONF FILE FORMAT</h1> <b class="name">iked.conf</b> is divided into three main sections:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">Macros</span></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
User-defined variables may be defined and used later, simplifying the configuration file.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">Global Configuration</span></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
Global settings for <a class="link-man" href="../html8/iked.html">iked(8)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">Automatic Keying Policies</span></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
Policies to set up IPsec flows and SAs automatically.</dd>
</dl>
<div class="spacer">
</div>
Lines beginning with &#8216;#&#8217; and empty lines are regarded as comments, and ignored. Lines may be split using the &#8216;\&#8217; character.<div class="spacer">
</div>
Argument names not beginning with a letter, digit, or underscore must be quoted.<div class="spacer">
</div>
Addresses can be specified in CIDR notation (matching netblocks), as symbolic host names, interface names, or interface group names.<div class="spacer">
</div>
Additional configuration files can be included with the <b class="cmd">include</b> keyword, for example:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
include &quot;/etc/macros.conf&quot;</pre>
</div>
<div class="section">
<h1 id="x4d4143524f53">MACROS</h1> Macros can be defined that will later be expanded in context. Macro names must start with a letter, digit, or underscore, and may contain any of those characters. Macro names may not be reserved words (for example <b class="cmd">flow</b>, <b class="cmd">from</b>, <b class="cmd">esp</b>). Macros are not expanded inside quotes.<div class="spacer">
</div>
For example:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
remote_gw = &quot;192.168.3.12&quot; 
ikev2 esp from 192.168.7.0/24 to 192.168.8.0/24 peer $remote_gw</pre>
</div>
<div class="section">
<h1 id="x474c4f42414c20434f4e46494755524154494f4e">GLOBAL CONFIGURATION</h1> Here are the settings that can be set globally:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">set active</b></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
Set <a class="link-man" href="../html8/iked.html">iked(8)</a> to active mode. This is the default.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">set passive</b></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
Set <a class="link-man" href="../html8/iked.html">iked(8)</a> to passive mode. In passive mode no packets are sent to peers and no connections are initiated by <a class="link-man" href="../html8/iked.html">iked(8)</a>. This option is used for setups using <a class="link-man" href="../html8/sasyncd.html">sasyncd(8)</a> and <a class="link-man" href="../html4/carp.html">carp(4)</a> to provide redundancy. iked will run in passive mode until sasyncd has determined that the host is the master and can switch to active mode.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">set couple</b></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
Load the negotiated security associations (SAs) and flows into the kernel. This is the default.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">set decouple</b></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
Don't load the negotiated SAs and flows from the kernel. This mode is only useful for testing and debugging.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">set ocsp</b> <i class="arg">URL</i></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
Enable OCSP and set the URL of the OCSP responder. Please note that the matching responder and issuer certificates have to be placed in <i class="file">/etc/iked/ocsp/responder.crt</i> and <i class="file">/etc/iked/ocsp/issuer.crt</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">user</b> <i class="arg">name</i> <i class="arg">password</i></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
<a class="link-man" href="../html8/iked.html">iked(8)</a> supports user-based authentication by tunneling the Extensible Authentication Protocol (EAP) over IKEv2. In its most basic form, the users will be authenticated against a local, integrated password database that is configured with the <b class="cmd">user</b> lines in <b class="name">iked.conf</b> and the <i class="arg">name</i> and <i class="arg">password</i> arguments. Note that the password has to be specified in plain text which is required to support different challenge-based EAP methods like EAP-MD5 or EAP-MSCHAPv2.</dd>
</dl>
</div>
<div class="section">
<h1 id="x4155544f4d41544943204b4559494e4720504f4c4943494553">AUTOMATIC KEYING POLICIES</h1> This section is used to configure policies that will be used by <a class="link-man" href="../html8/iked.html">iked(8)</a> to set up flows and SAs automatically. Some examples of setting up automatic keying:<div class="spacer">
</div>
<pre style="margin-left: 3.00ex;" class="lit display">
# Set up a VPN: 
# First between the gateway machines 192.168.3.1 and 192.168.3.2 
# Second between the networks 10.1.1.0/24 and 10.1.2.0/24 
ikev2 esp from 192.168.3.1 to 192.168.3.2 
ikev2 esp from 10.1.1.0/24 to 10.1.2.0/24 peer 192.168.3.2</pre>
<div class="spacer">
</div>
For incoming connections from remote peers, the policies are evaluated in sequential order, from first to last. The last matching policy decides what action is taken; if no policy matches the connection, the default action is to ignore the connection attempt or to use the <i class="arg">default</i> policy, if set. Please also see the <i class="link-sec"><a class="link-sec" href="#x4558414d504c4553">EXAMPLES</a></i> section for a detailed example of the policy evaluation.<div class="spacer">
</div>
The first time an IKEv2 connection matches a policy, an IKE SA is created; for subsequent packets the connection is identified by the IKEv2 parameters that are stored in the SA without evaluating any policies. After the connection is closed or times out, the IKE SA is automatically removed.<div class="spacer">
</div>
The commands are as follows:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">ikev2</b> [<span class="opt"><i class="arg">name</i></span>]</dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
The mandatory <b class="cmd">ikev2</b> keyword will identify an IKEv2 automatic keying policy. <i class="arg">name</i> is an optional arbitrary string identifying the policy. The name should only occur once in <b class="name">iked.conf</b> or any included files. If omitted, a name will be generated automatically for the policy.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="opt"><i class="arg">eval</i></span>]</dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
The <i class="arg">eval</i> option modifies the policy evaluation for this policy. It can be one of <i class="arg">quick</i>, <i class="arg">skip</i> or <i class="arg">default</i>. If a new incoming connection matches a policy with the <i class="arg">quick</i> option set, that policy is considered the last matching policy, and evaluation of subsequent policies is skipped. The <i class="arg">skip</i> option will disable evaluation of this policy for incoming connections. The <i class="arg">default</i> option sets the default policy and should only be specified once.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="opt"><i class="arg">mode</i></span>]</dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
<i class="arg">mode</i> specifies the IKEv2 mode to use: one of <i class="arg">passive</i> or <i class="arg">active</i>. When <i class="arg">passive</i> is specified, <a class="link-man" href="../html8/iked.html">iked(8)</a> will not immediately start negotiation of this tunnel, but wait for an incoming request from the remote peer. When <i class="arg">active</i> is specified, negotiation will be started at once. If omitted, <i class="arg">passive</i> mode will be used.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">ipcomp</b></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
Enable optional support for <a class="link-man" href="../html4/ipcomp.html">ipcomp(4)</a>, the IP Payload Compression protocol.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="opt"><i class="arg">encap</i></span>]</dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
<i class="arg">encap</i> specifies the encapsulation protocol to be used. Possible protocols are <i class="arg">esp</i> and <i class="arg">ah</i>; the default is <i class="arg">esp</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="opt"><i class="arg">af</i></span>]</dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
This policy only applies to endpoints of the specified address family which can be either <i class="arg">inet</i> or <i class="arg">inet6</i>. Note that this only matters for IKEv2 endpoints and does not restrict the traffic selectors to negotiate flows with different address families, e.g. IPv6 flows negotiated by IPv4 endpoints.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">proto</b> <i class="arg">protocol</i></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
The optional <b class="cmd">proto</b> parameter restricts the flow to a specific IP protocol. Common protocols are <a class="link-man" href="../html4/icmp.html">icmp(4)</a>, <a class="link-man" href="../html4/tcp.html">tcp(4)</a>, and <a class="link-man" href="../html4/udp.html">udp(4)</a>. For a list of all the protocol name to number mappings used by <a class="link-man" href="../html8/iked.html">iked(8)</a>, see the file <i class="file">/etc/protocols</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">from</b> <i class="arg">src</i> [<span class="opt"><b class="cmd">port</b> <i class="arg">sport</i></span>] [<span class="opt">(<i class="arg">srcnat</i>)</span>] <b class="cmd">to</b> <i class="arg">dst</i> [<span class="opt"><b class="cmd">port</b> <i class="arg">dport</i></span>]</dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
Specify one or more traffic selectors for this policy which will be used to negotiate the IPsec flows between the IKEv2 peers. During the negotiation, the peers may decide to narrow a flow to a subset of the configured traffic selector networks to match the policies on each side.<div class="spacer">
</div>
Each traffic selector will apply for packets with source address <i class="arg">src</i> and destination address <i class="arg">dst</i>. The keyword <i class="arg">any</i> will match any address (i.e. 0.0.0.0/0). If the <i class="arg">src</i> argument specifies a fictional source ID, the <i class="arg">srcnat</i> parameter can be used to specify the actual source address. This can be used in outgoing NAT/BINAT scenarios as described below.<div class="spacer">
</div>
The optional <b class="cmd">port</b> modifiers restrict the traffic selectors to the specified ports. They are only valid in conjunction with the <a class="link-man" href="../html4/tcp.html">tcp(4)</a> and <a class="link-man" href="../html4/udp.html">udp(4)</a> protocols. Ports can be specified by number or by name. For a list of all port name to number mappings used by <a class="link-man" href="../html8/ipsecctl.html">ipsecctl(8)</a>, see the file <i class="file">/etc/services</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">local</b> <i class="arg">localip</i> <b class="cmd">peer</b> <i class="arg">remote</i></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
The <b class="cmd">local</b> parameter specifies the address or FQDN of the local endpoint. Unless the gateway is multi-homed or uses address aliases, this option is generally not needed.<div class="spacer">
</div>
The <b class="cmd">peer</b> parameter specifies the address or FQDN of the remote endpoint. For host-to-host connections where <i class="arg">dst</i> is identical to <i class="arg">remote</i>, this option is generally not needed as it will be set to <i class="arg">dst</i> automatically. If it is not specified or if the keyword <i class="arg">any</i> is given, the default peer is used.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">ikesa</b> <b class="cmd">auth</b> <i class="arg">algorithm</i> <b class="cmd">enc</b> <i class="arg">algorithm</i> <b class="cmd">prf</b> <i class="arg">algorithm</i> <b class="cmd">group</b> <i class="arg">group</i></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
These parameters define the mode and cryptographic transforms to be used for the IKE SA negotiation, also known as phase 1. The IKE SA will be used to authenticate the machines and to set up an encrypted channel for the IKEv2 protocol.<div class="spacer">
</div>
Possible values for <b class="cmd">auth</b>, <b class="cmd">enc</b>, <b class="cmd">prf</b>, <b class="cmd">group</b>, and the default proposals are described below in <i class="link-sec"><a class="link-sec" href="#x43525950544f205452414e53464f524d53">CRYPTO TRANSFORMS</a></i>. If omitted, <a class="link-man" href="../html8/iked.html">iked(8)</a> will use the default proposals for the IKEv2 protocol.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">childsa</b> <b class="cmd">auth</b> <i class="arg">algorithm</i> <b class="cmd">enc</b> <i class="arg">algorithm</i> <b class="cmd">group</b> <i class="arg">group</i></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
These parameters define the cryptographic transforms to be used for the Child SA negotiation, also known as phase 2. Each Child SA will be used to negotiate the actual IPsec SAs. The initial Child SA is always negotiated with the initial IKEv2 key exchange; additional Child SAs may be negotiated with additional Child SA key exchanges for an established IKE SA.<div class="spacer">
</div>
Possible values for <b class="cmd">auth</b>, <b class="cmd">enc</b>, <b class="cmd">group</b>, and the default proposals are described below in <i class="link-sec"><a class="link-sec" href="#x43525950544f205452414e53464f524d53">CRYPTO TRANSFORMS</a></i>. If omitted, <a class="link-man" href="../html8/iked.html">iked(8)</a> will use the default proposals for the ESP or AH protocol. The <b class="cmd">group</b> option will only be used to enable Perfect Forward Secrecy (PFS) for additional Child SAs exchanges that are not part of the initial key exchange.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">srcid</b> <i class="arg">string</i> <b class="cmd">dstid</b> <i class="arg">string</i></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
<b class="cmd">srcid</b> defines an ID of type &#8220;FQDN&#8221;, &#8220;ASN1_DN&#8221;, &#8220;IPV4&#8221;, &#8220;IPV6&#8221;, or &#8220;UFQDN&#8221; that will be used by <a class="link-man" href="../html8/iked.html">iked(8)</a> as the identity of the local peer. If the argument is an email address (reyk@example.com), <a class="link-man" href="../html8/iked.html">iked(8)</a> will use UFQDN as the ID type. The ASN1_DN type will be used if the string starts with a slash &#8216;/&#8217; (/C=DE/../CN=10.0.0.1/emailAddress=reyk@example.com). If the argument is an IPv4 address or a compressed IPv6 address, the ID types IPV4 or IPV6 will be used. Anything else is considered to be an FQDN.<div class="spacer">
</div>
If <b class="cmd">srcid</b> is omitted, the default is to use the hostname of the local machine, see <a class="link-man" href="../html1/hostname.html">hostname(1)</a> to set or print the hostname.<div class="spacer">
</div>
<b class="cmd">dstid</b> is similar to <b class="cmd">srcid</b>, but instead specifies the ID to be used by the remote peer.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">ikelifetime</b> <i class="arg">time</i></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
The optional <b class="cmd">ikelifetime</b> parameter defines the IKE SA expiration timeout by the <i class="arg">time</i> SA was created. A zero value disables active IKE SA rekeying. This is the default.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">lifetime</b> <i class="arg">time</i> [<span class="opt"><b class="cmd">bytes</b> <i class="arg">bytes</i></span>]</dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
The optional <b class="cmd">lifetime</b> parameter defines the Child SA expiration timeout by the <i class="arg">time</i> SA was in use and by the number of <i class="arg">bytes</i> that were processed using the SA. Default values are 3 hours and 512 megabytes which means that SA will be rekeyed before reaching the time limit or 512 megabytes of data will pass through. Zero values disable rekeying.<div class="spacer">
</div>
Several unit specifiers are recognized (ignoring case): &#8216;<code class="lit">m</code>&#8217; and &#8216;<code class="lit">h</code>&#8217; for minutes and hours, and &#8216;<code class="lit">K</code>&#8217;, &#8216;<code class="lit">M</code>&#8217; and &#8216;<code class="lit">G</code>&#8217; for kilo-, mega- and gigabytes accordingly.<div class="spacer">
</div>
Please note that rekeying must happen at least several times a day as IPsec security heavily depends on the frequent key renewals.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="opt"><i class="arg">ikeauth</i></span>]</dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
Specify the mode to mutually authenticate the peers. Non-psk modes will require to set up certificates and RSA public keys; see <a class="link-man" href="../html8/iked.html">iked(8)</a> for more information.<div class="spacer">
</div>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 6.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">eap</b> <i class="arg">type</i></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Use EAP to authenticate the initiator. The only supported EAP <i class="arg">type</i> is currently <i class="arg">MSCHAP-V2</i>. The responder will use RSA public key authentication.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">psk</b> <i class="arg">string</i></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Use a pre-shared key <i class="arg">string</i> or hex value (starting with 0x) for authentication.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">rsa</b></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Use RSA public key authentication. This is the default mode if no option is specified.</dd>
</dl>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">config</b> <i class="arg">option address</i></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
Send one or more optional configuration payloads (CP) to the peer. The configuration <i class="arg">option</i> can be one of the following with the expected address format:<div class="spacer">
</div>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 6.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">address</b> <i class="arg">address</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Assign a static address on the internal network.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">address</b> <i class="arg">address/prefix</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Assign a dynamic address on the internal network. The address will be assigned from an address pool with the size specified by <i class="arg">prefix</i>.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">netmask</b> <i class="arg">netmask</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The IPv4 netmask of the internal network.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">name-server</b> <i class="arg">address</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The DNS server address within the internal network.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">netbios-server</b> <i class="arg">address</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The NetBIOS name server (WINS) within the internal network. This option is provided for compatibility with legacy clients.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">dhcp-server</b> <i class="arg">address</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The address of an internal DHCP server for further configuration.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">protected-subnet</b> <i class="arg">address/prefix</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The address of the protected subnet within the internal network.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="cmd">access-server</b> <i class="arg">address</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The address of an internal remote access server.</dd>
</dl>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">tag</b> <i class="arg">string</i></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
Add a <a class="link-man" href="../html4/pf.html">pf(4)</a> tag to all packets of IPsec SAs created for this connection. This will allow matching packets for this connection by defining rules in <a class="link-man" href="../html5/pf.conf.html">pf.conf(5)</a> using the <b class="flag">tagged</b> keyword.<div class="spacer">
</div>
The following variables can be used in tags to include information from the remote peer on runtime:<div class="spacer">
</div>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 6.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="arg">$id</i></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
The <b class="cmd">dstid</b> that was proposed by the remote peer to identify itself. It will be expanded to <i class="arg">id-value</i>, e.g. <i class="arg">FQDN/foo.example.com</i>. To limit the size of the derived tag, <a class="link-man" href="../html8/iked.html">iked(8)</a> will extract the common name &#8216;CN=&#8217; from ASN1_DN IDs, for example <i class="arg">ASN1_ID//C=DE/../CN=10.1.1.1/..</i> will be expanded to <i class="arg">10.1.1.1</i>.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="arg">$domain</i></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Extract the domain from IDs of type FQDN, UFQDN or ASN1_DN.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="arg">$name</i></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
The name of the IKEv2 policy that was configured in <b class="name">iked.conf</b> or automatically generated by <a class="link-man" href="../html8/iked.html">iked(8)</a>.</dd>
</dl>
<div class="spacer">
</div>
For example, if the ID is <i class="arg">FQDN/foo.example.com</i> or <i class="arg">UFQDN/user@example.com</i>, &#8220;ipsec-$domain&#8221; expands to &#8220;ipsec-example.com&#8221;. The variable expansion for the <i class="arg">tag</i> directive occurs only at runtime, not during configuration file parse time.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">tap</b> <i class="arg">interface</i></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
Send the decapsulated IPsec traffic to the specified <a class="link-man" href="../html4/enc.html">enc(4)</a> <i class="arg">interface</i> instead of <i class="arg">enc0</i> for filtering and monitoring. The traffic will be blocked if the specified <i class="arg">interface</i> does not exist.</dd>
</dl>
</div>
<div class="section">
<h1 id="x5041434b45542046494c544552494e47">PACKET FILTERING</h1> IPsec traffic appears unencrypted on the <a class="link-man" href="../html4/enc.html">enc(4)</a> interface and can be filtered accordingly using the <span class="unix">OpenBSD</span> packet filter, <a class="link-man" href="../html4/pf.html">pf(4)</a>. The grammar for the packet filter is described in <a class="link-man" href="../html5/pf.conf.html">pf.conf(5)</a>.<div class="spacer">
</div>
The following components are relevant to filtering IPsec traffic:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 6.00ex;" class="list list-ohang">
<dt class="list-ohang" style="margin-top: 1.00em;">
external interface</dt>
<dd class="list-ohang">
Interface for IKE traffic and encapsulated IPsec traffic.</dd>
<dt class="list-ohang" style="margin-top: 1.00em;">
proto udp port 500</dt>
<dd class="list-ohang">
IKE traffic on the external interface.</dd>
<dt class="list-ohang" style="margin-top: 1.00em;">
proto udp port 4500</dt>
<dd class="list-ohang">
IKE NAT-Traversal traffic on the external interface.</dd>
<dt class="list-ohang" style="margin-top: 1.00em;">
proto ah | esp</dt>
<dd class="list-ohang">
Encapsulated IPsec traffic on the external interface.</dd>
<dt class="list-ohang" style="margin-top: 1.00em;">
enc0</dt>
<dd class="list-ohang">
Default interface for outgoing traffic before it's been encapsulated, and incoming traffic after it's been decapsulated. State on this interface should be interface bound; see <a class="link-man" href="../html4/enc.html">enc(4)</a> for further information.</dd>
<dt class="list-ohang" style="margin-top: 1.00em;">
proto ipencap</dt>
<dd class="list-ohang">
[tunnel mode only] IP-in-IP traffic flowing between gateways on the enc0 interface.</dd>
<dt class="list-ohang" style="margin-top: 1.00em;">
tagged ipsec-example.org</dt>
<dd class="list-ohang">
Match traffic of IPsec SAs using the <b class="cmd">tag</b> keyword.</dd>
</dl>
<div class="spacer">
</div>
If the filtering rules specify to block everything by default, the following rule would ensure that IPsec traffic never hits the packet filtering engine, and is therefore passed:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
set skip on enc0</pre>
<div class="spacer">
</div>
In the following example, all traffic is blocked by default. IPsec-related traffic from gateways {192.168.3.1, 192.168.3.2} and networks {10.0.1.0/24, 10.0.2.0/24} is permitted.<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
block on ix0 
block on enc0 
 
pass  in on ix0 proto udp from 192.168.3.2 to 192.168.3.1 \ 
	port {500, 4500} 
pass out on ix0 proto udp from 192.168.3.1 to 192.168.3.2 \ 
	port {500, 4500} 
 
pass  in on ix0 proto esp from 192.168.3.2 to 192.168.3.1 
pass out on ix0 proto esp from 192.168.3.1 to 192.168.3.2 
 
pass  in on enc0 proto ipencap from 192.168.3.2 to 192.168.3.1 \ 
	keep state (if-bound) 
pass out on enc0 proto ipencap from 192.168.3.1 to 192.168.3.2 \ 
	keep state (if-bound) 
pass  in on enc0 from 10.0.2.0/24 to 10.0.1.0/24 \ 
	keep state (if-bound) 
pass out on enc0 from 10.0.1.0/24 to 10.0.2.0/24 \ 
	keep state (if-bound)</pre>
<div class="spacer">
</div>
<a class="link-man" href="../html4/pf.html">pf(4)</a> has the ability to filter IPsec-related packets based on an arbitrary <span class="emph">tag</span> specified within a ruleset. The tag is used as an internal marker which can be used to identify the packets later on. This could be helpful, for example, in scenarios where users are connecting in from differing IP addresses, or to support queue-based bandwidth control, since the enc0 interface does not support it.<div class="spacer">
</div>
The following <a class="link-man" href="../html5/pf.conf.html">pf.conf(5)</a> fragment uses queues for all IPsec traffic with special handling for developers and employees:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
queue std on ix0 bandwidth 100M 
queue   deflt parent std bandwidth 10M default 
queue   developers parent std bandwidth 75M 
queue   employees parent std bandwidth 5M 
queue   ipsec parent std bandwidth 10M 
 
pass out on ix0 proto esp set queue ipsec 
 
pass out on ix0 tagged ipsec-developers.example.com \ 
	set queue developers 
pass out on ix0 tagged ipsec-employees.example.com \ 
	set queue employees</pre>
<div class="spacer">
</div>
The following example assigns the tags in the <b class="name">iked.conf</b> configuration and also sets an alternative <a class="link-man" href="../html4/enc.html">enc(4)</a> device:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
ikev2 esp from 10.1.1.0/24 to 10.1.2.0/24 peer 192.168.3.2 \ 
	tag ipsec-$domain tap &quot;enc1&quot;</pre>
</div>
<div class="section">
<h1 id="x4f5554474f494e47204e4554574f524b2041444452455353205452414e534c4154494f4e">OUTGOING NETWORK ADDRESS TRANSLATION</h1> In some network topologies it is desirable to perform NAT on traffic leaving through the VPN tunnel. In order to achieve that, the <i class="arg">src</i> argument is used to negotiate the desired network ID with the peer and the <i class="arg">srcnat</i> parameter defines the true local subnet, so that a correct SA can be installed on the local side.<div class="spacer">
</div>
For example, if the local subnet is 192.168.1.0/24 and all the traffic for a specific VPN peer should appear as coming from 10.10.10.1, the following configuration is used:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
ikev2 esp from 10.10.10.1 (192.168.1.0/24) to 192.168.2.0/24 \ 
	peer 10.10.20.1</pre>
<div class="spacer">
</div>
Naturally, a relevant NAT rule is required in <a class="link-man" href="../html5/pf.conf.html">pf.conf(5)</a>. For the example above, this would be:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
match out on enc0 from 192.168.1.0/24 to 192.168.2.0/24 \ 
	nat-to 10.10.10.1</pre>
<div class="spacer">
</div>
From the peer's point of view, the local end of the VPN tunnel is declared to be 10.10.10.1 and all the traffic arrives with that source address.</div>
<div class="section">
<h1 id="x43525950544f205452414e53464f524d53">CRYPTO TRANSFORMS</h1> The following authentication types are permitted with the <b class="cmd">auth</b> keyword:<table style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 6.00ex;" class="list list-col">
<col style="width: 14.00ex;"/>
<col style="width: 10.00ex;"/>
<col style="min-width: 16.00ex;"/>
<tbody>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<span class="emph">Authentication</span></td>
<td class="list-col" style="margin-top: 1.00em;">
<span class="emph">Key Length</span></td>
<td class="list-col" style="margin-top: 1.00em;">
<span class="emph">Truncated Length</span></td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">hmac-md5</code></td>
<td class="list-col" style="margin-top: 1.00em;">
128 bits</td>
<td class="list-col" style="margin-top: 1.00em;">
96 bits</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">hmac-sha1</code></td>
<td class="list-col" style="margin-top: 1.00em;">
160 bits</td>
<td class="list-col" style="margin-top: 1.00em;">
96 bits</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">hmac-sha2-256</code></td>
<td class="list-col" style="margin-top: 1.00em;">
256 bits</td>
<td class="list-col" style="margin-top: 1.00em;">
128 bits</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">hmac-sha2-384</code></td>
<td class="list-col" style="margin-top: 1.00em;">
384 bits</td>
<td class="list-col" style="margin-top: 1.00em;">
192 bits</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">hmac-sha2-512</code></td>
<td class="list-col" style="margin-top: 1.00em;">
512 bits</td>
<td class="list-col" style="margin-top: 1.00em;">
256 bits</td>
</tr>
</tbody>
</table>
<div class="spacer">
</div>
The following pseudo-random function types are permitted with the <b class="cmd">prf</b> keyword:<table style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 6.00ex;" class="list list-col">
<col style="width: 13.00ex;"/>
<col style="width: 10.00ex;"/>
<col style="min-width: 10.00ex;"/>
<tbody>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<span class="emph">PRF</span></td>
<td class="list-col" style="margin-top: 1.00em;">
<span class="emph">Key Length</span></td>
<td class="list-col" style="margin-top: 1.00em;">
</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">hmac-md5</code></td>
<td class="list-col" style="margin-top: 1.00em;">
128 bits</td>
<td class="list-col" style="margin-top: 1.00em;">
[IKE only]</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">hmac-sha1</code></td>
<td class="list-col" style="margin-top: 1.00em;">
160 bits</td>
<td class="list-col" style="margin-top: 1.00em;">
[IKE only]</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">hmac-sha2-256</code></td>
<td class="list-col" style="margin-top: 1.00em;">
256 bits</td>
<td class="list-col" style="margin-top: 1.00em;">
[IKE only]</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">hmac-sha2-384</code></td>
<td class="list-col" style="margin-top: 1.00em;">
384 bits</td>
<td class="list-col" style="margin-top: 1.00em;">
[IKE only]</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">hmac-sha2-512</code></td>
<td class="list-col" style="margin-top: 1.00em;">
512 bits</td>
<td class="list-col" style="margin-top: 1.00em;">
[IKE only]</td>
</tr>
</tbody>
</table>
<div class="spacer">
</div>
The following cipher types are permitted with the <b class="cmd">enc</b> keyword:<table style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 6.00ex;" class="list list-col">
<col style="width: 17.00ex;"/>
<col style="width: 10.00ex;"/>
<col style="min-width: 10.00ex;"/>
<tbody>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<span class="emph">Cipher</span></td>
<td class="list-col" style="margin-top: 1.00em;">
<span class="emph">Key Length</span></td>
<td class="list-col" style="margin-top: 1.00em;">
</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">3des</code></td>
<td class="list-col" style="margin-top: 1.00em;">
168 bits</td>
<td class="list-col" style="margin-top: 1.00em;">
</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">aes-128</code></td>
<td class="list-col" style="margin-top: 1.00em;">
128 bits</td>
<td class="list-col" style="margin-top: 1.00em;">
</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">aes-192</code></td>
<td class="list-col" style="margin-top: 1.00em;">
192 bits</td>
<td class="list-col" style="margin-top: 1.00em;">
</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">aes-256</code></td>
<td class="list-col" style="margin-top: 1.00em;">
256 bits</td>
<td class="list-col" style="margin-top: 1.00em;">
</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">aes-128-ctr</code></td>
<td class="list-col" style="margin-top: 1.00em;">
160 bits</td>
<td class="list-col" style="margin-top: 1.00em;">
[ESP only]</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">aes-192-ctr</code></td>
<td class="list-col" style="margin-top: 1.00em;">
224 bits</td>
<td class="list-col" style="margin-top: 1.00em;">
[ESP only]</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">aes-256-ctr</code></td>
<td class="list-col" style="margin-top: 1.00em;">
288 bits</td>
<td class="list-col" style="margin-top: 1.00em;">
[ESP only]</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">aes-128-gcm</code></td>
<td class="list-col" style="margin-top: 1.00em;">
160 bits</td>
<td class="list-col" style="margin-top: 1.00em;">
[ESP only]</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">aes-192-gcm</code></td>
<td class="list-col" style="margin-top: 1.00em;">
224 bits</td>
<td class="list-col" style="margin-top: 1.00em;">
[ESP only]</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">aes-256-gcm</code></td>
<td class="list-col" style="margin-top: 1.00em;">
288 bits</td>
<td class="list-col" style="margin-top: 1.00em;">
[ESP only]</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">blowfish</code></td>
<td class="list-col" style="margin-top: 1.00em;">
160 bits</td>
<td class="list-col" style="margin-top: 1.00em;">
[ESP only]</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">cast</code></td>
<td class="list-col" style="margin-top: 1.00em;">
128 bits</td>
<td class="list-col" style="margin-top: 1.00em;">
[ESP only]</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">chacha20-poly1305</code></td>
<td class="list-col" style="margin-top: 1.00em;">
288 bits</td>
<td class="list-col" style="margin-top: 1.00em;">
[ESP only]</td>
</tr>
</tbody>
</table>
<div class="spacer">
</div>
The following cipher types provide only authentication, not encryption:<table style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 6.00ex;" class="list list-col">
<col style="width: 17.00ex;"/>
<col style="width: 10.00ex;"/>
<col style="min-width: 10.00ex;"/>
<tbody>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">aes-128-gmac</code></td>
<td class="list-col" style="margin-top: 1.00em;">
160 bits</td>
<td class="list-col" style="margin-top: 1.00em;">
[ESP only]</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">aes-192-gmac</code></td>
<td class="list-col" style="margin-top: 1.00em;">
224 bits</td>
<td class="list-col" style="margin-top: 1.00em;">
[ESP only]</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">aes-256-gmac</code></td>
<td class="list-col" style="margin-top: 1.00em;">
288 bits</td>
<td class="list-col" style="margin-top: 1.00em;">
[ESP only]</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">null</code></td>
<td class="list-col" style="margin-top: 1.00em;">
</td>
<td class="list-col" style="margin-top: 1.00em;">
[ESP only]</td>
</tr>
</tbody>
</table>
<div class="spacer">
</div>
3DES requires 24 bytes to form its 168-bit key. This is because the most significant bit of each byte is used for parity.<div class="spacer">
</div>
The keysize of AES-CTR is actually 128-bit. However as well as the key, a 32-bit nonce has to be supplied. Thus 160 bits of key material have to be supplied. The same applies to AES-GCM, AES-GMAC and Chacha20-Poly1305, however in the latter case the keysize is 256 bit.<div class="spacer">
</div>
Using AES-GMAC or NULL with ESP will only provide authentication. This is useful in setups where AH cannot be used, e.g. when NAT is involved.<div class="spacer">
</div>
The following group types are permitted with the <b class="cmd">group</b> keyword:<table style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 6.00ex;" class="list list-col">
<col style="width: 12.00ex;"/>
<col style="width: 5.00ex;"/>
<col style="width: 4.00ex;"/>
<col style="min-width: 4.00ex;"/>
<tbody>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<span class="emph">Name</span></td>
<td class="list-col" style="margin-top: 1.00em;">
<span class="emph">Group</span></td>
<td class="list-col" style="margin-top: 1.00em;">
<span class="emph">Size</span></td>
<td class="list-col" style="margin-top: 1.00em;">
<span class="emph">Type</span></td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">modp768</code></td>
<td class="list-col" style="margin-top: 1.00em;">
grp1</td>
<td class="list-col" style="margin-top: 1.00em;">
768</td>
<td class="list-col" style="margin-top: 1.00em;">
MODP</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">modp1024</code></td>
<td class="list-col" style="margin-top: 1.00em;">
grp2</td>
<td class="list-col" style="margin-top: 1.00em;">
1024</td>
<td class="list-col" style="margin-top: 1.00em;">
MODP</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">ec2n155</code></td>
<td class="list-col" style="margin-top: 1.00em;">
grp3</td>
<td class="list-col" style="margin-top: 1.00em;">
155</td>
<td class="list-col" style="margin-top: 1.00em;">
EC2N [insecure]</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">ec2n185</code></td>
<td class="list-col" style="margin-top: 1.00em;">
grp4</td>
<td class="list-col" style="margin-top: 1.00em;">
185</td>
<td class="list-col" style="margin-top: 1.00em;">
EC2N [insecure]</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">modp1536</code></td>
<td class="list-col" style="margin-top: 1.00em;">
grp5</td>
<td class="list-col" style="margin-top: 1.00em;">
1536</td>
<td class="list-col" style="margin-top: 1.00em;">
MODP</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">modp2048</code></td>
<td class="list-col" style="margin-top: 1.00em;">
grp14</td>
<td class="list-col" style="margin-top: 1.00em;">
2048</td>
<td class="list-col" style="margin-top: 1.00em;">
MODP</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">modp3072</code></td>
<td class="list-col" style="margin-top: 1.00em;">
grp15</td>
<td class="list-col" style="margin-top: 1.00em;">
3072</td>
<td class="list-col" style="margin-top: 1.00em;">
MODP</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">modp4096</code></td>
<td class="list-col" style="margin-top: 1.00em;">
grp16</td>
<td class="list-col" style="margin-top: 1.00em;">
4096</td>
<td class="list-col" style="margin-top: 1.00em;">
MODP</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">modp6144</code></td>
<td class="list-col" style="margin-top: 1.00em;">
grp17</td>
<td class="list-col" style="margin-top: 1.00em;">
6144</td>
<td class="list-col" style="margin-top: 1.00em;">
MODP</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">modp8192</code></td>
<td class="list-col" style="margin-top: 1.00em;">
grp18</td>
<td class="list-col" style="margin-top: 1.00em;">
8192</td>
<td class="list-col" style="margin-top: 1.00em;">
MODP</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">ecp256</code></td>
<td class="list-col" style="margin-top: 1.00em;">
grp19</td>
<td class="list-col" style="margin-top: 1.00em;">
256</td>
<td class="list-col" style="margin-top: 1.00em;">
ECP</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">ecp384</code></td>
<td class="list-col" style="margin-top: 1.00em;">
grp20</td>
<td class="list-col" style="margin-top: 1.00em;">
384</td>
<td class="list-col" style="margin-top: 1.00em;">
ECP</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">ecp521</code></td>
<td class="list-col" style="margin-top: 1.00em;">
grp21</td>
<td class="list-col" style="margin-top: 1.00em;">
521</td>
<td class="list-col" style="margin-top: 1.00em;">
ECP</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">modp1024-160</code></td>
<td class="list-col" style="margin-top: 1.00em;">
grp22</td>
<td class="list-col" style="margin-top: 1.00em;">
2048</td>
<td class="list-col" style="margin-top: 1.00em;">
MODP, 160 bit Prime Order Subgroup</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">modp2048-224</code></td>
<td class="list-col" style="margin-top: 1.00em;">
grp23</td>
<td class="list-col" style="margin-top: 1.00em;">
2048</td>
<td class="list-col" style="margin-top: 1.00em;">
MODP, 224 bit Prime Order Subgroup</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">modp2048-256</code></td>
<td class="list-col" style="margin-top: 1.00em;">
grp24</td>
<td class="list-col" style="margin-top: 1.00em;">
2048</td>
<td class="list-col" style="margin-top: 1.00em;">
MODP, 256 bit Prime Order Subgroup</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">ecp192</code></td>
<td class="list-col" style="margin-top: 1.00em;">
grp25</td>
<td class="list-col" style="margin-top: 1.00em;">
192</td>
<td class="list-col" style="margin-top: 1.00em;">
ECP</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">ecp224</code></td>
<td class="list-col" style="margin-top: 1.00em;">
grp26</td>
<td class="list-col" style="margin-top: 1.00em;">
224</td>
<td class="list-col" style="margin-top: 1.00em;">
ECP</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">brainpool224</code></td>
<td class="list-col" style="margin-top: 1.00em;">
grp27</td>
<td class="list-col" style="margin-top: 1.00em;">
224</td>
<td class="list-col" style="margin-top: 1.00em;">
ECP, brainpoolP224r1</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">brainpool256</code></td>
<td class="list-col" style="margin-top: 1.00em;">
grp28</td>
<td class="list-col" style="margin-top: 1.00em;">
256</td>
<td class="list-col" style="margin-top: 1.00em;">
ECP, brainpoolP256r1</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">brainpool384</code></td>
<td class="list-col" style="margin-top: 1.00em;">
grp29</td>
<td class="list-col" style="margin-top: 1.00em;">
384</td>
<td class="list-col" style="margin-top: 1.00em;">
ECP, brainpoolP384r1</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">brainpool512</code></td>
<td class="list-col" style="margin-top: 1.00em;">
grp30</td>
<td class="list-col" style="margin-top: 1.00em;">
512</td>
<td class="list-col" style="margin-top: 1.00em;">
ECP, brainpoolP512r1</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">curve25519</code></td>
<td class="list-col" style="margin-top: 1.00em;">
-</td>
<td class="list-col" style="margin-top: 1.00em;">
256</td>
<td class="list-col" style="margin-top: 1.00em;">
Curve25519</td>
</tr>
</tbody>
</table>
<div class="spacer">
</div>
The currently supported group types are either MODP (exponentiation groups modulo a prime), EC2N (elliptic curve groups over GF[2^N]), ECP (elliptic curve groups modulo a prime), or the non-standard Curve25519. Please note that the EC2N groups are considered as insecure and only provided for backwards compatibility.</div>
<div class="section">
<h1 id="x4558414d504c4553">EXAMPLES</h1> The first example is intended for a server with clients connecting to <a class="link-man" href="../html8/iked.html">iked(8)</a> as an IPsec gateway, or IKEv2 responder, using mutual public key authentication and additional challenge-based EAP-MSCHAPv2 password authentication:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
user &quot;test&quot; &quot;password123&quot; 
 
ikev2 &quot;win7&quot; esp \ 
	from 0.0.0.0/0 to 172.16.2.0/24 \ 
	peer 10.0.0.0/8 local 192.168.56.0/24 \ 
	eap &quot;mschap-v2&quot; \ 
	config address 172.16.2.1 \ 
	tag &quot;$name-$id&quot;</pre>
<div class="spacer">
</div>
The next example allows peers to authenticate using a pre-shared key &#8216;foobar&#8217;:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
ikev2 &quot;big test&quot; \ 
	esp proto tcp \ 
	from 10.0.0.0/8 port 23 to 20.0.0.0/8 port 40 \ 
	from 192.168.1.1 to 192.168.2.2 \ 
	peer any local any \ 
	ikesa enc 3des auth hmac-sha1 group modp1024 \ 
	childsa enc aes-128 auth hmac-sha1 \ 
	srcid host.example.com \ 
	dstid 192.168.0.254 \ 
	psk &quot;foobar&quot;</pre>
<div class="spacer">
</div>
The following example illustrates the last matching policy evaluation for incoming connections on an IKEv2 gateway. The peer 192.168.1.34 will always match the first policy because of the <i class="arg">quick</i> keyword; connections from the peers 192.168.1.3 and 192.168.1.2 will be matched by one of the last two policies; any other connections from 192.168.1.0/24 will be matched by the &#8216;subnet&#8217; policy; and any other connection will be matched by the &#8216;catch all&#8217; policy.<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
ikev2 quick esp from 10.10.10.0/24 to 10.20.20.0/24 \ 
	peer 192.168.1.34 
ikev2 &quot;catch all&quot; esp from 10.0.1.0/24 to 10.0.2.0/24 \ 
	peer any 
ikev2 &quot;subnet&quot; esp from 10.0.3.0/24 to 10.0.4.0/24 \ 
	peer 192.168.1.0/24 
ikev2 esp from 10.0.5.0/30 to 10.0.5.4/30 peer 192.168.1.2 
ikev2 esp from 10.0.5.8/30 to 10.0.5.12/30 peer 192.168.1.3</pre>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html4/enc.html">enc(4)</a>, <a class="link-man" href="../html4/ipsec.html">ipsec(4)</a>, <a class="link-man" href="../html5/ipsec.conf.html">ipsec.conf(5)</a>, <a class="link-man" href="../html5/pf.conf.html">pf.conf(5)</a>, <a class="link-man" href="../html8/ikectl.html">ikectl(8)</a>, <a class="link-man" href="../html8/iked.html">iked(8)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="name">iked.conf</b> file format first appeared in <span class="unix">OpenBSD&#160;4.8</span>.</div>
<div class="section">
<h1 id="x415554484f5253">AUTHORS</h1> The <a class="link-man" href="../html8/iked.html">iked(8)</a> program was written by <span class="author">Reyk Floeter</span> &lt;<a class="link-mail" href="mailto:reyk@openbsd.org">reyk@openbsd.org</a>&gt;.</div>
</div>
</body>
</html>

