<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
IFSTATED.CONF(5)</title>
</head>
<body>
<div class="mandoc">
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">ifstated.conf</b> &#8212; <span class="desc">Interface State daemon configuration file</span></div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <a class="link-man" href="../html8/ifstated.html">ifstated(8)</a> daemon runs commands in response to network state changes, which it determines by monitoring interface link state or running external tests. <b class="name">ifstated.conf</b> is the configuration file for this daemon.</div>
<div class="section">
<h1 id="x53454354494f4e53">SECTIONS</h1> The <b class="name">ifstated.conf</b> config file is divided into three main sections.<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">Global Configuration</span></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
Global settings for <a class="link-man" href="../html8/ifstated.html">ifstated(8)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">Macros</span></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
User-defined variables may be defined and used later, simplifying configuration. Macros must be defined before they are referenced in <b class="name">ifstated.conf</b>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">State Definitions</span></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
Definitions of states and transitions.</dd>
</dl>
</div>
<div class="section">
<h1 id="x474c4f42414c20434f4e46494755524154494f4e">GLOBAL CONFIGURATION</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">init-state</b> <i class="arg">state</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Set the initial state to <i class="arg">state</i> instead of using the first state defined.</dd>
</dl>
</div>
<div class="section">
<h1 id="x4d4143524f53">MACROS</h1> Macros can be defined that will later be expanded in context. Macro names must start with a letter, digit, or underscore, and may contain any of those characters. Macro names may not be reserved words like, for example <i class="arg">state</i> or <i class="arg">run</i>. Macros are referenced with a shell-like notation as <span class="emph">$macro</span>. Macros are usually used to define tests for state transitions like interface link state or external tests.<div class="spacer">
</div>
Currently an interface can have three different link states:<div class="spacer">
</div>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="arg">up</i></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
The physical link of the interface is up. For <a class="link-man" href="../html4/carp.html">carp(4)</a> interfaces this equals the master state.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="arg">down</i></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
The physical link of the interface is down. For <a class="link-man" href="../html4/carp.html">carp(4)</a> interfaces this equals the backup state.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="arg">unknown</i></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
The physical link of the interface is unknown. This is because the interface driver does not provide information of the physical link state. For <a class="link-man" href="../html4/carp.html">carp(4)</a> interfaces this equals the init state.</dd>
</dl>
<div class="spacer">
</div>
In contrast to link state tests, external tests must be run periodically to evaluate their status. The frequency at which an external test is run has to be set with the <i class="arg">every</i> keyword.<div class="spacer">
</div>
For example:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
carp_up = &quot;carp0.link.up &amp;&amp; carp1.link.up&quot; 
net = '( &quot;ping -q -c 1 -w 1 192.168.0.1 &gt; /dev/null&quot; every 10 &amp;&amp; \ 
         &quot;ping -q -c 1 -w 1 192.168.0.2 &gt; /dev/null&quot; every 10 )'</pre>
</div>
<div class="section">
<h1 id="x544553545320414e44204556454e5453">TESTS AND EVENTS</h1> <a class="link-man" href="../html8/ifstated.html">ifstated(8)</a> delegates the process of testing to libevent which associates a value with every test, in this case <span class="emph">true</span> or <span class="emph">false</span>. Whenever the value of a test associated with the current state changes, an event is triggered and the state's body is processed.</div>
<div class="section">
<h1 id="x535441544520444546494e4954494f4e53">STATE DEFINITIONS</h1> <a class="link-man" href="../html8/ifstated.html">ifstated(8)</a> operates on a finite state machine with states and transitions.<div class="spacer">
</div>
Each state consists of an <span class="emph">init</span> block and a body. The <span class="emph">init</span> block is used to initialise the state and is executed each time the state is entered. The body of a state is only executed when that state is the current state and an event occurs.<div class="spacer">
</div>
The action taken within a certain state is typically made dependent on the evaluation of one or more <span class="emph">if</span> statements. Possible actions include executing commands using the <span class="emph">run</span> statement, or triggering a state transition with the <i class="arg">set-state</i> keyword. It is also possible to write multiple nested <span class="emph">if</span> blocks.<div class="spacer">
</div>
For example:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
state one { 
	init { 
		run &quot;ifconfig carp0 advskew 10&quot; 
		run &quot;ifconfig carp1 advskew 10&quot; 
	} 
 
	if ! $net 
		set-state two 
 
	if ! $carp_up { 
		run &quot;ifconfig carp0 advskew 254&quot; 
		run &quot;ifconfig carp1 advskew 254&quot; 
		set-state three 
	} 
}</pre>
</div>
<div class="section">
<h1 id="x4752414d4d4152">GRAMMAR</h1> Syntax for <b class="name">ifstated.conf</b> in BNF:<div class="spacer">
</div>
<pre style="margin-left: 0.00ex;" class="lit display">
grammar		= entry grammar | entry 
 
entry		= global_config | varset | action | state 
 
global_config	= initstate 
initstate	= &quot;init-state&quot; string 
 
varset		= string &quot;=&quot; string 
 
action_list	= action [ action_list ] 
action		= &quot;run&quot; string | &quot;set-state&quot; string | 
		  &quot;if&quot; expr action_block 
action_block	= &quot;{&quot; action_list &quot;}&quot; | action 
expr		= &quot;!&quot; expr | expr &quot;&amp;&amp;&quot; expr | expr &quot;||&quot; expr | term 
term		= if_test | ext_test | &quot;(&quot; expr &quot;)&quot; 
if_test		= string &quot;.link.&quot; ( &quot;up&quot; | &quot;down&quot; | &quot;unknown&quot; ) 
ext_test	= string &quot;every&quot; number 
 
state		= &quot;state&quot; string &quot;{&quot; stateopt_list &quot;}&quot; 
stateopt_list	= stateopt [ stateopt_list ] 
stateopt	= init | action 
init		= &quot;init&quot; action_block</pre>
</div>
<div class="section">
<h1 id="x46494c4553">FILES</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/etc/ifstated.conf</i></dt>
<dd class="list-tag" style="margin-left: 18.00ex;">
<a class="link-man" href="../html8/ifstated.html">ifstated(8)</a> configuration file</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html4/carp.html">carp(4)</a>, <a class="link-man" href="../html4/pf.html">pf(4)</a>, <a class="link-man" href="../html8/ifstated.html">ifstated(8)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="name">ifstated.conf</b> file format first appeared in <span class="unix">OpenBSD&#160;3.8</span>.</div>
</div>
</body>
</html>

