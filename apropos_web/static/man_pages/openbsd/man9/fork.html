<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
FORK1(9)</title>
</head>
<body>
<div class="mandoc">
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">fork1</b> &#8212; <span class="desc">create a new process</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">sys/types.h</a>&gt;</b><br/>
<b class="includes">#include &lt;<a class="link-includes">sys/proc.h</a>&gt;</b><div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">fork1</b>(<i class="farg">struct proc *p1</i>, <i class="farg">int flags</i>, <i class="farg">void *stack</i>, <i class="farg">pid_t *tidptr</i>, <i class="farg">void (*func)(void *)</i>, <i class="farg">void *arg</i>, <i class="farg">register_t *retval</i>, <i class="farg">struct proc **rnewprocp</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> <b class="fname">fork1</b>() creates a new process out of <i class="arg">p1</i>, which should be the current process. This function is used primarily to implement the <a class="link-man" href="../html2/fork.html">fork(2)</a>, <a class="link-man" href="../html3/__tfork.html">__tfork(3)</a>, <a class="link-man" href="../html2/vfork.html">vfork(2)</a> system calls, as well as the <a class="link-man" href="../html9/kthread_create.html">kthread_create(9)</a> function.<div class="spacer">
</div>
The <i class="arg">flags</i> argument is used to control the behavior of the fork and is created by a bitwise-OR of the following values:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">FORK_FORK</span></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
The call is done by the <a class="link-man" href="../html2/fork.html">fork(2)</a> system call. Used only for statistics.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">FORK_VFORK</span></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
The call is done by the <a class="link-man" href="../html2/vfork.html">vfork(2)</a> system call. Used only for statistics.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">FORK_TFORK</span></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
The call is done by the <a class="link-man" href="../html3/__tfork.html">__tfork(3)</a> system call. Used only for statistics.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">FORK_PPWAIT</span></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
Suspend the parent process until the child is terminated (by calling <a class="link-man" href="../html2/_exit.html">_exit(2)</a> or abnormally), or makes a call to <a class="link-man" href="../html2/execve.html">execve(2)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">FORK_SHAREFILES</span></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
Let the child share the file descriptor table with the parent through fdshare(). The default behavior is to copy the table through fdcopy().</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">FORK_IDLE</span></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
The child will be left in the <span class="define">SIDL</span> state. The default behavior is to make it runnable and add it to the run queue.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">FORK_NOZOMBIE</span></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
The child will be dissociated from the parent and will not leave a status for the parent to collect. See <a class="link-man" href="../html2/wait.html">wait(2)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">FORK_SHAREVM</span></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
The child will share the parent's address space. The default behavior is that the child gets a copy-on-write copy of the address space.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">FORK_SIGHAND</span></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
The child will share the parent's signal actions, including the handler, mask, and flags, with sigactsshare(). The default behavior is to copy the signal actions from the parent with sigactsinit(). <span class="define">FORK_SHAREVM</span> must also be set.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">FORK_PTRACE</span></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
The child will start with tracing enabled, as if ptrace(PT_TRACE_ME, 0, 0, 0) had been invoked in the child.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">FORK_THREAD</span></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
The child will instead be a kernel-level thread in the same process as the parent. <span class="define">FORK_SHAREFILES</span>, <span class="define">FORK_SHAREVM</span>, and <span class="define">FORK_SIGHAND</span> must also be set.</dd>
</dl>
<div class="spacer">
</div>
If <i class="farg">stack</i> is not <span class="define">NULL</span>, it will be used as the initial value of the child's stack pointer, instead of using the child's copy of the parent's stack.<div class="spacer">
</div>
If <i class="farg">tidptr</i> is not <span class="define">NULL</span>, the PID of the child process will be written there in the parent on success. This is guaranteed to be done before the child process is started.<div class="spacer">
</div>
If <i class="farg">retval</i> is not <span class="define">NULL</span>, it will hold the following values after successful completion of the fork operation:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">retval[0]</i></dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
This will contain the PID of the child process.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">retval[1]</i></dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
In the parent process, this will contain the value 0. In the child process, this will contain 1.</dd>
</dl>
<div class="spacer">
</div>
If <i class="farg">func</i> is not <span class="define">NULL</span>, the new process will begin execution by calling this function. It defaults to child_return, which returns to userland.<div class="spacer">
</div>
If <i class="farg">arg</i> is not <span class="define">NULL</span>, it is the argument to the previous function. It defaults to a pointer to the new process.<div class="spacer">
</div>
The newly created process is returned through <i class="farg">*rnewprocp</i>.</div>
<div class="section">
<h1 id="x52455455524e2056414c554553">RETURN VALUES</h1> Upon successful completion of the fork operation, <b class="fname">fork1</b>() returns 0. Otherwise, the following error values are returned:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">EAGAIN</span>]</dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
The limit on the total number of system processes would be exceeded.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">EAGAIN</span>]</dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
The limit <span class="define">RLIMIT_NPROC</span> on the total number of processes under execution by this user id would be exceeded.</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html2/execve.html">execve(2)</a>, <a class="link-man" href="../html2/fork.html">fork(2)</a>, <a class="link-man" href="../html2/vfork.html">vfork(2)</a>, <a class="link-man" href="../html3/__tfork.html">__tfork(3)</a>, <a class="link-man" href="../html9/kthread_create.html">kthread_create(9)</a>, <a class="link-man" href="../html9/pfind.html">pfind(9)</a>, <a class="link-man" href="../html9/psignal.html">psignal(9)</a></div>
<div class="section">
<h1 id="x43415645415453">CAVEATS</h1> The <b class="name">fork1</b> function semantics are specific to <span class="unix">OpenBSD</span>. Other <span class="unix">BSD</span> systems have different semantics.</div>
</div>
</body>
</html>

