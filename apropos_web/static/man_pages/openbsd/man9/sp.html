<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
SPLX(9)</title>
</head>
<body>
<div class="mandoc">
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">splhigh</b>, <b class="name">splserial</b>, <b class="name">splsched</b>, <b class="name">splclock</b>, <b class="name">splstatclock</b>, <b class="name">splvm</b>, <b class="name">spltty</b>, <b class="name">splsofttty</b>, <b class="name">splnet</b>, <b class="name">splbio</b>, <b class="name">splsoftnet</b>, <b class="name">splsoftclock</b>, <b class="name">spllowersoftclock</b>, <b class="name">spl0</b>, <b class="name">splx</b>, <b class="name">splassert</b> &#8212; <span class="desc">modify system interrupt priority level</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">machine/intr.h</a>&gt;</b><div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">splhigh</b>(<i class="farg" style="white-space:nowrap;">void</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">splserial</b>(<i class="farg" style="white-space:nowrap;">void</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">splsched</b>(<i class="farg" style="white-space:nowrap;">void</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">splclock</b>(<i class="farg" style="white-space:nowrap;">void</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">splstatclock</b>(<i class="farg" style="white-space:nowrap;">void</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">splvm</b>(<i class="farg" style="white-space:nowrap;">void</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">spltty</b>(<i class="farg" style="white-space:nowrap;">void</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">splsofttty</b>(<i class="farg" style="white-space:nowrap;">void</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">splnet</b>(<i class="farg" style="white-space:nowrap;">void</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">splbio</b>(<i class="farg" style="white-space:nowrap;">void</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">splsoftnet</b>(<i class="farg" style="white-space:nowrap;">void</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">splsoftclock</b>(<i class="farg" style="white-space:nowrap;">void</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">spllowersoftclock</b>(<i class="farg" style="white-space:nowrap;">void</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">spl0</b>(<i class="farg" style="white-space:nowrap;">void</i>);<div class="spacer">
</div>
<i class="ftype">void</i><br/>
<b class="fname">splx</b>(<i class="farg" style="white-space:nowrap;">int s</i>);<div class="spacer">
</div>
<i class="ftype">void</i><br/>
<b class="fname">splassert</b>(<i class="farg" style="white-space:nowrap;">int s</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> These functions raise and lower the system priority level. They are used by kernel code to block interrupts with priority less than or equal to the named level (i.e., <b class="fname">spltty</b>() blocks interrupts of priority less than or equal to <span class="define">IPL_TTY</span>). The code may then safely access variables and data structures which are used by kernel code that runs at an equal or lower priority level.<div class="spacer">
</div>
An <b class="name">splhigh</b> function exists for each distinct priority level which can exist in the system. These macros and the corresponding priority levels are used for various defined purposes, and may be divided into two main types: hard and soft. Hard interrupts are generated by hardware devices, while soft interrupts are generated by callouts and called from the kernel's periodic timer interrupt service routine.<div class="spacer">
</div>
In order of highest to lowest priority, the priority-raising macros are:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">splhigh</b>()</dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
blocks all hard and soft interrupts. It is used for code that cannot tolerate any interrupts, like hardware context switching code and the <a class="link-man" href="../html4/ddb.html">ddb(4)</a> in-kernel debugger.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">splserial</b>()</dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
blocks hard interrupts from serial interfaces. Code running at this level may not access the tty subsystem.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">splsched</b>()</dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
blocks interrupts that may access scheduler data structures. Specifically the clock interrupt that invokes the <b class="fname">schedclock</b>() function needs to be blocked. On some systems this is a separate clock; on others it is the same as the statistics clock and, on these, <b class="fname">splsched</b>() must block everything that <b class="fname">splstatclock</b>() does. Code running at or above this level may not call <a class="link-man" href="../html9/tsleep.html">tsleep(9)</a> or <a class="link-man" href="../html9/wakeup.html">wakeup(9)</a>, nor may it post signals. Note that &quot;running&quot; means invoked by an interrupt handler that operates at this level or higher. Kernel code that operates in the context of a process and has called <b class="fname">splhigh</b>() for blocking purposes can use <a class="link-man" href="../html9/tsleep.html">tsleep(9)</a> or <a class="link-man" href="../html9/wakeup.html">wakeup(9)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">splclock</b>()</dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
blocks the hardware clock interrupt. It is used by <b class="fname">hardclock</b>() to update kernel and process times, and must be used by any other code that accesses time-related data.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">splstatclock</b>()</dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
blocks the hardware statistics clock interrupt. It is used by <b class="fname">statclock</b>() to update kernel profiling and other statistics, and must be used by any code that accesses that data. This level is identical to <b class="fname">splclock</b>() if there is no separate statistics clock.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">splvm</b>()</dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
blocks hard interrupts from all devices that are allowed to use the kernel <a class="link-man" href="../html9/malloc.html">malloc(9)</a>. That includes all disk, network, and tty device interrupts.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">spltty</b>()</dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
blocks hard interrupts from TTY devices.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">splsofttty</b>()</dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
blocks soft interrupts generated by serial devices.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">splnet</b>()</dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
blocks hard interrupts from network interfaces.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">splbio</b>()</dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
blocks hard interrupts from disks and other mass-storage devices.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">splsoftnet</b>()</dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
blocks soft network interrupts.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">splsoftclock</b>()</dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
blocks soft clock interrupts.</dd>
</dl>
<div class="spacer">
</div>
Two macros lower the system priority level. They are:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">spllowersoftclock</b>()</dt>
<dd class="list-tag" style="margin-left: 19.00ex;">
unblocks all interrupts but the soft clock interrupt.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">spl0</b>()</dt>
<dd class="list-tag" style="margin-left: 19.00ex;">
unblocks all interrupts.</dd>
</dl>
<div class="spacer">
</div>
The <b class="fname">splx</b>() macro restores the system priority level to the one encoded in <i class="farg">s</i>, which must be a value previously returned by one of the other <b class="name">splhigh</b> macros.<div class="spacer">
</div>
The <b class="fname">splassert</b>() function checks that the system is running at a certain priority level. The argument <i class="farg">s</i> should be one of these constants:<div class="spacer">
</div>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 6.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">IPL_STATCLOCK</span></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">IPL_SCHED</span></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">IPL_CLOCK</span></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">IPL_VM</span></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">IPL_BIO</span></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">IPL_TTY</span></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">IPL_NET</span></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">IPL_SOFTNET</span></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">IPL_SOFTCLOCK</span></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">IPL_NONE</span></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
</dd>
</dl>
<div class="spacer">
</div>
The <b class="fname">splassert</b>() function is optional and is not necessarily implemented on all architectures nor enabled in all kernel configurations. It checks the current system priority level to see if it's at least at the level specified in the argument <i class="farg">s</i>. If possible, it also checks if it hasn't been called from an interrupt handler with a level higher than the one requested, which must be an error (if some code is protected from <span class="define">IPL_SOFTNET</span> interrupts, but accessed from an <span class="define">IPL_NET</span> interrupt, it must be a design error in the code).<div class="spacer">
</div>
The behavior of the <b class="fname">splassert</b>() function is controlled by the kern.splassert <a class="link-man" href="../html8/sysctl.html">sysctl(8)</a>. Valid values for it are:<div class="spacer">
</div>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 6.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
0</dt>
<dd class="list-tag" style="margin-left: 3.00ex;">
disable error checking</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
1</dt>
<dd class="list-tag" style="margin-left: 3.00ex;">
print a message if an error is detected</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
2</dt>
<dd class="list-tag" style="margin-left: 3.00ex;">
print a message and a stack trace if possible</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
3</dt>
<dd class="list-tag" style="margin-left: 3.00ex;">
like 2 but also drop into the kernel debugger</dd>
</dl>
<div class="spacer">
</div>
Any other value causes a system panic on errors.</div>
</div>
</body>
</html>

