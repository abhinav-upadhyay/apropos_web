<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
VOP_LOOKUP(9)</title>
</head>
<body>
<div class="mandoc">
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">VOP_LOOKUP</b>, <b class="name">VOP_ABORTOP</b>, <b class="name">VOP_ACCESS</b>, <b class="name">VOP_ADVLOCK</b>, <b class="name">VOP_BMAP</b>, <b class="name">VOP_BWRITE</b>, <b class="name">VOP_CLOSE</b>, <b class="name">VOP_CREATE</b>, <b class="name">VOP_FSYNC</b>, <b class="name">VOP_GETATTR</b>, <b class="name">VOP_INACTIVE</b>, <b class="name">VOP_IOCTL</b>, <b class="name">VOP_ISLOCKED</b>, <b class="name">VOP_KQFILTER</b>, <b class="name">VOP_LINK</b>, <b class="name">VOP_LOCK</b>, <b class="name">VOP_MKDIR</b>, <b class="name">VOP_MKNOD</b>, <b class="name">VOP_OPEN</b>, <b class="name">VOP_PATHCONF</b>, <b class="name">VOP_POLL</b>, <b class="name">VOP_PRINT</b>, <b class="name">VOP_READ</b>, <b class="name">VOP_READDIR</b>, <b class="name">VOP_READLINK</b>, <b class="name">VOP_RECLAIM</b>, <b class="name">VOP_REMOVE</b>, <b class="name">VOP_RENAME</b>, <b class="name">VOP_REVOKE</b>, <b class="name">VOP_RMDIR</b>, <b class="name">VOP_SETATTR</b>, <b class="name">VOP_STRATEGY</b>, <b class="name">VOP_SYMLINK</b>, <b class="name">VOP_UNLOCK</b>, <b class="name">VOP_WRITE</b> &#8212; <span class="desc">vnode operations</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">sys/vnode.h</a>&gt;</b><div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">VOP_ABORTOP</b>(<i class="farg">struct vnode *dvp</i>, <i class="farg">struct componentname *cnp</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">VOP_ACCESS</b>(<i class="farg">struct vnode *vp</i>, <i class="farg">int mode</i>, <i class="farg">struct ucred *cred</i>, <i class="farg">struct proc *p</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">VOP_ADVLOCK</b>(<i class="farg">struct vnode *vp</i>, <i class="farg">void *id</i>, <i class="farg">int op</i>, <i class="farg">struct flock *fl</i>, <i class="farg">int flags</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">VOP_BMAP</b>(<i class="farg">struct vnode *vp</i>, <i class="farg">daddr_t bn</i>, <i class="farg">struct vnode **vpp</i>, <i class="farg">daddr_t *bnp</i>, <i class="farg">int *runp</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">VOP_BWRITE</b>(<i class="farg">struct buf *bp</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">VOP_CLOSE</b>(<i class="farg">struct vnode *vp</i>, <i class="farg">int fflag</i>, <i class="farg">struct ucred *cred</i>, <i class="farg">struct proc *p</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">VOP_CREATE</b>(<i class="farg">struct vnode *dvp</i>, <i class="farg">struct vnode **vpp</i>, <i class="farg">struct componentname *cnp</i>, <i class="farg">struct vattr *vap</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">VOP_FSYNC</b>(<i class="farg">struct vnode *vp</i>, <i class="farg">struct ucred *cred</i>, <i class="farg">int waitfor</i>, <i class="farg">struct proc *p</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">VOP_GETATTR</b>(<i class="farg">struct vnode *vp</i>, <i class="farg">struct vattr *vap</i>, <i class="farg">struct ucred *cred</i>, <i class="farg">struct proc *p</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">VOP_INACTIVE</b>(<i class="farg">struct vnode *vp</i>, <i class="farg">struct proc *p</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">VOP_IOCTL</b>(<i class="farg">struct vnode *vp</i>, <i class="farg">u_long command</i>, <i class="farg">void *data</i>, <i class="farg">int fflag</i>, <i class="farg">struct ucred *cred</i>, <i class="farg">struct proc *p</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">VOP_ISLOCKED</b>(<i class="farg">struct vnode *vp</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">VOP_KQFILTER</b>(<i class="farg">struct vnode *vp</i>, <i class="farg">struct knote *kn</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">VOP_LINK</b>(<i class="farg">struct vnode *dvp</i>, <i class="farg">struct vnode *vp</i>, <i class="farg">struct componentname *cnp</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">VOP_LOCK</b>(<i class="farg">struct vnode *vp</i>, <i class="farg">int flags</i>, <i class="farg">struct proc *p</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">VOP_LOOKUP</b>(<i class="farg">struct vnode *dvp</i>, <i class="farg">struct vnode **vpp</i>, <i class="farg">struct componentname *cnp</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">VOP_MKDIR</b>(<i class="farg">struct vnode *dvp</i>, <i class="farg">struct vnode **vpp</i>, <i class="farg">struct componentname *cnp</i>, <i class="farg">struct vattr *vap</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">VOP_MKNOD</b>(<i class="farg">struct vnode *dvp</i>, <i class="farg">struct vnode **vpp</i>, <i class="farg">struct componentname *cnp</i>, <i class="farg">struct vattr *vap</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">VOP_OPEN</b>(<i class="farg">struct vnode *vp</i>, <i class="farg">int mode</i>, <i class="farg">struct ucred *cred</i>, <i class="farg">struct proc *p</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">VOP_PATHCONF</b>(<i class="farg">struct vnode *vp</i>, <i class="farg">int name</i>, <i class="farg">register_t *retval</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">VOP_POLL</b>(<i class="farg">struct vnode *vp</i>, <i class="farg">int fflag</i>, <i class="farg">int events</i>, <i class="farg">struct proc *p</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">VOP_PRINT</b>(<i class="farg">struct vnode *vp</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">VOP_READ</b>(<i class="farg">struct vnode *vp</i>, <i class="farg">struct uio *uio</i>, <i class="farg">int ioflag</i>, <i class="farg">struct ucred *cred</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">VOP_READDIR</b>(<i class="farg">struct vnode *vp</i>, <i class="farg">struct uio *uio</i>, <i class="farg">struct ucred *cred</i>, <i class="farg">int *eofflag</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">VOP_READLINK</b>(<i class="farg">struct vnode *vp</i>, <i class="farg">struct uio *uio</i>, <i class="farg">struct ucred *cred</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">VOP_RECLAIM</b>(<i class="farg">struct vnode *vp</i>, <i class="farg">struct proc *p</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">VOP_REMOVE</b>(<i class="farg">struct vnode *dvp</i>, <i class="farg">struct vnode *vp</i>, <i class="farg">struct componentname *cnp</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">VOP_RENAME</b>(<i class="farg">struct vnode *fdvp</i>, <i class="farg">struct vnode *fvp</i>, <i class="farg">struct componentname *fcnp</i>, <i class="farg">struct vnode *tdvp</i>, <i class="farg">struct vnode *tvp</i>, <i class="farg">struct componentname *tcnp</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">VOP_REVOKE</b>(<i class="farg">struct vnode *vp</i>, <i class="farg">int flags</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">VOP_RMDIR</b>(<i class="farg">struct vnode *dvp</i>, <i class="farg">struct vnode *vp</i>, <i class="farg">struct componentname *cnp</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">VOP_SETATTR</b>(<i class="farg">struct vnode *vp</i>, <i class="farg">struct vattr *vap</i>, <i class="farg">struct ucred *cred</i>, <i class="farg">struct proc *p</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">VOP_STRATEGY</b>(<i class="farg">struct buf *bp</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">VOP_SYMLINK</b>(<i class="farg">struct vnode *dvp</i>, <i class="farg">struct vnode **vpp</i>, <i class="farg">struct componentname *cnp</i>, <i class="farg">struct vattr *vap</i>, <i class="farg">char *target</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">VOP_UNLOCK</b>(<i class="farg">struct vnode *vp</i>, <i class="farg">struct proc *p</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">VOP_WRITE</b>(<i class="farg">struct vnode *vp</i>, <i class="farg">struct uio *uio</i>, <i class="farg">int ioflag</i>, <i class="farg">struct ucred *cred</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="name">VOP</b> functions implement a generic way to perform operations on vnodes. The VOP function called passes the arguments to the correct file system specific function. Not all file systems implement all operations, in which case a generic method will be used. These functions exist to provide an abstract method to invoke vnode operations without needing to know anything about the underlying file system. Many system calls map directly to a specific VOP function.<div class="spacer">
</div>
The arguments for each VOP function consist of one or more vnode pointers along with other data needed to perform the operation. Care must be taken to obey the vnode locking discipline when using VOP functions. Many VOP calls take a <span class="type">struct proc *p</span> argument. This should be the current process. VOP calls are not safe to call in an interrupt context.<div class="spacer">
</div>
The <span class="type">vattr</span> structure used by <b class="fname">VOP_CREATE</b>(), <b class="fname">VOP_GETATTR</b>(), <b class="fname">VOP_MKDIR</b>(), <b class="fname">VOP_MKNOD</b>(), <b class="fname">VOP_SETATTR</b>(), and <b class="fname">VOP_SYMLINK</b>() is:<div class="spacer">
</div>
<pre style="margin-left: 0.00ex;" class="lit display">
struct vattr { 
	enum vtype      va_type;      /* vnode type */ 
	mode_t          va_mode;      /* files access mode and type */ 
	nlink_t         va_nlink;     /* number of references */ 
	uid_t           va_uid;       /* owner user id */ 
	gid_t           va_gid;       /* owner group id */ 
	long            va_fsid;      /* file system id */ 
	long            va_fileid;    /* file id */ 
	u_quad_t        va_size;      /* file size in bytes */ 
	long            va_blocksize; /* blocksize preferred for i/o */ 
	struct timespec va_atime;     /* time of last access */ 
	struct timespec va_mtime;     /* time of last modification */ 
	struct timespec va_ctime;     /* time file changed */ 
	u_long          va_gen;       /* generation number of file */ 
	u_long          va_flags;     /* flags defined for file */ 
	dev_t           va_rdev;      /* device the vnode represents */ 
	u_quad_t        va_bytes;     /* bytes of held disk space */ 
	u_quad_t        va_filerev;   /* file modification number */ 
	u_int           va_vaflags;   /* operations flags */ 
	long            va_spare;     /* remain quad aligned */ 
};</pre>
<div class="spacer">
</div>
The following sections comment on the VOP functions from the consumer's perspective.<div class="spacer">
</div>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="fname">VOP_ABORTOP</b>(<i class="farg">dvp</i>, <i class="farg">cnp</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Abort any asynchronous operations pending on the vnode <i class="farg">dvp</i> associated with the path name <i class="farg">cnp</i>. This is mostly used by internal VFS code and should not be needed by file system implementors.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="fname">VOP_ACCESS</b>(<i class="farg">vp</i>, <i class="farg">mode</i>, <i class="farg">cred</i>, <i class="farg">p</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Determine if the locked vnode <i class="farg">vp</i> can be accessed by the calling process <i class="farg">p</i> with credentials <i class="farg">cred</i> for the given access <i class="farg">mode</i>.<div class="spacer">
</div>
<i class="farg">mode</i> may contain any of the following values:<div class="spacer">
</div>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 6.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">VWRITE</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
check writeability</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">VREAD</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
check readability</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">VEXEC</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
check executability</dd>
</dl>
<div class="spacer">
</div>
If the access check succeeds, zero is returned; otherwise, an appropriate error code is returned.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="fname">VOP_ADVLOCK</b>(<i class="farg">vp</i>, <i class="farg">id</i>, <i class="farg">op</i>, <i class="farg">fl</i>, <i class="farg">flags</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Perform advisory locking on the vnode <i class="farg">vp</i> according to the operation <i class="farg">op</i> and lock specification <i class="farg">fl</i>. <i class="farg">id</i> identifies the resource holding the lock (typically a pointer to the holding process).<div class="spacer">
</div>
<i class="farg">op</i> may be one of the following operations:<div class="spacer">
</div>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 6.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">F_GETLK</span></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Get the first lock that would block a lock request.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">F_SETLK</span></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Set a lock.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">F_UNLCK</span></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Release a lock.</dd>
</dl>
<div class="spacer">
</div>
<i class="farg">flags</i> may contain the following flags:<div class="spacer">
</div>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 6.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">F_WAIT</span></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
If required, block waiting to obtain an exclusive lock.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">F_POSIX</span></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Follow POSIX locking semantics; see <a class="link-man" href="../html2/fcntl.html">fcntl(2)</a>.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">F_FLOCK</span></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Follow <a class="link-man" href="../html2/flock.html">flock(2)</a> locking semantics.</dd>
</dl>
<div class="spacer">
</div>
Upon success, zero is returned; otherwise, an appropriate error code is returned.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="fname">VOP_BMAP</b>(<i class="farg">vp</i>, <i class="farg">bn</i>, <i class="farg">vpp</i>, <i class="farg">bnp</i>, <i class="farg">runp</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Convert the logical block number <i class="farg">bn</i> of the file the locked vnode <i class="farg">vp</i> is associated with its physical number on-disk. The physical block number is stored in <i class="farg">*bnp</i> on return. <i class="farg">vpp</i>, if <code class="none">non-</code><span class="define">NULL</span>, will be updated to point to the vnode of the block device of which <i class="farg">vp</i> is associated. <i class="farg">runp</i>, if <code class="none">non-</code><span class="define">NULL</span>, will be updated to the number of contiguous disk blocks following <i class="farg">*bnp</i>. Upon success, zero is returned; otherwise, an appropriate error code is returned.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="fname">VOP_BWRITE</b>(<i class="farg">bp</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Write a file system buffer to disk. Upon success, zero is returned; otherwise, an appropriate error code is returned.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="fname">VOP_CLOSE</b>(<i class="farg">vp</i>, <i class="farg">fflag</i>, <i class="farg">cred</i>, <i class="farg">p</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Close the file associated with the locked vnode <i class="farg">vp</i> with file flags <i class="farg">fflag</i> by the calling process <i class="farg">p</i> with credentials <i class="farg">cred</i>. This operation should be performed only when the file is no longer being used. Upon success, zero is returned; otherwise, an appropriate error code is returned.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="fname">VOP_CREATE</b>(<i class="farg">dvp</i>, <i class="farg">vpp</i>, <i class="farg">cnp</i>, <i class="farg">vap</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Create a new directory entry for a regular file in the directory <i class="farg">dvp</i> and return a locked, referenced vnode in <i class="farg">vpp</i>. The file name is in <i class="farg">cnp</i> and its permissions will be <i class="farg">vap</i>.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="fname">VOP_FSYNC</b>(<i class="farg">vp</i>, <i class="farg">cred</i>, <i class="farg">waitfor</i>, <i class="farg">p</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Flush any dirty buffers associated with <i class="farg">vp</i> to disk. The vnode is locked on entry and exit. <i class="farg">waitfor</i> can be set to <span class="define">MNT_WAIT</span> to indicate that <b class="fname">VOP_FSYNC</b>() should not return until all data is written.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="fname">VOP_GETATTR</b>(<i class="farg">vp</i>, <i class="farg">vap</i>, <i class="farg">cred</i>, <i class="farg">p</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="fname">VOP_SETATTR</b>(<i class="farg">vp</i>, <i class="farg">vap</i>, <i class="farg">cred</i>, <i class="farg">p</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Access the vnode attributes <i class="farg">vap</i> of the vnode <i class="farg">vp</i> by the calling process <i class="farg">p</i> with credentials <i class="farg">cred</i>. <b class="fname">VOP_SETATTR</b>() requires that <i class="farg">vp</i> be locked. A field value for any member of <i class="farg">vap</i> of <span class="define">VNOVAL</span> represents that the information could not be obtained by <b class="fname">VOP_GETATTR</b>() or should not be changed by <b class="fname">VOP_SETATTR</b>(). Upon success of obtaining or changing the attributes, zero is returned; otherwise, an appropriate error code is returned. All attributes are held in the <span class="type">vattr</span> structure shown above.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="fname">VOP_INACTIVE</b>(<i class="farg">vp</i>, <i class="farg">p</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Notify the underlying file system that the locked vnode <i class="farg">vp</i> is no longer in use. The vnode will be unlocked upon return. <i class="farg">p</i> specifies the calling process. This may happen when the vnode reference count reaches zero or when the underlying file system has disappeared or has been forcibly unmounted.<div class="spacer">
</div>
Typically, the underlying file system will write any buffers associated with <i class="farg">vp</i> to disk or delete the file entry, if need be. The underlying file system may not necessarily release any buffers associated with <i class="farg">vp</i> so that it can be immediately reactivated in case the file is used again. Upon success, zero is returned; otherwise, an appropriate error code is returned.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="fname">VOP_IOCTL</b>(<i class="farg">vp</i>, <i class="farg">command</i>, <i class="farg">data</i>, <i class="farg">fflag</i>, <i class="farg">cred</i>, <i class="farg">p</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Perform the control operation <i class="farg">command</i> with additional information <i class="farg">data</i> on the vnode <i class="farg">vp</i>, normally associated with a device, with file flags <i class="farg">fflag</i> by the calling process <i class="farg">p</i> with credentials <i class="farg">cred</i>. Upon success, zero is returned; otherwise, an appropriate error code is returned.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="fname">VOP_ISLOCKED</b>(<i class="farg">vp</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="fname">VOP_LOCK</b>(<i class="farg">vp</i>, <i class="farg">flags</i>, <i class="farg">p</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="fname">VOP_UNLOCK</b>(<i class="farg">vp</i>, <i class="farg">p</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
<b class="fname">VOP_LOCK</b>() is used internally by <a class="link-man" href="../html9/vn_lock.html">vn_lock(9)</a> to lock a vnode. It should not be used by other file system code. <b class="fname">VOP_UNLOCK</b>() unlocks a vnode. <b class="fname">VOP_ISLOCKED</b>() returns 1 if <i class="farg">vp</i> is locked and 0 if not. It should be used cautiously, as not all file systems implement locks effectively. Note the asymmetry between <a class="link-man" href="../html9/vn_lock.html">vn_lock(9)</a> and <b class="fname">VOP_UNLOCK</b>().<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="fname">VOP_KQFILTER</b>(<i class="farg">vp</i>, <i class="farg">kn</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Register the <a class="link-man" href="../html9/knote.html">knote(9)</a> filtering information <i class="farg">kn</i> for the vnode <i class="farg">vp</i>. Only filters for <span class="define">EVFILT_READ</span>, <span class="define">EVFILT_WRITE</span>, and <span class="define">EVFILT_VNODE</span> will invoke this operation. Upon success, zero is returned; otherwise, a non-zero value is returned.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="fname">VOP_LINK</b>(<i class="farg">dvp</i>, <i class="farg">vp</i>, <i class="farg">cnp</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Increase the link count for the vnode <i class="farg">vp</i>. A new entry with name <i class="farg">cnp</i> should be added to the directory <i class="farg">dvp</i>. <i class="farg">dvp</i> is locked on entry and unlocked on exit.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="fname">VOP_LOOKUP</b>(<i class="farg">dvp</i>, <i class="farg">vpp</i>, <i class="farg">cnp</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Find the file corresponding to the name <i class="farg">cnp</i> in the directory <i class="farg">dvp</i> and return a vnode in <i class="farg">vpp</i>. <i class="farg">dvp</i> is locked on entry and exit, and <i class="farg">vpp</i> is locked upon a successful return. <i class="farg">vpp</i> will be <span class="define">NULL</span> on error, and <i class="farg">cnp-&gt;cn_flags</i> will be set to <span class="define">PDIRUNLOCK</span> if <i class="farg">dvp</i> has been unlocked for an unsuccessful return.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="fname">VOP_MKDIR</b>(<i class="farg">dvp</i>, <i class="farg">vpp</i>, <i class="farg">cnp</i>, <i class="farg">vap</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Create a new directory named by <i class="farg">cnp</i> with permissions <i class="farg">vattr</i> in the directory <i class="farg">dvp</i>. On success, the new vnode is returned locked in <i class="farg">vpp</i>. <i class="farg">dvp</i> must be locked on entry and is unlocked on exit.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="fname">VOP_MKNOD</b>(<i class="farg">dvp</i>, <i class="farg">vpp</i>, <i class="farg">cnp</i>, <i class="farg">vap</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Create a device special file with name <i class="farg">cnp</i> and attributes <i class="farg">vap</i> in the directory associated with the locked vnode <i class="farg">dvp</i>. <i class="farg">dvp</i> will be unlocked on return (see <a class="link-man" href="../html9/vput.html">vput(9)</a>). A pointer to the new, locked vnode will be returned in <i class="farg">*vpp</i> if <i class="farg">vpp</i> is not <span class="define">NULL</span>. Upon success, zero is returned; otherwise, an appropriate error code is returned.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="fname">VOP_OPEN</b>(<i class="farg">vp</i>, <i class="farg">mode</i>, <i class="farg">cred</i>, <i class="farg">p</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Open the file associated with the vnode <i class="farg">vp</i> with the access modes <i class="farg">mode</i> by the calling process <i class="farg">p</i> with credentials <i class="farg">cred</i>. <i class="farg">mode</i> takes the flags described in <a class="link-man" href="../html2/open.html">open(2)</a>.<div class="spacer">
</div>
For some underlying file systems, access permissions for the file by the process are checked; for others, this is a no-op. In any case, this must be called before a process can access the file. Upon success, zero is returned; otherwise, an appropriate error code is returned.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="fname">VOP_PATHCONF</b>(<i class="farg">vp</i>, <i class="farg">name</i>, <i class="farg">retval</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Obtain the value of the applicable POSIX configurable pathname variable (see <a class="link-man" href="../html2/pathconf.html">pathconf(2)</a>) specified by <i class="farg">name</i> from the locked vnode <i class="farg">vp</i>. The result is placed in <i class="farg">*retval</i>. Upon success, zero is returned; otherwise, an appropriate error code is returned.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="fname">VOP_POLL</b>(<i class="farg">vp</i>, <i class="farg">fflag</i>, <i class="farg">events</i>, <i class="farg">p</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Determine whether the vnode <i class="farg">vp</i> is ready to perform the operations specified by <i class="farg">events</i> (see <a class="link-man" href="../html2/poll.html">poll(2)</a>) with file flags <i class="farg">fflag</i> for the calling process <i class="farg">p</i>. The <b class="fname">selrecord</b>() routine may be used to detect selection collisions for multiple processes sleeping on the same file, waiting for I/O to become possible, although all file systems currently assume that I/O is always possible. The return value specifies which operations from <i class="farg">events</i> were found to be ready, which may be performed without the need for blocking.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="fname">VOP_PRINT</b>(<i class="farg">vp</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Print information about the vnode to the kernel message buffer. It is not used normally, but exists only for debugging purposes.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="fname">VOP_READ</b>(<i class="farg">vp</i>, <i class="farg">uio</i>, <i class="farg">ioflag</i>, <i class="farg">cred</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Copy data from the locked vnode <i class="farg">vp</i> to the buffers specified by <i class="farg">uio</i> with calling process credentials <i class="farg">cred</i>.<div class="spacer">
</div>
<i class="farg">ioflag</i> may contain the following flags:<div class="spacer">
</div>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 6.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">IO_NDELAY</span></dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
Non-blocking I/O.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">IO_UNIT</span></dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
Do I/O as an atomic unit.</dd>
</dl>
<div class="spacer">
</div>
Upon success, zero is returned; otherwise, an appropriate error code is returned.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="fname">VOP_READDIR</b>(<i class="farg">vp</i>, <i class="farg">uio</i>, <i class="farg">cred</i>, <i class="farg">eofflag</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Read the contents of the directory associated with the locked vnode <i class="farg">vp</i>, usually via <b class="fname">VOP_READ</b>(), and convert its file-system-specific format to that expected by the <a class="link-man" href="../html2/getdents.html">getdents(2)</a> system call, storing the result into the buffers specified by <i class="farg">uio</i>. <i class="farg">cred</i> specifies the credentials of the calling process. <i class="farg">*eofflag</i> is set to a non-zero value on return once successful end-of-file for the directory contents has been reached.<div class="spacer">
</div>
Upon success, zero is returned; otherwise, an appropriate error code is returned.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="fname">VOP_READLINK</b>(<i class="farg">vp</i>, <i class="farg">uio</i>, <i class="farg">cred</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Read a symbolic link and return the target's name in <i class="farg">uio</i>. <i class="farg">vp</i> is locked on entry and exit and must be a symlink.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="fname">VOP_RECLAIM</b>(<i class="farg">vp</i>, <i class="farg">p</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Used by <a class="link-man" href="../html9/vclean.html">vclean(9)</a> so that the file system has an opportunity to free memory and perform any other cleanup activity related to <i class="farg">vp</i>. <i class="farg">vp</i> is unlocked on entry and exit. <b class="fname">VOP_RECLAIM</b>() should not be used by generic code.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="fname">VOP_REMOVE</b>(<i class="farg">dvp</i>, <i class="farg">vp</i>, <i class="farg">cnp</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Remove the link named <i class="farg">cnp</i> from the directory <i class="farg">dvp</i>. This file corresponds to the vnode <i class="farg">vp</i>. Both <i class="farg">dvp</i> and <i class="farg">vp</i> are locked on entry and unlocked on exit, and each has its reference count decremented by one. <b class="fname">VOP_REMOVE</b>() does not delete the file from disk unless its link count becomes zero (for file systems which support multiple links).<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="fname">VOP_RENAME</b>(<i class="farg">fdvp</i>, <i class="farg">fvp</i>, <i class="farg">fcnp</i>, <i class="farg">tdvp</i>, <i class="farg">tvp</i>, <i class="farg">tcnp</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Remove the link to the file with associated vnode <i class="farg">fvp</i> and name <i class="farg">fcnp</i> in the directory with associated vnode <i class="farg">fdvp</i>, and create a new link to the file with name <i class="farg">tcnp</i> (and associated locked vnode <i class="farg">tvp</i>, if the file already exists) residing in the directory with the associated locked vnode <i class="farg">tdvp</i>. <i class="farg">fdvp</i>, <i class="farg">fvp</i>, and <i class="farg">tvp</i> (if not <span class="define">NULL</span>) will be released (see <a class="link-man" href="../html9/vrele.html">vrele(9)</a>) and <i class="farg">tdvp</i> will have its reference count decremented (see <a class="link-man" href="../html9/vput.html">vput(9)</a>) on return. If not <span class="define">NULL</span>, <i class="farg">tvp</i> will be locked on return as well. Upon success, zero is returned; otherwise, an appropriate error code is returned.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="fname">VOP_REVOKE</b>(<i class="farg">vp</i>, <i class="farg">flags</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Used by the <a class="link-man" href="../html2/revoke.html">revoke(2)</a> system call to prevent any further access to a vnode. The vnode ops will be changed to those of deadfs, which returns only errors. <i class="arg">vp</i> must be unlocked.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="fname">VOP_RMDIR</b>(<i class="farg">dvp</i>, <i class="farg">vp</i>, <i class="farg">cnp</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Remove the directory <i class="farg">vp</i> from the directory <i class="farg">dvp</i>. Both are locked on entry and unlocked on exit. The name of the directory for removal is additionally contained in <i class="farg">cnp</i>.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="fname">VOP_STRATEGY</b>(<i class="farg">bp</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Call the appropriate strategy function for the device backing the buffer's vnode.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="fname">VOP_SYMLINK</b>(<i class="farg">dvp</i>, <i class="farg">vpp</i>, <i class="farg">cnp</i>, <i class="farg">vap</i>, <i class="farg">target</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Create a symbolic link with name <i class="farg">cnp</i> in the directory <i class="farg">dvp</i> with mode <i class="farg">vap</i>. The link will point to <i class="farg">target</i> and a vnode for it is returned in <i class="farg">vpp</i>. The directory vnode is locked on entry and unlocked on exit. Note that unlike most VOP calls returning a vnode, <b class="fname">VOP_SYMLINK</b>() does not lock or reference <i class="farg">vpp</i>.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="fname">VOP_WRITE</b>(<i class="farg">vp</i>, <i class="farg">uio</i>, <i class="farg">ioflag</i>, <i class="farg">cred</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Copy data from the buffers specified by <i class="farg">uio</i> to the locked vnode <i class="farg">vp</i> with calling process credentials <i class="farg">cred</i>.<div class="spacer">
</div>
<i class="farg">ioflag</i> may contain the following flags:<div class="spacer">
</div>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 6.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">IO_APPEND</span></dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
Perform write at the end of file.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">IO_NDELAY</span></dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
Non-blocking I/O.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">IO_SYNC</span></dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
Wait for I/O to complete.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">IO_UNIT</span></dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
Do I/O as an atomic unit.</dd>
</dl>
<div class="spacer">
</div>
Upon success, zero is returned; otherwise, an appropriate error code is returned.</dd>
</dl>
</div>
<div class="section">
<h1 id="x52455455524e2056414c554553">RETURN VALUES</h1> The <b class="name">VOP</b> functions return 0 to indicate success and a non-zero error code to indicate failure.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html2/errno.html">errno(2)</a>, <a class="link-man" href="../html9/uiomove.html">uiomove(9)</a>, <a class="link-man" href="../html9/vfs.html">vfs(9)</a>, <a class="link-man" href="../html9/vn_lock.html">vn_lock(9)</a>, <a class="link-man" href="../html9/vnode.html">vnode(9)</a></div>
<div class="section">
<h1 id="x415554484f5253">AUTHORS</h1> This man page was written by <span class="author">Ted Unangst</span> for <span class="unix">OpenBSD</span>.</div>
<div class="section">
<h1 id="x42554753">BUGS</h1> The locking discipline is too complex. Refer to <a class="link-man" href="../html9/vn_lock.html">vn_lock(9)</a>.</div>
</div>
</body>
</html>

