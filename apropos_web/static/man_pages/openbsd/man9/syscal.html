<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
SYSCALL(9)</title>
</head>
<body>
<div class="mandoc">
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">syscall</b> &#8212; <span class="desc">system calls overview</span></div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> System calls in the kernel are implemented through a set of switch tables for each emulation type. Each table is generated from the &#8220;master&#8221; file by <i class="file">sys/kern/makesyscalls.sh</i> through the appropriate rules in the <i class="file">Makefile</i>.<div class="spacer">
</div>
The &#8220;master&#8221; file is a text file consisting of a list of lines for each system call. Lines may be split by the means of back slashing the end of the line. Each line is a set of fields separated by whitespace:<div class="spacer">
</div>
<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<b class="config">number type ...</b></div>
</blockquote>
<div class="spacer">
</div>
Where:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
number</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
is the system call number;</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
type</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
is one of:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
STD</dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
always included;</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
OBSOL</dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
obsolete, not included in the system;</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
UNIMPL</dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
unimplemented, not included in the system;</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
NODEF</dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
included, but don't define the syscall number;</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
NOARGS</dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
included, but don't define the syscall args structure;</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
INDIR</dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
included, but don't define the syscall args structure, and allow it to be &quot;really&quot; varargs;</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
COMPAT_XX</dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
a compatibility system call, only included if the corresponding option is configured for the kernel (see <a class="link-man" href="../html4/options.html">options(4)</a>).</dd>
</dl>
</dd>
</dl>
<div class="spacer">
</div>
The rest of the line for the STD, NODEF, NOARGS, and COMPAT_XX types is:<div class="spacer">
</div>
<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<b class="config">{ pseudo-proto } [alias]</b></div>
</blockquote>
<div class="spacer">
</div>
<b class="name">pseudo-proto</b> is a C-like prototype used to generate the system call argument list, and alias is an optional name alias for the call. The function in the prototype has to be defined somewhere in the kernel sources as it will be used as an entry point for the corresponding system call.<div class="spacer">
</div>
For other types the rest of the line is a comment.<div class="spacer">
</div>
To generate the header and code files from the &#8220;master&#8221; file a <a class="link-man" href="../html1/make.html">make(1)</a> command has to be run from the directory containing the &#8220;master&#8221; file.<div class="subsection">
<h2 id="x5573616765">Usage</h2> Entry from the user space for the system call is machine dependent. Typical code to invoke a system call from the machine dependent sources might look like this:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
 
	const struct sysent *callp; 
	register_t code, args[8], rval[2]; 
	struct proc *p = curproc; 
	int code, nsys; 
 
... 
 
/* &quot;code&quot; is the system call number passed from the user space */ 
 
... 
 
if (code &lt; 0 || code &gt;= nsys) 
	callp += p-&gt;p_emul-&gt;e_nosys;	/* illegal */ 
else 
	callp += code; 
 
/* copyin the arguments from the user space */ 
... 
	rval[0] = 0; 
 
/* the following steps are now performed using mi_syscall() */ 
#ifdef SYSCALL_DEBUG 
	scdebug_call(p, code, args); 
#endif 
#ifdef KTRACE 
	if (KTRPOINT(p, KTR_SYSCALL)) 
		ktrsyscall(p, code, argsize, args); 
#endif 
	error = (*callp-&gt;sy_call)(p, args, rval); 
 
	switch (error) { 
	case 0: 
		/* normal return */ 
		... 
		break; 
	case ERESTART: 
		/* 
		 * adjust PC to point before the system call 
		 * in the user space in order for the return 
		 * back there we reenter the kernel to repeat 
		 * the same system call 
		 */ 
		... 
		break; 
	case EJUSTRETURN: 
		/* just return */ 
		break; 
	default: 
		/* 
		 * an error returned: 
		 *	call an optional emulation errno mapping 
		 *	routine and return back to the user. 
		 */ 
		if (p-&gt;p_emul-&gt;e_errno) 
			error = p-&gt;p_emul-&gt;e_errno[error]; 
		... 
		break; 
	} 
 
/* the following steps are now performed using mi_syscall_return() */ 
#ifdef SYSCALL_DEBUG 
	scdebug_ret(p, code, orig_error, rval); 
#endif 
	userret(p); 
#ifdef KTRACE 
	if (KTRPOINT(p, KTR_SYSRET)) 
		ktrsysret(p, code, orig_error, rval[0]); 
#endif 
</pre>
<div class="spacer">
</div>
The &#8220;SYSCALL_DEBUG&#8221; parts of the code are explained in the section <i class="link-sec"><a class="link-sec" href="#x446562756767696e67">Debugging</a></i> later in the document. For the &#8220;KTRACE&#8221; portions of the code refer to the <a class="link-man" href="../html9/ktrace.html">ktrace(9)</a> document for further explanations.</div>
<div class="subsection">
<h2 id="x446562756767696e67">Debugging</h2> For debugging purposes the line<div class="spacer">
</div>
<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<b class="config">option SYSCALL_DEBUG</b></div>
</blockquote>
<div class="spacer">
</div>
should be included in the kernel configuration file (see <a class="link-man" href="../html4/options.html">options(4)</a>). This allows tracing for calls, returns, and arguments for both implemented and non-implemented system calls. A global integer variable &#8220;scdebug&#8221; contains a mask for the desired logging events:<div class="spacer">
</div>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
SCDEBUG_CALLS</dt>
<dd class="list-tag" style="margin-left: 18.00ex;">
(0x0001) show calls;</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
SCDEBUG_RETURNS</dt>
<dd class="list-tag" style="margin-left: 18.00ex;">
(0x0002) show returns;</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
SCDEBUG_ALL</dt>
<dd class="list-tag" style="margin-left: 18.00ex;">
(0x0004) show even syscalls that are implemented;</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
SCDEBUG_SHOWARGS</dt>
<dd class="list-tag" style="margin-left: 18.00ex;">
(0x0008) show arguments to calls.</dd>
</dl>
<div class="spacer">
</div>
Use <a class="link-man" href="../html4/ddb.html">ddb(4)</a> to set the &#8220;scdebug&#8221; to a value desired.</div>
</div>
<div class="section">
<h1 id="x434f4445205245464552454e434553">CODE REFERENCES</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">sys/kern/makesyscalls.sh</i></dt>
<dd class="list-tag" style="margin-left: 24.00ex;">
a <a class="link-man" href="../html1/sh.html">sh(1)</a> script for generating C files out of the syscall master file;</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">sys/kern/syscalls.conf</i></dt>
<dd class="list-tag" style="margin-left: 24.00ex;">
a configuration file for the shell script above;</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">sys/kern/syscalls.master</i></dt>
<dd class="list-tag" style="margin-left: 24.00ex;">
master files describing names and numbers for the system calls;</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">sys/kern/syscalls.c</i></dt>
<dd class="list-tag" style="margin-left: 24.00ex;">
system call names lists;</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">sys/kern/init_sysent.c</i></dt>
<dd class="list-tag" style="margin-left: 24.00ex;">
system call switch tables;</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">sys/sys/syscallargs.h</i></dt>
<dd class="list-tag" style="margin-left: 24.00ex;">
system call argument lists;</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">sys/sys/syscall.h</i></dt>
<dd class="list-tag" style="margin-left: 24.00ex;">
system call numbers;</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">sys/sys/syscall_mi.h</i></dt>
<dd class="list-tag" style="margin-left: 24.00ex;">
Machine-independent syscall entry end return handling.</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html2/ktrace.html">ktrace(2)</a>, <a class="link-man" href="../html2/syscall.html">syscall(2)</a>, <a class="link-man" href="../html9/ktrace.html">ktrace(9)</a>, <a class="link-man" href="../html9/sysctl_int.html">sysctl_int(9)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="name">syscall</b> section manual page appeared in <span class="unix">OpenBSD&#160;3.4</span>.</div>
</div>
</body>
</html>

