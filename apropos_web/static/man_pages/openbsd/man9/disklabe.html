<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
DISKLABEL(9)</title>
</head>
<body>
<div class="mandoc">
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">disklabel</b>, <b class="name">readdisklabel</b>, <b class="name">writedisklabel</b>, <b class="name">setdisklabel</b>, <b class="name">bounds_check_with_label</b> &#8212; <span class="desc">disk label management routines</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">sys/param.h</a>&gt;</b><br/>
<b class="includes">#include &lt;<a class="link-includes">sys/disklabel.h</a>&gt;</b><div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">readdisklabel</b>(<i class="farg" style="white-space:nowrap;">dev_t dev</i>, <i class="farg" style="white-space:nowrap;">void (*strat)(struct buf *)</i>, <i class="farg" style="white-space:nowrap;">struct disklabel *lp</i>, <i class="farg" style="white-space:nowrap;">int spoofonly</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">writedisklabel</b>(<i class="farg" style="white-space:nowrap;">dev_t dev</i>, <i class="farg" style="white-space:nowrap;">void (*strat)(struct buf *)</i>, <i class="farg" style="white-space:nowrap;">struct disklabel *lp</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">setdisklabel</b>(<i class="farg" style="white-space:nowrap;">struct disklabel *olp</i>, <i class="farg" style="white-space:nowrap;">struct disklabel *nlp</i>, <i class="farg" style="white-space:nowrap;">u_int openmask</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">bounds_check_with_label</b>(<i class="farg" style="white-space:nowrap;">struct buf *bp</i>, <i class="farg" style="white-space:nowrap;">struct disklabel *lp</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> This collection of routines provides a disklabel management interface to kernel device drivers. These routines are classified as machine- or architecture-dependent because of restrictions imposed by the machine architecture and boot-strapping code on the location of the label, or because cooperation with other operating systems requires specialized conversion code.<div class="spacer">
</div>
<b class="fname">readdisklabel</b>() attempts to read a disklabel from the device identified by <i class="farg">dev</i>, using the device strategy routine passed in <i class="farg">strat</i>. Note that a buffer structure is required to pass to the strategy routine; it needs to be acquired and parametrized for the intended I/O operation, and disposed of when the operation has completed. Some fields in the disklabel passed in <i class="farg">lp</i> may be pre-initialized by the caller in order to meet device driver requirements for the I/O operation initiated to get to the disklabel data on the medium. In particular, the field &#8220;d_secsize&#8221;, if non-zero, is used by <b class="fname">readdisklabel</b>() to get an appropriately sized buffer to pass to the device strategy routine. Unspecified fields in <i class="farg">lp</i> should be set to zero. If the medium does not contain a native disklabel that can be read in directly or <i class="farg">spoofonly</i> argument is a true value, If a disk label is found or can be constructed a value of 0 is returned. Otherwise the value of the I/O errno encountered is returned.<div class="spacer">
</div>
<b class="fname">writedisklabel</b>() stores disk label information contained in the disk label structure given by <i class="farg">lp</i> on the device identified by <i class="farg">dev</i>. Like <b class="fname">readdisklabel</b>(), it acquires and sets up an I/O buffer to pass to the strategy routine <i class="farg">strat</i>. <b class="fname">writedisklabel</b>() returns 0 on success and <span class="define">EINVAL</span> if the disk label specifies invalid or unconvertible values. Otherwise, any error condition reported by the device strategy routine in the buffer's &#8220;<b class="var">b_error</b>&#8221; field is returned.<div class="spacer">
</div>
<b class="fname">setdisklabel</b>() checks a proposed new disk label passed in <i class="farg">nlp</i> for some amount of basic sanity. This includes a check on attempts to change the location, or reduce the size, of an existing disk partition that is currently in use by the system. The current disposition of the disk partitions is made available through <i class="farg">olp</i> and <i class="farg">openmask</i>, which provide, respectively, the existing disk label and a bit mask identifying the partitions that are currently in use. Failure to pass on &#8220;basic sanity&#8221;, results in a <span class="define">EINVAL</span> return value, while a vetoed update of the partition layout is signalled by a <span class="define">EBUSY</span> return value. Otherwise, 0 is returned.<div class="spacer">
</div>
<b class="fname">bounds_check_with_label</b>() is used to check whether a device transfer described by <i class="farg">bp</i> to the device identified by <i class="farg">dev</i>, is properly contained within a disk partition of the disk with label <i class="farg">lp</i>. If this check fails, <b class="fname">bounds_check_with_label</b>() sets the buffer's &#8220;<b class="var">b_error</b>&#8221; field to <span class="define">EINVAL</span> and sets the <span class="define">B_ERROR</span> flag in &#8220;<b class="var">b_flags</b>&#8221;. A value of -1 is returned if any of the bound checks failed, a null transfer was attempted, or transfer was attempted exactly at the end of the disk partition. Otherwise the value of 0 is returned.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html5/disklabel.html">disklabel(5)</a>, <a class="link-man" href="../html8/disklabel.html">disklabel(8)</a>, <a class="link-man" href="../html8/fdisk.html">fdisk(8)</a></div>
</div>
</body>
</html>

