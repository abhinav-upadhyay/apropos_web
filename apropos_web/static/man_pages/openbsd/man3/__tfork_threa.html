<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
__TFORK_THREAD(3)</title>
</head>
<body>
<div class="mandoc">
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">__tfork_thread</b>, <b class="name">__tfork</b> &#8212; <span class="desc">create a new kernel thread in the current process</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">unistd.h</a>&gt;</b><div class="spacer">
</div>
<pre style="margin-left: 0.00ex;" class="lit display">
struct __tfork { 
        void    *tf_tcb;            /* TCB address for new thread */ 
        pid_t   *tf_tid;            /* where to write child's thread ID */ 
        void    *tf_stack;          /* stack address for new thread */ 
};</pre>
<div class="spacer">
</div>
<br/>
<i class="ftype">pid_t</i><br/>
<b class="fname">__tfork_thread</b>(<i class="farg" style="white-space:nowrap;">const struct __tfork *params</i>, <i class="farg" style="white-space:nowrap;">size_t psize</i>, <i class="farg" style="white-space:nowrap;">void (*startfunc)(void *)</i>, <i class="farg" style="white-space:nowrap;">void *startarg</i>);<div class="spacer">
</div>
<i class="ftype">pid_t</i><br/>
<b class="fname">__tfork</b>(<i class="farg" style="white-space:nowrap;">const struct __tfork *params</i>, <i class="farg" style="white-space:nowrap;">size_t psize</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="fname">__tfork_thread</b>() function creates a new kernel thread in the current process. The new thread starts by calling <i class="farg">startfunc</i>, passing <i class="farg">startarg</i> as the only argument. If <i class="farg">startfunc</i> returns, the thread will exit.<div class="spacer">
</div>
The <i class="farg">params</i> argument provides parameters used by the kernel during thread creation. The new thread's thread control block (TCB) address is set to <span class="emph">tf_tcb</span>. If <span class="emph">tf_tid</span> is not NULL, the new thread's thread ID is returned to the user at that address, with the guarantee that this is done before returning to userspace in either the calling thread or the new thread. If <span class="emph">tf_stack</span> is not NULL, the new thread's stack is initialized to start at that address. On hppa that is the lowest address used; on other architectures that is the address after the highest address used.<div class="spacer">
</div>
The <i class="farg">psize</i> argument provides the size of the <span class="type">struct __tfork</span> passed via the <i class="farg">params</i> argument.<div class="spacer">
</div>
The underlying system call used to create the thread is <b class="fname">__tfork</b>(). Because the new thread returns without a stack frame, the syscall cannot be directly used from C and is therefore not provided as a function. However, the syscall may show up in the output of <a class="link-man" href="../html1/kdump.html">kdump(1)</a>.</div>
<div class="section">
<h1 id="x52455455524e2056414c554553">RETURN VALUES</h1> Upon successful completion, <b class="fname">__tfork_thread</b>() returns in the calling thread the thread ID of new thread. The <b class="fname">__tfork</b>() syscall itself, on success, returns a value of 0 in the new thread and returns the thread ID of the new thread to the calling thread. Otherwise, a value of -1 is returned, no thread is created, and the global variable <b class="var">errno</b> is set to indicate an error.</div>
<div class="section">
<h1 id="x4552524f5253">ERRORS</h1> <b class="fname">__tfork_thread</b>() and <b class="fname">__tfork</b>() will fail and no thread will be created if:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">ENOMEM</span>]</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
Cannot allocate memory. The new process image required more memory than was allowed by the hardware or by system-imposed memory management constraints. A lack of swap space is normally temporary; however, a lack of core is not. Soft limits may be increased to their corresponding hard limits.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">EINVAL</span>]</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
Invalid argument. Some invalid argument was supplied.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">EAGAIN</span>]</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
Resource temporarily unavailable. The system-imposed limit on the total number of threads under execution would be exceeded. This limit is configuration-dependent.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">EAGAIN</span>]</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
Resource temporarily unavailable. The system-imposed limit <span class="define">MAXUPRC</span> on the total number of threads under execution by a single user would be exceeded. <span class="define">MAXUPRC</span> is currently defined in <b class="includes">&lt;<a class="link-includes">sys/param.h</a>&gt;</b> as <span class="define">CHILD_MAX</span>, which is currently defined as 80 in <b class="includes">&lt;<a class="link-includes">sys/syslimits.h</a>&gt;</b>.</dd>
</dl>
</div>
<div class="section">
<h1 id="x5354414e4441524453">STANDARDS</h1> The <b class="fname">__tfork_thread</b>() function and <b class="fname">__tfork</b>() syscall are specific to <span class="unix">OpenBSD</span> and should not be used in portable applications.</div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="fname">__tfork_thread</b>() function and <b class="fname">__tfork</b>() syscall appeared in <span class="unix">OpenBSD&#160;5.1</span>.</div>
</div>
</body>
</html>

