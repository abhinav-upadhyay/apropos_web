<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
MKTEMP(3)</title>
</head>
<body>
<div class="mandoc">
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">mktemp</b>, <b class="name">mkstemp</b>, <b class="name">mkostemp</b>, <b class="name">mkstemps</b>, <b class="name">mkostemps</b>, <b class="name">mkdtemp</b> &#8212; <span class="desc">make temporary file name (unique)</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">stdlib.h</a>&gt;</b><div class="spacer">
</div>
<i class="ftype">char *</i><br/>
<b class="fname">mktemp</b>(<i class="farg" style="white-space:nowrap;">char *template</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">mkstemp</b>(<i class="farg" style="white-space:nowrap;">char *template</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">mkstemps</b>(<i class="farg" style="white-space:nowrap;">char *template</i>, <i class="farg" style="white-space:nowrap;">int suffixlen</i>);<div class="spacer">
</div>
<i class="ftype">char *</i><br/>
<b class="fname">mkdtemp</b>(<i class="farg" style="white-space:nowrap;">char *template</i>);<div class="spacer">
</div>
<b class="includes">#include &lt;<a class="link-includes">stdlib.h</a>&gt;</b><br/>
<b class="includes">#include &lt;<a class="link-includes">fcntl.h</a>&gt;</b><div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">mkostemp</b>(<i class="farg" style="white-space:nowrap;">char *template</i>, <i class="farg" style="white-space:nowrap;">int flags</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">mkostemps</b>(<i class="farg" style="white-space:nowrap;">char *template</i>, <i class="farg" style="white-space:nowrap;">int suffixlen</i>, <i class="farg" style="white-space:nowrap;">int flags</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="fname">mktemp</b>() family of functions take the given file name template and overwrite a portion of it to create a new file name. This file name is unique and suitable for use by the application. The template may be any file name with at least six trailing <span class="emph">X</span>s, for example <i class="file">/tmp/temp.XXXXXXXX</i>. The trailing <span class="emph">X</span>s are replaced with a unique digit and letter combination. The number of unique file names that can be returned depends on the number of <span class="emph">X</span>s provided; <b class="fname">mktemp</b>() will try at least 2 ** 31 combinations before giving up. At least six <span class="emph">X</span>s must be used, though 10 is much better.<div class="spacer">
</div>
The <b class="fname">mktemp</b>() function generates a temporary file name based on a template as described above. Because <b class="fname">mktemp</b>() does not actually create the temporary file there is a window of opportunity during which another process can open the file instead. Because of this race condition, <b class="fname">mktemp</b>() should not be used where <b class="fname">mkstemp</b>() can be used instead. <b class="fname">mktemp</b>() was marked as a legacy interface in IEEE Std 1003.1-2001 (&#8220;POSIX.1&#8221;).<div class="spacer">
</div>
The <b class="fname">mkstemp</b>() function makes the same replacement to the template and creates the template file, mode 0600, returning a file descriptor opened for reading and writing. This avoids the race between testing for a file's existence and opening it for use.<div class="spacer">
</div>
The <b class="fname">mkostemp</b>() function acts the same as <b class="fname">mkstemp</b>(), except that the <i class="farg">flags</i> argument may contain zero or more of the following flags for the underlying <a class="link-man" href="../html2/open.html">open(2)</a> system call:<div class="spacer">
</div>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 6.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">O_APPEND</span></dt>
<dd class="list-tag" style="margin-left: 11.00ex;">
Append on each write.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">O_CLOEXEC</span></dt>
<dd class="list-tag" style="margin-left: 11.00ex;">
Set the close-on-exec flag on the new file descriptor.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">O_SYNC</span></dt>
<dd class="list-tag" style="margin-left: 11.00ex;">
Perform synchronous I/O operations.</dd>
</dl>
<div class="spacer">
</div>
The <b class="fname">mkstemps</b>() and <b class="fname">mkostemps</b>() functions act the same as <b class="fname">mkstemp</b>() and <b class="fname">mkostemp</b>(), except they permit a suffix to exist in the template. The template should be of the form <i class="file">/tmp/tmpXXXXXXXXXXsuffix</i>. <b class="fname">mkstemps</b>() and <b class="fname">mkostemps</b>() are told the length of the suffix string, i.e., <code class="lit">strlen(&quot;suffix&quot;)</code>.<div class="spacer">
</div>
The <b class="fname">mkdtemp</b>() function makes the same replacement to the template as in <b class="fname">mktemp</b>() and creates the template directory, mode 0700.</div>
<div class="section">
<h1 id="x52455455524e2056414c554553">RETURN VALUES</h1> The <b class="fname">mktemp</b>() and <b class="fname">mkdtemp</b>() functions return a pointer to the template on success and <span class="define">NULL</span> on failure. The <b class="fname">mkstemp</b>(), <b class="fname">mkostemp</b>(), <b class="fname">mkstemps</b>(), and <b class="fname">mkostemps</b>() functions return -1 if no suitable file could be created. If any call fails, an error code is placed in the global variable <b class="var">errno</b>.</div>
<div class="section">
<h1 id="x4558414d504c4553">EXAMPLES</h1> Quite often a programmer will want to replace a use of <b class="fname">mktemp</b>() with <b class="fname">mkstemp</b>(), usually to avoid the problems described above. Doing this correctly requires a good understanding of the code in question.<div class="spacer">
</div>
For instance, code of this form:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
char sfn[19]; 
FILE *sfp; 
 
strlcpy(sfn, &quot;/tmp/ed.XXXXXXXXXX&quot;, sizeof(sfn)); 
if (mktemp(sfn) == NULL || (sfp = fopen(sfn, &quot;w+&quot;)) == NULL) { 
	warn(&quot;%s&quot;, sfn); 
	return (NULL); 
} 
return (sfp);</pre>
<div class="spacer">
</div>
should be rewritten like this:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
char sfn[19]; 
FILE *sfp; 
int fd; 
 
strlcpy(sfn, &quot;/tmp/ed.XXXXXXXXXX&quot;, sizeof(sfn)); 
if ((fd = mkstemp(sfn)) == -1 || 
    (sfp = fdopen(fd, &quot;w+&quot;)) == NULL) { 
	if (fd != -1) { 
		unlink(sfn); 
		close(fd); 
	} 
	warn(&quot;%s&quot;, sfn); 
	return (NULL); 
} 
return (sfp);</pre>
<div class="spacer">
</div>
Often one will find code which uses <b class="fname">mktemp</b>() very early on, perhaps to globally initialize the template nicely, but the code which calls <a class="link-man" href="../html2/open.html">open(2)</a> or <a class="link-man" href="../html3/fopen.html">fopen(3)</a> on that file name will occur much later. (In almost all cases, the use of <a class="link-man" href="../html3/fopen.html">fopen(3)</a> will mean that the flags <span class="define">O_CREAT</span> | <span class="define">O_EXCL</span> are not given to <a class="link-man" href="../html2/open.html">open(2)</a>, and thus a symbolic link race becomes possible, hence making necessary the use of <a class="link-man" href="../html3/fdopen.html">fdopen(3)</a> as seen above.) Furthermore, one must be careful about code which opens, closes, and then re-opens the file in question. Finally, one must ensure that upon error the temporary file is removed correctly.<div class="spacer">
</div>
There are also cases where modifying the code to use <b class="fname">mktemp</b>(), in concert with <a class="link-man" href="../html2/open.html">open(2)</a> using the flags <span class="define">O_CREAT</span> | <span class="define">O_EXCL</span>, is better, as long as the code retries a new template if <a class="link-man" href="../html2/open.html">open(2)</a> fails with an <b class="var">errno</b> of <span class="errno">EEXIST</span>.</div>
<div class="section">
<h1 id="x4552524f5253">ERRORS</h1> The <b class="fname">mktemp</b>(), <b class="fname">mkstemp</b>(), <b class="fname">mkostemp</b>(), and <b class="fname">mkdtemp</b>() functions may set <b class="var">errno</b> to one of the following values:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">EINVAL</span>]</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The <i class="arg">template</i> argument has fewer than six trailing <span class="emph">X</span>s.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">EEXIST</span>]</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
All file names tried are already in use. Consider appending more <span class="emph">X</span>s to the <i class="arg">template</i>.</dd>
</dl>
<div class="spacer">
</div>
The <b class="fname">mkstemps</b>() and <b class="fname">mkostemps</b>() functions may set <b class="var">errno</b> to<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">EINVAL</span>]</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The <i class="arg">template</i> argument length is less than <i class="arg">suffixlen</i> or it has fewer than six <span class="emph">X</span>s before the suffix.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">EEXIST</span>]</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
All file names tried are already in use. Consider appending more <span class="emph">X</span>s to the <i class="arg">template</i>.</dd>
</dl>
<div class="spacer">
</div>
In addition, the <b class="fname">mkostemp</b>() and <b class="fname">mkostemps</b>() functions may also set <b class="var">errno</b> to<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">EINVAL</span>]</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
<i class="farg">flags</i> is invalid.</dd>
</dl>
<div class="spacer">
</div>
The <b class="fname">mktemp</b>() function may also set <b class="var">errno</b> to any value specified by the <a class="link-man" href="../html2/lstat.html">lstat(2)</a> function.<div class="spacer">
</div>
The <b class="fname">mkstemp</b>(), <b class="fname">mkostemp</b>(), <b class="fname">mkstemps</b>(), and <b class="fname">mkostemps</b>() functions may also set <b class="var">errno</b> to any value specified by the <a class="link-man" href="../html2/open.html">open(2)</a> function.<div class="spacer">
</div>
The <b class="fname">mkdtemp</b>() function may also set <b class="var">errno</b> to any value specified by the <a class="link-man" href="../html2/mkdir.html">mkdir(2)</a> function.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html2/chmod.html">chmod(2)</a>, <a class="link-man" href="../html2/lstat.html">lstat(2)</a>, <a class="link-man" href="../html2/mkdir.html">mkdir(2)</a>, <a class="link-man" href="../html2/open.html">open(2)</a>, <a class="link-man" href="../html3/tempnam.html">tempnam(3)</a>, <a class="link-man" href="../html3/tmpfile.html">tmpfile(3)</a>, <a class="link-man" href="../html3/tmpnam.html">tmpnam(3)</a></div>
<div class="section">
<h1 id="x5354414e4441524453">STANDARDS</h1> The <b class="fname">mkdtemp</b>() and <b class="fname">mkstemp</b>() functions conform to the IEEE Std 1003.1-2008 (&#8220;POSIX.1&#8221;) specification. The ability to specify more than six <span class="emph">X</span>s is an extension to that standard. The <b class="fname">mkostemp</b>() function is expected to conform to a future revision of that standard.<div class="spacer">
</div>
The <b class="fname">mktemp</b>() function conforms to IEEE Std 1003.1-2001 (&#8220;POSIX.1&#8221;); as of IEEE Std 1003.1-2008 (&#8220;POSIX.1&#8221;) it is no longer a part of the standard.<div class="spacer">
</div>
The <b class="fname">mkstemps</b>() and <b class="fname">mkostemps</b>() functions are non-standard and should not be used if portability is required.</div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> A <b class="fname">mktemp</b>() function appeared in Version&#160;7 AT&amp;T UNIX. The <b class="fname">mkdtemp</b>() function appeared in <span class="unix">OpenBSD&#160;2.2</span>. The <b class="fname">mkstemp</b>() function appeared in <span class="unix">4.4BSD</span>. The <b class="fname">mkstemps</b>() function appeared in <span class="unix">OpenBSD&#160;2.3</span>. The <b class="fname">mkostemp</b>() and <b class="fname">mkostemps</b>() functions appeared in <span class="unix">OpenBSD&#160;5.7</span>.</div>
<div class="section">
<h1 id="x42554753">BUGS</h1> For <b class="fname">mktemp</b>() there is an obvious race between file name selection and file creation and deletion: the program is typically written to call <a class="link-man" href="../html3/tmpnam.html">tmpnam(3)</a>, <a class="link-man" href="../html3/tempnam.html">tempnam(3)</a>, or <b class="fname">mktemp</b>(). Subsequently, the program calls <a class="link-man" href="../html2/open.html">open(2)</a> or <a class="link-man" href="../html3/fopen.html">fopen(3)</a> and erroneously opens a file (or symbolic link, FIFO or other device) that the attacker has created in the expected file location. Hence <b class="fname">mkstemp</b>() is recommended, since it atomically creates the file. An attacker can guess the file names produced by <b class="fname">mktemp</b>(). Whenever it is possible, <b class="fname">mkstemp</b>() or <b class="fname">mkdtemp</b>() should be used instead.<div class="spacer">
</div>
For this reason, <a class="link-man" href="../html1/ld.html">ld(1)</a> will output a warning message whenever it links code that uses <b class="fname">mktemp</b>().</div>
</div>
</body>
</html>

