<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
YP_BIND(3)</title>
</head>
<body>
<div class="mandoc">
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">yp_all</b>, <b class="name">yp_bind</b>, <b class="name">yp_first</b>, <b class="name">yp_get_default_domain</b>, <b class="name">yp_maplist</b>, <b class="name">yp_master</b>, <b class="name">yp_match</b>, <b class="name">yp_next</b>, <b class="name">yp_order</b>, <b class="name">yp_unbind</b>, <b class="name">yperr_string</b>, <b class="name">ypprot_err</b> &#8212; <span class="desc">Interface to the YP subsystem</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">sys/types.h</a>&gt;</b><br/>
<b class="includes">#include &lt;<a class="link-includes">rpc/rpc.h</a>&gt;</b><br/>
<b class="includes">#include &lt;<a class="link-includes">rpcsvc/ypclnt.h</a>&gt;</b><br/>
<b class="includes">#include &lt;<a class="link-includes">rpcsvc/yp_prot.h</a>&gt;</b><div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">yp_all</b>(<i class="farg" style="white-space:nowrap;">char *indomain</i>, <i class="farg" style="white-space:nowrap;">char *inmap</i>, <i class="farg" style="white-space:nowrap;">struct ypall_callback *incallback</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">yp_bind</b>(<i class="farg" style="white-space:nowrap;">char *dom</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">yp_first</b>(<i class="farg" style="white-space:nowrap;">char *indomain</i>, <i class="farg" style="white-space:nowrap;">char *inmap</i>, <i class="farg" style="white-space:nowrap;">char **outkey</i>, <i class="farg" style="white-space:nowrap;">int *outkeylen</i>, <i class="farg" style="white-space:nowrap;">char **outval</i>, <i class="farg" style="white-space:nowrap;">int *outvallen</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">yp_get_default_domain</b>(<i class="farg" style="white-space:nowrap;">char **domp</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">yp_maplist</b>(<i class="farg" style="white-space:nowrap;">char *indomain</i>, <i class="farg" style="white-space:nowrap;">struct ypmaplist **outmaplist</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">yp_master</b>(<i class="farg" style="white-space:nowrap;">char *indomain</i>, <i class="farg" style="white-space:nowrap;">char *inmap</i>, <i class="farg" style="white-space:nowrap;">char **outname</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">yp_match</b>(<i class="farg" style="white-space:nowrap;">char *indomain</i>, <i class="farg" style="white-space:nowrap;">char *inmap</i>, <i class="farg" style="white-space:nowrap;">const char *inkey</i>, <i class="farg" style="white-space:nowrap;">int inkeylen</i>, <i class="farg" style="white-space:nowrap;">char **outval</i>, <i class="farg" style="white-space:nowrap;">int *outvallen</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">yp_next</b>(<i class="farg" style="white-space:nowrap;">char *indomain</i>, <i class="farg" style="white-space:nowrap;">char *inmap</i>, <i class="farg" style="white-space:nowrap;">char *inkey</i>, <i class="farg" style="white-space:nowrap;">int inkeylen</i>, <i class="farg" style="white-space:nowrap;">char **outkey</i>, <i class="farg" style="white-space:nowrap;">int *outkeylen</i>, <i class="farg" style="white-space:nowrap;">char **outval</i>, <i class="farg" style="white-space:nowrap;">int *outvallen</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">yp_order</b>(<i class="farg" style="white-space:nowrap;">char *indomain</i>, <i class="farg" style="white-space:nowrap;">char *inmap</i>, <i class="farg" style="white-space:nowrap;">char *outorder</i>);<div class="spacer">
</div>
<i class="ftype">void</i><br/>
<b class="fname">yp_unbind</b>(<i class="farg" style="white-space:nowrap;">char *dom</i>);<div class="spacer">
</div>
<i class="ftype">char *</i><br/>
<b class="fname">yperr_string</b>(<i class="farg" style="white-space:nowrap;">int incode</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">ypprot_err</b>(<i class="farg" style="white-space:nowrap;">unsigned int incode</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="name">ypclnt</b> suite provides an interface to the YP subsystem. For a general description of the YP subsystem, see <a class="link-man" href="../html8/yp.html">yp(8)</a>.<div class="spacer">
</div>
For all functions, input values begin with &#8216;in&#8217; and output values begin with &#8216;out&#8217;. Any output values of type <span class="emph">char **</span> should be the addresses of uninitialized character pointers. Only if a call succeeds will memory be allocated by the YP client routines using <b class="fname">malloc</b>(). This memory can later be freed by the user if there is no additional need for the data stored there. For <i class="farg">outkey</i> and <i class="farg">outval</i>, two extra bytes of memory are allocated for a &#8216;<code class="lit">\n</code>&#8217; and &#8216;<code class="lit">\0</code>&#8217;, which are not reflected in the values of <i class="farg">outkeylen</i> or <i class="farg">outvallen</i>. All occurrences of <i class="farg">indomain</i> and <i class="farg">inmap</i> must be non-null, NUL-terminated strings. All input strings which also have a corresponding length parameter cannot be null unless the corresponding length value is zero. Such strings need not be NUL-terminated.<div class="spacer">
</div>
All YP lookup calls (the functions <b class="fname">yp_all</b>(), <b class="fname">yp_first</b>(), <b class="fname">yp_master</b>(), <b class="fname">yp_match</b>(), <b class="fname">yp_next</b>(), <b class="fname">yp_order</b>()) require a YP domain name and a YP map name. The default domain name may be obtained by calling <b class="fname">yp_get_default_domain</b>(), and should thus be used before all other YP calls in a client program. The value it places <i class="farg">outdomain</i> is suitable for use as the <i class="farg">indomain</i> parameter to all subsequent YP calls.<div class="spacer">
</div>
In order for YP lookup calls to succeed, the client process must be bound to a YP server process. The client process need not explicitly bind to the server, as it happens automatically whenever a lookup occurs. The function <b class="fname">yp_bind</b>() is provided for a backup strategy, e.g., a local file, when a YP server process is not available. Each binding uses one socket descriptor on the client process, which may be explicitly freed using <b class="fname">yp_unbind</b>(), which frees all per-process and per-node resources to bind the domain and marks the domain unbound.<div class="spacer">
</div>
If, during a YP lookup, an RPC failure occurs, the domain used in the lookup is automatically marked unbound and the <b class="name">ypclnt</b> layer retries the lookup as long as <a class="link-man" href="../html8/ypbind.html">ypbind(8)</a> is running and either the client process cannot bind to a server for the domain specified in the lookup, or RPC requests to the YP server process fail. If an error is not RPC-related, one of the YP error codes described below is returned and control given back to the user code.<div class="spacer">
</div>
The <b class="name">ypclnt</b> suite provides the following functionality:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">yp_match</b>()</dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Provides the value associated with the given key.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">yp_first</b>()</dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Provides the first key-value pair from the given map in the named domain.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">yp_next</b>()</dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Provides the next key-value pair in the given map. To obtain the second pair, the <i class="farg">inkey</i> value should be the <i class="farg">outkey</i> value provided by the initial call to <b class="fname">yp_first</b>(). In the general case, the next key-value pair may be obtained by using the <i class="farg">outkey</i> value from the previous call to <b class="fname">yp_next</b>() as the value for <i class="farg">inkey</i>.<div class="spacer">
</div>
Of course, the notions of &#8220;first&#8221; and &#8220;next&#8221; are particular to the type of YP map being accessed, and thus there is no guarantee of lexical order. The only guarantees provided with <b class="fname">yp_first</b>() and <b class="fname">yp_next</b>(), providing that the same map on the same server is polled repeatedly until <b class="fname">yp_next</b>() returns YPERR_NOMORE, are that all key-value pairs in that map will be accessed exactly once, and if the entire procedure is repeated, the order will be the same.<div class="spacer">
</div>
If the server is heavily loaded or the server fails for some reason, the domain being used may become unbound. If this happens, and the client process re-binds, the retrieval rules will break: some entries may be seen twice, and others not at all. For this reason, the function <b class="fname">yp_all</b>() provides a better solution for reading all of the entries in a particular map.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">yp_all</b>()</dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
This function provides a way to transfer an entire map from the server to the client process with a single request. This transfer uses TCP, unlike all other functions in the <b class="name">ypclnt</b> suite, which use UDP. The entire transaction occurs in a single RPC request-response. The third argument to this function provides a way to supply the name of a function to process each key-value pair in the map. <b class="fname">yp_all</b>() returns after the entire transaction is complete, or the <b class="fname">foreach</b>() function decides that it does not want any more key-value pairs. The third argument to <b class="fname">yp_all</b>() is:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
struct ypall_callback *incallback { 
	int (*foreach)(); 
	char *data; 
};</pre>
<div class="spacer">
</div>
The <span class="type">char *</span><b class="var">data</b> argument is an opaque pointer for use by the callback function. The <b class="fname">foreach</b>() function should return non-zero when it no longer wishes to process key-value pairs, at which time <b class="fname">yp_all</b>() returns a value of 0, and is called with the following arguments:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
int foreach ( 
	unsigned long instatus, 
	char *inkey, 
	int inkeylen, 
	char *inval, 
	int invallen, 
	char *indata 
);</pre>
<div class="spacer">
</div>
Where:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">instatus</i></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Holds one of the return status values described in <b class="includes">&lt;<a class="link-includes">rpcsvc/yp_prot.h</a>&gt;</b>: see <b class="fname">ypprot_err</b>() below for a function that will translate YP protocol errors into a <b class="name">ypclnt</b> layer error code as described in <b class="includes">&lt;<a class="link-includes">rpcsvc/ypclnt.h</a>&gt;</b>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">inkey</i>, <i class="farg">inval</i></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
The key and value arguments are somewhat different here than described above. In this case, the memory pointed to by <i class="farg">inkey</i> and <i class="farg">inval</i> is private to <b class="fname">yp_all</b>(), and is overwritten with each subsequent key-value pair; therefore, the <b class="fname">foreach</b>() function should do something useful with the contents of that memory during each iteration. If the key-value pairs are not terminated with either &#8216;<code class="lit">\n</code>&#8217; or &#8216;<code class="lit">\0</code>&#8217; in the map, then they will not be terminated as such when given to the <b class="fname">foreach</b>() function, either.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">indata</i></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
This is the contents of the <i class="farg">incallback</i>-&gt;<b class="var">data</b> element of the callback structure. It is provided as a means to share state between the <b class="fname">foreach</b>() function and the user code. Its use is completely optional: cast it to something useful or simply ignore it.</dd>
</dl>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">yp_order</b>()</dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Returns the order number for a map.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">yp_master</b>()</dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Returns the hostname for the machine on which the master YP server process for a map is running.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">yp_maplist</b>()</dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Returns a singly-linked list of the names of all the maps available in the named domain. The second argument to <b class="fname">yp_maplist</b>() is:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
struct ypmaplist { 
	char *map; 
	struct ypmaplist *next; 
};</pre>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">yperr_string</b>()</dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Returns a pointer to a NUL-terminated error string that does not contain a &#8216;<code class="lit">.</code>&#8217; or &#8216;<code class="lit">\n</code>&#8217;.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">ypprot_err</b>()</dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Converts a YP protocol error code to a <b class="name">ypclnt</b> error code suitable for <b class="fname">yperr_string</b>().</dd>
</dl>
</div>
<div class="section">
<h1 id="x52455455524e2056414c554553">RETURN VALUES</h1> All functions in the <b class="name">ypclnt</b> suite which are of type <span class="emph">int</span> return 0 upon success or one of the following error codes upon failure:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">YPERR_BADARGS</span>]</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
The passed arguments to the function are invalid.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">YPERR_BADDB</span>]</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
The YP map that was polled is defective.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">YPERR_DOMAIN</span>]</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
Client process cannot bind to server on this YP domain.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">YPERR_KEY</span>]</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
The key passed does not exist.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">YPERR_MAP</span>]</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
There is no such map in the server's domain.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">YPERR_NODOM</span>]</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
The local YP domain is not set.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">YPERR_NOMORE</span>]</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
There are no more records in the queried map.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">YPERR_PMAP</span>]</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
Cannot communicate with portmap.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">YPERR_RESRC</span>]</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
A resource allocation failure occurred.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">YPERR_RPC</span>]</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
An RPC failure has occurred. The domain has been marked unbound.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">YPERR_VERS</span>]</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
Client/server version mismatch. If the server is running version 1 of the YP protocol, <b class="fname">yp_all</b>() functionality does not exist.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">YPERR_YPBIND</span>]</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
Cannot communicate with <a class="link-man" href="../html8/ypbind.html">ypbind(8)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">YPERR_YPERR</span>]</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
An internal server or client error has occurred.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">YPERR_YPSERV</span>]</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
The client cannot communicate with the YP server process.</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html3/malloc.html">malloc(3)</a>, <a class="link-man" href="../html8/yp.html">yp(8)</a>, <a class="link-man" href="../html8/ypbind.html">ypbind(8)</a>, <a class="link-man" href="../html8/ypserv.html">ypserv(8)</a></div>
<div class="section">
<h1 id="x415554484f5253">AUTHORS</h1> <span class="author">Theo de Raadt</span></div>
</div>
</body>
</html>

