<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
AUTH_APPROVAL(3)</title>
</head>
<body>
<div class="mandoc">
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">auth_approval</b>, <b class="name">auth_cat</b>, <b class="name">auth_checknologin</b>, <b class="name">auth_mkvalue</b>, <b class="name">auth_userchallenge</b>, <b class="name">auth_usercheck</b>, <b class="name">auth_userokay</b>, <b class="name">auth_userresponse</b>, <b class="name">auth_verify</b> &#8212; <span class="desc">simplified interface to the BSD Authentication system</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">sys/types.h</a>&gt;</b><br/>
<b class="includes">#include &lt;<a class="link-includes">login_cap.h</a>&gt;</b><br/>
<b class="includes">#include &lt;<a class="link-includes">bsd_auth.h</a>&gt;</b><div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">auth_userokay</b>(<i class="farg" style="white-space:nowrap;">char *name</i>, <i class="farg" style="white-space:nowrap;">char *style</i>, <i class="farg" style="white-space:nowrap;">char *type</i>, <i class="farg" style="white-space:nowrap;">char *password</i>);<div class="spacer">
</div>
<i class="ftype">auth_session_t *</i><br/>
<b class="fname">auth_userchallenge</b>(<i class="farg" style="white-space:nowrap;">char *name</i>, <i class="farg" style="white-space:nowrap;">char *style</i>, <i class="farg" style="white-space:nowrap;">char *type</i>, <i class="farg" style="white-space:nowrap;">char **challengep</i>);<div class="spacer">
</div>
<i class="ftype">auth_session_t *</i><br/>
<b class="fname">auth_usercheck</b>(<i class="farg" style="white-space:nowrap;">char *name</i>, <i class="farg" style="white-space:nowrap;">char *style</i>, <i class="farg" style="white-space:nowrap;">char *type</i>, <i class="farg" style="white-space:nowrap;">char *password</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">auth_userresponse</b>(<i class="farg" style="white-space:nowrap;">auth_session_t *as</i>, <i class="farg" style="white-space:nowrap;">char *response</i>, <i class="farg" style="white-space:nowrap;">int more</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">auth_approval</b>(<i class="farg" style="white-space:nowrap;">auth_session_t *as</i>, <i class="farg" style="white-space:nowrap;">struct login_cap *lc</i>, <i class="farg" style="white-space:nowrap;">char *name</i>, <i class="farg" style="white-space:nowrap;">char *type</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">auth_cat</b>(<i class="farg" style="white-space:nowrap;">char *file</i>);<div class="spacer">
</div>
<i class="ftype">void</i><br/>
<b class="fname">auth_checknologin</b>(<i class="farg" style="white-space:nowrap;">struct login_cap *lc</i>);<div class="spacer">
</div>
<i class="ftype">char *</i><br/>
<b class="fname">auth_mkvalue</b>(<i class="farg" style="white-space:nowrap;">char *value</i>);<div class="spacer">
</div>
<i class="ftype">auth_session_t *</i><br/>
<b class="fname">auth_verify</b>(<i class="farg" style="white-space:nowrap;">auth_session_t *as</i>, <i class="farg" style="white-space:nowrap;">char *style</i>, <i class="farg" style="white-space:nowrap;">char *name</i>, <i class="farg" style="white-space:nowrap;">...</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> These functions provide a simplified interface to the <span class="unix">BSD</span> Authentication system (see <a class="link-man" href="../html3/auth_subr.html">auth_subr(3)</a>). The <b class="fname">auth_userokay</b>() function provides a single function call interface. Provided with a user's name in <i class="arg">name</i>, and an optional <i class="arg">style</i>, <i class="arg">type</i>, and <i class="arg">password</i>, the <b class="fname">auth_userokay</b>() function returns a simple yes/no response. A return value of 0 implies failure; a non-zero return value implies success. If <i class="arg">style</i> is not <span class="define">NULL</span>, it specifies the desired style of authentication to be used. If it is <span class="define">NULL</span> then the default style for the user is used. In this case, <i class="arg">name</i> may include the desired style by appending it to the user's name with a single colon (&#8216;:&#8217;) as a separator. If <i class="arg">type</i> is not <span class="define">NULL</span> then it is used as the authentication type (such as &#8220;auth-myservice&#8221;). If <i class="arg">password</i> is <span class="define">NULL</span> then <b class="fname">auth_userokay</b>() operates in an interactive mode with the user on standard input, output, and error. If <i class="arg">password</i> is specified, <b class="fname">auth_userokay</b>() operates in a non-interactive mode and only tests the specified passwords. This non-interactive method does not work with challenge-response authentication styles. For security reasons, when a <i class="arg">password</i> is specified, <b class="fname">auth_userokay</b>() will zero out its value before it returns.<div class="spacer">
</div>
The <b class="fname">auth_usercheck</b>() function operates the same as the <b class="fname">auth_userokay</b>() function except that it does not close the <span class="unix">BSD</span> Authentication session created. Rather than returning the status of the session, it returns a pointer to the newly created <span class="unix">BSD</span> Authentication session.<div class="spacer">
</div>
The <b class="fname">auth_userchallenge</b>() function takes the same <i class="arg">name</i>, <i class="arg">style</i>, and <i class="arg">type</i> arguments as does <b class="fname">auth_userokay</b>(). However, rather than authenticating the user, it returns a possible challenge in the pointer pointed to by <i class="arg">challengep</i>. The return value of the function is a pointer to a newly created <span class="unix">BSD</span> Authentication session. This challenge, if not <span class="define">NULL</span>, should be displayed to the user. In any case, the user should provide a password which is the <i class="arg">response</i> in a call to <b class="fname">auth_userresponse</b>(). In addition to the password, the pointer returned by <b class="fname">auth_userchallenge</b>() should be passed in as <i class="arg">as</i> and the value of <b class="var">more</b> should be non-zero if the program wishes to allow more attempts. If <b class="var">more</b> is zero then the session will be closed. The <b class="fname">auth_userresponse</b>() function closes the <span class="unix">BSD</span> Authentication session and has the same return value as <b class="fname">auth_userokay</b>(). For security reasons, when a <i class="arg">response</i> is specified, <b class="fname">auth_userresponse</b>() will zero out its value before it returns.<div class="spacer">
</div>
The <b class="fname">auth_approval</b>() function calls the approval script for the user of the specified <i class="arg">type</i>. The string &#8220;approve-&#8221; will be prepended to <i class="arg">type</i> if missing. The resulting type is used to look up an entry in <i class="file">/etc/login.conf</i> for the user's class. If the entry is missing, the generic entry for &#8220;approve&#8221; will be used. The <i class="arg">name</i> argument will be passed to the approval program as the name of the user. The <i class="arg">lc</i> argument points to a login class structure. If it is <span class="define">NULL</span> then a login class structure will be looked up for the class of user <i class="arg">name</i>. The <b class="fname">auth_approval</b>() function returns a value of 0 on failure to approve the user.<div class="spacer">
</div>
Prior to actually calling the approval script, the account's expiration time, the associated nologin file, and existence of the account's home directory (if <code class="lit">requirehome</code> is set for this class) are checked. Failure on any of these points causes the <b class="fname">auth_approval</b>() function to return a value of 0 and not actually call the approval script.<div class="spacer">
</div>
The <b class="fname">auth_cat</b>() function opens <i class="arg">file</i> for reading and copies its contents to standard output. It returns 0 if it was unable to open <i class="arg">file</i> and 1 otherwise.<div class="spacer">
</div>
The <b class="fname">auth_checknologin</b>() function must be provided with a pointer to a login class. If the class has a &#8220;nologin&#8221; entry defined and it points to a file that can be opened, the contents of the file will be copied to standard output and <a class="link-man" href="../html3/exit.html">exit(3)</a> will be called with a value of 1. If the class does not have the field &#8220;ignorenologin&#8221; and the file <i class="file">/etc/nologin</i> exists its contents will be copied to standard output and <a class="link-man" href="../html3/exit.html">exit(3)</a> will be called with a value of 1.<div class="spacer">
</div>
The <b class="fname">auth_verify</b>() function is a front end to the <a class="link-man" href="../html3/auth_call.html">auth_call(3)</a> function. It will open a <span class="unix">BSD</span> Authentication session, if needed, and will set the style and user name based on the <i class="arg">style</i> and <i class="arg">name</i> arguments, if not <span class="define">NULL</span>. Values for the style and user name in an existing <span class="unix">BSD</span> Authentication session will be replaced and the old values freed (if the calling program has obtained pointers to the style or user name via <a class="link-man" href="../html3/auth_getitem.html">auth_getitem(3)</a>, those pointers will become invalid). The variable arguments are passed to <b class="fname">auth_call</b>() via the <a class="link-man" href="../html3/auth_set_va_list.html">auth_set_va_list(3)</a> function. The, possibly created, <span class="unix">BSD</span> Authentication session is returned. The <a class="link-man" href="../html3/auth_getstate.html">auth_getstate(3)</a> or <a class="link-man" href="../html3/auth_close.html">auth_close(3)</a> function should be used to determine the outcome of the authentication request.<div class="spacer">
</div>
The <b class="fname">auth_mkvalue</b>() function takes a NUL-terminated string pointed to by <i class="arg">value</i> and returns a NUL-terminated string suitable for passing back to a calling program on the back channel. This function is for use by the login scripts themselves. The string returned should be freed by <a class="link-man" href="../html3/free.html">free(3)</a> when it is no longer needed. A value of <span class="define">NULL</span> is returned if no memory was available for the new copy of the string.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html3/auth_subr.html">auth_subr(3)</a>, <a class="link-man" href="../html3/getpwent.html">getpwent(3)</a>, <a class="link-man" href="../html3/pw_dup.html">pw_dup(3)</a></div>
</div>
</body>
</html>

