<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
MBRTOWC(3)</title>
</head>
<body>
<div class="mandoc">
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">mbrtowc</b> &#8212; <span class="desc">converts a multibyte character to a wide character (restartable)</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">wchar.h</a>&gt;</b><div class="spacer">
</div>
<i class="ftype">size_t</i><br/>
<b class="fname">mbrtowc</b>(<i class="farg" style="white-space:nowrap;">wchar_t * restrict wc</i>, <i class="farg" style="white-space:nowrap;">const char * restrict s</i>, <i class="farg" style="white-space:nowrap;">size_t n</i>, <i class="farg" style="white-space:nowrap;">mbstate_t * restrict mbs</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="fname">mbrtowc</b>() function examines at most <i class="farg">n</i> bytes of the multibyte character byte string pointed to by <i class="farg">s</i>, converts those bytes to a wide character, and stores the wide character in the wchar_t object pointed to by <i class="farg">wc</i> if <i class="farg">wc</i> is not <span class="define">NULL</span> and <i class="farg">s</i> points to a valid character.<div class="spacer">
</div>
Conversion happens in accordance with the conversion state described by the mbstate_t object pointed to by <i class="farg">mbs</i>. The mbstate_t object must be initialized to zero before the application's first call to <b class="fname">mbrtowc</b>(). If the previous call to <b class="fname">mbrtowc</b>() did not return (size_t)-1, the mbstate_t object can safely be reused without reinitialization.<div class="spacer">
</div>
The behaviour of <b class="fname">mbrtowc</b>() is affected by the <span class="define">LC_CTYPE</span> category of the current locale. If the locale is changed without reinitialization of the mbstate_t object pointed to by <i class="farg">mbs</i>, the behaviour of <b class="fname">mbrtowc</b>() is undefined.<div class="spacer">
</div>
Unlike <a class="link-man" href="../html3/mbtowc.html">mbtowc(3)</a>, <b class="fname">mbrtowc</b>() will accept an incomplete byte sequence pointed to by <i class="farg">s</i> which does not form a complete character but is potentially part of a valid character. In this case, <b class="fname">mbrtowc</b>() consumes all such bytes. The conversion state saved in the mbstate_t object pointed to by <i class="farg">mbs</i> will be used to restart the suspended conversion during the next call to <b class="fname">mbrtowc</b>().<div class="spacer">
</div>
In state-dependent encodings, <i class="farg">s</i> may point to a special sequence of bytes called a &#8220;shift sequence&#8221;. Shift sequences switch between character code sets available within an encoding scheme. One encoding scheme using shift sequences is ISO/IEC 2022-JP, which can switch e.g. from ASCII (which uses one byte per character) to JIS X 0208 (which uses two bytes per character). Shift sequence bytes correspond to no individual wide character, so <b class="fname">mbrtowc</b>() treats them as if they were part of the subsequent multibyte character. Therefore they do contribute to the number of bytes in the multibyte character.<div class="spacer">
</div>
Special cases in interpretation of arguments are as follows:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
wc == NULL </dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
The conversion from a multibyte character to a wide character is performed and the conversion state may be affected, but the resulting wide character is discarded.<div class="spacer">
</div>
This can be used to find out how many bytes are contained in the multibyte character pointed to by <i class="farg">s</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
s == NULL </dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
<b class="fname">mbrtowc</b>() ignores <i class="farg">wc</i> and <i class="farg">n</i>, and behaves equivalent to<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
mbrtowc(NULL, &quot;&quot;, 1, mbs);</pre>
<div class="spacer">
</div>
which attempts to use the mbstate_t object pointed to by <i class="farg">mbs</i> to start or continue conversion using the empty string as input, and discards the conversion result.<div class="spacer">
</div>
If conversion succeeds, this call always returns zero. Unlike <a class="link-man" href="../html3/mbtowc.html">mbtowc(3)</a>, the value returned does not indicate whether the current encoding of the locale is state-dependent, i.e. uses shift sequences.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
mbs == NULL </dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
<b class="fname">mbrtowc</b>() uses its own internal state object to keep the conversion state, instead of an mbstate_t object pointed to by <i class="farg">mbs</i>. This internal conversion state is initialized once at program startup. It is not safe to call <b class="fname">mbrtowc</b>() again with a <span class="define">NULL</span> <i class="farg">mbs</i> argument if <b class="fname">mbrtowc</b>() returned (size_t)-1 because at this point the internal conversion state is undefined.<div class="spacer">
</div>
Calling any other functions in <span class="emph">libc</span> never changes the internal conversion state object of <b class="fname">mbrtowc</b>().</dd>
</dl>
</div>
<div class="section">
<h1 id="x52455455524e2056414c554553">RETURN VALUES</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
0</dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
The bytes pointed to by <i class="farg">s</i> form a terminating NUL character. If <i class="farg">wc</i> is not <span class="define">NULL</span>, a NUL wide character has been stored in the wchar_t object pointed to by <i class="farg">wc</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
positive</dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
<i class="farg">s</i> points to a valid character, and the value returned is the number of bytes completing the character. If <i class="farg">wc</i> is not <span class="define">NULL</span>, the corresponding wide character has been stored in the wchar_t object pointed to by <i class="farg">wc</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
(size_t)-1</dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
<i class="farg">s</i> points to an illegal byte sequence which does not form a valid multibyte character in the current locale. <b class="fname">mbrtowc</b>() sets <b class="var">errno</b> to EILSEQ. The conversion state object pointed to by <i class="farg">mbs</i> is left in an undefined state and must be reinitialized before being used again.<div class="spacer">
</div>
Because applications using <b class="fname">mbrtowc</b>() are shielded from the specifics of the multibyte character encoding scheme, it is impossible to repair byte sequences containing encoding errors. Such byte sequences must be treated as invalid and potentially malicious input. Applications must stop processing the byte string pointed to by <i class="farg">s</i> and either discard any wide characters already converted, or cope with truncated input.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
(size_t)-2</dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
<i class="farg">s</i> points to an incomplete byte sequence of length <i class="farg">n</i> which has been consumed and contains part of a valid multibyte character. The character may be completed by calling <b class="fname">mbrtowc</b>() again with <i class="farg">s</i> pointing to one or more subsequent bytes of the multibyte character and <i class="farg">mbs</i> pointing to the conversion state object used during conversion of the incomplete byte sequence.</dd>
</dl>
</div>
<div class="section">
<h1 id="x4552524f5253">ERRORS</h1> The <b class="fname">mbrtowc</b>() function may cause an error in the following cases:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">EILSEQ</span>]</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
<i class="farg">s</i> points to an invalid multibyte character.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">EINVAL</span>]</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
<i class="farg">mbs</i> points to an invalid or uninitialized mbstate_t object.</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html3/mbrlen.html">mbrlen(3)</a>, <a class="link-man" href="../html3/mbtowc.html">mbtowc(3)</a>, <a class="link-man" href="../html3/setlocale.html">setlocale(3)</a></div>
<div class="section">
<h1 id="x5354414e4441524453">STANDARDS</h1> The <b class="fname">mbrtowc</b>() function conforms to ISO/IEC 9899/AMD1:1995 (&#8220;ISO C90, Amendment 1&#8221;). The restrict qualifier is added at ISO/IEC 9899:1999 (&#8220;ISO C99&#8221;).</div>
<div class="section">
<h1 id="x43415645415453">CAVEATS</h1> <b class="fname">mbrtowc</b>() is not suitable for programs that care about internals of the character encoding scheme used by the byte string pointed to by <i class="farg">s</i>.<div class="spacer">
</div>
It is possible that <b class="fname">mbrtowc</b>() fails because of locale configuration errors. An &#8220;invalid&#8221; character sequence may simply be encoded in a different encoding than that of the current locale.<div class="spacer">
</div>
The special cases for <i class="farg">s</i> == NULL and <i class="farg">mbs</i> == NULL do not make any sense. Instead of passing <span class="define">NULL</span> for <i class="farg">mbs</i>, <a class="link-man" href="../html3/mbtowc.html">mbtowc(3)</a> can be used.<div class="spacer">
</div>
Earlier versions of this man page implied that calling <b class="fname">mbrtowc</b>() with a <span class="define">NULL</span> <i class="farg">s</i> argument would always set <i class="farg">mbs</i> to the initial conversion state. But this is true only if the previous call to <b class="fname">mbrtowc</b>() using <i class="farg">mbs</i> did not return (size_t)-1 or (size_t)-2. It is recommended to zero the mbstate_t object instead.</div>
</div>
</body>
</html>

