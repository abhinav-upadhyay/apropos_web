<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
SSL_CTX_SET_OPTIONS(3)</title>
</head>
<body>
<div class="mandoc">
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">SSL_CTX_set_options</b>, <b class="name">SSL_set_options</b>, <b class="name">SSL_CTX_clear_options</b>, <b class="name">SSL_clear_options</b>, <b class="name">SSL_CTX_get_options</b>, <b class="name">SSL_get_options</b>, <b class="name">SSL_get_secure_renegotiation_support</b> &#8212; <span class="desc">manipulate SSL options</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">openssl/ssl.h</a>&gt;</b><div class="spacer">
</div>
<i class="ftype">long</i><br/>
<b class="fname">SSL_CTX_set_options</b>(<i class="farg" style="white-space:nowrap;">SSL_CTX *ctx</i>, <i class="farg" style="white-space:nowrap;">long options</i>);<div class="spacer">
</div>
<i class="ftype">long</i><br/>
<b class="fname">SSL_set_options</b>(<i class="farg" style="white-space:nowrap;">SSL *ssl</i>, <i class="farg" style="white-space:nowrap;">long options</i>);<div class="spacer">
</div>
<i class="ftype">long</i><br/>
<b class="fname">SSL_CTX_clear_options</b>(<i class="farg" style="white-space:nowrap;">SSL_CTX *ctx</i>, <i class="farg" style="white-space:nowrap;">long options</i>);<div class="spacer">
</div>
<i class="ftype">long</i><br/>
<b class="fname">SSL_clear_options</b>(<i class="farg" style="white-space:nowrap;">SSL *ssl</i>, <i class="farg" style="white-space:nowrap;">long options</i>);<div class="spacer">
</div>
<i class="ftype">long</i><br/>
<b class="fname">SSL_CTX_get_options</b>(<i class="farg" style="white-space:nowrap;">SSL_CTX *ctx</i>);<div class="spacer">
</div>
<i class="ftype">long</i><br/>
<b class="fname">SSL_get_options</b>(<i class="farg" style="white-space:nowrap;">SSL *ssl</i>);<div class="spacer">
</div>
<i class="ftype">long</i><br/>
<b class="fname">SSL_get_secure_renegotiation_support</b>(<i class="farg" style="white-space:nowrap;">SSL *ssl</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> Note: all these functions are implemented using macros.<div class="spacer">
</div>
<b class="fname">SSL_CTX_set_options</b>() adds the options set via bitmask in <i class="farg">options</i> to <i class="farg">ctx</i>. Options already set before are not cleared!<div class="spacer">
</div>
<b class="fname">SSL_set_options</b>() adds the options set via bitmask in <i class="farg">options</i> to <i class="farg">ssl</i>. Options already set before are not cleared!<div class="spacer">
</div>
<b class="fname">SSL_CTX_clear_options</b>() clears the options set via bitmask in <i class="farg">options</i> to <i class="farg">ctx</i>.<div class="spacer">
</div>
<b class="fname">SSL_clear_options</b>() clears the options set via bitmask in <i class="farg">options</i> to <i class="farg">ssl</i>.<div class="spacer">
</div>
<b class="fname">SSL_CTX_get_options</b>() returns the options set for <i class="farg">ctx</i>.<div class="spacer">
</div>
<b class="fname">SSL_get_options</b>() returns the options set for <i class="farg">ssl</i>.<div class="spacer">
</div>
<b class="fname">SSL_get_secure_renegotiation_support</b>() indicates whether the peer supports secure renegotiation.</div>
<div class="section">
<h1 id="x4e4f544553">NOTES</h1> The behaviour of the SSL library can be changed by setting several options. The options are coded as bitmasks and can be combined by a bitwise OR operation (|).<div class="spacer">
</div>
<b class="fname">SSL_CTX_set_options</b>() and <b class="fname">SSL_set_options</b>() affect the (external) protocol behaviour of the SSL library. The (internal) behaviour of the API can be changed by using the similar <a class="link-man" href="../html3/SSL_CTX_set_mode.html">SSL_CTX_set_mode(3)</a> and <a class="link-man" href="../html3/SSL_set_mode.html">SSL_set_mode(3)</a> functions.<div class="spacer">
</div>
During a handshake, the option settings of the SSL object are used. When a new SSL object is created from a context using <a class="link-man" href="../html3/SSL_new.html">SSL_new(3)</a>, the current option setting is copied. Changes to <i class="farg">ctx</i> do not affect already created <span class="type">SSL</span> objects. <b class="fname">SSL_clear</b>() does not affect the settings.<div class="spacer">
</div>
The following <span class="emph">bug workaround</span> options are available:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">SSL_OP_MICROSOFT_SESS_ID_BUG</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
As of <span class="unix">OpenBSD&#160;5.8</span>, this option has no effect.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">SSL_OP_NETSCAPE_CHALLENGE_BUG</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
As of <span class="unix">OpenBSD&#160;5.8</span>, this option has no effect.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">SSL_OP_NETSCAPE_REUSE_CIPHER_CHANGE_BUG</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
As of OpenSSL 0.9.8q and 1.0.0c, this option has no effect.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">SSL_OP_SSLREF2_REUSE_CERT_TYPE_BUG</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
As of <span class="unix">OpenBSD&#160;5.8</span>, this option has no effect.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">SSL_OP_MICROSOFT_BIG_SSLV3_BUFFER</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
As of <span class="unix">OpenBSD&#160;5.8</span>, this option has no effect.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">SSL_OP_SAFARI_ECDHE_ECDSA_BUG</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
As of <span class="unix">OpenBSD&#160;5.8</span>, this option has no effect.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">SSL_OP_SSLEAY_080_CLIENT_DH_BUG</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
As of <span class="unix">OpenBSD&#160;5.8</span>, this option has no effect.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">SSL_OP_TLS_D5_BUG</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
As of <span class="unix">OpenBSD&#160;5.8</span>, this option has no effect.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">SSL_OP_TLS_BLOCK_PADDING_BUG</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
As of <span class="unix">OpenBSD&#160;5.8</span>, this option has no effect.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">SSL_OP_DONT_INSERT_EMPTY_FRAGMENTS</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Disables a countermeasure against a SSL 3.0/TLS 1.0 protocol vulnerability affecting CBC ciphers, which cannot be handled by some broken SSL implementations. This option has no effect for connections using other ciphers.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">SSL_OP_TLSEXT_PADDING</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Adds a padding extension to ensure the ClientHello size is never between 256 and 511 bytes in length. This is needed as a workaround for some implementations.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">SSL_OP_ALL</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
All of the above bug workarounds.</dd>
</dl>
<div class="spacer">
</div>
It is usually safe to use <span class="define">SSL_OP_ALL</span> to enable the bug workaround options if compatibility with somewhat broken implementations is desired.<div class="spacer">
</div>
The following <span class="emph">modifying</span> options are available:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">SSL_OP_TLS_ROLLBACK_BUG</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Disable version rollback attack detection.<div class="spacer">
</div>
During the client key exchange, the client must send the same information about acceptable SSL/TLS protocol levels as during the first hello. Some clients violate this rule by adapting to the server's answer. (Example: the client sends a SSLv2 hello and accepts up to SSLv3.1=TLSv1, the server only understands up to SSLv3. In this case the client must still use the same SSLv3.1=TLSv1 announcement. Some clients step down to SSLv3 with respect to the server's answer and violate the version rollback protection.)</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">SSL_OP_SINGLE_DH_USE</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Always create a new key when using temporary/ephemeral DH parameters (see <a class="link-man" href="../html3/SSL_CTX_set_tmp_dh_callback.html">SSL_CTX_set_tmp_dh_callback(3)</a>). This option must be used to prevent small subgroup attacks, when the DH parameters were not generated using &#8220;strong&#8221; primes (e.g., when using DSA-parameters, see <a class="link-man" href="../html1/openssl.html">openssl(1)</a>). If &#8220;strong&#8221; primes were used, it is not strictly necessary to generate a new DH key during each handshake but it is also recommended. <span class="define">SSL_OP_SINGLE_DH_USE</span> should therefore be enabled whenever temporary/ephemeral DH parameters are used.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
SSL_OP_EPHEMERAL_RSA</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Always use ephemeral (temporary) RSA key when doing RSA operations (see <a class="link-man" href="../html3/SSL_CTX_set_tmp_rsa_callback.html">SSL_CTX_set_tmp_rsa_callback(3)</a>). According to the specifications, this is only done when a RSA key can only be used for signature operations (namely under export ciphers with restricted RSA keylength). By setting this option, ephemeral RSA keys are always used. This option breaks compatibility with the SSL/TLS specifications and may lead to interoperability problems with clients and should therefore never be used. Ciphers with EDH (ephemeral Diffie-Hellman) key exchange should be used instead.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">SSL_OP_CIPHER_SERVER_PREFERENCE</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
When choosing a cipher, use the server's preferences instead of the client preferences. When not set, the SSL server will always follow the client's preferences. When set, the SSLv3/TLSv1 server will choose following its own preferences. Because of the different protocol, for SSLv2 the server will send its list of preferences to the client and the client chooses.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">SSL_OP_NETSCAPE_CA_DN_BUG</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
As of <span class="unix">OpenBSD&#160;5.8</span>, this option has no effect.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">SSL_OP_NETSCAPE_DEMO_CIPHER_CHANGE_BUG</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
As of <span class="unix">OpenBSD&#160;5.8</span>, this option has no effect.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">SSL_OP_NO_SSLv2</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
As of <span class="unix">OpenBSD&#160;5.6</span>, this option has no effect as SSLv2 support has been removed. In previous versions it disabled use of the SSLv2 protocol.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">SSL_OP_NO_SSLv3</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Do not use the SSLv3 protocol.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">SSL_OP_NO_TLSv1</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Do not use the TLSv1.0 protocol.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">SSL_OP_NO_TLSv1_1</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Do not use the TLSv1.1 protocol.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">SSL_OP_NO_TLSv1_2</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Do not use the TLSv1.2 protocol.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">SSL_OP_NO_SESSION_RESUMPTION_ON_RENEGOTIATION</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
When performing renegotiation as a server, always start a new session (i.e., session resumption requests are only accepted in the initial handshake). This option is not needed for clients.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">SSL_OP_NO_TICKET</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Normally clients and servers will, where possible, transparently make use of RFC4507bis tickets for stateless session resumption.<div class="spacer">
</div>
If this option is set this functionality is disabled and tickets will not be used by clients or servers.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">SSL_OP_ALLOW_UNSAFE_LEGACY_RENEGOTIATION</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
As of <span class="unix">OpenBSD&#160;5.6</span>, this option has no effect. In previous versions it allowed legacy insecure renegotiation between OpenSSL and unpatched clients or servers. See the <i class="link-sec"><a class="link-sec" href="#x5345435552452052454e45474f54494154494f4e">SECURE RENEGOTIATION</a></i> section for more details.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">SSL_OP_LEGACY_SERVER_CONNECT</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Allow legacy insecure renegotiation between OpenSSL and unpatched servers <span class="emph">only</span>: this option is currently set by default. See the <i class="link-sec"><a class="link-sec" href="#x5345435552452052454e45474f54494154494f4e">SECURE RENEGOTIATION</a></i> section for more details.</dd>
</dl>
</div>
<div class="section">
<h1 id="x5345435552452052454e45474f54494154494f4e">SECURE RENEGOTIATION</h1> OpenSSL 0.9.8m and later always attempts to use secure renegotiation as described in RFC5746. This counters the prefix attack described in CVE-2009-3555 and elsewhere.<div class="spacer">
</div>
The deprecated and highly broken SSLv2 protocol does not support renegotiation at all; its use is <span class="emph">strongly</span> discouraged.<div class="spacer">
</div>
This attack has far-reaching consequences which application writers should be aware of. In the description below an implementation supporting secure renegotiation is referred to as &#8220;patched&#8221;. A server not supporting secure renegotiation is referred to as &#8220;unpatched&#8221;.<div class="spacer">
</div>
The following sections describe the operations permitted by OpenSSL's secure renegotiation implementation.<div class="subsection">
<h2 id="x5061746368656420636c69656e7420616e6420736572766572">Patched client and server</h2> Connections and renegotiation are always permitted by OpenSSL implementations.</div>
<div class="subsection">
<h2 id="x556e7061746368656420636c69656e7420616e642070617463686564204f70656e53534c20736572766572">Unpatched client and patched OpenSSL server</h2> The initial connection succeeds but client renegotiation is denied by the server with a <span class="emph">no_renegotiation</span> warning alert if TLS v1.0 is used or a fatal <span class="emph">handshake_failure</span> alert in SSL v3.0.<div class="spacer">
</div>
If the patched OpenSSL server attempts to renegotiate a fatal <span class="emph">handshake_failure</span> alert is sent. This is because the server code may be unaware of the unpatched nature of the client.<div class="spacer">
</div>
<span class="emph">N.B.:</span> a bug in OpenSSL clients earlier than 0.9.8m (all of which are unpatched) will result in the connection hanging if it receives a <span class="emph">no_renegotiation</span> alert. OpenSSL versions 0.9.8m and later will regard a <span class="emph">no_renegotiation</span> alert as fatal and respond with a fatal <span class="emph">handshake_failure</span> alert. This is because the OpenSSL API currently has no provision to indicate to an application that a renegotiation attempt was refused.</div>
<div class="subsection">
<h2 id="x50617463686564204f70656e53534c20636c69656e7420616e6420756e7061746368656420736572766572">Patched OpenSSL client and unpatched server</h2> If the option <span class="define">SSL_OP_LEGACY_SERVER_CONNECT</span> is set then initial connections and renegotiation between patched OpenSSL clients and unpatched servers succeeds. If neither option is set then initial connections to unpatched servers will fail.<div class="spacer">
</div>
The option <span class="define">SSL_OP_LEGACY_SERVER_CONNECT</span> is currently set by default even though it has security implications: otherwise it would be impossible to connect to unpatched servers (i.e., all of them initially) and this is clearly not acceptable. Renegotiation is permitted because this does not add any additional security issues: during an attack clients do not see any renegotiations anyway.<div class="spacer">
</div>
As more servers become patched the option <span class="define">SSL_OP_LEGACY_SERVER_CONNECT</span> will <span class="emph">not</span> be set by default in a future version of OpenSSL.<div class="spacer">
</div>
OpenSSL client applications wishing to ensure they can connect to unpatched servers should always <span class="emph">set</span> <span class="define">SSL_OP_LEGACY_SERVER_CONNECT</span><div class="spacer">
</div>
OpenSSL client applications that want to ensure they can <span class="emph">not</span> connect to unpatched servers (and thus avoid any security issues) should always <span class="emph">clear</span> <span class="define">SSL_OP_LEGACY_SERVER_CONNECT</span> using <b class="fname">SSL_CTX_clear_options</b>() or <b class="fname">SSL_clear_options</b>().</div>
</div>
<div class="section">
<h1 id="x52455455524e2056414c554553">RETURN VALUES</h1> <b class="fname">SSL_CTX_set_options</b>() and <b class="fname">SSL_set_options</b>() return the new options bitmask after adding <i class="farg">options</i>.<div class="spacer">
</div>
<b class="fname">SSL_CTX_clear_options</b>() and <b class="fname">SSL_clear_options</b>() return the new options bitmask after clearing <i class="farg">options</i>.<div class="spacer">
</div>
<b class="fname">SSL_CTX_get_options</b>() and <b class="fname">SSL_get_options</b>() return the current bitmask.<div class="spacer">
</div>
<b class="fname">SSL_get_secure_renegotiation_support</b>() returns 1 is the peer supports secure renegotiation and 0 if it does not.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html1/openssl.html">openssl(1)</a>, <a class="link-man" href="../html3/ssl.html">ssl(3)</a>, <a class="link-man" href="../html3/SSL_clear.html">SSL_clear(3)</a>, <a class="link-man" href="../html3/SSL_CTX_set_tmp_dh_callback.html">SSL_CTX_set_tmp_dh_callback(3)</a>, <a class="link-man" href="../html3/SSL_CTX_set_tmp_rsa_callback.html">SSL_CTX_set_tmp_rsa_callback(3)</a>, <a class="link-man" href="../html3/SSL_new.html">SSL_new(3)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> <span class="define">SSL_OP_CIPHER_SERVER_PREFERENCE</span> and <span class="define">SSL_OP_NO_SESSION_RESUMPTION_ON_RENEGOTIATION</span> have been added in OpenSSL 0.9.7.<div class="spacer">
</div>
<span class="define">SSL_OP_TLS_ROLLBACK_BUG</span> has been added in OpenSSL 0.9.6 and was automatically enabled with <span class="define">SSL_OP_ALL</span>. As of 0.9.7, it is no longer included in <span class="define">SSL_OP_ALL</span> and must be explicitly set.<div class="spacer">
</div>
<span class="define">SSL_OP_DONT_INSERT_EMPTY_FRAGMENTS</span> has been added in OpenSSL 0.9.6e. Versions up to OpenSSL 0.9.6c do not include the countermeasure that can be disabled with this option (in OpenSSL 0.9.6d, it was always enabled).<div class="spacer">
</div>
<b class="fname">SSL_CTX_clear_options</b>() and <b class="fname">SSL_clear_options</b>() were first added in OpenSSL 0.9.8m.<div class="spacer">
</div>
<span class="define">SSL_OP_ALLOW_UNSAFE_LEGACY_RENEGOTIATION</span>, <span class="define">SSL_OP_LEGACY_SERVER_CONNECT</span> and the function <b class="fname">SSL_get_secure_renegotiation_support</b>() were first added in OpenSSL 0.9.8m.<div class="spacer">
</div>
<span class="define">SSL_OP_NO_SSLv2</span> and <span class="define">SSL_OP_ALLOW_UNSAFE_LEGACY_RENEGOTIATION</span> were changed to have no effect in <span class="unix">OpenBSD&#160;5.6</span>.</div>
</div>
</body>
</html>

