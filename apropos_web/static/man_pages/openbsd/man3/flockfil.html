<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
FLOCKFILE(3)</title>
</head>
<body>
<div class="mandoc">
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">flockfile</b>, <b class="name">ftrylockfile</b>, <b class="name">funlockfile</b> &#8212; <span class="desc">application level locking of stdio files</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">stdio.h</a>&gt;</b><div class="spacer">
</div>
<i class="ftype">void</i><br/>
<b class="fname">flockfile</b>(<i class="farg" style="white-space:nowrap;">FILE *file</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">ftrylockfile</b>(<i class="farg" style="white-space:nowrap;">FILE *file</i>);<div class="spacer">
</div>
<i class="ftype">void</i><br/>
<b class="fname">funlockfile</b>(<i class="farg" style="white-space:nowrap;">FILE *file</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="fname">flockfile</b>(), <b class="fname">ftrylockfile</b>(), and <b class="fname">funlockfile</b>() functions provide for explicit application-level locking of stdio <i class="ftype">FILE *</i> objects. These functions can be used by a thread to delineate a sequence of I/O statements that are to be executed as a unit.<div class="spacer">
</div>
The <b class="fname">flockfile</b>() function is used by a thread to acquire ownership of a <i class="ftype">FILE *</i> object.<div class="spacer">
</div>
The <b class="fname">ftrylockfile</b>() function is used by a thread to acquire ownership of a <i class="ftype">FILE *</i> object if the object is available; <b class="fname">ftrylockfile</b>() is a non-blocking version of <b class="fname">flockfile</b>().<div class="spacer">
</div>
The <b class="fname">funlockfile</b>() function is used to relinquish the ownership granted to the thread. The behaviour is undefined if a thread other than the current owner calls the <b class="fname">funlockfile</b>() function.<div class="spacer">
</div>
Logically, there is a lock count associated with each <i class="ftype">FILE *</i> object. This count is implicitly initialized to zero when the <i class="ftype">FILE *</i> object is created. The <i class="ftype">FILE *</i> object is unlocked when the count is zero. When the count is positive, a single thread owns the <i class="ftype">FILE *</i> object. When the <b class="fname">flockfile</b>() function is called, if the count is zero or if the count is positive and the caller owns the <i class="ftype">FILE *</i> object, the count is incremented. Otherwise, the calling thread is suspended, waiting for the count to return to zero. Each call to <b class="fname">funlockfile</b>() decrements the count. This allows matching calls to <b class="fname">flockfile</b>() (or successful calls to <b class="fname">ftrylockfile</b>()) and <b class="fname">funlockfile</b>() to be nested.<div class="spacer">
</div>
Library functions that reference <i class="ftype">FILE *</i> behave as if they use <b class="fname">flockfile</b>() and <b class="fname">funlockfile</b>() internally to obtain ownership of these <i class="ftype">FILE *</i> objects.</div>
<div class="section">
<h1 id="x52455455524e2056414c554553">RETURN VALUES</h1> None for <b class="fname">flockfile</b>() and <b class="fname">funlockfile</b>(). The function <b class="fname">ftrylockfile</b>() returns zero for success and non-zero to indicate that the lock cannot be acquired.</div>
<div class="section">
<h1 id="x4552524f5253">ERRORS</h1> None.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html3/getc_unlocked.html">getc_unlocked(3)</a>, <a class="link-man" href="../html3/getchar_unlocked.html">getchar_unlocked(3)</a>, <a class="link-man" href="../html3/pthreads.html">pthreads(3)</a>, <a class="link-man" href="../html3/putc_unlocked.html">putc_unlocked(3)</a>, <a class="link-man" href="../html3/putchar_unlocked.html">putchar_unlocked(3)</a></div>
<div class="section">
<h1 id="x5354414e4441524453">STANDARDS</h1> <b class="fname">flockfile</b>(), <b class="fname">ftrylockfile</b>() and <b class="fname">funlockfile</b>() conform to ISO/IEC 9945-1 ANSI/IEEE (&#8220;POSIX&#8221;) Std 1003.1c/D10.</div>
</div>
</body>
</html>

