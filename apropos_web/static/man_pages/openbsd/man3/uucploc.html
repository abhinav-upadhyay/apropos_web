<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
UU_LOCK(3)</title>
</head>
<body>
<div class="mandoc">
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">uu_lock</b>, <b class="name">uu_unlock</b>, <b class="name">uu_lockerr</b>, <b class="name">uu_lock_txfr</b> &#8212; <span class="desc">acquire and release control of a serial device</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">sys/types.h</a>&gt;</b><br/>
<b class="includes">#include &lt;<a class="link-includes">util.h</a>&gt;</b><div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">uu_lock</b>(<i class="farg" style="white-space:nowrap;">const char *ttyname</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">uu_lock_txfr</b>(<i class="farg" style="white-space:nowrap;">const char *ttyname</i>, <i class="farg" style="white-space:nowrap;">pid_t pid</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">uu_unlock</b>(<i class="farg" style="white-space:nowrap;">const char *ttyname</i>);<div class="spacer">
</div>
<i class="ftype">const char *</i><br/>
<b class="fname">uu_lockerr</b>(<i class="farg" style="white-space:nowrap;">int uu_lockresult</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="fname">uu_lock</b>() function attempts to create a lock file called <i class="file">/var/spool/lock/LCK..</i> with a suffix given by the passed <i class="farg">ttyname</i>. If the file already exists, it is expected to contain the process ID of the locking program.<div class="spacer">
</div>
If the file does not already exist, or the owning process given by the process ID found in the lock file is no longer running, <b class="fname">uu_lock</b>() will write its own process ID into the file and return success.<div class="spacer">
</div>
<b class="fname">uu_lock_txfr</b>() transfers lock ownership to another process. <b class="fname">uu_lock</b>() must have previously been successful.<div class="spacer">
</div>
<b class="fname">uu_unlock</b>() removes the lockfile created by <b class="fname">uu_lock</b>() for the given <i class="farg">ttyname</i>. Care should be taken that <b class="fname">uu_lock</b>() was successful before calling <b class="fname">uu_unlock</b>().<div class="spacer">
</div>
<b class="fname">uu_lockerr</b>() returns an error string representing the error <i class="farg">uu_lockresult</i>, as returned from <b class="fname">uu_lock</b>().</div>
<div class="section">
<h1 id="x52455455524e2056414c554553">RETURN VALUES</h1> <b class="fname">uu_unlock</b>() returns 0 on success and -1 on failure.<div class="spacer">
</div>
<b class="fname">uu_lock</b>() may return any of the following values:<div class="spacer">
</div>
<span class="define">UU_LOCK_INUSE</span>: The lock is in use by another process.<div class="spacer">
</div>
<span class="define">UU_LOCK_OK</span>: The lock was successfully created.<div class="spacer">
</div>
<span class="define">UU_LOCK_OPEN_ERR</span>: The lock file could not be opened via <a class="link-man" href="../html2/open.html">open(2)</a>.<div class="spacer">
</div>
<span class="define">UU_LOCK_READ_ERR</span>: The lock file could not be read via <a class="link-man" href="../html2/read.html">read(2)</a>.<div class="spacer">
</div>
<span class="define">UU_LOCK_CREAT_ERR</span>: Can't create temporary lock file via <a class="link-man" href="../html3/creat.html">creat(3)</a>.<div class="spacer">
</div>
<span class="define">UU_LOCK_WRITE_ERR</span>: The current process ID could not be written to the lock file via a call to <a class="link-man" href="../html2/write.html">write(2)</a>.<div class="spacer">
</div>
<span class="define">UU_LOCK_LINK_ERR</span>: Can't link temporary lock file via <a class="link-man" href="../html2/link.html">link(2)</a>.<div class="spacer">
</div>
<span class="define">UU_LOCK_TRY_ERR</span>: Locking attempts are failed after 5 tries.<div class="spacer">
</div>
If a value of <span class="define">UU_LOCK_OK</span> is passed to <b class="fname">uu_lockerr</b>(), an empty string is returned. Otherwise, a string specifying the reason for failure is returned. <b class="fname">uu_lockerr</b>() uses the current value of <b class="var">errno</b> to determine the exact error. Care should be made not to allow <b class="var">errno</b> to be changed between calls to <b class="fname">uu_lock</b>() and <b class="fname">uu_lockerr</b>().<div class="spacer">
</div>
<b class="fname">uu_lock_txfr</b>() may return any of the following values:<div class="spacer">
</div>
<span class="define">UU_LOCK_OK</span>: The transfer was successful. The specified process now holds the device lock.<div class="spacer">
</div>
<span class="define">UU_LOCK_OWNER_ERR</span>: The current process does not already own a lock on the specified device.<div class="spacer">
</div>
<span class="define">UU_LOCK_WRITE_ERR</span>: The new process ID could not be written to the lock file via a call to <a class="link-man" href="../html2/write.html">write(2)</a>.</div>
<div class="section">
<h1 id="x4552524f5253">ERRORS</h1> If <b class="fname">uu_lock</b>() returns one of the error values above, the global value <b class="var">errno</b> can be used to determine the cause. Refer to the respective manual pages for further details.<div class="spacer">
</div>
<b class="fname">uu_unlock</b>() will set the global variable <b class="var">errno</b> to reflect the reason that the lock file could not be removed. Refer to the description of <a class="link-man" href="../html2/unlink.html">unlink(2)</a> for further details.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html2/lseek.html">lseek(2)</a>, <a class="link-man" href="../html2/open.html">open(2)</a>, <a class="link-man" href="../html2/read.html">read(2)</a>, <a class="link-man" href="../html2/write.html">write(2)</a></div>
<div class="section">
<h1 id="x42554753">BUGS</h1> It is possible that a stale lock is not recognised as such if a new process is assigned the same process ID as the program that left the stale lock.<div class="spacer">
</div>
The calling process must have write permissions to the <i class="file">/var/spool/lock</i> directory. There is no mechanism in place to ensure that the permissions of this directory are the same as those of the serial devices that might be locked.</div>
</div>
</body>
</html>

