<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
RCMD(3)</title>
</head>
<body>
<div class="mandoc">
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">rcmd</b>, <b class="name">rcmd_af</b>, <b class="name">rresvport</b>, <b class="name">rresvport_af</b>, <b class="name">ruserok</b> &#8212; <span class="desc">routines for returning a stream to a remote command</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">unistd.h</a>&gt;</b><div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">rcmd</b>(<i class="farg" style="white-space:nowrap;">char **ahost</i>, <i class="farg" style="white-space:nowrap;">int inport</i>, <i class="farg" style="white-space:nowrap;">const char *locuser</i>, <i class="farg" style="white-space:nowrap;">const char *remuser</i>, <i class="farg" style="white-space:nowrap;">const char *cmd</i>, <i class="farg" style="white-space:nowrap;">int *fd2p</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">rcmd_af</b>(<i class="farg" style="white-space:nowrap;">char **ahost</i>, <i class="farg" style="white-space:nowrap;">int inport</i>, <i class="farg" style="white-space:nowrap;">const char *locuser</i>, <i class="farg" style="white-space:nowrap;">const char *remuser</i>, <i class="farg" style="white-space:nowrap;">const char *cmd</i>, <i class="farg" style="white-space:nowrap;">int *fd2p</i>, <i class="farg" style="white-space:nowrap;">int af</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">rresvport</b>(<i class="farg" style="white-space:nowrap;">int *port</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">rresvport_af</b>(<i class="farg" style="white-space:nowrap;">int *port</i>, <i class="farg" style="white-space:nowrap;">int af</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">ruserok</b>(<i class="farg" style="white-space:nowrap;">const char *rhost</i>, <i class="farg" style="white-space:nowrap;">int superuser</i>, <i class="farg" style="white-space:nowrap;">const char *ruser</i>, <i class="farg" style="white-space:nowrap;">const char *luser</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="fname">rcmd</b>() function is used by the superuser to execute a command on a remote machine using an authentication scheme based on reserved port numbers. If the calling process is not setuid, the <span class="env">RSH</span> environment variable is set, and <i class="farg">inport</i> is &#8220;shell/tcp&#8221;, <a class="link-man" href="../html3/rcmdsh.html">rcmdsh(3)</a> is called instead with the value of <span class="env">RSH</span>. Alternately, if the user is not the superuser, <b class="fname">rcmd</b>() will invoke <a class="link-man" href="../html3/rcmdsh.html">rcmdsh(3)</a> to run the command via <a class="link-man" href="../html1/ssh.html">ssh(1)</a>. While <b class="fname">rcmd</b>() can handle IPv4 cases only, the <b class="fname">rcmd_af</b>() function can handle other cases as well.<div class="spacer">
</div>
The <b class="fname">rresvport</b>() and <b class="fname">rresvport_af</b>() functions return a descriptor to a socket with an address in the privileged port space. The <b class="fname">ruserok</b>() function is used by servers to authenticate clients requesting service with <b class="fname">rcmd</b>().<div class="spacer">
</div>
The <b class="fname">rcmd</b>() function looks up the host <i class="farg">*ahost</i> using <a class="link-man" href="../html3/getaddrinfo.html">getaddrinfo(3)</a> and, if the host exists, <i class="farg">*ahost</i> is set to the canonical name of the host. A connection is then established to a server residing at the well-known Internet port <i class="farg">inport</i>. If the user is not the superuser, the only valid port is &#8220;shell/tcp&#8221; (usually port 514).<div class="spacer">
</div>
If the connection succeeds, a socket in the Internet domain of type <span class="define">SOCK_STREAM</span> is returned to the caller, and given to the remote command as stdin and stdout. If <i class="farg">fd2p</i> is non-zero, then an auxiliary channel to a control process will be set up, and a descriptor for it will be placed in <i class="farg">*fd2p</i>. The control process will return diagnostic output from the command (unit 2) on this channel, and will also accept bytes on this channel as being UNIX signal numbers, to be forwarded to the process group of the command. If <i class="farg">fd2p</i> is <b class="var">NULL</b>, then the standard error (unit 2 of the remote command) will be made the same as the standard output and no provision is made for sending arbitrary signals to the remote process, although you may be able to get its attention by using out-of-band data. Note that if the user is not the superuser, <i class="farg">fd2p</i> must be <b class="var">NULL</b>.<div class="spacer">
</div>
<b class="fname">rcmd_af</b>() takes address family in the last argument. If the last argument is <span class="define">AF_UNSPEC</span>, interpretation of <i class="farg">*ahost</i> will obey the underlying address resolution like DNS.<div class="spacer">
</div>
The <b class="fname">rresvport</b>() and <b class="fname">rresvport_af</b>() functions are used to obtain a socket with a privileged address bound to it. This socket is suitable for use by <b class="fname">rcmd</b>() and several other functions. Privileged Internet ports are those in the range 0 to <b class="var">IPPORT_RESERVED - 1</b>, which happens to be 1023. Only the superuser is allowed to bind an address of this sort to a socket. <b class="fname">rresvport</b>() and <b class="fname">rresvport_af</b>() need to be seeded with a port number; if that port is not available these functions will find another.<div class="spacer">
</div>
The <b class="fname">ruserok</b>() function takes a remote host's name, two user names, and a flag indicating whether the local user's name is that of the superuser. Then, if the user is <span class="emph">not</span> the superuser, it checks the <i class="file">/etc/hosts.equiv</i> file. If that lookup is not done, or is unsuccessful, the <i class="file">.rhosts</i> in the local user's home directory is checked to see if the request for service is allowed.<div class="spacer">
</div>
If this file does not exist, is not a regular file, is owned by anyone other than the user or the superuser, or is writeable by anyone other than the owner, the check automatically fails. Zero is returned if the machine name is listed in the <i class="file">hosts.equiv</i> file, or the host and remote user name are found in the <i class="file">.rhosts</i> file; otherwise <b class="fname">ruserok</b>() returns -1. If the local domain (as obtained from <a class="link-man" href="../html3/getaddrinfo.html">getaddrinfo(3)</a>) is the same as the remote domain, only the machine name need be specified.<div class="spacer">
</div>
<b class="fname">ruserok</b>() implicitly requires trusting the DNS server for the remote host's domain.</div>
<div class="section">
<h1 id="x444941474e4f5354494353">DIAGNOSTICS</h1> The <b class="fname">rcmd</b>() function returns a valid socket descriptor on success. It returns -1 on error and prints a diagnostic message on the standard error.<div class="spacer">
</div>
The <b class="fname">rresvport</b>() and <b class="fname">rresvport_af</b>() functions return a valid, bound socket descriptor on success. It returns -1 on error with the global value <b class="var">errno</b> set according to the reason for failure. The error code <span class="errno">EAGAIN</span> is overloaded to mean &#8220;all network ports in use&#8221;.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html1/ssh.html">ssh(1)</a>, <a class="link-man" href="../html2/intro.html">intro(2)</a>, <a class="link-man" href="../html3/bindresvport.html">bindresvport(3)</a>, <a class="link-man" href="../html3/bindresvport_sa.html">bindresvport_sa(3)</a>, <a class="link-man" href="../html3/rcmdsh.html">rcmdsh(3)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> These functions appeared in <span class="unix">4.2BSD</span>.<div class="spacer">
</div>
The <b class="fname">iruserok</b>() and <b class="fname">iruserok_sa</b>() functions, IP address based versions of <b class="fname">ruserok</b>(), were removed in <span class="unix">OpenBSD&#160;6.0</span>.</div>
</div>
</body>
</html>

