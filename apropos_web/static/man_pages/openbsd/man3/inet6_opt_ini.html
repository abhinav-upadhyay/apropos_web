<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
INET6_OPT_INIT(3)</title>
</head>
<body>
<div class="mandoc">
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">inet6_opt_init</b>, <b class="name">inet6_opt_append</b>, <b class="name">inet6_opt_finish</b>, <b class="name">inet6_opt_set_val</b>, <b class="name">inet6_opt_next</b>, <b class="name">inet6_opt_find</b>, <b class="name">inet6_opt_get_val</b> &#8212; <span class="desc">IPv6 Hop-by-Hop and Destination Options manipulation</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">netinet/in.h</a>&gt;</b><div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">inet6_opt_init</b>(<i class="farg" style="white-space:nowrap;">void *extbuf</i>, <i class="farg" style="white-space:nowrap;">socklen_t extlen</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">inet6_opt_append</b>(<i class="farg" style="white-space:nowrap;">void *extbuf</i>, <i class="farg" style="white-space:nowrap;">socklen_t extlen</i>, <i class="farg" style="white-space:nowrap;">int offset</i>, <i class="farg" style="white-space:nowrap;">u_int8_t type</i>, <i class="farg" style="white-space:nowrap;">socklen_t len</i>, <i class="farg" style="white-space:nowrap;">u_int8_t align</i>, <i class="farg" style="white-space:nowrap;">void **databufp</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">inet6_opt_finish</b>(<i class="farg" style="white-space:nowrap;">void *extbuf</i>, <i class="farg" style="white-space:nowrap;">socklen_t extlen</i>, <i class="farg" style="white-space:nowrap;">int offset</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">inet6_opt_set_val</b>(<i class="farg" style="white-space:nowrap;">void *databuf</i>, <i class="farg" style="white-space:nowrap;">int offset</i>, <i class="farg" style="white-space:nowrap;">void *val</i>, <i class="farg" style="white-space:nowrap;">socklen_t vallen</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">inet6_opt_next</b>(<i class="farg" style="white-space:nowrap;">void *extbuf</i>, <i class="farg" style="white-space:nowrap;">socklen_t extlen</i>, <i class="farg" style="white-space:nowrap;">int offset</i>, <i class="farg" style="white-space:nowrap;">u_int8_t *typep</i>, <i class="farg" style="white-space:nowrap;">socklen_t *lenp</i>, <i class="farg" style="white-space:nowrap;">void **databufp</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">inet6_opt_find</b>(<i class="farg" style="white-space:nowrap;">void *extbuf</i>, <i class="farg" style="white-space:nowrap;">socklen_t extlen</i>, <i class="farg" style="white-space:nowrap;">int offset</i>, <i class="farg" style="white-space:nowrap;">u_int8_t type</i>, <i class="farg" style="white-space:nowrap;">socklen_t *lenp</i>, <i class="farg" style="white-space:nowrap;">void **databufp</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">inet6_opt_get_val</b>(<i class="farg" style="white-space:nowrap;">void *databuf</i>, <i class="farg" style="white-space:nowrap;">socklen_t offset</i>, <i class="farg" style="white-space:nowrap;">void *val</i>, <i class="farg" style="white-space:nowrap;">socklen_t vallen</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> Building and parsing the Hop-by-Hop and Destination options is complicated. The advanced sockets API defines a set of functions to help applications create and manipulate Hop-by-Hop and Destination options. These functions use the formatting rules specified in Appendix B in RFC 2460, i.e. that the largest field is placed last in the option. The function prototypes for these functions are all contained in the header file <b class="includes">&lt;<a class="link-includes">netinet/in.h</a>&gt;</b>.<div class="subsection">
<h2 id="x696e6574365f6f70745f696e6974">inet6_opt_init</h2> The <b class="fname">inet6_opt_init</b>() function returns the number of bytes needed for an empty extension header, one without any options. If the <b class="var">extbuf</b> argument points to a valid section of memory then the <b class="fname">inet6_opt_init</b>() function also initializes the extension header's length field. When attempting to initialize an extension buffer passed in the <b class="var">extbuf</b> argument, <i class="farg">extlen</i> must be a positive multiple of 8 or else the function fails and returns -1 to the caller.</div>
<div class="subsection">
<h2 id="x696e6574365f6f70745f617070656e64">inet6_opt_append</h2> The <b class="fname">inet6_opt_append</b>() function can perform different jobs. When a valid <i class="farg">extbuf</i> argument is supplied it appends an option to the extension buffer and returns the updated total length as well as a pointer to the newly created option in <i class="farg">databufp</i>. If the value of <i class="farg">extbuf</i> is <span class="define">NULL</span> then the <b class="fname">inet6_opt_append</b>() function only reports what the total length would be if the option were actually appended. The <i class="farg">len</i> and <i class="farg">align</i> arguments specify the length of the option and the required data alignment which must be used when appending the option. The <i class="farg">offset</i> argument should be the length returned by the <b class="fname">inet6_opt_init</b>() function or a previous call to <b class="fname">inet6_opt_append</b>().<div class="spacer">
</div>
The <i class="farg">type</i> argument is the 8-bit option type.<div class="spacer">
</div>
After <b class="fname">inet6_opt_append</b>() has been called, the application can use the buffer pointed to by <i class="farg">databufp</i> directly, or use <b class="fname">inet6_opt_set_val</b>() to specify the data to be contained in the option.<div class="spacer">
</div>
Option types of <code class="lit">0</code> and <code class="lit">1</code> are reserved for the <code class="lit">Pad1</code> and <code class="lit">PadN</code> options. All other values from 2 through 255 may be used by applications.<div class="spacer">
</div>
The length of the option data is contained in an 8-bit value and so may contain any value from 0 through 255.<div class="spacer">
</div>
The <i class="farg">align</i> parameter must have a value of 1, 2, 4, or 8 and cannot exceed the value of <i class="farg">len</i>. The alignment values represent no alignment, 16-bit, 32-bit and 64-bit alignments respectively.</div>
<div class="subsection">
<h2 id="x696e6574365f6f70745f66696e697368">inet6_opt_finish</h2> The <b class="fname">inet6_opt_finish</b>() calculates the final padding necessary to make the extension header a multiple of 8 bytes, as required by the IPv6 extension header specification, and returns the extension header's updated total length. The <i class="farg">offset</i> argument should be the length returned by <b class="fname">inet6_opt_init</b>() or <b class="fname">inet6_opt_append</b>(). When <i class="farg">extbuf</i> is not <span class="define">NULL</span> the function also sets up the appropriate padding bytes by inserting a Pad1 or PadN option of the proper length.<div class="spacer">
</div>
If the extension header is too small to contain the proper padding then an error of -1 is returned to the caller.</div>
<div class="subsection">
<h2 id="x696e6574365f6f70745f7365745f76616c">inet6_opt_set_val</h2> The <b class="fname">inet6_opt_set_val</b>() function inserts data items of various sizes into the data portion of the option. The <i class="farg">databuf</i> argument is a pointer to memory that was returned by the <b class="fname">inet6_opt_append</b>() call and the <i class="farg">offset</i> argument specifies where the option should be placed in the data buffer. The <i class="farg">val</i> argument points to an area of memory containing the data to be inserted into the extension header, and the <i class="farg">vallen</i> argument indicates how much data to copy.<div class="spacer">
</div>
The caller should ensure that each field is aligned on its natural boundaries as described in Appendix B of RFC 2460.<div class="spacer">
</div>
The function returns the offset for the next field which is calculated as <i class="farg">offset</i> + <i class="farg">vallen</i> and is used when composing options with multiple fields.</div>
<div class="subsection">
<h2 id="x696e6574365f6f70745f6e657874">inet6_opt_next</h2> The <b class="fname">inet6_opt_next</b>() function parses received extension headers. The <i class="farg">extbuf</i> and <i class="farg">extlen</i> arguments specify the location and length of the extension header being parsed. The <i class="farg">offset</i> argument should either be zero, for the first option, or the length value returned by a previous call to <b class="fname">inet6_opt_next</b>() or <b class="fname">inet6_opt_find</b>(). The return value specifies the position where to continue scanning the extension buffer. The option is returned in the arguments <i class="farg">typep</i>, <i class="farg">lenp</i>, and <i class="farg">databufp</i>. <i class="farg">typep</i>, <i class="farg">lenp</i>, and <i class="farg">databufp</i> point to the 8-bit option type, the 8-bit option length and the option data respectively. This function does not return any PAD1 or PADN options. When an error occurs or there are no more options the return value is -1.</div>
<div class="subsection">
<h2 id="x696e6574365f6f70745f66696e64">inet6_opt_find</h2> The <b class="fname">inet6_opt_find</b>() function searches the extension buffer for a particular option type, passed in through the <i class="farg">type</i> argument. If the option is found then the <i class="farg">lenp</i> and <i class="farg">databufp</i> arguments are updated to point to the option's length and data respectively. <i class="farg">extbuf</i> and <i class="farg">extlen</i> must point to a valid extension buffer and give its length. The <i class="farg">offset</i> argument can be used to search from a location anywhere in the extension header.</div>
<div class="subsection">
<h2 id="x696e6574365f6f70745f6765745f76616c">inet6_opt_get_val</h2> The <b class="fname">inet6_opt_get_val</b>() function extracts data items of various sizes in the data portion of the option. The <i class="farg">databuf</i> is a pointer returned by the <b class="fname">inet6_opt_next</b>() or <b class="fname">inet6_opt_find</b>() functions. The <i class="farg">val</i> argument points to where the data will be extracted. The <i class="farg">offset</i> argument specifies from where in the data portion of the option the value should be extracted; the first byte of option data is specified by an offset of zero.<div class="spacer">
</div>
It is expected that each field is aligned on its natural boundaries as described in Appendix B of RFC 2460.<div class="spacer">
</div>
The function returns the offset for the next field by calculating <i class="farg">offset</i> + <i class="farg">vallen</i> which can be used when extracting option content with multiple fields. Robust receivers must verify alignment before calling this function.</div>
</div>
<div class="section">
<h1 id="x4558414d504c4553">EXAMPLES</h1> RFC 3542 gives comprehensive examples in Section 23. KAME also provides examples in the <i class="file">advapitest</i> directory of its kit.</div>
<div class="section">
<h1 id="x444941474e4f5354494353">DIAGNOSTICS</h1> All the functions return -1 on an error.</div>
<div class="section">
<h1 id="x5354414e4441524453">STANDARDS</h1> <span class="ref"><span class="ref-auth">S. Deering</span> and <span class="ref-auth">R. Hinden</span>, <span class="ref-title">Internet Protocol, Version 6 (IPv6) Specification</span>, <span class="ref-rep">RFC 2460</span>, <span class="ref-date">December 1998</span>.</span><div class="spacer">
</div>
<span class="ref"><span class="ref-auth">W. Stevens</span>, <span class="ref-auth">M. Thomas</span>, <span class="ref-auth">E. Nordmark</span>, and <span class="ref-auth">T. Jinmei</span>, <span class="ref-title">Advanced Sockets Application Program Interface (API) for IPv6</span>, <span class="ref-rep">RFC 3542</span>, <span class="ref-date">May 2003</span>.</span></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The implementation first appeared in KAME advanced networking kit.</div>
</div>
</body>
</html>

