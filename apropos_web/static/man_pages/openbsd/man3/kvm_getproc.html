<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
KVM_GETPROCS(3)</title>
</head>
<body>
<div class="mandoc">
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">kvm_getprocs</b>, <b class="name">kvm_getargv</b>, <b class="name">kvm_getenvv</b> &#8212; <span class="desc">access user process state</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">sys/param.h</a>&gt;</b><br/>
<b class="includes">#include &lt;<a class="link-includes">sys/sysctl.h</a>&gt;</b><br/>
<b class="includes">#include &lt;<a class="link-includes">kvm.h</a>&gt;</b><div class="spacer">
</div>
<i class="ftype">struct kinfo_proc *</i><br/>
<b class="fname">kvm_getprocs</b>(<i class="farg" style="white-space:nowrap;">kvm_t *kd</i>, <i class="farg" style="white-space:nowrap;">int op</i>, <i class="farg" style="white-space:nowrap;">int arg</i>, <i class="farg" style="white-space:nowrap;">size_t elemsize</i>, <i class="farg" style="white-space:nowrap;">int *cnt</i>);<div class="spacer">
</div>
<i class="ftype">char **</i><br/>
<b class="fname">kvm_getargv</b>(<i class="farg" style="white-space:nowrap;">kvm_t *kd</i>, <i class="farg" style="white-space:nowrap;">const struct kinfo_proc *p</i>, <i class="farg" style="white-space:nowrap;">int nchr</i>);<div class="spacer">
</div>
<i class="ftype">char **</i><br/>
<b class="fname">kvm_getenvv</b>(<i class="farg" style="white-space:nowrap;">kvm_t *kd</i>, <i class="farg" style="white-space:nowrap;">const struct kinfo_proc *p</i>, <i class="farg" style="white-space:nowrap;">int nchr</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> <b class="fname">kvm_getprocs</b>() returns a (sub-)set of active processes in the kernel indicated by <i class="farg">kd</i>. The <i class="farg">op</i> and <i class="farg">arg</i> arguments constitute a predicate which limits the set of processes returned. The value of <i class="farg">op</i> describes the filtering predicate as follows:<div class="spacer">
</div>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 6.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">KERN_PROC_KTHREAD</span></dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
all processes (user-level plus kernel threads)</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">KERN_PROC_ALL</span></dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
all user-level processes</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">KERN_PROC_PID</span></dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
processes with process ID <i class="farg">arg</i></dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">KERN_PROC_PGRP</span></dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
processes with process group <i class="farg">arg</i></dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">KERN_PROC_SESSION</span></dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
processes with session <i class="farg">arg</i></dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">KERN_PROC_TTY</span></dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
processes with <a class="link-man" href="../html4/tty.html">tty(4)</a> <i class="farg">arg</i></dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">KERN_PROC_UID</span></dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
processes with effective user ID <i class="farg">arg</i></dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">KERN_PROC_RUID</span></dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
processes with real user ID <i class="farg">arg</i></dd>
</dl>
<div class="spacer">
</div>
Only the first <i class="farg">elemsize</i> bytes of each array entry are returned. If the size of the <span class="type">kinfo_proc</span> structure increases in size in a future release of <span class="unix">OpenBSD</span>, the library will only return the requested amount of data for each array entry and programs that use <b class="fname">kvm_getprocs</b>() will continue to function without the need for recompilation. The number of processes found is returned in the reference parameter <i class="farg">cnt</i>. The processes are returned as a contiguous array of <span class="type">kinfo_proc</span> structures, the definition for which is available in <b class="includes">&lt;<a class="link-includes">sys/sysctl.h</a>&gt;</b>. This memory is locally allocated, and subsequent calls to <b class="fname">kvm_getprocs</b>() and <b class="fname">kvm_close</b>() will overwrite this storage.<div class="spacer">
</div>
<b class="fname">kvm_getprocs</b>() sets the thread ID field accordingly for each thread except for the process (main thread) which has it set to -1.<div class="spacer">
</div>
<b class="fname">kvm_getargv</b>() returns a null-terminated argument vector that corresponds to the command line arguments passed to process indicated by <i class="farg">p</i>. Most likely, these arguments correspond to the values passed to <a class="link-man" href="../html3/exec.html">exec(3)</a> on process creation. This information is, however, deliberately under control of the process itself. Note that the original command name can be found, unaltered, in the <b class="var">p_comm</b> field of the process structure returned by <b class="fname">kvm_getprocs</b>().<div class="spacer">
</div>
The <i class="farg">nchr</i> argument indicates the maximum number of characters, including null bytes, to use in building the strings. If this amount is exceeded, the string causing the overflow is truncated and the partial result is returned. This is handy for programs like <a class="link-man" href="../html1/ps.html">ps(1)</a> and <a class="link-man" href="../html1/w.html">w(1)</a> that print only a one line summary of a command and should not copy out large amounts of text only to ignore it. If <i class="farg">nchr</i> is zero, no limit is imposed and all argument strings are returned in their entirety.<div class="spacer">
</div>
The memory allocated to the <code class="lit">argv</code> pointers and string storage is owned by the <a class="link-man" href="../html3/kvm.html">kvm(3)</a> library. Subsequent <b class="fname">kvm_getprocs</b>() and <a class="link-man" href="../html3/kvm_close.html">kvm_close(3)</a> calls will clobber this storage.<div class="spacer">
</div>
The <b class="fname">kvm_getenvv</b>() function is similar to <b class="fname">kvm_getargv</b>() but returns the vector of environment strings. This data is also alterable by the process.</div>
<div class="section">
<h1 id="x52455455524e2056414c554553">RETURN VALUES</h1> <b class="fname">kvm_getprocs</b>(), <b class="fname">kvm_getargv</b>(), and <b class="fname">kvm_getenvv</b>() all return <span class="define">NULL</span> on failure.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html3/kvm.html">kvm(3)</a>, <a class="link-man" href="../html3/kvm_geterr.html">kvm_geterr(3)</a>, <a class="link-man" href="../html3/kvm_nlist.html">kvm_nlist(3)</a>, <a class="link-man" href="../html3/kvm_open.html">kvm_open(3)</a>, <a class="link-man" href="../html3/kvm_read.html">kvm_read(3)</a></div>
<div class="section">
<h1 id="x42554753">BUGS</h1> These routines do not belong in the <a class="link-man" href="../html3/kvm.html">kvm(3)</a> interface.</div>
</div>
</body>
</html>

