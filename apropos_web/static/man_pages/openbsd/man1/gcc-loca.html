<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
GCC-LOCAL(1)</title>
</head>
<body>
<div class="mandoc">
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">gcc-local</b> &#8212; <span class="desc">local modifications to gcc</span></div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> <span class="unix">OpenBSD</span> uses derivatives of <a class="link-man" href="../html1/gcc.html">gcc(1)</a> versions 3.3.6 or 4.2.1, depending on machine architecture. In all cases, the software comes with specific modifications for <span class="unix">OpenBSD</span>:<ul style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-dash">
<li class="list-dash" style="margin-top: 1.00em;">
<b class="name">gcc</b> does not search under <i class="file">/usr/local</i> for include files nor for libraries: as a system compiler, it only searches the system paths by default.</li>
<li class="list-dash" style="margin-top: 1.00em;">
On all architectures where the stack is non-executable, trampoline code marks the smallest possible area around the trampoline stub executable using <a class="link-man" href="../html2/mprotect.html">mprotect(2)</a>.</li>
<li class="list-dash" style="margin-top: 1.00em;">
Trampoline code generation is disabled by default. Code requiring trampolines will not compile without <b class="flag">-ftrampolines</b>. The warning flag <b class="flag">-Wtrampolines</b> can be used to locate trampoline instances if trampoline generation is re-enabled.</li>
<li class="list-dash" style="margin-top: 1.00em;">
The <b class="flag">-O2</b> option does not include <b class="flag">-fstrict-aliasing</b>, as this option causes issues on some legacy code. <b class="flag">-fstrict-aliasing</b> is very unsafe with code that plays tricks with casts, bypassing the already weak type system of C.</li>
<li class="list-dash" style="margin-top: 1.00em;">
The <b class="flag">-O2</b> option does not include <b class="flag">-fstrict-overflow</b>, as this option causes issues on some legacy code. <b class="flag">-fstrict-overflow</b> can cause surprising optimizations to occur, possibly deleting security critical overflow checks.</li>
<li class="list-dash" style="margin-top: 1.00em;">
The <b class="flag">-O2</b> option does not include the <b class="flag">-ftree-vrp</b> optimization as it is known to be broken in <b class="name">gcc 4.2.1</b>.</li>
<li class="list-dash" style="margin-top: 1.00em;">
<b class="name">gcc</b> recognizes the extra format attribute syslog, to better match the definition of <a class="link-man" href="../html3/syslog.html">syslog(3)</a>, and silence erroneous warnings when used with <b class="flag">-pedantic</b>.</li>
<li class="list-dash" style="margin-top: 1.00em;">
<b class="name">gcc</b> recognizes the attribute <span class="define">__nonnull__</span>, which can be used to mark arguments that can't be <span class="define">NULL</span>. The printf format attribute does not imply <span class="define">__nonnull__</span> for the format. This allows for correct format checking on the <a class="link-man" href="../html3/err.html">err(3)</a> function family.</li>
<li class="list-dash" style="margin-top: 1.00em;">
<b class="name">gcc</b> recognizes the extra attribute <span class="define">__sentinel__</span>, which can be used to mark varargs function that need a <span class="define">NULL</span> pointer to mark argument termination, like <a class="link-man" href="../html3/execl.html">execl(3)</a>. This exposes latent bugs for 64-bit architectures, where a terminating 0 will expand to a 32-bit int, and not a full-fledged 64-bits pointer.</li>
<li class="list-dash" style="margin-top: 1.00em;">
On alpha, <b class="flag">-mieee</b> is enabled by default to enable full compliance with the IEEE floating point standard, although the &#8220;inexact&#8221; flag is not maintained. Additionally, rounding mode is dynamic.</li>
<li class="list-dash" style="margin-top: 1.00em;">
<b class="name">gcc</b> comes with the &#8220;ProPolice&#8221; stack protection extension, which is enabled by default. This extension reorders local variable declarations and adds stack consistency checks at runtime, in order to detect stack overflows, and will attempt to report the problem in the system logs by calling <a class="link-man" href="../html3/syslog.html">syslog(3)</a> with a <span class="define">LOG_CRIT</span> priority message: &#8220;stack overflow in function XXX&#8221;, and abort the faulting process. It can be turned off using the <b class="flag">-fno-stack-protector</b> command line option. Note that the stack protector relies on some support code in libc. Stand-alone programs not linked against libc must either provide their own support bits or use the <b class="flag">-fno-stack-protector</b> option.<div class="spacer">
</div>
There is a <b class="flag">-fstack-protector-all</b> option that turns stack protection code on for all functions and disables any heuristic that flags some functions as safe. This extended checking has a moderate runtime cost though. There is a <b class="flag">-fstack-protector-strong</b> option, similar to <b class="flag">-fstack-protector</b>, which includes additional functions to be protected &#8212; those that have local array definitions or have references to local frame addresses.</li>
<li class="list-dash" style="margin-top: 1.00em;">
On the alpha, amd64, hppa, i386, mips64, powerpc, sh and sparc64 architectures, <b class="name">gcc</b> generates position-independent executables (PIEs) by default, allowing the system to load the resulting binary at a random location. This behavior can be turned off by passing <b class="flag">-fno-pie</b> to the compiler and <b class="flag">-nopie</b> to the linker.</li>
<li class="list-dash" style="margin-top: 1.00em;">
<b class="name">gcc</b> recognizes a new flag which is enabled by default, <b class="flag">-Wbounded</b>, to perform basic checks on functions which accept buffers and sizes. An extra attribute, <span class="define">__bounded__</span>, has been added to mark functions that can be checked this way.</li>
<li class="list-dash" style="margin-top: 1.00em;">
<b class="name">gcc</b> recognizes a new format attribute, kprintf, to deal with the extra format arguments &#8216;<code class="lit">%b</code>&#8217;, &#8216;<code class="lit">%r</code>&#8217;, and &#8216;<code class="lit">%z</code>&#8217; used in the <span class="unix">OpenBSD</span> kernel.</li>
<li class="list-dash" style="margin-top: 1.00em;">
<b class="name">gcc</b> does not store its version string in objects. This behavior can be restored with <b class="flag">-fident</b>.</li>
<li class="list-dash" style="margin-top: 1.00em;">
The option <b class="flag">-fstack-shuffle</b> will randomize the order of stack variables at compile time with <b class="name">gcc 4.2.1</b>, which can be helpful to find bugs. This option is silently ignored by <b class="name">gcc 3.3.6</b>.</li>
<li class="list-dash" style="margin-top: 1.00em;">
<b class="name">gcc</b> will not move variables initialized with the value zero from the data section to the bss section. The default behaviour of <b class="name">gcc 3.3.6</b> and <b class="name">gcc 4.2.1</b> on other systems is to perform this action, which can be restored for <span class="unix">OpenBSD</span> with <b class="flag">-fzero-initialized-in-bss</b>.</li>
<li class="list-dash" style="margin-top: 1.00em;">
<b class="name">gcc</b> does not warn for cast expressions used as lvalues outside of <b class="flag">-pedantic</b>.</li>
<li class="list-dash" style="margin-top: 1.00em;">
<b class="name">gcc 4.2.1</b> does not warn for pointer arguments passing or assignment with different signedness outside of <b class="flag">-pedantic</b>. This can be re-enabled with the <b class="flag">-Wpointer-sign</b> flag.</li>
<li class="list-dash" style="margin-top: 1.00em;">
<b class="name">gcc</b> recognizes the preprocessor flag <b class="flag">-CC</b> that lets comments in macros pass through to the output (except in <b class="flag">-traditional</b> mode).</li>
<li class="list-dash" style="margin-top: 1.00em;">
The warning option <b class="flag">-Wsystem-headers</b>, which makes <b class="name">gcc</b> report warnings in systems headers, is enabled by default.</li>
<li class="list-dash" style="margin-top: 1.00em;">
<b class="name">gcc</b> supports two extra warning options:<ul style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-item">
<li class="list-item" style="margin-top: 1.00em;">
<b class="flag">-Wframe-larger-than=</b><b class="var">N</b> (and its non-portable alias <b class="flag">-Wstack-larger-than-</b><b class="var">N</b>) will report functions using more than <b class="var">N</b> bytes of stack space for their local variables. Stack space used for other purposes (such as register window saving, callee-saved registers, or outbound arguments storage) is not taken into account for this check.</li>
<li class="list-item" style="margin-top: 1.00em;">
<b class="flag">-Wvariable-decl</b> will report automatic variable declarations whose size cannot be determined at compile-time.</li>
</ul>
</li>
<li class="list-dash" style="margin-top: 1.00em;">
<b class="name">gcc 4.2.1</b> and <b class="name">gcc 3.3.6</b> have backported support for the GCC binary integer constants extension, which was first introduced in <b class="name">gcc 4.3</b>.</li>
</ul>
</div>
<div class="section">
<h1 id="x41545452494255544553">ATTRIBUTES</h1> The <span class="define">__bounded__</span> attribute is used to type-check functions whose parameters pass fixed-length buffers and their sizes. The syntax for normal buffers is:<div class="spacer">
</div>
<code class="lit">__attribute__ ((__bounded__</code> ( <span class="define">__buffer__</span>, <b class="var">buffer</b>, <b class="var">length</b> <code class="lit">)))</code><div class="spacer">
</div>
where <i class="farg">buffer</i> contains the parameter number (starting from 1) of the pointer to the buffer, and <i class="farg">length</i> contains the parameter number of the buffer length argument.<div class="spacer">
</div>
<b class="name">gcc</b> will emit a warning if the length argument is a constant larger than the actual size of the buffer. If the buffer is not a statically declared array of fixed length, no warnings will be generated. Refer to <a class="link-man" href="../html3/memcpy.html">memcpy(3)</a> for an example of a function with this check.<div class="spacer">
</div>
For checking strings, just use <span class="define">__string__</span> instead of <span class="define">__buffer__</span>:<div class="spacer">
</div>
<code class="lit">__attribute__ ((__bounded__</code> ( <span class="define">__string__</span>, <b class="var">buffer</b>, <b class="var">length</b> <code class="lit">)))</code><div class="spacer">
</div>
In addition to the checks described above, this also tests if the <b class="var">length</b> argument was wrongly derived from a <b class="fname">sizeof</b>(<i class="farg">void *</i>) operation. <a class="link-man" href="../html3/strlcpy.html">strlcpy(3)</a> is a good example of a string function with this check.<div class="spacer">
</div>
If a function needs string checking like <span class="define">__string__</span> but operates on element counts rather than buffer sizes, use <span class="define">__wcstring__</span>:<div class="spacer">
</div>
<code class="lit">__attribute__ ((__bounded__</code> ( <span class="define">__wcstring__</span>, <b class="var">buffer</b>, <b class="var">count</b> <code class="lit">)))</code><div class="spacer">
</div>
An example of a string function with this check is <a class="link-man" href="../html3/wcslcpy.html">wcslcpy(3)</a>.<div class="spacer">
</div>
Some functions specify the length as two arguments: the number of elements and the size of each element. In this case, use the <span class="define">__size__</span> attribute:<div class="spacer">
</div>
<code class="lit">__attribute__ ((__bounded__</code> ( <span class="define">__size__</span>, <b class="var">buffer</b>, <b class="var">nmemb</b>, <b class="var">size</b> <code class="lit">)))</code><div class="spacer">
</div>
where <b class="var">buffer</b> contains the parameter number of the pointer to the buffer, <b class="var">nmemb</b> contains the parameter number of the number of members, and <b class="var">size</b> has the parameter number of the size of each element. The type checks performed by <span class="define">__size__</span> are the same as the <span class="define">__buffer__</span> attribute. See <a class="link-man" href="../html3/fread.html">fread(3)</a> for an example of this type of function.<div class="spacer">
</div>
If a function accepts a buffer parameter and specifies that it has to be of a minimum length, the __minbytes__ attribute can be used:<div class="spacer">
</div>
<code class="lit">__attribute__ ((__bounded__</code> ( <span class="define">__minbytes__</span>, <b class="var">buffer</b>, <b class="var">minsize</b> <code class="lit">)))</code><div class="spacer">
</div>
where <b class="var">buffer</b> contains the parameter number of the pointer to the buffer, and <b class="var">minsize</b> specifies the minimum number of bytes that the buffer should be. <a class="link-man" href="../html3/ctime_r.html">ctime_r(3)</a> is an example of this type of function.<div class="spacer">
</div>
If <b class="flag">-Wbounded</b> is specified with <b class="flag">-Wformat</b>, additional checks are performed on <a class="link-man" href="../html3/sscanf.html">sscanf(3)</a> format strings. The &#8216;<code class="lit">%s</code>&#8217; fields are checked for incorrect bound lengths by checking the size of the buffer associated with the format argument.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html1/gcc.html">gcc(1)</a><div class="spacer">
</div>
<a class="link-ext" href="http://www.research.ibm.com/trl/projects/security/ssp/">http://www.research.ibm.com/trl/projects/security/ssp/</a></div>
<div class="section">
<h1 id="x43415645415453">CAVEATS</h1> The <b class="flag">-Wbounded</b> flag only works with statically allocated fixed-size buffers. Since it is applied at compile-time, dynamically allocated memory buffers and non-constant arguments are ignored.</div>
</div>
</body>
</html>

