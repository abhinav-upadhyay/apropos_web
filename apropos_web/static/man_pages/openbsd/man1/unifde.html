<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
UNIFDEF(1)</title>
</head>
<body>
<div class="mandoc">
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">unifdef</b> &#8212; <span class="desc">remove preprocessor conditionals from code</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1><table class="synopsis">
<col style="width: 7.00ex;"/>
<col/>
<tbody>
<tr>
<td>
unifdef</td>
<td>
[<span class="opt"><b class="flag">-BbcdehKkmnSstV</b></span>] [<span class="opt"><b class="flag">-</b>[<span class="opt"><b class="flag">i</b></span>]<b class="flag">D</b><i class="arg">sym</i>[<span class="opt">=<i class="arg">val</i></span>]</span>] [<span class="opt"><b class="flag">-</b>[<span class="opt"><b class="flag">i</b></span>]<b class="flag">U</b><i class="arg">sym</i></span>] [<span class="opt"><b class="flag">-f</b> <i class="arg">defile</i></span>] [<span class="opt"><b class="flag">-M</b> <i class="arg">backext</i></span>] [<span class="opt"><b class="flag">-o</b> <i class="arg">outfile</i></span>] [<span class="opt"><b class="flag">-x</b> <b class="flag">0</b> | <b class="flag">1</b> | <b class="flag">2</b></span>] <i class="arg">file ...</i></td>
</tr>
</tbody>
</table>
</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="name">unifdef</b> utility selectively processes conditional <a class="link-man" href="../html1/cpp.html">cpp(1)</a> directives. It removes from a file both the directives and any additional text that they specify should be removed, while otherwise leaving the file alone.<div class="spacer">
</div>
The <b class="name">unifdef</b> utility acts on <b class="cmd">#if</b>, <b class="cmd">#ifdef</b>, <b class="cmd">#ifndef</b>, <b class="cmd">#elif</b>, <b class="cmd">#else</b>, and <b class="cmd">#endif</b> lines, using macros specified in <b class="flag">-D</b> and <b class="flag">-U</b> command line options or in <b class="flag">-f</b> definition files. A directive is processed if the macro specifications are sufficient to provide a definite value for its control expression. If the result is false, the directive and the following lines under its control are removed. If the result is true, only the directive is removed. An <b class="cmd">#ifdef</b> or <b class="cmd">#ifndef</b> directive is passed through unchanged if its controlling macro is not specified. Any <b class="cmd">#if</b> or <b class="cmd">#elif</b> control expression that has an unknown value or that <b class="name">unifdef</b> cannot parse is passed through unchanged. By default, <b class="name">unifdef</b> ignores <b class="cmd">#if</b> and <b class="cmd">#elif</b> lines with constant expressions; it can be told to process them by specifying the <b class="flag">-k</b> flag on the command line.<div class="spacer">
</div>
It understands a commonly-used subset of the expression syntax for <b class="cmd">#if</b> and <b class="cmd">#elif</b> lines: integer constants, integer values of macros defined on the command line, the <b class="fname">defined</b>() operator, the operators <b class="cmd">!</b>, <b class="cmd">&lt;</b>, <b class="cmd">&gt;</b>, <b class="cmd">&lt;=</b>, <b class="cmd">&gt;=</b>, <b class="cmd">==</b>, <b class="cmd">!=</b>, <b class="cmd">&amp;&amp;</b>, <b class="cmd">||</b>, and parenthesized expressions. A kind of &#8220;short circuit&#8221; evaluation is used for the <b class="cmd">&amp;&amp;</b> operator: if either operand is definitely false then the result is false, even if the value of the other operand is unknown. Similarly, if either operand of <b class="cmd">||</b> is definitely true then the result is true.<div class="spacer">
</div>
When evaluating an expression, <b class="name">unifdef</b> does not expand macros first. The value of a macro must be a simple number, not an expression. A limited form of indirection is allowed, where one macro's value is the name of another.<div class="spacer">
</div>
In most cases, <b class="name">unifdef</b> does not distinguish between object-like macros (without arguments) and function-like macros (with arguments). A function-like macro invocation can appear in <b class="cmd">#if</b> and <b class="cmd">#elif</b> control expressions. If the macro is not explicitly defined, or is defined with the <b class="flag">-D</b> flag on the command-line, or with <b class="cmd">#define</b> in a <b class="flag">-f</b> definition file, its arguments are ignored. If a macro is explicitly undefined on the command line with the <b class="flag">-U</b> flag, or with <b class="cmd">#undef</b> in a <b class="flag">-f</b> definition file, it may not have any arguments since this leads to a syntax error.<div class="spacer">
</div>
The <b class="name">unifdef</b> utility understands just enough about C to know when one of the directives is inactive because it is inside a comment, or affected by a backslash-continued line. It spots unusually-formatted preprocessor directives and knows when the layout is too odd for it to handle.<div class="spacer">
</div>
The options are as follows:<div class="spacer">
</div>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="flag">-B</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Compress blank lines around a deleted section. Mutually exclusive with the <b class="flag">-b</b> option.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="flag">-b</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Replace removed lines with blank lines instead of deleting them. Mutually exclusive with the <b class="flag">-B</b> option.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="flag">-c</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Complement. That is, lines that would have been removed or blanked are retained and vice versa.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="flag">-D</b><i class="arg">sym</i>[<span class="opt">=<i class="arg">val</i></span>]</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="flag">-U</b><i class="arg">sym</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Specify that a macro is defined (<b class="flag">-D</b>) to a given value, to 1 if no value is given, or undefined (<b class="flag">-U</b>).<div class="spacer">
</div>
If the same macro appears in more than one argument, the last occurrence dominates.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="flag">-d</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Turn on printing of debugging messages.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="flag">-e</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
By default, <b class="name">unifdef</b> will report an error if it needs to remove a preprocessor directive that spans more than one line, for example, if it has a multi-line comment hanging off its right hand end. The <b class="flag">-e</b> flag makes it ignore the line instead.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="flag">-f</b> <i class="arg">defile</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The file <i class="arg">defile</i> contains <b class="cmd">#define</b> and <b class="cmd">#undef</b> preprocessor directives, which have the same effect as the corresponding <b class="flag">-D</b> and <b class="flag">-U</b> command line arguments. Multiple <b class="flag">-f</b> arguments can be given and mixed with <b class="flag">-D</b> and <b class="flag">-U</b> arguments; later options override earlier ones.<div class="spacer">
</div>
Each directive must be on a single line. Object-like macro definitions (without arguments) are set to the given value. Function-like macro definitions (with arguments) are treated as if they are set to 1.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="flag">-iD</b><i class="arg">sym</i>[<span class="opt">=<i class="arg">val</i></span>]</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="flag">-iU</b><i class="arg">sym</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Ignore <b class="cmd">#ifdef</b>s. If C code uses <b class="cmd">#ifdef</b>s to delimit non-C lines, such as comments or code which is under construction, this tells <b class="name">unifdef</b> which symbols are used for that purpose so that it will not try to parse comments and line continuations inside those <b class="cmd">#ifdef</b>s.<div class="spacer">
</div>
If the same macro appears in more than one argument, the last occurrence dominates.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="flag">-h</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Print help.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="flag">-K</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Always treat the result of <b class="cmd">&amp;&amp;</b> and <b class="cmd">||</b> operators as unknown if either operand is unknown, instead of short-circuiting when unknown operands can't affect the result. This option is for compatibility with older versions of <b class="name">unifdef</b>.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="flag">-k</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Process <b class="cmd">#if</b> and <b class="cmd">#elif</b> lines with constant expressions. By default, sections controlled by such lines are passed through unchanged because they typically start &#8220;<code class="lit">#if 0</code>&#8221; and are used as a kind of comment to sketch out future or past development. It would be rude to strip them out, just as it would be for normal comments.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="flag">-M</b> <i class="arg">backext</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Modify input files in place, and keep backups of the original files by appending the <i class="arg">backext</i> to the input filenames. If a zero length <i class="arg">backext</i> is given, no backup will be saved.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="flag">-m</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Modify one or more input files in place.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="flag">-n</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Add <code class="lit">#line</code> directives to the output following any deleted lines, so that errors produced when compiling the output file correspond to line numbers in the input file.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="flag">-o</b> <i class="arg">outfile</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Write output to the file <i class="arg">outfile</i> instead of the standard output when processing a single file.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="flag">-S</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Like the <b class="flag">-s</b> option, but the nesting depth of each macro is also printed. This is useful for working out the number of possible combinations of interdependent defined/undefined macros.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="flag">-s</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Instead of processing an input file as usual, this option causes <b class="name">unifdef</b> to produce a list of macros that are used in preprocessor directive controlling expressions.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="flag">-t</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Disables parsing for C strings, comments, and line continuations, which is useful for plain text. This is a blanket version of the <b class="flag">-iD</b> and <b class="flag">-iU</b> flags.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="flag">-V</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Print version details.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="flag">-x</b> <b class="flag">0</b> | <b class="flag">1</b> | <b class="flag">2</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Set exit status mode to zero, one, or two. See the <i class="link-sec"><a class="link-sec" href="#x4558495420535441545553">EXIT STATUS</a></i> section below for details.</dd>
</dl>
<div class="spacer">
</div>
The <b class="name">unifdef</b> utility takes its input from <span class="emph">stdin</span> if there are no <i class="arg">file</i> arguments. The <b class="flag">-m</b> or <b class="flag">-M</b> options must be used if there are multiple input files. A dash (-) specifies input from stdin or output to stdout.<div class="spacer">
</div>
The <b class="name">unifdef</b> utility works nicely with the <b class="flag">-D</b> option of <a class="link-man" href="../html1/diff.html">diff(1)</a>.</div>
<div class="section">
<h1 id="x4558495420535441545553">EXIT STATUS</h1> In normal usage the <b class="name">unifdef</b> utility's exit status depends on the mode set using the <b class="flag">-x</b> option.<div class="spacer">
</div>
If the exit mode is zero (the default) then <b class="name">unifdef</b> exits with status 0 if the output is an exact copy of the input, or with status 1 if the output differs.<div class="spacer">
</div>
If the exit mode is one, <b class="name">unifdef</b> exits with status 1 if the output is unmodified or 0 if it differs.<div class="spacer">
</div>
If the exit mode is two, <b class="name">unifdef</b> exits with status zero in both cases.<div class="spacer">
</div>
In all exit modes, <b class="name">unifdef</b> exits with status 2 if there is an error.<div class="spacer">
</div>
The exit status is 0 if the <b class="flag">-h</b> or <b class="flag">-V</b> command line options are given.</div>
<div class="section">
<h1 id="x444941474e4f5354494353">DIAGNOSTICS</h1><ul style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-item">
<li class="list-item" style="margin-top: 1.00em;">
EOF in comment</li>
<li class="list-item" style="margin-top: 1.00em;">
Inappropriate <b class="cmd">#elif</b>, <b class="cmd">#else</b> or <b class="cmd">#endif</b></li>
<li class="list-item" style="margin-top: 1.00em;">
Obfuscated preprocessor control line</li>
<li class="list-item" style="margin-top: 1.00em;">
Premature EOF (with the line number of the most recent unterminated <b class="cmd">#if</b>)</li>
<li class="list-item" style="margin-top: 1.00em;">
Too many levels of nesting</li>
</ul>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html1/cpp.html">cpp(1)</a>, <a class="link-man" href="../html1/diff.html">diff(1)</a><div class="spacer">
</div>
The unifdef home page is <i class="file">http://dotat.at/prog/unifdef</i></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="name">unifdef</b> command appeared in <span class="unix">2.9BSD</span>. ANSI&#160;C support was added in <span class="unix">FreeBSD&#160;4.7</span>.</div>
<div class="section">
<h1 id="x415554484f5253">AUTHORS</h1> The original implementation was written by <span class="author">Dave Yost</span> &lt;<a class="link-mail" href="mailto:Dave@Yost.com">Dave@Yost.com</a>&gt;.<br/>
<span class="author">Tony Finch</span> &lt;<a class="link-mail" href="mailto:dot@dotat.at">dot@dotat.at</a>&gt; rewrote it to support ANSI&#160;C.</div>
<div class="section">
<h1 id="x42554753">BUGS</h1> Expression evaluation is very limited.<div class="spacer">
</div>
Handling one line at a time means preprocessor directives split across more than one physical line (because of comments or backslash-newline) cannot be handled in every situation.<div class="spacer">
</div>
Trigraphs are not recognized.<div class="spacer">
</div>
There is no support for macros with different definitions at different points in the source file.<div class="spacer">
</div>
The text-mode and ignore functionality does not correspond to modern <a class="link-man" href="../html1/cpp.html">cpp(1)</a> behaviour.</div>
</div>
</body>
</html>

