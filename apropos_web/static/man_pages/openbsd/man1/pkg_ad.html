<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
PKG_ADD(1)</title>
</head>
<body>
<div class="mandoc">
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">pkg_add</b> &#8212; <span class="desc">install software package distributions</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1><table class="synopsis">
<col style="width: 7.00ex;"/>
<col/>
<tbody>
<tr>
<td>
pkg_add</td>
<td>
[<span class="opt"><b class="flag">-acIimnqrsUuvxz</b></span>] [<span class="opt"><b class="flag">-A</b>&#160;<i class="arg">arch</i></span>] [<span class="opt"><b class="flag">-B</b>&#160;<i class="arg">pkg-destdir</i></span>] [<span class="opt"><b class="flag">-D</b>&#160;<i class="arg">name</i>[<span class="opt">=<i class="arg">value</i></span>]</span>] [<span class="opt"><b class="flag">-L</b>&#160;<i class="arg">localbase</i></span>] [<span class="opt"><b class="flag">-l</b>&#160;<i class="arg">file</i></span>] [<span class="opt"><b class="flag">-P</b>&#160;<i class="arg">type</i></span>]&#160;<i class="arg">pkg-name ...</i></td>
</tr>
</tbody>
</table>
</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="name">pkg_add</b> command is used to install packages created with the <a class="link-man" href="../html1/pkg_create.html">pkg_create(1)</a> command. Selected packages containing pre-compiled applications from the <i class="file">/usr/ports</i> tree can be found on the <span class="unix">OpenBSD</span> FTP site or on the official <span class="unix">OpenBSD</span> CD.<div class="spacer">
</div>
<div style="margin-left: 5.00ex;" class="display">
<span class="emph">Note</span>: System distribution files, e.g., base58.tgz, comp58.tgz, are <span class="emph">not</span> packages and may not be installed using <b class="name">pkg_add</b>.</div>
<div class="spacer">
</div>
<b class="name">pkg_add</b> can be used to install new packages, to replace existing packages with other flavors (option <b class="flag">-r</b>) or to update packages to newer versions (option <b class="flag">-u</b>).<div class="spacer">
</div>
Details of packing-list internals are documented in <a class="link-man" href="../html1/pkg_create.html">pkg_create(1)</a>.<div class="spacer">
</div>
<b class="name">pkg_add</b> will <a class="link-man" href="../html3/syslog.html">syslog(3)</a> installations and updates by default (but see <a class="link-man" href="../html5/pkg.conf.html">pkg.conf(5)</a>).<div class="spacer">
</div>
<b class="name">pkg_add</b> relies on the file system information being consistent. In case of a system crash, <i class="file">/var/db/pkg</i> may become corrupted. Use <a class="link-man" href="../html8/pkg_check.html">pkg_check(8)</a> to repair things.<div class="spacer">
</div>
If a package is digitally signed:<ul style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-bul">
<li class="list-bul" style="margin-top: 1.00em;">
<b class="name">pkg_add</b> checks that its packing-list is not corrupted and matches the cryptographic signature stored within.</li>
<li class="list-bul" style="margin-top: 1.00em;">
<b class="name">pkg_add</b> verifies that the signature was emitted by a valid user certificate, signed by one of the authorities in <i class="file">/etc/ssl/pkgca.pem</i></li>
<li class="list-bul" style="margin-top: 1.00em;">
<b class="name">pkg_add</b> verifies that each file matches its sha256 checksum right after extraction, before doing anything with it.</li>
<li class="list-bul" style="margin-top: 1.00em;">
<b class="name">pkg_add</b> verifies that any dangerous mode or owner is registered in the packing-list.</li>
</ul>
<div class="spacer">
</div>
In normal mode, the package names given on the command lines are names of new packages that <b class="name">pkg_add</b> should install, without ever deinstalling existing packages.<div class="spacer">
</div>
In replacement mode, the package names given on the command lines are names of new packages that <b class="name">pkg_add</b> should install, possibly replacing existing installed packages.<div class="spacer">
</div>
In update mode, the package names given on the command lines are names of installed packages, and <b class="name">pkg_add</b> should figure out newer package names for these, then replace the old packages with the new.<div class="spacer">
</div>
Each package name may be specified as a filename (which normally consists of the package name itself plus the &#8220;.tgz&#8221; suffix) or a URL referring to FTP, HTTP, HTTPS, or SCP locations. The following examples are valid:<div class="spacer">
</div>
<code class="lit">pkg_add -v http://ftp.openbsd.org/pub/OpenBSD/2.7/packages/i386/m4-1.4.tgz</code> <code class="lit">pkg_add -v scp://login@host/usr/ports/packages/sparc/all/tcl-8.4.7.tgz</code><div class="spacer">
</div>
If the given package names are not found in the current working directory, <b class="name">pkg_add</b> will search for them in each directory (local or remote) named by the <span class="env">PKG_PATH</span> environment variable. If <span class="env">PKG_PATH</span> is not defined, <b class="name">pkg_add</b> will use the path named by <i class="arg">installpath</i> within <a class="link-man" href="../html5/pkg.conf.html">pkg.conf(5)</a>. Specifying &#8216;<code class="lit">-</code>&#8217; as a package name causes <b class="name">pkg_add</b> to read from the standard input.<div class="spacer">
</div>
<b class="name">pkg_add</b> also understands &#8216;stems&#8217;, that is, package names without any version specification. For instance, with <code class="lit">pkg_add kdelibs</code>, <b class="name">pkg_add</b> will look in the current directory (or the PKG_PATH) for a kdelibs package.<div class="spacer">
</div>
<b class="name">pkg_add</b> may ask questions in interactive mode, or error out otherwise. Interactive mode is the default on a tty, see options <b class="flag">-I/i</b>.<div class="spacer">
</div>
For instance <code class="lit">pkg_add screen</code> is ambiguous as it matches screen-4.02  and screen-4.02-static.<div class="spacer">
</div>
To avoid ambiguities, <b class="name">pkg_add</b> supports &#8216;stems with flavors&#8217;, that is, a stem separated from flavors with a double dash. For instance, the previous ambiguity could be resolved by using <code class="lit">pkg_add screen--</code> (matches only the normal flavor) or <code class="lit">pkg_add screen--static</code> (matches only the static flavor).<div class="spacer">
</div>
If the environment variable <span class="env">PKG_CACHE</span> is set to a directory name, every package retrieved from a distant location will also be copied here.<div class="spacer">
</div>
Some packages may depend on other packages. When resolving dependencies <b class="name">pkg_add</b> will first look at already installed packages, then match dependencies with the list of packages left to install, then ask the user's opinion in interactive mode, then install default packages that satisfy the dependencies.<div class="spacer">
</div>
Alternatively, it is possible to add packages interactively from within the <a class="link-man" href="../html1/ftp.html">ftp(1)</a> client, in which case setting <span class="env">PKG_PATH</span> correctly will be necessary for any dependency to be found out and retrieved the same way. For example, the following works:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
$ ftp ftp://ftp.openbsd.org/pub/OpenBSD/2.7/packages/i386/ 
250 CWD command successful 
ftp&gt; ls m* 
227 Entering Passive Mode (129,128,5,191,164,73) 
150 Opening ASCII mode data connection for m*. 
m4-1.4.tgz 
metamail-2.7.tgz 
mh-6.8.4.tgz 
mm-1.0.12.tgz 
mpeg_lib-1.2.1.tgz 
mpeg_play-2.4.tgz 
mpg123-0.59q.tgz 
mutt-0.95.7i.tgz 
226 Transfer complete. 
ftp&gt; get m4-1.4.tgz &quot;|pkg_add -v -&quot;</pre>
<div class="spacer">
</div>
<span class="symb">Warning:</span> Since the <b class="name">pkg_add</b> command may execute scripts or programs contained within a package file, your system may be susceptible to &#8220;trojan horses&#8221; or other subtle attacks from miscreants who create dangerous packages. Be sure the specified package(s) are from trusted sources.<div class="spacer">
</div>
The options are as follows:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-A</b> <i class="arg">arch</i></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Assume <i class="arg">arch</i> as current machine architecture for any package tests.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-a</b></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Automated package installation; do not record packages as installed manually.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-aa</b></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Force already installed packages to be tagged as installed automatically.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-B</b> <i class="arg">pkg-destdir</i></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Set <i class="arg">pkg-destdir</i> as the prefix to prepend to any object extracted from the package.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-c</b></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
While replacing packages, delete extra configuration file in the old package, mentioned as<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit">@extra file</code></div>
</blockquote>
in the packing-list.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-D</b> <i class="arg">name</i>[<span class="opt">=<i class="arg">value</i></span>]</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Force installation of the package. <i class="arg">name</i> is a keyword that states what failsafe should be waived. Recognized keywords include:<div class="spacer">
</div>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="arg">allversions</i></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
do not trim older p* variants of packages for updates.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="arg">arch</i></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
architecture recorded in package may not match.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="arg">dontmerge</i></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
by default, if dependencies are too strict, <b class="name">pkg_add</b> will merge updates together to make sure everything stays in sync. <b class="flag">-D</b> <i class="arg">dontmerge</i> disables that behavior.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="arg">donttie</i></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
by default, <b class="name">pkg_add</b> will try to find new files in old packages by comparing the stored sha256, and tie the entries together to avoid extracting files needlessly. <b class="flag">-D</b> <i class="arg">donttie</i> disables that behavior.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="arg">downgrade</i></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
don't filter out package versions older than what's currently installed.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="arg">FW_UPDATE</i></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
set by <a class="link-man" href="../html1/fw_update.html">fw_update(1)</a> to separate firmware from normal packages.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="arg">installed</i></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
in update mode, reinstall an existing package with the same update signature.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="arg">libdepends</i></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
library specifications may not be fulfilled.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="arg">nonroot</i></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
install even if not running as root.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="arg">nosig</i></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
do not check digital signatures. Still displays a very prominent message if a signature is found.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="arg">paranoid</i></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
very safe update: don't run any @exec/@unexec.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="arg">repair</i></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
attempt to repair installed packages with missing registration data.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="arg">scripts</i></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
external scripts may fail.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="arg">SIGNER</i></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
list of trusted signers, separated by commas. Corresponds to list of public keys under <i class="file">/etc/signify</i> we want to trust. Defaults to any key matching &#8216;*pkg&#8217; for packages, and any key matching &#8216;*fw&#8217; for firmware.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="arg">unsigned</i></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
allow the installation of unsigned packages without warnings/errors (necessary for <a class="link-man" href="../html7/ports.html">ports(7)</a>, automatically set by the build infrastructure).</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="arg">updatedepends</i></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
force update even if forward dependencies no longer match.</dd>
</dl>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-I</b></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Force non-interactive mode. Default is to be interactive when run from a tty.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-i</b></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Force interactive mode, even if not run from a tty. <b class="name">pkg_add</b> may ask questions to the user if faced with difficult decisions.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-L</b> <i class="arg">localbase</i></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Install a package under <i class="arg">localbase</i>. By default, <i class="arg">localbase</i> equals <i class="file">/usr/local</i>, and specifying it is not necessary. However, packages can be created using a different <i class="arg">localbase</i> (see <a class="link-man" href="../html1/pkg_create.html">pkg_create(1)</a>), and those packages can only be installed by using the same <i class="arg">localbase</i>. See <a class="link-man" href="../html5/bsd.port.mk.html">bsd.port.mk(5)</a> for a description of <span class="env">LOCALBASE</span>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-l</b> <i class="arg">file</i></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Installs packages from the raw output of <a class="link-man" href="../html1/pkg_info.html">pkg_info(1)</a>, as saved in <i class="arg">file</i>. Generally, use with <code class="lit">pkg_info -m &gt;file</code>, to reproduce an installation from machine to machine. With <b class="flag">-z</b> and <b class="flag">-l</b> <b class="name">pkg_add</b> will try its best to reproduce the installation, even if the version numbers don't quite match and even if some packages cannot be found.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-m</b></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Causes <b class="name">pkg_add</b> to always display the progress meter in cases it would not do so by default.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-n</b></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Don't actually install a package, just report the steps that would be taken if it was. Will still copy packages to <span class="env">PKG_CACHE</span> if applicable.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-P</b> <i class="arg">type</i></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Check permissions for distribution, where <i class="arg">type</i> can be &#8216;cdrom&#8217; or &#8216;ftp&#8217;.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-q</b></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Replace package quickly; do not bother with checksums before removing normal files. If used twice, it will not bother with checksums for configuration files either.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-r</b></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Replace existing packages. <b class="name">pkg_add</b> will try to take every precaution to make sure the replacement can proceed before removing the old package and adding the new one, and it should also handle shared libraries correctly. Among other things, <b class="name">pkg_add</b> will refuse to replace packages as soon as it needs to run scripts that might fail (use <b class="flag">-D</b> <i class="arg">update</i> to force the replacement); <b class="name">pkg_add</b> will also refuse to replace packages when the dependencies don't quite match (use <b class="flag">-D</b> <i class="arg">updatedepends</i> to force the replacement).</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-s</b></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Don't actually install packages, skip as many steps as needed and report only the disk size changes that would happen. Similar to <b class="flag">-n</b>, except it also skips fetching full packages and stops at getting the information it needs.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-U</b></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Update dependencies if required before installing the new package(s).</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-u</b></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Update the given installed <i class="arg">pkgname(s)</i>, and anything it depends upon. If no <i class="arg">pkgname</i> is given, <b class="name">pkg_add</b> will update all installed packages. This relies on <span class="env">PKG_PATH</span> to figure out the new package names.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-v</b></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Turn on verbose output. Several <b class="flag">-v</b> turn on more verbose output. By default, <b class="name">pkg_add</b> is almost completely silent, but it reacts to keyboard status requests (see <a class="link-man" href="../html1/stty.html">stty(1)</a>). <b class="flag">-v</b> turns on basic messages, <b class="flag">-vv</b> adds relevant system operations, <b class="flag">-vvv</b> shows most internal computations apart from individual file/directory additions, <b class="flag">-vvvv</b> also shows dependencies adjustments, and <b class="flag">-vvvvv</b> shows everything.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-x</b></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Disable progress meter.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-z</b></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Fuzzy package addition: <b class="name">pkg_add</b> should do its best to match package names passed on the command line, even if the versions don't match and it will proceed even if some packages can't be found.</dd>
</dl>
<div class="spacer">
</div>
By default, when adding packages via FTP, the <a class="link-man" href="../html1/ftp.html">ftp(1)</a> program operates in &#8220;passive&#8221; mode. If you wish to use active mode instead, set the <span class="env">FTPMODE</span> environment variable to &#8220;active&#8221;. If <b class="name">pkg_add</b> consistently fails to fetch a package from a site known to work, it may be because the site does not support passive mode FTP correctly. This is very rare since <b class="name">pkg_add</b> will try active mode FTP if the server refuses a passive mode connection.<div class="subsection">
<h2 id="x4d616e75616c20696e7374616c6c6174696f6e">Manual installation</h2> <b class="name">pkg_add</b> differentiates between packages specified on the command line, and packages installed automatically because of inter-dependencies: the first kind will be tagged as &#8216;installed manually&#8217;. The <b class="flag">-a</b> option is used internally by the <a class="link-man" href="../html7/ports.html">ports(7)</a> infrastructure and <a class="link-man" href="../html1/dpb.html">dpb(1)</a> to handle dependencies.<div class="spacer">
</div>
It is also possible to tweak the &#8216;installed manually&#8217; status of a package after the fact. Running <b class="name">pkg_add</b> on an already installed package will tag it as &#8216;installed manually&#8217;, even if it was already there as a dependency of something else, and doubling the <b class="flag">-a</b> option will remove the &#8216;installed manually&#8217; tag from installed packages.<div class="spacer">
</div>
<a class="link-man" href="../html1/pkg_info.html">pkg_info(1)</a> can be used to show only manually-installed packages, and <a class="link-man" href="../html1/pkg_delete.html">pkg_delete(1)</a> can be used to remove dependencies when they are no longer needed.</div>
<div class="subsection">
<h2 id="x546563686e6963616c2064657461696c73">Technical details</h2> <b class="name">pkg_add</b> deals with &#8216;updatesets&#8217; internally. An updateset is a collection of old package(s) to delete, and new package(s) to install, as an atomic operation. Under normal circumstances, an updateset contains at most one old package and one new package, but some situations may require <b class="name">pkg_add</b> to perform several installations/deletions at once.<div class="spacer">
</div>
For each new package in an updateset, <b class="name">pkg_add</b> extracts the package's &#8220;packing information&#8221; (the packing-list, description, and installation/deinstallation scripts) into a special staging directory in <i class="file">/var/tmp</i> (or <span class="env">PKG_TMPDIR</span> if set) and then runs through the following sequence to fully extract the contents of the package:<ol style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-enum">
<li class="list-enum" style="margin-top: 1.00em;">
A check is made to determine if the package is already recorded as installed. If it is, the installation is terminated.</li>
<li class="list-enum" style="margin-top: 1.00em;">
A check is made to determine if the package conflicts (from <b class="flag">@conflict</b> directives; see <a class="link-man" href="../html1/pkg_create.html">pkg_create(1)</a>) with a package already recorded as installed. In non-replacement mode, its installation is terminated.</li>
<li class="list-enum" style="margin-top: 1.00em;">
For packages tagged with architecture constraints, <b class="name">pkg_add</b> verifies that the current machine architecture agrees with the constraints.</li>
<li class="list-enum" style="margin-top: 1.00em;">
All package dependencies (from <b class="flag">@depend</b> and <b class="flag">@wantlib</b> directives; see <a class="link-man" href="../html1/pkg_create.html">pkg_create(1)</a>) are read from the packing-list. If any of these dependencies are not currently fulfilled, an attempt is made to find a package that meets them and install it, looking first in the current updateset, then in the list of packages to install passed to <b class="name">pkg_add</b>; if no adequate package can be found and installed, the installation is terminated.</li>
<li class="list-enum" style="margin-top: 1.00em;">
<b class="name">pkg_add</b> checks for collisions with installed file names, read-only file systems, and enough space to store files.</li>
<li class="list-enum" style="margin-top: 1.00em;">
The packing-list is used as a guide for extracting files from the package into their final locations.</li>
<li class="list-enum" style="margin-top: 1.00em;">
After installation is complete, a copy of all package files such as the packing-list, extra messages, or the description file is made into <i class="file">/var/db/pkg/&lt;pkg-name&gt;</i> for subsequent possible use by <a class="link-man" href="../html1/pkg_delete.html">pkg_delete(1)</a> and <a class="link-man" href="../html1/pkg_info.html">pkg_info(1)</a>. Any package dependencies are recorded in the other packages' <i class="file">/var/db/pkg/&lt;other-pkg&gt;/+REQUIRED_BY</i> file (if the environment variable <span class="env">PKG_DBDIR</span> is set, this overrides the <i class="file">/var/db/pkg/</i> path shown above).</li>
<li class="list-enum" style="margin-top: 1.00em;">
Finally, the staging area is deleted and the program terminates.</li>
</ol>
<div class="spacer">
</div>
Note that it is safe to interrupt <b class="name">pkg_add</b> through <span class="define">SIGINT</span>, <span class="define">SIGHUP</span>, and other signals, as it will safely record an interrupted install as <i class="file">partial-&lt;pkgname&gt;[.n]</i>.<div class="spacer">
</div>
When replacing packages, the procedure is slightly different.<ol style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-enum">
<li class="list-enum" style="margin-top: 1.00em;">
A check is made to determine if a similar package is already installed. If so, its full update signature is computed, which contains all the necessary dependency information along with the actual package version. If that signature is identical to that of the new package, no replacement is performed (unless -D installed is specified).</li>
<li class="list-enum" style="margin-top: 1.00em;">
A check is made to determine what old package(s) the new package(s) should replace, using conflicts. <b class="name">pkg_add</b> will attempt to update those packages. If they update to the new package(s), nothing needs to be done. If they're part of the list of updatesets to install, the corresponding updatesets will be merged. Otherwise, <b class="name">pkg_add</b> will add them to the current updateset, and rerun update to find suitable update to those packages.</li>
<li class="list-enum" style="margin-top: 1.00em;">
A check is made to determine whether the old packages will be deleted without issue, and whether the new packages will install correctly. This includes refusing to run any code (unless -D update), and verifying that the new package still matches dependencies (unless -D updatedepends).</li>
<li class="list-enum" style="margin-top: 1.00em;">
Shared libraries deserve special treatment: each shared library from the old packages that does no longer exist in the new packages, but that is required from a wantlib of another package is kept along in a stub package named <i class="file">.libs-&lt;pkgname&gt;</i>.</li>
<li class="list-enum" style="margin-top: 1.00em;">
The new packages are extracted to the filesystem, using temporary filenames of the form <i class="file">pkg.XXXXXXX</i> since the old packages are still there. The packing-list is amended to record these names as @temp annotations, in cases the installation fails.</li>
<li class="list-enum" style="margin-top: 1.00em;">
The old packages are deleted as usual, except that some packages may still depend on them. Note also that <b class="flag">@unexec-delete</b> commands are not executed.</li>
<li class="list-enum" style="margin-top: 1.00em;">
The new packages are installed as usual, except that the files are already present and only need to be renamed. Note also that <b class="flag">@exec-add</b> commands are not executed.</li>
<li class="list-enum" style="margin-top: 1.00em;">
Dependencies from the old packages are adjusted to point to the correct new package.</li>
</ol>
<div class="spacer">
</div>
To update packages in -u mode, <b class="name">pkg_add</b> performs the following steps.<ol style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-enum">
<li class="list-enum" style="margin-top: 1.00em;">
Each package name is reduced to its stem, and every package name with matching stem available through <span class="env">PKG_PATH</span> is considered as an update candidate.</li>
<li class="list-enum" style="margin-top: 1.00em;">
<b class="name">pkg_add</b> searches for a &#8216;quirks&#8217; package first, which may contain exceptions to these rules. This special package contains global information, such as packages that can be deleted because they're now part of base, or stem changes.</li>
<li class="list-enum" style="margin-top: 1.00em;">
Version matching occurs: unless -D downgrade, only packages with newer versions will be considered as update candidates. Note that version matching is costly, thus <span class="env">PKG_PATH</span> should point to a snapshot of packages for a given version of <span class="unix">OpenBSD</span>, similar to the organization on the FTP sites.</li>
<li class="list-enum" style="margin-top: 1.00em;">
Candidates are then matched according to their pkgpaths (see <a class="link-man" href="../html7/pkgpath.html">pkgpath(7)</a> and <a class="link-man" href="../html1/pkg_create.html">pkg_create(1)</a>) in order to weed out similar packages with distinct options.</li>
<li class="list-enum" style="margin-top: 1.00em;">
The update signature of the candidate is compared to the signature of the already installed package: identical signatures mean no update needed.</li>
<li class="list-enum" style="margin-top: 1.00em;">
If several candidates are left, <b class="name">pkg_add</b> will ask the user in interactive mode, and not perform the update in non-interactive mode.</li>
<li class="list-enum" style="margin-top: 1.00em;">
Once a suitable update candidate has been found, <b class="name">pkg_add</b> checks the package dependencies. If necessary, it will install or update them first. Once all dependencies are up-to-date, <b class="name">pkg_add</b> will update the package.</li>
</ol>
</div>
</div>
<div class="section">
<h1 id="x454e5649524f4e4d454e54">ENVIRONMENT</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="env">FTPMODE</span></dt>
<dd class="list-tag" style="margin-left: 11.00ex;">
Specifies whether <a class="link-man" href="../html1/ftp.html">ftp(1)</a> should operate in &#8220;active&#8221; or &#8220;passive&#8221; mode. The default is &#8220;passive&#8221;.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="env">FETCH_CMD</span></dt>
<dd class="list-tag" style="margin-left: 11.00ex;">
Override use of <a class="link-man" href="../html1/ftp.html">ftp(1)</a>. Must point to a command that understands <code class="lit">${FETCH_CMD} -o - url</code>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="env">FTP_KEEPALIVE</span></dt>
<dd class="list-tag" style="margin-left: 11.00ex;">
Have <a class="link-man" href="../html1/ftp.html">ftp(1)</a> send a byte after every <span class="env">FTP_KEEPALIVE</span> seconds, so that incorrectly configured network equipment won't aggressively drop it. See &#8220;ftp -k&#8221; for more information.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="env">PKG_DBDIR</span></dt>
<dd class="list-tag" style="margin-left: 11.00ex;">
Where to register packages instead of <i class="file">/var/db/pkg</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="env">PKG_DESTDIR</span></dt>
<dd class="list-tag" style="margin-left: 11.00ex;">
Value for <i class="arg">pkg-destdir</i>, if no <b class="flag">-B</b> option is specified.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="env">PKG_CACHE</span></dt>
<dd class="list-tag" style="margin-left: 11.00ex;">
If set, any package retrieved from a distant location will be copied to that directory as well.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="env">PKG_PATH</span></dt>
<dd class="list-tag" style="margin-left: 11.00ex;">
If a given package name cannot be found, the directories named by <span class="env">PKG_PATH</span> are searched. It should contain a series of entries separated by colons. Each entry consists of a directory name. URL schemes such as FTP, HTTP, HTTPS, or SCP are also appropriate. The current directory may be indicated implicitly by an empty directory name, or explicitly by a single period (&#8216;<code class="lit">./</code>&#8217;). Special sequences &#8216;%a&#8217;, &#8216;%c&#8217;, &#8216;%m&#8217;, &#8216;%v&#8217; will be expanded with the same semantics as <i class="arg">installpath</i> in <a class="link-man" href="../html5/pkg.conf.html">pkg.conf(5)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="env">PKG_TMPDIR</span></dt>
<dd class="list-tag" style="margin-left: 11.00ex;">
Temporary area where package information files will be extracted, instead of <i class="file">/var/tmp</i>.</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html1/ftp.html">ftp(1)</a>, <a class="link-man" href="../html1/pkg_create.html">pkg_create(1)</a>, <a class="link-man" href="../html1/pkg_delete.html">pkg_delete(1)</a>, <a class="link-man" href="../html1/pkg_info.html">pkg_info(1)</a>, <a class="link-man" href="../html3p/OpenBSD::Intro.html">OpenBSD::Intro(3p)</a>, <a class="link-man" href="../html5/bsd.port.mk.html">bsd.port.mk(5)</a>, <a class="link-man" href="../html5/package.html">package(5)</a>, <a class="link-man" href="../html5/pkg.conf.html">pkg.conf(5)</a>, <a class="link-man" href="../html8/pkg_check.html">pkg_check(8)</a></div>
<div class="section">
<h1 id="x415554484f5253">AUTHORS</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="author">Jordan Hubbard</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Initial design.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<br/>
<span class="author">Marc Espie</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Complete rewrite.</dd>
</dl>
</div>
</div>
</body>
</html>

