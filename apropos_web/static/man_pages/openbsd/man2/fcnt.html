<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
FCNTL(2)</title>
</head>
<body>
<div class="mandoc">
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">fcntl</b> &#8212; <span class="desc">file control</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">fcntl.h</a>&gt;</b><div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">fcntl</b>(<i class="farg" style="white-space:nowrap;">int fd</i>, <i class="farg" style="white-space:nowrap;">int cmd</i>, <i class="farg" style="white-space:nowrap;">...</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="fname">fcntl</b>() provides control over the properties of a file that is already open. The argument <i class="farg">fd</i> is a descriptor to be operated on by <i class="farg">cmd</i> as described below. The third parameter is called <i class="farg">arg</i> and is technically a pointer to <i class="farg">void</i>, but is interpreted as an <code class="lit">int</code> by some commands, a pointer to a <code class="lit">struct flock</code> by others (see below), and ignored by the rest.<div class="spacer">
</div>
The commands are:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">F_DUPFD</span></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
Return a new descriptor as follows:<div class="spacer">
</div>
<ul style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-bul">
<li class="list-bul" style="margin-top: 0.00em;">
Lowest numbered available descriptor greater than or equal to <i class="farg">arg</i> (interpreted as an <code class="lit">int</code>).</li>
<li class="list-bul" style="margin-top: 0.00em;">
Same object references as the original descriptor.</li>
<li class="list-bul" style="margin-top: 0.00em;">
New descriptor shares the same file offset if the object was a file.</li>
<li class="list-bul" style="margin-top: 0.00em;">
Same access mode (read, write or read/write).</li>
<li class="list-bul" style="margin-top: 0.00em;">
Same file status flags (i.e., both file descriptors share the same file status flags).</li>
<li class="list-bul" style="margin-top: 0.00em;">
The close-on-exec flag associated with the new file descriptor is set to remain open across <a class="link-man" href="../html2/execve.html">execve(2)</a> calls.</li>
</ul>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">F_DUPFD_CLOEXEC</span></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
Like <span class="define">F_DUPFD</span>, but the <span class="define">FD_CLOEXEC</span> flag associated with the new file descriptor is set, so the file descriptor is closed when <a class="link-man" href="../html2/execve.html">execve(2)</a> is called.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">F_GETFD</span></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
Get the close-on-exec flag associated with the file descriptor <i class="farg">fd</i> as <span class="define">FD_CLOEXEC</span>. If the returned value ANDed with <span class="define">FD_CLOEXEC</span> is 0, the file will remain open across <b class="fname">exec</b>(), otherwise the file will be closed upon execution of <b class="fname">exec</b>() (<i class="farg">arg</i> is ignored).</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">F_SETFD</span></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
Set the close-on-exec flag associated with <i class="farg">fd</i> to <i class="farg">arg</i>, where <i class="farg">arg</i> (interpreted as an <code class="lit">int</code>) is either 0 or <span class="define">FD_CLOEXEC</span>, as described above.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">F_GETFL</span></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
Get file status flags associated with the file descriptor <i class="farg">fd</i>, as described below (<i class="farg">arg</i> is ignored).</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">F_SETFL</span></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
Set file status flags associated with the file descriptor <i class="farg">fd</i> to <i class="farg">arg</i> (interpreted as an <code class="lit">int</code>).</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">F_GETOWN</span></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
Get the process ID or process group currently receiving <span class="define">SIGIO</span> and <span class="define">SIGURG</span> signals; process groups are returned as negative values (<i class="farg">arg</i> is ignored).</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">F_SETOWN</span></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
Set the process or process group to receive <span class="define">SIGIO</span> and <span class="define">SIGURG</span> signals; process groups are specified by supplying <i class="farg">arg</i> (interpreted as an <code class="lit">int</code>) as negative, otherwise <i class="farg">arg</i> is taken as a process ID.</dd>
</dl>
<div class="spacer">
</div>
The flags for the <span class="define">F_GETFL</span> and <span class="define">F_SETFL</span> commands are as follows:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">O_NONBLOCK</span></dt>
<dd class="list-tag" style="margin-left: 11.00ex;">
Non-blocking I/O; if no data is available to a <a class="link-man" href="../html2/read.html">read(2)</a> call, or if a <a class="link-man" href="../html2/write.html">write(2)</a> operation would block, the read or write call returns -1 with the error <span class="errno">EAGAIN</span>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">O_APPEND</span></dt>
<dd class="list-tag" style="margin-left: 11.00ex;">
Force each write to append at the end of file; corresponds to the <span class="define">O_APPEND</span> flag of <a class="link-man" href="../html2/open.html">open(2)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">O_ASYNC</span></dt>
<dd class="list-tag" style="margin-left: 11.00ex;">
Enable the <span class="define">SIGIO</span> signal to be sent to the process group when I/O is possible, e.g., upon availability of data to be read.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">O_SYNC</span></dt>
<dd class="list-tag" style="margin-left: 11.00ex;">
Cause writes to be synchronous. Data will be written to the physical device instead of just being stored in the buffer cache; corresponds to the <span class="define">O_SYNC</span> flag of <a class="link-man" href="../html2/open.html">open(2)</a>.</dd>
</dl>
<div class="spacer">
</div>
Several commands are available for doing advisory file locking; they all operate on the following structure:<div class="spacer">
</div>
<pre style="margin-left: 0.00ex;" class="lit display">
struct flock { 
	off_t	l_start;	/* starting offset */ 
	off_t	l_len;		/* len = 0 means until end of file */ 
	pid_t	l_pid;		/* lock owner */ 
	short	l_type;		/* lock type: read/write, etc. */ 
	short	l_whence;	/* type of l_start */ 
};</pre>
<div class="spacer">
</div>
The commands available for advisory record locking are as follows:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">F_GETLK</span></dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
Get the first lock that blocks the lock description pointed to by the third argument, <i class="farg">arg</i>, taken as a pointer to a <i class="farg">struct flock</i> (see above). The information retrieved overwrites the information passed to <b class="fname">fcntl</b>() in the <i class="farg">flock</i> structure. If no lock is found that would prevent this lock from being created, the structure is left unchanged by this function call except for the lock type which is set to <span class="define">F_UNLCK</span>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">F_SETLK</span></dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
Set or clear a file segment lock according to the lock description pointed to by the third argument, <i class="farg">arg</i>, taken as a pointer to a <i class="farg">struct flock</i> (see above). <span class="define">F_SETLK</span> is used to establish shared (or read) locks (<span class="define">F_RDLCK</span>) or exclusive (or write) locks (<span class="define">F_WRLCK</span>), as well as remove either type of lock (<span class="define">F_UNLCK</span>). If a shared or exclusive lock cannot be set, <b class="fname">fcntl</b>() returns immediately with <span class="errno">EAGAIN</span>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">F_SETLKW</span></dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
This command is the same as <span class="define">F_SETLK</span> except that if a shared or exclusive lock is blocked by other locks, the process waits until the request can be satisfied. If a signal that is to be caught is received while <b class="fname">fcntl</b>() is waiting for a region, the <b class="fname">fcntl</b>() will be interrupted if the signal handler has not specified the <span class="define">SA_RESTART</span> (see <a class="link-man" href="../html2/sigaction.html">sigaction(2)</a>).</dd>
</dl>
<div class="spacer">
</div>
When a shared lock has been set on a segment of a file, other processes can set shared locks on that segment or a portion of it. A shared lock prevents any other process from setting an exclusive lock on any portion of the protected area. A request for a shared lock fails if the file descriptor was not opened with read access.<div class="spacer">
</div>
An exclusive lock prevents any other process from setting a shared lock or an exclusive lock on any portion of the protected area. A request for an exclusive lock fails if the file was not opened with write access.<div class="spacer">
</div>
The value of <i class="farg">l_whence</i> is <span class="define">SEEK_SET</span>, <span class="define">SEEK_CUR</span>, or <span class="define">SEEK_END</span> to indicate that the relative offset, <i class="farg">l_start</i> bytes, will be measured from the start of the file, current position, or end of the file, respectively. The value of <i class="farg">l_len</i> is the number of consecutive bytes to be locked. If <i class="farg">l_len</i> is negative, the result is undefined. The <i class="farg">l_pid</i> field is only used with <span class="define">F_GETLK</span> to return the process ID of the process holding a blocking lock. After a successful <span class="define">F_GETLK</span> request, the value of <i class="farg">l_whence</i> is <span class="define">SEEK_SET</span>.<div class="spacer">
</div>
Locks may start and extend beyond the current end of a file, but may not start or extend before the beginning of the file. A lock is set to extend to the largest possible value of the file offset for that file if <i class="farg">l_len</i> is set to zero. If <i class="farg">l_whence</i> and <i class="farg">l_start</i> point to the beginning of the file, and <i class="farg">l_len</i> is zero, the entire file is locked. If an application wishes only to do entire file locking, the <a class="link-man" href="../html2/flock.html">flock(2)</a> system call is much more efficient.<div class="spacer">
</div>
There is at most one type of lock set for each byte in the file. Before a successful return from an <span class="define">F_SETLK</span> or an <span class="define">F_SETLKW</span> request when the calling process has previously existing locks on bytes in the region specified by the request, the previous lock type for each byte in the specified region is replaced by the new lock type. As specified above under the descriptions of shared locks and exclusive locks, an <span class="define">F_SETLK</span> or an <span class="define">F_SETLKW</span> request fails or blocks respectively when another process has existing locks on bytes in the specified region and the type of any of those locks conflicts with the type specified in the request.<div class="spacer">
</div>
This interface follows the completely stupid semantics of System V and IEEE Std 1003.1-1988 (&#8220;POSIX.1&#8221;) that require that all locks associated with a file for a given process are removed when <span class="emph">any</span> file descriptor for that file is closed by that process. This semantic means that applications must be aware of any files that a subroutine library may access. For example if an application for updating the password file locks the password file database while making the update, and then calls <a class="link-man" href="../html3/getpwnam.html">getpwnam(3)</a> to retrieve a record, the lock will be lost because <a class="link-man" href="../html3/getpwnam.html">getpwnam(3)</a> opens, reads, and closes the password database. The database close will release all locks that the process has associated with the database, even if the library routine never requested a lock on the database. Another minor semantic problem with this interface is that locks are not inherited by a child process created using the <a class="link-man" href="../html2/fork.html">fork(2)</a> function. The <a class="link-man" href="../html2/flock.html">flock(2)</a> interface has much more rational last close semantics and allows locks to be inherited by child processes. <a class="link-man" href="../html2/flock.html">flock(2)</a> is recommended for applications that want to ensure the integrity of their locks when using library routines or wish to pass locks to their children. Note that <a class="link-man" href="../html2/flock.html">flock(2)</a> and <b class="fname">fcntl</b>() locks may be safely used concurrently.<div class="spacer">
</div>
All locks associated with a file for a given process are removed when the process terminates.<div class="spacer">
</div>
A potential for deadlock occurs if a process controlling a locked region is put to sleep by attempting to lock the locked region of another process. This implementation detects that sleeping until a locked region is unlocked would cause a deadlock and fails with an <span class="errno">EDEADLK</span> error.</div>
<div class="section">
<h1 id="x52455455524e2056414c554553">RETURN VALUES</h1> Upon successful completion, the value returned depends on <i class="farg">cmd</i> as follows:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 6.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">F_DUPFD</span></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
A new file descriptor.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">F_DUPFD_CLOEXEC</span></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
A new file descriptor.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">F_GETFD</span></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
Value of flag (only the low-order bit is defined).</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">F_GETFL</span></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
Value of flags.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">F_GETOWN</span></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
Value of file descriptor owner.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
other</dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
Value other than -1.</dd>
</dl>
<div class="spacer">
</div>
Otherwise, a value of -1 is returned and <b class="var">errno</b> is set to indicate the error.</div>
<div class="section">
<h1 id="x4552524f5253">ERRORS</h1> <b class="fname">fcntl</b>() will fail if:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">EAGAIN</span>]</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The argument <i class="farg">cmd</i> is <span class="define">F_SETLK</span>, the type of lock (<i class="farg">l_type</i>) is a shared lock (<span class="define">F_RDLCK</span>) or exclusive lock (<span class="define">F_WRLCK</span>), and the segment of a file to be locked is already exclusive-locked by another process; or the type is an exclusive lock and some portion of the segment of a file to be locked is already shared-locked or exclusive-locked by another process.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">EBADF</span>]</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
<i class="farg">fd</i> is not a valid open file descriptor.<div class="spacer">
</div>
The argument <i class="farg">cmd</i> is <span class="define">F_SETLK</span> or <span class="define">F_SETLKW</span>, the type of lock (<i class="farg">l_type</i>) is a shared lock (<span class="define">F_RDLCK</span>), and <i class="farg">fd</i> is not a valid file descriptor open for reading.<div class="spacer">
</div>
The argument <i class="farg">cmd</i> is <span class="define">F_SETLK</span> or <span class="define">F_SETLKW</span>, the type of lock (<i class="farg">l_type</i>) is an exclusive lock (<span class="define">F_WRLCK</span>), and <i class="farg">fd</i> is not a valid file descriptor open for writing.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">EDEADLK</span>]</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The argument <i class="farg">cmd</i> is <span class="define">F_SETLKW</span>, and a deadlock condition was detected.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">EINTR</span>]</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The argument <i class="farg">cmd</i> is invalid.<div class="spacer">
</div>
The argument <i class="farg">cmd</i> is <span class="define">F_SETLKW</span>, and the function was interrupted by a signal.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">EINVAL</span>]</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
<i class="farg">cmd</i> is <span class="define">F_DUPFD</span> and <i class="farg">arg</i> is negative or greater than the maximum allowable number (see <a class="link-man" href="../html3/getdtablesize.html">getdtablesize(3)</a>).<div class="spacer">
</div>
The argument <i class="farg">cmd</i> is <span class="define">F_GETLK</span>, <span class="define">F_SETLK</span>, or <span class="define">F_SETLKW</span> and the data to which <i class="farg">arg</i> points is not valid, or <i class="farg">fd</i> refers to a file that does not support locking.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">EMFILE</span>]</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The argument <i class="farg">cmd</i> is <span class="define">F_DUPFD</span> and the maximum number of open file descriptors permitted for the process are already in use, or no file descriptors greater than or equal to <i class="farg">arg</i> are available.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">ENOLCK</span>]</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The argument <i class="farg">cmd</i> is <span class="define">F_SETLK</span> or <span class="define">F_SETLKW</span>, and satisfying the lock or unlock request would result in the number of locked regions in the system exceeding a system-imposed limit.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">ESRCH</span>]</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
<i class="farg">cmd</i> is <span class="define">F_SETOWN</span> and the process ID given in <i class="farg">arg</i> is not in use.</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html2/close.html">close(2)</a>, <a class="link-man" href="../html2/execve.html">execve(2)</a>, <a class="link-man" href="../html2/flock.html">flock(2)</a>, <a class="link-man" href="../html2/open.html">open(2)</a>, <a class="link-man" href="../html2/sigaction.html">sigaction(2)</a>, <a class="link-man" href="../html3/getdtablesize.html">getdtablesize(3)</a></div>
<div class="section">
<h1 id="x5354414e4441524453">STANDARDS</h1> The <b class="fname">fcntl</b>() function conforms to IEEE Std 1003.1-2008 (&#8220;POSIX.1&#8221;).</div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="fname">fcntl</b>() function call appeared in <span class="unix">4.2BSD</span>.</div>
</div>
</body>
</html>

