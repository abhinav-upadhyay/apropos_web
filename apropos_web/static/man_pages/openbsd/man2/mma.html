<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
MMAP(2)</title>
</head>
<body>
<div class="mandoc">
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">mmap</b> &#8212; <span class="desc">map files or devices into memory</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">sys/mman.h</a>&gt;</b><div class="spacer">
</div>
<i class="ftype">void *</i><br/>
<b class="fname">mmap</b>(<i class="farg" style="white-space:nowrap;">void *addr</i>, <i class="farg" style="white-space:nowrap;">size_t len</i>, <i class="farg" style="white-space:nowrap;">int prot</i>, <i class="farg" style="white-space:nowrap;">int flags</i>, <i class="farg" style="white-space:nowrap;">int fd</i>, <i class="farg" style="white-space:nowrap;">off_t offset</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="fname">mmap</b>() function causes the contents of <i class="farg">fd</i>, starting at <i class="farg">offset</i>, to be mapped in memory at the given <i class="farg">addr</i>. The mapping will extend at least <i class="farg">len</i> bytes, subject to page alignment restrictions.<div class="spacer">
</div>
The <i class="farg">addr</i> argument describes the address where the system should place the mapping. If the <span class="define">MAP_FIXED</span> flag is specified, the allocation will happen at the specified address, replacing any previously established mappings in its range. Otherwise, the mapping will be placed at the available spot at <i class="farg">addr</i>; failing that it will be placed &quot;close by&quot;. If <i class="farg">addr</i> is <span class="define">NULL</span> the system can pick any address. Except for <span class="define">MAP_FIXED</span> mappings, the system will never replace existing mappings.<div class="spacer">
</div>
The <i class="farg">len</i> argument describes the minimum amount of bytes the mapping will span. Since <b class="fname">mmap</b>() maps pages into memory, <i class="farg">len</i> may be rounded up to hit a page boundary. If <i class="farg">len</i> is 0, the mapping will fail with <span class="errno">EINVAL</span>.<div class="spacer">
</div>
If an <i class="farg">fd</i> and <i class="farg">offset</i> are specified, the resulting address may end up not on a page boundary, in order to align the page offset in the <i class="farg">addr</i> to the page offset in <i class="farg">offset</i>.<div class="spacer">
</div>
The protections (region accessibility) are specified in the <i class="farg">prot</i> argument. It should either be <span class="define">PROT_NONE</span> (no permissions) or the bitwise OR of one or more of the following values:<div class="spacer">
</div>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 6.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">PROT_EXEC</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Pages may be executed.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">PROT_READ</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Pages may be read.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">PROT_WRITE</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Pages may be written.</dd>
</dl>
<div class="spacer">
</div>
The <i class="farg">flags</i> parameter specifies the type of the mapped object, mapping options, and whether modifications made to the mapped copy of the page are private to the process or are to be shared with other references. Sharing, mapping type, and options are specified in the <i class="farg">flags</i> argument by OR'ing the following values. Exactly one of the first two values must be specified:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 6.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">MAP_PRIVATE</span></dt>
<dd class="list-tag" style="margin-left: 13.00ex;">
Modifications are private.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">MAP_SHARED</span></dt>
<dd class="list-tag" style="margin-left: 13.00ex;">
Modifications are shared.</dd>
</dl>
<div class="spacer">
</div>
Any combination of the following flags may additionally be used:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 6.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">MAP_ANON</span></dt>
<dd class="list-tag" style="margin-left: 13.00ex;">
Map anonymous memory not associated with any specific file. The file descriptor used for creating <span class="define">MAP_ANON</span> must currently be -1 indicating no name is associated with the region.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">MAP_ANONYMOUS</span></dt>
<dd class="list-tag" style="margin-left: 13.00ex;">
Synonym for <span class="define">MAP_ANON</span>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">MAP_FIXED</span></dt>
<dd class="list-tag" style="margin-left: 13.00ex;">
Demand that the mapping is placed at <i class="farg">addr</i>, rather than having the system select a location. <i class="farg">addr</i>, <i class="farg">len</i> and <i class="farg">offset</i> (in the case of <i class="farg">fd</i> mappings) must be multiples of the page size. Existing mappings in the address range will be replaced. Use of this option is discouraged.</dd>
</dl>
<div class="spacer">
</div>
Finally, the following flags are also provided for source compatibility with code written for other operating systems, but are not recommended for use in new <span class="unix">OpenBSD</span> code:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 6.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">MAP_COPY</span></dt>
<dd class="list-tag" style="margin-left: 13.00ex;">
Modifications are private and, unlike <span class="define">MAP_PRIVATE</span>, modifications made by others are not visible. On <span class="unix">OpenBSD</span> this behaves just like <span class="define">MAP_PRIVATE</span>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">MAP_FILE</span></dt>
<dd class="list-tag" style="margin-left: 13.00ex;">
Mapped from a regular file, character special file, or block special file specified by file descriptor <i class="farg">fd</i>. On <span class="unix">OpenBSD</span> and all systems conforming to IEEE Std 1003.1-2008 (&#8220;POSIX.1&#8221;) this is the default mapping type and need not be specified.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">MAP_HASSEMAPHORE</span></dt>
<dd class="list-tag" style="margin-left: 13.00ex;">
Notify the kernel that the region may contain semaphores and that special handling may be necessary. On <span class="unix">OpenBSD</span> this flag is ignored.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">MAP_INHERIT</span></dt>
<dd class="list-tag" style="margin-left: 13.00ex;">
Permit regions to be inherited across <a class="link-man" href="../html3/exec.html">exec(3)</a> system calls. On <span class="unix">OpenBSD</span> this flag is ignored.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">MAP_TRYFIXED</span></dt>
<dd class="list-tag" style="margin-left: 13.00ex;">
Attempt to use the hint provided by <i class="farg">addr</i>. On <span class="unix">OpenBSD</span> this is the default behavior.</dd>
</dl>
<div class="spacer">
</div>
The <a class="link-man" href="../html2/close.html">close(2)</a> function does not unmap pages; see <a class="link-man" href="../html2/munmap.html">munmap(2)</a> for further information.</div>
<div class="section">
<h1 id="x52455455524e2056414c554553">RETURN VALUES</h1> The <b class="fname">mmap</b>() function returns a pointer to the mapped region if successful; otherwise the value <span class="define">MAP_FAILED</span> is returned and the global variable <b class="var">errno</b> is set to indicate the error. A successful return from <b class="fname">mmap</b>() will never return the value <span class="define">MAP_FAILED</span>.</div>
<div class="section">
<h1 id="x4552524f5253">ERRORS</h1> <b class="fname">mmap</b>() will fail if:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">EACCES</span>]</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The flag <span class="define">PROT_READ</span> was specified as part of the <i class="farg">prot</i> parameter and <i class="farg">fd</i> was not open for reading. The flags <span class="define">MAP_SHARED</span> and <span class="define">PROT_WRITE</span> were specified as part of the <i class="farg">flags</i> and <i class="farg">prot</i> parameters and <i class="farg">fd</i> was not open for writing.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">EBADF</span>]</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
<i class="farg">fd</i> is not a valid open file descriptor.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">EINVAL</span>]</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
<span class="define">MAP_PRIVATE</span> and <span class="define">MAP_SHARED</span> were both specified.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">EINVAL</span>]</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
<span class="define">MAP_FIXED</span> was specified and the <i class="farg">addr</i> parameter was not page aligned.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">EINVAL</span>]</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
<i class="farg">addr</i> and <i class="farg">len</i> specified a region that would extend beyond the end of the address space.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">EINVAL</span>]</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
<i class="farg">fd</i> did not specify a regular, character special, or block special file.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">EINVAL</span>]</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The allocation <i class="farg">len</i> was 0.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">ENOMEM</span>]</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
<span class="define">MAP_FIXED</span> was specified and the <i class="farg">addr</i> parameter wasn't available. <span class="define">MAP_ANON</span> was specified and insufficient memory was available.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">ENOTSUP</span>]</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The accesses requested in the <i class="arg">prot</i> argument are not allowed. In particular, <span class="define">PROT_WRITE</span> | <span class="define">PROT_EXEC</span> mappings are not permitted in most binaries (see <span class="define">kern.wxabort</span> in sysctl 3 for more information).</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html2/madvise.html">madvise(2)</a>, <a class="link-man" href="../html2/mincore.html">mincore(2)</a>, <a class="link-man" href="../html2/mlock.html">mlock(2)</a>, <a class="link-man" href="../html2/mprotect.html">mprotect(2)</a>, <a class="link-man" href="../html2/mquery.html">mquery(2)</a>, <a class="link-man" href="../html2/msync.html">msync(2)</a>, <a class="link-man" href="../html2/munmap.html">munmap(2)</a>, <a class="link-man" href="../html3/getpagesize.html">getpagesize(3)</a></div>
<div class="section">
<h1 id="x5354414e4441524453">STANDARDS</h1> The <b class="fname">mmap</b>() function conforms to IEEE Std 1003.1-2008 (&#8220;POSIX.1&#8221;).</div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="fname">mmap</b>() system call first appeared in <span class="unix">4.1cBSD</span>.</div>
<div class="section">
<h1 id="x43415645415453">CAVEATS</h1> IEEE Std 1003.1-2008 (&#8220;POSIX.1&#8221;) specifies that references to pages beyond the end of a mapped object shall generate a <span class="define">SIGBUS</span> signal; however, <span class="unix">OpenBSD</span> generates a <span class="define">SIGSEGV</span> signal in this case instead.<div class="spacer">
</div>
Additionally, IEEE Std 1003.1-2008 (&#8220;POSIX.1&#8221;) specifies that <b class="fname">mmap</b>() shall fail with <span class="errno">EINVAL</span> if neither <span class="define">MAP_PRIVATE</span> nor <span class="define">MAP_SHARED</span> is specified by <i class="farg">flags</i>; however, for compatibility with old programs, <span class="unix">OpenBSD</span> instead defaults to <span class="define">MAP_SHARED</span> for mappings of character special files, and to <span class="define">MAP_PRIVATE</span> for all other mappings. New programs should not rely on this behavior.</div>
<div class="section">
<h1 id="x42554753">BUGS</h1> Due to a limitation of the current vm system (see <a class="link-man" href="../html9/uvm.html">uvm(9)</a>), mapping descriptors <span class="define">PROT_WRITE</span> without also specifying <span class="define">PROT_READ</span> is useless (results in a segmentation fault when first accessing the mapping). This means that such descriptors must be opened with <span class="define">O_RDWR</span>, which requires both read and write permissions on the underlying object.</div>
</div>
</body>
</html>

