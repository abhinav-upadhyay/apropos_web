<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
KTRACE(2)</title>
</head>
<body>
<div class="mandoc">
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">ktrace</b> &#8212; <span class="desc">process tracing</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">sys/types.h</a>&gt;</b><br/>
<b class="includes">#include &lt;<a class="link-includes">sys/param.h</a>&gt;</b><br/>
<b class="includes">#include &lt;<a class="link-includes">sys/uio.h</a>&gt;</b><br/>
<b class="includes">#include &lt;<a class="link-includes">sys/ktrace.h</a>&gt;</b><div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">ktrace</b>(<i class="farg" style="white-space:nowrap;">const char *tracefile</i>, <i class="farg" style="white-space:nowrap;">int ops</i>, <i class="farg" style="white-space:nowrap;">int trpoints</i>, <i class="farg" style="white-space:nowrap;">pid_t pid</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="fname">ktrace</b>() function enables or disables tracing of one or more processes. Users may only trace their own processes. Only the superuser can trace setuid or setgid programs. <b class="fname">ktrace</b>() is only available on kernels compiled with the <b class="flag">KTRACE</b> option.<div class="spacer">
</div>
<i class="farg">tracefile</i> gives the pathname of the file to be used for tracing. The file must exist, be writable by the calling process, and not be a symbolic link. All trace records are always appended to the file, so the file must be truncated to zero length to discard previous trace data. If tracing points are being disabled (see <span class="define">KTROP_CLEAR</span> below), <i class="farg">tracefile</i> may be <span class="define">NULL</span>.<div class="spacer">
</div>
The <i class="farg">ops</i> parameter specifies the requested ktrace operation. The defined operations are:<div class="spacer">
</div>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 6.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">KTROP_SET</span></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
Enable trace points specified in <i class="farg">trpoints</i>.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">KTROP_CLEAR</span></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
Disable trace points specified in <i class="farg">trpoints</i>.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">KTROP_CLEARFILE</span></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
Stop all tracing.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">KTRFLAG_DESCEND</span></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
The tracing change should apply to the specified process and all its current children.</dd>
</dl>
<div class="spacer">
</div>
The <i class="farg">trpoints</i> parameter specifies the trace points of interest. The defined trace points are:<div class="spacer">
</div>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 6.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">KTRFAC_SYSCALL</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Trace system calls.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">KTRFAC_SYSRET</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Trace return values from system calls.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">KTRFAC_NAMEI</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Trace name lookup operations.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">KTRFAC_GENIO</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Trace all I/O (note that this option can generate much output).</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">KTRFAC_PSIG</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Trace posted signals.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">KTRFAC_STRUCT</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Trace various structs</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">KTRFAC_USER</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Trace user data coming from <a class="link-man" href="../html2/utrace.html">utrace(2)</a> calls.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">KTRFAC_INHERIT</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Inherit tracing to future children.</dd>
</dl>
<div class="spacer">
</div>
The <i class="farg">pid</i> parameter refers to a process ID. If it is negative, it refers to a process group ID.<div class="spacer">
</div>
Each tracing event outputs a record composed of a generic header followed by a trace point specific structure. The generic header is:<div class="spacer">
</div>
<pre style="margin-left: 0.00ex;" class="lit display">
struct ktr_header { 
	uint	ktr_type;		/* trace record type */ 
	pid_t	ktr_pid;		/* process id */ 
	pid_t	ktr_tid;		/* thread id */ 
	struct	timespec ktr_time;	/* timestamp */ 
	char	ktr_comm[MAXCOMLEN+1];	/* command name */ 
	size_t	ktr_len;		/* length of buf */ 
};</pre>
<div class="spacer">
</div>
The <i class="farg">ktr_len</i> field specifies the length of the <i class="farg">ktr_type</i> data that follows this header. The <i class="farg">ktr_pid</i>, <i class="farg">ktr_tid</i>, and <i class="farg">ktr_comm</i> fields specify the process, thread, and command generating the record. The <i class="farg">ktr_time</i> field gives the time (with nanosecond resolution) that the record was generated.<div class="spacer">
</div>
The generic header is followed by <i class="farg">ktr_len</i> bytes of a <i class="farg">ktr_type</i> record. The type specific records are defined in the <b class="includes">&lt;<a class="link-includes">sys/ktrace.h</a>&gt;</b> include file.</div>
<div class="section">
<h1 id="x52455455524e2056414c554553">RETURN VALUES</h1> Upon successful completion, the value&#160;0 is returned; otherwise the value&#160;-1 is returned and the global variable <b class="var">errno</b> is set to indicate the error.</div>
<div class="section">
<h1 id="x4552524f5253">ERRORS</h1> <b class="fname">ktrace</b>() will fail if:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">ENOTDIR</span>]</dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
A component of the path prefix is not a directory.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">EINVAL</span>]</dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
No trace points were selected.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">ENAMETOOLONG</span>]</dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
A component of a pathname exceeded <span class="define">NAME_MAX</span> characters, or an entire pathname (including the terminating NUL) exceeded <span class="define">PATH_MAX</span> bytes.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">ENOENT</span>]</dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
The named tracefile does not exist.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">EACCES</span>]</dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Search permission is denied for a component of the path prefix or the path refers to a symbolic link.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">ELOOP</span>]</dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Too many symbolic links were encountered in translating the pathname.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">EIO</span>]</dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
An I/O error occurred while reading from or writing to the file system.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">ESRCH</span>]</dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
No process can be found corresponding to that specified by <i class="farg">pid</i>.</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html1/kdump.html">kdump(1)</a>, <a class="link-man" href="../html1/ktrace.html">ktrace(1)</a>, <a class="link-man" href="../html2/utrace.html">utrace(2)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> A <b class="fname">ktrace</b>() function call first appeared in <span class="unix">4.4BSD</span>.</div>
</div>
</body>
</html>

