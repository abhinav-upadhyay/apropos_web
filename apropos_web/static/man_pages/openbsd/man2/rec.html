<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
RECV(2)</title>
</head>
<body>
<div class="mandoc">
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">recv</b>, <b class="name">recvfrom</b>, <b class="name">recvmsg</b> &#8212; <span class="desc">receive a message from a socket</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">sys/socket.h</a>&gt;</b><div class="spacer">
</div>
<i class="ftype">ssize_t</i><br/>
<b class="fname">recv</b>(<i class="farg" style="white-space:nowrap;">int s</i>, <i class="farg" style="white-space:nowrap;">void *buf</i>, <i class="farg" style="white-space:nowrap;">size_t len</i>, <i class="farg" style="white-space:nowrap;">int flags</i>);<div class="spacer">
</div>
<i class="ftype">ssize_t</i><br/>
<b class="fname">recvfrom</b>(<i class="farg" style="white-space:nowrap;">int s</i>, <i class="farg" style="white-space:nowrap;">void *buf</i>, <i class="farg" style="white-space:nowrap;">size_t len</i>, <i class="farg" style="white-space:nowrap;">int flags</i>, <i class="farg" style="white-space:nowrap;">struct sockaddr *from</i>, <i class="farg" style="white-space:nowrap;">socklen_t *fromlen</i>);<div class="spacer">
</div>
<i class="ftype">ssize_t</i><br/>
<b class="fname">recvmsg</b>(<i class="farg" style="white-space:nowrap;">int s</i>, <i class="farg" style="white-space:nowrap;">struct msghdr *msg</i>, <i class="farg" style="white-space:nowrap;">int flags</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> <b class="fname">recvfrom</b>() and <b class="fname">recvmsg</b>() are used to receive messages from a socket, <i class="farg">s</i>, and may be used to receive data on a socket whether or not it is connection-oriented.<div class="spacer">
</div>
If <i class="farg">from</i> is non-null and the socket is not connection-oriented, the source address of the message is filled in. <i class="farg">fromlen</i> is a value-result parameter, initialized to the size of the buffer associated with <i class="farg">from</i>, and modified on return to indicate the actual size of the address stored there.<div class="spacer">
</div>
The <b class="fname">recv</b>() call is normally used only on a <span class="emph">connected</span> socket (see <a class="link-man" href="../html2/connect.html">connect(2)</a>) and is identical to <b class="fname">recvfrom</b>() with a null <i class="farg">from</i> parameter.<div class="spacer">
</div>
On successful completion, all three routines return the number of message bytes read. If a message is too long to fit in the supplied buffer, excess bytes may be discarded depending on the type of socket the message is received from (see <a class="link-man" href="../html2/socket.html">socket(2)</a>).<div class="spacer">
</div>
If no messages are available at the socket, the receive call waits for a message to arrive, unless the socket is nonblocking (see <a class="link-man" href="../html2/fcntl.html">fcntl(2)</a>) in which case the value -1 is returned and the external variable <b class="var">errno</b> set to <span class="errno">EAGAIN</span>. The receive calls normally return any data available, up to the requested amount, rather than waiting for receipt of the full amount requested; this behavior is affected by the socket-level options <span class="define">SO_RCVLOWAT</span> and <span class="define">SO_RCVTIMEO</span> described in <a class="link-man" href="../html2/getsockopt.html">getsockopt(2)</a>.<div class="spacer">
</div>
The <a class="link-man" href="../html2/select.html">select(2)</a> or <a class="link-man" href="../html2/poll.html">poll(2)</a> system calls may be used to determine when more data arrive.<div class="spacer">
</div>
The <i class="farg">flags</i> argument is the bitwise OR of zero or more of the following values:<div class="spacer">
</div>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 6.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">MSG_OOB</span></dt>
<dd class="list-tag" style="margin-left: 18.00ex;">
process out-of-band data</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">MSG_PEEK</span></dt>
<dd class="list-tag" style="margin-left: 18.00ex;">
peek at incoming message</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">MSG_WAITALL</span></dt>
<dd class="list-tag" style="margin-left: 18.00ex;">
wait for full request or error</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">MSG_DONTWAIT</span></dt>
<dd class="list-tag" style="margin-left: 18.00ex;">
don't block</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">MSG_CMSG_CLOEXEC</span></dt>
<dd class="list-tag" style="margin-left: 18.00ex;">
set the close-on-exec flag on received file descriptors</dd>
</dl>
<div class="spacer">
</div>
The <span class="define">MSG_OOB</span> flag requests receipt of out-of-band data that would not be received in the normal data stream. Some protocols place expedited data at the head of the normal data queue, and thus this flag cannot be used with such protocols. The <span class="define">MSG_PEEK</span> flag causes the receive operation to return data from the beginning of the receive queue without removing that data from the queue. Thus, a subsequent receive call will return the same data. The <span class="define">MSG_WAITALL</span> flag requests that the operation block until the full request is satisfied. However, the call may still return less data than requested if a signal is caught, an error or disconnect occurs, or the next data to be received is of a different type than that returned. The <span class="define">MSG_DONTWAIT</span> flag requests the call to return when it would block otherwise. If no data is available, <b class="var">errno</b> is set to <span class="errno">EAGAIN</span>. This flag is not available in strict ANSI or C99 compilation mode. The <span class="define">MSG_CMSG_CLOEXEC</span> requests that any file descriptors received as ancillary data with <b class="fname">recvmsg</b>() (see below) have their close-on-exec flag set.<div class="spacer">
</div>
The <b class="fname">recvmsg</b>() call uses a <i class="farg">msghdr</i> structure to minimize the number of directly supplied parameters. This structure has the following form, as defined in <b class="includes">&lt;<a class="link-includes">sys/socket.h</a>&gt;</b>:<div class="spacer">
</div>
<pre style="margin-left: 0.00ex;" class="lit display">
struct msghdr { 
	void		*msg_name;	/* optional address */ 
	socklen_t	msg_namelen;	/* size of address */ 
	struct		iovec *msg_iov;	/* scatter/gather array */ 
	unsigned int	msg_iovlen;	/* # elements in msg_iov */ 
	void		*msg_control;	/* ancillary data, see below */ 
	socklen_t	msg_controllen; /* ancillary data buffer len */ 
	int		msg_flags;	/* flags on received message */ 
};</pre>
<div class="spacer">
</div>
Here <i class="farg">msg_name</i> and <i class="farg">msg_namelen</i> specify the source address if the socket is unconnected; <i class="farg">msg_name</i> may be given as a null pointer if no names are desired or required. <i class="farg">msg_iov</i> and <i class="farg">msg_iovlen</i> describe scatter gather locations, as discussed in <a class="link-man" href="../html2/read.html">read(2)</a>. <i class="farg">msg_control</i>, which has length <i class="farg">msg_controllen</i>, points to a buffer for other protocol control related messages or other miscellaneous ancillary data. The messages are of the form:<div class="spacer">
</div>
<pre style="margin-left: 0.00ex;" class="lit display">
struct cmsghdr { 
	socklen_t	cmsg_len;   /* data byte count, including hdr */ 
	int		cmsg_level; /* originating protocol */ 
	int		cmsg_type;  /* protocol-specific type */ 
/* followed by u_char	cmsg_data[]; */ 
};</pre>
<div class="spacer">
</div>
See <a class="link-man" href="../html3/CMSG_DATA.html">CMSG_DATA(3)</a> for how these messages are constructed and decomposed.<div class="spacer">
</div>
Open file descriptors are now passed as ancillary data for <span class="define">AF_UNIX</span> domain and <a class="link-man" href="../html2/socketpair.html">socketpair(2)</a> sockets, with <i class="farg">cmsg_level</i> set to <span class="define">SOL_SOCKET</span> and <i class="farg">cmsg_type</i> set to <span class="define">SCM_RIGHTS</span>.<div class="spacer">
</div>
The <i class="farg">msg_flags</i> field is set on return according to the message received. It will contain zero or more of the following values:<div class="spacer">
</div>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 6.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">MSG_OOB</span></dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
Returned to indicate that expedited or out-of-band data was received.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">MSG_EOR</span></dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
Indicates end-of-record; the data returned completed a record (generally used with sockets of type <span class="define">SOCK_SEQPACKET</span>).</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">MSG_TRUNC</span></dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
Indicates that the trailing portion of a datagram was discarded because the datagram was larger than the buffer supplied.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">MSG_CTRUNC</span></dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
Indicates that some control data were discarded due to lack of space in the buffer for ancillary data.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">MSG_BCAST</span></dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
Indicates that the packet was received as broadcast.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">MSG_MCAST</span></dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
Indicates that the packet was received as multicast.</dd>
</dl>
</div>
<div class="section">
<h1 id="x52455455524e2056414c554553">RETURN VALUES</h1> These calls return the number of bytes received, or -1 if an error occurred.</div>
<div class="section">
<h1 id="x4552524f5253">ERRORS</h1> <b class="fname">recv</b>(), <b class="fname">recvfrom</b>(), and <b class="fname">recvmsg</b>() fail if:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">EBADF</span>]</dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
The argument <i class="farg">s</i> is an invalid descriptor.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">ENOTCONN</span>]</dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
The socket is associated with a connection-oriented protocol and has not been connected (see <a class="link-man" href="../html2/connect.html">connect(2)</a> and <a class="link-man" href="../html2/accept.html">accept(2)</a>).</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">ENOTSOCK</span>]</dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
The argument <i class="farg">s</i> does not refer to a socket.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">EAGAIN</span>]</dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
The socket is marked non-blocking, and the receive operation would block, or a receive timeout had been set, and the timeout expired before data were received.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">EINTR</span>]</dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
The receive was interrupted by delivery of a signal before any data were available.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">EFAULT</span>]</dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
The receive buffer pointer(s) point outside the process's address space.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">EHOSTUNREACH</span>]</dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
A socket operation was attempted to an unreachable host.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">EHOSTDOWN</span>]</dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
A socket operation failed because the destination host was down.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">ENETDOWN</span>]</dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
A socket operation encountered a dead network.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">ECONNREFUSED</span>]</dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
The socket is associated with a connection-oriented protocol and the connection was forcefully rejected (see <a class="link-man" href="../html2/connect.html">connect(2)</a>).</dd>
</dl>
<div class="spacer">
</div>
In addition, <b class="fname">recv</b>() and <b class="fname">recvfrom</b>() may return the following error:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">EINVAL</span>]</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
<i class="farg">len</i> was larger than <span class="define">SSIZE_MAX</span>.</dd>
</dl>
<div class="spacer">
</div>
And <b class="fname">recvmsg</b>() may return one of the following errors:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">EINVAL</span>]</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The sum of the <i class="farg">iov_len</i> values in the <i class="farg">msg_iov</i> array overflowed an <span class="emph">ssize_t</span>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">EMSGSIZE</span>]</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The <i class="farg">msg_iovlen</i> member of <i class="farg">msg</i> was less than 0 or larger than <span class="define">IOV_MAX</span>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">EMSGSIZE</span>]</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The receiving program did not have sufficient free file descriptor slots. The descriptors are closed and any pending data can be returned by another call to <b class="fname">recvmsg</b>().</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html2/connect.html">connect(2)</a>, <a class="link-man" href="../html2/fcntl.html">fcntl(2)</a>, <a class="link-man" href="../html2/getsockopt.html">getsockopt(2)</a>, <a class="link-man" href="../html2/poll.html">poll(2)</a>, <a class="link-man" href="../html2/read.html">read(2)</a>, <a class="link-man" href="../html2/select.html">select(2)</a>, <a class="link-man" href="../html2/socket.html">socket(2)</a>, <a class="link-man" href="../html2/socketpair.html">socketpair(2)</a>, <a class="link-man" href="../html3/CMSG_DATA.html">CMSG_DATA(3)</a>, <a class="link-man" href="../html3/sockatmark.html">sockatmark(3)</a></div>
<div class="section">
<h1 id="x5354414e4441524453">STANDARDS</h1> The <b class="fname">recv</b>(), <b class="fname">recvfrom</b>(), and <b class="fname">recvmsg</b>() functions conform to IEEE Std 1003.1-2008 (&#8220;POSIX.1&#8221;). The <span class="define">MSG_DONTWAIT</span>, <span class="define">MSG_BCAST</span>, and <span class="define">MSG_MCAST</span> flags are extensions to that specification.</div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="fname">recv</b>() function call appeared in <span class="unix">4.2BSD</span>.</div>
</div>
</body>
</html>

