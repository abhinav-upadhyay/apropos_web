<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
DBOPEN(3)</title>
</head>
<body>
<div class="mandoc">
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">dbopen</b> &#8212; <span class="desc">database access methods</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">sys/types.h</a>&gt;</b><br/>
<b class="includes">#include &lt;<a class="link-includes">fcntl.h</a>&gt;</b><br/>
<b class="includes">#include &lt;<a class="link-includes">limits.h</a>&gt;</b><br/>
<b class="includes">#include &lt;<a class="link-includes">db.h</a>&gt;</b><div class="spacer">
</div>
<i class="ftype">DB *</i><br/>
<b class="fname">dbopen</b>(<i class="farg" style="white-space:nowrap;">const char *file</i>, <i class="farg" style="white-space:nowrap;">int flags</i>, <i class="farg" style="white-space:nowrap;">int mode</i>, <i class="farg" style="white-space:nowrap;">DBTYPE type</i>, <i class="farg" style="white-space:nowrap;">const void *openinfo</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="fname">dbopen</b>() function is the library interface to database files. The supported file formats are btree, hashed, and UNIX file oriented. The btree format is a representation of a sorted, balanced tree structure. The hashed format is an extensible, dynamic hashing scheme. The flat-file format is a byte stream file with fixed or variable length records. The formats and file format specific information are described in detail in their respective manual pages <a class="link-man" href="../html3/btree.html">btree(3)</a>, <a class="link-man" href="../html3/hash.html">hash(3)</a>, and <a class="link-man" href="../html3/recno.html">recno(3)</a>.<div class="spacer">
</div>
<b class="fname">dbopen</b>() opens <i class="farg">file</i> for reading and/or writing. Files never intended to be preserved on disk may be created by setting the file parameter to <span class="define">NULL</span>.<div class="spacer">
</div>
The <i class="farg">flags</i> and <i class="farg">mode</i> arguments are as specified to the <a class="link-man" href="../html2/open.html">open(2)</a> routine; however, only the <span class="define">O_CREAT</span>, <span class="define">O_EXCL</span>, <span class="define">O_EXLOCK</span>, <span class="define">O_NOFOLLOW</span>, <span class="define">O_NONBLOCK</span>, <span class="define">O_RDONLY</span>, <span class="define">O_RDWR</span>, <span class="define">O_SHLOCK</span>, <span class="define">O_SYNC</span>, and <span class="define">O_TRUNC</span> flags are meaningful. (Note, opening a database file <span class="define">O_WRONLY</span> is not possible.)<div class="spacer">
</div>
The <i class="farg">type</i> argument is of type <i class="farg">DBTYPE</i> (as defined in the <b class="includes">&lt;<a class="link-includes">db.h</a>&gt;</b> include file) and may be set to <span class="define">DB_BTREE</span>, <span class="define">DB_HASH</span>, or <span class="define">DB_RECNO</span>.<div class="spacer">
</div>
The <i class="farg">openinfo</i> argument is a pointer to an access method specific structure described in the access method's manual page. If <i class="farg">openinfo</i> is <span class="define">NULL</span>, each access method will use defaults appropriate for the system and the access method.<div class="spacer">
</div>
<b class="fname">dbopen</b>() returns a pointer to a DB structure on success and <span class="define">NULL</span> on error. The DB structure is defined in the <b class="includes">&lt;<a class="link-includes">db.h</a>&gt;</b> include file, and contains at least the following fields:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
typedef struct { 
	DBTYPE type; 
	int (*close)(const DB *db); 
	int (*del)(const DB *db, const DBT *key, 
	    unsigned int flags); 
	int (*fd)(const DB *db); 
	int (*get)(const DB *db, DBT *key, DBT *data, 
	    unsigned int flags); 
	int (*put)(const DB *db, DBT *key, const DBT *data, 
	    unsigned int flags); 
	int (*sync)(const DB *db, u_int flags); 
	int (*seq)(const DB *db, DBT *key, DBT *data, 
	    unsigned int flags); 
} DB;</pre>
<div class="spacer">
</div>
These elements describe a database type and a set of functions performing various actions. These functions take a pointer to a structure as returned by <b class="fname">dbopen</b>(), and sometimes one or more pointers to key/data structures and a flag value.<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 6.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">type</i></dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
The type of the underlying access method (and file format).</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">close</i></dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
A pointer to a routine to flush any cached information to disk, free any allocated resources, and close the underlying file(s). Since key/data pairs may be cached in memory, failing to sync the file with a <i class="farg">close</i> or <i class="farg">sync</i> function may result in inconsistent or lost information. <i class="farg">close</i> routines return -1 on error (setting <b class="var">errno</b>) and 0 on success.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">del</i></dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
A pointer to a routine to remove key/data pairs from the database.<div class="spacer">
</div>
The parameter <i class="farg">flags</i> may be set to the following value:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">R_CURSOR</span></dt>
<dd class="list-tag" style="margin-left: 13.00ex;">
Delete the record referenced by the cursor. The cursor must have previously been initialized.</dd>
</dl>
<div class="spacer">
</div>
<i class="farg">del</i> routines return -1 on error (setting <b class="var">errno</b>), 0 on success, and 1 if the specified <i class="farg">key</i> was not in the file.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">fd</i></dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
A pointer to a routine which returns a file descriptor representative of the underlying database. A file descriptor referencing the same file will be returned to all processes which call <b class="fname">dbopen</b>() with the same <i class="farg">file</i> name. This file descriptor may be safely used as an argument to the <a class="link-man" href="../html2/fcntl.html">fcntl(2)</a> and <a class="link-man" href="../html2/flock.html">flock(2)</a> locking functions. The file descriptor is not necessarily associated with any of the underlying files used by the access method. No file descriptor is available for in-memory databases. <i class="farg">fd</i> routines return -1 on error (setting <b class="var">errno</b>) and the file descriptor on success.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">get</i></dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
A pointer to a routine which is the interface for keyed retrieval from the database. The address and length of the data associated with the specified <i class="farg">key</i> are returned in the structure referenced by <i class="farg">data</i>. <i class="farg">get</i> routines return -1 on error (setting <b class="var">errno</b>), 0 on success, and 1 if the <i class="farg">key</i> was not in the file.<div class="spacer">
</div>
<i class="farg">flags</i> is currently unused. Specifying anything but 0 will result in an error.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">put</i></dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
A pointer to a routine to store key/data pairs in the database.<div class="spacer">
</div>
The parameter <i class="farg">flags</i> may be set to one of the following values:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">R_CURSOR</span></dt>
<dd class="list-tag" style="margin-left: 13.00ex;">
Replace the key/data pair referenced by the cursor. The cursor must have previously been initialized.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">R_IAFTER</span></dt>
<dd class="list-tag" style="margin-left: 13.00ex;">
Append the data immediately after the data referenced by <i class="farg">key</i>, creating a new key/data pair. The record number of the appended key/data pair is returned in the <i class="farg">key</i> structure. (Applicable only to the <span class="define">DB_RECNO</span> access method.)</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">R_IBEFORE</span></dt>
<dd class="list-tag" style="margin-left: 13.00ex;">
Insert the data immediately before the data referenced by <i class="farg">key</i>, creating a new key/data pair. The record number of the inserted key/data pair is returned in the <i class="farg">key</i> structure. (Applicable only to the <span class="define">DB_RECNO</span> access method.)</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">R_NOOVERWRITE</span></dt>
<dd class="list-tag" style="margin-left: 13.00ex;">
Enter the new key/data pair only if the key does not previously exist.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">R_SETCURSOR</span></dt>
<dd class="list-tag" style="margin-left: 13.00ex;">
Store the key/data pair, setting or initializing the position of the cursor to reference it. (Applicable only to the <span class="define">DB_BTREE</span> and <span class="define">DB_RECNO</span> access methods.)</dd>
</dl>
<div class="spacer">
</div>
<span class="define">R_SETCURSOR</span> is available only for the <span class="define">DB_BTREE</span> and <span class="define">DB_RECNO</span> access methods because it implies that the keys have an inherent order which does not change.<div class="spacer">
</div>
<span class="define">R_IAFTER</span> and <span class="define">R_IBEFORE</span> are available only for the <span class="define">DB_RECNO</span> access method because they each imply that the access method is able to create new keys. This is only true if the keys are ordered and independent, record numbers for example.<div class="spacer">
</div>
The default behavior of the <i class="farg">put</i> routines is to enter the new key/data pair, replacing any previously existing key.<div class="spacer">
</div>
<i class="farg">put</i> routines return -1 on error (setting <b class="var">errno</b>), 0 on success, and 1 if the <span class="define">R_NOOVERWRITE</span> flag was set and the key already exists in the file.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">seq</i></dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
A pointer to a routine which is the interface for sequential retrieval from the database. The address and length of the key are returned in the structure referenced by <i class="farg">key</i>, and the address and length of the data are returned in the structure referenced by <i class="farg">data</i>.<div class="spacer">
</div>
Sequential key/data pair retrieval may begin at any time, and the position of the &#8220;cursor&#8221; is not affected by calls to the <i class="farg">del</i>, <i class="farg">get</i>, <i class="farg">put</i>, or <i class="farg">sync</i> routines. Modifications to the database during a sequential scan will be reflected in the scan, i.e., records inserted behind the cursor will not be returned while records inserted in front of the cursor will be returned.<div class="spacer">
</div>
The <i class="farg">flags</i> value <span class="symb">must</span> be set to one of the following values:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">R_CURSOR</span></dt>
<dd class="list-tag" style="margin-left: 13.00ex;">
The data associated with the specified key is returned. This differs from the <i class="farg">get</i> routines in that it sets or initializes the cursor to the location of the key as well. (Note, for the <span class="define">DB_BTREE</span> access method, the returned key is not necessarily an exact match for the specified key. The returned key is the smallest key greater than or equal to the specified key, permitting partial key matches and range searches.)</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">R_FIRST</span></dt>
<dd class="list-tag" style="margin-left: 13.00ex;">
The first key/data pair of the database is returned, and the cursor is set or initialized to reference it.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">R_LAST</span></dt>
<dd class="list-tag" style="margin-left: 13.00ex;">
The last key/data pair of the database is returned, and the cursor is set or initialized to reference it. (Applicable only to the <span class="define">DB_BTREE</span> and <span class="define">DB_RECNO</span> access methods.)</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">R_NEXT</span></dt>
<dd class="list-tag" style="margin-left: 13.00ex;">
Retrieve the key/data pair immediately after the cursor. If the cursor is not yet set, this is the same as the <span class="define">R_FIRST</span> flag.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">R_PREV</span></dt>
<dd class="list-tag" style="margin-left: 13.00ex;">
Retrieve the key/data pair immediately before the cursor. If the cursor is not yet set, this is the same as the <span class="define">R_LAST</span> flag. (Applicable only to the <span class="define">DB_BTREE</span> and <span class="define">DB_RECNO</span> access methods.)</dd>
</dl>
<div class="spacer">
</div>
<span class="define">R_LAST</span> and <span class="define">R_PREV</span> are available only for the <span class="define">DB_BTREE</span> and <span class="define">DB_RECNO</span> access methods because they each imply that the keys have an inherent order which does not change.<div class="spacer">
</div>
<i class="farg">seq</i> routines return -1 on error (setting <b class="var">errno</b>), 0 on success, and 1 if there are no key/data pairs less than or greater than the specified or current key. If the <span class="define">DB_RECNO</span> access method is being used, and if the database file is a character special file and no complete key/data pairs are currently available, the <i class="farg">seq</i> routines return 2.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">sync</i></dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
A pointer to a routine to flush any cached information to disk. If the database is in memory only, the <i class="farg">sync</i> routine has no effect and will always succeed.<div class="spacer">
</div>
The <i class="farg">flags</i> value may be set to the following value:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">R_RECNOSYNC</span></dt>
<dd class="list-tag" style="margin-left: 13.00ex;">
If the <span class="define">DB_RECNO</span> access method is being used, this flag causes the <i class="farg">sync</i> routine to apply to the btree file which underlies the recno file, not the recno file itself. (See the <i class="farg">bfname</i> field of the <a class="link-man" href="../html3/recno.html">recno(3)</a> manual page for more information.)</dd>
</dl>
<div class="spacer">
</div>
<i class="farg">sync</i> routines return -1 on error (setting <b class="var">errno</b>) and 0 on success.</dd>
</dl>
</div>
<div class="section">
<h1 id="x4b45592f44415441205041495253">KEY/DATA PAIRS</h1> Access to all file types is based on key/data pairs. Both keys and data are represented by the following data structure:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
typedef struct { 
	void *data; 
	size_t size; 
} DBT;</pre>
<div class="spacer">
</div>
The elements of the DBT structure are defined as follows:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 6.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">data</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
A pointer to a byte string.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">size</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The length of the byte string.</dd>
</dl>
<div class="spacer">
</div>
Key and data byte strings may reference strings of essentially unlimited length although any two of them must fit into available memory at the same time. It should be noted that the access methods provide no guarantees about byte string alignment.</div>
<div class="section">
<h1 id="x4552524f5253">ERRORS</h1> The <b class="fname">dbopen</b>() routine may fail and set <b class="var">errno</b> for any of the errors specified for the library routines <a class="link-man" href="../html2/open.html">open(2)</a> and <a class="link-man" href="../html3/malloc.html">malloc(3)</a> or the following:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">EFTYPE</span>]</dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
A file is incorrectly formatted.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">EINVAL</span>]</dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
A parameter has been specified (hash function, pad byte etc.) that is incompatible with the current file specification or which is not meaningful for the function (for example, use of the cursor without prior initialization) or there is a mismatch between the version number of the file and the software.</dd>
</dl>
<div class="spacer">
</div>
The <i class="farg">close</i> routines may fail and set <b class="var">errno</b> for any of the errors specified for the library routines <a class="link-man" href="../html2/close.html">close(2)</a>, <a class="link-man" href="../html2/read.html">read(2)</a>, <a class="link-man" href="../html2/write.html">write(2)</a>, <a class="link-man" href="../html3/free.html">free(3)</a>, or <a class="link-man" href="../html2/fsync.html">fsync(2)</a>.<div class="spacer">
</div>
The <i class="farg">del</i>, <i class="farg">get</i>, <i class="farg">put</i>, and <i class="farg">seq</i> routines may fail and set <b class="var">errno</b> for any of the errors specified for the library routines <a class="link-man" href="../html2/read.html">read(2)</a>, <a class="link-man" href="../html2/write.html">write(2)</a>, <a class="link-man" href="../html3/free.html">free(3)</a>, or <a class="link-man" href="../html3/malloc.html">malloc(3)</a>.<div class="spacer">
</div>
The <i class="farg">fd</i> routines will fail and set <b class="var">errno</b> to <span class="errno">ENOENT</span> for in-memory databases.<div class="spacer">
</div>
The <i class="farg">sync</i> routines may fail and set <b class="var">errno</b> for any of the errors specified for the library routine <a class="link-man" href="../html2/fsync.html">fsync(2)</a>.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html3/btree.html">btree(3)</a>, <a class="link-man" href="../html3/hash.html">hash(3)</a>, <a class="link-man" href="../html3/recno.html">recno(3)</a><div class="spacer">
</div>
<span class="ref"><span class="ref-auth">Margo Seltzer</span> and <span class="ref-auth">Michael Olson</span>, <span class="ref-title">LIBTP: Portable, Modular Transactions for UNIX</span>, <i class="ref-jrnl">USENIX proceedings</i>, <span class="ref-date">Winter 1992</span>.</span></div>
<div class="section">
<h1 id="x42554753">BUGS</h1> The typedef DBT is a mnemonic for &#8220;data base thang&#8221;, and was used because no one could think of a reasonable name that wasn't already used.<div class="spacer">
</div>
The file descriptor interface is a kludge and will be deleted in a future version of the interface.<div class="spacer">
</div>
None of the access methods provide any form of concurrent access, locking, or transactions.</div>
</div>
</body>
</html>

