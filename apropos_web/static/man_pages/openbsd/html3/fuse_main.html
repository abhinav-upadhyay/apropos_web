<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
FUSE_MAIN(3)</title>
</head>
<body>
<div class="mandoc">
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">fuse_main</b>, <b class="name">fuse_version</b>, <b class="name">fuse_new</b>, <b class="name">fuse_parse_cmdline</b>, <b class="name">fuse_mount</b>, <b class="name">fuse_remove_signal_handlers</b>, <b class="name">fuse_set_signal_handlers</b>, <b class="name">fuse_get_session</b>, <b class="name">fuse_get_context</b>, <b class="name">fuse_is_lib_option</b>, <b class="name">fuse_loop</b>, <b class="name">fuse_loop_mt</b>, <b class="name">fuse_chan_fd</b>, <b class="name">fuse_unmount</b>, <b class="name">fuse_daemonize</b>, <b class="name">fuse_destroy</b>, <b class="name">fuse_teardown</b> &#8212; <span class="desc">FUSE implementation routines</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">fuse.h</a>&gt;</b><div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">fuse_main</b>(<i class="farg" style="white-space:nowrap;">int argc</i>, <i class="farg" style="white-space:nowrap;">char **argv</i>, <i class="farg" style="white-space:nowrap;">const struct fuse_operations *ops</i>, <i class="farg" style="white-space:nowrap;">void *data</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">fuse_version</b>(<i class="farg" style="white-space:nowrap;">void</i>);<div class="spacer">
</div>
<i class="ftype">struct fuse *</i><br/>
<b class="fname">fuse_new</b>(<i class="farg" style="white-space:nowrap;">struct fuse_chan *fc</i>, <i class="farg" style="white-space:nowrap;">struct fuse_args *args</i>, <i class="farg" style="white-space:nowrap;">const struct fuse_operations *ops</i>, <i class="farg" style="white-space:nowrap;">size_t size</i>, <i class="farg" style="white-space:nowrap;">void *userdata</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">fuse_parse_cmdline</b>(<i class="farg" style="white-space:nowrap;">struct fuse_args *args</i>, <i class="farg" style="white-space:nowrap;">char **mp</i>, <i class="farg" style="white-space:nowrap;">int *mt</i>, <i class="farg" style="white-space:nowrap;">int *fg</i>);<div class="spacer">
</div>
<i class="ftype">struct fuse_chan *</i><br/>
<b class="fname">fuse_mount</b>(<i class="farg" style="white-space:nowrap;">const char *dir</i>, <i class="farg" style="white-space:nowrap;">struct fuse_args *args</i>);<div class="spacer">
</div>
<i class="ftype">void</i><br/>
<b class="fname">fuse_remove_signal_handlers</b>(<i class="farg" style="white-space:nowrap;">struct fuse_session *se</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">fuse_set_signal_handlers</b>(<i class="farg" style="white-space:nowrap;">struct fuse_session *se</i>);<div class="spacer">
</div>
<i class="ftype">struct fuse_session *</i><br/>
<b class="fname">fuse_get_session</b>(<i class="farg" style="white-space:nowrap;">struct fuse *f</i>);<div class="spacer">
</div>
<i class="ftype">struct fuse_context *</i><br/>
<b class="fname">fuse_get_context</b>(<i class="farg" style="white-space:nowrap;">void</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">fuse_is_lib_option</b>(<i class="farg" style="white-space:nowrap;">const char *opt</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">fuse_loop</b>(<i class="farg" style="white-space:nowrap;">struct fuse *fuse</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">fuse_loop_mt</b>(<i class="farg" style="white-space:nowrap;">struct fuse *fuse</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">fuse_chan_fd</b>(<i class="farg" style="white-space:nowrap;">struct fuse_chan *ch</i>);<div class="spacer">
</div>
<i class="ftype">void</i><br/>
<b class="fname">fuse_unmount</b>(<i class="farg" style="white-space:nowrap;">const char *dir</i>, <i class="farg" style="white-space:nowrap;">struct fuse_chan *ch</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">fuse_daemonize</b>(<i class="farg" style="white-space:nowrap;">int foreground</i>);<div class="spacer">
</div>
<i class="ftype">void</i><br/>
<b class="fname">fuse_destroy</b>(<i class="farg" style="white-space:nowrap;">struct fuse *f</i>);<div class="spacer">
</div>
<i class="ftype">void</i><br/>
<b class="fname">fuse_teardown</b>(<i class="farg" style="white-space:nowrap;">struct fuse *f</i>, <i class="farg" style="white-space:nowrap;">char *mp</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The FUSE library provides routines to implement a filesystem in userspace.<div class="spacer">
</div>
There are two ways of implementing a FUSE filesystem: by calling only <b class="fname">fuse_main</b>() and passing this function the <span class="emph">ops</span> argument containing all the callbacks of the filesystem, or by using the other functions, as detailed below.<div class="spacer">
</div>
<b class="fname">fuse_version</b>() returns the FUSE version number.<div class="spacer">
</div>
<b class="fname">fuse_new</b>() returns a <i class="farg">struct fuse</i> that will be needed by <b class="fname">fuse_loop</b>().<div class="spacer">
</div>
<b class="fname">fuse_parse_cmdline</b>() parses the <i class="farg">struct fuse_args</i> given by the user and will set <i class="farg">mp</i> with a char * containing the mountpoint directory.<div class="spacer">
</div>
<b class="fname">fuse_mount</b>() looks for an empty <a class="link-man" href="../html4/fuse.html">fuse(4)</a> device to create a connection. If this function finds an available device it will open it for FUSE communication with the FUSE VFS driver and will mount the filesystem. This function will return a <i class="farg">struct fuse_chan</i> that will be needed by <b class="fname">fuse_new</b>().<div class="spacer">
</div>
<b class="fname">fuse_remove_signal_handlers</b>() is currently undocumented.<div class="spacer">
</div>
<b class="fname">fuse_set_signal_handlers</b>() is currently undocumented.<div class="spacer">
</div>
<b class="fname">fuse_get_session</b>() returns a pointer to the structure <i class="farg">fuse_session</i> contained in a <i class="farg">struct fuse</i>.<div class="spacer">
</div>
<b class="fname">fuse_get_context</b>() returns a pointer to the structure <i class="farg">fuse_context</i>. The returned fuse_context is only available during the lifetime of a FUSE operation.<div class="spacer">
</div>
<b class="fname">fuse_is_lib_option</b>() checks if the string <i class="farg">opt</i> is an option handled by libfuse or by the FUSE client. It returns 1 if it is handled by the lib and 0 otherwise.<div class="spacer">
</div>
<b class="fname">fuse_loop_mt</b>() is unsupported.<div class="spacer">
</div>
<b class="fname">fuse_loop</b>() is the main loop of a FUSE program. This function looks for FUSE requests from the kernel and responds to them using the <i class="farg">struct fuse_operation</i> present in the structure <i class="farg">fuse</i>. It will return only if something goes wrong or if the kernel sends a <i class="farg">FUSE_DESTROY</i> opcode to libfuse.<div class="spacer">
</div>
<b class="fname">fuse_chan_fd</b>() returns the filedescriptor used by the given <i class="farg">fuse_chan</i> structure.<div class="spacer">
</div>
<b class="fname">fuse_unmount</b>() unmounts the <i class="farg">dir</i> mountpoint.<div class="spacer">
</div>
<b class="fname">fuse_daemonize</b>() daemonises the FUSE library. It runs the FUSE program in the background, whilst continuing to handle kernel filesystem opcodes.<div class="spacer">
</div>
<b class="fname">fuse_destroy</b>() is currently undocumented.<div class="spacer">
</div>
<b class="fname">fuse_teardown</b>() calls <b class="fname">fuse_unmount</b>() and <b class="fname">fuse_destroy</b>().</div>
<div class="section">
<h1 id="x4558414d504c4553">EXAMPLES</h1> Here is a simple example of a FUSE implementation:<div class="spacer">
</div>
<pre style="margin-left: 0.00ex;" class="lit display">
#include &lt;errno.h&gt; 
#include &lt;fuse.h&gt; 
#include &lt;string.h&gt; 
 
static int 
fs_readdir(const char *path, void *data, fuse_fill_dir_t filler, 
    off_t off, struct fuse_file_info *ffi) 
{ 
	if (strcmp(path, &quot;/&quot;) != 0) 
		return (-ENOENT); 
 
	filler(data, &quot;.&quot;, NULL, 0); 
	filler(data, &quot;..&quot;, NULL, 0); 
	filler(data, &quot;file&quot;, NULL, 0); 
	return (0); 
} 
 
static int 
fs_read(const char *path, char *buf, size_t size, off_t off, 
    struct fuse_file_info *ffi) 
{ 
	if (off &gt;= 5) 
		return (0); 
 
	size = 5 - off; 
	memcpy(buf, &quot;data.&quot; + off, size); 
	return (size); 
} 
 
static int 
fs_open(const char *path, struct fuse_file_info *ffi) 
{ 
	if (strncmp(path, &quot;/file&quot;, 10) != 0) 
		return (-ENOENT); 
 
	if ((ffi-&gt;flags &amp; 3) != O_RDONLY) 
		return (-EACCES); 
 
	return (0); 
} 
 
static int 
fs_getattr(const char *path, struct stat *st) 
{ 
	if (strcmp(path, &quot;/&quot;) == 0) { 
		st-&gt;st_blksize = 512; 
		st-&gt;st_mode = 0755; 
		st-&gt;st_nlink = 2; 
	} else if (strcmp(path, &quot;/file&quot;) == 0) { 
		st-&gt;st_mode = 0644; 
		st-&gt;st_blksize = 512; 
		st-&gt;st_nlink = 1; 
		st-&gt;st_size = 5; 
	} else { 
		return (-ENOENT); 
	} 
 
	return (0); 
} 
 
struct fuse_operations fsops = { 
	.readdir = fs_readdir, 
	.read = fs_read, 
	.open = fs_open, 
	.getattr = fs_getattr, 
}; 
 
int 
main(int ac, char **av) 
{ 
	return (fuse_main(ac, av, &amp;fsops, NULL)); 
}</pre>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html4/fuse.html">fuse(4)</a></div>
<div class="section">
<h1 id="x5354414e4441524453">STANDARDS</h1> The original FUSE specification can be found at <a class="link-ext" href="http://libfuse.github.io/doxygen/">http://libfuse.github.io/doxygen/</a>. The original implementation can be found at <a class="link-ext" href="https://github.com/libfuse/libfuse/">https://github.com/libfuse/libfuse/</a>.</div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The FUSE library first appeared in <span class="unix">OpenBSD&#160;5.4</span>.</div>
<div class="section">
<h1 id="x42554753">BUGS</h1> This man page is woefully incomplete.</div>
</div>
</body>
</html>

