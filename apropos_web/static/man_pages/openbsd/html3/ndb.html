<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
DBM_OPEN(3)</title>
</head>
<body>
<div class="mandoc">
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">dbm_clearerr</b>, <b class="name">dbm_close</b>, <b class="name">dbm_delete</b>, <b class="name">dbm_dirfno</b>, <b class="name">dbm_error</b>, <b class="name">dbm_fetch</b>, <b class="name">dbm_firstkey</b>, <b class="name">dbm_nextkey</b>, <b class="name">dbm_open</b>, <b class="name">dbm_pagfno</b>, <b class="name">dbm_rdonly</b>, <b class="name">dbm_store</b> &#8212; <span class="desc">database access methods</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">ndbm.h</a>&gt;</b><div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">dbm_clearerr</b>(<i class="farg" style="white-space:nowrap;">DBM *db</i>);<div class="spacer">
</div>
<i class="ftype">void</i><br/>
<b class="fname">dbm_close</b>(<i class="farg" style="white-space:nowrap;">DBM *db</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">dbm_delete</b>(<i class="farg" style="white-space:nowrap;">DBM *db</i>, <i class="farg" style="white-space:nowrap;">datum key</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">dbm_dirfno</b>(<i class="farg" style="white-space:nowrap;">DBM *db</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">dbm_error</b>(<i class="farg" style="white-space:nowrap;">DBM *db</i>);<div class="spacer">
</div>
<i class="ftype">datum</i><br/>
<b class="fname">dbm_fetch</b>(<i class="farg" style="white-space:nowrap;">DBM *db</i>, <i class="farg" style="white-space:nowrap;">datum key</i>);<div class="spacer">
</div>
<i class="ftype">datum</i><br/>
<b class="fname">dbm_firstkey</b>(<i class="farg" style="white-space:nowrap;">DBM *db</i>);<div class="spacer">
</div>
<i class="ftype">datum</i><br/>
<b class="fname">dbm_nextkey</b>(<i class="farg" style="white-space:nowrap;">DBM *db</i>);<div class="spacer">
</div>
<i class="ftype">DBM *</i><br/>
<b class="fname">dbm_open</b>(<i class="farg" style="white-space:nowrap;">const char *file</i>, <i class="farg" style="white-space:nowrap;">int flags</i>, <i class="farg" style="white-space:nowrap;">mode_t mode</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">dbm_pagfno</b>(<i class="farg" style="white-space:nowrap;">DBM *db</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">dbm_rdonly</b>(<i class="farg" style="white-space:nowrap;">DBM *db</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">dbm_store</b>(<i class="farg" style="white-space:nowrap;">DBM *db</i>, <i class="farg" style="white-space:nowrap;">datum key</i>, <i class="farg" style="white-space:nowrap;">datum content</i>, <i class="farg" style="white-space:nowrap;">int store_mode</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> These functions provide a ndbm-compatible interface to the database access methods described in <a class="link-man" href="../html3/dbopen.html">dbopen(3)</a>. Each unique record in the database is a key/content pair, the components of which may be any arbitrary binary data. The key and the content data are described by the <i class="ftype">datum</i> data structure:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
typedef struct { 
	void *dptr; 
	size_t dsize; 
} datum;</pre>
<div class="spacer">
</div>
The <b class="fname">dbm_open</b>() function is used to open a database in the file named by <i class="farg">file</i>, suffixed with <span class="define">DBM_SUFFIX</span> (&#8216;<i class="file">.db</i>&#8217;). If necessary, the file is created with mode <i class="arg">mode</i>. Access to this file depends on the <i class="farg">flags</i> parameter (see <a class="link-man" href="../html2/open.html">open(2)</a>). Read-only access may be indicated by specifying <span class="define">DBM_RDONLY</span>. The <b class="fname">dbm_rdonly</b>() function may be used to determine if a database is opened for read-only access.<div class="spacer">
</div>
Once the database is open, <b class="fname">dbm_fetch</b>() is used to retrieve the data content associated with the key <i class="farg">key</i>. Similarly, <b class="fname">dbm_store</b>() is used to store the <i class="farg">content</i> data with the key <i class="farg">key</i>. When storing, the <i class="farg">store_mode</i> parameter must be one of:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 6.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">DBM_INSERT</span></dt>
<dd class="list-tag" style="margin-left: 11.00ex;">
Only insert new keys into the database. Existing key/content pairs are untouched.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">DBM_REPLACE</span></dt>
<dd class="list-tag" style="margin-left: 11.00ex;">
Replace any existing entry with the same key. Any previously stored records with the same key are lost.</dd>
</dl>
<div class="spacer">
</div>
The <b class="fname">dbm_delete</b>() function removes the key <i class="farg">key</i> and its associated content from the database.<div class="spacer">
</div>
The functions <b class="fname">dbm_firstkey</b>() and <b class="fname">dbm_nextkey</b>() are used to iterate over all of the records in the database. Each record will be reached exactly once, but in no particular order. The <b class="fname">dbm_firstkey</b>() function returns the first record of the database, and thereafter <b class="fname">dbm_nextkey</b>() returns the following records. The following code traverses the entire database:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
for (key = dbm_firstkey(db); key.dptr != NULL; 
    key = dbm_nextkey(db))</pre>
<div class="spacer">
</div>
The behaviour of <b class="fname">dbm_nextkey</b>() is undefined if the database is modified after a call to <b class="fname">dbm_firstkey</b>().<div class="spacer">
</div>
The <b class="fname">dbm_error</b>() function returns the last error condition of the database, or 0 if no error had occurred or had been cleared. The <b class="fname">dbm_clearerr</b>() function clears the error condition of the database.<div class="spacer">
</div>
The <b class="fname">dbm_dirfno</b>() function is used to find the file descriptor associated with the directory file of an open database. Since a directory bitmap file is not used in this implementation, this function returns the file descriptor of the database file opened with <b class="fname">dbm_open</b>().<div class="spacer">
</div>
The <b class="fname">dbm_pagfno</b>() function is used to find the file descriptor associated with the page file of an open database. Since a page file is not used in this implementation, this function is implemented as a macro that always returns the (undefined) value <span class="define">DBM_PAGFNO_NOT_AVAILABLE</span>.<div class="spacer">
</div>
The database is closed with the <b class="fname">dbm_close</b>() function. Thereafter, the <i class="farg">db</i> handle is invalid.<div class="subsection">
<h2 id="x496d706c656d656e746174696f6e206e6f746573">Implementation notes</h2> The underlying database is a <a class="link-man" href="../html3/hash.html">hash(3)</a> database with a bucket size of 4096, a filling factor of 40, default hashing function and cache size, and uses the host's native byte order.</div>
</div>
<div class="section">
<h1 id="x52455455524e2056414c554553">RETURN VALUES</h1> Upon successful completion, all functions that return <i class="ftype">int</i> return a value of 0, otherwise a negative value is returned.<div class="spacer">
</div>
Routines that return a <i class="ftype">datum</i> indicate errors by setting the <b class="var">dptr</b> field to <span class="define">NULL</span>.<div class="spacer">
</div>
The <b class="fname">dbm_open</b>() function returns <span class="define">NULL</span> on error, and sets <b class="var">errno</b> appropriately. On success, it returns a handle to the database that should be used as the <i class="farg">db</i> argument in the other functions.<div class="spacer">
</div>
The <b class="fname">dbm_store</b>() function returns 1 when it is called with a <i class="farg">flags</i> value of <span class="define">DBM_INSERT</span> and a record with the specified key already exists.</div>
<div class="section">
<h1 id="x4552524f5253">ERRORS</h1> If an error occurs, the error can be retrieved with <b class="fname">dbm_error</b>() and corresponds to those errors described in <a class="link-man" href="../html3/dbopen.html">dbopen(3)</a>.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html2/open.html">open(2)</a>, <a class="link-man" href="../html3/dbopen.html">dbopen(3)</a>, <a class="link-man" href="../html3/hash.html">hash(3)</a></div>
</div>
</body>
</html>

