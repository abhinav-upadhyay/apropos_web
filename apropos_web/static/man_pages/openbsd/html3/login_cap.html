<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
LOGIN_GETCLASS(3)</title>
</head>
<body>
<div class="mandoc">
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">login_getclass</b>, <b class="name">login_getstyle</b>, <b class="name">login_getcapbool</b>, <b class="name">login_getcapnum</b>, <b class="name">login_getcapsize</b>, <b class="name">login_getcapstr</b>, <b class="name">login_getcaptime</b>, <b class="name">login_close</b>, <b class="name">secure_path</b>, <b class="name">setclasscontext</b>, <b class="name">setusercontext</b> &#8212; <span class="desc">query login.conf database about a user class</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">sys/types.h</a>&gt;</b><br/>
<b class="includes">#include &lt;<a class="link-includes">login_cap.h</a>&gt;</b><div class="spacer">
</div>
<i class="ftype">login_cap_t *</i><br/>
<b class="fname">login_getclass</b>(<i class="farg" style="white-space:nowrap;">char *class</i>);<div class="spacer">
</div>
<i class="ftype">char *</i><br/>
<b class="fname">login_getstyle</b>(<i class="farg" style="white-space:nowrap;">login_cap_t *lc</i>, <i class="farg" style="white-space:nowrap;">char *style</i>, <i class="farg" style="white-space:nowrap;">char *type</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">login_getcapbool</b>(<i class="farg" style="white-space:nowrap;">login_cap_t *lc</i>, <i class="farg" style="white-space:nowrap;">char *cap</i>, <i class="farg" style="white-space:nowrap;">unsigned int def</i>);<div class="spacer">
</div>
<i class="ftype">quad_t</i><br/>
<b class="fname">login_getcapnum</b>(<i class="farg" style="white-space:nowrap;">login_cap_t *lc</i>, <i class="farg" style="white-space:nowrap;">char *cap</i>, <i class="farg" style="white-space:nowrap;">quad_t def</i>, <i class="farg" style="white-space:nowrap;">quad_t err</i>);<div class="spacer">
</div>
<i class="ftype">quad_t</i><br/>
<b class="fname">login_getcapsize</b>(<i class="farg" style="white-space:nowrap;">login_cap_t *lc</i>, <i class="farg" style="white-space:nowrap;">char *cap</i>, <i class="farg" style="white-space:nowrap;">quad_t def</i>, <i class="farg" style="white-space:nowrap;">quad_t err</i>);<div class="spacer">
</div>
<i class="ftype">char *</i><br/>
<b class="fname">login_getcapstr</b>(<i class="farg" style="white-space:nowrap;">login_cap_t *lc</i>, <i class="farg" style="white-space:nowrap;">char *cap</i>, <i class="farg" style="white-space:nowrap;">char *def</i>, <i class="farg" style="white-space:nowrap;">char *err</i>);<div class="spacer">
</div>
<i class="ftype">quad_t</i><br/>
<b class="fname">login_getcaptime</b>(<i class="farg" style="white-space:nowrap;">login_cap_t *lc</i>, <i class="farg" style="white-space:nowrap;">char *cap</i>, <i class="farg" style="white-space:nowrap;">quad_t def</i>, <i class="farg" style="white-space:nowrap;">quad_t err</i>);<div class="spacer">
</div>
<i class="ftype">void</i><br/>
<b class="fname">login_close</b>(<i class="farg" style="white-space:nowrap;">login_cap_t *lc</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">secure_path</b>(<i class="farg" style="white-space:nowrap;">char *path</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">setclasscontext</b>(<i class="farg" style="white-space:nowrap;">char *class</i>, <i class="farg" style="white-space:nowrap;">unsigned int flags</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">setusercontext</b>(<i class="farg" style="white-space:nowrap;">login_cap_t *lc</i>, <i class="farg" style="white-space:nowrap;">struct passwd *pwd</i>, <i class="farg" style="white-space:nowrap;">uid_t uid</i>, <i class="farg" style="white-space:nowrap;">unsigned int flags</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="fname">login_getclass</b>() function extracts the entry specified by <i class="arg">class</i> (or <code class="lit">default</code> if <i class="arg">class</i> is <span class="define">NULL</span> or the empty string) from <i class="file">/etc/login.conf</i> (see <a class="link-man" href="../html5/login.conf.html">login.conf(5)</a>). If the entry is found, a <code class="lit">login_cap_t</code> pointer is returned. <span class="define">NULL</span> is returned if the user class is not found. When the <code class="lit">login_cap_t</code> structure is no longer needed, it should be freed by the <b class="fname">login_close</b>() function.<div class="spacer">
</div>
Once <i class="arg">lc</i> has been returned by <b class="fname">login_getclass</b>(), any of the other <b class="fname">login_*</b>() functions may be called. The <b class="fname">login_getstyle</b>() function is used to obtain the style of authentication that should be used for this user class. The <i class="arg">style</i> argument may either be <span class="define">NULL</span> or the desired style of authentication. If <span class="define">NULL</span>, the first available authentication style will be used. The <i class="arg">type</i> argument refers to the type of authentication being performed. This is used to override the standard <code class="lit">auth</code> entry in the database. By convention this should be of the form &quot;auth-type&quot;. Future releases may remove the requirement for the &quot;auth-&quot; prefix and add it if it is missing. If <i class="arg">type</i> is <span class="define">NULL</span> then only &quot;auth&quot; will be looked at (see <a class="link-man" href="../html5/login.conf.html">login.conf(5)</a>). The <b class="fname">login_getstyle</b>() function will return <span class="define">NULL</span> if the desired style of authentication is not available, or if no style is available.<div class="spacer">
</div>
The <b class="fname">login_getcapnum</b>(), <b class="fname">login_getcapsize</b>(), <b class="fname">login_getcapstr</b>(), and <b class="fname">login_getcaptime</b>() functions all query the database entry for a field named <i class="arg">cap</i>. If the field is found, its value is returned. If the field is not found, the value specified by <i class="arg">def</i> is returned. If an error is encountered while trying to find the field, <i class="arg">err</i> is returned. See <a class="link-man" href="../html5/login.conf.html">login.conf(5)</a> for a discussion of the various textual forms the value may take. The <b class="fname">login_getcapbool</b>() function is slightly different. It returns <i class="arg">def</i> if no capabilities were found for this class (typically meaning that the default class was used and the <i class="file">/etc/login.conf</i> file is missing). It returns a non-zero value if <i class="arg">cap</i>, with no value, was found, zero otherwise.<div class="spacer">
</div>
The <b class="fname">secure_path</b>() function takes a path name and returns 0 if the path name is secure, -1 if not. To be secure a path must exist, be a regular file (and not a directory), owned by root, and only writable by the owner (root).<div class="spacer">
</div>
The <b class="fname">setclasscontext</b>() function takes <i class="arg">class</i>, the name of a user class, and sets the resources defined by that class according to <i class="arg">flags</i>. Only the <span class="define">LOGIN_SETPATH</span>, <span class="define">LOGIN_SETPRIORITY</span>, <span class="define">LOGIN_SETRESOURCES</span>, and <span class="define">LOGIN_SETUMASK</span> bits are used (see <b class="fname">setusercontext</b>() below). It returns 0 on success and -1 on failure.<div class="spacer">
</div>
The <b class="fname">setusercontext</b>() function sets the resources according to <i class="arg">flags</i>. The <i class="arg">lc</i> argument, if not <span class="define">NULL</span>, contains the class information that should be used. The <i class="arg">pwd</i> argument, if not <span class="define">NULL</span>, provides information about the user. Both <i class="arg">lc</i> and <i class="arg">pwd</i> cannot be <span class="define">NULL</span>. The <i class="arg">uid</i> argument is used in place of the user ID contained in the <i class="arg">pwd</i> structure when calling <a class="link-man" href="../html2/setuid.html">setuid(2)</a>. The <b class="fname">setusercontext</b>() function returns 0 on success and -1 on failure. The various bits available to be or-ed together to make up <i class="arg">flags</i> are:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">LOGIN_SETENV</span></dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
Sets environment variables specified by the setenv keyword.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">LOGIN_SETGROUP</span></dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
Set the group ID and call <a class="link-man" href="../html3/initgroups.html">initgroups(3)</a>. Requires the <i class="arg">pwd</i> field be specified.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">LOGIN_SETLOGIN</span></dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
Sets the login name by <a class="link-man" href="../html2/setlogin.html">setlogin(2)</a>. Requires the <i class="arg">pwd</i> field be specified.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">LOGIN_SETPATH</span></dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
Sets the <span class="env">PATH</span> environment variable.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">LOGIN_SETPRIORITY</span></dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
Sets the priority by <a class="link-man" href="../html2/setpriority.html">setpriority(2)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">LOGIN_SETRESOURCES</span></dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
Sets the various system resources by <a class="link-man" href="../html2/setrlimit.html">setrlimit(2)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">LOGIN_SETUMASK</span></dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
Sets the umask by <a class="link-man" href="../html2/umask.html">umask(2)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">LOGIN_SETUSER</span></dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
Sets the user ID to <i class="arg">uid</i> by <a class="link-man" href="../html2/setuid.html">setuid(2)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">LOGIN_SETALL</span></dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
Sets all of the above.</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html2/setlogin.html">setlogin(2)</a>, <a class="link-man" href="../html2/setpriority.html">setpriority(2)</a>, <a class="link-man" href="../html2/setrlimit.html">setrlimit(2)</a>, <a class="link-man" href="../html2/setuid.html">setuid(2)</a>, <a class="link-man" href="../html2/umask.html">umask(2)</a>, <a class="link-man" href="../html3/initgroups.html">initgroups(3)</a>, <a class="link-man" href="../html5/login.conf.html">login.conf(5)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="name">login_getclass</b> function first appeared in <span class="unix">OpenBSD&#160;2.8</span>.</div>
<div class="section">
<h1 id="x43415645415453">CAVEATS</h1> The string returned by <b class="fname">login_getcapstr</b>() is allocated via <a class="link-man" href="../html3/malloc.html">malloc(3)</a> when the specified capability is present and thus it is the responsibility of the caller to <b class="fname">free</b>() this space. However, if the capability was not found or an error occurred and <i class="farg">def</i> or <i class="farg">err</i> (whichever is relevant) are non-NULL the returned value is simply what was passed in to <b class="fname">login_getcapstr</b>(). Therefore it is not possible to blindly <b class="fname">free</b>() the return value without first checking it against <i class="farg">def</i> and <i class="farg">err</i>.<div class="spacer">
</div>
The same warnings set forth in <a class="link-man" href="../html2/setlogin.html">setlogin(2)</a> apply to <b class="fname">setusercontext</b>() when the <span class="define">LOGIN_SETLOGIN</span> flag is used. Specifically, changing the login name affects all processes in the current session, not just the current process. See <a class="link-man" href="../html2/setlogin.html">setlogin(2)</a> for more information.</div>
</div>
</body>
</html>

