<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
RES_INIT(3)</title>
</head>
<body>
<div class="mandoc">
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">res_query</b>, <b class="name">res_search</b>, <b class="name">res_mkquery</b>, <b class="name">res_send</b>, <b class="name">res_init</b>, <b class="name">dn_comp</b>, <b class="name">dn_expand</b> &#8212; <span class="desc">resolver routines</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">sys/types.h</a>&gt;</b><br/>
<b class="includes">#include &lt;<a class="link-includes">netinet/in.h</a>&gt;</b><br/>
<b class="includes">#include &lt;<a class="link-includes">arpa/nameser.h</a>&gt;</b><br/>
<b class="includes">#include &lt;<a class="link-includes">resolv.h</a>&gt;</b><div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">res_query</b>(<i class="farg">const char *dname</i>, <i class="farg">int class</i>, <i class="farg">int type</i>, <i class="farg">unsigned char *answer</i>, <i class="farg">int anslen</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">res_search</b>(<i class="farg">const char *dname</i>, <i class="farg">int class</i>, <i class="farg">int type</i>, <i class="farg">unsigned char *answer</i>, <i class="farg">int anslen</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">res_mkquery</b>(<i class="farg">int op</i>, <i class="farg">const char *dname</i>, <i class="farg">int class</i>, <i class="farg">int type</i>, <i class="farg">const unsigned char *data</i>, <i class="farg">int datalen</i>, <i class="farg">const unsigned char *newrr</i>, <i class="farg">unsigned char *buf</i>, <i class="farg">int buflen</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">res_send</b>(<i class="farg">const unsigned char *msg</i>, <i class="farg">int msglen</i>, <i class="farg">unsigned char *answer</i>, <i class="farg">int anslen</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">res_init</b>(<i class="farg" style="white-space:nowrap;">void</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">dn_comp</b>(<i class="farg">const char *exp_dn</i>, <i class="farg">unsigned char *comp_dn</i>, <i class="farg">int length</i>, <i class="farg">unsigned char **dnptrs</i>, <i class="farg">unsigned char **lastdnptr</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">dn_expand</b>(<i class="farg">const unsigned char *msg</i>, <i class="farg">const unsigned char *eomorig</i>, <i class="farg">const unsigned char *comp_dn</i>, <i class="farg">char *exp_dn</i>, <i class="farg">int length</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> These routines are used for making, sending, and interpreting query and reply messages with Internet domain name servers.<div class="spacer">
</div>
Global configuration and state information that is used by the resolver routines is kept in the structure <code class="lit">_res</code>. Most of the values have reasonable defaults and can be ignored. Options stored in <code class="lit">_res.options</code> are defined in <b class="includes">&lt;<a class="link-includes">resolv.h</a>&gt;</b> and are as follows. Options are stored as a simple bit mask containing the bitwise OR of the options enabled.<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">RES_INIT</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
True if the initial name server address and default domain name are initialized (i.e. <b class="fname">res_init</b>() has been called).</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">RES_DEBUG</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Print debugging messages, if libc is compiled with <span class="define">DEBUG</span>. By default on <span class="unix">OpenBSD</span> this option does nothing.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">RES_AAONLY</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Accept authoritative answers only. With this option, <b class="fname">res_send</b>() should continue until it finds an authoritative answer or finds an error. Currently this is not implemented.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">RES_USEVC</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Use TCP connections for queries instead of UDP datagrams.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">RES_PRIMARY</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Query the primary name server only. Currently this is not implemented.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">RES_IGNTC</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Ignore truncation errors, i.e. don't retry with TCP.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">RES_RECURSE</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Set the recursion-desired bit in queries. (<b class="fname">res_send</b>() does not do iterative queries and expects the name server to handle recursion.) This option is enabled by default.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">RES_DEFNAMES</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
If set, <b class="fname">res_search</b>() will append the default domain name to single-component names (those that do not contain a dot). This option is enabled by default.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">RES_STAYOPEN</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Used with <span class="define">RES_USEVC</span> to keep the TCP connection open between queries. This is useful only in programs that regularly do many queries. UDP should be the normal mode used.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">RES_DNSRCH</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
If this option is set, <b class="fname">res_search</b>() will search for host names in the current domain and in parent domains; see <a class="link-man" href="../html7/hostname.html">hostname(7)</a>. This is used by the standard host lookup routine <a class="link-man" href="../html3/gethostbyname.html">gethostbyname(3)</a>. This option is enabled by default.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">RES_INSECURE_1</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Do not require the IP source address on the reply packet to be equal to the server's address.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">RES_INSECURE_2</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Do not check if the query section of the reply packet is equal to that of the query packet.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">RES_NOALIASES</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
In the past, this turned off the legacy <span class="env">HOSTALIASES</span> feature.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">RES_USE_INET6</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Enables support for IPv6-only applications. This causes IPv4 addresses to be returned as an IPv4 mapped address. For example, 10.1.1.1 will be returned as ::ffff:10.1.1.1. The option is not meaningful on <span class="unix">OpenBSD</span>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">RES_USE_EDNS0</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Attach an OPT pseudo-RR for the EDNS0 extension, as specified in RFC 2671. This informs DNS servers of a client's receive buffer size, allowing them to take advantage of a non-default receive buffer size, and thus to send larger replies. DNS query packets with the EDNS0 extension are not compatible with non-EDNS0 DNS servers.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">RES_USE_DNSSEC</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Request that the resolver uses Domain Name System Security Extensions (DNSSEC), as defined in RFCs 4033, 4034, and 4035.</dd>
</dl>
<div class="spacer">
</div>
The <b class="fname">res_init</b>() routine reads the configuration file (if any; see <a class="link-man" href="../html5/resolv.conf.html">resolv.conf(5)</a>) to get the default domain name, search list, and the Internet address of the local name server(s). If no server is configured, the host running the resolver is tried. The current domain name is defined by the hostname if not specified in the configuration file; it can be overridden by the environment variable <span class="env">LOCALDOMAIN</span>. This environment variable may contain several blank-separated tokens if you wish to override the <i class="farg">search list</i> on a per-process basis. This is similar to the <i class="farg">search</i> command in the configuration file. Another environment variable <span class="env">RES_OPTIONS</span> can be set to override certain internal resolver options which are otherwise set by changing fields in the <i class="farg">_res</i> structure or are inherited from the configuration file's <i class="farg">options</i> command. The syntax of the <span class="env">RES_OPTIONS</span> environment variable is explained in <a class="link-man" href="../html5/resolv.conf.html">resolv.conf(5)</a>. Initialization normally occurs on the first call to one of the following routines.<div class="spacer">
</div>
The <b class="fname">res_query</b>() function provides an interface to the server query mechanism. It constructs a query, sends it to the local server, awaits a response, and makes preliminary checks on the reply. The query requests information of the specified <i class="farg">type</i> and <i class="farg">class</i> for the specified fully qualified domain name <i class="farg">dname</i>. The reply message is left in the <i class="farg">answer</i> buffer with length <i class="farg">anslen</i> supplied by the caller. Values for the <i class="farg">class</i> and <i class="farg">type</i> fields are defined in <b class="includes">&lt;<a class="link-includes">arpa/nameser.h</a>&gt;</b>.<div class="spacer">
</div>
The <b class="fname">res_search</b>() routine makes a query and awaits a response like <b class="fname">res_query</b>(), but in addition, it implements the default and search rules controlled by the <span class="define">RES_DEFNAMES</span> and <span class="define">RES_DNSRCH</span> options. It returns the first successful reply.<div class="spacer">
</div>
The remaining routines are lower-level routines used by <b class="fname">res_query</b>(). The <b class="fname">res_mkquery</b>() function constructs a standard query message and places it in <i class="farg">buf</i>. It returns the size of the query, or -1 if the query is larger than <i class="farg">buflen</i>. The query type <i class="farg">op</i> is usually <span class="define">QUERY</span>, but can be any of the query types defined in <b class="includes">&lt;<a class="link-includes">arpa/nameser.h</a>&gt;</b>. The domain name for the query is given by <i class="farg">dname</i>. <i class="farg">newrr</i> is currently unused but is intended for making update messages.<div class="spacer">
</div>
The <b class="fname">res_send</b>() routine sends a pre-formatted query and returns an answer. It will call <b class="fname">res_init</b>() if <span class="define">RES_INIT</span> is not set, send the query to the local name server, and handle timeouts and retries. The length of the reply message is returned, or -1 if there were errors.<div class="spacer">
</div>
The <b class="fname">dn_comp</b>() function compresses the domain name <i class="farg">exp_dn</i> and stores it in <i class="farg">comp_dn</i>. The size of the compressed name is returned or -1 if there were errors. The size of the array pointed to by <i class="farg">comp_dn</i> is given by <i class="farg">length</i>. The compression uses an array of pointers <i class="farg">dnptrs</i> to previously compressed names in the current message. The first pointer points to the beginning of the message and the list ends with <span class="define">NULL</span>. The limit to the array is specified by <i class="farg">lastdnptr</i>. A side effect of <b class="fname">dn_comp</b>() is to update the list of pointers for labels inserted into the message as the name is compressed. If <i class="farg">dnptrs</i> is <span class="define">NULL</span>, names are not compressed. If <i class="farg">lastdnptr</i> is <span class="define">NULL</span>, the list of labels is not updated.<div class="spacer">
</div>
The <b class="fname">dn_expand</b>() entry expands the compressed domain name <i class="farg">comp_dn</i> to a full domain name. The compressed name is contained in a query or reply message; <i class="farg">msg</i> is a pointer to the beginning of the message. The uncompressed name is placed in the buffer indicated by <i class="farg">exp_dn</i> which is of size <i class="farg">length</i>. The size of compressed name is returned or -1 if there was an error.</div>
<div class="section">
<h1 id="x46494c4553">FILES</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="file">/etc/resolv.conf</i></dt>
<dd class="list-tag" style="margin-left: 18.00ex;">
The configuration file.</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html3/gethostbyname.html">gethostbyname(3)</a>, <a class="link-man" href="../html5/resolv.conf.html">resolv.conf(5)</a>, <a class="link-man" href="../html7/hostname.html">hostname(7)</a></div>
<div class="section">
<h1 id="x5354414e4441524453">STANDARDS</h1> <span class="ref"><span class="ref-auth">M. Stahl</span>, <span class="ref-title">Domain Administrators Guide</span>, <span class="ref-rep">RFC 1032</span>, <span class="ref-date">November 1987</span>.</span><div class="spacer">
</div>
<span class="ref"><span class="ref-auth">M. Lottor</span>, <span class="ref-title">Domain Administrators Operations Guide</span>, <span class="ref-rep">RFC 1033</span>, <span class="ref-date">November 1987</span>.</span><div class="spacer">
</div>
<span class="ref"><span class="ref-auth">P. Mockapetris</span>, <span class="ref-title">Domain Names &#8211; Concepts and Facilities</span>, <span class="ref-rep">RFC 1034</span>, <span class="ref-date">November 1987</span>.</span><div class="spacer">
</div>
<span class="ref"><span class="ref-auth">P. Mockapetris</span>, <span class="ref-title">Domain Names &#8211; Implementation and Specification</span>, <span class="ref-rep">RFC 1035</span>, <span class="ref-date">November 1987</span>.</span><div class="spacer">
</div>
<span class="ref"><span class="ref-auth">J. Klensin</span>, <span class="ref-title">Simple Mail Transfer Protocol</span>, <span class="ref-rep">RFC 5321</span>, <span class="ref-date">October 2008</span>.</span></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="name">res_query</b> function appeared in <span class="unix">4.3BSD</span>.</div>
</div>
</body>
</html>

