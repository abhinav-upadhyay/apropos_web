<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
GETSOCKOPT(2)</title>
</head>
<body>
<div class="mandoc">
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">getsockopt</b>, <b class="name">setsockopt</b> &#8212; <span class="desc">get and set options on sockets</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">sys/socket.h</a>&gt;</b><div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">getsockopt</b>(<i class="farg" style="white-space:nowrap;">int s</i>, <i class="farg" style="white-space:nowrap;">int level</i>, <i class="farg" style="white-space:nowrap;">int optname</i>, <i class="farg" style="white-space:nowrap;">void *optval</i>, <i class="farg" style="white-space:nowrap;">socklen_t *optlen</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">setsockopt</b>(<i class="farg" style="white-space:nowrap;">int s</i>, <i class="farg" style="white-space:nowrap;">int level</i>, <i class="farg" style="white-space:nowrap;">int optname</i>, <i class="farg" style="white-space:nowrap;">const void *optval</i>, <i class="farg" style="white-space:nowrap;">socklen_t optlen</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> <b class="fname">getsockopt</b>() and <b class="fname">setsockopt</b>() manipulate the <span class="emph">options</span> associated with a socket. Options may exist at multiple protocol levels; they are always present at the uppermost &#8220;socket&#8221; level.<div class="spacer">
</div>
When manipulating socket options the level at which the option resides and the name of the option must be specified. To manipulate options at the socket level, <i class="farg">level</i> is specified as <span class="define">SOL_SOCKET</span>. To manipulate options at any other level the protocol number of the appropriate protocol controlling the option is supplied. For example, to indicate that an option is to be interpreted by the TCP protocol, <i class="farg">level</i> should be set to the protocol number of TCP; see <a class="link-man" href="../html3/getprotoent.html">getprotoent(3)</a>.<div class="spacer">
</div>
The parameters <i class="farg">optval</i> and <i class="farg">optlen</i> are used to access option values for <b class="fname">setsockopt</b>(). For <b class="fname">getsockopt</b>() they identify a buffer in which the value for the requested option(s) are to be returned. For <b class="fname">getsockopt</b>(), <i class="farg">optlen</i> is a value-result parameter, initially containing the size of the buffer pointed to by <i class="farg">optval</i>, and modified on return to indicate the actual size of the value returned. If no option value is to be supplied or returned, <i class="farg">optval</i> may be <span class="define">NULL</span>.<div class="spacer">
</div>
<i class="farg">optname</i> and any specified options are passed uninterpreted to the appropriate protocol module for interpretation. The include file <b class="includes">&lt;<a class="link-includes">sys/socket.h</a>&gt;</b> contains definitions for socket level options, described below. Options at other protocol levels vary in format and name; consult the appropriate entries in section 4 of the manual.<div class="spacer">
</div>
Most socket-level options utilize an <code class="lit">int</code> parameter for <i class="farg">optval</i>. For <b class="fname">setsockopt</b>(), the parameter should be non-zero to enable a boolean option, or zero if the option is to be disabled. <span class="define">SO_LINGER</span> uses a <code class="lit">struct linger</code> parameter, defined in <b class="includes">&lt;<a class="link-includes">sys/socket.h</a>&gt;</b>, which specifies the desired state of the option and the linger interval (see below). <span class="define">SO_SNDTIMEO</span> and <span class="define">SO_RCVTIMEO</span> use a <code class="lit">struct timeval</code> parameter, defined in <b class="includes">&lt;<a class="link-includes">sys/time.h</a>&gt;</b>.<div class="spacer">
</div>
The following options are recognized at the socket level. Except as noted, each may be examined with <b class="fname">getsockopt</b>() and set with <b class="fname">setsockopt</b>().<div class="spacer">
</div>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 6.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">SO_DEBUG</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
enables recording of debugging information</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">SO_REUSEADDR</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
enables local address reuse</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">SO_REUSEPORT</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
enables duplicate address and port bindings</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">SO_KEEPALIVE</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
enables keep connections alive</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">SO_DONTROUTE</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
enables routing bypass; not supported</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">SO_LINGER</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
linger on close if data present</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">SO_BROADCAST</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
enables permission to transmit broadcast messages</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">SO_OOBINLINE</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
enables reception of out-of-band data in band</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">SO_BINDANY</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
enables binding to any address</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">SO_SNDBUF</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
set buffer size for output</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">SO_RCVBUF</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
set buffer size for input</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">SO_SNDLOWAT</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
set minimum count for output</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">SO_RCVLOWAT</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
set minimum count for input</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">SO_SNDTIMEO</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
set timeout value for output</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">SO_RCVTIMEO</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
set timeout value for input</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">SO_TIMESTAMP</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
enables reception of a timestamp with datagrams</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">SO_PEERCRED</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
get the credentials from other side of connection</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">SO_RTABLE</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
set the routing table used for route lookups</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">SO_SPLICE</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
splice two sockets together or get data length</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">SO_TYPE</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
get the type of the socket (get only)</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">SO_ERROR</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
get and clear error on the socket (get only)</dd>
</dl>
<div class="spacer">
</div>
<span class="define">SO_DEBUG</span> enables debugging in the underlying protocol modules. <span class="define">SO_REUSEADDR</span> indicates that the rules used in validating addresses supplied in a <a class="link-man" href="../html2/bind.html">bind(2)</a> call should allow reuse of local addresses. <span class="define">SO_REUSEPORT</span> allows completely duplicate bindings by multiple processes if they all set <span class="define">SO_REUSEPORT</span> before binding the port. This option permits multiple instances of a program to each receive UDP/IP multicast or broadcast datagrams destined for the bound port. <span class="define">SO_KEEPALIVE</span> enables the periodic transmission of messages on a connected socket. Should the connected party fail to respond to these messages, the connection is considered broken and processes using the socket are notified via a <span class="define">SIGPIPE</span> signal when attempting to send data.<div class="spacer">
</div>
<span class="define">SO_LINGER</span> controls the action taken when unsent messages are queued on socket and a <a class="link-man" href="../html2/close.html">close(2)</a> is performed. If the socket promises reliable delivery of data and <span class="define">SO_LINGER</span> is set, the system will block the process on the <a class="link-man" href="../html2/close.html">close(2)</a> attempt until it is able to transmit the data or until it decides it is unable to deliver the information (a timeout period measured in seconds, termed the linger interval, is specified in the <b class="fname">setsockopt</b>() call when <span class="define">SO_LINGER</span> is requested). If <span class="define">SO_LINGER</span> is disabled and a <a class="link-man" href="../html2/close.html">close(2)</a> is issued, the system will process the close in a manner that allows the process to continue as quickly as possible.<div class="spacer">
</div>
The option <span class="define">SO_BROADCAST</span> requests permission to send broadcast datagrams on the socket. Broadcast was a privileged operation in earlier versions of the system. With protocols that support out-of-band data, the <span class="define">SO_OOBINLINE</span> option requests that out-of-band data be placed in the normal data input queue as received; it will then be accessible with <a class="link-man" href="../html2/recv.html">recv(2)</a> or <a class="link-man" href="../html2/read.html">read(2)</a> calls without the <span class="define">MSG_OOB</span> flag. Some protocols always behave as if this option is set.<div class="spacer">
</div>
<span class="define">SO_BINDANY</span> allows the socket to be bound to addresses which are not local to the machine, so it can be used to make a transparent proxy. Note that this option is limited to the super-user. In order to receive packets for these addresses, <span class="define">SO_BINDANY</span> needs to be combined with matching outgoing <a class="link-man" href="../html4/pf.html">pf(4)</a> rules with the <i class="arg">divert-reply</i> parameter. For example, with the following rule the socket receives packets for 192.168.0.10 even if it is not a local address:<div class="spacer">
</div>
<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit">pass out inet from 192.168.0.10 divert-reply</code></div>
</blockquote>
<div class="spacer">
</div>
<span class="define">SO_SNDBUF</span> and <span class="define">SO_RCVBUF</span> are options to adjust the normal buffer sizes allocated for output and input buffers, respectively. The buffer size may be increased for high-volume connections, or may be decreased to limit the possible backlog of incoming data. The system places an absolute limit on these values.<div class="spacer">
</div>
<span class="define">SO_SNDLOWAT</span> is an option to set the minimum count for output operations. Most output operations process all of the data supplied by the call, delivering data to the protocol for transmission and blocking as necessary for flow control. Nonblocking output operations will process as much data as permitted subject to flow control without blocking, but will process no data if flow control does not allow the smaller of the low water mark value or the entire request to be processed. A <a class="link-man" href="../html2/select.html">select(2)</a> or <a class="link-man" href="../html2/poll.html">poll(2)</a> operation testing the ability to write to a socket will return true only if the low water mark amount could be processed. The default value for <span class="define">SO_SNDLOWAT</span> is set to a convenient size for network efficiency, often 1024. <span class="define">SO_RCVLOWAT</span> is an option to set the minimum count for input operations. In general, receive calls will block until any (non-zero) amount of data is received, then return with the smaller of the amount available or the amount requested. The default value for <span class="define">SO_RCVLOWAT</span> is 1. If <span class="define">SO_RCVLOWAT</span> is set to a larger value, blocking receive calls normally wait until they have received the smaller of the low water mark value or the requested amount. Receive calls may still return less than the low water mark if an error occurs, a signal is caught, or the type of data next in the receive queue is different than that returned.<div class="spacer">
</div>
<span class="define">SO_SNDTIMEO</span> is an option to set a timeout value for output operations. It accepts a <code class="lit">struct timeval</code> parameter with the number of seconds and microseconds used to limit waits for output operations to complete. If a send operation has blocked for this much time, it returns with a partial count or with the error <span class="errno">EWOULDBLOCK</span> if no data was sent. In the current implementation, this timer is restarted each time additional data are delivered to the protocol, implying that the limit applies to output portions ranging in size from the low water mark to the high water mark for output. <span class="define">SO_RCVTIMEO</span> is an option to set a timeout value for input operations. It accepts a <code class="lit">struct timeval</code> parameter with the number of seconds and microseconds used to limit waits for input operations to complete. In the current implementation, this timer is restarted each time additional data are received by the protocol, and thus the limit is in effect an inactivity timer. If a receive operation has been blocked for this much time without receiving additional data, it returns with a short count or with the error <span class="errno">EWOULDBLOCK</span> if no data were received.<div class="spacer">
</div>
If the <span class="define">SO_TIMESTAMP</span> option is enabled on a <span class="define">SOCK_DGRAM</span> socket, the <a class="link-man" href="../html2/recvmsg.html">recvmsg(2)</a> call will return a timestamp corresponding to when the datagram was received. The msg_control field in the msghdr structure points to a buffer that contains a cmsghdr structure followed by a struct timeval. The cmsghdr fields have the following values:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
cmsg_len = CMSG_LEN(sizeof(struct timeval)) 
cmsg_level = SOL_SOCKET 
cmsg_type = SCM_TIMESTAMP</pre>
<div class="spacer">
</div>
<span class="define">SO_PEERCRED</span> fetches the <b class="var">struct sockpeercred</b> credentials from the other side of the connection (currently only possible on <span class="define">AF_UNIX</span> sockets). These credentials are from the time that <a class="link-man" href="../html2/bind.html">bind(2)</a> or <a class="link-man" href="../html2/connect.html">connect(2)</a> were called.<div class="spacer">
</div>
The <span class="define">SO_RTABLE</span> option gets or sets the routing table which will be used by the socket for address lookups. If a protocol family of the socket doesn't support switching routing tables, the <span class="errno">ENOPROTOOPT</span> error is returned. Only the superuser is allowed to change the routing table if it is already set to a non-zero value. A socket's chosen routing table is initialized from the process's configuration, previously selected using <a class="link-man" href="../html2/setrtable.html">setrtable(2)</a>.<div class="spacer">
</div>
<span class="define">SO_SPLICE</span> can splice together two TCP or UDP sockets for unidirectional zero-copy data transfers. Splice also the other way around to get bidirectional data flow. Both sockets must be of the same type. In the first form, <b class="fname">setsockopt</b>() is called with the source socket <i class="farg">s</i> and the drain socket's <span class="type">int</span> file descriptor as <i class="farg">optval</i>. In the second form, <i class="farg">optval</i> is a <span class="type">struct splice</span> with the drain socket in <b class="var">sp_fd</b>, a positive maximum number of bytes or 0 in <b class="var">sp_max</b> and an idle timeout <b class="var">sp_idle</b> in the form of a <span class="type">struct timeval</span>. If -1 is given as drain socket, the source socket <i class="farg">s</i> gets unspliced. Otherwise the spliced data transfer continues within the kernel until the optional maximum is reached, one of the connections terminates, idle timeout expires or an error occurs. A successful <a class="link-man" href="../html2/select.html">select(2)</a>, <a class="link-man" href="../html2/poll.html">poll(2)</a>, or <a class="link-man" href="../html2/kqueue.html">kqueue(2)</a> operation testing the ability to read from the source socket indicates that the splicing has terminated. When one of the sockets gets closed, splicing ends. The error status can be examined with <span class="define">SO_ERROR</span> at the source socket. The <span class="errno">ETIMEDOUT</span> error is set if there was no data transferred between two sockets during the <b class="var">sp_idle</b> period of time. The <span class="errno">EFBIG</span> error is set after exactly <b class="var">sp_max</b> bytes have been transferred. Note that if a maximum is given, it is only guaranteed that no more bytes are transferred. A short splice can happen, but then a second call to splice will transfer the remaining data immediately. The <span class="define">SO_SPLICE</span> option with <b class="fname">getsockopt</b>() and an <span class="type">off_t</span> value as <i class="farg">optval</i> can be used to retrieve the number of bytes transferred so far from the source socket <i class="farg">s</i>. A successful new splice resets this number.<div class="spacer">
</div>
Finally, <span class="define">SO_TYPE</span> and <span class="define">SO_ERROR</span> are options used only with <b class="fname">getsockopt</b>(). <span class="define">SO_TYPE</span> returns the type of the socket, such as <span class="define">SOCK_STREAM</span>; it is useful for servers that inherit sockets on startup. <span class="define">SO_ERROR</span> returns any pending error on the socket and clears the error status. It may be used to check for asynchronous errors on connected datagram sockets or for other asynchronous errors.</div>
<div class="section">
<h1 id="x52455455524e2056414c554553">RETURN VALUES</h1> Upon successful completion, the value&#160;0 is returned; otherwise the value&#160;-1 is returned and the global variable <b class="var">errno</b> is set to indicate the error.</div>
<div class="section">
<h1 id="x4552524f5253">ERRORS</h1> The call succeeds unless:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">EBADF</span>]</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The argument <i class="farg">s</i> is not a valid descriptor.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">ENOTSOCK</span>]</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The argument <i class="farg">s</i> is a file, not a socket.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">ENOPROTOOPT</span>]</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The option is unknown at the level indicated.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">EOPNOTSUPP</span>]</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The option is unsupported.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="errno">EFAULT</span>]</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The address pointed to by <i class="farg">optval</i> is not in a valid part of the process address space. For <b class="fname">getsockopt</b>(), this error may also be returned if <i class="farg">optlen</i> is not in a valid part of the process address space.</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html2/connect.html">connect(2)</a>, <a class="link-man" href="../html2/getrtable.html">getrtable(2)</a>, <a class="link-man" href="../html2/ioctl.html">ioctl(2)</a>, <a class="link-man" href="../html2/poll.html">poll(2)</a>, <a class="link-man" href="../html2/select.html">select(2)</a>, <a class="link-man" href="../html2/socket.html">socket(2)</a>, <a class="link-man" href="../html3/getprotoent.html">getprotoent(3)</a>, <a class="link-man" href="../html4/divert.html">divert(4)</a>, <a class="link-man" href="../html5/pf.conf.html">pf.conf(5)</a>, <a class="link-man" href="../html5/protocols.html">protocols(5)</a>, <a class="link-man" href="../html9/sosplice.html">sosplice(9)</a></div>
<div class="section">
<h1 id="x5354414e4441524453">STANDARDS</h1> The <b class="fname">getsockopt</b>() and <b class="fname">setsockopt</b>() functions conform to IEEE Std 1003.1-2008 (&#8220;POSIX.1&#8221;).</div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="fname">getsockopt</b>() system call appeared in <span class="unix">4.2BSD</span>.</div>
<div class="section">
<h1 id="x42554753">BUGS</h1> Several of the socket options should be handled at lower levels of the system.</div>
</div>
</body>
</html>

