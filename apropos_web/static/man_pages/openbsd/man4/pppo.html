<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
PPPOE(4)</title>
</head>
<body>
<div class="mandoc">
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">pppoe</b> &#8212; <span class="desc">PPP Over Ethernet protocol network interface</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="config">pseudo-device pppoe</b></div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="name">pppoe</b> interface encapsulates <span class="emph">Point-to-Point Protocol (PPP)</span> packets inside Ethernet frames as defined by RFC 2516.<div class="spacer">
</div>
This is often used to connect a router via a DSL modem to an access concentrator. The <b class="name">pppoe</b> interface does not by itself transmit or receive frames, but needs an Ethernet interface to do so. This Ethernet interface is connected to the <b class="name">pppoe</b> interface via <a class="link-man" href="../html8/ifconfig.html">ifconfig(8)</a>. The Ethernet interface needs to be marked UP, but does not need to have an IP address.<div class="spacer">
</div>
There are two basic modes of operation, controlled via the <span class="emph">link1</span> switch. The default mode, <span class="emph">link1</span> not being set, tries to keep the configured session open all the time. If the session is disconnected, a new connection attempt is started immediately. The &#8220;dial on demand&#8221; mode, selected by setting <span class="emph">link1</span>, only establishes a connection when data is being sent to the interface.<div class="spacer">
</div>
Before a <b class="name">pppoe</b> interface is usable, it needs to be configured. The following steps are necessary:<ul style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-bul">
<li class="list-bul" style="margin-top: 1.00em;">
Create the interface.</li>
<li class="list-bul" style="margin-top: 1.00em;">
Connect an Ethernet interface. This interface is used for the physical communication. As noted above it must be marked UP, but need not have an IP address.</li>
<li class="list-bul" style="margin-top: 1.00em;">
Configure authentication. The PPP session needs to identify the client to the peer. For more details on the available options see <a class="link-man" href="../html8/ifconfig.html">ifconfig(8)</a>.</li>
<li class="list-bul" style="margin-top: 1.00em;">
If using IPv6, configure a link-local address.</li>
</ul>
<div class="spacer">
</div>
This all is typically accomplished using an <i class="file">/etc/hostname.pppoe0</i> file. A typical file looks like this:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
inet 0.0.0.0 255.255.255.255 NONE \ 
	pppoedev em0 authproto pap \ 
	authname 'testcaller' authkey 'donttell' up 
dest 0.0.0.1 
inet6 eui64 
!/sbin/route add default -ifp pppoe0 0.0.0.1 
!/sbin/route add -inet6 default -ifp pppoe0 fe80::</pre>
<div class="spacer">
</div>
The physical interface must also be marked &#8216;<code class="lit">up</code>&#8217;:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
# echo &quot;up&quot; &gt; /etc/hostname.em0</pre>
<div class="spacer">
</div>
Since this is a PPP interface, the addresses assigned to the interface may change during PPP negotiation. There is no fine grained control available for deciding which addresses are acceptable and which are not. For the local side and the remote address there is exactly one choice: hard coded address or wildcard. If a real address is assigned to one side of the connection, PPP negotiation will only agree to exactly this address. If one side is wildcarded, every address suggested by the peer will be accepted.<div class="spacer">
</div>
To wildcard the local address set it to 0.0.0.0; to wildcard the remote address set it to 0.0.0.1.</div>
<div class="section">
<h1 id="x4b45524e454c204f5054494f4e53">KERNEL OPTIONS</h1> A <b class="name">pppoe</b> enabled kernel will not interfere with other PPPoE implementations running on the same machine. Under special circumstances (details below) this is not desirable, so the <b class="name">pppoe</b> driver can be told to kill all unknown PPPoE sessions received by the Ethernet interface used for a configured <b class="name">pppoe</b> interface. To do this, add the following to your kernel config file:<div class="spacer">
</div>
<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit">option PPPOE_TERM_UNKNOWN_SESSIONS</code></div>
</blockquote>
<div class="spacer">
</div>
This option is only useful if you have a static IP address assigned and your ISP does not use LCP echo requests to monitor the link status. After a crash or power failure the peer device still tries to send data to the no longer active session on your computer, and might refuse to reestablish a new connection, because there already is an open session. On receipt of such packets, the <b class="name">pppoe</b> driver with this option set will send a PADT packet (request to terminate the session). The peer will immediately disconnect the orphaned session and allow a new one to be established.</div>
<div class="section">
<h1 id="x4d54552f4d535320495353554553">MTU/MSS ISSUES</h1> Problems can arise on machines with private IPs connecting to the Internet via a machine running both Network Address Translation (NAT) and <b class="name">pppoe</b>. Standard Ethernet uses a maximum transmission unit (MTU) of 1500 bytes, whereas PPPoE mechanisms need a further 8 bytes of overhead. This leaves a maximum MTU of 1492. <b class="name">pppoe</b> sets the MTU on its interface to 1492 as a matter of course. However, machines connecting on a private LAN will still have their MTUs set to 1500, causing conflict. Using a packet filter, the maximum segment size (MSS) can be set (clamped) to the required value. The following rule in <a class="link-man" href="../html5/pf.conf.html">pf.conf(5)</a> would set the MSS to 1440:<div class="spacer">
</div>
<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit">match on pppoe0 scrub (max-mss 1440)</code></div>
</blockquote>
<div class="spacer">
</div>
Although in theory the maximum MSS over a PPPoE interface is 1452 bytes, 1440 appears to be a safer bet. Note that setting the MSS this way can have undesirable effects, such as interfering with the OS detection features of <a class="link-man" href="../html4/pf.html">pf(4)</a>.<div class="spacer">
</div>
Alternatively in cases where the remote equipment supports RFC 4638 and the physical interface is configured to support jumbo frames, the MTU of the <b class="name">pppoe</b> interface can be raised and it will attempt to negotiate an increased MTU. For example, in <i class="file">/etc/hostname.pppoe0</i>:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
inet 0.0.0.0 255.255.255.255 NONE mtu 1500 \ 
	pppoedev em0 authproto pap \ 
	authname 'testcaller' authkey 'donttell' up 
dest 0.0.0.1 
!/sbin/route add default -ifp pppoe0 0.0.0.1</pre>
<div class="spacer">
</div>
The physical interface must also be configured like so:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
# echo &quot;up mtu 1508&quot; &gt; /etc/hostname.em0</pre>
<div class="spacer">
</div>
With this, the previously mentioned MSS clamping rules in <a class="link-man" href="../html5/pf.conf.html">pf.conf(5)</a> are no longer necessary.<div class="spacer">
</div>
See <a class="link-man" href="../html5/pf.conf.html">pf.conf(5)</a> for more information on MTU, MSS, and NAT.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html4/sppp.html">sppp(4)</a>, <a class="link-man" href="../html5/hostname.if.html">hostname.if(5)</a>, <a class="link-man" href="../html5/pf.conf.html">pf.conf(5)</a>, <a class="link-man" href="../html8/ifconfig.html">ifconfig(8)</a></div>
<div class="section">
<h1 id="x5354414e4441524453">STANDARDS</h1> <span class="ref"><span class="ref-auth">L. Mamakos</span>, <span class="ref-auth">K. Lidl</span>, <span class="ref-auth">J. Evarts</span>, <span class="ref-auth">D. Carrel</span>, <span class="ref-auth">D. Simone</span>, and <span class="ref-auth">R. Wheeler</span>, <span class="ref-title">A Method for Transmitting PPP Over Ethernet (PPPoE)</span>, <span class="ref-rep">RFC 2516</span>, <span class="ref-date">February 1999</span>.</span><div class="spacer">
</div>
<span class="ref"><span class="ref-auth">P. Arberg</span>, <span class="ref-auth">D. Kourkouzelis</span>, <span class="ref-auth">M. Duckett</span>, <span class="ref-auth">T. Anschutz</span>, and <span class="ref-auth">J. Moisand</span>, <span class="ref-title">Accommodating a Maximum Transit Unit/Maximum Receive Unit (MTU/MRU) Greater Than 1492 in the Point-to-Point Protocol over Ethernet (PPPoE)</span>, <span class="ref-rep">RFC 4638</span>, <span class="ref-date">September 2006</span>.</span></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="name">pppoe</b> device first appeared in <span class="unix">OpenBSD&#160;3.7</span>.</div>
<div class="section">
<h1 id="x43415645415453">CAVEATS</h1> RFC 4638 negotiation is only aware of the MTU configured on the endpoints, but not the maximum MTU supported on the path between them. If the path cannot pass the larger Ethernet frames, negotiation will succeed but the connection will not function correctly.</div>
<div class="section">
<h1 id="x42554753">BUGS</h1> This implementation is client side only.<div class="spacer">
</div>
It is important to specify &#8220;<code class="lit">netmask 255.255.255.255</code>&#8221; to <a class="link-man" href="../html8/ifconfig.html">ifconfig(8)</a>. If the netmask is unspecified, it will be set to 8 when 0.0.0.0 is configured to the interface, and it will persist after negotiation.<div class="spacer">
</div>
The presence of a <a class="link-man" href="../html5/mygate.html">mygate(5)</a> file will interfere with the routing table. Make sure this file is either empty or does not exist.</div>
</div>
</body>
</html>

