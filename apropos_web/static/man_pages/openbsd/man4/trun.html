<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
TRUNK(4)</title>
</head>
<body>
<div class="mandoc">
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">trunk</b> &#8212; <span class="desc">link aggregation and link failover interface</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="config">pseudo-device trunk</b></div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="name">trunk</b> interface allows aggregation of multiple network interfaces as one virtual <b class="name">trunk</b> interface.<div class="spacer">
</div>
A <b class="name">trunk</b> interface can be created using the <b class="cmd">ifconfig trunk</b><i class="arg">N</i> <b class="cmd">create</b> command. It can use different link aggregation protocols specified using the <b class="cmd">trunkproto</b> <i class="arg">proto</i> option. Child interfaces can be added using the <b class="cmd">trunkport</b> <i class="arg">child-iface</i> option and removed using the <b class="cmd">-trunkport</b> <i class="arg">child-iface</i> option.<div class="spacer">
</div>
The driver currently supports the trunk protocols <b class="cmd">broadcast</b>, <b class="cmd">failover</b>, <b class="cmd">lacp</b>, <b class="cmd">loadbalance</b>, <b class="cmd">none</b>, and <b class="cmd">roundrobin</b> (the default). The protocols determine which ports are used for outgoing traffic and whether a specific port accepts incoming traffic. The interface link state is used to validate if the port is active or not.<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">broadcast</b></dt>
<dd class="list-tag" style="margin-left: 11.00ex;">
Sends frames to all ports of the trunk and receives frames on any port of the trunk.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">failover</b></dt>
<dd class="list-tag" style="margin-left: 11.00ex;">
Sends and receives traffic only through the master port. If the master port becomes unavailable, the next active port is used. The first interface added is the master port; any interfaces added after that are used as failover devices.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">lacp</b></dt>
<dd class="list-tag" style="margin-left: 11.00ex;">
Uses the IEEE 802.3ad Link Aggregation Control Protocol (LACP) and the Marker Protocol to increase link speed and provide redundancy. LACP trunk groups are composed of ports of the same speed, set to full-duplex operation. This protocol requires a switch which supports LACP.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">loadbalance</b></dt>
<dd class="list-tag" style="margin-left: 11.00ex;">
Distributes outgoing traffic through all active ports and accepts incoming traffic from any active port. A hash of the protocol header is used to maintain packet ordering. The hash includes the Ethernet source and destination address and, if available, the VLAN tag, and the IP source and destination address.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">none</b></dt>
<dd class="list-tag" style="margin-left: 11.00ex;">
This protocol is intended to do nothing: it disables any traffic without disabling the <b class="name">trunk</b> interface itself.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">roundrobin</b></dt>
<dd class="list-tag" style="margin-left: 11.00ex;">
Distributes outgoing traffic through all active ports and accepts incoming traffic from any active port. A round-robin scheduler is used to aggregate the traffic.</dd>
</dl>
<div class="spacer">
</div>
The configuration can be done at runtime or by setting up a <a class="link-man" href="../html5/hostname.if.html">hostname.if(5)</a> configuration file for <a class="link-man" href="../html8/netstart.html">netstart(8)</a>.</div>
<div class="section">
<h1 id="x4558414d504c4553">EXAMPLES</h1> Create a simple round robin trunk with two <a class="link-man" href="../html4/bge.html">bge(4)</a> Gigabit Ethernet interfaces:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
# ifconfig bge0 up 
# ifconfig bge1 up 
# ifconfig trunk0 trunkport bge0 trunkport bge1 \ 
	192.168.1.1 netmask 255.255.255.0</pre>
<div class="spacer">
</div>
The following example uses an active failover trunk to set up roaming between wired and wireless networks using two network devices. Whenever the wired master interface is unplugged, the wireless failover device will be used:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
# ifconfig em0 up 
# ifconfig ath0 nwid my_net up 
# ifconfig trunk0 trunkproto failover trunkport em0 trunkport ath0 \ 
	192.168.1.1 netmask 255.255.255.0</pre>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html4/inet.html">inet(4)</a>, <a class="link-man" href="../html5/hostname.if.html">hostname.if(5)</a>, <a class="link-man" href="../html8/ifconfig.html">ifconfig(8)</a>, <a class="link-man" href="../html8/netstart.html">netstart(8)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="name">trunk</b> device first appeared in <span class="unix">OpenBSD&#160;3.8</span>.</div>
<div class="section">
<h1 id="x415554484f5253">AUTHORS</h1> The <b class="name">trunk</b> driver was written by <span class="author">Reyk Floeter</span> &lt;<a class="link-mail" href="mailto:reyk@openbsd.org">reyk@openbsd.org</a>&gt;.</div>
<div class="section">
<h1 id="x43415645415453">CAVEATS</h1> The trunk protocols <b class="cmd">loadbalance</b> and <b class="cmd">roundrobin</b> require a switch which supports IEEE 802.3ad static link aggregation; otherwise protocols such as <a class="link-man" href="../html4/inet6.html">inet6(4)</a> duplicate address detection (DAD) cannot properly deal with duplicate packets.<div class="spacer">
</div>
There is no way to configure LACP administrative variables, including system and port priorities. The current implementation always performs active-mode LACP and uses 0x8000 as system and port priorities.<div class="spacer">
</div>
The <b class="name">trunk</b> interface takes its MTU from the first <b class="cmd">trunkport</b>. To avoid mismatches, adding a child interface with a different MTU is not permitted.</div>
</div>
</body>
</html>

