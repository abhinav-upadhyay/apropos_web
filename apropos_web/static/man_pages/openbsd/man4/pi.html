<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
PIM(4)</title>
</head>
<body>
<div class="mandoc">
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">pim</b> &#8212; <span class="desc">Protocol Independent Multicast</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="config">options MROUTING</b><br/>
<b class="config">options PIM</b><div class="spacer">
</div>
<br/>
<b class="includes">#include &lt;<a class="link-includes">sys/types.h</a>&gt;</b><br/>
<b class="includes">#include &lt;<a class="link-includes">sys/socket.h</a>&gt;</b><br/>
<b class="includes">#include &lt;<a class="link-includes">netinet/in.h</a>&gt;</b><br/>
<b class="includes">#include &lt;<a class="link-includes">netinet/ip_mroute.h</a>&gt;</b><br/>
<b class="includes">#include &lt;<a class="link-includes">netinet/pim.h</a>&gt;</b><div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">getsockopt</b>(<i class="farg" style="white-space:nowrap;">int s</i>, <i class="farg" style="white-space:nowrap;">IPPROTO_IP</i>, <i class="farg" style="white-space:nowrap;">MRT_PIM</i>, <i class="farg" style="white-space:nowrap;">void *optval</i>, <i class="farg" style="white-space:nowrap;">socklen_t *optlen</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">setsockopt</b>(<i class="farg" style="white-space:nowrap;">int s</i>, <i class="farg" style="white-space:nowrap;">IPPROTO_IP</i>, <i class="farg" style="white-space:nowrap;">MRT_PIM</i>, <i class="farg" style="white-space:nowrap;">const void *optval</i>, <i class="farg" style="white-space:nowrap;">socklen_t optlen</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">getsockopt</b>(<i class="farg" style="white-space:nowrap;">int s</i>, <i class="farg" style="white-space:nowrap;">IPPROTO_IPV6</i>, <i class="farg" style="white-space:nowrap;">MRT6_PIM</i>, <i class="farg" style="white-space:nowrap;">void *optval</i>, <i class="farg" style="white-space:nowrap;">socklen_t *optlen</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">setsockopt</b>(<i class="farg" style="white-space:nowrap;">int s</i>, <i class="farg" style="white-space:nowrap;">IPPROTO_IPV6</i>, <i class="farg" style="white-space:nowrap;">MRT6_PIM</i>, <i class="farg" style="white-space:nowrap;">const void *optval</i>, <i class="farg" style="white-space:nowrap;">socklen_t optlen</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> PIM is the common name for two multicast routing protocols: Protocol Independent Multicast - Sparse Mode (PIM-SM) and Protocol Independent Multicast - Dense Mode (PIM-DM).<div class="spacer">
</div>
PIM-SM is a multicast routing protocol that can use the underlying unicast routing information base or a separate multicast-capable routing information base. It builds unidirectional shared trees rooted at a Rendezvous Point (RP) per group, and optionally creates shortest-path trees per source.<div class="spacer">
</div>
PIM-DM is a multicast routing protocol that uses the underlying unicast routing information base to flood multicast datagrams to all multicast routers. Prune messages are used to prevent future datagrams from propagating to routers with no group membership information.<div class="spacer">
</div>
Both PIM-SM and PIM-DM are fairly complex protocols, though PIM-SM is much more complex. To enable PIM-SM or PIM-DM multicast routing in a router, the user must enable multicast forwarding via the <b class="var">net.inet.ip.mforwarding</b> <a class="link-man" href="../html8/sysctl.html">sysctl(8)</a> and PIM processing in the kernel (see <i class="link-sec"><a class="link-sec" href="#x53594e4f50534953">SYNOPSIS</a></i> for the correct kernel configuration option). The user must also run a PIM-SM or PIM-DM capable user-level process. From a developer's point of view, the programming guide described in the <i class="link-sec"><a class="link-sec" href="#x50726f6772616d6d696e67204775696465">Programming Guide</a></i> section should be used to control the PIM processing in the kernel.<div class="subsection">
<h2 id="x50726f6772616d6d696e67204775696465">Programming Guide</h2> After a multicast routing socket is open and multicast forwarding is enabled in the kernel (see <a class="link-man" href="../html4/multicast.html">multicast(4)</a>), one of the following socket options should be used to enable or disable PIM processing in the kernel. Note that those options require certain privilege (i.e., root privilege):<div class="spacer">
</div>
<pre style="margin-left: 4.00ex;" class="lit display">
/* IPv4 */ 
int v = 1;        /* 1 to enable, or 0 to disable */ 
setsockopt(mrouter_s4, IPPROTO_IP, MRT_PIM, (void *)&amp;v, sizeof(v));</pre>
<div class="spacer">
</div>
<pre style="margin-left: 4.00ex;" class="lit display">
/* IPv6 */ 
int v = 1;        /* 1 to enable, or 0 to disable */ 
setsockopt(mrouter_s6, IPPROTO_IPV6, MRT6_PIM, (void *)&amp;v, sizeof(v));</pre>
<div class="spacer">
</div>
After PIM processing is enabled, the multicast-capable interfaces should be added (see <a class="link-man" href="../html4/multicast.html">multicast(4)</a>). For PIM-SM, the PIM-Register virtual interface must be added as well. This can be accomplished by using the following options:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
/* IPv4 */ 
struct vifctl vc; 
memset(&amp;vc, 0, sizeof(vc)); 
/* Assign all vifctl fields as appropriate */ 
... 
if (is_pim_register_vif) 
    vc.vifc_flags |= VIFF_REGISTER; 
setsockopt(mrouter_s4, IPPROTO_IP, MRT_ADD_VIF, (void *)&amp;vc, 
           sizeof(vc));</pre>
<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
/* IPv6 */ 
struct mif6ctl mc; 
memset(&amp;mc, 0, sizeof(mc)); 
/* Assign all mif6ctl fields as appropriate */ 
... 
if (is_pim_register_vif) 
    mc.mif6c_flags |= MIFF_REGISTER; 
setsockopt(mrouter_s6, IPPROTO_IPV6, MRT6_ADD_MIF, (void *)&amp;mc, 
           sizeof(mc));</pre>
<div class="spacer">
</div>
Sending or receiving of PIM packets can be accomplished by first opening a &#8220;raw socket&#8221; (see <a class="link-man" href="../html2/socket.html">socket(2)</a>), with protocol value of <span class="define">IPPROTO_PIM</span>:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
/* IPv4 */ 
int pim_s4; 
pim_s4 = socket(AF_INET, SOCK_RAW, IPPROTO_PIM);</pre>
<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
/* IPv6 */ 
int pim_s6; 
pim_s6 = socket(AF_INET6, SOCK_RAW, IPPROTO_PIM);</pre>
<div class="spacer">
</div>
Then the following system calls can be used to send or receive PIM packets: <a class="link-man" href="../html2/sendto.html">sendto(2)</a>, <a class="link-man" href="../html2/sendmsg.html">sendmsg(2)</a>, <a class="link-man" href="../html2/recvfrom.html">recvfrom(2)</a>, and <a class="link-man" href="../html2/recvmsg.html">recvmsg(2)</a>.</div>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html2/getsockopt.html">getsockopt(2)</a>, <a class="link-man" href="../html2/recvfrom.html">recvfrom(2)</a>, <a class="link-man" href="../html2/recvmsg.html">recvmsg(2)</a>, <a class="link-man" href="../html2/sendmsg.html">sendmsg(2)</a>, <a class="link-man" href="../html2/sendto.html">sendto(2)</a>, <a class="link-man" href="../html2/setsockopt.html">setsockopt(2)</a>, <a class="link-man" href="../html2/socket.html">socket(2)</a>, <a class="link-man" href="../html4/inet.html">inet(4)</a>, <a class="link-man" href="../html4/intro.html">intro(4)</a>, <a class="link-man" href="../html4/ip.html">ip(4)</a>, <a class="link-man" href="../html4/multicast.html">multicast(4)</a>, <a class="link-man" href="../html8/sysctl.html">sysctl(8)</a></div>
<div class="section">
<h1 id="x5354414e4441524453">STANDARDS</h1> <span class="ref"><span class="ref-auth">A. Adams</span>, <span class="ref-auth">J. Nicholas</span>, and <span class="ref-auth">W. Siadak</span>, <span class="ref-title">Protocol Independent Multicast &#8211; Dense Mode (PIM-DM): Protocol Specification (Revised)</span>, <span class="ref-rep">RFC 3973</span>, <span class="ref-date">January 2005</span>.</span><div class="spacer">
</div>
<span class="ref"><span class="ref-auth">B. Fenner</span>, <span class="ref-auth">M. Handley</span>, <span class="ref-auth">H. Holbrook</span>, and <span class="ref-auth">I. Kouvelas</span>, <span class="ref-title">Protocol Independent Multicast &#8211; Sparse Mode (PIM-SM): Protocol Specification (Revised)</span>, <span class="ref-rep">RFC 4601</span>, <span class="ref-date">August 2006</span>.</span><div class="spacer">
</div>
<span class="ref"><span class="ref-auth">N. Bhaskar</span>, <span class="ref-auth">A. Gall</span>, <span class="ref-auth">J. Lingard</span>, and <span class="ref-auth">S. Venaas</span>, <span class="ref-title">Bootstrap Router (BSR) Mechanism for Protocol Independent Multicast (PIM)</span>, <span class="ref-rep">RFC 5059</span>, <span class="ref-date">January 2008</span>.</span></div>
<div class="section">
<h1 id="x415554484f5253">AUTHORS</h1> The original IPv4 PIM kernel support for IRIX and SunOS-4.x was implemented by <span class="author">Ahmed Helmy</span> (USC and SGI). Later the code was ported to various <span class="unix">BSD</span> flavors and modified by <span class="author">George Edmond Eddy</span> (Rusty) (ISI), <span class="author">Hitoshi Asaeda</span> (WIDE Project), and <span class="author">Pavlin Radoslavov</span> (USC/ISI and ICSI).<div class="spacer">
</div>
The IPv6 PIM kernel support was implemented by the KAME project (<a class="link-ext" href="http://www.kame.net">http://www.kame.net</a>), and was based on the IPv4 PIM kernel support.<div class="spacer">
</div>
This manual page was written by <span class="author">Pavlin Radoslavov</span> (ICSI).</div>
</div>
</body>
</html>

