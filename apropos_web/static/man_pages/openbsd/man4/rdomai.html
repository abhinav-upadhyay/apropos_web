<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
RDOMAIN(4)</title>
</head>
<body>
<div class="mandoc">
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">rtable</b>, <b class="name">rdomain</b> &#8212; <span class="desc">routing tables and routing domains</span></div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The traditional kernel routing system had a single table for routes and allowed only non-conflicting IP address assignments. The <b class="name">rtable</b> feature allows multiple lookup tables for routes. The <b class="name">rdomain</b> feature provides a way to logically segment a router between network paths.<div class="subsection">
<h2 id="x526f7574696e67207461626c6573">Routing tables</h2> Each <b class="name">rtable</b> contains routes for outbound network packets. A routing domain can contain more than one <b class="name">rtable</b>. Multiple routing tables are commonly used for Policy Based Routing.<div class="spacer">
</div>
The highest ID that can be used for an <b class="name">rtable</b> is 255.</div>
<div class="subsection">
<h2 id="x526f7574696e6720646f6d61696e73">Routing domains</h2> Each <b class="name">rdomain</b> is a completely separate address space in the kernel. An IP address (e.g. 10.0.0.1/16) can be assigned in more than one <b class="name">rdomain</b>, but cannot be assigned more than once per <b class="name">rdomain</b>. An interface belongs to one and only one <b class="name">rdomain</b>. The interface's <b class="name">rdomain</b> determines which rdomain an incoming packet will be in. Virtual interfaces do not need to belong to the same <b class="name">rdomain</b> as the parent. Each <b class="name">rdomain</b> contains at least one routing table.<div class="spacer">
</div>
Network traffic within an <b class="name">rdomain</b> stays within the current routing domain. <a class="link-man" href="../html4/pf.html">pf(4)</a> is used to move traffic from one <b class="name">rdomain</b> to a different <b class="name">rdomain</b>.<div class="spacer">
</div>
When an interface is assigned to a non-existent <b class="name">rdomain</b> it gets created automatically. At the same time an <b class="name">rtable</b> with the same ID gets created and assigned to the new domain.<div class="spacer">
</div>
The highest ID that can be used for an <b class="name">rdomain</b> is 255.</div>
</div>
<div class="section">
<h1 id="x4558414d504c4553">EXAMPLES</h1> Set up em0 and lo4 onto rdomain 4:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
# ifconfig em0 rdomain 4 
# ifconfig lo4 rdomain 4 
# ifconfig lo4 inet 127.0.0.1/8 
# ifconfig em0 192.0.2.100/24</pre>
<div class="spacer">
</div>
Set a default route and localhost reject route within rdomain 4:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
# route -T4 -qn add -net 127 127.0.0.1 -reject 
# route -T4 -n add default 192.0.2.1</pre>
<div class="spacer">
</div>
Start an sshd in rdomain 4:<div class="spacer">
</div>
<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit"># route -T4 exec /usr/sbin/sshd</code></div>
</blockquote>
<div class="spacer">
</div>
Display to which rdomain processes are assigned:<div class="spacer">
</div>
<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit"># ps aux -o rtable</code></div>
</blockquote>
<div class="spacer">
</div>
pf.conf snippet to block incoming port 80, and nat-to and move to rtable 0 on interface em1:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
block in on rdomain 4 proto tcp to any port 80 
match out on rdomain 4 to !$internal_net nat-to (em1) rtable 0</pre>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html1/ps.html">ps(1)</a>, <a class="link-man" href="../html4/route.html">route(4)</a>, <a class="link-man" href="../html5/pf.conf.html">pf.conf(5)</a>, <a class="link-man" href="../html8/ifconfig.html">ifconfig(8)</a>, <a class="link-man" href="../html8/route.html">route(8)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> <span class="unix">OpenBSD</span> support for rdomains first appeared in <span class="unix">OpenBSD&#160;4.9</span> and IPv6 support first appeared in <span class="unix">OpenBSD&#160;5.5</span>.</div>
<div class="section">
<h1 id="x43415645415453">CAVEATS</h1> When an rtable already exists a new domain with the same ID cannot be created. Since there is no command to destroy an rtable a reboot is necessary.<div class="spacer">
</div>
No tool is available to assign more than one rtable to an rdomain other than to the default one (0).</div>
</div>
</body>
</html>

