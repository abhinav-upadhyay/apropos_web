<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
DISKLESS(8)</title>
</head>
<body>
<div class="mandoc">
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">diskless</b> &#8212; <span class="desc">booting a system over the network</span></div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The ability to boot a machine over the network is useful for <span class="emph">diskless</span> or <span class="emph">dataless</span> machines, or as a temporary measure while repairing or re-installing filesystems on a local disk. This file provides a general description of the interactions between a client and its server when a client is booting over the network. The general description is followed by specific instructions for configuring a server for diskless clients.<div class="spacer">
</div>
When booting a system over the network, there are three phases of interaction between client and server:<div class="spacer">
</div>
<ol style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-enum">
<li class="list-enum" style="margin-top: 0.00em;">
The PROM (or stage-1 bootstrap) loads a boot program.</li>
<li class="list-enum" style="margin-top: 0.00em;">
The boot program loads a kernel.</li>
<li class="list-enum" style="margin-top: 0.00em;">
The kernel does NFS mounts for root and swap.</li>
</ol>
<div class="spacer">
</div>
Each of these phases are described in further detail below.<div class="spacer">
</div>
In <span class="emph">phase 1</span>, the PROM loads a boot program. PROM designs vary widely, so this phase is inherently machine-specific. Sun and Motorola machines use RARP to determine the client's IP address and then use TFTP to download a boot program from whoever sent the RARP reply. HP 300-series machines use the HP Remote Maintenance Protocol to download a boot program. Other machines may load a network boot program either from diskette or using a special PROM on the network card.<div class="spacer">
</div>
In <span class="emph">phase 2</span>, the boot program loads a kernel. Operation in this phase depends on the design of the boot program. The procedure used by the boot program is as follows:<div class="spacer">
</div>
<ol style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-enum">
<li class="list-enum" style="margin-top: 0.00em;">
The boot program gets the client IP address using RARP.</li>
<li class="list-enum" style="margin-top: 0.00em;">
The boot program gets the client name and server IP address by broadcasting an RPC/BOOTPARAMS/WHOAMI request with the client IP address.</li>
<li class="list-enum" style="margin-top: 0.00em;">
The boot program gets the server path for this client's root using an RPC/BOOTPARAMS/GETFILE request with the client name.</li>
<li class="list-enum" style="margin-top: 0.00em;">
The boot program gets the root file handle by calling <a class="link-man" href="../html8/mountd.html">mountd(8)</a> with the server path for the client root.</li>
<li class="list-enum" style="margin-top: 0.00em;">
The boot program gets the kernel file handle by calling NFS lookup on the root file handle.</li>
<li class="list-enum" style="margin-top: 0.00em;">
The boot program loads the kernel using NFS read calls on the kernel file handle.</li>
<li class="list-enum" style="margin-top: 0.00em;">
The boot program transfers control to the kernel entry point.</li>
</ol>
<div class="spacer">
</div>
In <span class="emph">phase 3</span>, the kernel does NFS mounts for root and swap. The kernel repeats much of the work done by the boot program because there is no standard way for the boot program to pass the information it gathered on to the kernel. The procedure used by the kernel is as follows:<div class="spacer">
</div>
<ol style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-enum">
<li class="list-enum" style="margin-top: 0.00em;">
The kernel finds a boot server using the same procedure as described in steps 1 and 2 of phase 2, above.</li>
<li class="list-enum" style="margin-top: 0.00em;">
The kernel gets the NFS file handle for root using the same procedure as described in steps 3, 4, and 5 of phase 2, above.</li>
<li class="list-enum" style="margin-top: 0.00em;">
The kernel calls the NFS getattr function to get the last-modified time of the root directory, and uses it to check the system clock.</li>
<li class="list-enum" style="margin-top: 0.00em;">
If the kernel is configured for swap on NFS, it uses the same mechanism as for root, but uses the NFS getattr function to determine the size of the swap area.</li>
</ol>
<div class="spacer">
</div>
The <code class="none">INSTALL.</code>&#10216;<i class="arg">arch</i>&#10217; notes that come with each distribution also give details on the specifics of net/diskless booting for each architecture.<div class="spacer">
</div>
The procedures for AMD64 and i386 clients vary somewhat to the stages detailed above. See <a class="link-man" href="../html8/pxeboot.html">pxeboot(8)</a> for more detailed information.</div>
<div class="section">
<h1 id="x4558414d504c4553">EXAMPLES</h1> Before a client can boot over the network, its server must be configured correctly. This example will demonstrate how to configure a server and client.<div class="spacer">
</div>
Assuming the client's hostname is to be &quot;myclient&quot;:<ol style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-enum">
<li class="list-enum" style="margin-top: 1.00em;">
Add an entry to <i class="file">/etc/ethers</i> corresponding to the client's Ethernet address:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
8:0:20:7:c5:c7          myclient</pre>
<div class="spacer">
</div>
This will be used by <a class="link-man" href="../html8/rarpd.html">rarpd(8)</a>.</li>
<li class="list-enum" style="margin-top: 1.00em;">
Assign an IP address for myclient in <i class="file">/etc/hosts</i>:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
192.197.96.12           myclient</pre>
</li>
<li class="list-enum" style="margin-top: 1.00em;">
If booting an alpha, amd64, hppa, i386, sgi, sparc, or sparc64 client, ensure that <a class="link-man" href="../html8/tftpd.html">tftpd(8)</a> is configured to run in the directory <i class="file">/tftpboot</i>.<div class="spacer">
</div>
If booting an HP 300 or older HPPA machine, ensure that <i class="file">/etc/rbootd.conf</i> is configured properly to transfer the boot program to the client. An entry might look like this:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
08:00:09:01:23:E6	SYS_UBOOT	# myclient</pre>
<div class="spacer">
</div>
See the <a class="link-man" href="../html8/rbootd.html">rbootd(8)</a> manual page for more information.</li>
<li class="list-enum" style="margin-top: 1.00em;">
If booting a newer alpha, amd64, hppa, i386, sgi, sparc, or sparc64 client, install a copy of the appropriate diskless boot loader (such as <i class="file">boot.net</i> from the root directory of the <span class="unix">OpenBSD</span> sparc tree) in the <i class="file">/tftpboot</i> directory.<div class="spacer">
</div>
If booting a Motorola or Sun client, make a link such that the boot program is accessible as a file named after the client's IP address in hex. For example:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
# cd /tftpboot 
# ln -s boot.net C0C5600C</pre>
<div class="spacer">
</div>
The following example converts an IP address to hex:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
$ echo 192.197.96.12 | awk -F . \ 
	'{ printf &quot;%02X%02X%02X%02X\n&quot;, $1, $2, $3, $4 }'</pre>
<div class="spacer">
</div>
Sun Sparc machines also require a &#8220;.&#10216;<i class="arg">arch</i>&#10217;&#8221; suffix. So the filename in the example above for a Sun4 machine would be &#8220;C0C5600C.SUN4&#8221;. The name used is really architecture dependent: it simply has to match what the booting client's PROM wishes it to be. If the client's PROM fails to fetch the expected file, <a class="link-man" href="../html8/tcpdump.html">tcpdump(8)</a> can be used to discover which filename the client is trying to read.<div class="spacer">
</div>
Architectures using DHCP (newer alpha, amd64, hppa, i386, or sgi) should ensure that <a class="link-man" href="../html8/dhcpd.html">dhcpd(8)</a> is configured on the server to serve BOOTP protocol requests. An example entry in <a class="link-man" href="../html5/dhcpd.conf.html">dhcpd.conf(5)</a>:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
subnet 10.0.0.0 netmask 255.0.0.0 { 
	host myclient { 
		filename &quot;netboot&quot;; 
		option root-path &quot;/export/myclient/root&quot;; 
		hardware ethernet 00:02:56:00:73:31; 
		fixed-address 10.42.42.42; 
	} 
}</pre>
<div class="spacer">
</div>
Note that procedures for AMD64 and i386 clients vary somewhat. See <a class="link-man" href="../html8/pxeboot.html">pxeboot(8)</a> for more detailed information.<div class="spacer">
</div>
Architectures using the HP remote boot server (HP 300 or older HPPA) should ensure that the general purpose boot program is installed in the directory <i class="file">/usr/mdec/rbootd</i>.<div class="spacer">
</div>
Architectures using MOP (older Alpha) should follow the instructions in <a class="link-man" href="../html8/mopd.html">mopd(8)</a> for setting up a TFTP boot.</li>
<li class="list-enum" style="margin-top: 1.00em;">
Add myclient to the bootparams database <i class="file">/etc/bootparams</i>:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
myclient  root=server:/export/myclient/root \ 
          swap=server:/export/myclient/swap</pre>
<div class="spacer">
</div>
Note that some bootparam servers are somewhat sensitive. Some require fully qualified hostnames or partially qualified hostnames (which can be solved by having both fully and partially qualified entries). Other servers are case sensitive.</li>
<li class="list-enum" style="margin-top: 1.00em;">
Build the swap file for myclient:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
# mkdir -p /export/myclient/root/swap 
# cd /export/myclient 
# dd if=/dev/zero of=swap bs=1m count=120</pre>
<div class="spacer">
</div>
This creates a 120 Megabyte swap file and an empty /swap directory. A smaller swap file may be created if the boot is for maintenance (i.e. temporary) purposes only.</li>
<li class="list-enum" style="margin-top: 1.00em;">
Populate myclient's root filesystem on the server. How this is done depends on the client architecture and the version of the <span class="unix">OpenBSD</span> distribution. It can be as simple as copying and modifying the server's root filesystem, or perhaps the files can be taken from the standard binary distribution.</li>
<li class="list-enum" style="margin-top: 1.00em;">
Export the required filesystems in <i class="file">/etc/exports</i>:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
/usr -ro myclient 
/export/myclient -maproot=root -alldirs myclient</pre>
<div class="spacer">
</div>
If the server and client are of the same architecture, then the client can share the server's <i class="file">/usr</i> filesystem (as is done above). If not, a properly fleshed out <i class="file">/usr</i> partition will have to be built for the client in some other place.</li>
<li class="list-enum" style="margin-top: 1.00em;">
Copy and customize at least the following files in <i class="file">/export/myclient/root</i>:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
# cd /export/myclient/root/etc 
# cp /etc/fstab fstab 
# cp /etc/hosts hosts 
# echo myclient &gt; myname 
# echo inet 192.197.96.12 &gt; hostname.le0</pre>
<div class="spacer">
</div>
Note that &quot;le0&quot; above should be replaced with the name of the network interface that the client will use for booting.</li>
<li class="list-enum" style="margin-top: 1.00em;">
Correct at least the critical mount points in the client's <a class="link-man" href="../html5/fstab.html">fstab(5)</a> (which will be <i class="file">/export/myclient/root/etc/fstab</i>):<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
myserver:/export/myclient/root / nfs rw 0 0 
myserver:/export/myclient/swap none swap sw,nfsmntpt=/swap 
myserver:/export/myclient/root/usr /usr nfs rw,nodev 0 0 
myserver:/export/myclient/root/var /var nfs rw,nosuid,nodev 0 0</pre>
<div class="spacer">
</div>
The above example works even if <i class="file">/usr</i> and <i class="file">/var</i> are not on separate partitions. It allows them to be mounted with NFSv3, if the server allows it, and to specify per-partition mount options, such as &#8220;nodev&#8221;.<div class="spacer">
</div>
If the <i class="file">/usr</i> partition is to be shared between machines, as in the example <i class="file">/etc/exports</i> above, a more suitable entry might be:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
myserver:/usr /usr nfs ro 0 0</pre>
</li>
<li class="list-enum" style="margin-top: 1.00em;">
Make sure the correct processes are enabled on the server. See <a class="link-man" href="../html8/rc.conf.html">rc.conf(8)</a> for details of how to start these processes at boot.<div class="spacer">
</div>
For all clients: <a class="link-man" href="../html8/mountd.html">mountd(8)</a>, <a class="link-man" href="../html8/nfsd.html">nfsd(8)</a>, <a class="link-man" href="../html8/portmap.html">portmap(8)</a>, <a class="link-man" href="../html8/rarpd.html">rarpd(8)</a>, and <a class="link-man" href="../html8/rpc.bootparamd.html">rpc.bootparamd(8)</a>.<div class="spacer">
</div>
For alpha, amd64, hppa, i386, sgi, sparc, and sparc64 clients: <a class="link-man" href="../html8/tftpd.html">tftpd(8)</a><div class="spacer">
</div>
For HP 300 and older HPPA clients: <a class="link-man" href="../html8/rbootd.html">rbootd(8)</a><div class="spacer">
</div>
For newer alpha, amd64, hppa, i386, and sgi clients: <a class="link-man" href="../html8/dhcpd.html">dhcpd(8)</a><div class="spacer">
</div>
For older alpha clients: <a class="link-man" href="../html8/mopd.html">mopd(8)</a></li>
<li class="list-enum" style="margin-top: 1.00em;">
Net boot the client.</li>
</ol>
</div>
<div class="section">
<h1 id="x46494c4553">FILES</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/etc/bootparams</i></dt>
<dd class="list-tag" style="margin-left: 18.00ex;">
Client root and swap pathnames.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/etc/dhcpd.conf</i></dt>
<dd class="list-tag" style="margin-left: 18.00ex;">
DHCP daemon configuration file.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/etc/ethers</i></dt>
<dd class="list-tag" style="margin-left: 18.00ex;">
Ethernet addresses of known clients.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/etc/exports</i></dt>
<dd class="list-tag" style="margin-left: 18.00ex;">
Exported NFS mount points.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/etc/fstab</i></dt>
<dd class="list-tag" style="margin-left: 18.00ex;">
Static information about the filesystems.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/etc/hostname.$if</i></dt>
<dd class="list-tag" style="margin-left: 18.00ex;">
Interface-specific configuration file.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/etc/hosts</i></dt>
<dd class="list-tag" style="margin-left: 18.00ex;">
Host name database.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/etc/myname</i></dt>
<dd class="list-tag" style="margin-left: 18.00ex;">
Default hostname and gateway.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/etc/rbootd.conf</i></dt>
<dd class="list-tag" style="margin-left: 18.00ex;">
Configuration file for HP Remote Boot Daemon.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/tftpboot</i></dt>
<dd class="list-tag" style="margin-left: 18.00ex;">
Location of boot programs loaded by the Sun PROM.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/usr/mdec/rbootd</i></dt>
<dd class="list-tag" style="margin-left: 18.00ex;">
Location of boot programs loaded by the HP Boot ROM.</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html5/bootparams.html">bootparams(5)</a>, <a class="link-man" href="../html5/dhcpd.conf.html">dhcpd.conf(5)</a>, <a class="link-man" href="../html5/ethers.html">ethers(5)</a>, <a class="link-man" href="../html5/exports.html">exports(5)</a>, <a class="link-man" href="../html5/fstab.html">fstab(5)</a>, <a class="link-man" href="../html5/hostname.if.html">hostname.if(5)</a>, <a class="link-man" href="../html5/hosts.html">hosts(5)</a>, <a class="link-man" href="../html5/myname.html">myname(5)</a>, <a class="link-man" href="../html8/dhcpd.html">dhcpd(8)</a>, <a class="link-man" href="../html8/mopd.html">mopd(8)</a>, <a class="link-man" href="../html8/mountd.html">mountd(8)</a>, <a class="link-man" href="../html8/nfsd.html">nfsd(8)</a>, <a class="link-man" href="../html8/portmap.html">portmap(8)</a>, <a class="link-man" href="../html8/pxeboot.html">pxeboot(8)</a>, <a class="link-man" href="../html8/rarpd.html">rarpd(8)</a>, <a class="link-man" href="../html8/rbootd.html">rbootd(8)</a>, <a class="link-man" href="../html8/rpc.bootparamd.html">rpc.bootparamd(8)</a>, <a class="link-man" href="../html8/tcpdump.html">tcpdump(8)</a>, <a class="link-man" href="../html8/tftpd.html">tftpd(8)</a></div>
</div>
</body>
</html>

