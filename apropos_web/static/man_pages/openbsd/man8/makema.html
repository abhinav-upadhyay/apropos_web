<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
MAKEMAP(8)</title>
</head>
<body>
<div class="mandoc">
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">makemap</b> &#8212; <span class="desc">create database maps for smtpd</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1><table class="synopsis">
<col style="width: 7.00ex;"/>
<col/>
<tbody>
<tr>
<td>
makemap</td>
<td>
[<span class="opt"><b class="flag">-U</b></span>] [<span class="opt"><b class="flag">-d</b> <i class="arg">dbtype</i></span>] [<span class="opt"><b class="flag">-o</b> <i class="arg">dbfile</i></span>] [<span class="opt"><b class="flag">-t</b> <i class="arg">type</i></span>] <i class="arg">file</i></td>
</tr>
</tbody>
</table>
</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> Maps provide a generic interface for associating textual key to a value. Such associations may be accessed through a plaintext file, database, or DNS. The format of these file types is described below. <b class="name">makemap</b> itself creates the database maps used by keyed map lookups specified in <a class="link-man" href="../html5/smtpd.conf.html">smtpd.conf(5)</a>.<div class="spacer">
</div>
<b class="name">makemap</b> reads input from <i class="arg">file</i> and writes data to a file whose name is made by adding a &#8220;.db&#8221; suffix to <i class="arg">file</i>. The current line can be extended over multiple lines using a backslash (&#8216;\&#8217;). Comments can be put anywhere in the file using a hash mark (&#8216;#&#8217;), and extend to the end of the current line. Care should be taken when commenting out multi-line text: the comment is effective until the end of the entire block. In all cases, <b class="name">makemap</b> reads lines consisting of words separated by whitespace. The first word of a line is the database key; the remainder represents the mapped value. The database key and value may optionally be separated by the colon character.<div class="spacer">
</div>
The options are as follows:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-d</b> <i class="arg">dbtype</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Specify the format of the database. Available formats are <i class="arg">hash</i> and <i class="arg">btree</i>. The default value is <i class="arg">hash</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-o</b> <i class="arg">dbfile</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Write the generated database to <i class="arg">dbfile</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-t</b> <i class="arg">type</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Specify the format of the resulting map file. The default map format is suitable for storing simple, unstructured, key-to-value string associations. However, if the mapped value has special meaning, as in the case of the virtual domains file, a suitable <i class="arg">type</i> must be provided. The available output types are:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">aliases</b></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
The mapped value is a comma-separated list of mail destinations. This format can be used for building user aliases and user mappings for virtual domain files.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">set</b></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
There is no mapped value &#8211; a map of this type will only allow for the lookup of keys. This format can be used for building primary domain maps.</dd>
</dl>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-U</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Instead of generating a database map from text input, dump the contents of a database map as text with the key and value separated with a tab.</dd>
</dl>
</div>
<div class="section">
<h1 id="x5052494d41525920444f4d41494e53">PRIMARY DOMAINS</h1> Primary domains can be kept in tables. To create a primary domain table, add each primary domain on a single line by itself.<div class="spacer">
</div>
In addition to adding an entry to the primary domain map, one must add a filter rule that accepts mail for the domain map, for example:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
table domains &quot;/etc/mail/domains&quot; 
accept for domain &lt;domains&gt; deliver to mbox</pre>
</div>
<div class="section">
<h1 id="x5649525455414c20444f4d41494e53">VIRTUAL DOMAINS</h1> Virtual domains may also be kept in tables. To create a virtual domain table, add each virtual domain on a single line by itself.<div class="spacer">
</div>
Virtual domains expect a mapping of virtual users to real users in order to determine if a recipient is accepted or not. The mapping format is an extension to <a class="link-man" href="../html5/aliases.html">aliases(5)</a>, which allows the use of &#8220;user@domain.tld&#8221; to accept user only on the specified domain, &#8220;user&#8221; to accept the user for any of the virtual domains, &#8220;@domain.tld&#8221; to provide a catch-all for the specified domain and &#8220;@&#8221; to provide a global catch-all for all domains. <a class="link-man" href="../html8/smtpd.html">smtpd(8)</a> will perform the lookups in that specific order.<div class="spacer">
</div>
To create single virtual address, add &#8220;user@example.com user&#8221; to the users map. To handle all mail destined to any user at example.com, add &#8220;@example.com user&#8221; to the virtual map.<div class="spacer">
</div>
In addition to adding an entry to the virtual map, one must add a filter rule that accepts mail for virtual domains, for example:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
table vdomains &quot;/etc/mail/vdomains&quot; 
table vusers &quot;/etc/mail/users&quot; 
 
accept for domain &lt;vdomains&gt; virtual &lt;vusers&gt; deliver to mbox 
accept for domain example.org virtual &lt;vusers&gt; deliver to mbox</pre>
</div>
<div class="section">
<h1 id="x46494c4553">FILES</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/etc/mail/aliases</i></dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
List of user mail aliases.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/etc/mail/secrets</i></dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
List of remote host credentials.</dd>
</dl>
</div>
<div class="section">
<h1 id="x4558495420535441545553">EXIT STATUS</h1> The <b class="utility">makemap</b> utility exits&#160;0 on success, and&#160;&gt;0 if an error occurs.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html5/aliases.html">aliases(5)</a>, <a class="link-man" href="../html5/smtpd.conf.html">smtpd.conf(5)</a>, <a class="link-man" href="../html5/table.html">table(5)</a>, <a class="link-man" href="../html8/newaliases.html">newaliases(8)</a>, <a class="link-man" href="../html8/smtpd.html">smtpd(8)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="name">makemap</b> command first appeared in <span class="unix">OpenBSD&#160;4.6</span> as a replacement for the equivalent command shipped with sendmail.</div>
</div>
</body>
</html>

