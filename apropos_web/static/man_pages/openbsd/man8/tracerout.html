<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
TRACEROUTE(8)</title>
</head>
<body>
<div class="mandoc">
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">traceroute</b>, <b class="name">traceroute6</b> &#8212; <span class="desc">print the route packets take to network host</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1><table class="synopsis">
<col style="width: 10.00ex;"/>
<col/>
<tbody>
<tr>
<td>
traceroute&#160;</td>
<td>
[<span class="opt"><b class="flag">-AcDdIlnSvx</b></span>] [<span class="opt"><b class="flag">-f</b> <i class="arg">first_ttl</i></span>] [<span class="opt"><b class="flag">-g</b> <i class="arg">gateway_addr</i></span>] [<span class="opt"><b class="flag">-m</b> <i class="arg">max_ttl</i></span>] [<span class="opt"><b class="flag">-P</b> <i class="arg">proto</i></span>] [<span class="opt"><b class="flag">-p</b> <i class="arg">port</i></span>] [<span class="opt"><b class="flag">-q</b> <i class="arg">nqueries</i></span>] [<span class="opt"><b class="flag">-s</b> <i class="arg">src_addr</i></span>] [<span class="opt"><b class="flag">-t</b> <i class="arg">toskeyword</i></span>] [<span class="opt"><b class="flag">-V</b> <i class="arg">rtable</i></span>] [<span class="opt"><b class="flag">-w</b> <i class="arg">waittime</i></span>] <i class="arg">host</i> [<span class="opt"><i class="arg">datalen</i></span>]</td>
</tr>
</tbody>
</table>
<br/>
<table class="synopsis">
<col style="width: 10.00ex;"/>
<col/>
<tbody>
<tr>
<td>
traceroute6</td>
<td>
[<span class="opt"><b class="flag">-AcDdIlnSv</b></span>] [<span class="opt"><b class="flag">-f</b> <i class="arg">first_hop</i></span>] [<span class="opt"><b class="flag">-m</b> <i class="arg">max_hop</i></span>] [<span class="opt"><b class="flag">-p</b> <i class="arg">port</i></span>] [<span class="opt"><b class="flag">-q</b> <i class="arg">nqueries</i></span>] [<span class="opt"><b class="flag">-s</b> <i class="arg">src_addr</i></span>] [<span class="opt"><b class="flag">-V</b> <i class="arg">rtable</i></span>] [<span class="opt"><b class="flag">-w</b> <i class="arg">waittime</i></span>] <i class="arg">host</i> [<span class="opt"><i class="arg">datalen</i></span>]</td>
</tr>
</tbody>
</table>
</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The Internet is a large and complex aggregation of network hardware, connected together by gateways. Tracking the route packets follow (or finding the miscreant gateway that's discarding packets) can be difficult. <b class="name">traceroute</b> utilizes the IPv4 protocol time to live (TTL) field and attempts to elicit an ICMP <span class="define">TIME_EXCEEDED</span> response from each gateway along the path to some host. <b class="name">traceroute6</b> does the same for the IPv6 protocol, instead using hop limits and ICMPv6 <span class="define">TIME_EXCEEDED</span> responses.<div class="spacer">
</div>
The only mandatory parameter is the destination host name or IP number. The default probe datagram length is 40 bytes for IPv4 UDP and 60 bytes for ICMP, IPv6 UDP and ICMP6. This may be increased by <i class="arg">datalen</i> bytes.<div class="spacer">
</div>
The options are as follows:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-A</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Look up the AS number for each hop address. Uses the DNS service described at <a class="link-ext" href="http://www.team-cymru.org/Services/ip-to-asn.html">http://www.team-cymru.org/Services/ip-to-asn.html</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-c</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Do not increment the destination port number in successive UDP packets. Rather, all UDP packets will have the same destination port, as set via the <b class="flag">-p</b> flag (or 33434 if none is specified).</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-D</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Dump the packet data to standard error before transmitting it.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-d</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Turn on socket-level debugging.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-f</b> <i class="arg">first_ttl</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Set the first TTL or hop limit used in outgoing probe packets. The effect is that the first first_ttl - 1 hosts will be skipped in the output of <b class="name">traceroute</b>. The default value is 1 (skip no hosts).</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-g</b> <i class="arg">gateway_addr</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Add <i class="arg">gateway_addr</i> to the list of addresses in the IP Loose Source Record Route (LSRR) option. If no gateways are specified, the LSRR option is omitted. This option is not available for IPv6.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-I</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Use ICMP or ICMP6 ECHO instead of UDP datagrams.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-l</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Display the TTL or hop limit value of the returned packet. This is useful for checking for asymmetric routing.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-m</b> <i class="arg">max_ttl</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Set the maximum TTL or hop limit. The default is the value of the system's <b class="flag">net.inet.ip.ttl</b> or <b class="flag">net.inet6.ip6.hlim</b> MIB variable, which defaults to 64.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-n</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Print hop addresses numerically rather than symbolically and numerically (saves a nameserver address-to-name lookup for each gateway found on the path).</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-P</b> <i class="arg">proto</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Change the protocol being used from UDP to a numeric protocol or a name as specified in <i class="file">/etc/protocols</i>. This will not work reliably for most protocols. If set to 1 (ICMP), then ICMP Echo Request messages will be used (same as <a class="link-man" href="../html8/ping.html">ping(8)</a>). This option is not available for IPv6.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-p</b> <i class="arg">port</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Set the base UDP <i class="arg">port</i> number used in probes (default is 33434). <b class="name">traceroute</b> hopes that nothing is listening on UDP ports <span class="emph">base</span> to <span class="emph">base+nhops*nqueries-1</span> at the destination host (so an ICMP <span class="define">PORT_UNREACHABLE</span> message will be returned to terminate the route tracing). If something is listening on a port in the default range, this option can be used to pick an unused port range.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-q</b> <i class="arg">nqueries</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Set the number of probes per TTL to <i class="arg">nqueries</i> (default is three probes).</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-S</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Print how many probes were not answered for each hop.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-s</b> <i class="arg">src_addr</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Use the following IP address (which must be given as an IP number, not a hostname) as the source address in outgoing probe packets. On hosts with more than one IP address, this option can be used to force the source address to be something other than the IP address of the interface the probe packet is sent on. If the IP address is not one of this machine's interface addresses and the user is not the superuser, an error is returned and nothing is sent.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-t</b> <i class="arg">toskeyword</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Set the <span class="emph">type-of-service</span> in probe packets to the following value (default zero). The value may be one of <i class="arg">critical</i>, <i class="arg">inetcontrol</i>, <i class="arg">lowdelay</i>, <i class="arg">netcontrol</i>, <i class="arg">throughput</i>, <i class="arg">reliability</i>, or one of the DiffServ Code Points: <i class="arg">ef</i>, <i class="arg">af11 ... af43</i>, <i class="arg">cs0 ... cs7</i>; or a number in either hex or decimal. This option can be used to see if different types-of-service result in different paths. If this option is used, changes to the type-of-service in the returned packets are displayed. (If you are not running a <span class="unix">4.3BSD-Tahoe</span> or later system, this may be academic since the normal network services like telnet and ftp don't let you control the <span class="define">TOS</span>). Not all values of <span class="define">TOS</span> are legal or meaningful - see the IP spec for definitions. Useful values are probably <i class="arg">lowdelay</i> and <i class="arg">throughput</i>. This option is not available for IPv6.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-V</b> <i class="arg">rtable</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Set the routing table to be used.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-v</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Verbose output. Received ICMP packets other than <span class="define">TIME_EXCEEDED</span> and <span class="define">UNREACHABLE</span>s are listed.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-w</b> <i class="arg">waittime</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Set the time (in seconds) to wait for a response to a probe (default 5).</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-x</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Print the ICMP extended headers if available. This option is not available for IPv6.</dd>
</dl>
<div class="spacer">
</div>
This program attempts to trace the route an IP packet would follow to some internet host by launching UDP probe packets with a small TTL then listening for an ICMP &quot;time exceeded&quot; reply from a gateway. We start out probes with a TTL of one and increase by one until we get an ICMP &quot;port unreachable&quot; (which means we got to &quot;host&quot;) or hit a max (which defaults to 64 hops and can be changed with the <b class="flag">-m</b> flag). Three probes (changed with <b class="flag">-q</b> flag) are sent at each TTL setting and a line is printed showing the TTL, address of the gateway and round trip time of each probe. If the probe answers come from different gateways, the address of each responding system will be printed. If there is no response within a 5 second timeout interval (changed with the <b class="flag">-w</b> flag), a &quot;*&quot; is printed for that probe.<div class="spacer">
</div>
We don't want the destination host to process the UDP probe packets so the destination port is set to an unlikely value (if some clod on the destination is using that value, it can be changed with the <b class="flag">-p</b> flag).<div class="spacer">
</div>
A sample use and output might be:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
$ traceroute nis.nsf.net. 
traceroute to nis.nsf.net (35.1.1.48), 64 hops max, 56 byte packet 
1  helios.ee.lbl.gov (128.3.112.1)  19 ms  19 ms  0 ms 
2  lilac-dmc.Berkeley.EDU (128.32.216.1)  39 ms  39 ms  19 ms 
3  lilac-dmc.Berkeley.EDU (128.32.216.1)  39 ms  39 ms  19 ms 
4  ccngw-ner-cc.Berkeley.EDU (128.32.136.23)  39 ms  40 ms  39 ms 
5  ccn-nerif22.Berkeley.EDU (128.32.168.22)  39 ms  39 ms  39 ms 
6  128.32.197.4 (128.32.197.4)  40 ms  59 ms  59 ms 
7  131.119.2.5 (131.119.2.5)  59 ms  59 ms  59 ms 
8  129.140.70.13 (129.140.70.13)  99 ms  99 ms  80 ms 
9  129.140.71.6 (129.140.71.6)  139 ms  239 ms  319 ms 
10  129.140.81.7 (129.140.81.7)  220 ms  199 ms  199 ms 
11  nic.merit.edu (35.1.1.48)  239 ms  239 ms  239 ms</pre>
<div class="spacer">
</div>
Note that lines 2 &amp; 3 are the same. This is due to a buggy kernel on the 2nd hop system - lbl-csam.arpa - that forwards packets with a zero TTL (a bug in the distributed version of <span class="unix">4.3BSD</span>). Note that you have to guess what path the packets are taking cross-country since the NSFNET (129.140) doesn't supply address-to-name translations for its NSSes.<div class="spacer">
</div>
A more interesting example is:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
$ traceroute allspice.lcs.mit.edu. 
traceroute to allspice.lcs.mit.edu (18.26.0.115), 64 hops max 
1  helios.ee.lbl.gov (128.3.112.1)  0 ms  0 ms  0 ms 
2  lilac-dmc.Berkeley.EDU (128.32.216.1)  19 ms  19 ms  19 ms 
3  lilac-dmc.Berkeley.EDU (128.32.216.1)  39 ms  19 ms  19 ms 
4  ccngw-ner-cc.Berkeley.EDU (128.32.136.23)  19 ms  39 ms  39 ms 
5  ccn-nerif22.Berkeley.EDU (128.32.168.22)  20 ms  39 ms  39 ms 
6  128.32.197.4 (128.32.197.4)  59 ms  119 ms  39 ms 
7  131.119.2.5 (131.119.2.5)  59 ms  59 ms  39 ms 
8  129.140.70.13 (129.140.70.13)  80 ms  79 ms  99 ms 
9  129.140.71.6 (129.140.71.6)  139 ms  139 ms  159 ms 
10  129.140.81.7 (129.140.81.7)  199 ms  180 ms  300 ms 
11  129.140.72.17 (129.140.72.17)  300 ms  239 ms  239 ms 
12  * * * 
13  128.121.54.72 (128.121.54.72)  259 ms  499 ms  279 ms 
14  * * * 
15  * * * 
16  * * * 
17  * * * 
18  ALLSPICE.LCS.MIT.EDU (18.26.0.115)  339 ms  279 ms  279 ms</pre>
<div class="spacer">
</div>
Note that the gateways 12, 14, 15, 16 &amp; 17 hops away either don't send ICMP &quot;time exceeded&quot; messages or send them with a TTL too small to reach us. 14 - 17 are running the MIT C Gateway code that doesn't send &quot;time exceeded&quot;s. God only knows what's going on with 12.<div class="spacer">
</div>
The silent gateway 12 in the above may be the result of a bug in the 4.[23] <span class="unix">BSD</span> network code (and its derivatives):  4.x (x &lt;= 3) sends an unreachable message using whatever TTL remains in the original datagram. Since, for gateways, the remaining TTL is zero, the ICMP &quot;time exceeded&quot; is guaranteed to not make it back to us. The behavior of this bug is slightly more interesting when it appears on the destination system:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
1  helios.ee.lbl.gov (128.3.112.1)  0 ms  0 ms  0 ms 
2  lilac-dmc.Berkeley.EDU (128.32.216.1)  39 ms  19 ms  39 ms 
3  lilac-dmc.Berkeley.EDU (128.32.216.1)  19 ms  39 ms  19 ms 
4  ccngw-ner-cc.Berkeley.EDU (128.32.136.23)  39 ms  40 ms  19 ms 
5  ccn-nerif35.Berkeley.EDU (128.32.168.35)  39 ms  39 ms  39 ms 
6  csgw.Berkeley.EDU (128.32.133.254)  39 ms  59 ms  39 ms 
7  * * * 
8  * * * 
9  * * * 
10  * * * 
11  * * * 
12  * * * 
13  rip.Berkeley.EDU (128.32.131.22)  59 ms !  39 ms !  39 ms !</pre>
<div class="spacer">
</div>
Notice that there are 12 &quot;gateways&quot; (13 is the final destination) and exactly the last half of them are &quot;missing&quot;. What's really happening is that rip (a Sun-3 running Sun OS3.5) is using the TTL from our arriving datagram as the TTL in its ICMP reply. So, the reply will time out on the return path (with no notice sent to anyone since ICMPs aren't sent for ICMPs) until we probe with a TTL that's at least twice the path length. That is, rip is really only 7 hops away. A reply that returns with a TTL of 1 is a clue this problem exists. <b class="name">traceroute</b> prints a &quot;!&quot; after the time if the TTL is &lt;= 1. Since vendors ship a lot of obsolete (DEC's Ultrix, Sun 3.x) or non-standard (HP-UX) software, expect to see this problem frequently and/or take care picking the target host of your probes.<div class="spacer">
</div>
Other possible annotations after the time are <span class="symb">!H</span>, <span class="symb">!N</span>, <span class="symb">!P</span> (got a host, network or protocol unreachable, respectively), <span class="symb">!A</span>, <span class="symb">!C</span> (access to the network or host, respectively, is prohibited), <span class="symb">!X</span> (communication administratively prohibited by filtering), <span class="symb">!S</span> or <span class="symb">!F</span> (source route failed or fragmentation needed - neither of these should ever occur and the associated gateway is busted if you see one), <span class="symb">!U</span> (destination network or host unknown), <span class="symb">!T</span> (destination network or host unreachable for TOS), <span class="symb">!&lt;code&gt;</span> (other ICMP unreachable code). <span class="symb">TOS=xxx!</span> (TOS bit in returned packet differs from last hop). If almost all the probes result in some kind of unreachable, <b class="name">traceroute</b> will give up and exit.<div class="spacer">
</div>
<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit">$ traceroute -g 10.3.0.5 128.182.0.0</code></div>
</blockquote>
<div class="spacer">
</div>
will show the path from the Cambridge Mailbridge to PSC, while<div class="spacer">
</div>
<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit">$ traceroute -g 192.5.146.4 -g 10.3.0.5 35.0.0.0</code></div>
</blockquote>
<div class="spacer">
</div>
will show the path from the Cambridge Mailbridge to Merit, using PSC to reach the Mailbridge.<div class="spacer">
</div>
This program is intended for use in network testing, measurement and management. It should be used primarily for manual fault isolation. Because of the load it could impose on the network, it is unwise to use <b class="name">traceroute</b> during normal operations or from automated scripts.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html1/netstat.html">netstat(1)</a>, <a class="link-man" href="../html8/ping.html">ping(8)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The very first <b class="name">traceroute</b> (never released) used ICMP ECHO_REQUEST datagrams as probe packets. During the first night of testing it was discovered that more than half the router vendors of the time would not return an ICMP TIME_EXCEEDED for an ECHO_REQUEST. <b class="name">traceroute</b> was then changed to use UDP probe packets. Most modern TCP/IP implementations will now generate an ICMP error message to ICMP query messages, and the option to use ECHO_REQUEST probes was re-implemented.<div class="spacer">
</div>
The <b class="name">traceroute</b> command first appeared in <span class="unix">4.4BSD</span>. The <b class="name">traceroute6</b> command first appeared in the WIDE Hydrangea IPv6 protocol stack kit.</div>
<div class="section">
<h1 id="x415554484f5253">AUTHORS</h1> Implemented by <span class="author">Van Jacobson</span> from a suggestion by <span class="author">Steve Deering</span>. Debugged by a cast of thousands with particularly cogent suggestions or fixes from <span class="author">C. Philip Wood</span>, <span class="author">Tim Seaver</span>, and <span class="author">Ken Adelman</span>.</div>
</div>
</body>
</html>

