<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
CRUNCHGEN(8)</title>
</head>
<body>
<div class="mandoc">
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">crunchgen</b> &#8212; <span class="desc">generates build environment for a crunched binary</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1><table class="synopsis">
<col style="width: 9.00ex;"/>
<col/>
<tbody>
<tr>
<td>
crunchgen</td>
<td>
[<span class="opt"><b class="flag">-EfMq</b></span>] [<span class="opt"><b class="flag">-c</b>&#160;<i class="arg">c-file-name</i></span>] [<span class="opt"><b class="flag">-D</b>&#160;<i class="arg">src-root</i></span>] [<span class="opt"><b class="flag">-e</b>&#160;<i class="arg">exec-file-name</i></span>] [<span class="opt"><b class="flag">-L</b>&#160;<i class="arg">lib-dir</i></span>] [<span class="opt"><b class="flag">-m</b>&#160;<i class="arg">makefile-name</i></span>] [<span class="opt"><b class="flag">-O</b>&#160;<i class="arg">objdir-name</i></span>]&#160;<i class="arg">conf-file</i></td>
</tr>
</tbody>
</table>
<br/>
<table class="synopsis">
<col style="width: 9.00ex;"/>
<col/>
<tbody>
<tr>
<td>
crunchgen</td>
<td>
<b class="flag">-h</b> [<span class="opt"><b class="flag">-f</b> <i class="arg">keep-list-file</i></span>] [<span class="opt"><b class="flag">-k</b> <i class="arg">keep-symbol</i></span>] <i class="arg">object-file ...</i></td>
</tr>
</tbody>
</table>
</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> A crunched binary is a program made up of many other programs linked together into a single executable. The crunched binary main() function determines which component program to run by the contents of argv[0]. The main reason to crunch programs together is for fitting as many programs as possible onto an installation or system recovery floppy.<div class="spacer">
</div>
<b class="name">crunchgen</b> reads in the specifications in <i class="arg">conf-file</i> for a crunched binary, and generates a Makefile and accompanying top-level C source file that when built create the crunched executable file from the component programs. For each component program, <b class="name">crunchgen</b> can optionally attempt to determine the object (.o) files that make up the program from its source directory Makefile. This information is cached in a file named <i class="file">&lt;conf-name&gt;.cache</i> between runs.<div class="spacer">
</div>
<b class="name">crunchgen</b> is later run again with the <b class="flag">-h</b> flag to eliminate link-time conflicts between the component programs by hiding all unnecessary symbols. Some symbols may be left visible via the <b class="flag">-k</b> <i class="arg">keep-symbol</i> and <b class="flag">-f</b> <i class="arg">keep-list-file</i> options. The <i class="arg">keep-list-file</i> must contain a list of symbols to keep visible, one symbol per line. Note that the C compiler prepends an underscore in front of symbols, so to keep the C function &#8220;foo&#8221; visible, the option &#8220;-k _foo&#8221; must be used.<div class="spacer">
</div>
After <b class="name">crunchgen</b> is run, the crunched binary can be built by running &#8220;make -f &lt;conf-name&gt;.mk&#8221;. The component programs' object files must already be built. An &#8220;objs&#8221; target, included in the output makefile, will run make in each component program's source dir to build the object files for the user. This is not done automatically since in release engineering circumstances it is generally not desirable to be modifying objects in other directories.<div class="spacer">
</div>
The options are as follows:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-c</b> <i class="arg">c-file-name</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Set output C file name to <i class="arg">c-file-name</i>. The default name is &#8220;&#10216;conf-name&#10217;.c&#8221;.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-D</b> <i class="arg">src-root</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Assume that relative source directory specifications begin with <i class="arg">src-root</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-E</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Don't prepend stub names with an underscore. Used for architectures that don't have underscore prepended to symbol names, such as ELF architectures.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-e</b> <i class="arg">exec-file-name</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Set crunched binary executable file name to <i class="arg">exec-file-name</i>. The default name is &#8220;&#10216;conf-name&#10217;&#8221;.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-f</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Flush cache. Forces the recalculation of cached parameters.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-h</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Hide all unnecessary symbols. Note that this is done on some ELF architectures by marking the symbol local, while the <b class="flag">-M</b> option causes it to mangle the symbol name to hide the symbol. It is therefore not advisable to try to run <a class="link-man" href="../html1/nm.html">nm(1)</a> on a crunched object file. This is due to the nature of the ELF symbol table and how some architectures use the symbol attributes for their GOT build.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-L</b> <i class="arg">lib-dir</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Try to obtain libraries from <i class="arg">lib-dir</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-M</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
On ELF architectures mangle the symbol instead of marking it global; necessary for some architectures due to GOT usage.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-m</b> <i class="arg">makefile-name</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Set output Makefile name to <i class="arg">makefile-name</i>. The default name is &#8220;&#10216;conf-name&#10217;.mk&#8221;.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-O</b> <i class="arg">objdir-name</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Specify an object directory to use. It defaults to &#8220;obj&#8221;, though for cross building purposes it can be used to specify obj.${HOST}.${MACHINE}. Normally used with the make variable ${MAKEOBJDIR}.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-q</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Quiet operation. Status messages are suppressed.</dd>
</dl>
</div>
<div class="section">
<h1 id="x4352554e434847454e20434f4e46494755524154494f4e2046494c4520434f4d4d414e4453">CRUNCHGEN CONFIGURATION FILE COMMANDS</h1> <b class="name">crunchgen</b> reads specifications from the <i class="arg">conf-file</i> that describe the components of the crunched binary. In its simplest use, the component program names are merely listed along with the top-level source directories in which their sources can be found. <b class="name">crunchgen</b> then calculates (via the source makefiles) and caches the list of object files and their locations. For more specialized situations, the user can specify by hand all the parameters that <b class="name">crunchgen</b> needs.<div class="spacer">
</div>
The <i class="arg">conf-file</i> commands are as follows:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
srcdirs <i class="arg">dirname ...</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
A list of source trees in which the source directories of the component programs can be found. These dirs are searched using the <span class="unix">BSD</span> &#8220;&lt;source-dir&gt;/&lt;progname&gt;/&#8221; convention. Multiple srcdirs lines can be specified. The directories are searched in the order they are given.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
libdirs <i class="arg">dirname</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
A list of source trees in which the source directories for supplementary libraries can be found.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
progs <i class="arg">progname ...</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
A list of programs that make up the crunched binary. Multiple progs lines can be specified.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
libs <i class="arg">libspec ...</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
A list of library specifications to be included in the crunched binary link. Multiple libs lines can be specified.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
ln <i class="arg">progname linkname</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Causes the crunched binary to invoke <i class="arg">progname</i> whenever <i class="arg">linkname</i> appears in argv[0]. This allows programs that change their behavior when run under different names to operate correctly.</dd>
</dl>
<div class="spacer">
</div>
To handle specialized situations, such as when the source is not available or not built via a conventional Makefile, the following <b class="cmd">special</b> commands can be used to set <b class="name">crunchgen</b> parameters for a component program.<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
special <i class="arg">progname</i> <code class="none">srcdir</code> <i class="arg">pathname</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Set the source directory for <i class="arg">progname</i>. This is normally calculated by searching the specified srcdirs for a directory named <i class="arg">progname</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
special <i class="arg">progname</i> <code class="none">objdir</code> <i class="arg">pathname</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Set the obj directory for <i class="arg">progname</i>. This is normally calculated by looking for a directory named &#8220;obj&#8221; under the <i class="arg">srcdir</i>, and if that is not found, the <i class="arg">srcdir</i> itself becomes the objdir.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
special <i class="arg">progname</i> <code class="none">objs</code> <i class="arg">object-file-name ...</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Set the list of object files for program <i class="arg">progname</i>. This is normally calculated by constructing a temporary makefile that includes &#8220;srcdir/Makefile&#8221; and outputs the value of $(OBJS).</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
special <i class="arg">progname</i> <code class="none">objpaths</code> <i class="arg">full-pathname-to-object-file ...</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Sets the pathnames of the object files for program <i class="arg">progname</i>. This is normally calculated by prepending the objdir pathname to each file in the objs list.</dd>
</dl>
<div class="spacer">
</div>
Only the objpaths parameter is actually needed by <b class="name">crunchgen</b>, but it is calculated from objdir and objs, which are in turn calculated from srcdir, so it is sometimes convenient to specify the earlier parameters and let <b class="name">crunchgen</b> calculate forward from there if it can.<div class="spacer">
</div>
The makefile produced by <b class="name">crunchgen</b> contains an optional <i class="arg">objs</i> target that will build the object files for each component program by running make inside that program's source directory. For this to work the srcdir and objs parameters must also be valid. If they are not valid for a particular program, that program is skipped in the <i class="arg">objs</i> target.</div>
<div class="section">
<h1 id="x4558414d504c4553">EXAMPLES</h1> Here is an example <b class="name">crunchgen</b> input conf file, named <i class="file">kcopy.conf</i>:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
srcdirs /usr/src/bin /usr/src/sbin 
 
progs test cp echo sh fsck halt init mount umount myinstall 
ln test [       # test can be invoked via [ 
ln sh -sh       # init invokes the shell with &quot;-sh&quot; in argv[0] 
 
special myprog objpaths /homes/leroy/src/myinstall.o # no sources 
 
libs -lutil -lcrypt</pre>
<div class="spacer">
</div>
This conf file specifies a small crunched binary consisting of some basic system utilities plus a home-grown install program &#8220;myinstall&#8221;, for which no source directory is specified, but its object file is specified directly with the <b class="cmd">special</b> line.<div class="spacer">
</div>
The crunched binary &#8220;kcopy&#8221; can be built as follows:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
% crunchgen -m Makefile kcopy.conf    # gen Makefile and kcopy.c 
% make objs		# build the component programs' .o files 
% make			# build the crunched binary kcopy 
% kcopy sh		# test that this invokes a sh shell 
$			# it works!</pre>
<div class="spacer">
</div>
At this point the binary &#8220;kcopy&#8221; can be copied onto an install floppy and hard-linked to the names of the component programs.</div>
<div class="section">
<h1 id="x415554484f5253">AUTHORS</h1> <b class="name">crunchgen</b> was written by <span class="author">James da Silva</span> &lt;<a class="link-mail" href="mailto:jds@cs.umd.edu">jds@cs.umd.edu</a>&gt;.<div class="spacer">
</div>
Copyright (c) 1994 University of Maryland.  All Rights Reserved.</div>
<div class="section">
<h1 id="x43415645415453">CAVEATS</h1> While <b class="name">crunchgen</b> takes care to eliminate link conflicts between the component programs of a crunched binary, conflicts are still possible between the libraries that are linked in. Some shuffling in the order of libraries may be required, and in some rare cases two libraries may have an unresolvable conflict and thus cannot be crunched together.<div class="spacer">
</div>
Some versions of the <span class="unix">BSD</span> build environment do not by default build the intermediate object file for single-source file programs. The &#8220;make objs&#8221; target must then be used to get those object files built, or some other arrangements made.</div>
</div>
</body>
</html>

