<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
AUTOINSTALL(8)</title>
</head>
<body>
<div class="mandoc">
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">autoinstall</b> &#8212; <span class="desc">unattended OpenBSD installation and upgrade</span></div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> <b class="name">autoinstall</b> allows unattended installation or upgrade of <span class="unix">OpenBSD</span> by automatically responding to installer questions with answers from a response file. <b class="name">autoinstall</b> uses DHCP to discover the location of the response file and HTTP to fetch the file. If that fails, the installer asks for the location which can either be a URL or a local path.<div class="spacer">
</div>
To start unattended installation or upgrade choose '(A)utoinstall' at the install prompt. If there is only one network interface, the installer fetches the response file via that interface. If there is more than one network interface, a selection is presented and the installer fetches the response file via the selected interface.<div class="spacer">
</div>
If the machine is netbooted, the <b class="name">autoinstall</b> feature is invoked if the user does not intervene within a short time. It behaves as if the user selected '(A)utoinstall', but always fetches the response file via the netboot interface.<div class="spacer">
</div>
If either <i class="file">/auto_install.conf</i> or <i class="file">/auto_upgrade.conf</i> is found during boot, <b class="name">autoinstall</b> behaves as if the machine is netbooted, but uses the local response file. In case both files exist, <i class="file">/auto_install.conf</i> takes precedence.<div class="spacer">
</div>
<b class="name">autoinstall</b> uses HTTP to fetch one of the files <i class="file">install.conf</i>, <i class="arg">MAC_address</i>-<i class="file">install.conf</i> or <i class="arg">hostname</i>-<i class="file">install.conf</i> for install answers, or one of <i class="file">upgrade.conf</i>, <i class="arg">MAC_address</i>-<i class="file">upgrade.conf</i> or <i class="arg">hostname</i>-<i class="file">upgrade.conf</i> for upgrade answers. The URL used to fetch the file is constructed from information provided in the <a class="link-man" href="../html5/dhcpd.conf.html">dhcpd.conf(5)</a> statements <b class="cmd">next-server</b> and <b class="cmd">filename</b>. If <i class="arg">filename</i> is <b class="flag">auto_install</b>, then the URLs tried are, in order:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
<code class="none">http://</code><i class="arg">next-server</i><code class="none">/</code><i class="arg">MAC_address</i><code class="none">-install.conf</code>
<code class="none">http://</code><i class="arg">next-server</i><code class="none">/</code><i class="arg">hostname</i><code class="none">-install.conf</code>
<code class="none">http://</code><i class="arg">next-server</i><code class="none">/install.conf</code></pre>
<div class="spacer">
</div>
where <i class="arg">MAC_address</i> is a string of six hex octets separated by colons representing the MAC address of the interface being used to fetch the files, and <i class="arg">hostname</i> is the hostname assigned to the system by DHCP.<div class="spacer">
</div>
If <i class="arg">filename</i> is <b class="flag">auto_upgrade</b>, the URLs tried are, in order:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
<code class="none">http://</code><i class="arg">next-server</i><code class="none">/</code><i class="arg">MAC_address</i><code class="none">-upgrade.conf</code>
<code class="none">http://</code><i class="arg">next-server</i><code class="none">/</code><i class="arg">hostname</i><code class="none">-upgrade.conf</code>
<code class="none">http://</code><i class="arg">next-server</i><code class="none">/upgrade.conf</code></pre>
<div class="spacer">
</div>
On architectures where the <b class="cmd">filename</b> statement is used to provide the name of the file to netboot it is necessary to create symbolic links called <i class="file">auto_install</i> and <i class="file">auto_upgrade</i> that point to the expected boot program and to change the value of the <b class="cmd">filename</b> statement in the <a class="link-man" href="../html5/dhcpd.conf.html">dhcpd.conf(5)</a> file to be <b class="flag">auto_install</b> or <b class="flag">auto_upgrade</b>.<div class="spacer">
</div>
To use a subdirectory as response file location on the HTTP server, the same directory structure containing the symbolic links has to exist in the tftproot directory. The value of <b class="cmd">filename</b> has to be the full path to these symbolic links, and the HTTP and TFTP servers must be on the same machine.<div class="spacer">
</div>
The response file is a line-oriented ASCII text file. The format of each line is:<div class="spacer">
</div>
<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<i class="arg">question</i> <code class="none">=</code> <i class="arg">answer</i></div>
</blockquote>
<div class="spacer">
</div>
<i class="arg">question</i> is an installer question (not including the question mark) or a non-ambiguous part of it, consisting of whitespace separated words. <i class="arg">answer</i> is the answer to the question. Passwords may be in plaintext, encrypted with <a class="link-man" href="../html1/encrypt.html">encrypt(1)</a>, or set to &#8216;<code class="lit">*************</code>&#8217; (13 '*'s) to disable password logins, only permitting alternative access methods (for example, <a class="link-man" href="../html1/ssh.html">ssh(1)</a> keys).<div class="spacer">
</div>
If <b class="name">autoinstall</b> does not find an answer in the response file, the default answer as provided by the installer is used.<div class="spacer">
</div>
The response file may contain answers to the following questions, which are only available during unattended installation to provide additional installer features:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
Public ssh key for root account = <i class="arg">ssh key</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
<i class="arg">ssh key</i> is stored in <i class="file">/root/.ssh/authorized_keys</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
Public ssh key for user puffy = <i class="arg">ssh key</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
<i class="arg">ssh key</i> is stored in <i class="file">~puffy/.ssh/authorized_keys</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
URL to autopartitioning template for disklabel = <i class="arg">url</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
A template file for <a class="link-man" href="../html8/disklabel.html">disklabel(8)</a> autopartitioning is fetched from <i class="arg">url</i> allowing a custom partition layout for the root disk.</dd>
</dl>
</div>
<div class="section">
<h1 id="x46494c4553">FILES</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/etc/dhcpd.conf</i></dt>
<dd class="list-tag" style="margin-left: 18.00ex;">
<a class="link-man" href="../html8/dhcpd.html">dhcpd(8)</a> configuration file</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">install.conf</i></dt>
<dd class="list-tag" style="margin-left: 18.00ex;">
response file for unattended installation</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">upgrade.conf</i></dt>
<dd class="list-tag" style="margin-left: 18.00ex;">
response file for unattended upgrade</dd>
</dl>
</div>
<div class="section">
<h1 id="x4558414d504c4553">EXAMPLES</h1> A typical <i class="file">install.conf</i> file will look something like this:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
System hostname = server1 
Password for root = $2a$14$Z4xRMg8vDpgYH...GVot3ySoj8yby 
Change the default console to com0 = yes 
Which speed should com0 use = 19200 
Setup a user = puffy 
Password for user = ************* 
Public ssh key for user = ssh-ed25519 AAAAC3NzaC1...g3Aqre puffy@ai 
What timezone are you in = Europe/Stockholm 
Location of sets = http 
HTTP Server = ftp.eu.openbsd.org</pre>
<div class="spacer">
</div>
The same file could be used for upgrades by creating a symbolic link called <i class="file">upgrade.conf</i> that points to <i class="file">install.conf</i>. The upgrade process will only use the answers it needs.<div class="spacer">
</div>
And an example <a class="link-man" href="../html5/dhcpd.conf.html">dhcpd.conf(5)</a> <b class="cmd">host</b> declaration:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
host foo { 
  hardware ethernet 00:50:60:49:8b:84; 
  fixed-address 192.168.2.180; 
  filename &quot;auto_install&quot;; 
  option host-name &quot;foo&quot;; 
}</pre>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html5/dhcpd.conf.html">dhcpd.conf(5)</a>, <a class="link-man" href="../html8/diskless.html">diskless(8)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="name">autoinstall</b> feature first appeared in <span class="unix">OpenBSD&#160;5.5</span>.</div>
<div class="section">
<h1 id="x415554484f5253">AUTHORS</h1> <span class="author">Robert Peichaer</span> &lt;<a class="link-mail" href="mailto:rpe@openbsd.org">rpe@openbsd.org</a>&gt;</div>
</div>
</body>
</html>

