<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
RESTORE(8)</title>
</head>
<body>
<div class="mandoc">
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">restore</b>, <b class="name">rrestore</b> &#8212; <span class="desc">restore files or file systems from backups made with dump</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1><table class="synopsis">
<col style="width: 7.00ex;"/>
<col/>
<tbody>
<tr>
<td>
restore</td>
<td>
[<span class="opt"><b class="flag">-chimRrtvxy</b></span>] [<span class="opt"><b class="flag">-b</b> <i class="arg">blocksize</i></span>] [<span class="opt"><b class="flag">-f</b> <i class="arg">file</i></span>] [<span class="opt"><b class="flag">-s</b> <i class="arg">fileno</i></span>] [<span class="opt"><i class="arg">file ...</i></span>]</td>
</tr>
</tbody>
</table>
</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="name">restore</b> command performs the inverse function of <a class="link-man" href="../html8/dump.html">dump(8)</a>. A full backup of a file system may be restored and subsequent incremental backups layered on top of it. Single files and directory subtrees may be restored from full or partial backups. Other arguments to the command are file or directory names specifying the files that are to be restored. Unless the <b class="flag">-h</b> flag is specified (see below), the appearance of a directory name refers to the files and (recursively) subdirectories of that directory.<div class="spacer">
</div>
<b class="name">restore</b> works across networks, replacing the functionality of the old <b class="name">rrestore</b> program (though <b class="name">restore</b> may still be invoked as <b class="name">rrestore</b>). See the <b class="flag">-f</b> option for more on reading backups from remote hosts.<div class="spacer">
</div>
Exactly one of the following flags is required:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-i</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This mode allows interactive restoration of files from a dump. After reading in the directory information from the dump, <b class="name">restore</b> provides a shell like interface that allows the user to move around the directory tree selecting files to be extracted. The available commands are given below; for those commands that require an argument, the default is the current directory.<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">add</b> [<span class="opt"><i class="arg">arg</i></span>]</dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
The current directory or specified argument is added to the list of files to be extracted. If a directory is specified, then it and all its descendants are added to the extraction list (unless the <b class="flag">-h</b> flag is specified on the command line). Files that are on the extraction list are prepended with a &#8220;*&#8221; when they are listed by <b class="cmd">ls</b>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">cd</b> <i class="arg">arg</i></dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
Change the current working directory to the specified argument.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">delete</b> [<span class="opt"><i class="arg">arg</i></span>]</dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
The current directory or specified argument is deleted from the list of files to be extracted. If a directory is specified, then it and all its descendants are deleted from the extraction list (unless the <b class="flag">-h</b> flag is specified on the command line). The most expedient way to extract most of the files from a directory is to add the directory to the extraction list and then delete those files that are not needed.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">extract</b></dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
All files on the extraction list are extracted from the dump. <b class="name">restore</b> will ask which volume the user wishes to mount. The fastest way to extract a few files is to start with the last volume and work towards the first volume.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">help</b></dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
List a summary of the available commands.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">ls</b> [<span class="opt"><i class="arg">arg</i></span>]</dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
List the current or specified directory. Entries that are directories are appended with a &#8220;/&#8221;. Entries that have been marked for extraction are prepended with a &#8220;*&#8221;. If the verbose flag is set, the inode number of each entry is also listed.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">pwd</b></dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
Print the full pathname of the current working directory.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">quit</b></dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
Restore immediately exits, even if the extraction list is not empty.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">setmodes</b></dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
All directories that have been added to the extraction list have their owner, modes, and times set; nothing is extracted from the dump. This is useful for cleaning up after a restore has been prematurely aborted.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">verbose</b></dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
The sense of the <b class="flag">-v</b> flag is toggled. When set, the verbose flag causes the <b class="cmd">ls</b> command to list the inode numbers of all entries. It also causes <b class="name">restore</b> to print out information about each file as it is extracted.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">what</b></dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
List dump header information.</dd>
</dl>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-R</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
<b class="name">restore</b> requests a particular tape of a multi-volume set on which to restart a full restore (see the <b class="flag">-r</b> flag below). This is useful if the restore has been interrupted.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-r</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Restore (rebuild) a file system. The target file system should be made pristine with <a class="link-man" href="../html8/newfs.html">newfs(8)</a>, mounted, and the user changed working directory into the pristine file system before starting the restoration of the initial level 0 backup. If the level 0 restores successfully, the <b class="flag">-r</b> flag may be used to restore any necessary incremental backups on top of the level 0. The <b class="flag">-r</b> flag precludes an interactive file extraction and can be detrimental to one's health (not to mention the disk) if not used carefully. An example of correct usage:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
# newfs /dev/rsd0g 
# mount /dev/sd0g /mnt 
# cd /mnt 
# restore rf /dev/rst0</pre>
<div class="spacer">
</div>
Note that <b class="name">restore</b> leaves a file <i class="file">restoresymtable</i> in the root directory to pass information between incremental restore passes. This file should be removed when the last incremental has been restored.<div class="spacer">
</div>
<b class="name">restore</b>, in conjunction with <a class="link-man" href="../html8/newfs.html">newfs(8)</a> and <a class="link-man" href="../html8/dump.html">dump(8)</a>, may be used to modify file system parameters such as size or block size.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-t</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The names of the specified files are listed if they occur on the backup. If no file argument is given, the root directory is listed, which results in the entire content of the backup being listed, unless the <b class="flag">-h</b> flag has been specified. Note that the <b class="flag">-t</b> flag replaces the function of the old <span class="symb">dumpdir</span> program.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-x</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The named files are read from the given media. If a named file matches a directory whose contents are on the backup and the <b class="flag">-h</b> flag is not specified, the directory is recursively extracted. The owner, modification time, and mode are restored (if possible). If no file argument is given, the root directory is extracted, which results in the entire content of the backup being extracted, unless the <b class="flag">-h</b> flag has been specified.</dd>
</dl>
<div class="spacer">
</div>
The following additional options may be specified:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-b</b> <i class="arg">blocksize</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The number of kilobytes per dump record. If the <b class="flag">-b</b> option is not specified, <b class="name">restore</b> tries to determine the block size dynamically.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-c</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Normally, <b class="name">restore</b> will try to determine dynamically whether the dump was made from an old (pre-4.4) or new format file system. The <b class="flag">-c</b> flag disables this check, and only allows reading a dump in the old format.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-f</b> <i class="arg">file</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Read the backup from <i class="arg">file</i>; <i class="arg">file</i> may be a special device file like <i class="file">/dev/rst0</i> (a tape drive), <i class="file">/dev/rsd1c</i> (a disk drive), an ordinary file, or &#8220;<b class="flag">-</b>&#8221; (the standard input). If the name of the file is of the form &#8220;host:file&#8221; or &#8220;user@host:file&#8221;, <b class="name">restore</b> reads from the named file on the remote host using <a class="link-man" href="../html8/rmt.html">rmt(8)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-h</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Extract the actual directory, rather than the files that it references. This prevents hierarchical restoration of complete subtrees from the dump.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-m</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Extract by inode numbers rather than by file name. This is useful if only a few files are being extracted, and one wants to avoid regenerating the complete pathname to the file.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-s</b> <i class="arg">fileno</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Read from the specified <i class="arg">fileno</i> on a multi-file tape. File numbering starts at 1.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-v</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Normally <b class="name">restore</b> does its work silently. The <b class="flag">-v</b> (verbose) flag causes it to type the name of each file it treats preceded by its file type.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-y</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Do not ask the user whether to abort the restore in the event of an error. Always try to skip over the bad block(s) and continue.</dd>
</dl>
</div>
<div class="section">
<h1 id="x454e5649524f4e4d454e54">ENVIRONMENT</h1> If the following environment variable exists it will be utilized by <b class="name">restore</b>:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="env">TMPDIR</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The directory given in <span class="env">TMPDIR</span> will be used instead of <i class="file">/tmp</i> to store temporary files. Refer to <a class="link-man" href="../html7/environ.html">environ(7)</a> for more information.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="env">TAPE</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Default tape device to use instead of <i class="file">/dev/rst0</i>.</dd>
</dl>
</div>
<div class="section">
<h1 id="x46494c4553">FILES</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/dev/rst0</i></dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
the default tape drive</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/dev/rst*</i></dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
raw SCSI tape interface</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/tmp/rstdir*</i></dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
file containing directories on the tape</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/tmp/rstmode*</i></dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
owner, mode, and time stamps for directories</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">./restoresymtable</i></dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
information passed between incremental restores</dd>
</dl>
</div>
<div class="section">
<h1 id="x444941474e4f5354494353">DIAGNOSTICS</h1> Complains if it gets a read error. If <b class="flag">-y</b> has been specified, or the user responds &#8220;y&#8221;, <b class="name">restore</b> will attempt to continue the restore.<div class="spacer">
</div>
If a backup was made using more than one tape volume, <b class="name">restore</b> will notify the user when it is time to mount the next volume. If the <b class="flag">-x</b> or <b class="flag">-i</b> flag has been specified, <b class="name">restore</b> will also ask which volume the user wishes to mount. The fastest way to extract a few files is to start with the last volume, and work towards the first volume.<div class="spacer">
</div>
There are numerous consistency checks that can be listed by <b class="name">restore</b>. Most checks are self-explanatory or can &#8220;never happen&#8221;. Common errors are given below.<div class="spacer">
</div>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
Converting to new file system format</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
A dump tape created from the old file system has been loaded. It is automatically converted to the new file system format.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
&lt;filename&gt;: not found on tape</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The specified file name was listed in the tape directory, but was not found on the tape. This is caused by tape read errors while looking for the file, and from using a dump tape created on an active file system.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
expected next file &lt;inumber&gt;, got &lt;inumber&gt;</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
A file that was not listed in the directory showed up. This can occur when using a dump created on an active file system.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
Incremental dump too low</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
When doing an incremental restore, a dump that was written before the previous incremental dump, or that has too low an incremental level has been loaded.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
Incremental dump too high</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
When doing an incremental restore, a dump that does not begin its coverage where the previous incremental dump left off, or that has too high an incremental level has been loaded.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
Tape read error while restoring &lt;filename&gt;</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
Tape read error while skipping over inode &lt;inumber&gt;</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
Tape read error while trying to resynchronize</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
A tape (or other media) read error has occurred. If a file name is specified, its contents are probably partially wrong. If an inode is being skipped or the tape is trying to resynchronize, no extracted files have been corrupted, though files may not be found on the tape.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
resync restore, skipped &lt;num&gt; blocks</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
After a dump read error, <b class="name">restore</b> may have to resynchronize itself. This message lists the number of blocks that were skipped over.</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html7/environ.html">environ(7)</a>, <a class="link-man" href="../html8/dump.html">dump(8)</a>, <a class="link-man" href="../html8/mount.html">mount(8)</a>, <a class="link-man" href="../html8/newfs.html">newfs(8)</a>, <a class="link-man" href="../html8/rmt.html">rmt(8)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="name">restore</b> command appeared in <span class="unix">4.2BSD</span>.<div class="spacer">
</div>
The <span class="unix">4.3BSD</span> option syntax is implemented for backward compatibility but is not documented here.</div>
<div class="section">
<h1 id="x42554753">BUGS</h1> <b class="name">restore</b> can get confused when doing incremental restores from dumps that were made on active file systems.<div class="spacer">
</div>
A level 0 dump must be done after a full restore. Because <b class="name">restore</b> runs in user mode, it has no control over inode allocation; thus a full dump must be done to get a new set of directories reflecting the new inode numbering, even though the content of the files is unchanged.<div class="spacer">
</div>
The temporary files <i class="file">/tmp/rstdir*</i> and <i class="file">/tmp/rstmode*</i> are generated with a unique name based on the date of the dump and the process ID (see <a class="link-man" href="../html3/mktemp.html">mktemp(3)</a>), except when <b class="flag">-r</b> or <b class="flag">-R</b> is used. Because <b class="flag">-R</b> allows you to restart a <b class="flag">-r</b> operation that may have been interrupted, the temporary files should be the same across different processes. In all other cases, the files are unique because it is possible to have two different dumps started at the same time, and separate operations shouldn't conflict with each other.</div>
</div>
</body>
</html>

