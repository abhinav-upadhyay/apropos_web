<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
SNDIOD(8)</title>
</head>
<body>
<div class="mandoc">
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">sndiod</b> &#8212; <span class="desc">audio/MIDI server</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1><table class="synopsis">
<col style="width: 6.00ex;"/>
<col/>
<tbody>
<tr>
<td>
sndiod</td>
<td>
[<span class="opt"><b class="flag">-d</b></span>] [<span class="opt"><b class="flag">-a</b>&#160;<i class="arg">flag</i></span>] [<span class="opt"><b class="flag">-b</b>&#160;<i class="arg">nframes</i></span>] [<span class="opt"><b class="flag">-C</b>&#160;<i class="arg">min</i>:<i class="arg">max</i></span>] [<span class="opt"><b class="flag">-c</b>&#160;<i class="arg">min</i>:<i class="arg">max</i></span>] [<span class="opt"><b class="flag">-e</b>&#160;<i class="arg">enc</i></span>] [<span class="opt"><b class="flag">-f</b>&#160;<i class="arg">device</i></span>] [<span class="opt"><b class="flag">-j</b>&#160;<i class="arg">flag</i></span>] [<span class="opt"><b class="flag">-L</b>&#160;<i class="arg">addr</i></span>] [<span class="opt"><b class="flag">-m</b>&#160;<i class="arg">mode</i></span>] [<span class="opt"><b class="flag">-q</b>&#160;<i class="arg">port</i></span>] [<span class="opt"><b class="flag">-r</b>&#160;<i class="arg">rate</i></span>] [<span class="opt"><b class="flag">-s</b>&#160;<i class="arg">name</i></span>] [<span class="opt"><b class="flag">-t</b>&#160;<i class="arg">mode</i></span>] [<span class="opt"><b class="flag">-U</b>&#160;<i class="arg">unit</i></span>] [<span class="opt"><b class="flag">-v</b>&#160;<i class="arg">volume</i></span>] [<span class="opt"><b class="flag">-w</b>&#160;<i class="arg">flag</i></span>] [<span class="opt"><b class="flag">-z</b>&#160;<i class="arg">nframes</i></span>]</td>
</tr>
</tbody>
</table>
</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="name">sndiod</b> daemon is an intermediate layer between audio or MIDI programs and the hardware. It performs the necessary audio processing to allow any program to work on any supported hardware. By default, <b class="name">sndiod</b> accepts connections from programs running on the same system only; it initializes only when programs are using its services, allowing <b class="name">sndiod</b> to consume a negligible amount of system resources the rest of the time. Systems with no audio hardware can use <b class="name">sndiod</b> to keep hot-pluggable devices usable by default at virtually no cost.<div class="spacer">
</div>
<b class="name">sndiod</b> operates as follows: it exposes at least one <span class="emph">sub-device</span> that any number of audio programs can connect to and use as if it was audio hardware. During playback, <b class="name">sndiod</b> receives audio data concurrently from all programs, mixes it and sends the result to the hardware device. Similarly, during recording it duplicates audio data recorded from the device and sends it to all programs. Since audio data flows through the <b class="name">sndiod</b> process, it has the opportunity to process audio data on the fly:<div class="spacer">
</div>
<ul style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 6.00ex;" class="list list-bul">
<li class="list-bul" style="margin-top: 0.00em;">
Change the sound encoding to overcome incompatibilities between software and hardware.</li>
<li class="list-bul" style="margin-top: 0.00em;">
Route the sound from one channel to another, join stereo or split mono.</li>
<li class="list-bul" style="margin-top: 0.00em;">
Control the per-application playback volume as well as the master volume.</li>
<li class="list-bul" style="margin-top: 0.00em;">
Monitor the sound being played, allowing one program to record what other programs play.</li>
</ul>
<div class="spacer">
</div>
Processing is configured on a per sub-device basis, meaning that the sound of all programs connected to the same sub-device will be processed according to the same configuration. Multiple sub-devices can be defined, allowing multiple configurations to coexist. The user selects the configuration a given program will use by selecting the sub-device the program uses.<div class="spacer">
</div>
<b class="name">sndiod</b> exposes MIDI thru boxes (hubs), allowing programs to send MIDI messages to each other or to hardware MIDI ports in a uniform way.<div class="spacer">
</div>
Finally, <b class="name">sndiod</b> exposes a control MIDI port usable for:<div class="spacer">
</div>
<ul style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 6.00ex;" class="list list-bul">
<li class="list-bul" style="margin-top: 0.00em;">
Volume control.</li>
<li class="list-bul" style="margin-top: 0.00em;">
Common clock source for audio and MIDI programs.</li>
<li class="list-bul" style="margin-top: 0.00em;">
Start, stop and relocate groups of audio programs.</li>
</ul>
<div class="spacer">
</div>
The options are as follows:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-a</b> <i class="arg">flag</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Control whether <b class="name">sndiod</b> opens the audio device or the MIDI port only when needed or keeps it open all the time. If the flag is <b class="var">on</b> then the audio device or MIDI port is kept open all the time, ensuring no other program can steal it. If the flag is <b class="var">off</b>, then it's automatically closed, allowing other programs to have direct access to the audio device, or the device to be disconnected. The default is <b class="var">off</b>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-b</b> <i class="arg">nframes</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The buffer size of the audio device in frames. A frame consists of one sample for each channel in the stream. This is the number of frames that will be buffered before being played and thus controls the playback latency. The default is 7680 or twice the block size (<b class="flag">-z</b>), if the block size is set.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-C</b> <i class="arg">min</i>:<i class="arg">max</i>, <b class="flag">-c</b> <i class="arg">min</i>:<i class="arg">max</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The range of channel numbers for recording and playback directions, respectively any client is allowed to use. This is a subset of the audio device channels. The default is 0:1, i.e. stereo.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-d</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Enable debugging to standard error, and do not disassociate from the controlling terminal. Can be specified multiple times to further increase log verbosity.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-e</b> <i class="arg">enc</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Attempt to configure the device to use this encoding. The default is <b class="var">s16</b>. Encoding names use the following scheme: signedness (<b class="var">s</b> or <b class="var">u</b>) followed by the precision in bits, the byte-order (<b class="var">le</b> or <b class="var">be</b>), the number of bytes per sample, and the alignment (<b class="var">msb</b> or <b class="var">lsb</b>). Only the signedness and the precision are mandatory. Examples: <b class="var">u8</b>, <b class="var">s16le</b>, <b class="var">s24le3</b>, <b class="var">s24le4lsb</b>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-f</b> <i class="arg">device</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Add this <a class="link-man" href="../html7/sndio.html">sndio(7)</a> audio device to devices used for playing and/or recording. Preceding per-device options (<b class="flag">-aberwz</b>) apply to this device. Sub-devices (<b class="flag">-s</b>) that are applied after will be attached to this device. Device mode and parameters are determined from sub-devices attached to it.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-j</b> <i class="arg">flag</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Control whether program channels are joined or expanded if the number of channels requested by a program is not equal to the device number of channels. If the flag is <b class="var">off</b> then client channels are routed to the corresponding device channel, possibly discarding channels not present in the device. If the flag is <b class="var">on</b>, then a single client channel may be sent on multiple device channels, or multiple client channels may be sent to a single device channel. For instance, this feature could be used for mono to stereo conversions. The default is <i class="arg">on</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-L</b> <i class="arg">addr</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Specify a local network address <b class="name">sndiod</b> should listen on; <b class="name">sndiod</b> will listen on TCP port 11025+n, where n is the unit number specified with <b class="flag">-U</b>. Without this option, <b class="name">sndiod</b> listens on the <span class="unix">UNIX</span>-domain socket only, and is not reachable from any network. If the option argument is &#8216;-&#8217; then <b class="name">sndiod</b> will accept connections from any address. As the communication is not secure, this option is only suitable for local networks where all hosts and users are trusted.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-m</b> <i class="arg">mode</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Set the sub-device mode. Valid modes are <i class="arg">play</i>, <i class="arg">rec</i>, and <i class="arg">mon</i>, corresponding to playback, recording and monitoring. A monitoring stream is a fake recording stream corresponding to the mix of all playback streams. Multiple modes can be specified, separated by commas, but the same sub-device cannot be used for both recording and monitoring. The default is <i class="arg">play</i>,<i class="arg">rec</i> (i.e. full-duplex).</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-q</b> <i class="arg">port</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Expose the given MIDI port. This allows multiple programs to share the port.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-r</b> <i class="arg">rate</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Attempt to force the device to use this sample rate in Hertz. The default is 48000.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-s</b> <i class="arg">name</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Add <i class="arg">name</i> to the list of sub-devices to expose. This allows clients to use <b class="name">sndiod</b> instead of the physical audio device for audio input and output in order to share the physical device with other clients. Defining multiple sub-devices allows splitting a physical audio device into sub-devices having different properties (e.g. channel ranges). The given <i class="arg">name</i> corresponds to the &#8220;option&#8221; part of the <a class="link-man" href="../html7/sndio.html">sndio(7)</a> device name string.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-t</b> <i class="arg">mode</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Select the way clients are controlled by MIDI Machine Control (MMC) messages received by <b class="name">sndiod</b>. If the mode is <b class="var">off</b> (the default), then programs are not affected by MMC messages. If the mode is <b class="var">slave</b>, then programs are started synchronously by MMC start messages; additionally, the server clock is exposed as MIDI Time Code (MTC) messages allowing MTC-capable software or hardware to be synchronized to audio programs.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-U</b> <i class="arg">unit</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Unit number. Each <b class="name">sndiod</b> server instance has an unique unit number, used in <a class="link-man" href="../html7/sndio.html">sndio(7)</a> device names. The default is 0.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-v</b> <i class="arg">volume</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Software volume attenuation of playback. The value must be between 1 and 127, corresponding to -42dB and -0dB attenuation in 1/3dB steps. Clients inherit this parameter. Reducing the volume in advance allows a client's volume to stay independent from the number of clients as long as their number is small enough. 18 volume units (i.e. -6dB attenuation) allows the number of playback programs to be doubled. The default is 118 i.e. -3dB.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-w</b> <i class="arg">flag</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Control <b class="name">sndiod</b> behaviour when the maximum volume of the hardware is reached and a new program starts playing. This happens only when volumes are not properly set using the <b class="flag">-v</b> option. If the flag is <b class="var">on</b>, then the master volume is automatically adjusted to avoid clipping. Using <b class="var">off</b> makes sense in the rare situation where all programs lower their volumes. The default is <b class="var">on</b>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-z</b> <i class="arg">nframes</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The audio device block size in frames. This is the number of frames between audio clock ticks, i.e. the clock resolution. If a sub-device is created with the <b class="flag">-t</b> option, and MTC is used for synchronization, the clock resolution must be 96, 100 or 120 ticks per second for maximum accuracy. For instance, 100 ticks per second at 48000Hz corresponds to a 480 frame block size. The default is 960 or half of the buffer size (<b class="flag">-b</b>), if the buffer size is set.</dd>
</dl>
<div class="spacer">
</div>
On the command line, per-device parameters (<b class="flag">-aberwz</b>) must precede the device definition (<b class="flag">-f</b>), and per-sub-device parameters (<b class="flag">-Ccjmtvx</b>) must precede the sub-device definition (<b class="flag">-s</b>). Sub-device definitions (<b class="flag">-s</b>) must follow the definition of the device (<b class="flag">-f</b>) to which they are attached.<div class="spacer">
</div>
If no audio devices (<b class="flag">-f</b>) are specified, settings are applied as if the default device is specified. If no sub-devices (<b class="flag">-s</b>) are specified for a device, a default sub-device is created attached to it. If a device (<b class="flag">-f</b>) is defined twice, both definitions are merged: parameters of the first one are used but sub-devices (<b class="flag">-s</b>) of both definitions are created. The default <a class="link-man" href="../html7/sndio.html">sndio(7)</a> device used by <b class="name">sndiod</b> is <i class="file">rsnd/0</i>, and the default sub-device exposed by <b class="name">sndiod</b> is <i class="file">snd/0</i>.<div class="spacer">
</div>
If <b class="name">sndiod</b> is sent <span class="define">SIGHUP</span>, <span class="define">SIGINT</span> or <span class="define">SIGTERM</span>, it terminates.<div class="spacer">
</div>
By default, when the program cannot accept recorded data fast enough or cannot provide data to play fast enough, the program is paused, i.e. samples that cannot be written are discarded and samples that cannot be read are replaced by silence. If a sub-device is created with the <b class="flag">-t</b> option, then recorded samples are discarded, but the same amount of silence will be written once the program is unblocked, in order to reach the right position in time. Similarly silence is played, but the same amount of samples will be discarded once the program is unblocked. This ensures proper synchronization between programs.</div>
<div class="section">
<h1 id="x4d49444920434f4e54524f4c">MIDI CONTROL</h1> <b class="name">sndiod</b> creates a MIDI port with the same name as the exposed audio sub-device to which MIDI programs can connect. <b class="name">sndiod</b> exposes the audio device clock and allows audio device properties to be controlled through MIDI.<div class="spacer">
</div>
A MIDI channel is assigned to each stream, and the volume is changed using the standard volume controller (number 7). Similarly, when the audio client changes its volume, the same MIDI controller message is sent out; it can be used for instance for monitoring or as feedback for motorized faders.<div class="spacer">
</div>
The master volume can be changed using the standard master volume system exclusive message.<div class="spacer">
</div>
Streams created with the <b class="flag">-t</b> option are controlled by the following MMC messages:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 6.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
relocate</dt>
<dd class="list-tag" style="margin-left: 11.00ex;">
This message is ignored by audio <b class="name">sndiod</b> clients, but the given time position is sent to MIDI ports as an MTC &#8220;full frame&#8221; message forcing all MTC-slaves to relocate to the given position (see below).</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
start</dt>
<dd class="list-tag" style="margin-left: 11.00ex;">
Put all streams in starting mode. In this mode, <b class="name">sndiod</b> waits for all streams to become ready to start, and then starts them synchronously. Once started, new streams can be created (<b class="name">sndiod</b>) but they will be blocked until the next stop-to-start transition.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
stop</dt>
<dd class="list-tag" style="margin-left: 11.00ex;">
Put all streams in stopped mode (the default). In this mode, any stream attempting to start playback or recording is paused. Client streams that are already started are not affected until they stop and try to start again.</dd>
</dl>
<div class="spacer">
</div>
Streams created with the <b class="flag">-t</b> option export the <b class="name">sndiod</b> device clock using MTC, allowing non-audio software or hardware to be synchronized to the audio stream. Maximum accuracy is achieved when the number of blocks per second is equal to one of the standard MTC clock rates (96, 100 and 120Hz). The following sample rates (<b class="flag">-r</b>) and block sizes (<b class="flag">-z</b>) are recommended:<div class="spacer">
</div>
<ul style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 6.00ex;" class="list list-bul">
<li class="list-bul" style="margin-top: 0.00em;">
44100Hz, 441 frames (MTC rate is 100Hz)</li>
<li class="list-bul" style="margin-top: 0.00em;">
48000Hz, 400 frames (MTC rate is 120Hz)</li>
<li class="list-bul" style="margin-top: 0.00em;">
48000Hz, 480 frames (MTC rate is 100Hz)</li>
<li class="list-bul" style="margin-top: 0.00em;">
48000Hz, 500 frames (MTC rate is 96Hz)</li>
</ul>
<div class="spacer">
</div>
For instance, the following command will create two devices: the default <b class="var">snd/0</b> and a MIDI-controlled <b class="var">snd/0.mmc</b>:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
$ sndiod -r 48000 -z 400 -s default -t slave -s mmc</pre>
<div class="spacer">
</div>
Streams connected to <b class="var">snd/0</b> behave normally, while streams connected to <b class="var">snd/0.mmc</b> wait for the MMC start signal and start synchronously. Regardless of which device a stream is connected to, its playback volume knob is exposed.</div>
<div class="section">
<h1 id="x4558414d504c4553">EXAMPLES</h1> Start server using default parameters, creating an additional sub-device for output to channels 2:3 only (rear speakers on most cards), exposing the <i class="file">snd/0</i> and <i class="file">snd/0.rear</i> devices:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
$ sndiod -s default -c 2:3 -s rear</pre>
<div class="spacer">
</div>
Start server creating the default sub-device with low volume and an additional sub-device for high volume output, exposing the <i class="file">snd/0</i> and <i class="file">snd/0.max</i> devices:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
$ sndiod -v 65 -s default -v 127 -s max</pre>
<div class="spacer">
</div>
Start server configuring the audio device to use a 48kHz sample frequency, 240-frame block size, and 2-block buffers. The corresponding latency is 10ms, which is the time it takes the sound to propagate 3.5 meters.<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
$ sndiod -r 48000 -b 480 -z 240</pre>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html7/sndio.html">sndio(7)</a></div>
<div class="section">
<h1 id="x42554753">BUGS</h1> Resampling is low quality; down-sampling especially should be avoided when recording.<div class="spacer">
</div>
Processing is done using 16-bit arithmetic, thus samples with more than 16 bits are rounded. 16 bits (i.e. 97dB dynamic) are largely enough for most applications though. Processing precision can be increased to 24-bit at compilation time though.<div class="spacer">
</div>
If <b class="flag">-a</b> <i class="arg">off</i> is used, <b class="name">sndiod</b> creates sub-devices to expose first and then opens the audio hardware on demand. Technically, this allows <b class="name">sndiod</b> to attempt to use one of the sub-devices it exposes as an audio device, creating a deadlock. There's nothing to prevent the user from shooting himself in the foot by creating such a deadlock.</div>
</div>
</body>
</html>

