<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
TSLEEP(9)</title>
</head>
<body>
<div class="mandoc">
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">tsleep</b>, <b class="name">msleep</b>, <b class="name">wakeup</b>, <b class="name">wakeup_n</b>, <b class="name">wakeup_one</b> &#8212; <span class="desc">process context sleep and wakeup</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">sys/param.h</a>&gt;</b><br/>
<b class="includes">#include &lt;<a class="link-includes">sys/systm.h</a>&gt;</b><div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">tsleep</b>(<i class="farg" style="white-space:nowrap;">void *ident</i>, <i class="farg" style="white-space:nowrap;">int priority</i>, <i class="farg" style="white-space:nowrap;">const char *wmesg</i>, <i class="farg" style="white-space:nowrap;">int timo</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">msleep</b>(<i class="farg" style="white-space:nowrap;">void *ident</i>, <i class="farg" style="white-space:nowrap;">struct mutex *mtx</i>, <i class="farg" style="white-space:nowrap;">int priority</i>, <i class="farg" style="white-space:nowrap;">const char *wmesg</i>, <i class="farg" style="white-space:nowrap;">int timo</i>);<div class="spacer">
</div>
<i class="ftype">void</i><br/>
<b class="fname">wakeup</b>(<i class="farg" style="white-space:nowrap;">void *ident</i>);<div class="spacer">
</div>
<i class="ftype">void</i><br/>
<b class="fname">wakeup_n</b>(<i class="farg" style="white-space:nowrap;">void *ident</i>, <i class="farg" style="white-space:nowrap;">int count</i>);<div class="spacer">
</div>
<i class="ftype">void</i><br/>
<b class="fname">wakeup_one</b>(<i class="farg" style="white-space:nowrap;">void *ident</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> These functions implement voluntary context switching. <b class="fname">tsleep</b>() and <b class="fname">msleep</b>() are used throughout the kernel whenever processing in the current context cannot continue for any of the following reasons:<ul style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 6.00ex;" class="list list-bul">
<li class="list-bul" style="margin-top: 1.00em;">
The current process needs to await the results of a pending I/O operation.</li>
<li class="list-bul" style="margin-top: 1.00em;">
The current process needs resources (e.g. memory) which are temporarily unavailable.</li>
<li class="list-bul" style="margin-top: 1.00em;">
The current process wants access to data structures which are locked by other processes.</li>
</ul>
<div class="spacer">
</div>
The <b class="fname">wakeup</b>(), <b class="fname">wakeup_n</b>(), and <b class="fname">wakeup_one</b>() functions are used to notify sleeping processes of possible changes to the condition that caused them to go to sleep. Typically, an awakened process will -- after it has acquired a context again -- retry the action that blocked its operation to see if the &#8220;blocking&#8221; condition has cleared.<div class="spacer">
</div>
The <b class="fname">tsleep</b>() function takes the following arguments:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">ident</i></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
An identifier of the &#8220;wait channel&#8221; representing the resource for which the current process needs to wait. This typically is the virtual address of some kernel data structure related to the resource for which the process is contending. The same identifier must be used in a call to <b class="fname">wakeup</b>() to get the process going again. <i class="farg">ident</i> should not be <span class="define">NULL</span>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">priority</i></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
The process priority to be used when the process is awakened and put on the queue of runnable processes. This mechanism is used to optimize &#8220;throughput&#8221; of processes executing in kernel mode. If the flag <span class="define">PCATCH</span> is OR'ed into <i class="farg">priority</i> the process checks for posted signals before and after sleeping.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">wmesg</i></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
A pointer to a character string indicating the reason a process is sleeping. The kernel does not use the string, but makes it available (through the process structure field <code class="lit">p_wmesg</code>) for user level utilities such as <a class="link-man" href="../html1/ps.html">ps(1)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">timo</i></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
If non-zero, the process will sleep for at most <code class="lit">timo/hz</code> seconds. If this amount of time elapses and no <b class="fname">wakeup</b>(<i class="farg">ident</i>) has occurred, and no signal (if <span class="define">PCATCH</span> <code class="none">was set</code>) was posted, <b class="fname">tsleep</b>() will return <span class="errno">EWOULDBLOCK</span>.</dd>
</dl>
<div class="spacer">
</div>
The <b class="fname">msleep</b>() function behaves just like <b class="fname">tsleep</b>(), but takes an additional argument:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">mtx</i></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
A mutex that will be unlocked when the process is safely on the sleep queue. The mutex will be relocked at the end of msleep unless the <span class="define">PNORELOCK</span> flag is set in the <i class="farg">priority</i> argument.</dd>
</dl>
<div class="spacer">
</div>
The <b class="fname">wakeup</b>() function will mark all processes which are currently sleeping on the identifier <i class="farg">ident</i> as runnable. Eventually, each of the processes will resume execution in the kernel context, causing a return from <b class="fname">tsleep</b>(). Note that processes returning from sleep should always re-evaluate the conditions that blocked them, since a call to <b class="fname">wakeup</b>() merely signals a <span class="emph">possible</span> change to the blocking conditions. For example, when two or more processes are waiting for an exclusive lock, only one of them will succeed in acquiring the lock when it is released. All others will have to go back to sleep and wait for the next opportunity.<div class="spacer">
</div>
The <b class="fname">wakeup_n</b>() and <b class="fname">wakeup_one</b>() functions behave similarly to <b class="fname">wakeup</b>() except that only <i class="farg">count</i> or one process, respectively, is marked runnable.</div>
<div class="section">
<h1 id="x52455455524e2056414c554553">RETURN VALUES</h1> <b class="fname">tsleep</b>() and <b class="fname">msleep</b>() return 0 if they return as a result of a <b class="fname">wakeup</b>(). If they return as a result of a signal, the return value is <span class="errno">ERESTART</span> if the signal has the <span class="define">SA_RESTART</span> property (see <a class="link-man" href="../html2/sigaction.html">sigaction(2)</a>), and <span class="errno">EINTR</span> otherwise. If they return as a result of a timeout, the return value is <span class="errno">EWOULDBLOCK</span>.</div>
<div class="section">
<h1 id="x434f4445205245464552454e434553">CODE REFERENCES</h1> These functions are implemented in the file <i class="file">sys/kern/kern_synch.c</i>.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html9/hz.html">hz(9)</a>, <a class="link-man" href="../html9/mi_switch.html">mi_switch(9)</a>, <a class="link-man" href="../html9/timeout.html">timeout(9)</a></div>
</div>
</body>
</html>

