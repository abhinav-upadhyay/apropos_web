<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
MALLOC(9)</title>
</head>
<body>
<div class="mandoc">
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">malloc</b>, <b class="name">mallocarray</b>, <b class="name">free</b> &#8212; <span class="desc">kernel memory allocator</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">sys/types.h</a>&gt;</b><br/>
<b class="includes">#include &lt;<a class="link-includes">sys/malloc.h</a>&gt;</b><div class="spacer">
</div>
<i class="ftype">void *</i><br/>
<b class="fname">malloc</b>(<i class="farg" style="white-space:nowrap;">size_t size</i>, <i class="farg" style="white-space:nowrap;">int type</i>, <i class="farg" style="white-space:nowrap;">int flags</i>);<div class="spacer">
</div>
<i class="ftype">void *</i><br/>
<b class="fname">mallocarray</b>(<i class="farg" style="white-space:nowrap;">size_t nmemb</i>, <i class="farg" style="white-space:nowrap;">size_t size</i>, <i class="farg" style="white-space:nowrap;">int type</i>, <i class="farg" style="white-space:nowrap;">int flags</i>);<div class="spacer">
</div>
<i class="ftype">void</i><br/>
<b class="fname">free</b>(<i class="farg" style="white-space:nowrap;">void *addr</i>, <i class="farg" style="white-space:nowrap;">int type</i>, <i class="farg" style="white-space:nowrap;">size_t size</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="fname">malloc</b>() function allocates uninitialized memory in kernel address space for an object whose size is specified by <i class="farg">size</i>.<div class="spacer">
</div>
The <b class="fname">mallocarray</b>() function is the same as <b class="fname">malloc</b>(), but allocates space for an array of <i class="farg">nmemb</i> objects and checks for arithmetic overflow.<div class="spacer">
</div>
The <b class="fname">free</b>() function releases memory at address <i class="farg">addr</i> that was previously allocated by <b class="fname">malloc</b>() or <b class="fname">mallocarray</b>() for re-use. The same object size originally provided to <b class="fname">malloc</b>() should be specified by <i class="farg">size</i>, because <b class="fname">free</b>() will operate faster knowing this. If tracking the size is difficult, specify <i class="arg">size</i> as 0. If <i class="farg">addr</i> is a null pointer, no action occurs.<div class="spacer">
</div>
The <i class="farg">flags</i> argument affects the operational characteristics of <b class="fname">malloc</b>() and <b class="fname">mallocarray</b>() as follows:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 6.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">M_WAITOK</span></dt>
<dd class="list-tag" style="margin-left: 3.00ex;">
If memory is currently unavailable, <b class="fname">malloc</b>() may call sleep to wait for resources to be released by other processes.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">M_NOWAIT</span></dt>
<dd class="list-tag" style="margin-left: 3.00ex;">
Causes <b class="fname">malloc</b>() to return <span class="define">NULL</span> if the request cannot be immediately fulfilled due to resource shortage.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">M_CANFAIL</span></dt>
<dd class="list-tag" style="margin-left: 3.00ex;">
In the <span class="define">M_WAITOK</span> case, if not enough memory is available, return <span class="define">NULL</span> instead of calling <a class="link-man" href="../html9/panic.html">panic(9)</a>. If <b class="fname">mallocarray</b>() detects an overflow or <b class="fname">malloc</b>() detects an excessive allocation, return <span class="define">NULL</span> instead of calling <a class="link-man" href="../html9/panic.html">panic(9)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">M_ZERO</span></dt>
<dd class="list-tag" style="margin-left: 3.00ex;">
Causes allocated memory to be zeroed.</dd>
</dl>
<div class="spacer">
</div>
One of <span class="define">M_NOWAIT</span> or <span class="define">M_WAITOK</span> must be specified via the <i class="farg">flags</i> argument.<div class="spacer">
</div>
The <i class="farg">type</i> argument broadly identifies the kernel subsystem for which the allocated memory was needed, and is commonly used to maintain statistics about kernel memory usage. These statistics can be examined using <a class="link-man" href="../html8/vmstat.html">vmstat(8)</a> or <a class="link-man" href="../html1/systat.html">systat(1)</a> if either of the kernel <a class="link-man" href="../html4/options.html">options(4)</a> <b class="flag">KMEMSTATS</b> or <b class="flag">DEBUG</b> are enabled.<div class="spacer">
</div>
The following types are currently defined:<div class="spacer">
</div>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 6.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_FREE</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Should be on free list.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_DEVBUF</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Device driver memory.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_DEBUG</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
<b class="name">malloc</b> debug structures.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_PCB</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Protocol control blocks.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_RTABLE</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Routing tables.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_FTABLE</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Fragment reassembly headers.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_IFADDR</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Interface addresses.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_SOOPTS</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Socket options.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_SYSCTL</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Sysctl persistent buffers.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_IOCTLOPS</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Ioctl data buffers.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_IOV</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Large IOVs.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_MOUNT</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
VFS mount structs.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_NFSREQ</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
NFS request headers.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_NFSMNT</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
NFS mount structures.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_VNODE</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Dynamically allocated vnodes.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_CACHE</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Dynamically allocated cache entries.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_DQUOT</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
UFS quota entries.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_UFSMNT</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
UFS mount structures.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_SHM</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
SVID compatible shared memory segments.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_VMMAP</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
VM map structures.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_SEM</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
SVID compatible semaphores.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_DIRHASH</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
UFS directory hash structures.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_ACPI</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
ACPI structures.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_VMPMAP</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
VM pmap data.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_FILE</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Open file structures.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_FILEDESC</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Open file descriptor tables.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_PROC</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Proc structures.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_SUBPROC</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Proc sub-structures.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_VCLUSTER</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Cluster for VFS.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_MFSNODE</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
MFS vnode private part.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_NETADDR</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Export host address structures.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_NFSSVC</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
NFS server structures.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_NFSD</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
NFS server daemon structures.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_IPMOPTS</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Internet multicast options.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_IPMADDR</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Internet multicast addresses.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_IFMADDR</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Link-level multicast addresses.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_MRTABLE</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Multicast routing tables.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_ISOFSMNT</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
ISOFS mount structures.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_ISOFSNODE</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
ISOFS vnode private part.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_MSDOSFSMNT</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
MSDOS FS mount structures.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_MSDOSFSFAT</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
MSDOS FS FAT tables.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_MSDOSFSNODE</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
MSDOS FS vnode private part.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_TTYS</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Allocated tty structures.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_EXEC</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Argument lists &amp; other mem used by exec.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_MISCFSMNT</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Miscellaneous FS mount structures.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_FUSEFS</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
FUSE FS mount structures.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_PFKEY</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Pfkey data.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_TDB</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Transforms database.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_XDATA</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
IPsec data.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_PAGEDEP</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
File page dependencies.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_INODEDEP</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Inode dependencies.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_NEWBLK</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
New block allocation.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_INDIRDEP</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Indirect block dependencies.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_VMSWAP</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
VM swap structures.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_UVMAMAP</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
UVM amap and related.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_UVMAOBJ</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
UVM aobj and related.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_USB</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
USB general.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_USBDEV</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
USB device driver.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_USBHC</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
USB host controller.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_MEMDESC</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Memory range.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_CRYPTO_DATA</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
<a class="link-man" href="../html9/crypto.html">crypto(9)</a> data buffers.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_CREDENTIALS</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
<a class="link-man" href="../html4/ipsec.html">ipsec(4)</a> related credentials.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_EMULDATA</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Per process emulation data.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_IP6OPT</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
IPv6 options.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_IP6NDP</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
IPv6 neighbour discovery structures.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_TEMP</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Miscellaneous temporary data buffers.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_NTFSMNT</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
NTFS mount structures.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_NTFSNTNODE</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
NTFS ntnode information.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_NTFSNODE</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
NTFS fnode information.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_NTFSDIR</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
NTFS directory buffers.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_NTFSHASH</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
NTFS ntnode hash tables.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_NTFSVATTR</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
NTFS file attribute information.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_NTFSRDATA</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
NTFS resident data.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_NTFSDECOMP</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
NTFS decompression temporary storage.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_NTFSRUN</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
NTFS vrun storage.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_KEVENT</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
<a class="link-man" href="../html2/kqueue.html">kqueue(2)</a> data structures.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_UDFMOUNT</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
UDF mount structures.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_UDFFENTRY</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
UDF file entries.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_UDFFID</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
UDF file ID.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_AGP</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
AGP memory.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">M_DRM</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Direct Rendering Manager.</dd>
</dl>
</div>
<div class="section">
<h1 id="x434f4e54455854">CONTEXT</h1> <b class="fname">malloc</b>() and <b class="fname">mallocarray</b>() can be called during autoconf, from process context, or from interrupt context if <span class="define">M_NOWAIT</span> is passed via <i class="farg">flags</i>. They can't be called from interrupt context if <span class="define">M_WAITOK</span> is passed via <i class="farg">flags</i>.<div class="spacer">
</div>
<b class="fname">free</b>() can be called during autoconf, from process context, or from interrupt context.</div>
<div class="section">
<h1 id="x52455455524e2056414c554553">RETURN VALUES</h1> <b class="fname">malloc</b>() and <b class="fname">mallocarray</b>() return a kernel virtual address that is suitably aligned for storage of any type of object.</div>
<div class="section">
<h1 id="x444941474e4f5354494353">DIAGNOSTICS</h1> A kernel compiled with the <span class="define">DIAGNOSTIC</span> configuration option attempts to detect memory corruption caused by such things as writing outside the allocated area and unbalanced calls to <b class="fname">malloc</b>() or <b class="fname">mallocarray</b>(), and <b class="fname">free</b>(). Failing consistency checks will cause a panic or a system console message:<div class="spacer">
</div>
<ul style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 6.00ex;" class="list list-bul">
<li class="list-bul" style="margin-top: 0.00em;">
panic: &#8220;malloc: bogus type&#8221;</li>
<li class="list-bul" style="margin-top: 0.00em;">
panic: &#8220;malloc: out of space in kmem_map&#8221;</li>
<li class="list-bul" style="margin-top: 0.00em;">
panic: &#8220;malloc: allocation too large&#8221;</li>
<li class="list-bul" style="margin-top: 0.00em;">
panic: &#8220;malloc: wrong bucket&#8221;</li>
<li class="list-bul" style="margin-top: 0.00em;">
panic: &#8220;malloc: lost data&#8221;</li>
<li class="list-bul" style="margin-top: 0.00em;">
panic: &#8220;mallocarray: overflow&#8221;</li>
<li class="list-bul" style="margin-top: 0.00em;">
panic: &#8220;free: unaligned addr&#8221;</li>
<li class="list-bul" style="margin-top: 0.00em;">
panic: &#8220;free: duplicated free&#8221;</li>
<li class="list-bul" style="margin-top: 0.00em;">
panic: &#8220;free: multiple frees&#8221;</li>
<li class="list-bul" style="margin-top: 0.00em;">
panic: &#8220;free: non-malloced addr&#8221;</li>
<li class="list-bul" style="margin-top: 0.00em;">
panic: &#8220;free: size too large&#8221;</li>
<li class="list-bul" style="margin-top: 0.00em;">
panic: &#8220;free: size too small&#8221;</li>
<li class="list-bul" style="margin-top: 0.00em;">
panic: &#8220;kmeminit: minbucket too small/struct freelist too big&#8221;</li>
<li class="list-bul" style="margin-top: 0.00em;">
&#8220;multiply freed item &#10216;addr&#10217;&#8221;</li>
<li class="list-bul" style="margin-top: 0.00em;">
&#8220;Data modified on freelist: &#10216;data object description&#10217;&#8221;</li>
</ul>
</div>
<div class="section">
<h1 id="x444542554747494e47">DEBUGGING</h1> A kernel compiled with the <b class="flag">MALLOC_DEBUG</b> option allows for more extensive debugging of memory allocations. The <b class="var">debug_malloc_type</b>, <b class="var">debug_malloc_size</b>, <b class="var">debug_malloc_size_lo</b> and <b class="var">debug_malloc_size_hi</b> variables choose which allocation to debug. <b class="var">debug_malloc_type</b> should be set to the memory type and <b class="var">debug_malloc_size</b> should be set to the memory size to debug. 0 can be used as a wildcard. <b class="var">debug_malloc_size_lo</b> and <b class="var">debug_malloc_size_hi</b> can be used to specify a range of sizes if the exact size to debug is not known. When those are used, <b class="var">debug_malloc_size</b> needs to be set to the wildcard. <span class="define">M_DEBUG</span> can also be specified as an allocation type to force allocation with debugging.<div class="spacer">
</div>
Every call to <b class="fname">malloc</b>() or <b class="fname">mallocarray</b>() with a memory type and size that matches the debugged type and size will allocate two virtual pages. The pointer returned will be aligned so that the requested area will end at the page boundary and the second virtual page will be left unmapped. This way we can catch reads and writes outside the allocated area.<div class="spacer">
</div>
Every call to <b class="fname">free</b>() with memory that was returned by the debugging allocators will cause the memory area to become unmapped so that we can catch dangling reads and writes to freed memory.<div class="spacer">
</div>
There are no special diagnostics if any errors are caught by the debugging malloc. The errors will look like normal access to unmapped memory. On a memory access error, the <b class="cmd">show malloc</b> command in <a class="link-man" href="../html4/ddb.html">ddb(4)</a> can be invoked to see what memory areas are allocated and freed. If the faulting address is within two pages from an address on the allocated list, there was an access outside the allocated area. If the faulting address is within two pages from an address on the free list, there was an access to freed memory.<div class="spacer">
</div>
Care needs to be taken when using the <b class="flag">MALLOC_DEBUG</b> option:  the memory consumption can run away pretty quickly and there is a severe performance degradation when allocating and freeing debugged memory types.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html1/systat.html">systat(1)</a>, <a class="link-man" href="../html8/vmstat.html">vmstat(8)</a></div>
</div>
</body>
</html>

