<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
IF_RXR_INIT(9)</title>
</head>
<body>
<div class="mandoc">
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">if_rxr_init</b>, <b class="name">if_rxr_get</b>, <b class="name">if_rxr_put</b>, <b class="name">if_rxr_inuse</b>, <b class="name">if_rxr_ioctl</b>, <b class="name">if_rxr_info_ioctl</b> &#8212; <span class="desc">Interface Receive Ring accounting</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">net/if.h</a>&gt;</b><div class="spacer">
</div>
<i class="ftype">void</i><br/>
<b class="fname">if_rxr_init</b>(<i class="farg" style="white-space:nowrap;">struct if_rxring *rxr</i>, <i class="farg" style="white-space:nowrap;">unsigned int lwm</i>, <i class="farg" style="white-space:nowrap;">unsigned int hwm</i>);<div class="spacer">
</div>
<i class="ftype">unsigned int</i><br/>
<b class="fname">if_rxr_get</b>(<i class="farg" style="white-space:nowrap;">struct if_rxring *rxr</i>, <i class="farg" style="white-space:nowrap;">unsigned int max</i>);<div class="spacer">
</div>
<i class="ftype">void</i><br/>
<b class="fname">if_rxr_put</b>(<i class="farg" style="white-space:nowrap;">struct if_rxring *rxr</i>, <i class="farg" style="white-space:nowrap;">unsigned int n</i>);<div class="spacer">
</div>
<i class="ftype">unsigned int</i><br/>
<b class="fname">if_rxr_inuse</b>(<i class="farg" style="white-space:nowrap;">struct if_rxring *rxr</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">if_rxr_ioctl</b>(<i class="farg" style="white-space:nowrap;">struct if_rxrinfo *ifri</i>, <i class="farg" style="white-space:nowrap;">const char *name</i>, <i class="farg" style="white-space:nowrap;">unsigned int size</i>, <i class="farg" style="white-space:nowrap;">struct if_rxring *rxr</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">if_rxr_info_ioctl</b>(<i class="farg" style="white-space:nowrap;">struct if_rxrinfo *ifri</i>, <i class="farg" style="white-space:nowrap;">unsigned int n</i>, <i class="farg" style="white-space:nowrap;">struct if_rxring_info *rings</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The Interface Receive Ring accounting API provides a mechanism to manage the number of available descriptors on a network card's receive ring. The API restricts the allocation of receive descriptors using a heuristic that monitors the use of the ring. The number of descriptors granted on the ring may increase over time as the interface proves it uses them. Additionally, if the algorithm detects that the system is livelocked as a result of being overwhelmed with network traffic, it will restrict the number of available receive descriptors.<div class="spacer">
</div>
<b class="fname">if_rxr_init</b>() initialises the <i class="farg">rxr</i> structure. The <i class="farg">lwm</i> argument defines the minimum number of descriptors the chip needs to operate the ring correctly. <i class="farg">hwm</i> is used to describe the maximum number of descriptors the ring can contain.<div class="spacer">
</div>
<b class="fname">if_rxr_get</b>() allocates and accounts for up to <i class="farg">max</i> descriptors in the ring as being used.<div class="spacer">
</div>
<b class="fname">if_rxr_put</b>() returns <i class="farg">n</i> receive descriptor slots to the ring.<div class="spacer">
</div>
<b class="fname">if_rxr_inuse</b>() can be used to determine how many descriptor slots have been allocated on the ring.<div class="spacer">
</div>
The <b class="fname">if_rxr_ioctl</b>() and <b class="fname">if_rxr_info_ioctl</b>() functions are provided to assist drivers in reporting their rings' state to userland via a <span class="define">SIOCGIFRXR</span> ioctl request. The ioctl data payload will be an ifreq structure, with ifr_data pointing at a struct if_rxrinfo in userland memory. This if_rxrinfo pointer should be passed via <i class="farg">ifri</i>.<div class="spacer">
</div>
If a driver only has a single receive ring, it may pass the ring state to <b class="fname">if_rxr_ioctl</b>() via the <i class="farg">rxr</i> argument. <i class="farg">size</i> is used to describe the size of the mbuf cluster the receive ring uses. If the driver wishes to name the ring it can pass it via <i class="farg">name</i>, otherwise <span class="define">NULL</span>.<div class="spacer">
</div>
If the driver has multiple receive rings, it can prepare an array of if_rxring_info structures and pass that to <b class="fname">if_rxr_info_ioctl</b>() via <i class="farg">rings</i> with the number of elements in the array passed via <i class="farg">n</i>.<div class="spacer">
</div>
For the heuristic to work correctly, a driver using this API should return all possible descriptor slots with <b class="fname">if_rxr_put</b>() before calling <b class="fname">if_rxr_get</b>() to fill them again.</div>
<div class="section">
<h1 id="x434f4e54455854">CONTEXT</h1> <b class="fname">if_rxr_init</b>(), <b class="fname">if_rxr_get</b>(), <b class="fname">if_rxr_put</b>(), and <b class="fname">if_rxr_inuse</b>() can be called during autoconf, from process context, or from interrupt context.<div class="spacer">
</div>
<b class="fname">if_rxr_ioctl</b>() and <b class="fname">if_rxr_info_ioctl</b>() can be called from process context, and only from the context of the process generating an ioctl call.<div class="spacer">
</div>
It is up to the caller to provide appropriate locking around calls to these functions to prevent inconsistencies in the relevant if_rxring data structure.</div>
<div class="section">
<h1 id="x52455455524e2056414c554553">RETURN VALUES</h1> <b class="fname">if_rxr_get</b>() returns the number of receive descriptors available on the ring. The number of descriptors may be less than the <i class="farg">max</i> requested.<div class="spacer">
</div>
<b class="fname">if_rxr_inuse</b>() returns the number of receive descriptor slots currently in use on the ring.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html9/autoconf.html">autoconf(9)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The Interface Receive Ring API was originally written by <span class="author">David Gwynne</span> &lt;<a class="link-mail" href="mailto:dlg@openbsd.org">dlg@openbsd.org</a>&gt;. The API first appeared in <span class="unix">OpenBSD&#160;5.6</span>.</div>
</div>
</body>
</html>

