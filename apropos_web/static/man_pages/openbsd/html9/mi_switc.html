<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
MI_SWITCH(9)</title>
</head>
<body>
<div class="mandoc">
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">mi_switch</b>, <b class="name">cpu_switchto</b> &#8212; <span class="desc">switch to another process context</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">sys/param.h</a>&gt;</b><br/>
<b class="includes">#include &lt;<a class="link-includes">sys/proc.h</a>&gt;</b><div class="spacer">
</div>
<i class="ftype">void</i><br/>
<b class="fname">mi_switch</b>(<i class="farg" style="white-space:nowrap;">void</i>);<div class="spacer">
</div>
<i class="ftype">void</i><br/>
<b class="fname">cpu_switchto</b>(<i class="farg" style="white-space:nowrap;">struct proc *old</i>, <i class="farg" style="white-space:nowrap;">struct proc *new</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="fname">mi_switch</b>() function implements the machine-independent prelude to a process context switch. It is called from only a few distinguished places in the kernel code as a result of the principle of non-preemptable kernel mode execution. The three major uses of <b class="fname">mi_switch</b>() can be enumerated as follows:<ol style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 6.00ex;" class="list list-enum">
<li class="list-enum" style="margin-top: 1.00em;">
From within <a class="link-man" href="../html9/tsleep.html">tsleep(9)</a> when the current process voluntarily relinquishes the CPU to wait for some resource to become available.</li>
<li class="list-enum" style="margin-top: 1.00em;">
After handling a trap (e.g., a system call or device interrupt) when the kernel prepares a return to user-mode execution. This case is typically handled by machine-dependent trap-handling code after detection of a change in the signal disposition of the current process, or when a higher priority process might be available to run. The latter event is communicated by the machine-independent scheduling routines by calling the machine-dependent <b class="fname">need_resched</b>(<i class="farg">void</i>).</li>
<li class="list-enum" style="margin-top: 1.00em;">
In the signal handling code (see <a class="link-man" href="../html9/issignal.html">issignal(9)</a>) if a signal is delivered that causes a process to stop.</li>
</ol>
<div class="spacer">
</div>
<b class="fname">mi_switch</b>() records the amount of time the current process has been running in the process structure and checks this value against the CPU time limits allocated to the process (see <a class="link-man" href="../html2/getrlimit.html">getrlimit(2)</a>). Exceeding the soft limit results in a <span class="define">SIGXCPU</span> signal to be posted to the process, while exceeding the hard limit will cause a <span class="define">SIGKILL</span>. For a process which accumulated longer than 10 minutes of CPU time, its nice level is raised to 4. After these administrative tasks are done, <b class="fname">mi_switch</b>() chooses the next process to run and hands over control to the machine dependent routine <b class="fname">cpu_switchto</b>(), which will perform the actual process context switch.<div class="spacer">
</div>
<b class="fname">cpu_switchto</b>() will save the context of the old process and switch to the new one. A special case is when the old process is <span class="define">NULL</span> which means that the old process has exited and doesn't need to be saved.<div class="spacer">
</div>
Note that <b class="fname">mi_switch</b>() and thus <b class="fname">cpu_switchto</b>() should be called at <a class="link-man" href="../html9/splhigh.html">splhigh(9)</a>.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html9/spl.html">spl(9)</a>, <a class="link-man" href="../html9/tsleep.html">tsleep(9)</a>, <a class="link-man" href="../html9/wakeup.html">wakeup(9)</a></div>
</div>
</body>
</html>

