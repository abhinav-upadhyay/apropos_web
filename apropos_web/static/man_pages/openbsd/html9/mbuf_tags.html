<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
M_TAG_GET(9)</title>
</head>
<body>
<div class="mandoc">
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">m_tag_get</b>, <b class="name">m_tag_find</b>, <b class="name">m_tag_prepend</b>, <b class="name">m_tag_delete</b>, <b class="name">m_tag_copy</b>, <b class="name">m_tag_delete_chain</b>, <b class="name">m_tag_init</b>, <b class="name">m_tag_copy_chain</b>, <b class="name">m_tag_first</b>, <b class="name">m_tag_next</b> &#8212; <span class="desc">a framework for generic packet attributes</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">sys/mbuf.h</a>&gt;</b><div class="spacer">
</div>
<i class="ftype">struct m_tag *</i><br/>
<b class="fname">m_tag_get</b>(<i class="farg" style="white-space:nowrap;">int type</i>, <i class="farg" style="white-space:nowrap;">int len</i>, <i class="farg" style="white-space:nowrap;">int flags</i>);<div class="spacer">
</div>
<i class="ftype">struct m_tag *</i><br/>
<b class="fname">m_tag_find</b>(<i class="farg" style="white-space:nowrap;">struct mbuf *mbuf</i>, <i class="farg" style="white-space:nowrap;">int type</i>, <i class="farg" style="white-space:nowrap;">struct m_tag *tag</i>);<div class="spacer">
</div>
<i class="ftype">void</i><br/>
<b class="fname">m_tag_prepend</b>(<i class="farg" style="white-space:nowrap;">struct mbuf *mbuf</i>, <i class="farg" style="white-space:nowrap;">struct m_tag *tag</i>);<div class="spacer">
</div>
<i class="ftype">void</i><br/>
<b class="fname">m_tag_delete</b>(<i class="farg" style="white-space:nowrap;">struct mbuf *mbuf</i>, <i class="farg" style="white-space:nowrap;">struct m_tag *tag</i>);<div class="spacer">
</div>
<i class="ftype">struct m_tag *</i><br/>
<b class="fname">m_tag_copy</b>(<i class="farg" style="white-space:nowrap;">struct m_tag *tag</i>);<div class="spacer">
</div>
<i class="ftype">void</i><br/>
<b class="fname">m_tag_delete_chain</b>(<i class="farg" style="white-space:nowrap;">struct mbuf *mbuf</i>);<div class="spacer">
</div>
<i class="ftype">void</i><br/>
<b class="fname">m_tag_init</b>(<i class="farg" style="white-space:nowrap;">struct mbuf *mbuf</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">m_tag_copy_chain</b>(<i class="farg" style="white-space:nowrap;">struct mbuf *mbuf</i>, <i class="farg" style="white-space:nowrap;">struct mbuf *mbuf2</i>);<div class="spacer">
</div>
<i class="ftype">struct m_tag *</i><br/>
<b class="fname">m_tag_first</b>(<i class="farg" style="white-space:nowrap;">struct mbuf *mbuf</i>);<div class="spacer">
</div>
<i class="ftype">struct m_tag *</i><br/>
<b class="fname">m_tag_next</b>(<i class="farg" style="white-space:nowrap;">struct mbuf *mbuf</i>, <i class="farg" style="white-space:nowrap;">struct m_tag *tag</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> These functions allow the manipulation of generic packet attributes. They are used by the kernel to keep track of operations done or scheduled to happen to packets. These attributes are attached to <a class="link-man" href="../html9/mbuf.html">mbuf(9)</a> packet headers.<div class="spacer">
</div>
Mbuf tags get allocated using <a class="link-man" href="../html9/pool.html">pool(9)</a>.<div class="spacer">
</div>
<b class="fname">m_tag_get</b>() allocates a new tag of type <b class="var">type</b> with <b class="var">len</b> bytes of space following the tag header itself. The <b class="var">flag</b> argument is passed directly to <a class="link-man" href="../html9/pool_get.html">pool_get(9)</a>. If successful, <b class="fname">m_tag_get</b>() returns a memory buffer of (len + sizeof (struct m_tag)) bytes. The first sizeof(struct m_tag) bytes contain a struct m_tag:<div class="spacer">
</div>
<pre style="margin-left: 0.00ex;" class="lit display">
struct m_tag { 
	SLIST_ENTRY(m_tag)	m_tag_link;	/* List of packet tags */ 
	u_int16_t		m_tag_id;	/* Tag ID */ 
	u_int16_t		m_tag_len;	/* Length of data */ 
};</pre>
<div class="spacer">
</div>
The <b class="var">m_tag_link</b> field is used to link tags together (see <a class="link-man" href="../html3/queue.html">queue(3)</a> for more details). The <b class="var">m_tag_id</b> and <b class="var">m_tag_len</b> fields are set to <b class="var">type</b> and <b class="var">len</b> respectively. Following this structure are <b class="var">len</b> bytes of space that can be used to store tag-specific information.<div class="spacer">
</div>
The currently defined tag types are:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
PACKET_TAG_IPSEC_IN_DONE</dt>
<dd class="list-tag" style="margin-left: 25.00ex;">
Used by <a class="link-man" href="../html4/ipsec.html">ipsec(4)</a> to indicate successful processing performed on an input packet. The tag contains a <b class="var">struct tdb_ident</b>, as defined in <i class="file">sys/netinet/ip_ipsp.h</i>, identifying the security association under which the packet arrived.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
PACKET_TAG_IPSEC_OUT_DONE</dt>
<dd class="list-tag" style="margin-left: 25.00ex;">
Used by IPsec to indicate that an output packet has been IPsec-processed. The tag contains a <b class="var">struct tdb_ident</b> identifying the security association applied to the packet. This tag is primarily used to detect and avoid loops in IPsec processing on output.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
PACKET_TAG_GIF</dt>
<dd class="list-tag" style="margin-left: 25.00ex;">
Used by the <a class="link-man" href="../html4/gif.html">gif(4)</a> interface to detect loops in processing. The tag contains a pointer to the gif interface that already processed the packet.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
PACKET_TAG_GRE</dt>
<dd class="list-tag" style="margin-left: 25.00ex;">
Used by the <a class="link-man" href="../html4/gre.html">gre(4)</a> interface to detect loops in processing. The tag contains a pointer to the gre interface that already processed the packet.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
PACKET_TAG_DLT</dt>
<dd class="list-tag" style="margin-left: 25.00ex;">
Used by <a class="link-man" href="../html4/bpf.html">bpf(4)</a> to indicate that the packet was injected. The tag contains a <b class="var">u_int</b> identifying the data link layer type.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
PACKET_TAG_PF_DIVERT</dt>
<dd class="list-tag" style="margin-left: 25.00ex;">
Indicates that the packet was diverted by <a class="link-man" href="../html4/pf.html">pf(4)</a> using the <span class="emph">divert-to</span> or <span class="emph">divert-reply</span> directives. The tag contains a <b class="var">struct pf_divert</b> identifying the port, address and routing domain the packet should be diverted to.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
PACKET_TAG_PIPEX</dt>
<dd class="list-tag" style="margin-left: 25.00ex;">
Used by <a class="link-man" href="../html4/pipex.html">pipex(4)</a> to cache its session information. The tag contains a <b class="var">struct pipex_tag</b>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
PACKET_TAG_PF_REASSEMBLED</dt>
<dd class="list-tag" style="margin-left: 25.00ex;">
Used by <a class="link-man" href="../html4/pf.html">pf(4)</a> to reassemble IPv6 fragments. The tag contains a <b class="var">struct pf_fragment_tag</b>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
PACKET_TAG_SRCROUTE</dt>
<dd class="list-tag" style="margin-left: 25.00ex;">
Used by the IPv4 stack to keep track of the source route of an incoming IP packet, in case a protocol wants to respond over the same route. The tag contains a <b class="var">struct ip_srcrt</b>.</dd>
</dl>
<div class="spacer">
</div>
<b class="fname">m_tag_find</b>() finds an instance of a tag of type <b class="var">type</b> attached to packet <b class="var">mbuf</b>. If <b class="var">tag</b> is <span class="define">NULL</span>, the first such tag is returned. Otherwise, the first tag of type <b class="var">type</b> after <b class="var">tag</b> is returned. If no such tag is found, <span class="define">NULL</span> is returned.<div class="spacer">
</div>
<b class="fname">m_tag_prepend</b>() adds the new tag <b class="var">tag</b> at the head of the tag list for packet <b class="var">mbuf</b>.<div class="spacer">
</div>
<b class="fname">m_tag_delete</b>() removes and then de-allocates tag <b class="var">tag</b> from the list of tags of packet <b class="var">mbuf</b>.<div class="spacer">
</div>
<b class="fname">m_tag_copy</b>() creates an unlinked copy of tag <b class="var">tag</b>.<div class="spacer">
</div>
<b class="fname">m_tag_delete_chain</b>() deletes all tags attached to packet <b class="var">mbuf</b>.<div class="spacer">
</div>
<b class="fname">m_tag_init</b>() initializes the tag storage for packet <b class="var">mbuf</b>.<div class="spacer">
</div>
<b class="fname">m_tag_copy_chain</b>() copies all tags from packet <b class="var">mbuf</b> to packet <b class="var">mbuf2</b>. On success, it returns 0. Otherwise, it returns <span class="errno">ENOBUFS</span>.<div class="spacer">
</div>
<b class="fname">m_tag_first</b>() returns the first tag attached to packet <b class="var">mbuf</b>.<div class="spacer">
</div>
<b class="fname">m_tag_next</b>() returns the tag following <b class="var">tag</b> in packet <b class="var">mbuf</b>.<div class="spacer">
</div>
The <b class="fname">M_MOVE_PKTHDR</b>() and <b class="fname">M_MOVE_HDR</b>() macros defined in <i class="file">sys/sys/mbuf.h</i> move the tags from the old to the new mbuf.</div>
<div class="section">
<h1 id="x434f4445205245464552454e434553">CODE REFERENCES</h1> The tag-manipulating code is contained in the file <i class="file">sys/kern/uipc_mbuf2.c</i>.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html4/bpf.html">bpf(4)</a>, <a class="link-man" href="../html4/bridge.html">bridge(4)</a>, <a class="link-man" href="../html4/gif.html">gif(4)</a>, <a class="link-man" href="../html4/gre.html">gre(4)</a>, <a class="link-man" href="../html4/ipsec.html">ipsec(4)</a>, <a class="link-man" href="../html4/pf.html">pf(4)</a>, <a class="link-man" href="../html4/pipex.html">pipex(4)</a>, <a class="link-man" href="../html9/mbuf.html">mbuf(9)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The packet tags first appeared in <span class="unix">OpenBSD&#160;2.9</span> and were written by <span class="author">Angelos D. Keromytis</span> &lt;<a class="link-mail" href="mailto:angelos@openbsd.org">angelos@openbsd.org</a>&gt;.</div>
</div>
</body>
</html>

