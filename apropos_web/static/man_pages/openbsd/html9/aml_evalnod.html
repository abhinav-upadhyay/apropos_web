<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
AML_EVALNODE(9)</title>
</head>
<body>
<div class="mandoc">
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">aml_evalnode</b>, <b class="name">aml_evalname</b>, <b class="name">aml_find_node</b>, <b class="name">aml_freevalue</b>, <b class="name">aml_val2int</b> &#8212; <span class="desc">AML API</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">dev/acpi/acpireg.h</a>&gt;</b><br/>
<b class="includes">#include &lt;<a class="link-includes">dev/acpi/acpivar.h</a>&gt;</b><br/>
<b class="includes">#include &lt;<a class="link-includes">dev/acpi/acpidev.h</a>&gt;</b><br/>
<b class="includes">#include &lt;<a class="link-includes">dev/acpi/amltypes.h</a>&gt;</b><br/>
<b class="includes">#include &lt;<a class="link-includes">dev/acpi/dsdt.h</a>&gt;</b><div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">aml_evalnode</b>(<i class="farg" style="white-space:nowrap;">struct acpi_softc *sc</i>, <i class="farg" style="white-space:nowrap;">struct aml_node *node</i>, <i class="farg" style="white-space:nowrap;">int argc</i>, <i class="farg" style="white-space:nowrap;">struct aml_value *argv</i>, <i class="farg" style="white-space:nowrap;">struct aml_value *res</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">aml_evalname</b>(<i class="farg" style="white-space:nowrap;">struct acpi_softc *sc</i>, <i class="farg" style="white-space:nowrap;">struct aml_node *parent</i>, <i class="farg" style="white-space:nowrap;">const char *name</i>, <i class="farg" style="white-space:nowrap;">int argc</i>, <i class="farg" style="white-space:nowrap;">struct aml_value *argv</i>, <i class="farg" style="white-space:nowrap;">struct aml_value *res</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">aml_find_node</b>(<i class="farg" style="white-space:nowrap;">struct aml_node *node</i>, <i class="farg" style="white-space:nowrap;">const char *name</i>, <i class="farg" style="white-space:nowrap;">int (*cbproc)(struct aml_node *, void *arg)</i>, <i class="farg" style="white-space:nowrap;">void *arg</i>);<div class="spacer">
</div>
<i class="ftype">void</i><br/>
<b class="fname">aml_freevalue</b>(<i class="farg" style="white-space:nowrap;">struct aml_value *val</i>);<div class="spacer">
</div>
<i class="ftype">int64_t</i><br/>
<b class="fname">aml_val2int</b>(<i class="farg" style="white-space:nowrap;">struct aml_value *rval</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The AML API handles decoding and evaluation of the AML code embedded in a machine's ACPI tables. This code is used to implement configuration and control mechanisms for machines.<div class="spacer">
</div>
<b class="fname">aml_evalnode</b>() evaluates the AML node <i class="farg">node</i> located in the ACPI table specified by <i class="farg">sc</i>. Parameters may be passed using the <i class="farg">argv</i> parameters with the parameter <i class="farg">argc</i> specifying the number of parameters passed. If there are no arguments, a value of 0 is used for <i class="farg">argc</i> and <i class="farg">argv</i> should be <span class="define">NULL</span>. If evaluating the node produces any result, for example a string with a device name reference, this result is stored in the <i class="farg">res</i> parameter unless it is <span class="define">NULL</span>. <i class="farg">res</i> is cleared before storing the result. If <i class="farg">node</i> does not exist, <b class="fname">aml_evalnode</b>() returns <span class="define">ACPI_E_BADVALUE</span>, otherwise it returns 0.<div class="spacer">
</div>
<b class="fname">aml_evalname</b>() is similar to <b class="fname">aml_evalnode</b>() but differs in that it searches for a subnode of <i class="farg">parent</i> with the name <i class="farg">name</i>. If such a node is found, it is evaluated using <b class="fname">aml_evalnode</b>(), passing whatever parameters were passed to itself. <b class="fname">aml_evalname</b>() returns the return value of <b class="fname">aml_evalnode</b>().<div class="spacer">
</div>
<b class="fname">aml_find_node</b>() is used to find all subnodes of <i class="farg">parent</i> with a name of <i class="farg">name</i>. For each node found, the function specified as the <i class="farg">cbproc</i> parameter is called with the node and <i class="farg">arg</i> as the first and second parameters, respectively. The function specified as the <i class="farg">cbproc</i> parameter returns a value that specifies if the tree walk should be terminated (!0) or continued (0) with the children. <b class="fname">aml_find_node</b>() always returns 0.<div class="spacer">
</div>
<b class="fname">aml_freevalue</b>() is used to free up the result returned from <b class="fname">aml_evalnode</b>() or the other AML evaluation functions. Note that no attempt is made to free the <span class="type">struct aml_value</span> itself so it is safe to allocate this on the stack. Also, calling <b class="fname">aml_freevalue</b>() with a parameter of <span class="define">NULL</span> is not an error.<div class="spacer">
</div>
<b class="fname">aml_val2int</b>() is used to convert the <span class="type">struct aml_value</span> pointed to by the <i class="farg">rval</i> parameter to a signed 64-bit integer value. Multiple types exist for <span class="type">struct aml_value</span>, and the conversion value depends on the type of the value object as follows. For objects of type <span class="define">AML_OBJTYPE_INTEGER</span> and <span class="define">AML_OBJTYPE_STATICINT</span>, the return value is simply the integer value stored in the object. For objects of type <span class="define">AML_OBJTYPE_BUFFER</span>, the return value is the integer interpretation of the buffer contents. For objects of type <span class="define">AML_OBJTYPE_STRING</span>, the return value is the integer value represented as a string in base 10 or, if prefixed by &#8220;0x&#8221;, in base 16. If <i class="farg">rval</i> is <span class="define">NULL</span> or not of one of the types mentioned above, <b class="fname">aml_val2int</b>() returns 0.</div>
<div class="section">
<h1 id="x4558414d504c4553">EXAMPLES</h1> Using <b class="fname">aml_evalname</b>() to invoke the &#8220;_STA&#8221; method on a node <i class="farg">node</i> should be done like the following:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
struct acpi_softc	*sc 
struct aml_node		*node; 
struct aml_value	res; 
 
if (aml_evalname(sc-&gt;sc_acpi, node, &quot;_STA&quot;, 0, NULL, &amp;res) != 0) { 
	dnprintf(10, &quot;%s: no _STA\n&quot;, DEVNAME(sc)); 
	return; 
}</pre>
<div class="spacer">
</div>
Using the <span class="type">struct aml_value</span> obtained from the &#8220;_STA&#8221; call to determine if the device is a battery is done as follows:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
if ((aml_val2int(&amp;res) &amp; STA_BATTERY) == 0) { 
	dnprintf(10, %s: no battery present\n&quot;, DEVNAME(sc)); 
	return;</pre>
<div class="spacer">
</div>
Finally, when the result stored in <i class="farg">res</i> is no longer needed, free it using <b class="fname">aml_freevalue</b>():<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
aml_freevalue(&amp;res);</pre>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html4/acpi.html">acpi(4)</a>, <a class="link-man" href="../html8/acpidump.html">acpidump(8)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The AML API was written by <span class="author">Jordan Hargrave</span> &lt;<a class="link-mail" href="mailto:jordan@openbsd.org">jordan@openbsd.org</a>&gt;.</div>
</div>
</body>
</html>

