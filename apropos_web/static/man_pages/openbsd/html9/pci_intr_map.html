<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
PCI_INTR_MAP(9)</title>
</head>
<body>
<div class="mandoc">
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">pci_intr_map</b>, <b class="name">pci_intr_map_msi</b>, <b class="name">pci_intr_line</b>, <b class="name">pci_intr_string</b>, <b class="name">pci_intr_establish</b>, <b class="name">pci_intr_disestablish</b> &#8212; <span class="desc">PCI interrupts</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">alpha/pci/pci_machdep.h</a>&gt;</b><br/>
<b class="includes">#include &lt;<a class="link-includes">i386/pci/pci_machdep.h</a>&gt;</b><br/>
<b class="includes">#include &lt;<a class="link-includes">powerpc/pci/pci_machdep.h</a>&gt;</b><br/>
<b class="includes">#include &lt;<a class="link-includes">sgi/pci/pci_machdep.h</a>&gt;</b><br/>
<b class="includes">#include &lt;<a class="link-includes">machine/pci_machdep.h</a>&gt;</b><div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">pci_intr_map</b>(<i class="farg" style="white-space:nowrap;">struct pci_attach_args *paa</i>, <i class="farg" style="white-space:nowrap;">pci_intr_handle_t *ih</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">pci_intr_map_msi</b>(<i class="farg" style="white-space:nowrap;">struct pci_attach_args *paa</i>, <i class="farg" style="white-space:nowrap;">pci_intr_handle_t *ih</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">pci_intr_line</b>(<i class="farg" style="white-space:nowrap;">pci_intr_handle_t ih</i>);<div class="spacer">
</div>
<i class="ftype">const char *</i><br/>
<b class="fname">pci_intr_string</b>(<i class="farg" style="white-space:nowrap;">pci_chipset_tag_t pc</i>, <i class="farg" style="white-space:nowrap;">pci_intr_handle_t ih</i>);<div class="spacer">
</div>
<i class="ftype">void *</i><br/>
<b class="fname">pci_intr_establish</b>(<i class="farg" style="white-space:nowrap;">pci_chipset_tag_t pc</i>, <i class="farg" style="white-space:nowrap;">pci_intr_handle_t ih</i>, <i class="farg" style="white-space:nowrap;">int level</i>, <i class="farg" style="white-space:nowrap;">int (*func)(void *)</i>, <i class="farg" style="white-space:nowrap;">void *arg</i>, <i class="farg" style="white-space:nowrap;">const char *name</i>);<div class="spacer">
</div>
<i class="ftype">void</i><br/>
<b class="fname">pci_intr_disestablish</b>(<i class="farg" style="white-space:nowrap;">pci_chipset_tag_t pc</i>, <i class="farg" style="white-space:nowrap;">void *v</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> These functions are provided by the machine-dependent implementation for attaching handler functions to the interrupts of PCI devices.<div class="spacer">
</div>
An architect type is provided by the machine-dependent code <b class="var">pci_intr_handle_t</b>, to be initialised by <b class="fname">pci_intr_map</b>() or <b class="fname">pci_intr_map_msi</b>().<div class="spacer">
</div>
The <b class="fname">pci_intr_map</b>() function should be called first to establish a mapping between a PCI pin and the interrupt controller's interrupt vector. This process may include resolving the mapping through firmware-provided information. For devices that support Message Signaled Interrupts (MSI) the <b class="fname">pci_intr_map_msi</b>() function should be called instead. This function can fail if the system does not support MSI. In that case <b class="fname">pci_intr_map</b>() should be called to fall back on classic PCI interrupts.<div class="spacer">
</div>
Having initialised the <b class="var">pci_intr_handle_t</b> in the previous step, an interrupt handler can be established using <b class="fname">pci_intr_establish</b>() or converted into printable form using <b class="fname">pci_intr_string</b>(). A handler established using <b class="fname">pci_intr_establish</b>() is always called with the system interrupt priority level set equal to, or higher than, <b class="var">level</b>.<div class="spacer">
</div>
<b class="fname">pci_intr_line</b>() provides the interrupt line extracted from the MD interrupt handle. Upon device detachment, <b class="fname">pci_intr_disestablish</b>() should be used to disassociate the handler from the interrupt.<div class="spacer">
</div>
See <a class="link-man" href="../html9/spl.html">spl(9)</a> for an explanation of the <b class="var">ipl</b> &#8220;interrupt priority levels&#8221;.</div>
<div class="section">
<h1 id="x4558414d504c4553">EXAMPLES</h1> A typical code sequence for establishing a handler for a device interrupt in the driver might be:<div class="spacer">
</div>
<pre style="margin-left: 3.00ex;" class="lit display">
int 
xxxattach(struct device *parent, struct device *self, void *aux) 
{ 
	struct xxx_softc *sc = (struct xxx_softc *)self; 
	struct pci_attach_args *pa = aux; 
	pci_intr_handle_t ih; 
	const char *intrstr; 
	bus_size_t size; 
 
	... 
 
	if (pci_intr_map_msi(pa, &amp;ih) &amp;&amp; pci_intr_map(pa, &amp;ih)) { 
		printf(&quot;: can't map interrupt\n&quot;); 
		bus_space_unmap(sc-&gt;iot, sc-&gt;ioh, size); 
		return; 
	} 
	intrstr = pci_intr_string(pa-&gt;pa_pc, ih); 
	sc-&gt;sc_ih = pci_intr_establish(pa-&gt;pa_pc, ih, IPL_NET, 
	    xxx_intr, sc, sc-&gt;sc_dev.dv_xname); 
	if (!sc-&gt;sc_ih) { 
		printf(&quot;: can't establish interrupt&quot;); 
		if (intrstr) 
			printf(&quot; at %s&quot;, intrstr); 
		printf(&quot;\n&quot;); 
		bus_space_unmap(sc-&gt;iot, sc-&gt;ioh, size); 
		return; 
	} 
 
	printf(&quot;: %s\n&quot;, intrstr); 
 
	... 
}</pre>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html4/cardbus.html">cardbus(4)</a>, <a class="link-man" href="../html4/pci.html">pci(4)</a>, <a class="link-man" href="../html4/pcibios.html">pcibios(4)</a>, <a class="link-man" href="../html9/pci_conf_read.html">pci_conf_read(9)</a>, <a class="link-man" href="../html9/spl.html">spl(9)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> These functions first appeared in <span class="unix">OpenBSD&#160;1.2</span>.</div>
</div>
</body>
</html>

