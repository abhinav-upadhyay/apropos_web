<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
RSSADAPT(9)</title>
</head>
<body>
<div class="mandoc">
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">rssadapt</b>, <b class="name">ieee80211_rssadapt_choose</b>, <b class="name">ieee80211_rssadapt_input</b>, <b class="name">ieee80211_rssadapt_lower_rate</b>, <b class="name">ieee80211_rssadapt_raise_rate</b>, <b class="name">ieee80211_rssadapt_updatestats</b> &#8212; <span class="desc">rate adaptation based on received signal strength</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">net80211/ieee80211_var.h</a>&gt;</b><br/>
<b class="includes">#include &lt;<a class="link-includes">net80211/ieee80211_rssadapt.h</a>&gt;</b><div class="spacer">
</div>
<i class="ftype">void</i><br/>
<b class="fname">ieee80211_rssadapt_input</b>(<i class="farg" style="white-space:nowrap;">struct ieee80211com *ic</i>, <i class="farg" style="white-space:nowrap;">st construct ieee80211_node *ni</i>, <i class="farg" style="white-space:nowrap;">struct ieee80211_rssadapt *ra</i>, <i class="farg" style="white-space:nowrap;">int rssi</i>);<div class="spacer">
</div>
<i class="ftype">void</i><br/>
<b class="fname">ieee80211_rssadapt_lower_rate</b>(<i class="farg" style="white-space:nowrap;">struct ieee80211com *ic</i>, <i class="farg" style="white-space:nowrap;">const struct ieee80211_node *ni</i>, <i class="farg" style="white-space:nowrap;">struct ieee80211_rssadapt *ra</i>, <i class="farg" style="white-space:nowrap;">const struct ieee80211_rssdesc *id</i>);<div class="spacer">
</div>
<i class="ftype">void</i><br/>
<b class="fname">ieee80211_rssadapt_raise_rate</b>(<i class="farg" style="white-space:nowrap;">struct ieee80211com *ic</i>, <i class="farg" style="white-space:nowrap;">struct ieee80211_rssadapt *ra</i>, <i class="farg" style="white-space:nowrap;">const struct ieee80211_rssdesc *id</i>);<div class="spacer">
</div>
<i class="ftype">void</i><br/>
<b class="fname">ieee80211_rssadapt_updatestats</b>(<i class="farg" style="white-space:nowrap;">struct ieee80211_rssadapt *ra</i>);<div class="spacer">
</div>
<i class="ftype">int</i><br/>
<b class="fname">ieee80211_rssadapt_choose</b>(<i class="farg" style="white-space:nowrap;">struct ieee80211_rssadapt *ra</i>, <i class="farg" style="white-space:nowrap;">const struct ieee80211_rateset *rs</i>, <i class="farg" style="white-space:nowrap;">const struct ieee80211_frame *wh</i>, <i class="farg" style="white-space:nowrap;">u_int len</i>, <i class="farg" style="white-space:nowrap;">int fixed_rate</i>, <i class="farg" style="white-space:nowrap;">const char *dvname</i>, <i class="farg" style="white-space:nowrap;">int do_not_adapt</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="name">rssadapt</b> module provides rapid adaptation of transmission data rate to 802.11 device drivers based on received-signal strength (RSS). A driver needs only to provide <b class="name">rssadapt</b> with indications of RSS and failure/success of transmissions for each 802.11 client or peer. For each transmit packet, <b class="name">rssadapt</b> chooses the transmission data rate that offers the best expected throughput, given the packet's length and destination.<div class="spacer">
</div>
<b class="name">rssadapt</b> models an 802.11 channel very simply (see also the <i class="link-sec"><a class="link-sec" href="#x42554753">BUGS</a></i> section). It assumes that the packet-error rate (PER) is determined by the signal-to-noise ratio (S/N) at the receiver, the transmission data rate, and the packet length. The S/N determines the choice of data rate that yields the lowest PER for all packets of a certain length.</div>
<div class="section">
<h1 id="x46554e4354494f4e53">FUNCTIONS</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="fname">ieee80211_rssadapt_choose</b>(<i class="farg">ra</i>, <i class="farg">rs</i>, <i class="farg">wh</i>, <i class="farg">len</i>, <i class="farg">fixed_rate</i>, <i class="farg">dvname</i>, <i class="farg">do_not_adapt</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
<div class="spacer">
</div>
Choose the transmission data rate for a packet.<div class="spacer">
</div>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">ra</i></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Ordinarily, the <b class="name">rssadapt</b> state object belonging to the node which is the packet destination. However, if the destination is a broadcast/multicast address, then <i class="farg">ra</i> belongs to the BSS node, <b class="var">ic-&gt;ic_bss</b>.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">rs</i></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
A list of eligible data rates for the node; for example, the rates negotiated when the node associated with the network.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">len</i></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
The packet length in bytes, including the 802.11 header and frame check sequence (FCS).</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">fixed_rate</i></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
If the operator has set the data rate using, for example, <b class="cmd">ifconfig wi0 media ds1</b>, then <i class="farg">fixed_rate</i> tells the index of that rate in <i class="farg">rs</i>. <b class="name">rssadapt</b> obeys a fixed data rate whenever the 802.11 standard allows it: sometimes the standard requires multicast/broadcast packets to be transmitted at a so-called &#8220;basic rate&#8221;.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">dvname</i></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
The device driver uses <i class="farg">dvname</i> to indicate the name of the interface for the purpose of diagnostic and debug messages. The driver sets <i class="farg">dvname</i> to <span class="define">NULL</span> when no messages are desired.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">do_not_adapt</i></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
If <i class="farg">do_not_adapt</i> is non-zero, then <b class="fname">ieee80211_rssadapt_choose</b>() will choose the highest rate in <i class="farg">rs</i> that suits the destination, regardless of the RSS.</dd>
</dl>
The return value of <b class="fname">ieee80211_rssadapt_choose</b>() is an index into <i class="farg">rs</i>, indicating its choice of transmit data rate.<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="fname">ieee80211_rssadapt_input</b>(<i class="farg">ic</i>, <i class="farg">ni</i>, <i class="farg">ra</i>, <i class="farg">rssi</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The RSS serves as a rough estimate of the S/N at each node. A driver provides RSS updates using <b class="fname">ieee80211_rssadapt_input</b>(), whose arguments are:<div class="spacer">
</div>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">ic</i></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
The wireless interface's 802.11 state object.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">ni</i></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
The 802.11 node whose RSS the driver is updating.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">ra</i></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
The node's <b class="name">rssadapt</b> state object.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">rssi</i></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
The node's received signal strength indication. The range of <i class="farg">rssi</i> is from 0 to 255.</dd>
</dl>
<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="fname">ieee80211_rssadapt_lower_rate</b>(<i class="farg">ic</i>, <i class="farg">ni</i>, <i class="farg">ra</i>, <i class="farg">id</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="fname">ieee80211_rssadapt_raise_rate</b>(<i class="farg">ic</i>, <i class="farg">ra</i>, <i class="farg">id</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Drivers call <b class="fname">ieee80211_rssadapt_raise_rate</b>() and <b class="fname">ieee80211_rssadapt_lower_rate</b>() to indicate transmit successes and failures, respectively.<div class="spacer">
</div>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">ic</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The 802.11 state object.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">ni</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The neighbor to whom the driver transmitted.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">ra</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The neighbor's <b class="name">rssadapt</b> state object.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">id</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Displays statistics on the transmission attempt.</dd>
</dl>
<div class="spacer">
</div>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="fname">ieee80211_rssadapt_updatestats</b>(<i class="farg">ra</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
An 802.11 node is eligible for its RSS thresholds to decay every 1/10 to 10 seconds. It is eligible more often (every 1/10 second) at high packet rates, and less often (every 10 seconds) at low packet rates. A driver assists <b class="name">rssadapt</b> in tracking the exponential-average packet rate by calling <b class="fname">ieee80211_rssadapt_updatestats</b>() every 1/10th second for each node's <span class="type">ieee80211_rssadapt</span> object.<div class="spacer">
</div>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">ra</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The neighbor's <b class="name">rssadapt</b> state object.</dd>
</dl>
</dd>
</dl>
</div>
<div class="section">
<h1 id="x414c474f524954484d">ALGORITHM</h1> <b class="name">rssadapt</b> monitors the RSS from neighboring 802.11 nodes, recording the exponential average RSS in each neighbor's <span class="type">ieee80211_rssadapt</span> structure. <b class="name">rssadapt</b> uses transmit success/failure feedback from the device driver to fill a table of RSS thresholds. The table is indexed by packet size, <b class="var">L</b>, and a data rate, <b class="var">R</b>, to find out the minimum exponential-average RSS that a node must show before <b class="name">rssadapt</b> will indicate that a packet <b class="var">L</b> bytes long can be transmitted R bits per second with optimal expected throughput.<div class="spacer">
</div>
When the driver indicates a unicast packet is transmitted unsuccessfully (that is, the NIC received no ACK for the packet), <b class="name">rssadapt</b> will move the corresponding RSS threshold toward the exponential average RSSI at the time of transmission. Thus several consecutive transmit failures for the same &#10216;<b class="var">L</b>, <b class="var">R</b>&#10217; tuple will ensure that the RSS threshold rises high enough that rate <b class="var">R</b> is abandoned for packets <b class="var">L</b> bytes long. When the driver indicates a successful transmission, the RSS threshold corresponding to the same packet length, but the next higher data rate, is lowered slightly. The RSS threshold is said to &#8220;decay&#8221;. This ensures that occasionally <b class="name">rssadapt</b> indicates the driver should try the next higher data rate, just in case conditions at the receiver have changed (for example, noise levels have fallen) and a higher data rate can be supported at the same RSS level.<div class="spacer">
</div>
The rate of decay is controlled. In an interval of 1/10th second to 10 seconds, only one RSS threshold per neighbor may decay. The interval is connected to the exponential-average rate that packets are being transmitted. At high packet rates, the interval is shortest. It is longest at low packet rates. The rationale for this is that RSS thresholds should not decay rapidly if there is no information from packet transmissions to counteract their decay.</div>
<div class="section">
<h1 id="x444154412053545255435455524553">DATA STRUCTURES</h1> An <span class="type">ieee80211_rssdesc</span> describes a transmission attempt.<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
struct ieee80211_rssdesc { 
        u_int                    id_len; 
        u_int                    id_rateidx; 
        struct ieee80211_node   *id_node; 
        u_int8_t                 id_rssi; 
};</pre>
<div class="spacer">
</div>
<i class="farg">id_len</i> is the length, in bytes, of the transmitted packet. <i class="farg">id_node</i> points to the neighbor's <span class="type">ieee8021_node</span>, and <i class="farg">id_rssi</i> is the exponential-average RSS at the time the packet was transmitted. <i class="farg">id_rateidx</i> is an index into the destination neighbor's rate-set, <i class="farg">id_node-&gt;ni_rates</i>, indicating the transmit data rate for the packet.<div class="spacer">
</div>
<span class="type">ieee80211_rssadapt</span> contains the rate-adaptation state for a neighboring 802.11 node. Ordinarily a driver will &#8220;subclass&#8221; <span class="type">ieee80211_node</span>. The <span class="type">ieee80211_rssadapt</span> structure will be a subclass member. In this way, every node's <b class="name">rssadapt</b> condition is independently tracked and stored in its node object.<div class="spacer">
</div>
<pre style="margin-left: 4.00ex;" class="lit display">
struct ieee80211_rssadapt { 
        u_int16_t               ra_avg_rssi; 
        u_int32_t               ra_nfail; 
        u_int32_t               ra_nok; 
        u_int32_t               ra_pktrate; 
        u_int16_t               ra_rate_thresh[IEEE80211_RSSADAPT_BKTS] 
                                              [IEEE80211_RATE_SIZE]; 
        struct timeval          ra_last_raise; 
        struct timeval          ra_raise_interval; 
};</pre>
<div class="spacer">
</div>
<i class="farg">ra_avg_rssi</i> is the exponential-average RSS, shifted left 8 bits. <i class="farg">ra_nfail</i> indicates the number of transmit failures in the current update interval; <i class="farg">ra_nok</i> the number of transmit successes in the current update interval. <i class="farg">ra_pktrate</i> indicates the exponential average number of transmit failure/success indications over past update intervals. This approximates the rate of packet-transmission. <i class="farg">ra_rate_thresh</i> contains RSS thresholds that are indexed by &#10216;packet length, data rate&#10217; tuples. When this node's exponential-average RSS exceeds <i class="farg">ra_rate_thresh[i][j]</i>, then packets at most 128 x 8^i bytes long are eligible to be transmitted at the rate indexed by j.<div class="spacer">
</div>
<i class="farg">ra_last_raise</i> and <i class="farg">ra_raise_interval</i> are used to control the rate that RSS thresholds &#8220;decay&#8221;. <i class="farg">ra_last_raise</i> indicates when <b class="fname">ieee80211_rssadapt_raise_rate</b>() was last called and <i class="farg">ra_raise_interval</i> indicates the minimum period between consecutive calls to <b class="fname">ieee80211_rssadapt_raise_rate</b>(). If <b class="fname">ieee80211_rssadapt_raise_rate</b>() is called more than once in any period, the second and subsequent calls are ignored.</div>
<div class="section">
<h1 id="x434f4445205245464552454e434553">CODE REFERENCES</h1> This section describes places within the <span class="unix">OpenBSD</span> source tree where actual code implementing or using <b class="name">rssadapt</b> can be found. All pathnames are relative to <i class="file">/usr/src</i>.<div class="spacer">
</div>
The code for <b class="name">rssadapt</b> is in the file <i class="file">sys/net80211/ieee80211_rssadapt.c</i>.<div class="spacer">
</div>
<a class="link-man" href="../html4/ath.html">ath(4)</a> contains a reference implementation. See <i class="file">sys/dev/ic/ath.c</i>.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html4/ath.html">ath(4)</a>, <a class="link-man" href="../html9/ieee80211.html">ieee80211(9)</a><div class="spacer">
</div>
<span class="ref"><span class="ref-auth">Javier del Prado Pavon</span> and <span class="ref-auth">Sunghyun Choi</span>, <span class="ref-title">Link Adaptation Strategy for IEEE 802.11 WLAN via Received Signal Strength Measurement</span>, <i class="ref-jrnl">ICC'03</i>, <span class="ref-page">pp. 1108-1113</span>, <span class="ref-city">Anchorage, Alaska</span>, <span class="ref-date">May 2003</span>.</span></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> <b class="name">rssadapt</b> first appeared in <span class="unix">NetBSD</span> and was ported to <span class="unix">OpenBSD</span> by <span class="author">Todd C. Miller</span> &lt;<a class="link-mail" href="mailto:millert@OpenBSD.org">millert@OpenBSD.org</a>&gt;</div>
<div class="section">
<h1 id="x415554484f5253">AUTHORS</h1> <span class="author">David Young</span> &lt;<a class="link-mail" href="mailto:dyoung@NetBSD.org">dyoung@NetBSD.org</a>&gt;</div>
<div class="section">
<h1 id="x42554753">BUGS</h1> To cope with interference from microwave ovens, frequency-hopping radios, and other sources of RF pulse-trains and bursts, <b class="name">rssadapt</b> should adapt the fragmentation threshold as well as the data rate.<div class="spacer">
</div>
For improved throughput, <b class="name">rssadapt</b> should indicate to drivers when they should use the 802.11b short-preamble.<div class="spacer">
</div>
The constants in <b class="fname">ieee80211_rssadapt_updatestats</b>() should be configurable.</div>
</div>
</body>
</html>

