<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
SOFTRAID(4)</title>
</head>
<body>
<div class="mandoc">
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">softraid</b> &#8212; <span class="desc">software RAID</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="config">softraid0 at root</b></div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="name">softraid</b> device emulates a Host Bus Adapter (HBA) that provides RAID and other I/O related services. The <b class="name">softraid</b> device provides a scaffold to implement more complex I/O transformation disciplines. For example, one can tie chunks together into a mirroring discipline. There really is no limit on what type of discipline one can write as long as it fits the SCSI model.<div class="spacer">
</div>
<b class="name">softraid</b> supports a number of <span class="emph">disciplines</span>. A discipline is a collection of functions that provides specific I/O functionality. This includes I/O path, bring-up, failure recovery, and statistical information gathering. Essentially a discipline is a lower level driver that provides the I/O transformation for the softraid device.<div class="spacer">
</div>
A <span class="emph">volume</span> is a virtual disk device that is made up of a collection of chunks.<div class="spacer">
</div>
A <span class="emph">chunk</span> is a partition or storage area of fstype &#8220;RAID&#8221;. <a class="link-man" href="../html8/disklabel.html">disklabel(8)</a> is used to alter the fstype.<div class="spacer">
</div>
Currently <b class="name">softraid</b> supports the following disciplines:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 6.00ex;" class="list list-ohang">
<dt class="list-ohang" style="margin-top: 1.00em;">
RAID 0</dt>
<dd class="list-ohang">
A <span class="emph">striping</span> discipline. It segments data over a number of chunks to increase performance. RAID 0 does not provide for data loss (redundancy).</dd>
<dt class="list-ohang" style="margin-top: 1.00em;">
RAID 1</dt>
<dd class="list-ohang">
A <span class="emph">mirroring</span> discipline. It copies data across more than one chunk to provide for data loss. Read performance is increased, though at the cost of write speed. Unlike traditional RAID 1, <b class="name">softraid</b> supports the use of more than two chunks in a RAID 1 setup.</dd>
<dt class="list-ohang" style="margin-top: 1.00em;">
RAID 5</dt>
<dd class="list-ohang">
A striping discipline with <span class="emph">floating parity</span> across all chunks. It stripes data across chunks and provides parity to prevent data loss of a single chunk failure. Read performance is increased; write performance does incur additional overhead.</dd>
<dt class="list-ohang" style="margin-top: 1.00em;">
CRYPTO</dt>
<dd class="list-ohang">
An <span class="emph">encrypting</span> discipline. It encrypts data on a single chunk to provide for data confidentiality. CRYPTO does not provide redundancy.</dd>
<dt class="list-ohang" style="margin-top: 1.00em;">
CONCAT</dt>
<dd class="list-ohang">
A <span class="emph">concatenating</span> discipline. It writes data to each chunk in sequence to provide increased capacity. CONCAT does not provide redundancy.</dd>
</dl>
<div class="spacer">
</div>
<a class="link-man" href="../html8/installboot.html">installboot(8)</a> may be used to install <a class="link-man" href="../html8/boot.html">boot(8)</a> in the boot storage area of the <b class="name">softraid</b> volume. Boot support is currently limited to the CRYPTO and RAID 1 disciplines on amd64, i386, and sparc64 platforms. On sparc64, bootable chunks must be RAID partitions using the letter &#8216;a&#8217;. At the <a class="link-man" href="../html8/boot.html">boot(8)</a> prompt, softraid volumes have names beginning with &#8216;sr&#8217; and can be booted from like a normal disk device. CRYPTO volumes will require a decryption passphrase or keydisk at boot time.</div>
<div class="section">
<h1 id="x4558414d504c4553">EXAMPLES</h1> An example to create a 3 chunk RAID 1 from scratch is as follows:<div class="spacer">
</div>
Initialize the partition tables of all disks:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
# fdisk -iy wd1 
# fdisk -iy wd2 
# fdisk -iy wd3</pre>
<div class="spacer">
</div>
Now create RAID partitions on all disks:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
# printf &quot;a\n\n\n\nRAID\nw\nq\n\n&quot; | disklabel -E wd1 
# printf &quot;a\n\n\n\nRAID\nw\nq\n\n&quot; | disklabel -E wd2 
# printf &quot;a\n\n\n\nRAID\nw\nq\n\n&quot; | disklabel -E wd3</pre>
<div class="spacer">
</div>
Assemble the RAID volume:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
# bioctl -c 1 -l /dev/wd1a,/dev/wd2a,/dev/wd3a softraid0</pre>
<div class="spacer">
</div>
The console will show what device was added to the system:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
scsibus0 at softraid0: 1 targets 
sd0 at scsibus0 targ 0 lun 0: &lt;OPENBSD, SR RAID 1, 001&gt; SCSI2 
sd0: 1MB, 0 cyl, 255 head, 63 sec, 512 bytes/sec, 3714 sec total</pre>
<div class="spacer">
</div>
It is good practice to wipe the front of the disk before using it:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
# dd if=/dev/zero of=/dev/rsd0c bs=1m count=1</pre>
<div class="spacer">
</div>
Initialize the partition table and create a filesystem on the new RAID volume:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
# fdisk -iy sd0 
# printf &quot;a\n\n\n\n4.2BSD\nw\nq\n\n&quot; | disklabel -E sd0 
# newfs /dev/rsd0a</pre>
<div class="spacer">
</div>
The RAID volume is now ready to be used as a normal disk device. See <a class="link-man" href="../html8/bioctl.html">bioctl(8)</a> for more information on configuration of RAID sets.<div class="spacer">
</div>
Install <a class="link-man" href="../html8/boot.html">boot(8)</a> on the RAID volume:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
# installboot sd0</pre>
<div class="spacer">
</div>
At the <a class="link-man" href="../html8/boot.html">boot(8)</a> prompt, load the /bsd kernel from the RAID volume:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
boot&gt; boot sr0a:/bsd</pre>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html4/bio.html">bio(4)</a>, <a class="link-man" href="../html8/bioctl.html">bioctl(8)</a>, <a class="link-man" href="../html8/boot_sparc64.html">boot_sparc64(8)</a>, <a class="link-man" href="../html8/disklabel.html">disklabel(8)</a>, <a class="link-man" href="../html8/fdisk.html">fdisk(8)</a>, <a class="link-man" href="../html8/installboot.html">installboot(8)</a>, <a class="link-man" href="../html8/newfs.html">newfs(8)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="name">softraid</b> driver first appeared in <span class="unix">OpenBSD&#160;4.2</span>.</div>
<div class="section">
<h1 id="x415554484f5253">AUTHORS</h1> <span class="author">Marco Peereboom</span>.</div>
<div class="section">
<h1 id="x43415645415453">CAVEATS</h1> The driver relies on underlying hardware to properly fail chunks.<div class="spacer">
</div>
The RAID 1 discipline does not initialize the mirror upon creation. This is by design because all sectors that are read are written first. There is no point in wasting a lot of time syncing random data.<div class="spacer">
</div>
The RAID 5 discipline does not initialize parity upon creation, instead parity is only updated upon write.<div class="spacer">
</div>
Currently there is no automated mechanism to recover from failed disks.<div class="spacer">
</div>
Certain RAID levels can protect against some data loss due to component failure. RAID is <span class="emph">not</span> a substitute for good backup practices.</div>
</div>
</body>
</html>

