<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
SPKR(4)</title>
</head>
<body>
<div class="mandoc">
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">speaker</b>, <b class="name">spkr</b> &#8212; <span class="desc">console speaker device driver</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="config">spkr0	at pcppi?</b></div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="name">speaker</b> device driver allows applications to control the built-in speaker on machines providing a PCPPI speaker interface.<div class="spacer">
</div>
Only one process may have this device open at any given time; <a class="link-man" href="../html2/open.html">open(2)</a> and <a class="link-man" href="../html2/close.html">close(2)</a> are used to lock and relinquish it. An attempt to <b class="fname">open</b>() when another process has the device locked will return -1 with an <span class="errno">EBUSY</span> error indication. Writes to the device are interpreted as &#8220;play strings&#8221; in a simple ASCII melody notation. An <b class="fname">ioctl</b>() for tone generation at arbitrary frequencies is also supported.<div class="spacer">
</div>
Sound-generation does <span class="emph">not</span> monopolize the processor; in fact, the driver spends most of its time sleeping while the PC hardware is emitting tones. Other processes may emit beeps while the driver is running.<div class="spacer">
</div>
Applications may call <b class="fname">ioctl</b>() on a speaker file descriptor to control the speaker driver directly; definitions for the <b class="fname">ioctl</b>() interface are in <b class="includes">&lt;<a class="link-includes">dev/isa/spkrio.h</a>&gt;</b>. The <code class="lit">tone_t</code> structure used in these calls has two fields, specifying a frequency (in Hz) and a duration (in 1/100ths of a second). A frequency of zero is interpreted as a rest.<div class="spacer">
</div>
At present there are two such ioctls. The <span class="define">SPKRTONE</span> ioctl accepts a pointer to a single tone structure as a third argument and plays it. The <span class="define">SPKRTUNE</span> ioctl accepts a pointer to the first of an array of tone structures and plays them in continuous sequence; this array must be terminated by a final member with a zero duration.<div class="spacer">
</div>
The play-string language is modelled on the PLAY statement conventions of IBM BASIC 2.0. The MB, MF and X primitives of PLAY are not useful in a UNIX environment and are omitted. The &#8220;octave-tracking&#8221; feature is also new.<div class="spacer">
</div>
There are 84 accessible notes numbered 1-83 in 7 octaves, each running from C to B, numbered 0-6; the scale is equal-tempered A440 and octave 3 starts with middle C. By default, the play function emits half-second notes with the last 1/16th second being &#8220;rest time&#8221;.<div class="spacer">
</div>
Play strings are interpreted left to right as a series of play command groups; letter case is ignored. Play command groups are as follows:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
CDEFGAB</dt>
<dd class="list-tag" style="margin-left: 3.00ex;">
Letters A through G cause the corresponding note to be played in the current octave. A note letter may optionally be followed by an &#8220;accidental sign&#8221;, one of &#8216;<code class="lit">#</code>&#8217;, &#8216;<code class="lit">+</code>&#8217;, or &#8216;<code class="lit">-</code>&#8217;; the first two of these cause it to be sharped one half-tone, the last causes it to be flatted one half-tone. It may also be followed by a time value number and by sustain dots (see below). Time values are interpreted as for the L command below;.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
O &#10216;<i class="arg">n</i>&#10217;</dt>
<dd class="list-tag" style="margin-left: 3.00ex;">
If <i class="arg">n</i> is numeric, this sets the current octave. <i class="arg">n</i> may also be one of &#8216;L&#8217; or &#8216;N&#8217; to enable or disable octave-tracking (it is disabled by default). When octave-tracking is on, interpretation of a pair of letter notes will change octaves if necessary in order to make the smallest possible jump between notes. Thus &#8220;olbc&#8221; will be played as &#8220;olb&gt;c&#8221;, and &#8220;olcb&#8221; as &#8220;olc&lt;b&#8221;. Octave locking is disabled for one letter note following by &#8216;<code class="lit">&gt;</code>&#8217;, &#8216;<code class="lit">&lt;</code>&#8217;, and &#8216;<code class="lit">O[0123456]</code>&#8217;.<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
&gt; -- bump the current octave up one. 
&lt; -- drop the current octave down one.</pre>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
N &#10216;<i class="arg">n</i>&#10217;</dt>
<dd class="list-tag" style="margin-left: 3.00ex;">
Play note <i class="arg">n</i>, <i class="arg">n</i> being 1 to 84 or 0 for a rest of current time value. May be followed by sustain dots.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
L &#10216;<i class="arg">n</i>&#10217;</dt>
<dd class="list-tag" style="margin-left: 3.00ex;">
Sets the current time value for notes. The default is L4, quarter notes. The lowest possible value is 1; values up to 64 are accepted. L1 sets whole notes, L2 sets half notes, L4 sets quarter notes, etc.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
P &#10216;<i class="arg">n</i>&#10217;</dt>
<dd class="list-tag" style="margin-left: 3.00ex;">
Pause (rest), with <i class="arg">n</i> interpreted as for L. May be followed by sustain dots. May also be written &#8216;<code class="lit">~</code>&#8217;.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
T &#10216;<i class="arg">n</i>&#10217;</dt>
<dd class="list-tag" style="margin-left: 3.00ex;">
Sets the number of quarter notes per minute; default is 120. Musical names for common tempi are:<table style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 6.00ex;" class="list list-col">
<col style="width: 11.00ex;"/>
<col style="width: 11.00ex;"/>
<col style="min-width: 16.00ex;"/>
<tbody>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<span class="emph">Description</span></td>
<td class="list-col" style="margin-top: 1.00em;">
<span class="emph">Tempo</span></td>
<td class="list-col" style="margin-top: 1.00em;">
<span class="emph">Beats per Minute</span></td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
very slow</td>
<td class="list-col" style="margin-top: 1.00em;">
Larghissimo</td>
<td class="list-col" style="margin-top: 1.00em;">
40&#8211;60</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
very slow</td>
<td class="list-col" style="margin-top: 1.00em;">
Largo</td>
<td class="list-col" style="margin-top: 1.00em;">
40&#8211;60</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
very slow</td>
<td class="list-col" style="margin-top: 1.00em;">
Larghetto</td>
<td class="list-col" style="margin-top: 1.00em;">
60&#8211;66</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
very slow</td>
<td class="list-col" style="margin-top: 1.00em;">
Grave</td>
<td class="list-col" style="margin-top: 1.00em;">
60&#8211;66</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
very slow</td>
<td class="list-col" style="margin-top: 1.00em;">
Lento</td>
<td class="list-col" style="margin-top: 1.00em;">
60&#8211;66</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
slow</td>
<td class="list-col" style="margin-top: 1.00em;">
Adagio</td>
<td class="list-col" style="margin-top: 1.00em;">
66&#8211;76</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
slow</td>
<td class="list-col" style="margin-top: 1.00em;">
Adagietto</td>
<td class="list-col" style="margin-top: 1.00em;">
66&#8211;76</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
medium</td>
<td class="list-col" style="margin-top: 1.00em;">
Andante</td>
<td class="list-col" style="margin-top: 1.00em;">
76&#8211;108</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
medium</td>
<td class="list-col" style="margin-top: 1.00em;">
Andantino</td>
<td class="list-col" style="margin-top: 1.00em;">
76&#8211;108</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
fast</td>
<td class="list-col" style="margin-top: 1.00em;">
Moderato</td>
<td class="list-col" style="margin-top: 1.00em;">
108&#8211;120</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
fast</td>
<td class="list-col" style="margin-top: 1.00em;">
Allegretto</td>
<td class="list-col" style="margin-top: 1.00em;">
108&#8211;120</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
fast</td>
<td class="list-col" style="margin-top: 1.00em;">
Allegro</td>
<td class="list-col" style="margin-top: 1.00em;">
120&#8211;168</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
fast</td>
<td class="list-col" style="margin-top: 1.00em;">
Vivace</td>
<td class="list-col" style="margin-top: 1.00em;">
120&#8211;168</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
fast</td>
<td class="list-col" style="margin-top: 1.00em;">
Veloce</td>
<td class="list-col" style="margin-top: 1.00em;">
120&#8211;168</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
very fast</td>
<td class="list-col" style="margin-top: 1.00em;">
Presto</td>
<td class="list-col" style="margin-top: 1.00em;">
168&#8211;208</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
very fast</td>
<td class="list-col" style="margin-top: 1.00em;">
Prestissimo</td>
<td class="list-col" style="margin-top: 1.00em;">
168&#8211;208</td>
</tr>
</tbody>
</table>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
M[LNS]</dt>
<dd class="list-tag" style="margin-left: 3.00ex;">
Set articulation. MN (N for normal) is the default; the last 1/8th of the note's value is rest time. You can set ML for legato (no rest space) or MS (staccato) 1/4 rest space.</dd>
</dl>
<div class="spacer">
</div>
Notes (that is, CDEFGAB or N command character groups) may be followed by sustain dots. Each dot causes the note's value to be lengthened by one-half for each one. Thus, a note dotted once is held for 3/2 of its undotted value; dotted twice, it is held 9/4, and three times would give 27/8.<div class="spacer">
</div>
Whitespace in play strings is simply skipped and may be used to separate melody sections.</div>
<div class="section">
<h1 id="x46494c4553">FILES</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/dev/speaker</i></dt>
<dd class="list-tag" style="margin-left: 32.00ex;">
</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html4/intro.html">intro(4)</a>, <a class="link-man" href="../html4/pcppi.html">pcppi(4)</a></div>
<div class="section">
<h1 id="x415554484f5253">AUTHORS</h1> <span class="author">Eric S. Raymond</span> &lt;<a class="link-mail" href="mailto:esr@snark.thyrsus.com">esr@snark.thyrsus.com</a>&gt;, Feb 1990</div>
<div class="section">
<h1 id="x42554753">BUGS</h1> Due to roundoff in the pitch tables and slop in the tone-generation and timer hardware (neither of which was designed for precision), neither pitch accuracy nor timings will be mathematically exact.<div class="spacer">
</div>
There is no volume control.<div class="spacer">
</div>
In play strings which are very long (longer than your system's physical I/O blocks) note suffixes or numbers may occasionally be parsed incorrectly due to crossing a block boundary.</div>
</div>
</body>
</html>

