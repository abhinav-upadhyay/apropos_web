<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
GRE(4)</title>
</head>
<body>
<div class="mandoc">
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">gre</b> &#8212; <span class="desc">encapsulating network device</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="config">pseudo-device gre</b></div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="name">gre</b> network interface allows tunnel construction using the Cisco GRE or the Mobile IP (RFC 2004) encapsulation protocols.<div class="spacer">
</div>
GRE, WCCPv1, and Mobile IP are enabled with the following <a class="link-man" href="../html3/sysctl.html">sysctl(3)</a> variables respectively in <i class="file">/etc/sysctl.conf</i>:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="var">net.inet.gre.allow</b></dt>
<dd class="list-tag" style="margin-left: 23.00ex;">
Allow GRE packets in and out of the system.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="var">net.inet.gre.wccp</b></dt>
<dd class="list-tag" style="margin-left: 23.00ex;">
Set to 1 to allow WCCPv1-style GRE packets into the system; set to 2 to handle the packets as WCCPv2-style GRE, truncating the redirect header. This variable depends on <b class="var">gre.allow</b> being set.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="var">net.inet.mobileip.allow</b></dt>
<dd class="list-tag" style="margin-left: 23.00ex;">
Allow Mobile IP packets in and out of the system.</dd>
</dl>
<div class="spacer">
</div>
A <b class="name">gre</b> interface can be created at runtime using the <b class="cmd">ifconfig gre</b><i class="arg">N</i> <b class="cmd">create</b> command or by setting up a <a class="link-man" href="../html5/hostname.if.html">hostname.if(5)</a> configuration file for <a class="link-man" href="../html8/netstart.html">netstart(8)</a>.<div class="spacer">
</div>
This driver currently supports the following modes of operation:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
GRE encapsulation (IP protocol number 47)</dt>
<dd class="list-tag" style="margin-left: 3.00ex;">
Encapsulated datagrams are prepended by an outer datagram and a GRE header. The GRE header specifies the type of the encapsulated datagram and thus allows for tunneling other protocols than IP like e.g. AppleTalk. GRE mode is the default tunnel mode on Cisco routers. This is also the default mode of operation of the <b class="name">gre</b> interfaces.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
MOBILE encapsulation (IP protocol number 55)</dt>
<dd class="list-tag" style="margin-left: 3.00ex;">
Datagrams are encapsulated into IP, but with a much smaller encapsulation header. This protocol only supports IP in IP encapsulation, and is intended for use with Mobile IP.</dd>
</dl>
<div class="spacer">
</div>
The network interfaces are named <code class="lit">gre0</code>, <code class="lit">gre1</code>, etc. The number of interfaces is given by the corresponding <b class="cmd">pseudo-device</b> line in the system configuration file. <b class="name">gre</b> interfaces support the following <a class="link-man" href="../html2/ioctl.html">ioctl(2)</a>s:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">GRESADDRS</span> <i class="farg">struct ifreq *</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Set the IP address of the local tunnel end.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">GRESADDRD</span> <i class="farg">struct ifreq *</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Set the IP address of the remote tunnel end.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">GREGADDRS</span> <i class="farg">struct ifreq *</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Query the IP address that is set for the local tunnel end.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">GREGADDRD</span> <i class="farg">struct ifreq *</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Query the IP address that is set for the remote tunnel end.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">GRESPROTO</span> <i class="farg">struct ifreq *</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Set the operation mode to the specified IP protocol value. The protocol is passed to the interface in the <b class="var">ifr_flags</b> field of the <span class="type">ifreq</span> structure. The operation mode can also be set with the following modifiers to <a class="link-man" href="../html8/ifconfig.html">ifconfig(8)</a>:<div class="spacer">
</div>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 6.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="flag">link0</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
<span class="define">IPPROTO_GRE</span></dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="flag">-link0</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
<span class="define">IPPROTO_MOBILE</span></dd>
</dl>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">GREGPROTO</span> <i class="farg">struct ifreq *</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Query operation mode.</dd>
</dl>
<div class="spacer">
</div>
Note that the IP addresses of the tunnel endpoints may be the same as the ones defined with <a class="link-man" href="../html8/ifconfig.html">ifconfig(8)</a> for the interface (as if IP is encapsulated), but need not be, as e.g. when encapsulating AppleTalk.</div>
<div class="section">
<h1 id="x4558414d504c4553">EXAMPLES</h1> Configuration example:<div class="spacer">
</div>
<pre style="margin-left: 0.00ex;" class="lit display">
Host X ---- Host A ------------ tunnel ------------ Cisco D ---- Host E 
               \                                      / 
                \                                    / 
                 +------ Host B ------ Host C ------+</pre>
<div class="spacer">
</div>
On Host A (OpenBSD):<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
# route add default B 
# ifconfig greN create 
# ifconfig greN A D netmask 0xffffffff linkX up 
# ifconfig greN tunnel A D 
# route add E D</pre>
<div class="spacer">
</div>
On Host D (Cisco):<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
Interface TunnelX 
 ip unnumbered D   ! e.g. address from Ethernet interface 
 tunnel source D   ! e.g. address from Ethernet interface 
 tunnel destination A 
ip route C &lt;some interface and mask&gt; 
ip route A mask C 
ip route X mask tunnelX</pre>
<div class="spacer">
</div>
OR<div class="spacer">
</div>
On Host D (OpenBSD):<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
# route add default C 
# ifconfig greN create 
# ifconfig greN D A 
# ifconfig greN tunnel D A</pre>
<div class="spacer">
</div>
To reach Host A over the tunnel (from Host D), there has to be an alias on Host A for the Ethernet interface:<div class="spacer">
</div>
<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit"># ifconfig &lt;etherif&gt; alias Y</code></div>
</blockquote>
<div class="spacer">
</div>
and on the Cisco:<div class="spacer">
</div>
<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit">ip route Y mask tunnelX</code></div>
</blockquote>
<div class="spacer">
</div>
Keepalive packets may optionally be sent to the remote endpoint, which decapsulates and returns them, allowing tunnel failure to be detected. Enable them like this:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
# ifconfig greN keepalive period count</pre>
<div class="spacer">
</div>
This will send a keepalive packet every <i class="arg">period</i> seconds. If no response is received in <i class="arg">count</i> * <i class="arg">period</i> seconds, the link is considered down. To return keepalives, the remote host must be configured to forward packets:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
# sysctl net.inet.ip.forwarding=1</pre>
<div class="spacer">
</div>
If <a class="link-man" href="../html4/pf.html">pf(4)</a> is enabled then it is necessary to add a pass rule specific for the keepalive packets. The rule must use <span class="emph">no state</span> because the keepalive packet is entering the network stack multiple times. In most cases the following should work:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
pass quick on gre proto gre no state</pre>
</div>
<div class="section">
<h1 id="x4e4f544553">NOTES</h1> The MTU of <b class="name">gre</b> interfaces is set to 1476 by default to match the value used by Cisco routers. This may not be an optimal value, depending on the link between the two tunnel endpoints. It can be adjusted via <a class="link-man" href="../html8/ifconfig.html">ifconfig(8)</a>.<div class="spacer">
</div>
For correct operation, the <b class="name">gre</b> device needs a route to the destination, that is less specific than the one over the tunnel. (There needs to be a route to the decapsulating host that does not run over the tunnel, as this would create a loop.)<div class="spacer">
</div>
In order for <a class="link-man" href="../html8/ifconfig.html">ifconfig(8)</a> to actually mark the interface as up, the keyword <b class="flag">up</b> must be given last on its command line.<div class="spacer">
</div>
The kernel must be set to forward datagrams by issuing the appropriate option to <a class="link-man" href="../html8/sysctl.html">sysctl(8)</a>.<div class="spacer">
</div>
The GRE interface will accept WCCPv1-style or WWCPv2-style GRE encapsulated packets from a Cisco router. Some magic with the packet filter configuration and a caching proxy like squid are needed to do anything useful with these packets.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html4/inet.html">inet(4)</a>, <a class="link-man" href="../html4/ip.html">ip(4)</a>, <a class="link-man" href="../html4/netintro.html">netintro(4)</a>, <a class="link-man" href="../html4/options.html">options(4)</a>, <a class="link-man" href="../html5/hostname.if.html">hostname.if(5)</a>, <a class="link-man" href="../html5/protocols.html">protocols(5)</a>, <a class="link-man" href="../html8/ifconfig.html">ifconfig(8)</a>, <a class="link-man" href="../html8/netstart.html">netstart(8)</a>, <a class="link-man" href="../html8/sysctl.html">sysctl(8)</a></div>
<div class="section">
<h1 id="x5354414e4441524453">STANDARDS</h1> <span class="ref"><span class="ref-auth">S. Hanks</span>, <span class="ref-auth">T. Li</span>, <span class="ref-auth">D. Farinacci</span>, and <span class="ref-auth">P. Traina</span>, <span class="ref-title">Generic Routing Encapsulation (GRE)</span>, <span class="ref-rep">RFC 1701</span>, <span class="ref-date">October 1994</span>.</span><div class="spacer">
</div>
<span class="ref"><span class="ref-auth">S. Hanks</span>, <span class="ref-auth">T. Li</span>, <span class="ref-auth">D. Farinacci</span>, and <span class="ref-auth">P. Traina</span>, <span class="ref-title">Generic Routing Encapsulation over IPv4 networks</span>, <span class="ref-rep">RFC 1702</span>, <span class="ref-date">October 1994</span>.</span><div class="spacer">
</div>
<span class="ref"><span class="ref-auth">C. Perkins</span>, <span class="ref-title">Minimal Encapsulation within IP</span>, <span class="ref-rep">RFC 2004</span>, <span class="ref-date">October 1996</span>.</span><div class="spacer">
</div>
<span class="ref"><span class="ref-title">Web Cache Coordination Protocol V1.0</span>, <a class="link-ref" href="http://www.wrec.org/Drafts/draft-ietf-wrec-web-pro-00.txt">http://www.wrec.org/Drafts/draft-ietf-wrec-web-pro-00.txt</a>.</span><div class="spacer">
</div>
<span class="ref"><span class="ref-title">Web Cache Coordination Protocol V2.0</span>, <a class="link-ref" href="http://www.wrec.org/Drafts/draft-wilson-wrec-wccp-v2-00.txt">http://www.wrec.org/Drafts/draft-wilson-wrec-wccp-v2-00.txt</a>.</span></div>
<div class="section">
<h1 id="x415554484f5253">AUTHORS</h1> <span class="author">Heiko W. Rupp</span> &lt;<a class="link-mail" href="mailto:hwr@pilhuhn.de">hwr@pilhuhn.de</a>&gt;</div>
<div class="section">
<h1 id="x42554753">BUGS</h1> GRE RFC not yet fully implemented (no GRE options).<div class="spacer">
</div>
The redirect header for WCCPv2 GRE encapsulated packets is skipped.</div>
</div>
</body>
</html>

