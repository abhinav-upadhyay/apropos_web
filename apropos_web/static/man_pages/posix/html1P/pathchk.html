<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
PATHCHK(1P)</title>
</head>
<body>
<div class="mandoc">
<table class="head">
<tbody>
<tr>
<td class="head-ltitle">
PATHCHK(1P)</td>
<td class="head-vol">
POSIX Programmer's Manual</td>
<td class="head-rtitle">
PATHCHK(1P)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1>PROLOG</h1> This manual page is part of the POSIX Programmer's Manual. The Linux implementation of this interface may differ (consult the corresponding Linux manual page for details of Linux behavior), or the interface may not be implemented on Linux.</div>
<div class="section">
<h1>NAME</h1> pathchk - check pathnames</div>
<div class="section">
<h1>SYNOPSIS</h1>  <b>pathchk</b> <b>[</b><b>-p</b><b>]</b> <i>pathname</i><b>...</b></div>
<div class="section">
<h1>DESCRIPTION</h1> The  <i>pathchk</i> utility shall check that one or more pathnames are valid (that is, they could be used to access or create a file without causing syntax errors) and portable (that is, no filename truncation results). More extensive portability checks are provided by the  <b>-p</b> option.<div class="spacer">
</div>
By default, the <i>pathchk</i> utility shall check each component of each  <i>pathname</i> operand based on the underlying file system. A diagnostic shall be written for each  <i>pathname</i> operand that:<dl>
<dt>
 *</dt>
<dd>
Is longer than {PATH_MAX} bytes (see <b>Pathname Variable Values</b> in the Base Definitions volume of IEEE&#160;Std&#160;1003.1-2001, Chapter 13, Headers,  <i>&lt;limits.h&gt;</i>)</dd>
</dl>
<dl>
<dt>
 *</dt>
<dd>
Contains any component longer than {NAME_MAX} bytes in its containing directory</dd>
</dl>
<dl>
<dt>
 *</dt>
<dd>
Contains any component in a directory that is not searchable</dd>
</dl>
<dl>
<dt>
 *</dt>
<dd>
Contains any character in any component that is not valid in its containing directory</dd>
</dl>
<div class="spacer">
</div>
The format of the diagnostic message is not specified, but shall indicate the error detected and the corresponding  <i>pathname</i> operand.<div class="spacer">
</div>
It shall not be considered an error if one or more components of a  <i>pathname</i> operand do not exist as long as a file matching the pathname specified by the missing components could be created that does not violate any of the checks specified above.</div>
<div class="section">
<h1>OPTIONS</h1> The  <i>pathchk</i> utility shall conform to the Base Definitions volume of IEEE&#160;Std&#160;1003.1-2001, Section 12.2, Utility Syntax Guidelines.<div class="spacer">
</div>
The following option shall be supported:<dl>
<dt>
<b>-p</b></dt>
<dd>
Instead of performing checks based on the underlying file system, write a diagnostic for each  <i>pathname</i> operand that:</dd>
</dl>
<div style="margin-left: 5.00ex;">
<dl>
<dt>
 *</dt>
<dd>
Is longer than {_POSIX_PATH_MAX} bytes (see <b>Minimum Values</b> in the Base Definitions volume of IEEE&#160;Std&#160;1003.1-2001, Chapter 13, Headers,  <i>&lt;limits.h&gt;</i>)</dd>
</dl>
<dl>
<dt>
 *</dt>
<dd>
Contains any component longer than {_POSIX_NAME_MAX} bytes</dd>
</dl>
<dl>
<dt>
 *</dt>
<dd>
Contains any character in any component that is not in the portable filename character set</dd>
</dl>
</div>
<div class="spacer">
</div>
<div style="height: 1.00em;">
&#160;</div>
</div>
<div class="section">
<h1>OPERANDS</h1> The following operand shall be supported:<dl>
<dt>
<i>pathname</i></dt>
<dd>
A pathname to be checked.<div style="height: 1.00em;">
&#160;</div>
</dd>
</dl>
</div>
<div class="section">
<h1>STDIN</h1> Not used.</div>
<div class="section">
<h1>INPUT FILES</h1> None.</div>
<div class="section">
<h1>ENVIRONMENT VARIABLES</h1> The following environment variables shall affect the execution of  <i>pathchk</i>:<dl>
<dt>
<i>LANG</i></dt>
<dd>
Provide a default value for the internationalization variables that are unset or null. (See the Base Definitions volume of IEEE&#160;Std&#160;1003.1-2001, Section 8.2, Internationalization Variables for the precedence of internationalization variables used to determine the values of locale categories.)</dd>
</dl>
<dl>
<dt>
<i>LC_ALL</i></dt>
<dd>
If set to a non-empty string value, override the values of all the other internationalization variables.</dd>
</dl>
<dl>
<dt>
<i>LC_CTYPE</i></dt>
<dd>
Determine the locale for the interpretation of sequences of bytes of text data as characters (for example, single-byte as opposed to multi-byte characters in arguments).</dd>
</dl>
<dl>
<dt>
<i>LC_MESSAGES</i></dt>
<dd>
Determine the locale that should be used to affect the format and contents of diagnostic messages written to standard error.</dd>
</dl>
<dl>
<dt>
<i>NLSPATH</i></dt>
<dd>
Determine the location of message catalogs for the processing of <i>LC_MESSAGES</i>  <i>.</i><div style="height: 1.00em;">
&#160;</div>
</dd>
</dl>
</div>
<div class="section">
<h1>ASYNCHRONOUS EVENTS</h1> Default.</div>
<div class="section">
<h1>STDOUT</h1> Not used.</div>
<div class="section">
<h1>STDERR</h1> The standard error shall be used only for diagnostic messages.</div>
<div class="section">
<h1>OUTPUT FILES</h1> None.</div>
<div class="section">
<h1>EXTENDED DESCRIPTION</h1> None.</div>
<div class="section">
<h1>EXIT STATUS</h1> The following exit values shall be returned:<dl>
<dt>
&#160;0</dt>
<dd>
All <i>pathname</i> operands passed all of the checks.</dd>
</dl>
<dl>
<dt>
&gt;0</dt>
<dd>
An error occurred.<div style="height: 1.00em;">
&#160;</div>
</dd>
</dl>
</div>
<div class="section">
<h1>CONSEQUENCES OF ERRORS</h1> Default.<div class="spacer">
</div>
<i>The following sections are informative.</i></div>
<div class="section">
<h1>APPLICATION USAGE</h1> The  <i>test</i> utility can be used to determine whether a given pathname names an existing file; it does not, however, give any indication of whether or not any component of the pathname was truncated in a directory where the _POSIX_NO_TRUNC feature is not in effect. The  <i>pathchk</i> utility does not check for file existence; it performs checks to determine whether a pathname does exist or could be created with no pathname component truncation.<div class="spacer">
</div>
The <i>noclobber</i> option in the shell (see the <i>set</i> special built-in) can be used to atomically create a file. As with all file creation semantics in the System Interfaces volume of IEEE&#160;Std&#160;1003.1-2001, it guarantees atomic creation, but still depends on applications to agree on conventions and cooperate on the use of files after they have been created.</div>
<div class="section">
<h1>EXAMPLES</h1> To verify that all pathnames in an imported data interchange archive are legitimate and unambiguous on the current system:<div style="height: 1.00em;">
&#160;</div>
<div style="margin-left: 5.00ex;">
<div class="spacer">
</div>
<br/>
<b>pax -f archive | sed -e '/ == .*/s///' | xargs pathchk</b><br/>
<b>if [ $? -eq 0 ]</b><br/>
<b>then</b><br/>
<b>    pax -r -f archive</b><br/>
<b>else</b><br/>
<b>    echo Investigate problems before importing files.</b><br/>
<b>    exit 1</b><br/>
<b>fi</b><br/>
<b></b><br/>
</div>
<div class="spacer">
</div>
To verify that all files in the current directory hierarchy could be moved to any system conforming to the System Interfaces volume of IEEE&#160;Std&#160;1003.1-2001 that also supports the  <i>pax</i> utility:<div style="height: 1.00em;">
&#160;</div>
<div style="margin-left: 5.00ex;">
<div class="spacer">
</div>
<br/>
<b>find . -print | xargs pathchk -p</b><br/>
<b>if [ $? -eq 0 ]</b><br/>
<b>then</b><br/>
<b>    pax -w -f archive .</b><br/>
<b>else</b><br/>
<b>    echo Portable archive cannot be created.</b><br/>
<b>    exit 1</b><br/>
<b>fi</b><br/>
<b></b><br/>
</div>
<div class="spacer">
</div>
To verify that a user-supplied pathname names a readable file and that the application can create a file extending the given path without truncation and without overwriting any existing file:<div style="height: 1.00em;">
&#160;</div>
<div style="margin-left: 5.00ex;">
<div class="spacer">
</div>
<br/>
<b>case $- in</b><br/>
<b>    *C*)    reset=&quot;&quot;;;</b><br/>
<b>    *)      reset=&quot;set +C&quot;</b><br/>
<b>            set -C;;</b><br/>
<b>esac</b><br/>
<b>test -r &quot;$path&quot; &amp;&amp; pathchk &quot;$path.out&quot; &amp;&amp;</b><br/>
<b>    rm &quot;$path.out&quot; &gt; &quot;$path.out&quot;</b><br/>
<b>if [ $? -ne 0 ]; then</b><br/>
<b>    printf &quot;%s: %s not found or %s.out fails \</b><br/>
<b>creation checks.\n&quot; $0 &quot;$path&quot; &quot;$path&quot;</b><br/>
<b>    $reset    # Reset the noclobber option in case a trap</b><br/>
<b>              # on EXIT depends on it.</b><br/>
<b>    exit 1</b><br/>
<b>fi</b><br/>
<b>$reset</b><br/>
<b>PROCESSING &lt; &quot;$path&quot; &gt; &quot;$path.out&quot;</b><br/>
<b></b><br/>
</div>
<div class="spacer">
</div>
The following assumptions are made in this example:<dl>
<dt>
 1.</dt>
<dd>
<b>PROCESSING</b> represents the code that is used by the application to use  <b>$path</b> once it is verified that  <b>$path.out</b> works as intended.</dd>
</dl>
<dl>
<dt>
 2.</dt>
<dd>
The state of the <i>noclobber</i> option is unknown when this code is invoked and should be set on exit to the state it was in when this code was invoked. (The  <b>reset</b> variable is used in this example to restore the initial state.)</dd>
</dl>
<dl>
<dt>
 3.</dt>
<dd>
Note the usage of:<div style="height: 1.00em;">
&#160;</div>
</dd>
</dl>
<div style="margin-left: 5.00ex;">
<div class="spacer">
</div>
<br/>
<b>rm &quot;$path.out&quot; &gt; &quot;$path.out&quot;</b><br/>
<b></b><br/>
</div>
<div style="margin-left: 5.00ex;">
<dl>
<dt>
 a.</dt>
<dd>
The <i>pathchk</i> command has already verified, at this point, that  <b>$path.out</b> is not truncated.</dd>
</dl>
<dl>
<dt>
 b.</dt>
<dd>
With the <i>noclobber</i> option set, the shell verifies that <b>$path.out</b> does not already exist before invoking  <i>rm</i>.</dd>
</dl>
<dl>
<dt>
 c.</dt>
<dd>
If the shell succeeded in creating <b>$path.out</b>, <i>rm</i> removes it so that the application can create the file again in the  <b>PROCESSING</b> step.</dd>
</dl>
<dl>
<dt>
 d.</dt>
<dd>
If the <b>PROCESSING</b> step wants the file to exist already when it is invoked, the:<div style="height: 1.00em;">
&#160;</div>
<div style="margin-left: 5.00ex;">
<div class="spacer">
</div>
<br/>
<b>rm &quot;$path.out&quot; &gt; &quot;$path.out&quot;</b><br/>
<b></b><br/>
</div>
</dd>
</dl>
<div class="spacer">
</div>
should be replaced with:<div style="height: 1.00em;">
&#160;</div>
<div style="margin-left: 5.00ex;">
<div class="spacer">
</div>
<br/>
<b>&gt; &quot;$path.out&quot;</b><br/>
<b></b><br/>
</div>
<div class="spacer">
</div>
which verifies that the file did not already exist, but leaves <b>$path.out</b> in place for use by  <b>PROCESSING</b>.</div>
</div>
<div class="section">
<h1>RATIONALE</h1> The  <i>pathchk</i> utility was new for the ISO&#160;POSIX-2:1993 standard. It, along with the  <i>set</i> <b>-C</b>( <i>noclobber</i>) option added to the shell, replaces the  <i>mktemp</i>, <i>validfnam</i>, and <i>create</i> utilities that appeared in early proposals. All of these utilities were attempts to solve several common problems:<dl>
<dt>
 *</dt>
<dd>
Verify the validity (for several different definitions of &quot;valid&quot;) of a pathname supplied by a user, generated by an application, or imported from an external source.</dd>
</dl>
<dl>
<dt>
 *</dt>
<dd>
Atomically create a file.</dd>
</dl>
<dl>
<dt>
 *</dt>
<dd>
Perform various string handling functions to generate a temporary filename.</dd>
</dl>
<div class="spacer">
</div>
The <i>create</i> utility, included in an early proposal, provided checking and atomic creation in a single invocation of the utility; these are orthogonal issues and need not be grouped into a single utility. Note that the  <i>noclobber</i> option also provides a way of creating a lock for process synchronization; since it provides an atomic  <i>create</i>, there is no race between a test for existence and the following creation if it did not exist.<div class="spacer">
</div>
Having a function like <i>tmpnam</i>() in the ISO&#160;C standard is important in many high-level languages. The shell programming language, however, has built-in string manipulation facilities, making it very easy to construct temporary filenames. The names needed obviously depend on the application, but are frequently of a form similar to:<div style="height: 1.00em;">
&#160;</div>
<div style="margin-left: 5.00ex;">
<div class="spacer">
</div>
<br/>
<b>$TMPDIR/</b><i>application_abbreviation</i><b>$$.</b><i>suffix</i><br/>
</div>
<div class="spacer">
</div>
In cases where there is likely to be contention for a given suffix, a simple shell  <b>for</b> or <b>while</b> loop can be used with the shell  <i>noclobber</i> option to create a file without risk of collisions, as long as applications trying to use the same filename name space are cooperating on the use of files after they have been created.</div>
<div class="section">
<h1>FUTURE DIRECTIONS</h1> None.</div>
<div class="section">
<h1>SEE ALSO</h1>  <i>Redirection</i>, <i>set</i>, <i>test</i></div>
<div class="section">
<h1>COPYRIGHT</h1> Portions of this text are reprinted and reproduced in electronic form from IEEE Std 1003.1, 2003 Edition, Standard for Information Technology -- Portable Operating System Interface (POSIX), The Open Group Base Specifications Issue 6, Copyright (C) 2001-2003 by the Institute of Electrical and Electronics Engineers, Inc and The Open Group. In the event of any discrepancy between this version and the original IEEE and The Open Group Standard, the original IEEE and The Open Group Standard is the referee document. The original Standard can be obtained online at http://www.opengroup.org/unix/online.html .</div>
<table class="foot">
<tr>
<td class="foot-date">
2003</td>
<td class="foot-os">
IEEE/The Open Group</td>
</tr>
</table>
</div>
</body>
</html>

