<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
UNLINK(3P)</title>
</head>
<body>
<div class="mandoc">
<table class="head">
<tbody>
<tr>
<td class="head-ltitle">
UNLINK(3P)</td>
<td class="head-vol">
POSIX Programmer's Manual</td>
<td class="head-rtitle">
UNLINK(3P)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1>PROLOG</h1> This manual page is part of the POSIX Programmer's Manual. The Linux implementation of this interface may differ (consult the corresponding Linux manual page for details of Linux behavior), or the interface may not be implemented on Linux.</div>
<div class="section">
<h1>NAME</h1> unlink - remove a directory entry</div>
<div class="section">
<h1>SYNOPSIS</h1>  <b>#include &lt;unistd.h&gt;</b><div style="height: 0.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
int unlink(const char *<b></b><i>path</i><b></b><b>);</b><div style="height: 0.00em;">
&#160;</div>
<b></b></div>
<div class="section">
<h1>DESCRIPTION</h1> The  <i>unlink</i>() function shall remove a link to a file. If <i>path</i> names a symbolic link,  <i>unlink</i>() shall remove the symbolic link named by  <i>path</i> and shall not affect any file or directory named by the contents of the symbolic link. Otherwise,  <i>unlink</i>() shall remove the link named by the pathname pointed to by  <i>path</i> and shall decrement the link count of the file referenced by the link.<div class="spacer">
</div>
When the file's link count becomes 0 and no process has the file open, the space occupied by the file shall be freed and the file shall no longer be accessible. If one or more processes have the file open when the last link is removed, the link shall be removed before  <i>unlink</i>() returns, but the removal of the file contents shall be postponed until all references to the file are closed.<div class="spacer">
</div>
The <i>path</i> argument shall not name a directory unless the process has appropriate privileges and the implementation supports using  <i>unlink</i>() on directories.<div class="spacer">
</div>
Upon successful completion, <i>unlink</i>() shall mark for update the  <i>st_ctime</i> and <i>st_mtime</i> fields of the parent directory. Also, if the file's link count is not 0, the  <i>st_ctime</i> field of the file shall be marked for update.</div>
<div class="section">
<h1>RETURN VALUE</h1> Upon successful completion, 0 shall be returned. Otherwise, -1 shall be returned and  <i>errno</i> set to indicate the error. If -1 is returned, the named file shall not be changed.</div>
<div class="section">
<h1>ERRORS</h1> The  <i>unlink</i>() function shall fail and shall not unlink the file if:<dl>
<dt>
<b>EACCES</b></dt>
<dd>
Search permission is denied for a component of the path prefix, or write permission is denied on the directory containing the directory entry to be removed.</dd>
</dl>
<dl>
<dt>
<b>EBUSY</b></dt>
<dd>
The file named by the <i>path</i> argument cannot be unlinked because it is being used by the system or another process and the implementation considers this an error.</dd>
</dl>
<dl>
<dt>
<b>ELOOP</b></dt>
<dd>
A loop exists in symbolic links encountered during resolution of the  <i>path</i> argument.</dd>
</dl>
<dl>
<dt>
<b>ENAMETOOLONG</b></dt>
<dd>
The length of the <i>path</i> argument exceeds {PATH_MAX} or a pathname component is longer than {NAME_MAX}.</dd>
</dl>
<dl>
<dt>
<b>ENOENT</b></dt>
<dd>
A component of <i>path</i> does not name an existing file or <i>path</i> is an empty string.</dd>
</dl>
<dl>
<dt>
<b>ENOTDIR</b></dt>
<dd>
A component of the path prefix is not a directory.</dd>
</dl>
<dl>
<dt>
<b>EPERM</b></dt>
<dd>
The file named by <i>path</i> is a directory, and either the calling process does not have appropriate privileges, or the implementation prohibits using  <i>unlink</i>() on directories.</dd>
</dl>
<dl>
<dt>
<b>EPERM or EACCES</b></dt>
<dd>
<div style="height: 1.00em;">
&#160;</div>
The S_ISVTX flag is set on the directory containing the file referred to by the  <i>path</i> argument and the caller is not the file owner, nor is the caller the directory owner, nor does the caller have appropriate privileges.</dd>
</dl>
<dl>
<dt>
<b>EROFS</b></dt>
<dd>
The directory entry to be unlinked is part of a read-only file system.<div style="height: 1.00em;">
&#160;</div>
</dd>
</dl>
<div class="spacer">
</div>
The <i>unlink</i>() function may fail and not unlink the file if:<dl>
<dt>
<b>EBUSY</b></dt>
<dd>
The file named by <i>path</i> is a named STREAM.</dd>
</dl>
<dl>
<dt>
<b>ELOOP</b></dt>
<dd>
More than {SYMLOOP_MAX} symbolic links were encountered during resolution of the  <i>path</i> argument.</dd>
</dl>
<dl>
<dt>
<b>ENAMETOOLONG</b></dt>
<dd>
As a result of encountering a symbolic link in resolution of the <i>path</i> argument, the length of the substituted pathname string exceeded {PATH_MAX}.</dd>
</dl>
<dl>
<dt>
<b>ETXTBSY</b></dt>
<dd>
The entry to be unlinked is the last directory entry to a pure procedure (shared text) file that is being executed.<div style="height: 1.00em;">
&#160;</div>
</dd>
</dl>
<div class="spacer">
</div>
<i>The following sections are informative.</i></div>
<div class="section">
<h1>EXAMPLES</h1><div class="subsection">
<h2>Removing a Link to a File</h2> The following example shows how to remove a link to a file named  <b>/home/cnd/mod1</b> by removing the entry named  <b>/modules/pass1</b>.<div style="height: 1.00em;">
&#160;</div>
<div style="margin-left: 5.00ex;">
<div class="spacer">
</div>
<br/>
<b>#include &lt;unistd.h&gt;</b><div style="height: 1.00em;">
&#160;</div>
<div class="spacer">
</div>
<br/>
char *path = &quot;/modules/pass1&quot;;<br/>
int   status;<br/>
...<br/>
status = unlink(path);<br/>
<b></b><br/>
</div>
</div>
<div class="subsection">
<h2>Checking for an Error</h2> The following example fragment creates a temporary password lock file named  <b>LOCKFILE</b>, which is defined as  <b>/etc/ptmp</b>, and gets a file descriptor for it. If the file cannot be opened for writing,  <i>unlink</i>() is used to remove the link between the file descriptor and  <b>LOCKFILE</b>.<div style="height: 1.00em;">
&#160;</div>
<div style="margin-left: 5.00ex;">
<div class="spacer">
</div>
<br/>
<b>#include &lt;sys/types.h&gt;</b><br/>
<b>#include &lt;stdio.h&gt;</b><br/>
<b>#include &lt;fcntl.h&gt;</b><br/>
<b>#include &lt;errno.h&gt;</b><br/>
<b>#include &lt;unistd.h&gt;</b><br/>
<b>#include &lt;sys/stat.h&gt;</b><div style="height: 1.00em;">
&#160;</div>
<div class="spacer">
</div>
<br/>
#define LOCKFILE &quot;/etc/ptmp&quot;<div style="height: 1.00em;">
&#160;</div>
<div class="spacer">
</div>
<br/>
int pfd;  /* Integer for file descriptor returned by open call. */<br/>
FILE *fpfd;  /* File pointer for use in putpwent(). */<br/>
...<br/>
/* Open password Lock file. If it exists, this is an error. */<br/>
if ((pfd = open(LOCKFILE, O_WRONLY| O_CREAT | O_EXCL, S_IRUSR<br/>
    | S_IWUSR | S_IRGRP | S_IROTH)) == -1)  {<br/>
    fprintf(stderr, &quot;Cannot open /etc/ptmp. Try again later.\n&quot;);<br/>
    exit(1);<br/>
}<div style="height: 1.00em;">
&#160;</div>
<div class="spacer">
</div>
<br/>
/* Lock file created; proceed with fdopen of lock file so that<br/>
   putpwent() can be used.<br/>
 */<br/>
if ((fpfd = fdopen(pfd, &quot;w&quot;)) == NULL) {<br/>
    close(pfd);<br/>
    unlink(LOCKFILE);<br/>
    exit(1);<br/>
}<br/>
<b></b><br/>
</div>
</div>
<div class="subsection">
<h2>Replacing Files</h2> The following example fragment uses  <i>unlink</i>() to discard links to files, so that they can be replaced with new versions of the files. The first call removes the link to  <b>LOCKFILE</b> if an error occurs. Successive calls remove the links to  <b>SAVEFILE</b> and <b>PASSWDFILE</b> so that new links can be created, then removes the link to  <b>LOCKFILE</b> when it is no longer needed.<div style="height: 1.00em;">
&#160;</div>
<div style="margin-left: 5.00ex;">
<div class="spacer">
</div>
<br/>
<b>#include &lt;sys/types.h&gt;</b><br/>
<b>#include &lt;stdio.h&gt;</b><br/>
<b>#include &lt;fcntl.h&gt;</b><br/>
<b>#include &lt;errno.h&gt;</b><br/>
<b>#include &lt;unistd.h&gt;</b><br/>
<b>#include &lt;sys/stat.h&gt;</b><div style="height: 1.00em;">
&#160;</div>
<div class="spacer">
</div>
<br/>
#define LOCKFILE &quot;/etc/ptmp&quot;<br/>
#define PASSWDFILE &quot;/etc/passwd&quot;<br/>
#define SAVEFILE &quot;/etc/opasswd&quot;<br/>
...<br/>
/* If no change was made, assume error and leave passwd unchanged. */<br/>
if (!valid_change) {<br/>
    fprintf(stderr, &quot;Could not change password for user %s\n&quot;, user);<br/>
    unlink(LOCKFILE);<br/>
    exit(1);<br/>
}<div style="height: 1.00em;">
&#160;</div>
<div class="spacer">
</div>
<br/>
/* Change permissions on new password file. */<br/>
chmod(LOCKFILE, S_IRUSR | S_IRGRP | S_IROTH);<div style="height: 1.00em;">
&#160;</div>
<div class="spacer">
</div>
<br/>
/* Remove saved password file. */<br/>
unlink(SAVEFILE);<div style="height: 1.00em;">
&#160;</div>
<div class="spacer">
</div>
<br/>
/* Save current password file. */<br/>
link(PASSWDFILE, SAVEFILE);<div style="height: 1.00em;">
&#160;</div>
<div class="spacer">
</div>
<br/>
/* Remove current password file. */<br/>
unlink(PASSWDFILE);<div style="height: 1.00em;">
&#160;</div>
<div class="spacer">
</div>
<br/>
/* Save new password file as current password file. */<br/>
link(LOCKFILE,PASSWDFILE);<div style="height: 1.00em;">
&#160;</div>
<div class="spacer">
</div>
<br/>
/* Remove lock file. */<br/>
unlink(LOCKFILE);<div style="height: 1.00em;">
&#160;</div>
<div class="spacer">
</div>
<br/>
exit(0);<br/>
<b></b><br/>
</div>
</div>
</div>
<div class="section">
<h1>APPLICATION USAGE</h1> Applications should use  <i>rmdir</i>() to remove a directory.</div>
<div class="section">
<h1>RATIONALE</h1> Unlinking a directory is restricted to the superuser in many historical implementations for reasons given in  <i>link</i>() (see also <i>rename</i>()).<div class="spacer">
</div>
The meaning of [EBUSY] in historical implementations is &quot;mount point busy&quot;. Since this volume of IEEE&#160;Std&#160;1003.1-2001 does not cover the system administration concepts of mounting and unmounting, the description of the error was changed to &quot;resource busy&quot;. (This meaning is used by some device drivers when a second process tries to open an exclusive use device.) The wording is also intended to allow implementations to refuse to remove a directory if it is the root or current working directory of any process.</div>
<div class="section">
<h1>FUTURE DIRECTIONS</h1> None.</div>
<div class="section">
<h1>SEE ALSO</h1>  <i>close</i>(), <i>link</i>(), <i>remove</i>(), <i>rmdir</i>(), the Base Definitions volume of IEEE&#160;Std&#160;1003.1-2001,  <i>&lt;unistd.h&gt;</i></div>
<div class="section">
<h1>COPYRIGHT</h1> Portions of this text are reprinted and reproduced in electronic form from IEEE Std 1003.1, 2003 Edition, Standard for Information Technology -- Portable Operating System Interface (POSIX), The Open Group Base Specifications Issue 6, Copyright (C) 2001-2003 by the Institute of Electrical and Electronics Engineers, Inc and The Open Group. In the event of any discrepancy between this version and the original IEEE and The Open Group Standard, the original IEEE and The Open Group Standard is the referee document. The original Standard can be obtained online at http://www.opengroup.org/unix/online.html .</div>
<table class="foot">
<tr>
<td class="foot-date">
2003</td>
<td class="foot-os">
IEEE/The Open Group</td>
</tr>
</table>
</div>
</body>
</html>

