<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML><HEAD><TITLE>Man page of WORDEXP</TITLE>
</HEAD><BODY>
<H1>WORDEXP</H1>
Section: POSIX Programmer's Manual (3P)<BR>Updated: 2003<BR><A HREF="#index">Index</A>
<A HREF="/cgi-bin/man/man2html">Return to Main Contents</A><HR>


<A NAME="lbAB">&nbsp;</A>
<H2>PROLOG</H2>

This manual page is part of the POSIX Programmer's Manual.
The Linux implementation of this interface may differ (consult
the corresponding Linux manual page for details of Linux behavior),
or the interface may not be implemented on Linux.
<A NAME="lbAC">&nbsp;</A>
<H2>NAME</H2>

wordexp, wordfree - perform word expansions
<A NAME="lbAD">&nbsp;</A>
<H2>SYNOPSIS</H2>

<P>

<B>#include &lt;<A HREF="file:///usr/include/wordexp.h">wordexp.h</A>&gt;
<BR>

<P>
int wordexp(const char *restrict</B> <I>words</I><B>, wordexp_t *restrict</B>
<I>pwordexp</I><B>,
<BR>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int</B> <I>flags</I><B>);
<BR>

void wordfree(wordexp_t *</B><I>pwordexp</I><B>);
<BR>

</B>
<A NAME="lbAE">&nbsp;</A>
<H2>DESCRIPTION</H2>

<P>

The <I>wordexp</I>() function shall perform word expansions as described
in the Shell and Utilities volume of
IEEE&nbsp;Std&nbsp;1003.1-2001, Section 2.6, Word Expansions, subject to
quoting as in the Shell and Utilities volume of IEEE&nbsp;Std&nbsp;1003.1-2001,
Section 2.2, Quoting, and place the list of expanded words into the
structure pointed
to by <I>pwordexp</I>.
<P>

The <I>words</I> argument is a pointer to a string containing one or
more words to be expanded. The expansions shall be the same
as would be performed by the command line interpreter if <I>words</I>
were the part of a command line representing the arguments to
a utility. Therefore, the application shall ensure that <I>words</I>
does not contain an unquoted &lt;newline&gt; or any of the
unquoted shell special characters <B>'|'</B>, <B>'&amp;'</B>, <B>';'</B>,
<B>'&lt;'</B>, <B>'&gt;'</B> except in the
context of command substitution as specified in the Shell and Utilities
volume of IEEE&nbsp;Std&nbsp;1003.1-2001, Section 2.6.3, Command Substitution.
It also shall not contain unquoted parentheses
or braces, except in the context of command or variable substitution.
The application shall ensure that every member of
<I>words</I> which it expects to have expanded by <I>wordexp</I>() does
not contain an unquoted initial comment character. The
application shall also ensure that any words which it intends to be
ignored (because they begin or continue a comment) are deleted
from <I>words</I>. If the argument <I>words</I> contains an unquoted
comment character (number sign) that is the beginning of a
token, <I>wordexp</I>() shall either treat the comment character as
a regular character, or interpret it as a comment indicator and
ignore the remainder of <I>words</I>.
<P>

The structure type <B>wordexp_t</B> is defined in the <I>&lt;<A HREF="file:///usr/include/wordexp.h">wordexp.h</A>&gt;</I>
header
and includes at least the following members:
<TABLE>
<TR VALIGN=top><TD ALIGN=center><B>Member Type</B></TD><TD ALIGN=right><B>Member Name</B>&nbsp;&nbsp;&nbsp;&nbsp;</TD><TD ALIGN=right>

<B>Description</B>

</TD><TD>&nbsp;</TD><TD>&nbsp;</TD><TD><BR></TD></TR>
<TR VALIGN=top><TD ALIGN=center><B>size_t</B></TD><TD ALIGN=right><I>we_wordc</I>&nbsp;&nbsp;&nbsp;&nbsp;</TD><TD ALIGN=right>

Count of words matched by <I>words</I>.

</TD><TD>&nbsp;</TD><TD>&nbsp;</TD><TD><BR></TD></TR>
<TR VALIGN=top><TD ALIGN=center><B>char **</B></TD><TD ALIGN=right><I>we_wordv</I>&nbsp;&nbsp;&nbsp;&nbsp;</TD><TD ALIGN=right>

Pointer to list of expanded words.

</TD><TD>&nbsp;</TD><TD>&nbsp;</TD><TD><BR></TD></TR>
<TR VALIGN=top><TD ALIGN=center><B>size_t</B></TD><TD ALIGN=right><I>we_offs</I>&nbsp;&nbsp;&nbsp;&nbsp;</TD><TD ALIGN=right>

Slots to reserve at the beginning of <I>pwordexp</I>-&gt;<I>we_wordv</I>.

</TD><TD>&nbsp;</TD><TD>&nbsp;</TD><TD><BR></TD></TR>
</TABLE>

<P>

The <I>wordexp</I>() function shall store the number of generated words
into <I>pwordexp</I>-&gt;<I>we_wordc</I> and a pointer
to a list of pointers to words in <I>pwordexp</I>-&gt;<I>we_wordv</I>.
Each individual field created during field splitting (see
the Shell and Utilities volume of IEEE&nbsp;Std&nbsp;1003.1-2001, Section
2.6.5, Field Splitting) or pathname expansion (see the Shell and Utilities
volume of IEEE&nbsp;Std&nbsp;1003.1-2001, Section 2.6.6, Pathname Expansion)
shall be a separate word in the
<I>pwordexp</I>-&gt;<I>we_wordv</I> list. The words shall be in order as
described in the Shell and Utilities volume of
IEEE&nbsp;Std&nbsp;1003.1-2001, Section 2.6, Word Expansions. The first
pointer after the last word pointer shall be a null pointer. The expansion
of special parameters described in the Shell and
Utilities volume of IEEE&nbsp;Std&nbsp;1003.1-2001, Section 2.5.2, Special
Parameters is unspecified.
<P>

It is the caller's responsibility to allocate the storage pointed
to by <I>pwordexp</I>. The <I>wordexp</I>() function shall
allocate other space as needed, including memory pointed to by <I>pwordexp</I>-&gt;<I>we_wordv</I>.
The <I>wordfree</I>() function
frees any memory associated with <I>pwordexp</I> from a previous call
to <I>wordexp</I>().
<P>

The <I>flags</I> argument is used to control the behavior of <I>wordexp</I>().
The value of <I>flags</I> is the
bitwise-inclusive OR of zero or more of the following constants, which
are defined in <I>&lt;<A HREF="file:///usr/include/wordexp.h">wordexp.h</A>&gt;</I>:
<DL COMPACT>
<DT>WRDE_APPEND<DD>
Append words generated to the ones from a previous call to <I>wordexp</I>().
<DT>WRDE_DOOFFS<DD>
Make use of <I>pwordexp</I>-&gt;<I>we_offs</I>. If this flag is set, <I>pwordexp</I>-&gt;<I>we_offs</I>
is used to specify how
many null pointers to add to the beginning of <I>pwordexp</I>-&gt;<I>we_wordv</I>.
In other words,
<I>pwordexp</I>-&gt;<I>we_wordv</I> shall point to <I>pwordexp</I>-&gt;<I>we_offs</I>
null pointers, followed by
<I>pwordexp</I>-&gt;<I>we_wordc</I> word pointers, followed by a null pointer.
<DT>WRDE_NOCMD<DD>
If the implementation supports the utilities defined in the Shell
and Utilities volume of IEEE&nbsp;Std&nbsp;1003.1-2001, fail
if command substitution, as specified in the Shell and Utilities volume
of IEEE&nbsp;Std&nbsp;1003.1-2001, Section 2.6.3, Command Substitution, is
requested.
<DT>WRDE_REUSE<DD>
The <I>pwordexp</I> argument was passed to a previous successful call
to <I>wordexp</I>(), and has not been passed to
<I>wordfree</I>(). The result shall be the same as if the application
had called <I>wordfree</I>() and then called <I>wordexp</I>()
without WRDE_REUSE.
<DT>WRDE_SHOWERR<DD>
Do not redirect <I>stderr</I> to <B>/dev/null</B>.
<DT>WRDE_UNDEF<DD>
Report error on an attempt to expand an undefined shell variable.
<P>
</DL>
<P>

The WRDE_APPEND flag can be used to append a new set of words to those
generated by a previous call to <I>wordexp</I>(). The
following rules apply to applications when two or more calls to <I>wordexp</I>()
are made with the same value of <I>pwordexp</I>
and without intervening calls to <I>wordfree</I>():
<DL COMPACT>
<DT> 1.<DD>
The first such call shall not set WRDE_APPEND. All subsequent calls
shall set it.
</DL>
<P>

<DL COMPACT>
<DT> 2.<DD>
All of the calls shall set WRDE_DOOFFS, or all shall not set it.
</DL>
<P>

<DL COMPACT>
<DT> 3.<DD>
After the second and each subsequent call, <I>pwordexp</I>-&gt;<I>we_wordv</I>
shall point to a list containing the
following:
<DL COMPACT><DT><DD>
<DL COMPACT>
<DT> a.<DD>
Zero or more null pointers, as specified by WRDE_DOOFFS and <I>pwordexp</I>-&gt;<I>we_offs</I>
</DL>
<P>

<DL COMPACT>
<DT> b.<DD>
Pointers to the words that were in the <I>pwordexp</I>-&gt;<I>we_wordv</I>
list before the call, in the same order as before
</DL>
<P>

<DL COMPACT>
<DT> c.<DD>
Pointers to the new words generated by the latest call, in the specified
order
</DL>
<P>

</DL>

</DL>
<P>

<DL COMPACT>
<DT> 4.<DD>
The count returned in <I>pwordexp</I>-&gt;<I>we_wordc</I> shall be the
total number of words from all of the calls.
</DL>
<P>

<DL COMPACT>
<DT> 5.<DD>
The application can change any of the fields after a call to <I>wordexp</I>(),
but if it does it shall reset them to the
original value before a subsequent call, using the same <I>pwordexp</I>
value, to <I>wordfree</I>() or <I>wordexp</I>() with the
WRDE_APPEND or WRDE_REUSE flag.
</DL>
<P>

<P>

If the implementation supports the utilities defined in the Shell
and Utilities volume of IEEE&nbsp;Std&nbsp;1003.1-2001, and
<I>words</I> contains an unquoted character- &lt;newline&gt;, <B>'|'</B>,
<B>'&amp;'</B>, <B>';'</B>, <B>'&lt;'</B>,
<B>'&gt;'</B>, <B>'('</B>, <B>')'</B>, <B>'{'</B>, <B>'}'</B> - in an
inappropriate context, <I>wordexp</I>() shall
fail, and the number of expanded words shall be 0.
<P>

Unless WRDE_SHOWERR is set in <I>flags</I>, <I>wordexp</I>() shall redirect
<I>stderr</I> to <B>/dev/null</B> for any utilities
executed as a result of command substitution while expanding <I>words</I>.
If WRDE_SHOWERR is set, <I>wordexp</I>() may write
messages to <I>stderr</I> if syntax errors are detected while expanding
<I>words</I>.
<P>

The application shall ensure that if WRDE_DOOFFS is set, then <I>pwordexp</I>-&gt;<I>we_offs</I>
has the same value for each
<I>wordexp</I>() call and <I>wordfree</I>() call using a given <I>pwordexp</I>.
<P>

The following constants are defined as error return values:
<DL COMPACT>
<DT>WRDE_BADCHAR<DD>
One of the unquoted characters- &lt;newline&gt;, <B>'|'</B>, <B>'&amp;'</B>,
<B>';'</B>, <B>'&lt;'</B>,
<B>'&gt;'</B>, <B>'('</B>, <B>')'</B>, <B>'{'</B>, <B>'}'</B> - appears
in <I>words</I> in an inappropriate
context.
<DT>WRDE_BADVAL<DD>
Reference to undefined shell variable when WRDE_UNDEF is set in <I>flags</I>.
<DT>WRDE_CMDSUB<DD>
Command substitution requested when WRDE_NOCMD was set in <I>flags</I>.
<DT>WRDE_NOSPACE<DD>
Attempt to allocate memory failed.
<DT>WRDE_SYNTAX<DD>
Shell syntax error, such as unbalanced parentheses or unterminated
string.
<P>
</DL>
<A NAME="lbAF">&nbsp;</A>
<H2>RETURN VALUE</H2>

<P>

Upon successful completion, <I>wordexp</I>() shall return 0. Otherwise,
a non-zero value, as described in <I>&lt;<A HREF="file:///usr/include/wordexp.h">wordexp.h</A>&gt;</I>, shall be returned
to indicate an error. If <I>wordexp</I>() returns the
value WRDE_NOSPACE, then <I>pwordexp</I>-&gt;<I>we_wordc</I> and <I>pwordexp</I>-&gt;<I>we_wordv</I>
shall be updated to reflect
any words that were successfully expanded. In other cases, they shall
not be modified.
<P>

The <I>wordfree</I>() function shall not return a value.
<A NAME="lbAG">&nbsp;</A>
<H2>ERRORS</H2>

<P>

No errors are defined.
<P>

<I>The following sections are informative.</I>
<A NAME="lbAH">&nbsp;</A>
<H2>EXAMPLES</H2>

<P>

None.
<A NAME="lbAI">&nbsp;</A>
<H2>APPLICATION USAGE</H2>

<P>

The <I>wordexp</I>() function is intended to be used by an application
that wants to do all of the shell's expansions on a word
or words obtained from a user. For example, if the application prompts
for a filename (or list of filenames) and then uses
<I>wordexp</I>() to process the input, the user could respond with
anything that would be valid as input to the shell.
<P>

The WRDE_NOCMD flag is provided for applications that, for security
or other reasons, want to prevent a user from executing
shell commands. Disallowing unquoted shell special characters also
prevents unwanted side effects, such as executing a command or
writing a file.
<A NAME="lbAJ">&nbsp;</A>
<H2>RATIONALE</H2>

<P>

This function was included as an alternative to <I>glob</I>(). There
had been continuing
controversy over exactly what features should be included in <I>glob</I>().
It is hoped that
by providing <I>wordexp</I>() (which provides all of the shell word
expansions, but which may be slow to execute) and <I>glob</I>() (which
is faster, but which only performs pathname expansion, without tilde
or parameter
expansion) this will satisfy the majority of applications.
<P>

While <I>wordexp</I>() could be implemented entirely as a library routine,
it is expected that most implementations run a shell
in a subprocess to do the expansion.
<P>

Two different approaches have been proposed for how the required information
might be presented to the shell and the results
returned. They are presented here as examples.
<P>

One proposal is to extend the <I>echo</I> utility by adding a <B>-q</B>
option. This option
would cause <I>echo</I> to add a backslash before each backslash and
&lt;blank&gt; that occurs
within an argument. The <I>wordexp</I>() function could then invoke
the shell as follows:
<P>
<DL COMPACT><DT><DD>
<PRE>

<B>(void) strcpy(buffer, &quot;echo -q&quot;);
(void) strcat(buffer,</B> <I>words</I><B>);
if ((flags &amp; WRDE_SHOWERR) == 0)
    (void) strcat(buffer, &quot;2&gt;/dev/null&quot;);
f = popen(buffer, &quot;r&quot;);
</B>
</PRE>

</DL>

<P>

The <I>wordexp</I>() function would read the resulting output, remove
unquoted backslashes, and break into words at unquoted
&lt;blank&gt;s. If the WRDE_NOCMD flag was set, <I>wordexp</I>() would have
to scan <I>words</I> before starting the subshell to
make sure that there would be no command substitution. In any case,
it would have to scan <I>words</I> for unquoted special
characters.
<P>

Another proposal is to add the following options to <I>sh</I>:
<DL COMPACT>
<DT><B>-w</B>&nbsp;<I>wordlist</I><DD>
<P>
This option provides a wordlist expansion service to applications.
The words in <I>wordlist</I> shall be expanded and the following
written to standard output: 
<DL COMPACT><DT><DD>
<DL COMPACT>
<DT> 1.<DD>
The count of the number of words after expansion, in decimal, followed
by a null byte
</DL>
<P>

<DL COMPACT>
<DT> 2.<DD>
The number of bytes needed to represent the expanded words (not including
null separators), in decimal, followed by a null
byte
</DL>
<P>

<DL COMPACT>
<DT> 3.<DD>
The expanded words, each terminated by a null byte
</DL>
<P>

</DL>

</DL>
<P>

If an error is encountered during word expansion, <I>sh</I> exits with
a non-zero status
after writing the former to report any words successfully expanded
<DL COMPACT>
<DT><B>-P</B><DD>
Run in &quot;protected&quot; mode. If specified with the <B>-w</B> option, no
command substitution shall be performed.
<P>
</DL>
<P>

With these options, <I>wordexp</I>() could be implemented fairly simply
by creating a subprocess using <I>fork</I>() and executing <I>sh</I>
using the line:
<P>
<DL COMPACT><DT><DD>
<PRE>

<B>execl(&lt;</B><I>shell path</I><B>&gt;, &quot;sh&quot;, &quot;-P&quot;, &quot;-w&quot;,</B> <I>words</I><B>, (char *)0);
</B>
</PRE>

</DL>

<P>

after directing standard error to <B>/dev/null</B>.
<P>

It seemed objectionable for a library routine to write messages to
standard error, unless explicitly requested, so
<I>wordexp</I>() is required to redirect standard error to <B>/dev/null</B>
to ensure that no messages are generated, even for
commands executed for command substitution. The WRDE_SHOWERR flag
can be specified to request that error messages be written.
<P>

The WRDE_REUSE flag allows the implementation to avoid the expense
of freeing and reallocating memory, if that is possible. A
minimal implementation can call <I>wordfree</I>() when WRDE_REUSE is
set.
<A NAME="lbAK">&nbsp;</A>
<H2>FUTURE DIRECTIONS</H2>

<P>

None.
<A NAME="lbAL">&nbsp;</A>
<H2>SEE ALSO</H2>

<P>

<I>fnmatch</I>(), <I>glob</I>(), the Base Definitions volume of
IEEE&nbsp;Std&nbsp;1003.1-2001, <I>&lt;<A HREF="file:///usr/include/wordexp.h">wordexp.h</A>&gt;</I>, the Shell and Utilities
volume
of IEEE&nbsp;Std&nbsp;1003.1-2001, Chapter 2, Shell Command Language
<A NAME="lbAM">&nbsp;</A>
<H2>COPYRIGHT</H2>

Portions of this text are reprinted and reproduced in electronic form
from IEEE Std 1003.1, 2003 Edition, Standard for Information Technology
-- Portable Operating System Interface (POSIX), The Open Group Base
Specifications Issue 6, Copyright (C) 2001-2003 by the Institute of
Electrical and Electronics Engineers, Inc and The Open Group. In the
event of any discrepancy between this version and the original IEEE and
The Open Group Standard, the original IEEE and The Open Group Standard
is the referee document. The original Standard can be obtained online at
<A HREF="http://www.opengroup.org/unix/online.html">http://www.opengroup.org/unix/online.html</A> .
<P>

<HR>
<A NAME="index">&nbsp;</A><H2>Index</H2>
<DL>
<DT><A HREF="#lbAB">PROLOG</A><DD>
<DT><A HREF="#lbAC">NAME</A><DD>
<DT><A HREF="#lbAD">SYNOPSIS</A><DD>
<DT><A HREF="#lbAE">DESCRIPTION</A><DD>
<DT><A HREF="#lbAF">RETURN VALUE</A><DD>
<DT><A HREF="#lbAG">ERRORS</A><DD>
<DT><A HREF="#lbAH">EXAMPLES</A><DD>
<DT><A HREF="#lbAI">APPLICATION USAGE</A><DD>
<DT><A HREF="#lbAJ">RATIONALE</A><DD>
<DT><A HREF="#lbAK">FUTURE DIRECTIONS</A><DD>
<DT><A HREF="#lbAL">SEE ALSO</A><DD>
<DT><A HREF="#lbAM">COPYRIGHT</A><DD>
</DL>
<HR>
This document was created by
<A HREF="/cgi-bin/man/man2html">man2html</A>,
using the manual pages.<BR>
Time: 12:41:35 GMT, April 18, 2016
</BODY>
</HTML>
