<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
GETC_UNLOCKED(3P)</title>
</head>
<body>
<div class="mandoc">
<table class="head">
<tbody>
<tr>
<td class="head-ltitle">
GETC_UNLOCKED(3P)</td>
<td class="head-vol">
POSIX Programmer's Manual</td>
<td class="head-rtitle">
GETC_UNLOCKED(3P)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1>PROLOG</h1> This manual page is part of the POSIX Programmer's Manual. The Linux implementation of this interface may differ (consult the corresponding Linux manual page for details of Linux behavior), or the interface may not be implemented on Linux.</div>
<div class="section">
<h1>NAME</h1> getc_unlocked, getchar_unlocked, putc_unlocked, putchar_unlocked - stdio with explicit client locking</div>
<div class="section">
<h1>SYNOPSIS</h1>  <b>#include &lt;stdio.h&gt;</b><div style="height: 0.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
int getc_unlocked(FILE *<b></b><i>stream</i><b></b><b>);</b><div style="height: 0.00em;">
&#160;</div>
int getchar_unlocked(void);<div style="height: 0.00em;">
&#160;</div>
int putc_unlocked(int<b> </b><i>c</i><b></b><b>, FILE *</b><b></b><i>stream</i><b></b><b>);</b><div style="height: 0.00em;">
&#160;</div>
int putchar_unlocked(int<b> </b><i>c</i><b></b><b>); </b><b></b>  <b></b><b></b><div style="height: 0.00em;">
&#160;</div>
<b></b></div>
<div class="section">
<h1>DESCRIPTION</h1> Versions of the functions  <i>getc</i>(), <i>getchar</i>(), <i>putc</i>(), and  <i>putchar</i>() respectively named <i>getc_unlocked</i>(), <i>getchar_unlocked</i>(),  <i>putc_unlocked</i>(), and <i>putchar_unlocked</i>() shall be provided which are functionally equivalent to the original versions, with the exception that they are not required to be implemented in a thread-safe manner. They may only safely be used within a scope protected by  <i>flockfile</i>() (or <i>ftrylockfile</i>()) and  <i>funlockfile</i>(). These functions may safely be used in a multi-threaded program if and only if they are called while the invoking thread owns the (  <b>FILE *</b>) object, as is the case after a successful call to the  <i>flockfile</i>() or  <i>ftrylockfile</i>() functions.</div>
<div class="section">
<h1>RETURN VALUE</h1> See  <i>getc</i>(), <i>getchar</i>(), <i>putc</i>(), and  <i>putchar</i>().</div>
<div class="section">
<h1>ERRORS</h1> See  <i>getc</i>(), <i>getchar</i>(), <i>putc</i>(), and  <i>putchar</i>().<div class="spacer">
</div>
<i>The following sections are informative.</i></div>
<div class="section">
<h1>EXAMPLES</h1> None.</div>
<div class="section">
<h1>APPLICATION USAGE</h1> Since they may be implemented as macros,  <i>getc_unlocked</i>() and  <i>putc_unlocked</i>() may treat incorrectly a <i>stream</i> argument with side effects. In particular,  <i>getc_unlocked</i>(*f++) and  <i>putc_unlocked</i>(*f++) do not necessarily work as expected. Therefore, use of these functions in such situations should be preceded by the following statement as appropriate:<div style="height: 1.00em;">
&#160;</div>
<div style="margin-left: 5.00ex;">
<div class="spacer">
</div>
<br/>
<b>#undef getc_unlocked</b><br/>
<b>#undef putc_unlocked</b><br/>
<b></b><br/>
</div>
</div>
<div class="section">
<h1>RATIONALE</h1> Some I/O functions are typically implemented as macros for performance reasons (for example,  <i>putc</i>() and <i>getc</i>()). For safety, they need to be synchronized, but it is often too expensive to synchronize on every character. Nevertheless, it was felt that the safety concerns were more important; consequently, the  <i>getc</i>(), <i>getchar</i>(),  <i>putc</i>(), and <i>putchar</i>() functions are required to be thread-safe. However, unlocked versions are also provided with names that clearly indicate the unsafe nature of their operation but can be used to exploit their higher performance. These unlocked versions can be safely used only within explicitly locked program regions, using exported locking primitives. In particular, a sequence such as:<div style="height: 1.00em;">
&#160;</div>
<div style="margin-left: 5.00ex;">
<div class="spacer">
</div>
<br/>
<b>flockfile(fileptr);</b><br/>
<b>putc_unlocked('1', fileptr);</b><br/>
<b>putc_unlocked('\n', fileptr);</b><br/>
<b>fprintf(fileptr, &quot;Line 2\n&quot;);</b><br/>
<b>funlockfile(fileptr);</b><br/>
<b></b><br/>
</div>
<div class="spacer">
</div>
is permissible, and results in the text sequence:<div style="height: 1.00em;">
&#160;</div>
<div style="margin-left: 5.00ex;">
<div class="spacer">
</div>
<br/>
<b>1</b><br/>
<b>Line 2</b><br/>
<b></b><br/>
</div>
<div class="spacer">
</div>
being printed without being interspersed with output from other threads.<div class="spacer">
</div>
It would be wrong to have the standard names such as <i>getc</i>(),  <i>putc</i>(), and so on, map to the &quot;faster, but unsafe&quot; rather than the &quot;slower, but safe'' versions. In either case, you would still want to inspect all uses of  <i>getc</i>(), <i>putc</i>(), and so on, by hand when converting existing code. Choosing the safe bindings as the default, at least, results in correct code and maintains the &quot;atomicity at the function&quot; invariant. To do otherwise would introduce gratuitous synchronization errors into converted code. Other routines that modify the  <i>stdio</i> ( <b>FILE *</b>) structures or buffers are also safely synchronized.<div class="spacer">
</div>
Note that there is no need for functions of the form <i>getc_locked</i>(),  <i>putc_locked</i>(), and so on, since this is the functionality of  <i>getc</i>(), <i>putc</i>(), <i>et</i>  <i>al</i>. It would be inappropriate to use a feature test macro to switch a macro definition of  <i>getc</i>() between <i>getc_locked</i>() and  <i>getc_unlocked</i>(), since the ISO&#160;C standard requires an actual function to exist, a function whose behavior could not be changed by the feature test macro. Also, providing both the  <i>xxx_locked</i>() and <i>xxx_unlocked</i>() forms leads to the confusion of whether the suffix describes the behavior of the function or the circumstances under which it should be used.<div class="spacer">
</div>
Three additional routines, <i>flockfile</i>(), <i>ftrylockfile</i>(), and  <i>funlockfile</i>() (which may be macros), are provided to allow the user to delineate a sequence of I/O statements that are executed synchronously.<div class="spacer">
</div>
The <i>ungetc</i>() function is infrequently called relative to the other functions/macros so no unlocked variation is needed.</div>
<div class="section">
<h1>FUTURE DIRECTIONS</h1> None.</div>
<div class="section">
<h1>SEE ALSO</h1>  <i>getc</i>(), <i>getchar</i>(), <i>putc</i>(), <i>putchar</i>(), the Base Definitions volume of IEEE&#160;Std&#160;1003.1-2001,  <i>&lt;stdio.h&gt;</i></div>
<div class="section">
<h1>COPYRIGHT</h1> Portions of this text are reprinted and reproduced in electronic form from IEEE Std 1003.1, 2003 Edition, Standard for Information Technology -- Portable Operating System Interface (POSIX), The Open Group Base Specifications Issue 6, Copyright (C) 2001-2003 by the Institute of Electrical and Electronics Engineers, Inc and The Open Group. In the event of any discrepancy between this version and the original IEEE and The Open Group Standard, the original IEEE and The Open Group Standard is the referee document. The original Standard can be obtained online at http://www.opengroup.org/unix/online.html .</div>
<table class="foot">
<tr>
<td class="foot-date">
2003</td>
<td class="foot-os">
IEEE/The Open Group</td>
</tr>
</table>
</div>
</body>
</html>

