<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/posix/style.css" type="text/css" media="all"/>
<title>
OPEN(3P)</title>
</head>
<body>
<div class="mandoc">
<table class="head">
<tbody>
<tr>
<td class="head-ltitle">
OPEN(3P)</td>
<td class="head-vol">
POSIX Programmer's Manual</td>
<td class="head-rtitle">
OPEN(3P)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1>PROLOG</h1> This manual page is part of the POSIX Programmer's Manual. The Linux implementation of this interface may differ (consult the corresponding Linux manual page for details of Linux behavior), or the interface may not be implemented on Linux.</div>
<div class="section">
<h1>NAME</h1> open - open a file</div>
<div class="section">
<h1>SYNOPSIS</h1>  <b>#include &lt;sys/stat.h&gt; </b>  <b></b><div style="height: 0.00em;">
&#160;</div>
#include &lt;fcntl.h&gt;<div style="height: 0.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
int open(const char *<b></b><i>path</i><b></b><b>, int</b><b> </b><i>oflag</i><b></b><b>, ...</b>  <b>);</b><div style="height: 0.00em;">
&#160;</div>
<b></b></div>
<div class="section">
<h1>DESCRIPTION</h1> The  <i>open</i>() function shall establish the connection between a file and a file descriptor. It shall create an open file description that refers to a file and a file descriptor that refers to that open file description. The file descriptor is used by other I/O functions to refer to that file. The  <i>path</i> argument points to a pathname naming the file.<div class="spacer">
</div>
The <i>open</i>() function shall return a file descriptor for the named file that is the lowest file descriptor not currently open for that process. The open file description is new, and therefore the file descriptor shall not share it with any other process in the system. The FD_CLOEXEC file descriptor flag associated with the new file descriptor shall be cleared.<div class="spacer">
</div>
The file offset used to mark the current position within the file shall be set to the beginning of the file.<div class="spacer">
</div>
The file status flags and file access modes of the open file description shall be set according to the value of  <i>oflag</i>.<div class="spacer">
</div>
Values for <i>oflag</i> are constructed by a bitwise-inclusive OR of flags from the following list, defined in  <i>&lt;fcntl.h&gt;</i>. Applications shall specify exactly one of the first three values (file access modes) below in the value of  <i>oflag</i>:<dl>
<dt>
O_RDONLY</dt>
<dd>
Open for reading only.</dd>
</dl>
<dl>
<dt>
O_WRONLY</dt>
<dd>
Open for writing only.</dd>
</dl>
<dl>
<dt>
O_RDWR</dt>
<dd>
Open for reading and writing. The result is undefined if this flag is applied to a FIFO.<div style="height: 1.00em;">
&#160;</div>
</dd>
</dl>
<div class="spacer">
</div>
Any combination of the following may be used:<dl>
<dt>
O_APPEND</dt>
<dd>
If set, the file offset shall be set to the end of the file prior to each write.</dd>
</dl>
<dl>
<dt>
O_CREAT</dt>
<dd>
If the file exists, this flag has no effect except as noted under O_EXCL below. Otherwise, the file shall be created; the user ID of the file shall be set to the effective user ID of the process; the group ID of the file shall be set to the group ID of the file's parent directory or to the effective group ID of the process; and the access permission bits (see  <i>&lt;sys/stat.h&gt;</i>) of the file mode shall be set to the value of the third argument taken as type  <b>mode_t</b> modified as follows: a bitwise AND is performed on the file-mode bits and the corresponding bits in the complement of the process' file mode creation mask. Thus, all bits in the file mode whose corresponding bit in the file mode creation mask is set are cleared. When bits other than the file permission bits are set, the effect is unspecified. The third argument does not affect whether the file is open for reading, writing, or for both. Implementations shall provide a way to initialize the file's group ID to the group ID of the parent directory. Implementations may, but need not, provide an implementation-defined way to initialize the file's group ID to the effective group ID of the calling process.</dd>
</dl>
<dl>
<dt>
O_DSYNC</dt>
<dd>
Write I/O operations on the file descriptor shall complete as defined by synchronized I/O data integrity completion.</dd>
</dl>
<dl>
<dt>
O_EXCL</dt>
<dd>
If O_CREAT and O_EXCL are set, <i>open</i>() shall fail if the file exists. The check for the existence of the file and the creation of the file if it does not exist shall be atomic with respect to other threads executing  <i>open</i>() naming the same filename in the same directory with O_EXCL and O_CREAT set. If O_EXCL and O_CREAT are set, and  <i>path</i> names a symbolic link,  <i>open</i>() shall fail and set <i>errno</i> to [EEXIST], regardless of the contents of the symbolic link. If O_EXCL is set and O_CREAT is not set, the result is undefined.</dd>
</dl>
<dl>
<dt>
O_NOCTTY</dt>
<dd>
If set and <i>path</i> identifies a terminal device, <i>open</i>() shall not cause the terminal device to become the controlling terminal for the process.</dd>
</dl>
<dl>
<dt>
O_NONBLOCK</dt>
<dd>
When opening a FIFO with O_RDONLY or O_WRONLY set:</dd>
</dl>
<div style="margin-left: 5.00ex;">
<dl>
<dt>
 *</dt>
<dd>
If O_NONBLOCK is set, an <i>open</i>() for reading-only shall return without delay. An  <i>open</i>() for writing-only shall return an error if no process currently has the file open for reading.</dd>
</dl>
<dl>
<dt>
 *</dt>
<dd>
If O_NONBLOCK is clear, an <i>open</i>() for reading-only shall block the calling thread until a thread opens the file for writing. An  <i>open</i>() for writing-only shall block the calling thread until a thread opens the file for reading.</dd>
</dl>
</div>
<div class="spacer">
</div>
When opening a block special or character special file that supports non-blocking opens:<div style="margin-left: 5.00ex;">
<dl>
<dt>
 *</dt>
<dd>
If O_NONBLOCK is set, the <i>open</i>() function shall return without blocking for the device to be ready or available. Subsequent behavior of the device is device-specific.</dd>
</dl>
<dl>
<dt>
 *</dt>
<dd>
If O_NONBLOCK is clear, the <i>open</i>() function shall block the calling thread until the device is ready or available before returning.</dd>
</dl>
</div>
<div class="spacer">
</div>
Otherwise, the behavior of O_NONBLOCK is unspecified.<dl>
<dt>
O_RSYNC</dt>
<dd>
Read I/O operations on the file descriptor shall complete at the same level of integrity as specified by the O_DSYNC and O_SYNC flags. If both O_DSYNC and O_RSYNC are set in  <i>oflag</i>, all I/O operations on the file descriptor shall complete as defined by synchronized I/O data integrity completion. If both O_SYNC and O_RSYNC are set in flags, all I/O operations on the file descriptor shall complete as defined by synchronized I/O file integrity completion.</dd>
</dl>
<dl>
<dt>
O_SYNC</dt>
<dd>
Write I/O operations on the file descriptor shall complete as defined by synchronized I/O file integrity completion.</dd>
</dl>
<dl>
<dt>
O_TRUNC</dt>
<dd>
If the file exists and is a regular file, and the file is successfully opened O_RDWR or O_WRONLY, its length shall be truncated to 0, and the mode and owner shall be unchanged. It shall have no effect on FIFO special files or terminal device files. Its effect on other file types is implementation-defined. The result of using O_TRUNC with O_RDONLY is undefined.<div style="height: 1.00em;">
&#160;</div>
</dd>
</dl>
<div class="spacer">
</div>
If O_CREAT is set and the file did not previously exist, upon successful completion,  <i>open</i>() shall mark for update the  <i>st_atime,</i> <i>st_ctime</i>, and <i>st_mtime</i> fields of the file and the  <i>st_ctime</i> and <i>st_mtime</i> fields of the parent directory.<div class="spacer">
</div>
If O_TRUNC is set and the file did previously exist, upon successful completion,  <i>open</i>() shall mark for update the  <i>st_ctime</i> and <i>st_mtime</i> fields of the file.<div class="spacer">
</div>
If both the O_SYNC and O_DSYNC flags are set, the effect is as if only the O_SYNC flag was set.<div class="spacer">
</div>
If <i>path</i> refers to a STREAMS file, <i>oflag</i> may be constructed from O_NONBLOCK OR'ed with either O_RDONLY, O_WRONLY, or O_RDWR. Other flag values are not applicable to STREAMS devices and shall have no effect on them. The value O_NONBLOCK affects the operation of STREAMS drivers and certain functions applied to file descriptors associated with STREAMS files. For STREAMS drivers, the implementation of O_NONBLOCK is device-specific.<div class="spacer">
</div>
If <i>path</i> names the master side of a pseudo-terminal device, then it is unspecified whether  <i>open</i>() locks the slave side so that it cannot be opened. Conforming applications shall call  <i>unlockpt</i>() before opening the slave side.<div class="spacer">
</div>
The largest value that can be represented correctly in an object of type  <b>off_t</b> shall be established as the offset maximum in the open file description.</div>
<div class="section">
<h1>RETURN VALUE</h1> Upon successful completion, the function shall open the file and return a non-negative integer representing the lowest numbered unused file descriptor. Otherwise, -1 shall be returned and  <i>errno</i> set to indicate the error. No files shall be created or modified if the function returns -1.</div>
<div class="section">
<h1>ERRORS</h1> The  <i>open</i>() function shall fail if:<dl>
<dt>
<b>EACCES</b></dt>
<dd>
Search permission is denied on a component of the path prefix, or the file exists and the permissions specified by  <i>oflag</i> are denied, or the file does not exist and write permission is denied for the parent directory of the file to be created, or O_TRUNC is specified and write permission is denied.</dd>
</dl>
<dl>
<dt>
<b>EEXIST</b></dt>
<dd>
O_CREAT and O_EXCL are set, and the named file exists.</dd>
</dl>
<dl>
<dt>
<b>EINTR</b></dt>
<dd>
A signal was caught during <i>open</i>().</dd>
</dl>
<dl>
<dt>
<b>EINVAL</b></dt>
<dd>
The implementation does not support synchronized I/O for this file.</dd>
</dl>
<dl>
<dt>
<b>EIO</b></dt>
<dd>
The <i>path</i> argument names a STREAMS file and a hangup or error occurred during the  <i>open</i>().</dd>
</dl>
<dl>
<dt>
<b>EISDIR</b></dt>
<dd>
The named file is a directory and <i>oflag</i> includes O_WRONLY or O_RDWR.</dd>
</dl>
<dl>
<dt>
<b>ELOOP</b></dt>
<dd>
A loop exists in symbolic links encountered during resolution of the  <i>path</i> argument.</dd>
</dl>
<dl>
<dt>
<b>EMFILE</b></dt>
<dd>
{OPEN_MAX} file descriptors are currently open in the calling process.</dd>
</dl>
<dl>
<dt>
<b>ENAMETOOLONG</b></dt>
<dd>
The length of the <i>path</i> argument exceeds {PATH_MAX} or a pathname component is longer than {NAME_MAX}.</dd>
</dl>
<dl>
<dt>
<b>ENFILE</b></dt>
<dd>
The maximum allowable number of files is currently open in the system.</dd>
</dl>
<dl>
<dt>
<b>ENOENT</b></dt>
<dd>
O_CREAT is not set and the named file does not exist; or O_CREAT is set and either the path prefix does not exist or the  <i>path</i> argument points to an empty string.</dd>
</dl>
<dl>
<dt>
<b>ENOSR</b></dt>
<dd>
The <i>path</i> argument names a STREAMS-based file and the system is unable to allocate a STREAM.</dd>
</dl>
<dl>
<dt>
<b>ENOSPC</b></dt>
<dd>
The directory or file system that would contain the new file cannot be expanded, the file does not exist, and O_CREAT is specified.</dd>
</dl>
<dl>
<dt>
<b>ENOTDIR</b></dt>
<dd>
A component of the path prefix is not a directory.</dd>
</dl>
<dl>
<dt>
<b>ENXIO</b></dt>
<dd>
O_NONBLOCK is set, the named file is a FIFO, O_WRONLY is set, and no process has the file open for reading.</dd>
</dl>
<dl>
<dt>
<b>ENXIO</b></dt>
<dd>
The named file is a character special or block special file, and the device associated with this special file does not exist.</dd>
</dl>
<dl>
<dt>
<b>EOVERFLOW</b></dt>
<dd>
The named file is a regular file and the size of the file cannot be represented correctly in an object of type  <b>off_t</b>.</dd>
</dl>
<dl>
<dt>
<b>EROFS</b></dt>
<dd>
The named file resides on a read-only file system and either O_WRONLY, O_RDWR, O_CREAT (if the file does not exist), or O_TRUNC is set in the  <i>oflag</i> argument.<div style="height: 1.00em;">
&#160;</div>
</dd>
</dl>
<div class="spacer">
</div>
The <i>open</i>() function may fail if:<dl>
<dt>
<b>EAGAIN</b></dt>
<dd>
The <i>path</i> argument names the slave side of a pseudo-terminal device that is locked.</dd>
</dl>
<dl>
<dt>
<b>EINVAL</b></dt>
<dd>
The value of the <i>oflag</i> argument is not valid.</dd>
</dl>
<dl>
<dt>
<b>ELOOP</b></dt>
<dd>
More than {SYMLOOP_MAX} symbolic links were encountered during resolution of the  <i>path</i> argument.</dd>
</dl>
<dl>
<dt>
<b>ENAMETOOLONG</b></dt>
<dd>
As a result of encountering a symbolic link in resolution of the <i>path</i> argument, the length of the substituted pathname string exceeded {PATH_MAX}.</dd>
</dl>
<dl>
<dt>
<b>ENOMEM</b></dt>
<dd>
The <i>path</i> argument names a STREAMS file and the system is unable to allocate resources.</dd>
</dl>
<dl>
<dt>
<b>ETXTBSY</b></dt>
<dd>
The file is a pure procedure (shared text) file that is being executed and  <i>oflag</i> is O_WRONLY or O_RDWR.<div style="height: 1.00em;">
&#160;</div>
</dd>
</dl>
<div class="spacer">
</div>
<i>The following sections are informative.</i></div>
<div class="section">
<h1>EXAMPLES</h1><div class="subsection">
<h2>Opening a File for Writing by the Owner</h2> The following example opens the file  <b>/tmp/file</b>, either by creating it (if it does not already exist), or by truncating its length to 0 (if it does exist). In the former case, if the call creates a new file, the access permission bits in the file mode of the file are set to permit reading and writing by the owner, and to permit reading only by group members and others.<div class="spacer">
</div>
If the call to <i>open</i>() is successful, the file is opened for writing.<div style="height: 1.00em;">
&#160;</div>
<div style="margin-left: 5.00ex;">
<div class="spacer">
</div>
<br/>
<b>#include &lt;fcntl.h&gt;</b><br/>
<b>...</b><br/>
<b>int fd;</b><br/>
<b>mode_t mode = S_IRUSR | S_IWUSR | S_IRGRP | S_IROTH;</b><br/>
<b>char *filename = &quot;/tmp/file&quot;;</b><br/>
<b>...</b><br/>
<b>fd = open(filename, O_WRONLY | O_CREAT | O_TRUNC, mode);</b><br/>
<b>...</b><br/>
<b></b><br/>
</div>
</div>
<div class="subsection">
<h2>Opening a File Using an Existence Check</h2> The following example uses the  <i>open</i>() function to try to create the  <b>LOCKFILE</b> file and open it for writing. Since the  <i>open</i>() function specifies the O_EXCL flag, the call fails if the file already exists. In that case, the program assumes that someone else is updating the password file and exits.<div style="height: 1.00em;">
&#160;</div>
<div style="margin-left: 5.00ex;">
<div class="spacer">
</div>
<br/>
<b>#include &lt;fcntl.h&gt;</b><br/>
<b>#include &lt;stdio.h&gt;</b><br/>
<b>#include &lt;stdlib.h&gt;</b><div style="height: 1.00em;">
&#160;</div>
<div class="spacer">
</div>
<br/>
#define LOCKFILE &quot;/etc/ptmp&quot;<br/>
...<br/>
int pfd; /* Integer for file descriptor returned by open() call. */<br/>
...<br/>
if ((pfd = open(LOCKFILE, O_WRONLY | O_CREAT | O_EXCL,<br/>
    S_IRUSR | S_IWUSR | S_IRGRP | S_IROTH)) == -1)<br/>
{<br/>
    fprintf(stderr, &quot;Cannot open /etc/ptmp. Try again later.\n&quot;);<br/>
    exit(1);<br/>
}<br/>
...<br/>
<b></b><br/>
</div>
</div>
<div class="subsection">
<h2>Opening a File for Writing</h2> The following example opens a file for writing, creating the file if it does not already exist. If the file does exist, the system truncates the file to zero bytes.<div style="height: 1.00em;">
&#160;</div>
<div style="margin-left: 5.00ex;">
<div class="spacer">
</div>
<br/>
<b>#include &lt;fcntl.h&gt;</b><br/>
<b>#include &lt;stdio.h&gt;</b><br/>
<b>#include &lt;stdlib.h&gt;</b><div style="height: 1.00em;">
&#160;</div>
<div class="spacer">
</div>
<br/>
#define LOCKFILE &quot;/etc/ptmp&quot;<br/>
...<br/>
int pfd;<br/>
char filename[PATH_MAX+1];<br/>
...<br/>
if ((pfd = open(filename, O_WRONLY | O_CREAT | O_TRUNC,<br/>
    S_IRUSR | S_IWUSR | S_IRGRP | S_IROTH)) == -1)<br/>
{<br/>
    perror(&quot;Cannot open output file\n&quot;); exit(1);<br/>
}<br/>
...<br/>
<b></b><br/>
</div>
</div>
</div>
<div class="section">
<h1>APPLICATION USAGE</h1> None.</div>
<div class="section">
<h1>RATIONALE</h1> Except as specified in this volume of IEEE&#160;Std&#160;1003.1-2001, the flags allowed in  <i>oflag</i> are not mutually-exclusive and any number of them may be used simultaneously.<div class="spacer">
</div>
Some implementations permit opening FIFOs with O_RDWR. Since FIFOs could be implemented in other ways, and since two file descriptors can be used to the same effect, this possibility is left as undefined.<div class="spacer">
</div>
See <i>getgroups</i>() about the group of a newly created file.<div class="spacer">
</div>
The use of <i>open</i>() to create a regular file is preferable to the use of  <i>creat</i>(), because the latter is redundant and included only for historical reasons.<div class="spacer">
</div>
The use of the O_TRUNC flag on FIFOs and directories (pipes cannot be  <i>open</i>()-ed) must be permissible without unexpected side effects (for example,  <i>creat</i>() on a FIFO must not remove data). Since terminal special files might have type-ahead data stored in the buffer, O_TRUNC should not affect their content, particularly if a program that normally opens a regular file should open the current controlling terminal instead. Other file types, particularly implementation-defined ones, are left implementation-defined.<div class="spacer">
</div>
IEEE&#160;Std&#160;1003.1-2001 permits [EACCES] to be returned for conditions other than those explicitly listed.<div class="spacer">
</div>
The O_NOCTTY flag was added to allow applications to avoid unintentionally acquiring a controlling terminal as a side effect of opening a terminal file. This volume of IEEE&#160;Std&#160;1003.1-2001 does not specify how a controlling terminal is acquired, but it allows an implementation to provide this on  <i>open</i>() if the O_NOCTTY flag is not set and other conditions specified in the Base Definitions volume of IEEE&#160;Std&#160;1003.1-2001, Chapter 11, General Terminal Interface are met. The O_NOCTTY flag is an effective no-op if the file being opened is not a terminal device.<div class="spacer">
</div>
In historical implementations the value of O_RDONLY is zero. Because of that, it is not possible to detect the presence of O_RDONLY and another option. Future implementations should encode O_RDONLY and O_WRONLY as bit flags so that:<div style="height: 1.00em;">
&#160;</div>
<div style="margin-left: 5.00ex;">
<div class="spacer">
</div>
<br/>
<b>O_RDONLY | O_WRONLY == O_RDWR</b><br/>
<b></b><br/>
</div>
<div class="spacer">
</div>
In general, the <i>open</i>() function follows the symbolic link if  <i>path</i> names a symbolic link. However, the  <i>open</i>() function, when called with O_CREAT and O_EXCL, is required to fail with [EEXIST] if  <i>path</i> names an existing symbolic link, even if the symbolic link refers to a nonexistent file. This behavior is required so that privileged applications can create a new file in a known location without the possibility that a symbolic link might cause the file to be created in a different location.<div class="spacer">
</div>
For example, a privileged application that must create a file with a predictable name in a user-writable directory, such as the user's home directory, could be compromised if the user creates a symbolic link with that name that refers to a nonexistent file in a system directory. If the user can influence the contents of a file, the user could compromise the system by creating a new system configuration or spool file that would then be interpreted by the system. The test for a symbolic link which refers to a nonexisting file must be atomic with the creation of a new file.<div class="spacer">
</div>
The POSIX.1-1990 standard required that the group ID of a newly created file be set to the group ID of its parent directory or to the effective group ID of the creating process. FIPS 151-2 required that implementations provide a way to have the group ID be set to the group ID of the containing directory, but did not prohibit implementations also supporting a way to set the group ID to the effective group ID of the creating process. Conforming applications should not assume which group ID will be used. If it matters, an application can use  <i>chown</i>() to set the group ID after the file is created, or determine under what conditions the implementation will set the desired group ID.</div>
<div class="section">
<h1>FUTURE DIRECTIONS</h1> None.</div>
<div class="section">
<h1>SEE ALSO</h1>  <i>chmod</i>(), <i>close</i>(), <i>creat</i>(), <i>dup</i>(), <i>fcntl</i>(),  <i>lseek</i>(), <i>read</i>(), <i>umask</i>(), <i>unlockpt</i>(),  <i>write</i>(), the Base Definitions volume of IEEE&#160;Std&#160;1003.1-2001,  <i>&lt;fcntl.h&gt;</i>, <i>&lt;sys/stat.h&gt;</i>, <i>&lt;sys/types.h&gt;</i></div>
<div class="section">
<h1>COPYRIGHT</h1> Portions of this text are reprinted and reproduced in electronic form from IEEE Std 1003.1, 2003 Edition, Standard for Information Technology -- Portable Operating System Interface (POSIX), The Open Group Base Specifications Issue 6, Copyright (C) 2001-2003 by the Institute of Electrical and Electronics Engineers, Inc and The Open Group. In the event of any discrepancy between this version and the original IEEE and The Open Group Standard, the original IEEE and The Open Group Standard is the referee document. The original Standard can be obtained online at http://www.opengroup.org/unix/online.html .</div>
<table class="foot">
<tr>
<td class="foot-date">
2003</td>
<td class="foot-os">
IEEE/The Open Group</td>
</tr>
</table>
</div>
</body>
</html>

