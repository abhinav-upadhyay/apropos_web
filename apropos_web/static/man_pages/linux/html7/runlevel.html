<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/linux/style.css" type="text/css" media="all"/>
<title>
runlevel(7)</title>
</head>
<body>
<div class="mandoc">
<table class="head">
<tbody>
<tr>
<td class="head-ltitle">
runlevel(7)</td>
<td class="head-vol">
Miscellaneous Information Manual</td>
<td class="head-rtitle">
runlevel(7)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1>NAME</h1> runlevel - event signalling change of system runlevel</div>
<div class="section">
<h1>SYNOPSIS</h1> <b>runlevel</b> <b>RUNLEVEL=</b><i>RUNLEVEL</i> <b>PREVLEVEL=</b><i>PREVLEVEL</i> [<i>ENV</i>]...</div>
<div class="section">
<h1>DESCRIPTION</h1> This page describes the <b>runlevel</b> Upstart event, and the general implementation of runlevels in the Upstart system.  For the runlevel tool, see <b>runlevel</b>(8)<div class="subsection">
<h2>The runlevel event</h2> The <b>runlevel</b> event signals a change of system runlevel.  The new system runlevel is given in the <b>RUNLEVEL</b> argument, and the previous system runlevel in the <b>PREVLEVEL</b> argument (which may be empty).<div style="height: 1.00em;">
&#160;</div>
Additional environment may follow these depending on the runlevel, and the tool that emitted the event.  The <b>shutdown</b>(8) tool will supply an <b>INIT_HALT</b> variable set to either <i>HALT</i> or <i>POWEROFF</i> when called with <b>-H</b> or <b>-P</b> respectively.</div>
<div class="subsection">
<h2>Runlevels</h2> Runlevels are a concept from UNIX System V used by the <b>init</b>(8) daemon or other system initialisation system to define modes of system operation.<div style="height: 1.00em;">
&#160;</div>
Eight runlevels are permitted, the first seven are numbered <b>0</b>-<b>6</b> and the eighth is named <b>S</b> or <b>s</b> (both are permitted).<div style="height: 1.00em;">
&#160;</div>
Services and other system components are said to exist in one or more runlevels.  When switching from one runlevel to another, the services that should not exist in the new runlevel are stopped and the services that only exist in the new runlevel are started.<div style="height: 1.00em;">
&#160;</div>
This is performed by the <b>/etc/init.d/rc</b> script executed on a change of runlevel (by jobs run on the <b>runlevel</b> event in the Upstart system).  This script examines symlinks in the <i>/etc/rc?.d</i> directories, symlinks beginning <b>K</b> are services to be stopped and symlinks beginning <b>S</b> are services to be started.<div style="height: 1.00em;">
&#160;</div>
The authorative documentation for this process can be found in the <i>System run levels and init.d scripts</i> section of the <i>Debian Policy Manual. This may be currently found at</i> &lt;<b>http://www.debian.org/doc/debian-policy/ch-opersys.html#s-sysvinit</b>&gt;<div style="height: 1.00em;">
&#160;</div>
Runlevels <b>0</b>, <b>1</b> and <b>6</b> are reserved.  Runlevel <b>0</b> is used to halt the system and <b>6</b> to reboot the system.  Runlevel <b>1</b> is used to bring the system back down into single-user mode, after which the runlevel will be <b>S</b>.</div>
<div class="subsection">
<h2>System V initialisation in Upstart</h2> The compatible implementation of runlevels permits Upstart jobs to be run on the <b>runlevel</b> event that perform the same functionality as the original System V <b>init</b>(8) daemon.<div style="height: 1.00em;">
&#160;</div>
The <i>/etc/init/rc.conf</i> job is run on the <b>runlevel</b> event, thus receiving the <b>RUNLEVEL</b> and <b>PREVLEVEL</b> environment variables.  Its sole job is to execute the <b>/etc/init.d/rc</b> script, passing the new runlevel as an argument.<div style="height: 1.00em;">
&#160;</div>
Initial system startup is provided by the <i>/etc/init/rc-sysinit.conf</i> job.  This is run on the <b>startup</b>(7) event, and is primarily responsible for running the <b>/etc/init.d/rc</b> script with the special <b>S</b> argument and calling <b>telinit</b>(8) to switch into the default runlevel when done.  This also handles the <b>-b</b>, <b>emergency</b>, <b>-s</b> and <b>single</b> kernel command-line options as well as specifying an alternate runlevel on the kernel command-line.<div style="height: 1.00em;">
&#160;</div>
Finally the <i>/etc/init/rcS.conf</i> job handles the special case of entering the single-user runlevel and providing a login shell.  Once that shell terminates, this restarts the <i>rc-sysinit</i> job to re-enter the default runlevel.</div>
<div class="subsection">
<h2>Implementation of runlevels in Upstart</h2> The Upstart <b>init</b>(8) daemon has no native concepts of runlevel, and unlike the System V daemon, makes no attempt to keep track of the current runlevel.<div style="height: 1.00em;">
&#160;</div>
Instead a compatible implementation is provided by the <b>runlevel</b>(8), <b>telinit</b>(8) and <b>shutdown</b>(8) tools supplied with Upstart.<div style="height: 1.00em;">
&#160;</div>
The <b>telinit</b>(8) and <b>shutdown</b>(8) tools are used by system administrators to change the runlevel, thus they both generate this <b>runlevel</b> event obtaining the value for the <b>PREVLEVEL</b> environment variable from their own environment (the <b>RUNLEVEL</b> variable) or the <i>/var/run/utmp</i> file.<div style="height: 1.00em;">
&#160;</div>
Additionally they update the <i>/var/run/utmp</i> file with the new runlevel, and append a log entry to the <i>/var/log/wtmp</i> file.<div style="height: 1.00em;">
&#160;</div>
The <b>runlevel</b>(8) tool may be used by system administrators to obtain the current runlevel, this reads the <b>RUNLEVEL</b> and <b>PREVLEVEL</b> variables from its own environment or reads the current and previous runlevel from <i>/var/run/utmp</i>.<div style="height: 1.00em;">
&#160;</div>
The <b>who</b>(1) <b>-r</b> command may also be used to read the current runlevel from <i>/var/run/utmp</i>.<div style="height: 1.00em;">
&#160;</div>
This provides full compatibility with System V.<div style="height: 1.00em;">
&#160;</div>
During the boot scripts, where the <i>/var/run/utmp</i> file may not yet be writable, the <b>RUNLEVEL</b> and <b>PREVLEVEL</b> environment variables will be available so <b>telinit</b>(8) will still provide the correct values.<div style="height: 1.00em;">
&#160;</div>
Once the boot scripts have finished, while the environment variables may no longer be available, the <i>/var/run/utmp</i> file will be and the most recent <b>telinit</b>(8) invocation should have successfully written to it.</div>
<div class="subsection">
<h2>Boot time records</h2> The <b>telinit</b>(8) tool also takes care of writing the boot time record to both <i>/var/run/utmp</i> and <i>/var/log/wtmp</i>.<div style="height: 1.00em;">
&#160;</div>
This is written if the previous runlevel in these files does not match the previous runlevel obtained from its environment.  In general this occurs when switching from runlevel <b>S</b> to the default runlevel, at which point the <i>/var/run/utmp</i> and <i>/var/log/wtmp</i> files are both writable, and the <b>telinit</b>(8) invocation to do the switch has <b>RUNLEVEL=</b><i>S</i> in its environment.</div>
</div>
<div class="section">
<h1>EXAMPLE</h1> A service running in the typical multi-user runlevels might use:<div style="height: 1.00em;">
&#160;</div>
<div style="margin-left: 5.00ex;">
<br/>
start on runlevel [2345]<br/>
stop on runlevel [!2345]<br/>
</div>
</div>
<div class="section">
<h1>SEE ALSO</h1> <b>runlevel</b>(8) <b>init</b>(8) <b>telinit</b>(8) <b>shutdown</b>(8) <b>who</b>(1)</div>
<table class="foot">
<tr>
<td class="foot-date">
2009-07-09</td>
<td class="foot-os">
Upstart</td>
</tr>
</table>
</div>
</body>
</html>

