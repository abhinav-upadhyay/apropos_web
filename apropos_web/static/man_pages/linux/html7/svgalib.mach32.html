<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/linux/style.css" type="text/css" media="all"/>
<title>
svgalib.mach32(7)</title>
</head>
<body>
<div class="mandoc">
<table class="head">
<tbody>
<tr>
<td class="head-ltitle">
svgalib.mach32(7)</td>
<td class="head-vol">
Svgalib User Manual</td>
<td class="head-rtitle">
svgalib.mach32(7)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1>NAME</h1> svgalib.mach32 - Information on the Mach32 chipset driver<div style="height: 1.00em;">
&#160;</div>
</div>
<div class="section">
<h1>TABLE OF CONTENTS</h1> <b> 0. </b>Introduction<div style="height: 0.00em;">
&#160;</div>
<b> 1. </b>Specifying pixel clocks<div style="height: 0.00em;">
&#160;</div>
<b> 2. </b>Copyrights<div style="height: 0.00em;">
&#160;</div>
<b> 3. </b>The mach32info utility<div style="height: 0.00em;">
&#160;</div>
<b> 4. </b>Third party cards<div style="height: 0.00em;">
&#160;</div>
<b> 5. </b>Logical line width<div style="height: 0.00em;">
&#160;</div>
<b> 6. </b>Noisy video signals<div style="height: 0.00em;">
&#160;</div>
<b> 7. </b>The configuration EEPROM<div style="height: 0.00em;">
&#160;</div>
<b> 8. </b>EEPROM woes<div style="height: 0.00em;">
&#160;</div>
<b> 9. </b>The Mach32Eeprom command<div style="height: 0.00em;">
&#160;</div>
<b>10. </b>Setup of the memory aperture (linear framebuffer)<div style="height: 0.00em;">
&#160;</div>
<b>11. </b>Accelerator support and other weird features<div style="height: 0.00em;">
&#160;</div>
<b>12. </b>Ramdacs<div style="height: 0.00em;">
&#160;</div>
<b>13. </b>Meaning of the detection message from svgalib<div style="height: 0.00em;">
&#160;</div>
<b>14. </b>Conclusions<div style="height: 1.00em;">
&#160;</div>
</div>
<div class="section">
<h1>0. INTRODUCTION</h1> The driver should allow you to use any of the graph-modes your Mach32 card supports. Note that there is no support for &lt;8bpp modes and that I won't ever implement that because I don't see any reason for doing so. All standard VGA-modes are supported, of course (by using the standard VGA driver routines).<div style="height: 1.00em;">
&#160;</div>
If you configured your Mach32 for a memory aperture and it is at least as big as the memory of your card (that is, not a 1MB memory aperture for a 2MB card) support for linear frame buffer access of svgalib is given.<div style="height: 1.00em;">
&#160;</div>
Auto detection of the Mach32 seems not to work on all cards. That's really strange since I got the code from the X people. It should be OK regardless of my docs. Well, I fixed that (hopefully). Actually the bug was found by Daniel Lee Jackson (djackson@ichips.intel.com). (Thanks again.. It was so silly... I would have never found it) If you still have problems just put a chipset Mach32 in your config file.<div style="height: 1.00em;">
&#160;</div>
</div>
<div class="section">
<h1>1. SPECIFYING PIXEL CLOCKS</h1> <b>WARNING!</b> The Mach32 driver needs to know correct clock frequencies for graceful DAC configuration. Wrong clocks may damage your card! However, this version contains code for automatic clock detection. Since clock detection is time critical, please do it on a completely idle system. Then put the printed out <b>clocks</b> line in your <b>libvga.config</b>(5) file.<div style="height: 1.00em;">
&#160;</div>
The driver tries to do this for you. After that, you can restart whatever svgalib program you used and you are set. If you already put a <b>clocks</b> line in your config by hand, comment it out to have the driver check your clocks.<div style="height: 1.00em;">
&#160;</div>
Since clock probing is time critical, values differ from time to time, you may try it multiple times and see which values seem to be most exact. You can also compare them with the standard clock chips for Mach32 cards in <b>libvga.config</b>(5)).<div style="height: 1.00em;">
&#160;</div>
The clock probing relies on the 7th clock being 44.9MHz as this is what Xfree does. If this is not true (and it is not always), probing is hosed. See <b>libvga.config</b>(5) for a list of the <b>clocks</b> used by common svgalib cards.<div style="height: 1.00em;">
&#160;</div>
</div>
<div class="section">
<h1>2. COPYRIGHTS</h1> Some tiny routines are copied from Xfree86. The clock detection code is almost just copied. So I repeat the copyright statements for these parts here:<div style="height: 1.00em;">
&#160;</div>
Copyright 1992 by Orest Zborowski &lt;obz@Kodak.com&gt;<div style="height: 0.00em;">
&#160;</div>
Copyright 1993 by David Wexelblat &lt;dwex@goblin.org&gt;<div style="height: 1.00em;">
&#160;</div>
Permission to use, copy, modify, distribute, and sell this software and its documentation for any purpose is hereby granted without fee, provided that the above copyright notice appear in all copies and that both that copyright notice and this permission notice appear in supporting documentation, and that the names of Orest Zborowski and David Wexelblat not be used in advertising or publicity pertaining to distribution of the software without specific, written prior permission. Orest Zborowski and David Wexelblat make no representations about the suitability of this software for any purpose. It is provided &quot;as is&quot; without express or implied warranty.<div style="height: 1.00em;">
&#160;</div>
<b>Orest Zborowski and David Wexelblat disclaim all warranties with regard</b> <b>to this software, including all implied warranties of merchantability and</b> <b>fitness, in no event shall Orest Zborowski or David Wexelblat be liable</b> <b>for any special, indirect or consequential damages or any damages</b> <b>whatsoever resulting from loss of use, data or profits, whether in an</b> <b>action of contract, negligence or other tortious action, arising out of</b> <b>or in connection with the use or performance of this software.</b><div style="height: 1.00em;">
&#160;</div>
Copyright 1990,91 by Thomas Roell, Dinkelscherben, Germany.<div style="height: 0.00em;">
&#160;</div>
Copyright 1993 by Kevin E. Martin, Chapel Hill, North Carolina.<div style="height: 1.00em;">
&#160;</div>
Permission to use, copy, modify, distribute, and sell this software and its documentation for any purpose is hereby granted without fee, provided that the above copyright notice appear in all copies and that both that copyright notice and this permission notice appear in supporting documentation, and that the name of Thomas Roell not be used in advertising or publicity pertaining to distribution of the software without specific, written prior permission. Thomas Roell makes no representations about the suitability of this software for any purpose. It is provided &quot;as is&quot; without express or implied warranty.<div style="height: 1.00em;">
&#160;</div>
<b>Thomas Roell, Kevin E. Martin, and Rickard E. Faith disclaim all</b> <b>warranties with regard to this software, including all implied</b> <b>warranties of merchantability and fitness, in no event shall the authors</b> <b>be liable for any special, indirect or consequential damages or any</b> <b>damages whatsoever resulting from loss of use, data or profits, whether</b> <b>in an action of contract, negligence or other tortious action, arising</b> <b>out of or in connection with the use or performance of this software.</b><div style="height: 1.00em;">
&#160;</div>
Author:  Thomas Roell, roell@informatik.tu-muenchen.de<div style="height: 1.00em;">
&#160;</div>
Rewritten for the 8514/A by Kevin E. Martin (martin@cs.unc.edu)<div style="height: 0.00em;">
&#160;</div>
Modified for the Mach-8 by Rickard E. Faith (faith@cs.unc.edu)<div style="height: 0.00em;">
&#160;</div>
Rewritten for the Mach32 by Kevin E. Martin (martin@cs.unc.edu)<div style="height: 1.00em;">
&#160;</div>
And here is my own copyright:<div style="height: 1.00em;">
&#160;</div>
This driver is free software; you can redistribute it and/or modify it without any restrictions. This library is distributed in the hope that it will be useful, but without any warranty.<div style="height: 1.00em;">
&#160;</div>
Copyright 1994 by Michael Weller<div style="height: 1.00em;">
&#160;</div>
Email addresses as of this writing:<div style="height: 1.00em;">
&#160;</div>
eowmob@exp-math.uni-essen.de mat42b@spi.power.uni-essen.de<div style="height: 1.00em;">
&#160;</div>
<b>Michael Weller disclaims all warranties with regard</b> <b>to this software, including all implied warranties of merchantability and</b> <b>fitness, in no event shall Michael Weller be liable</b> <b>for any special, indirect or consequential damages or any damages</b> <b>whatsoever resulting from loss of use, data or profits, whether in an</b> <b>action of contract, negligence or other tortious action, arising out of</b> <b>or in connection with the use or performance of this software.</b><div style="height: 1.00em;">
&#160;</div>
</div>
<div class="section">
<h1>3. THE MACH32INFO UTILITY</h1> The <b>mach32info</b>(6) utility or demo reads out all configuration registers and the configuration EEPROM of your Mach32 card. If there is a problem with the particular card you have, compile and run the utility in the <i>mach32/</i> directory of the svgalib distribution and send it's stdout to me This might also be useful if you need a lot of options (e.g. clocks on new models?) to get it to work so that this can be done automatically in future versions.<div style="height: 1.00em;">
&#160;</div>
</div>
<div class="section">
<h1>4. THIRD PARTY CARDS</h1> I got a few reports about AST systems with onboard Mach32. They do feature an incompatible EEPROM setup, but I think I got around that. Nevertheless the Mach32 chipset driver doesn't work out of the box on any AST system I heard of.<div style="height: 1.00em;">
&#160;</div>
Since original ATI Mach32 demos and tools don't work as well, I've to claim that the Mach32 on these AST systems does not conform to ATI's Mach32 docs. Fortunately, Vernon C. Hoxie &lt;vern@zebra.alphacdc.com&gt; found a work around after years (really!) of investigating. AST Mach32 seems to work now. The work around was also submitted to Xfree and will be incorporated to allow running it on the AST hardware too in recent versions. Please read on the <b>misc_ctl</b> command below.<div style="height: 1.00em;">
&#160;</div>
Dell users should have a look at the <b>vendor</b>, <b>ramdac</b>, and <b>svgaclocks</b> commands below (if they have problems with the default settings).<div style="height: 1.00em;">
&#160;</div>
<div class="subsection">
<h2>Commands to support third party cards</h2> I had to learn that those cards seem to use not only non standard clocks for the Mach32, but also for the included SVGA. However, since people often like to use proprietary, non standard VGA (read 80x25) text modes, the Mach32 driver has to set the included SVGA to a VGA compatible clock frequency. Otherwise svgalib has problems using plain VGA modes. This screws VGA modes up if these clocks have different values on third party Mach32 cards.<div style="height: 1.00em;">
&#160;</div>
<dl>
<dt>
<b>svgaclocks </b><i>n</i></dt>
<dd>
with <i>n</i> a number between <b>0</b> and <b>31</b> to select the svga clocks to be used in vga modes. The bits of <i>n</i> refer to specific ATI register bits to complicated to explain here. Even if I would, I can't tell which clocks they would select on your third party card (which is the actual problem)<div style="height: 1.00em;">
&#160;</div>
<b>svgaclocks 9</b> is the default setting and correct for original ATI cards.<div style="height: 1.00em;">
&#160;</div>
Often <b>svgaclocks 0</b> (Dell cards) works.</dd>
</dl>
<dl>
<dt>
<b>svgaclocks keep</b></dt>
<dd>
is special in that the driver will not touch any SVGA timings. This requires the Mach32 SVGA part to be in a VGA compatible mode when the svgalib application is started, that is, you must use 80x25 (maybe 80x50) console text modes.</dd>
</dl>
<div class="spacer">
</div>
<div style="height: 1.00em;">
&#160;</div>
As I mentioned already, Vernon C. Hoxie &lt;vern@zebra.alphacdc.com&gt; really seems to have located the reason for the Mach32 AST problems. Any access to <b>MISC_CTL</b> locks up the card &amp; system. Fortunately <b>MISC_CTL</b> is only used for some DAC fine tuning (actually the setting you can fine tune with the <b>blank</b> command) which is only of barely noticeable effect to the screen.<div style="height: 1.00em;">
&#160;</div>
The following configuration commands exist to support AST cards:<div style="height: 1.00em;">
&#160;</div>
<dl>
<dt>
<b>misc_ctl keep-off</b></dt>
<dd>
Do not dare to touch MISC_CTL.</dd>
</dl>
<dl>
<dt>
<b>misc_ctl use</b></dt>
<dd>
Use it for fine tuning of the Ramdac setup (default).</dd>
</dl>
<div class="spacer">
</div>
<div style="height: 1.00em;">
&#160;</div>
Finally, for your convenience there exist:<div style="height: 1.00em;">
&#160;</div>
<dl>
<dt>
<b>vendor ati</b></dt>
<dd>
</dd>
</dl>
<dl>
<dt>
<b>vendor dell</b></dt>
<dd>
</dd>
</dl>
<dl>
<dt>
<b>vendor ast</b></dt>
<dd>
These are macros that expand to settings for <b>svgaclocks</b>, <b>ramdac</b>, <b>misc_ctl</b>, and <b>mach32eeprom</b> that are usually correct for ATI, Dell, AST cards. Be aware that they really work like macros. That is, they override any setting of <b>svgaclocks</b>, <b>ramdac</b>, <b>misc_ctl</b>, and <b>mach32eeprom</b> made before them and individual aspects will be changed by a following <b>svgaclocks</b>, <b>ramdac</b>, <b>misc_ctl</b>, and <b>mach32eeprom</b> command.<div style="height: 1.00em;">
&#160;</div>
Note that the <b>mach32eeprom ignore</b> required for some Dell cards requires you to include explicit timings for Mach32 modes other than 640x480x256. The <i>mach32/mach32.std-modes</i> file in the svgalib distribution contains recommendations for modes from ATI.<div style="height: 1.00em;">
&#160;</div>
I heard about a bug in some ATI chipsets returning wrong memory amounts configs. (But cannot confirm that)<div style="height: 1.00em;">
&#160;</div>
You can enforce correct chipset identification from the configuration file:<div style="height: 1.00em;">
&#160;</div>
</dd>
</dl>
<dl>
<dt>
<b>chipset Mach32 </b><i>chiptype memory</i></dt>
<dd>
where <i>chiptype</i> is the sum of at exactly one value from each of the following two groups<div style="height: 1.00em;">
&#160;</div>
</dd>
</dl>
<div style="margin-left: 5.00ex;">
<dl>
<dt>
<b>128</b></dt>
<dd>
use no memory aperture.</dd>
</dl>
<dl>
<dt>
<b>160</b></dt>
<dd>
use a 1MB memory aperture.</dd>
</dl>
<dl>
<dt>
<b>192</b></dt>
<dd>
use a 4MB memory aperture.</dd>
</dl>
<dl>
<dt>
<b>0</b></dt>
<dd>
choose size for the memory aperture automatically.</dd>
</dl>
<div class="spacer">
</div>
and<div style="height: 1.00em;">
&#160;</div>
<dl>
<dt>
<b>16</b></dt>
<dd>
Ramdac is of type 0 (ATI68830)</dd>
</dl>
<dl>
<dt>
<b>17</b></dt>
<dd>
Ramdac is of type 1 (IMS-G173, SC11486)</dd>
</dl>
<dl>
<dt>
<b>18</b></dt>
<dd>
Ramdac is of type 2 (ATI68875, TLC34075)</dd>
</dl>
<dl>
<dt>
<b>19</b></dt>
<dd>
Ramdac is of type 3 (INMOS176, INMOS178)</dd>
</dl>
<dl>
<dt>
<b>20</b></dt>
<dd>
Ramdac is of type 4 (Bt481, Bt482)</dd>
</dl>
<dl>
<dt>
<b>21</b></dt>
<dd>
Ramdac is of type 5 (ATI68860)</dd>
</dl>
<dl>
<dt>
<b>0</b></dt>
<dd>
Ramdac type is queried from Mach32 chip.</dd>
</dl>
</div>
<div style="height: 1.00em;">
&#160;</div>
<dl>
<dt>
</dt>
<dd>
<i>memory</i> is the amount of video memory in KB.</dd>
</dl>
<div class="spacer">
</div>
Note that the type of the ramdac can be set more conveniently with the <b>ramdac</b> command.<div style="height: 1.00em;">
&#160;</div>
</div>
</div>
<div class="section">
<h1>5. LOGICAL LINEWIDTH</h1> At least my VRAM card seems to be very peculiar about logical line widths. From my experience a multiple of 64 pels is needed. Your mileage may vary. Use the config file options to adjust it and tell me if your card needs a different value. Include the name and model number of the card and what the correct numbers should be. This is so that I can correct the auto configuration of the driver.<div style="height: 1.00em;">
&#160;</div>
If some svgalib application has problems, note that you can force the logical line width to the default value from the config file. Probably this will lead to glitches in some 800x600 resolutions. You can <b>inhibit</b> these resolutions from the config file as well. Apropos glitches, I found no guidelines as to what clock rates to use due to memory restrictions. I adjusted the driver, such that I get a stable pic in all resolutions. However sometimes the screen is disturbed by heavy video memory accesses. If you don't like that, reduce the clocks used with the maxclock16 or maxclock24 command, resp. This may of course lead to none of the predefined modes being used. Then you can try to define your own mode via the define command.<div style="height: 1.00em;">
&#160;</div>
</div>
<div class="section">
<h1>6. NOISY VIDEO SIGNALS</h1> If you get some flicker or heavy noise on your screen, some fine tuning may be needed. My docs didn't give me hints as to what each card can stand. Especially DRAM cards may give problems (I've VRAM). In that case, use the fine tuning config commands and send me your results along with the output of <b>mach32info</b>(6). Then I can include them in my next release.<div style="height: 1.00em;">
&#160;</div>
<div class="subsection">
<h2>Fine-tuning configuration commands</h2> First you should think about the <b>maxclock*</b> configuration commands to reduce pixel clocks used for each color depth.<div style="height: 1.00em;">
&#160;</div>
Especially important for DRAM cards is the video FIFO depth used to queue memory values for writing to the screen. Here is a command to set this value for the 8bpp modes:<div style="height: 1.00em;">
&#160;</div>
<dl>
<dt>
<b>vfifo8 </b><i>number</i></dt>
<dd>
where <i>number is in range</i> <b>0</b> - <b>15</b>. The default is now 6.<div style="height: 1.00em;">
&#160;</div>
Since vfifo is of some impact to the speed of the card, tell me the lowest setting that satisfies your card.<div style="height: 1.00em;">
&#160;</div>
For 16/24/32 modes, there are non-zero values preset from internal tables and the EEPROM, however you can enforce minimal vfifo values with:</dd>
</dl>
<div class="spacer">
</div>
<b>vfifo16 </b><i>number</i><div style="height: 0.00em;">
&#160;</div>
<b>vfifo24 </b><i>number</i><div style="height: 0.00em;">
&#160;</div>
<b>vfifo32 </b><i>number</i><div style="height: 1.00em;">
&#160;</div>
<dl>
<dt>
<b>blank </b><i>number</i></dt>
<dd>
where <i>number</i> is <b>4 * </b><i>pixel_delay</i><b> + </b><i>blank_adjust</i> where <i>pixel_delay</i> and <i>blank_adjust</i> are in range <b>0</b> .. <b>3</b>. <i>pixel_delay</i> delays pixels before they are sent to the DAC and <i>blank_adjust</i> adjusts the blank pulse for type 2 DAC's. <b>blank</b> should be set correctly for each DAC type automatically. So use it only as a last resort.<div style="height: 1.00em;">
&#160;</div>
</dd>
</dl>
<dl>
<dt>
<b>latch </b><i>number</i></dt>
<dd>
where <i>number</i> is the sum of zero or more of the following numbers:</dd>
</dl>
<div style="margin-left: 5.00ex;">
<dl>
<dt>
<b>128</b></dt>
<dd>
VRAM serial delay latch enable, DRAM latch bits 63 - 0 enable.</dd>
</dl>
<dl>
<dt>
<b>4096</b></dt>
<dd>
Latch video memory data.</dd>
</dl>
<dl>
<dt>
<b>8192</b></dt>
<dd>
Memory data delay latch enable for data bits 63 - 0.</dd>
</dl>
<dl>
<dt>
<b>16384</b></dt>
<dd>
Memory full clock pulse enable.</dd>
</dl>
</div>
<dl>
<dt>
</dt>
<dd>
Default is to switch all settings on (they are on on my card by default anyway).</dd>
</dl>
<div class="spacer">
</div>
<div style="height: 1.00em;">
&#160;</div>
Note that these commands may vanish again once they are no longer needed for debugging purposes.<div style="height: 1.00em;">
&#160;</div>
There is no 320x200 mode in the EEPROM of the Mach32 at all, however I defined one in the default configuration file for you. This is the best thing I could get up on my card/screen. Note that it will probably have big borders on your screen, and black lines in between the pixel lines. This is because of the lack of low clocks &lt; 16MHz on the Mach32 and the lack of a line doubling mode as VGA has. The Mach32 is not intended for such low resolutions. If you find a better mode or have an idea, please let me know. You can also just remove my timings from the default configuration file.<div style="height: 1.00em;">
&#160;</div>
</div>
</div>
<div class="section">
<h1>7. THE CONFIGURATION EEPROM</h1> Ah yes, about the EEPROM, I figured out how to read out the Mach32 EEPROM. I did it by disassembling the BIOS routine mentioned in the docs. I then redid it in C. The driver will use everything it finds there.<div style="height: 1.00em;">
&#160;</div>
Use the Mach32 install tools (they should have reached you together with your Mach32 VGA card) to setup your card/monitor combo correctly. The <b>monitors</b> setting from the config file (or default of 35kHz or something) will be obeyed by the driver nevertheless (for safety!).<div style="height: 1.00em;">
&#160;</div>
As you probably know already, accessing the EEPROM causes some screen flickering. If this annoys you (or even worse your monitor) have a look at the <b>mach32eeprom</b> command described below. This allows you to put the data from the EEPROM into a file and which can be read whenever it is required.<div style="height: 1.00em;">
&#160;</div>
Don't even think about changing the contents of the file. (There is an easily faked checksum in it.). Anyway the driver ensures (hopefully) that no damage can be caused.<div style="height: 1.00em;">
&#160;</div>
Also, if some mode is not well aligned on your screen or you don't like it's sync frequency, consider using the Mach32 install utility (setup for custom monitor) and set one up interactively. If there is no valid faster (higher VSYNC) standard mode given in the EEPROM the driver will use that mode. You will find that this is fun compared with calculating video timings for <i>/etc/XF86Config</i> or <i>/etc/vga/libvga.config</i>.<div style="height: 1.00em;">
&#160;</div>
However the install utility does restrict the maximum pixel depth for custom modes sometimes unneeded hard and the driver obeys that. (Hmm.. actually it should be smart enough to decide itself which pixel depth it can use in that mode.) Since the standard modes are usually only slightly shifted to one side a file with the configuration commands representing the standard modes is given in <i>mach32/mach32.std-modes</i> in the svgalib distribution. You can use these as a starting point.<div style="height: 1.00em;">
&#160;</div>
But here are some real problems:<div style="height: 1.00em;">
&#160;</div>
</div>
<div class="section">
<h1>8. EEPROM WOES</h1> I got 2 reports of people having problems with incorrect EEPROM checksums. Both had motherboards with onboard Mach32 VGA's from AST. I guessed a checksum algorithm from those reports and put this in the code in addition to the standard ATI style. Still I got a report of someone whose EEPROM was completely empty. If you have problems with checksums send me the output of <b>mach32info</b>(6) and I'll see what I can do.<div style="height: 1.00em;">
&#160;</div>
By default svgalib writes a complaining message and ignores the contents. You can have svgalib ignore the checksum and contents with the configuration command<div style="height: 1.00em;">
&#160;</div>
<b>mach32eeprom ignore</b><div style="height: 1.00em;">
&#160;</div>
Then you can decide to use the partial info that is still in it. Use<div style="height: 1.00em;">
&#160;</div>
<b>mach32eeprom ignore usetimings</b><div style="height: 1.00em;">
&#160;</div>
to use the video modes that are defined in the EEPROM (if no better modes are known by the driver). This is usually safe, because the driver knows which modes are safe for your hardware (if <b>clocks</b>, <b>monitor</b> and <b>ramdac</b> are configured correctly). You can also allow the driver to use the configuration for the linear frame buffer in the EEPROM:<div style="height: 1.00em;">
&#160;</div>
<b>mach32eeprom ignore useaperture</b><div style="height: 1.00em;">
&#160;</div>
or<div style="height: 1.00em;">
&#160;</div>
<b>mach32eeprom ignore usetimings useaperture</b><div style="height: 1.00em;">
&#160;</div>
However I discourage this because the driver will just enable what the EEPROM says about the aperture. Use <b>mach32info</b>(6) to check the address it will choose is safe. It might be better to use <b>setuplinear</b> to set up a 4MB aperture at a free address range.<div style="height: 1.00em;">
&#160;</div>
</div>
<div class="section">
<h1>9. THE MACH32EEPROM COMMAND</h1> The <b>mach32eeprom</b> allows to work around these problems. Here is the complete description for this configuration command.<div style="height: 1.00em;">
&#160;</div>
<dl>
<dt>
<b>mach32eeprom </b><i>filename</i></dt>
<dd>
The <i>filename</i> has to begin with a &quot;/&quot;.<div style="height: 1.00em;">
&#160;</div>
Unfortunately reading the EEPROM causes annoying screen flickering and is slow. To avoid this, specify a <i>filename</i> from which to read the contents of the EEPROM.<div style="height: 1.00em;">
&#160;</div>
If the file cannot be read, the EEPROM is read out and the file is created. There is a very simple checksum put into this file. Although it can easily be fooled, don't change the file except you know <b>very, very</b> well what you are doing.<div style="height: 1.00em;">
&#160;</div>
Also, as long as the file exists, changes in the Mach32's EEPROM are ignored. Delete the file to recreate an updated version on next use of svgalib. You should ensure that the permissions of the file don't allow normal users to change it. (This may happen if umask has a bad value when svgalib creates the file).<div style="height: 1.00em;">
&#160;</div>
Example:<div style="height: 1.00em;">
&#160;</div>
<b>mach32eeprom /etc/vga/mach32.eeprom</b><div style="height: 1.00em;">
&#160;</div>
</dd>
</dl>
<div class="spacer">
</div>
<div style="height: 1.00em;">
&#160;</div>
Due to problems with some boards this command got heavily expanded:<div style="height: 1.00em;">
&#160;</div>
<dl>
<dt>
<b>mach32eeprom </b><i>subcommand1</i><b> [</b><i>subcommand2</i><b>...]</b></dt>
<dd>
At least one <i>subcommand</i> is needed. Valid <i>subcommands</i> are:<div style="height: 1.00em;">
&#160;</div>
</dd>
</dl>
<div style="margin-left: 5.00ex;">
<dl>
<dt>
<b>ignore</b></dt>
<dd>
Don't complain about checksum and don't use any EEPROM contents.</dd>
</dl>
<dl>
<dt>
<b>useaperture</b></dt>
<dd>
Use the configuration for the memory aperture given in the EEPROM.</dd>
</dl>
<dl>
<dt>
<b>usetimings</b></dt>
<dd>
Use video modes found in the EEPROM of the board.</dd>
</dl>
<dl>
<dt>
<b>nofile</b></dt>
<dd>
Forget about any filename that maybe was already configured. Don't read a file, don't create one.</dd>
</dl>
<dl>
<dt>
<b>file </b><i>filename</i></dt>
<dd>
New style form to specify the <i>filename</i>; On contrary to the <b>mach32eeprom </b><i>filename</i> form it can be mixed with any other mach32eeprom subcommand.</dd>
</dl>
<dl>
<dt>
<b>updatefile</b></dt>
<dd>
Don't read the file, always read the EEPROM (except when <b>ignore</b> is given) and create an uptodate image of the EEPROM.</dd>
</dl>
<dl>
<dt>
<b>keepfile</b></dt>
<dd>
Disable all previous updatefile commands.</dd>
</dl>
<dl>
<dt>
<b>compatible</b></dt>
<dd>
Fall back to default behavior: If checksum on the EEPROM data is not ok, use nothing of the configuration data. If it is ok, configure everything as specified in the EEPROM.</dd>
</dl>
</div>
<dl>
<dt>
</dt>
<dd>
The subcommands are intended to be used together and are performed in the order specified. For example:<div style="height: 1.00em;">
&#160;</div>
<b>mach32eeprom ignore useaperture usetimings</b><div style="height: 1.00em;">
&#160;</div>
will ignore the checksum of your EEPROM, but use its contents. Order is vital! So:<div style="height: 1.00em;">
&#160;</div>
<b>mach32eeprom useaperture usetimings ignore</b><div style="height: 1.00em;">
&#160;</div>
won't use any configuration from your EEPROM. Be careful with the <b>useaperture</b> subcommand. Please see the <b>EEPROM WOES</b> section. Note that any non understood <i>subcommand</i> will terminate the <b>mach32eeprom</b> command silently! Use only one <i>subcommand</i> per <b>mach32eeprom</b> command to avoid this.<div style="height: 1.00em;">
&#160;</div>
The <b>mach32eeprom</b> command is usually not allowed in the environment variable <b>SVGALIB_CONFIG</b>.<div style="height: 1.00em;">
&#160;</div>
</dd>
</dl>
</div>
<div class="section">
<h1>10. SETUP OF THE MEMORY APERTURE (LINEAR FRAMEBUFFER)</h1> Due to poor design, Xfree86 insists on setting up the aperture itself. It doesn't reset the original settings at a VC switch once it runs. You should not start X for the first time after a boot as long as an svgalib application is running. This will result in pre X values being restored at a VC switch by svgalib. If you use svgalib and XF86_Mach32 together, run X first or at least do not start it while any svgalib appl. is still running. After X was started once you can use svgalib and X in all combinations w/o any problems. Xfree uses whatever address is given in the <b>MEM_CFG</b> Mach32 register for a 4MB aperture, even if the aperture is not already enabled and the value in this register is pointless garbage. This is IMHO a dangerous bug as some systems may work only with a 1MB aperture.<div style="height: 1.00em;">
&#160;</div>
However, usage of a correct EEPROM circumvents any such problems. If you cannot use that, use <b>mach32info (6)</b> to find the address in <b>MEM_CFG.</b> Then, <b>if it is a sensible setting for your system</b>, enable a 4MB aperture at that address with <b>setuplinear</b>. Ensure that no other card or memory uses the address range you choose.<div style="height: 1.00em;">
&#160;</div>
</div>
<div class="section">
<h1>11. ACCELERATOR SUPPORT AND OTHER WEIRD FEATURES</h1> This version now has support for all accelerator functions of svgalib. However they were intended for use with the cirrus chips. It may happen that at runtime they find they cannot emulate the function actually requested. Then you should disable the corresponding blit function (at least for that application) with the blit config command.<div style="height: 1.00em;">
&#160;</div>
Data transfer between the host and the Mach32 is normally via I/O. This proved to be pretty slow. If a big enough aperture is available, a simple memory copy is used instead. This is usually much faster. You can change which method is used with the blit command. This I/O option affects only <b>vga_imageblt</b>(3). The other functions are incredible fast.<div style="height: 1.00em;">
&#160;</div>
For type 2 DACS, there is support for 8 bit per color (instead of the normal 6) in the RGB triple in the color lookup table of the 256 color modes. This can be enabled by an application, if it supports it. The <b>testaccel</b>(6) demo uses it if supported by your hardware. You can use <b>vga_ext_set</b>(3) to use it from your programs.<div style="height: 1.00em;">
&#160;</div>
</div>
<div class="section">
<h1>12. RAMDACS</h1> Mach32 Ramdacs are specified by a type in range 1 .. 5. This type can be queried from the Mach32 and then specifies how to set up the ramdac. A list of actual hardware chips used for each type exists, but is not of much use. The Mach32 will return a type and the ramdac will be completely hardware compatible to one of the given type.<div style="height: 1.00em;">
&#160;</div>
Type 1 and 4 Dacs need different clock frequencies for high colormodes. For 32K/64K colormodes the frequencies have to be doubled and for 16M colors (type 4 only) they have to be tripled. I followed the ATI scheme and did this internally. However this means that for 32K/64K you can use only clocks for which the doubled frequencies can be generated as well.<div style="height: 1.00em;">
&#160;</div>
This is no hard restriction as the 16 clocks of the Mach32 can be divided by 2. Thus if you setup some mode yourself try to use one of the divided clocks in your timings and I can use the undivided clocks internally.<div style="height: 1.00em;">
&#160;</div>
It is a real restriction for 16M colors. ATI itself only supports 25MHz (640x480) here by use of a 75MHz clock. Depending on your clock chip other values may be usable as well. Even the doubled/tripled clocks have to be less than the magic 80 MHz. However the driver does all this itself. It may just happen that some of the predefined or one of your handmade mode-timings can't be used because the clock that is used cannot be doubled/tripled. Even though there is already some tolerance in the driver you may fix that by slightly changing the clock values that you set with the <b>clocks</b> command. But note that this will as well affect the ability of the driver to calculate video timings and thus it ability to check the monitor and DAC safety restrictions.<div style="height: 1.00em;">
&#160;</div>
In addition (in complete contrast to my original ATI docs) RAMDAC 4 does not support RGB with blue byte first but only with red first. This required special handling and me adding a bunch of functions to all modules of svgalib and vgagl. The added functions are of lower performance than the usual functions. However most data has to be completely mangled, so I doubt that it can be done much faster. Sorry.<div style="height: 1.00em;">
&#160;</div>
Of course, I might have forgotten to port some parts or even confused things. About bugs in the gl and drawing libs, please ask Harm. But then, I'm able to emulate a BGR ramdac on my card, so I should even be able to reproduce your problems.<div style="height: 1.00em;">
&#160;</div>
Recently I hear often about type 6 ramdacs in non ATI Mach32 cards. There exists no info about these dacs, thus I cannot support them. The driver assumes unknown DACs can stand up to 80MHz in 256 color clut modes and does not touch the ramdac (that is, assumes it is in the 256 color mode already)<div style="height: 1.00em;">
&#160;</div>
To get rid of the warning message you can use the<div style="height: 1.00em;">
&#160;</div>
<dl>
<dt>
<b>ramdac </b><i>n</i></dt>
<dd>
configuration command. It allows to explicitly set the type of the dac to <i>n</i> (in range <b>0</b> to <b>5).</b> <b>Ramdac 3</b> is the most dumbest ramdac possible, s.t. you can use it without any fear for your hardware.</dd>
</dl>
<dl>
<dt>
<b>ramdac dumb</b></dt>
<dd>
is equivalent to <b>ramdac 3</b>.</dd>
</dl>
<dl>
<dt>
<b>ramdac auto</b></dt>
<dd>
switches back to the default autodetection.</dd>
</dl>
</div>
<div class="section">
<h1>13. MEANING OF THE DETECTION MESSAGE FROM SVGALIB</h1> Some programs (which do not switch it off) will show a<div style="height: 1.00em;">
&#160;</div>
<b>Using Mach32 </b><i>version</i><b> (</b><i>size</i><b>M at </b><i>adr</i><b>M (</b><i>how</i><b>), </b><i>mem</i><b>K mem, DAC </b><i>dactype</i><b>)</b><div style="height: 1.00em;">
&#160;</div>
line. This will show up in <b>testlinear</b>(6) etc but will probably scroll away when you use <b>vgatest</b>(6). In this line:<div style="height: 1.00em;">
&#160;</div>
<dl>
<dt>
<i>version</i></dt>
<dd>
is the version of the driver (as of my counting, not the svgalib version).</dd>
</dl>
<dl>
<dt>
<i>size</i></dt>
<dd>
is the size of the memory aperture. It can be <b>1</b> or <b>4</b> (<b>1</b> will lead to not using the linear aperture if your card has more than 1MB memory, however applications can still use the 1MB aperture and page the video memory through it in 1MB steps). <i>size</i> can also be <b>no</b> if no aperture is setup at all.</dd>
</dl>
<dl>
<dt>
<i>adr</i></dt>
<dd>
is the base address of the aperture in MB.</dd>
</dl>
<dl>
<dt>
<i>how</i></dt>
<dd>
is <b>autodetect</b> if the aperture was setup this way already when the program started. It is <b>setup</b> when the the setting was enforced with a <b>setuplinear</b> configuration command. It is <b>EEPROM</b> when no aperture was detected, but parameters to set it up were found in the EEPROM.</dd>
</dl>
<dl>
<dt>
<i>mem</i></dt>
<dd>
is the amount of memory the card reported to have.</dd>
</dl>
<dl>
<dt>
<i>dactype</i></dt>
<dd>
is the type of the DAC that was detected.<div style="height: 1.00em;">
&#160;</div>
If a special ramdac type was set with the <b>ramdac</b> command a <b>(set)</b> will be displayed after <i>dactype</i>.</dd>
</dl>
<div class="spacer">
</div>
<div style="height: 1.00em;">
&#160;</div>
If <i>mem</i>, <i>dactype</i> and/or the chipset were enforced with <b>chipset from the configuration file</b> or <b>vga_setchipsetandfeatures</b>(3) a <b>forced</b> will be appended to the line.<div style="height: 1.00em;">
&#160;</div>
</div>
<div class="section">
<h1>14. CONCLUSIONS</h1> A final word: I have an ATI ULTRA PRO/2MB/EISA with a Type 2 DAC. My monitor is an EIZO F550i-M. Everything I tried works on it like a charm. However, I couldn't try it with other machines myself and esp. other DAC's. Fortunately the Type 2 DAC is the worst to code. So I will probably have gotten the other DAC's right. But please be warned!<div style="height: 1.00em;">
&#160;</div>
I did my very best to code the driver to support the other DAC's by just reading the docs. <b>But i can't give any definitive guarantee for</b> <b>it to work or even not damaging your hardware. So please be careful!</b><div style="height: 1.00em;">
&#160;</div>
Note that you will have to set the environment variable <b>SVGALIB_MACH32</b> to <b>ILLTRYIT</b> if your DAC is not type 0, 2, 3 or 4. This will of course change if no one with a DAC equal to 1 or 5 has serious problems. If you have a different DAC, making patches to support your card will be much more helpful instead of just complaining. If you have a different DAC that works well tell me as well such that I can remove the need for SVGALIB_MACH32 in the next release. Still, even now, after years, I got no reports of a Mach32 card with a type 1 or 5 ramdac. Go figure.<div style="height: 1.00em;">
&#160;</div>
Thank you for your audience and wishes you will enjoy this driver,<div style="height: 0.00em;">
&#160;</div>
Michael.</div>
<div class="section">
<h1>FILES</h1> <i>/etc/vga/libvga.config</i><div style="height: 0.00em;">
&#160;</div>
<i>/etc/vga/mach32.eeprom</i><div style="height: 1.00em;">
&#160;</div>
</div>
<div class="section">
<h1>SEE ALSO</h1> <b>svgalib</b>(7), <b>libvga.config</b>(5), <b>mach32info</b>(6).<div style="height: 1.00em;">
&#160;</div>
</div>
<div class="section">
<h1>AUTHOR</h1> The Mach32 driver and this documentation was written by Michael Weller &lt;eowmob@exp-math.uni-essen.de&gt;.</div>
<table class="foot">
<tr>
<td class="foot-date">
1 August 1997</td>
<td class="foot-os">
Svgalib (&gt;= 1.2.11)</td>
</tr>
</table>
</div>
</body>
</html>

