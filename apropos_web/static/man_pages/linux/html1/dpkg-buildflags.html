<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/linux/style.css" type="text/css" media="all"/>
<title>
dpkg-buildflags(1)</title>
</head>
<body>
<div class="mandoc">
<table class="head">
<tbody>
<tr>
<td class="head-ltitle">
dpkg-buildflags(1)</td>
<td class="head-vol">
dpkg suite</td>
<td class="head-rtitle">
dpkg-buildflags(1)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1>NAME</h1> dpkg-buildflags - returns build flags to use during package build</div>
<div class="section">
<h1>SYNOPSIS</h1> <b>dpkg-buildflags</b> [<i>option</i>...] [<i>command</i>]</div>
<div class="section">
<h1>DESCRIPTION</h1>  <b>dpkg-buildflags</b> is a tool to retrieve compilation flags to use during build of Debian packages. The default flags are defined by the vendor but they can be extended/overriden in several ways:<dl>
<dt>
1.</dt>
<dd>
system-wide with <b>/etc/dpkg/buildflags.conf</b>;</dd>
</dl>
<dl>
<dt>
2.</dt>
<dd>
for the current user with <b>$XDG_CONFIG_HOME/dpkg/buildflags.conf</b> where  <b>$XDG_CONFIG_HOME</b> defaults to <b>$HOME/.config</b>;</dd>
</dl>
<dl>
<dt>
3.</dt>
<dd>
temporarily by the user with environment variables (see section  <b>ENVIRONMENT</b>);</dd>
</dl>
<dl>
<dt>
4.</dt>
<dd>
dynamically by the package maintainer with environment variables set via  <b>debian/rules</b> (see section <b>ENVIRONMENT</b>).</dd>
</dl>
<div class="spacer">
</div>
The configuration files can contain two types of directives:<dl>
<dt>
<b>SET</b><i> flag value</i></dt>
<dd>
Override the flag named <i>flag</i> to have the value <i>value</i>.</dd>
</dl>
<dl>
<dt>
<b>STRIP</b><i> flag value</i></dt>
<dd>
Strip from the flag named <i>flag</i> all the build flags listed in <i>value</i>.</dd>
</dl>
<dl>
<dt>
<b>APPEND</b><i> flag value</i></dt>
<dd>
Extend the flag named <i>flag</i> by appending the options given in <i>value</i>. A space is prepended to the appended value if the flag's current value is non-empty.</dd>
</dl>
<dl>
<dt>
<b>PREPEND</b><i> flag value</i></dt>
<dd>
Extend the flag named <i>flag</i> by prepending the options given in <i>value</i>. A space is appended to the prepended value if the flag's current value is non-empty.</dd>
</dl>
<div class="spacer">
</div>
The configuration files can contain comments on lines starting with a hash (#). Empty lines are also ignored.</div>
<div class="section">
<h1>COMMANDS</h1><dl>
<dt>
<b>--dump</b></dt>
<dd>
Print to standard output all compilation flags and their values. It prints one flag per line separated from its value by an equal sign (&quot; <i>flag</i>=<i>value</i>&quot;). This is the default action.</dd>
</dl>
<dl>
<dt>
<b>--list</b></dt>
<dd>
Print the list of flags supported by the current vendor (one per line). See the  <b>SUPPORTED FLAGS</b> section for more information about them.</dd>
</dl>
<dl>
<dt>
<b>--export=</b><i>format</i></dt>
<dd>
Print to standard output shell (if <i>format</i> is <b>sh</b>) or make (if  <i>format</i> is <b>make</b>) commands that can be used to export all the compilation flags in the environment. If  <i>format</i> is  <b>configure</b> then the output can be used on a <b>./configure</b> command-line. If the  <i>format</i> value is not given,  <b>sh</b> is assumed. Only compilation flags starting with an upper case character are included, others are assumed to not be suitable for the environment.</dd>
</dl>
<dl>
<dt>
<b>--get</b><i> flag</i></dt>
<dd>
Print the value of the flag on standard output. Exits with 0 if the flag is known otherwise exits with 1.</dd>
</dl>
<dl>
<dt>
<b>--origin</b><i> flag</i></dt>
<dd>
Print the origin of the value that is returned by <b>--get</b>. Exits with 0 if the flag is known otherwise exits with 1. The origin can be one of the following values:</dd>
</dl>
<div style="margin-left: 5.00ex;">
<dl>
<dt>
<b>vendor</b></dt>
<dd>
the original flag set by the vendor is returned;</dd>
</dl>
<dl>
<dt>
<b>system</b></dt>
<dd>
the flag is set/modified by a system-wide configuration;</dd>
</dl>
<dl>
<dt>
<b>user</b></dt>
<dd>
the flag is set/modified by a user-specific configuration;</dd>
</dl>
<dl>
<dt>
<b>env</b></dt>
<dd>
the flag is set/modified by an environment-specific configuration.</dd>
</dl>
</div>
<dl>
<dt>
<b>--help</b></dt>
<dd>
Show the usage message and exit.</dd>
</dl>
<dl>
<dt>
<b>--version</b></dt>
<dd>
Show the version and exit.</dd>
</dl>
</div>
<div class="section">
<h1>SUPPORTED FLAGS</h1><dl>
<dt>
<b>CFLAGS</b></dt>
<dd>
Options for the C compiler. The default value set by the vendor includes  <i>-g</i> and the default optimization level (<i>-O2</i> usually, or  <i>-O0</i> if the <b>DEB_BUILD_OPTIONS</b> environment variable defines  <i>noopt</i>).</dd>
</dl>
<dl>
<dt>
<b>CPPFLAGS</b></dt>
<dd>
Options for the C preprocessor. Default value: empty.</dd>
</dl>
<dl>
<dt>
<b>CXXFLAGS</b></dt>
<dd>
Options for the C++ compiler. Same as <b>CFLAGS</b>.</dd>
</dl>
<dl>
<dt>
<b>FFLAGS</b></dt>
<dd>
Options for the Fortran compiler. Same as <b>CFLAGS</b>.</dd>
</dl>
<dl>
<dt>
<b>LDFLAGS</b></dt>
<dd>
Options passed to the compiler when linking executables or shared objects (if the linker is called directly, then <b>-Wl</b> and <b>,</b> have to be stripped from these options). Default value: empty.</dd>
</dl>
</div>
<div class="section">
<h1>FILES</h1><dl>
<dt>
<b>/etc/dpkg/buildflags.conf</b></dt>
<dd>
System wide configuration file.</dd>
</dl>
<dl>
<dt>
<b>$XDG_CONFIG_HOME/dpkg/buildflags.conf</b> or <b>$HOME/.config/dpkg/buildflags.conf</b></dt>
<dd>
User configuration file.</dd>
</dl>
</div>
<div class="section">
<h1>ENVIRONMENT</h1> There are 2 sets of environment variables doing the same operations, the first one (DEB_ <i>flag</i>_<i>op</i>) should never be used within  <b>debian/rules</b>. It's meant for any user that wants to rebuild the source package with different build flags. The second set (DEB_ <i>flag</i>_MAINT_<i>op</i>) should only be used in <b>debian/rules</b> by package maintainers to change the resulting build flags.<dl>
<dt>
<b>DEB_</b><i>flag</i><b>_SET</b></dt>
<dd>
<b>DEB_</b><i>flag</i><b>_MAINT_SET</b> This variable can be used to force the value returned for the given  <i>flag</i>.</dd>
</dl>
<dl>
<dt>
<b>DEB_</b><i>flag</i><b>_STRIP</b></dt>
<dd>
<b>DEB_</b><i>flag</i><b>_MAINT_STRIP</b> This variable can be used to provide a space separated list of options that will be stripped from the set of flags returned for the given  <i>flag</i>.</dd>
</dl>
<dl>
<dt>
<b>DEB_</b><i>flag</i><b>_APPEND</b></dt>
<dd>
<b>DEB_</b><i>flag</i><b>_MAINT_APPEND</b> This variable can be used to append supplementary options to the value returned for the given  <i>flag</i>.</dd>
</dl>
<dl>
<dt>
<b>DEB_</b><i>flag</i><b>_PREPEND</b></dt>
<dd>
<b>DEB_</b><i>flag</i><b>_MAINT_PREPEND</b> This variable can be used to prepend supplementary options to the value returned for the given  <i>flag</i>.</dd>
</dl>
<dl>
<dt>
<b>DEB_BUILD_MAINT_OPTIONS</b></dt>
<dd>
This variable can be used to disable/enable various hardening build flags through the  <b>hardening</b> option. See the <b>HARDENING</b> section for details.</dd>
</dl>
</div>
<div class="section">
<h1>HARDENING</h1> Several compile-time options (detailed below) can be used to help harden a resulting binary against memory corruption attacks, or provide additional warning messages during compilation. Except as noted below, these are enabled by default for architectures that support them.<div class="spacer">
</div>
Each hardening feature can be enabled and disabled in the  <b>DEB_BUILD_MAINT_OPTIONS</b> environment variable's <b>hardening</b> value with the &quot;+&quot; and &quot;-&quot; modifier. For example, to enable the &quot;pie&quot; feature and disable the &quot;fortify&quot; feature you can do this in  <b>debian/rules</b>:<div class="spacer">
</div>
<br/>
  export DEB_BUILD_MAINT_OPTIONS=hardening=+pie,-fortify<div class="spacer">
</div>
The special feature <b>all</b> can be used to enable or disable all hardening features at the same time. Thus disabling everything and enabling only &quot;format&quot; and &quot;fortify&quot; can be achieved with:<div class="spacer">
</div>
<br/>
  export DEB_BUILD_MAINT_OPTIONS=hardening=-all,+format,+fortify<dl>
<dt>
<b>format</b></dt>
<dd>
This setting (enabled by default) adds <b>-Wformat -Wformat-security -Werror=format-security</b> to  <b>CFLAGS</b> and <b>CXXFLAGS</b>. This will warn about improper format string uses, and will fail when format functions are used in a way that that represent possible security problems. At present, this warns about calls to  <b>printf</b> and <b>scanf</b> functions where the format string is not a string literal and there are no format arguments, as in  <b>printf(foo);</b> instead of <b>printf(&quot;%s&quot;, foo);</b> This may be a security hole if the format string came from untrusted input and contains &quot;%n&quot;.</dd>
</dl>
<dl>
<dt>
<b>fortify</b></dt>
<dd>
This setting (enabled by default) adds <b>-D_FORTIFY_SOURCE=2</b> to  <b>CPPFLAGS</b>. During code generation the compiler knows a great deal of information about buffer sizes (where possible), and attempts to replace insecure unlimited length buffer function calls with length-limited ones. This is especially useful for old, crufty code. Additionally, format strings in writable memory that contain '%n' are blocked. If an application depends on such a format string, it will need to be worked around.<div style="height: 1.00em;">
&#160;</div>
Note that for this option to have any effect, the source must also be compiled with  <b>-O1</b> or higher.</dd>
</dl>
<dl>
<dt>
<b>stackprotector</b></dt>
<dd>
This setting (enabled by default) adds <b>-fstack-protector --param=ssp-buffer-size=4</b> to  <b>CFLAGS</b> and <b>CXXFLAGS</b>. This adds safety checks against stack overwrites. This renders many potential code injection attacks into aborting situations. In the best case this turns code injection vulnerabilities into denial of service or into non-issues (depending on the application).<div style="height: 1.00em;">
&#160;</div>
This feature requires linking against glibc (or another provider of  <b>__stack_chk_fail</b>), so needs to be disabled when building with  <b>-nostdlib</b> or <b>-ffreestanding</b> or similar.</dd>
</dl>
<dl>
<dt>
<b>relro</b></dt>
<dd>
This setting (enabled by default) adds <b>-Wl,-z,relro</b> to  <b>LDFLAGS</b>.  During program load, several ELF memory sections need to be written to by the linker. This flags the loader to turn these sections read-only before turning over control to the program. Most notably this prevents GOT overwrite attacks.</dd>
</dl>
<dl>
<dt>
<b>bindnow</b></dt>
<dd>
This setting (disabled by default) adds <b>-Wl,-z,now</b> to  <b>LDFLAGS</b>. During program load, all dynamic symbols are resolved, allowing for the entire PLT to be marked read-only (due to  <b>relro</b> above).</dd>
</dl>
<dl>
<dt>
<b>pie</b></dt>
<dd>
This setting (disabled by default) adds <b>-fPIE</b> to <b>CFLAGS</b> and  <b>CXXFLAGS</b>, and <b>-fPIE -pie</b> to <b>LDFLAGS</b>. Position Independent Executable are needed to take advantage of Address Space Layout Randomization, supported by some kernel versions. While ASLR can already be enforced for data areas in the stack and heap (brk and mmap), the code areas must be compiled as position-independent. Shared libraries already do this (-fPIC), so they gain ASLR automatically, but binary .text regions need to be build PIE to gain ASLR. When this happens, ROP (Return Oriented Programming) attacks are much harder since there are no static locations to bounce off of during a memory corruption attack.<div style="height: 1.00em;">
&#160;</div>
This is not compatible with <b>-fPIC</b> so care must be taken when building shared objects.<div style="height: 1.00em;">
&#160;</div>
Additionally, since PIE is implemented via a general register, some architectures (most notably i386) can see performance losses of up to 15% in very text-segment-heavy application workloads; most workloads see less than 1%. Architectures with more general registers (e.g. amd64) do not see as high a worst-case penalty.</dd>
</dl>
</div>
<div class="section">
<h1>AUTHOR</h1> Copyright &#169; 2010-2011 Rapha&#235;l Hertzog<div style="height: 1.00em;">
&#160;</div>
Copyright &#169; 2011 Kees Cook<div style="height: 1.00em;">
&#160;</div>
This is free software; see the GNU General Public Licence version 2 or later for copying conditions. There is NO WARRANTY.<div style="height: 1.00em;">
&#160;</div>
</div>
<table class="foot">
<tr>
<td class="foot-date">
2011-09-13</td>
<td class="foot-os">
Debian Project</td>
</tr>
</table>
</div>
</body>
</html>

