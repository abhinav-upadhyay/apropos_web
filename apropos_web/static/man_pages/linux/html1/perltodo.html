<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/linux/style.css" type="text/css" media="all"/>
<title>
PERLTODO(1)</title>
</head>
<body>
<div class="mandoc">
<table class="head">
<tbody>
<tr>
<td class="head-ltitle">
PERLTODO(1)</td>
<td class="head-vol">
Perl Programmers Reference Guide</td>
<td class="head-rtitle">
PERLTODO(1)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1>NAME</h1> perltodo - Perl TO-DO List</div>
<div class="section">
<h1>DESCRIPTION</h1> This is a list of wishes for Perl. The most up to date version of this file is at &lt;http://perl5.git.perl.org/perl.git/blob_plain/HEAD:/pod/perltodo.pod&gt;<div class="spacer">
</div>
The tasks we think are smaller or easier are listed first. Anyone is welcome to work on any of these, but it's a good idea to first contact  <i>perl5-porters@perl.org</i> to avoid duplication of effort, and to learn from any previous attempts. By all means contact a pumpking privately first if you prefer.<div class="spacer">
</div>
Whilst patches to make the list shorter are most welcome, ideas to add to the list are also encouraged. Check the perl5-porters archives for past ideas, and any discussion about them. One set of archives may be found at http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/ &lt;http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/&gt;<div class="spacer">
</div>
What can we offer you in return? Fame, fortune, and everlasting glory? Maybe not, but if your patch is incorporated, then we'll add your name to the  <i>AUTHORS</i> file, which ships in the official distribution. How many other programming languages offer you 1 line of immortality?</div>
<div class="section">
<h1>Tasks that only need Perl knowledge</h1><div class="subsection">
<h2>Migrate t/ from custom TAP generation</h2> Many tests below  <i>t/</i> still generate TAP by &quot;hand&quot;, rather than using library functions. As explained in &quot;TESTING&quot; in perlhack, tests in  <i>t/</i> are written in a particular way to test that more complex constructions actually work before using them routinely. Hence they don't use &quot;Test::More&quot;, but instead there is an intentionally simpler library,  <i>t/test.pl</i>. However, quite a few tests in  <i>t/</i> have not been refactored to use it. Refactoring any of these tests, one at a time, is a useful thing TODO.<div class="spacer">
</div>
The subdirectories <i>base</i>, <i>cmd</i> and <i>comp</i>, that contain the most basic tests, should be excluded from this task.</div>
<div class="subsection">
<h2>Automate perldelta generation</h2> The perldelta file accompanying each release summaries the major changes. It's mostly manually generated currently, but some of that could be automated with a bit of perl, specifically the generation of<dl>
<dt>
Modules and Pragmata</dt>
<dd>
</dd>
</dl>
<dl>
<dt>
New Documentation</dt>
<dd>
</dd>
</dl>
<dl>
<dt>
New Tests</dt>
<dd>
</dd>
</dl>
<div class="spacer">
</div>
See <i>Porting/how_to_write_a_perldelta.pod</i> for details.</div>
<div class="subsection">
<h2>Remove duplication of test setup.</h2> Schwern notes, that there's duplication of code - lots and lots of tests have some variation on the big block of $Is_Foo checks.  We can safely put this into a file, change it to build an %Is hash and require it.  Maybe just put it into  <i>test.pl</i>. Throw in the handy tainting subroutines.</div>
<div class="subsection">
<h2>POD -&gt; HTML conversion in the core still sucks</h2> Which is crazy given just how simple POD purports to be, and how simple HTML can be. It's not actually  <i>as</i> simple as it sounds, particularly with the flexibility POD allows for &quot;=item&quot;, but it would be good to improve the visual appeal of the HTML generated, and to avoid it having any validation errors. See also &quot;make HTML install work&quot;, as the layout of installation tree is needed to improve the cross-linking.<div class="spacer">
</div>
The addition of &quot;Pod::Simple&quot; and its related modules may make this task easier to complete.</div>
<div class="subsection">
<h2>Make ExtUtils::ParseXS use strict;</h2>  <i>lib/ExtUtils/ParseXS.pm</i> contains this line<div class="spacer">
</div>
<br/>
    # use strict;  # One of these days...<br/>
<div class="spacer">
</div>
Simply uncomment it, and fix all the resulting issues :-)<div class="spacer">
</div>
The more practical approach, to break the task down into manageable chunks, is to work your way though the code from bottom to top, or if necessary adding extra &quot;{ ... }&quot; blocks, and turning on strict within them.</div>
<div class="subsection">
<h2>Make Schwern poorer</h2> We should have tests for everything. When all the core's modules are tested, Schwern has promised to donate to $500 to TPF. We may need volunteers to hold him upside down and shake vigorously in order to actually extract the cash.</div>
<div class="subsection">
<h2>Improve the coverage of the core tests</h2> Use Devel::Cover to ascertain the core modules' test coverage, then add tests that are currently missing.</div>
<div class="subsection">
<h2>test B</h2> A full test suite for the B module would be nice.</div>
<div class="subsection">
<h2>A decent benchmark</h2> &quot;perlbench&quot; seems impervious to any recent changes made to the perl core. It would be useful to have a reasonable general benchmarking suite that roughly represented what current perl programs do, and measurably reported whether tweaks to the core improve, degrade or don't really affect performance, to guide people attempting to optimise the guts of perl. Gisle would welcome new tests for perlbench.</div>
<div class="subsection">
<h2>fix tainting bugs</h2> Fix the bugs revealed by running the test suite with the &quot;-t&quot; switch (via &quot;make test.taintwarn&quot;).</div>
<div class="subsection">
<h2>Dual life everything</h2> As part of the &quot;dists&quot; plan, anything that doesn't belong in the smallest perl distribution needs to be dual lifed. Anything else can be too. Figure out what changes would be needed to package that module and its tests up for CPAN, and do so. Test it with older perl releases, and fix the problems you find.<div class="spacer">
</div>
To make a minimal perl distribution, it's useful to look at  <i>t/lib/commonsense.t</i>.</div>
<div class="subsection">
<h2>POSIX memory footprint</h2> Ilya observed that use POSIX; eats memory like there's no tomorrow, and at various times worked to cut it down. There is probably still fat to cut out - for example POSIX passes Exporter some very memory hungry data structures.</div>
<div class="subsection">
<h2>embed.pl/makedef.pl</h2> There is a script  <i>embed.pl</i> that generates several header files to prefix all of Perl's symbols in a consistent way, to provide some semblance of namespace support in &quot;C&quot;. Functions are declared in  <i>embed.fnc</i>, variables in  <i>interpvar.h</i>. Quite a few of the functions and variables are conditionally declared there, using &quot;#ifdef&quot;. However,  <i>embed.pl</i> doesn't understand the C macros, so the rules about which symbols are present when is duplicated in  <i>makedef.pl</i>. Writing things twice is bad, m'kay. It would be good to teach &quot;embed.pl&quot; to understand the conditional compilation, and hence remove the duplication, and the mistakes it has caused.</div>
<div class="subsection">
<h2>use strict; and AutoLoad</h2> Currently if you write<div class="spacer">
</div>
<br/>
    package Whack;<br/>
    use AutoLoader 'AUTOLOAD';<br/>
    use strict;<br/>
    1;<br/>
    __END__<br/>
    sub bloop {<br/>
        print join (' ', No, strict, here), &quot;!\n&quot;;<br/>
    }<br/>
<div class="spacer">
</div>
then &quot;use strict;&quot; isn't in force within the autoloaded subroutines. It would be more consistent (and less surprising) to arrange for all lexical pragmas in force at the __END__ block to be in force within each autoloaded subroutine.<div class="spacer">
</div>
There's a similar problem with SelfLoader.</div>
<div class="subsection">
<h2>profile installman</h2> The  <i>installman</i> script is slow. All it is doing text processing, which we're told is something Perl is good at. So it would be nice to know what it is doing that is taking so much CPU, and where possible address it.</div>
<div class="subsection">
<h2>enable lexical enabling/disabling of individual warnings</h2> Currently, warnings can only be enabled or disabled by category. There are times when it would be useful to quash a single warning, not a whole category.</div>
</div>
<div class="section">
<h1>Tasks that need a little sysadmin-type knowledge</h1> Or if you prefer, tasks that you would learn from, and broaden your skills base...<div class="subsection">
<h2>make HTML install work</h2> There is an &quot;installhtml&quot; target in the Makefile. It's marked as &quot;experimental&quot;. It would be good to get this tested, make it work reliably, and remove the &quot;experimental&quot; tag. This would include<dl>
<dt>
1.</dt>
<dd>
Checking that cross linking between various parts of the documentation works. In particular that links work between the modules (files with POD in  <i>lib/</i>) and the core documentation (files in  <i>pod/</i>)</dd>
</dl>
<dl>
<dt>
2.</dt>
<dd>
Work out how to split &quot;perlfunc&quot; into chunks, preferably one per function group, preferably with general case code that could be used elsewhere. Challenges here are correctly identifying the groups of functions that go together, and making the right named external cross-links point to the right page. Things to be aware of are &quot;-X&quot;, groups such as &quot;getpwnam&quot; to &quot;endservent&quot;, two or more &quot;=items&quot; giving the different parameter lists, such as<div style="height: 1.00em;">
&#160;</div>
<br/>
    =item substr EXPR,OFFSET,LENGTH,REPLACEMENT<br/>
    =item substr EXPR,OFFSET,LENGTH<br/>
    =item substr EXPR,OFFSET<br/>
<div style="height: 1.00em;">
&#160;</div>
and different parameter lists having different meanings. (eg &quot;select&quot;)</dd>
</dl>
</div>
<div class="subsection">
<h2>compressed man pages</h2> Be able to install them. This would probably need a configure test to see how the system does compressed man pages (same directory/different directory? same filename/different filename), as well as tweaking the  <i>installman</i> script to compress as necessary.</div>
<div class="subsection">
<h2>Add a code coverage target to the Makefile</h2> Make it easy for anyone to run Devel::Cover on the core's tests. The steps to do this manually are roughly<dl>
<dt>
&#8226;</dt>
<dd>
do a normal &quot;Configure&quot;, but include Devel::Cover as a module to install (see INSTALL for how to do this)</dd>
</dl>
<dl>
<dt>
&#8226;</dt>
<dd>
<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<br/>
    make perl<br/>
</dd>
</dl>
<dl>
<dt>
&#8226;</dt>
<dd>
<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<br/>
    cd t; HARNESS_PERL_SWITCHES=-MDevel::Cover ./perl -I../lib harness<br/>
</dd>
</dl>
<dl>
<dt>
&#8226;</dt>
<dd>
Process the resulting Devel::Cover database</dd>
</dl>
<div class="spacer">
</div>
This just give you the coverage of the <i>.pm</i>s. To also get the C level coverage you need to<dl>
<dt>
&#8226;</dt>
<dd>
Additionally tell &quot;Configure&quot; to use the appropriate C compiler flags for &quot;gcov&quot;</dd>
</dl>
<dl>
<dt>
&#8226;</dt>
<dd>
<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<br/>
    make perl.gcov<br/>
<div style="height: 1.00em;">
&#160;</div>
(instead of &quot;make perl&quot;)</dd>
</dl>
<dl>
<dt>
&#8226;</dt>
<dd>
After running the tests run &quot;gcov&quot; to generate all the <i>.gcov</i> files. (Including down in the subdirectories of  <i>ext/</i></dd>
</dl>
<dl>
<dt>
&#8226;</dt>
<dd>
(From the top level perl directory) run &quot;gcov2perl&quot; on all the &quot;.gcov&quot; files to get their stats into the cover_db directory.</dd>
</dl>
<dl>
<dt>
&#8226;</dt>
<dd>
Then process the Devel::Cover database</dd>
</dl>
<div class="spacer">
</div>
It would be good to add a single switch to &quot;Configure&quot; to specify that you wanted to perform perl level coverage, and another to specify C level coverage, and have &quot;Configure&quot; and the  <i>Makefile</i> do all the right things automatically.</div>
<div class="subsection">
<h2>Make Config.pm cope with differences between built and installed perl</h2> Quite often vendors ship a perl binary compiled with their (pay-for) compilers.  People install a free compiler, such as gcc. To work out how to build extensions, Perl interrogates %Config, so in this situation %Config describes compilers that aren't there, and extension building fails. This forces people into choosing between re-compiling perl themselves using the compiler they have, or only using modules that the vendor ships.<div class="spacer">
</div>
It would be good to find a way teach &quot;Config.pm&quot; about the installation setup, possibly involving probing at install time or later, so that the %Config in a binary distribution better describes the installed machine, when the installed machine differs from the build machine in some significant way.</div>
<div class="subsection">
<h2>linker specification files</h2> Some platforms mandate that you provide a list of a shared library's external symbols to the linker, so the core already has the infrastructure in place to do this for generating shared perl libraries. My understanding is that the GNU toolchain can accept an optional linker specification file, and restrict visibility just to symbols declared in that file. It would be good to extend  <i>makedef.pl</i> to support this format, and to provide a means within &quot;Configure&quot; to enable it. This would allow Unix users to test that the export list is correct, and to build a perl that does not pollute the global namespace with private symbols, and will fail in the same way as msvc or mingw builds or when using PERL_DL_NONLAZY=1.</div>
<div class="subsection">
<h2>Cross-compile support</h2> Currently &quot;Configure&quot; understands &quot;-Dusecrosscompile&quot; option. This option arranges for building &quot;miniperl&quot; for TARGET machine, so this &quot;miniperl&quot; is assumed then to be copied to TARGET machine and used as a replacement of full &quot;perl&quot; executable.<div class="spacer">
</div>
This could be done little differently. Namely &quot;miniperl&quot; should be built for HOST and then full &quot;perl&quot; with extensions should be compiled for TARGET. This, however, might require extra trickery for %Config: we have one config first for HOST and then another for TARGET.  Tools like MakeMaker will be mightily confused.  Having around two different types of executables and libraries (HOST and TARGET) makes life interesting for Makefiles and shell (and Perl) scripts.  There is $Config{run}, normally empty, which can be used as an execution wrapper.  Also note that in some cross-compilation/execution environments the HOST and the TARGET do not see the same filesystem(s), the $Config{run} may need to do some file/directory copying back and forth.</div>
<div class="subsection">
<h2>roffitall</h2> Make  <i>pod/roffitall</i> be updated by <i>pod/buildtoc</i>.</div>
<div class="subsection">
<h2>Split &quot;linker&quot; from &quot;compiler&quot;</h2> Right now, Configure probes for two commands, and sets two variables:<dl>
<dt>
&#8226;</dt>
<dd>
&quot;cc&quot; (in <i>cc.U</i>)<div style="height: 1.00em;">
&#160;</div>
This variable holds the name of a command to execute a C compiler which can resolve multiple global references that happen to have the same name.  Usual values are  <i>cc</i> and <i>gcc</i>. Fervent ANSI compilers may be called  <i>c89</i>.  AIX has <i>xlc</i>.</dd>
</dl>
<dl>
<dt>
&#8226;</dt>
<dd>
&quot;ld&quot; (in <i>dlsrc.U</i>)<div style="height: 1.00em;">
&#160;</div>
This variable indicates the program to be used to link libraries for dynamic loading.  On some systems, it is  <i>ld</i>. On ELF systems, it should be $cc.  Mostly, we'll try to respect the hint file setting.</dd>
</dl>
<div class="spacer">
</div>
There is an implicit historical assumption from around Perl5.000alpha something, that $cc is also the correct command for linking object files together to make an executable. This may be true on Unix, but it's not true on other platforms, and there are a maze of work arounds in other places (such as  <i>Makefile.SH</i>) to cope with this.<div class="spacer">
</div>
Ideally, we should create a new variable to hold the name of the executable linker program, probe for it in  <i>Configure</i>, and centralise all the special case logic there or in hints files.<div class="spacer">
</div>
A small bikeshed issue remains - what to call it, given that $ld is already taken (arguably for the wrong thing now, but on SunOS 4.1 it is the command for creating dynamically-loadable modules) and $link could be confused with the Unix command line executable of the same name, which does something completely different. Andy Dougherty makes the counter argument &quot;In parrot, I tried to call the command used to link object files and  libraries into an executable  <i>link</i>, since that's what my vaguely-remembered DOS and VMS experience suggested. I don't think any real confusion has ensued, so it's probably a reasonable name for perl5 to use.&quot;<div class="spacer">
</div>
&quot;Alas, I've always worried that introducing it would make things worse, since now the module building utilities would have to look for $Config{link} and institute a fall-back plan if it weren't found.&quot; Although I can see that as confusing, given that $Config{d_link} is true when (hard) links are available.</div>
<div class="subsection">
<h2>Configure Windows using PowerShell</h2> Currently, Windows uses hard-coded config files based to build the config.h for compiling Perl.  Makefiles are also hard-coded and need to be hand edited prior to building Perl. While this makes it easy to create a perl.exe that works across multiple Windows versions, being able to accurately configure a perl.exe for a specific Windows versions and VS C++ would be a nice enhancement.  With PowerShell available on Windows XP and up, this may now be possible.  Step 1 might be to investigate whether this is possible and use this to clean up our current makefile situation.  Step 2 would be to see if there would be a way to use our existing metaconfig units to configure a Windows Perl or whether we go in a separate direction and make it so.  Of course, we all know what step 3 is.</div>
<div class="subsection">
<h2>decouple -g and -DDEBUGGING</h2> Currently  <i>Configure</i> automatically adds &quot;-DDEBUGGING&quot; to the C compiler flags if it spots &quot;-g&quot; in the optimiser flags. The pre-processor directive &quot;DEBUGGING&quot; enables  <i>perl</i>'s command line &quot;-D&quot; options, but in the process makes  <i>perl</i> slower. It would be good to disentangle this logic, so that C-level debugging with &quot;-g&quot; and Perl level debugging with &quot;-D&quot; can easily be enabled independently.</div>
</div>
<div class="section">
<h1>Tasks that need a little C knowledge</h1> These tasks would need a little C knowledge, but don't need any specific background or experience with XS, or how the Perl interpreter works<div class="subsection">
<h2>Weed out needless PERL_UNUSED_ARG</h2> The C code uses the macro &quot;PERL_UNUSED_ARG&quot; to stop compilers warning about unused arguments. Often the arguments can't be removed, as there is an external constraint that determines the prototype of the function, so this approach is valid. However, there are some cases where &quot;PERL_UNUSED_ARG&quot; could be removed. Specifically<dl>
<dt>
&#8226;</dt>
<dd>
The prototypes of (nearly all) static functions can be changed</dd>
</dl>
<dl>
<dt>
&#8226;</dt>
<dd>
Unused arguments generated by short cut macros are wasteful - the short cut macro used can be changed.</dd>
</dl>
</div>
<div class="subsection">
<h2>Modernize the order of directories in @INC</h2> The way @INC is laid out by default, one cannot upgrade core (dual-life) modules without overwriting files. This causes problems for binary package builders.  One possible proposal is laid out in this message: http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2002-04/msg02380.html &lt;http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2002-04/msg02380.html&gt;</div>
<div class="subsection">
<h2>-Duse32bit*</h2> Natively 64-bit systems need neither -Duse64bitint nor -Duse64bitall. On these systems, it might be the default compilation mode, and there is currently no guarantee that passing no use64bitall option to the Configure process will build a 32bit perl. Implementing -Duse32bit* options would be nice for perl 5.14.</div>
<div class="subsection">
<h2>Profile Perl - am I hot or not?</h2> The Perl source code is stable enough that it makes sense to profile it, identify and optimise the hotspots. It would be good to measure the performance of the Perl interpreter using free tools such as cachegrind, gprof, and dtrace, and work to reduce the bottlenecks they reveal.<div class="spacer">
</div>
As part of this, the idea of <i>pp_hot.c</i> is that it contains the <i>hot</i> ops, the ops that are most commonly used. The idea is that by grouping them, their object code will be adjacent in the executable, so they have a greater chance of already being in the CPU cache (or swapped in) due to being near another op already in use.<div class="spacer">
</div>
Except that it's not clear if these really are the most commonly used ops. So as part of exercising your skills with coverage and profiling tools you might want to determine what ops  <i>really</i> are the most commonly used. And in turn suggest evictions and promotions to achieve a better  <i>pp_hot.c</i>.<div class="spacer">
</div>
One piece of Perl code that might make a good testbed is <i>installman</i>.</div>
<div class="subsection">
<h2>Allocate OPs from arenas</h2> Currently all new OP structures are individually  <i>malloc()</i>ed and <i>free()</i>d. All &quot;malloc&quot; implementations have space overheads, and are now as fast as custom allocates so it would both use less memory and less CPU to allocate the various OP structures from arenas. The SV arena code can probably be re-used for this.<div class="spacer">
</div>
Note that Configuring perl with &quot;-Accflags=-DPL_OP_SLAB_ALLOC&quot; will use  <i>Perl_Slab_alloc()</i> to pack optrees into a contiguous block, which is probably superior to the use of OP arenas, esp. from a cache locality standpoint.  See &quot;Profile Perl - am I hot or not?&quot;.</div>
<div class="subsection">
<h2>Improve win32/wince.c</h2> Currently, numerous functions look virtually, if not completely, identical in both &quot;win32/wince.c&quot; and &quot;win32/win32.c&quot; files, which can't be good.</div>
<div class="subsection">
<h2>Use secure CRT functions when building with VC8 on Win32</h2> Visual C++ 2005 (VC++ 8.x) deprecated a number of CRT functions on the basis that they were &quot;unsafe&quot; and introduced differently named secure versions of them as replacements, e.g. instead of writing<div class="spacer">
</div>
<br/>
    FILE* f = fopen(__FILE__, &quot;r&quot;);<br/>
<div class="spacer">
</div>
one should now write<div class="spacer">
</div>
<br/>
    FILE* f;<br/>
    errno_t err = fopen_s(&amp;f, __FILE__, &quot;r&quot;);<br/>
<div class="spacer">
</div>
Currently, the warnings about these deprecations have been disabled by adding -D_CRT_SECURE_NO_DEPRECATE to the CFLAGS. It would be nice to remove that warning suppressant and actually make use of the new secure CRT functions.<div class="spacer">
</div>
There is also a similar issue with POSIX CRT function names like fileno having been deprecated in favour of ISO C++ conformant names like _fileno. These warnings are also currently suppressed by adding -D_CRT_NONSTDC_NO_DEPRECATE. It might be nice to do as Microsoft suggest here too, although, unlike the secure functions issue, there is presumably little or no benefit in this case.</div>
<div class="subsection">
<h2>Fix <i>POSIX::access()</i> and <i>chdir()</i> on Win32</h2> These functions currently take no account of DACLs and therefore do not behave correctly in situations where access is restricted by DACLs (as opposed to the read-only attribute).<div class="spacer">
</div>
Furthermore, <i>POSIX::access()</i> behaves differently for directories having the read-only attribute set depending on what CRT library is being used. For example, the  <i>_access()</i> function in the VC6 and VC7 CRTs (wrongly) claim that such directories are not writable, whereas in fact all directories are writable unless access is denied by DACLs. (In the case of directories, the read-only attribute actually only means that the directory cannot be deleted.) This CRT bug is fixed in the VC8 and VC9 CRTs (but, of course, the directory may still not actually be writable if access is indeed denied by DACLs).<div class="spacer">
</div>
For the <i>chdir()</i> issue, see ActiveState bug #74552: &lt;http://bugs.activestate.com/show_bug.cgi?id=74552&gt;<div class="spacer">
</div>
Therefore, DACLs should be checked both for consistency across CRTs and for the correct answer.<div class="spacer">
</div>
(Note that perl's -w operator should not be modified to check DACLs. It has been written so that it reflects the state of the read-only attribute, even for directories (whatever CRT is being used), for symmetry with  <i>chmod()</i>.)</div>
<div class="subsection">
<h2><i>strcat()</i>, <i>strcpy()</i>, <i>strncat()</i>, <i>strncpy()</i>, <i>sprintf()</i>, <i>vsprintf()</i></h2> Maybe create a utility that checks after each libperl.a creation that none of the above (nor  <i>sprintf()</i>, <i>vsprintf()</i>, or *SHUDDER* <i>gets()</i>) ever creep back to libperl.a.<div class="spacer">
</div>
<br/>
  nm libperl.a | ./miniperl -alne '$o = $F[0] if /:$/; print &quot;$o $F[1]&quot; if $F[0] eq &quot;U&quot; &amp;&amp; $F[1] =~ /^(?:strn?c(?:at|py)|v?sprintf|gets)$/'<br/>
<div class="spacer">
</div>
Note, of course, that this will only tell whether <b>your</b> platform is using those naughty interfaces.</div>
<div class="subsection">
<h2>-D_FORTIFY_SOURCE=2, -fstack-protector</h2> Recent glibcs support &quot;-D_FORTIFY_SOURCE=2&quot; and recent gcc (4.1 onwards?) supports &quot;-fstack-protector&quot;, both of which give protection against various kinds of buffer overflow problems. These should probably be used for compiling Perl whenever available, Configure and/or hints files should be adjusted to probe for the availability of these features and enable them as appropriate.</div>
<div class="subsection">
<h2>Arenas for GPs? For MAGIC?</h2> &quot;struct gp&quot; and &quot;struct magic&quot; are both currently allocated by &quot;malloc&quot;. It might be a speed or memory saving to change to using arenas. Or it might not. It would need some suitable benchmarking first. In particular, &quot;GP&quot;s can probably be changed with minimal compatibility impact (probably nothing outside of the core, or even outside of  <i>gv.c</i> allocates them), but they probably aren't allocated/deallocated often enough for a speed saving. Whereas &quot;MAGIC&quot; is allocated/deallocated more often, but in turn, is also something more externally visible, so changing the rules here may bite external code.</div>
<div class="subsection">
<h2>Shared arenas</h2> Several SV body structs are now the same size, notably PVMG and PVGV, PVAV and PVHV, and PVCV and PVFM. It should be possible to allocate and return same sized bodies from the same actual arena, rather than maintaining one arena for each. This could save 4-6K per thread, of memory no longer tied up in the not-yet-allocated part of an arena.</div>
</div>
<div class="section">
<h1>Tasks that need a knowledge of XS</h1> These tasks would need C knowledge, and roughly the level of knowledge of the perl API that comes from writing modules that use XS to interface to C.<div class="subsection">
<h2>Write an XS cookbook</h2> Create pod/perlxscookbook.pod with short, task-focused 'recipes' in XS that demonstrate common tasks and good practices.  (Some of these might be extracted from perlguts.) The target audience should be XS novices, who need more examples than perlguts but something less overwhelming than perlapi. Recipes should provide &quot;one pretty good way to do it&quot; instead of TIMTOWTDI.<div class="spacer">
</div>
Rather than focusing on interfacing Perl to C libraries, such a cookbook should probably focus on how to optimize Perl routines by re-writing them in XS.  This will likely be more motivating to those who mostly work in Perl but are looking to take the next step into XS.<div class="spacer">
</div>
Deconstructing and explaining some simpler XS modules could be one way to bootstrap a cookbook.  (List::Util? Class::XSAccessor? Tree::Ternary_XS?) Another option could be deconstructing the implementation of some simpler functions in op.c.</div>
<div class="subsection">
<h2>Allow XSUBs to inline themselves as OPs</h2> For a simple XSUB, often the subroutine dispatch takes more time than the XSUB itself. The tokeniser already has the ability to inline constant subroutines - it would be good to provide a way to inline other subroutines.<div class="spacer">
</div>
Specifically, simplest approach looks to be to allow an XSUB to provide an alternative implementation of itself as a custom OP. A new flag bit in &quot;CvFLAGS()&quot; would signal to the peephole optimiser to take an optree such as this:<div class="spacer">
</div>
<br/>
    b  &lt;@&gt; leave[1 ref] vKP/REFC -&gt;(end)<br/>
    1     &lt;0&gt; enter -&gt;2<br/>
    2     &lt;;&gt; nextstate(main 1 -e:1) v:{ -&gt;3<br/>
    a     &lt;2&gt; sassign vKS/2 -&gt;b<br/>
    8        &lt;1&gt; entersub[t2] sKS/TARG,1 -&gt;9<br/>
    -           &lt;1&gt; ex-list sK -&gt;8<br/>
    3              &lt;0&gt; pushmark s -&gt;4<br/>
    4              &lt;$&gt; const(IV 1) sM -&gt;5<br/>
    6              &lt;1&gt; rv2av[t1] lKM/1 -&gt;7<br/>
    5                 &lt;$&gt; gv(*a) s -&gt;6<br/>
    -              &lt;1&gt; ex-rv2cv sK -&gt;-<br/>
    7                 &lt;$&gt; gv(*x) s/EARLYCV -&gt;8<br/>
    -        &lt;1&gt; ex-rv2sv sKRM*/1 -&gt;a<br/>
    9           &lt;$&gt; gvsv(*b) s -&gt;a<br/>
<div class="spacer">
</div>
perform the symbol table lookup of &quot;rv2cv&quot; and &quot;gv(*x)&quot;, locate the pointer to the custom OP that provides the direct implementation, and re- write the optree something like:<div class="spacer">
</div>
<br/>
    b  &lt;@&gt; leave[1 ref] vKP/REFC -&gt;(end)<br/>
    1     &lt;0&gt; enter -&gt;2<br/>
    2     &lt;;&gt; nextstate(main 1 -e:1) v:{ -&gt;3<br/>
    a     &lt;2&gt; sassign vKS/2 -&gt;b<br/>
    7        &lt;1&gt; custom_x -&gt; 8<br/>
    -           &lt;1&gt; ex-list sK -&gt;7<br/>
    3              &lt;0&gt; pushmark s -&gt;4<br/>
    4              &lt;$&gt; const(IV 1) sM -&gt;5<br/>
    6              &lt;1&gt; rv2av[t1] lKM/1 -&gt;7<br/>
    5                 &lt;$&gt; gv(*a) s -&gt;6<br/>
    -              &lt;1&gt; ex-rv2cv sK -&gt;-<br/>
    -                 &lt;$&gt; ex-gv(*x) s/EARLYCV -&gt;7<br/>
    -        &lt;1&gt; ex-rv2sv sKRM*/1 -&gt;a<br/>
    8           &lt;$&gt; gvsv(*b) s -&gt;a<br/>
<div class="spacer">
</div>
<i>i.e.</i> the gv(*) OP has been nulled and spliced out of the execution path, and the &quot;entersub&quot; OP has been replaced by the custom op.<div class="spacer">
</div>
This approach should provide a measurable speed up to simple XSUBs inside tight loops. Initially one would have to write the OP alternative implementation by hand, but it's likely that this should be reasonably straightforward for the type of XSUB that would benefit the most. Longer term, once the run-time implementation is proven, it should be possible to progressively update ExtUtils::ParseXS to generate OP implementations for some XSUBs.</div>
<div class="subsection">
<h2>Remove the use of SVs as temporaries in dump.c</h2>  <i>dump.c</i> contains debugging routines to dump out the contains of perl data structures, such as &quot;SV&quot;s, &quot;AV&quot;s and &quot;HV&quot;s. Currently, the dumping code  <b>uses</b> &quot;SV&quot;s for its temporary buffers, which was a logical initial implementation choice, as they provide ready made memory handling.<div class="spacer">
</div>
However, they also lead to a lot of confusion when it happens that what you're trying to debug is seen by the code in  <i>dump.c</i>, correctly or incorrectly, as a temporary scalar it can use for a temporary buffer. It's also not possible to dump scalars before the interpreter is properly set up, such as during ithreads cloning. It would be good to progressively replace the use of scalars as string accumulation buffers with something much simpler, directly allocated by &quot;malloc&quot;. The  <i>dump.c</i> code is (or should be) only producing 7 bit US-ASCII, so output character sets are not an issue.<div class="spacer">
</div>
Producing and proving an internal simple buffer allocation would make it easier to re-write the internals of the PerlIO subsystem to avoid using &quot;SV&quot;s for  <b>its</b> buffers, use of which can cause problems similar to those of <i>dump.c</i>, at similar times.</div>
<div class="subsection">
<h2>safely supporting POSIX SA_SIGINFO</h2> Some years ago Jarkko supplied patches to provide support for the POSIX SA_SIGINFO feature in Perl, passing the extra data to the Perl signal handler.<div class="spacer">
</div>
Unfortunately, it only works with &quot;unsafe&quot; signals, because under safe signals, by the time Perl gets to run the signal handler, the extra information has been lost. Moreover, it's not easy to store it somewhere, as you can't call mutexs, or do anything else fancy, from inside a signal handler.<div class="spacer">
</div>
So it strikes me that we could provide safe SA_SIGINFO support<dl>
<dt>
1.</dt>
<dd>
Provide global variables for two file descriptors</dd>
</dl>
<dl>
<dt>
2.</dt>
<dd>
When the first request is made via &quot;sigaction&quot; for &quot;SA_SIGINFO&quot;, create a pipe, store the reader in one, the writer in the other</dd>
</dl>
<dl>
<dt>
3.</dt>
<dd>
In the &quot;safe&quot; signal handler (&quot;Perl_csighandler()&quot;/&quot;S_raise_signal()&quot;), if the &quot;siginfo_t&quot; pointer non-&quot;NULL&quot;, and the writer file handle is open,</dd>
</dl>
<div style="margin-left: 4.00ex;">
<dl>
<dt>
1.</dt>
<dd>
serialise signal number, &quot;struct siginfo_t&quot; (or at least the parts we care about) into a small auto char buff</dd>
</dl>
<dl>
<dt>
2.</dt>
<dd>
&quot;write()&quot; that (non-blocking) to the writer fd<div style="margin-left: 8.00ex;">
<dl>
<dt>
1.</dt>
<dd>
if it writes 100%, flag the signal in a counter of &quot;signals on the pipe&quot; akin to the current per-signal-number counts</dd>
</dl>
<dl>
<dt>
2.</dt>
<dd>
if it writes 0%, assume the pipe is full. Flag the data as lost?</dd>
</dl>
<dl>
<dt>
3.</dt>
<dd>
if it writes partially, croak a panic, as your OS is broken.</dd>
</dl>
</div>
<div style="margin-left: 8.00ex;">
</div>
</dd>
</dl>
</div>
<div style="margin-left: 4.00ex;">
</div>
<dl>
<dt>
4.</dt>
<dd>
in the regular &quot;PERL_ASYNC_CHECK()&quot; processing, if there are &quot;signals on the pipe&quot;, read the data out, deserialise, build the Perl structures on the stack (code in &quot;Perl_sighandler()&quot;, the &quot;unsafe&quot; handler), and call as usual.</dd>
</dl>
<div class="spacer">
</div>
I think that this gets us decent &quot;SA_SIGINFO&quot; support, without the current risk of running Perl code inside the signal handler context. (With all the dangers of things like &quot;malloc&quot; corruption that that currently offers us)<div class="spacer">
</div>
For more information see the thread starting with this message: http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2008-03/msg00305.html &lt;http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2008-03/msg00305.html&gt;</div>
<div class="subsection">
<h2>autovivification</h2> Make all autovivification consistent w.r.t LVALUE/RVALUE and strict/no strict;<div class="spacer">
</div>
This task is incremental - even a little bit of work on it will help.</div>
<div class="subsection">
<h2>Unicode in Filenames</h2> chdir, chmod, chown, chroot, exec, glob, link, lstat, mkdir, open, opendir, qx, readdir, readlink, rename, rmdir, stat, symlink, sysopen, system, truncate, unlink, utime, -X.  All these could potentially accept Unicode filenames either as input or output (and in the case of system and qx Unicode in general, as input or output to/from the shell). Whether a filesystem - an operating system pair understands Unicode in filenames varies.<div class="spacer">
</div>
Known combinations that have some level of understanding include Microsoft NTFS, Apple HFS+ (In Mac OS 9 and X) and Apple UFS (in Mac OS X), NFS v4 is rumored to be Unicode, and of course Plan 9.  How to create Unicode filenames, what forms of Unicode are accepted and used (UCS-2, UTF-16, UTF-8), what (if any) is the normalization form used, and so on, varies.  Finding the right level of interfacing to Perl requires some thought.  Remember that an OS does not implicate a filesystem.<div class="spacer">
</div>
(The Windows -C command flag &quot;wide API support&quot; has been at least temporarily retired in 5.8.1, and the -C has been repurposed, see perlrun.)<div class="spacer">
</div>
Most probably the right way to do this would be this: &quot;Virtualize operating system access&quot;.</div>
<div class="subsection">
<h2>Unicode in %ENV</h2> Currently the %ENV entries are always byte strings. See &quot;Virtualize operating system access&quot;.</div>
<div class="subsection">
<h2>Unicode and <i>glob()</i></h2> Currently glob patterns and filenames returned from  <i>File::Glob::glob()</i> are always byte strings.  See &quot;Virtualize operating system access&quot;.</div>
<div class="subsection">
<h2>use less 'memory'</h2> Investigate trade offs to switch out perl's choices on memory usage. Particularly perl should be able to give memory back.<div class="spacer">
</div>
This task is incremental - even a little bit of work on it will help.</div>
<div class="subsection">
<h2>Re-implement &quot;:unique&quot; in a way that is actually thread-safe</h2> The old implementation made bad assumptions on several levels. A good 90% solution might be just to make &quot;:unique&quot; work to share the string buffer of SvPVs. That way large constant strings can be shared between ithreads, such as the configuration information in  <i>Config</i>.</div>
<div class="subsection">
<h2>Make tainting consistent</h2> Tainting would be easier to use if it didn't take documented shortcuts and allow taint to &quot;leak&quot; everywhere within an expression.</div>
<div class="subsection">
<h2>readpipe(LIST)</h2>  <i>system()</i> accepts a LIST syntax (and a PROGRAM LIST syntax) to avoid running a shell.  <i>readpipe()</i> (the function behind qx//) could be similarly extended.</div>
<div class="subsection">
<h2>Audit the code for destruction ordering assumptions</h2> Change 25773 notes<div class="spacer">
</div>
<br/>
    /* Need to check SvMAGICAL, as during global destruction it may be that<br/>
       AvARYLEN(av) has been freed before av, and hence the SvANY() pointer<br/>
       is now part of the linked list of SV heads, rather than pointing to<br/>
       the original body.  */<br/>
    /* FIXME - audit the code for other bugs like this one.  */<br/>
<div class="spacer">
</div>
adding the &quot;SvMAGICAL&quot; check to<div class="spacer">
</div>
<br/>
    if (AvARYLEN(av) &amp;&amp; SvMAGICAL(AvARYLEN(av))) {<br/>
        MAGIC *mg = mg_find (AvARYLEN(av), PERL_MAGIC_arylen);<br/>
<div class="spacer">
</div>
Go through the core and look for similar assumptions that SVs have particular types, as all bets are off during global destruction.</div>
<div class="subsection">
<h2>Extend PerlIO and PerlIO::Scalar</h2> PerlIO::Scalar doesn't know how to  <i>truncate()</i>.  Implementing this would require extending the PerlIO vtable.<div class="spacer">
</div>
Similarly the PerlIO vtable doesn't know about formats (<i>write()</i>), or about  <i>stat()</i>, or <i>chmod()</i>/<i>chown()</i>, <i>utime()</i>, or <i>flock()</i>.<div class="spacer">
</div>
(For PerlIO::Scalar it's hard to see what e.g. mode bits or ownership would mean.)<div class="spacer">
</div>
PerlIO doesn't do directories or symlinks, either: <i>mkdir()</i>, <i>rmdir()</i>,  <i>opendir()</i>, <i>closedir()</i>, <i>seekdir()</i>, <i>rewinddir()</i>, <i>glob()</i>; <i>symlink()</i>,  <i>readlink()</i>.<div class="spacer">
</div>
See also &quot;Virtualize operating system access&quot;.</div>
<div class="subsection">
<h2>-C on the #! line</h2> It should be possible to make -C work correctly if found on the #! line, given that all perl command line options are strict ASCII, and -C changes only the interpretation of non-ASCII characters, and not for the script file handle. To make it work needs some investigation of the ordering of function calls during startup, and (by implication) a bit of tweaking of that order.</div>
<div class="subsection">
<h2>Organize error messages</h2> Perl's diagnostics (error messages, see perldiag) could use reorganizing and formalizing so that each error message has its stable-for-all-eternity unique id, categorized by severity, type, and subsystem.  (The error messages would be listed in a datafile outside of the Perl source code, and the source code would only refer to the messages by the id.)  This clean-up and regularizing should apply for all  <i>croak()</i> messages.<div class="spacer">
</div>
This would enable all sorts of things: easier translation/localization of the messages (though please do keep in mind the caveats of Locale::Maketext about too straightforward approaches to translation), filtering by severity, and instead of grepping for a particular error message one could look for a stable error id.  (Of course, changing the error messages by default would break all the existing software depending on some particular error message...)<div class="spacer">
</div>
This kind of functionality is known as <i>message catalogs</i>.  Look for inspiration for example in the  <i>catgets()</i> system, possibly even use it if available-- but  <b>only</b> if available, all platforms will <b>not</b> have  <i>catgets()</i>.<div class="spacer">
</div>
For the really pure at heart, consider extending this item to cover also the warning messages (see perllexwarn, &quot;warnings.pl&quot;).</div>
</div>
<div class="section">
<h1>Tasks that need a knowledge of the interpreter</h1> These tasks would need C knowledge, and knowledge of how the interpreter works, or a willingness to learn.<div class="subsection">
<h2>forbid labels with keyword names</h2> Currently &quot;goto keyword&quot; &quot;computes&quot; the label value:<div class="spacer">
</div>
<br/>
    $ perl -e 'goto print'<br/>
    Can't find label 1 at -e line 1.<br/>
<div class="spacer">
</div>
It is controversial if the right way to avoid the confusion is to forbid labels with keyword names, or if it would be better to always treat bareword expressions after a &quot;goto&quot; as a label and never as a keyword.</div>
<div class="subsection">
<h2><i>truncate()</i> prototype</h2> The prototype of  <i>truncate()</i> is currently $$. It should probably be &quot;*$&quot; instead. (This is changed in  <i>opcode.pl</i>)</div>
<div class="subsection">
<h2>decapsulation of smart match argument</h2> Currently &quot;$foo ~~ $object&quot; will die with the message &quot;Smart matching a non-overloaded object breaks encapsulation&quot;. It would be nice to allow to bypass this by using explicitly the syntax &quot;$foo ~~ %$object&quot; or &quot;$foo ~~ @$object&quot;.</div>
<div class="subsection">
<h2>error reporting of [$a ; $b]</h2> Using &quot;;&quot; inside brackets is a syntax error, and we don't propose to change that by giving it any meaning. However, it's not reported very helpfully:<div class="spacer">
</div>
<br/>
    $ perl -e '$a = [$b; $c];'<br/>
    syntax error at -e line 1, near &quot;$b;&quot;<br/>
    syntax error at -e line 1, near &quot;$c]&quot;<br/>
    Execution of -e aborted due to compilation errors.<br/>
<div class="spacer">
</div>
It should be possible to hook into the tokeniser or the lexer, so that when a &quot;;&quot; is parsed where it is not legal as a statement terminator (ie inside &quot;{}&quot; used as a hashref, &quot;[]&quot; or &quot;()&quot;) it issues an error something like  <i>';' isn't legal inside an expression - if you need multiple statements use a</i>  <i>do {...} block</i>. See the thread starting at http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2008-09/msg00573.html &lt;http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2008-09/msg00573.html&gt;</div>
<div class="subsection">
<h2>lexicals used only once</h2> This warns:<div class="spacer">
</div>
<br/>
    $ perl -we '$pie = 42'<br/>
    Name &quot;main::pie&quot; used only once: possible typo at -e line 1.<br/>
<div class="spacer">
</div>
This does not:<div class="spacer">
</div>
<br/>
    $ perl -we 'my $pie = 42'<br/>
<div class="spacer">
</div>
Logically all lexicals used only once should warn, if the user asks for warnings.  An unworked RT ticket (#5087) has been open for almost seven years for this discrepancy.</div>
<div class="subsection">
<h2>UTF-8 revamp</h2> The handling of Unicode is unclean in many places.  In the regex engine there are especially many problems.  The swash data structure could be replaced my something better.  Inversion lists and maps are likely candidates.  The whole Unicode database could be placed in-core for a huge speed-up.  Only minimal work was done on the optimizer when utf8 was added, with the result that the synthetic start class often will fail to narrow down the possible choices when given non-Latin1 input.</div>
<div class="subsection">
<h2>Properly Unicode safe tokeniser and pads.</h2> The tokeniser isn't actually very UTF-8 clean. &quot;use utf8;&quot; is a hack - variable names are stored in stashes as raw bytes, without the utf-8 flag set. The pad API only takes a &quot;char *&quot; pointer, so that's all bytes too. The tokeniser ignores the UTF-8-ness of &quot;PL_rsfp&quot;, or any SVs returned from source filters.  All this could be fixed.</div>
<div class="subsection">
<h2>state variable initialization in list context</h2> Currently this is illegal:<div class="spacer">
</div>
<br/>
    state ($a, $b) = foo();<br/>
<div class="spacer">
</div>
In Perl 6, &quot;state ($a) = foo();&quot; and &quot;(state $a) = foo();&quot; have different semantics, which is tricky to implement in Perl 5 as currently they produce the same opcode trees. The Perl 6 design is firm, so it would be good to implement the necessary code in Perl 5. There are comments in &quot;Perl_newASSIGNOP()&quot; that show the code paths taken by various assignment constructions involving state variables.</div>
<div class="subsection">
<h2>Implement $value ~~ 0 .. $range</h2> It would be nice to extend the syntax of the &quot;~~&quot; operator to also understand numeric (and maybe alphanumeric) ranges.</div>
<div class="subsection">
<h2>A <i>does()</i> built-in</h2> Like  <i>ref()</i>, only useful. It would call the &quot;DOES&quot; method on objects; it would also tell whether something can be dereferenced as an array/hash/etc., or used as a regexp, etc. http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2007-03/msg00481.html &lt;http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2007-03/msg00481.html&gt;</div>
<div class="subsection">
<h2>Tied filehandles and <i>write()</i> don't mix</h2> There is no method on tied filehandles to allow them to be called back by formats.</div>
<div class="subsection">
<h2>Propagate compilation hints to the debugger</h2> Currently a debugger started with -dE on the command-line doesn't see the features enabled by -E. More generally hints ($^H and &quot;%^H&quot;) aren't propagated to the debugger. Probably it would be a good thing to propagate hints from the innermost non-&quot;DB::&quot; scope: this would make code eval'ed in the debugger see the features (and strictures, etc.) currently in scope.</div>
<div class="subsection">
<h2>Attach/detach debugger from running program</h2> The old perltodo notes &quot;With &quot;gdb&quot;, you can attach the debugger to a running program if you pass the process ID. It would be good to do this with the Perl debugger on a running Perl program, although I'm not sure how it would be done.&quot; ssh and screen do this with named pipes in /tmp. Maybe we can too.</div>
<div class="subsection">
<h2>LVALUE functions for lists</h2> The old perltodo notes that lvalue functions don't work for list or hash slices. This would be good to fix.</div>
<div class="subsection">
<h2>regexp optimiser optional</h2> The regexp optimiser is not optional. It should configurable to be, to allow its performance to be measured, and its bugs to be easily demonstrated.</div>
<div class="subsection">
<h2>&quot;/w&quot; regex modifier</h2> That flag would enable to match whole words, and also to interpolate arrays as alternations. With it, &quot;/P/w&quot; would be roughly equivalent to:<div class="spacer">
</div>
<br/>
    do { local $&quot;='|'; /\b(?:P)\b/ }<br/>
<div class="spacer">
</div>
See http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2007-01/msg00400.html &lt;http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2007-01/msg00400.html&gt; for the discussion.</div>
<div class="subsection">
<h2>optional optimizer</h2> Make the peephole optimizer optional. Currently it performs two tasks as it walks the optree - genuine peephole optimisations, and necessary fixups of ops. It would be good to find an efficient way to switch out the optimisations whilst keeping the fixups.</div>
<div class="subsection">
<h2>You WANT *how* many</h2> Currently contexts are void, scalar and list. split has a special mechanism in place to pass in the number of return values wanted. It would be useful to have a general mechanism for this, backwards compatible and little speed hit. This would allow proposals such as short circuiting sort to be implemented as a module on CPAN.</div>
<div class="subsection">
<h2>lexical aliases</h2> Allow lexical aliases (maybe via the syntax &quot;my \$alias = \$foo&quot;.</div>
<div class="subsection">
<h2>entersub XS vs Perl</h2> At the moment pp_entersub is huge, and has code to deal with entering both perl and XS subroutines. Subroutine implementations rarely change between perl and XS at run time, so investigate using 2 ops to enter subs (one for XS, one for perl) and swap between if a sub is redefined.</div>
<div class="subsection">
<h2>Self-ties</h2> Self-ties are currently illegal because they caused too many segfaults. Maybe the causes of these could be tracked down and self-ties on all types reinstated.</div>
<div class="subsection">
<h2>Optimize away @_</h2> The old perltodo notes &quot;Look at the &quot;reification&quot; code in &quot;av.c&quot;&quot;.</div>
<div class="subsection">
<h2>Virtualize operating system access</h2> Implement a set of &quot;vtables&quot; that virtualizes operating system access ( <i>open()</i>, <i>mkdir()</i>, <i>unlink()</i>, <i>readdir()</i>, <i>getenv()</i>, etc.)  At the very least these interfaces should take SVs as &quot;name&quot; arguments instead of bare char pointers; probably the most flexible and extensible way would be for the Perl-facing interfaces to accept HVs.  The system needs to be per-operating-system and per-file-system hookable/filterable, preferably both from XS and Perl level (&quot;Files and Filesystems&quot; in perlport is good reading at this point, in fact, all of perlport is.)<div class="spacer">
</div>
This has actually already been implemented (but only for Win32), take a look at  <i>iperlsys.h</i> and <i>win32/perlhost.h</i>.  While all Win32 variants go through a set of &quot;vtables&quot; for operating system access, non-Win32 systems currently go straight for the POSIX/Unix-style system/library call.  Similar system as for Win32 should be implemented for all platforms.  The existing Win32 implementation probably does not need to survive alongside this proposed new implementation, the approaches could be merged.<div class="spacer">
</div>
What would this give us?  One often-asked-for feature this would enable is using Unicode for filenames, and other &quot;names&quot; like %ENV, usernames, hostnames, and so forth. (See &quot;When Unicode Does Not Happen&quot; in perlunicode.)<div class="spacer">
</div>
But this kind of virtualization would also allow for things like virtual filesystems, virtual networks, and &quot;sandboxes&quot; (though as long as dynamic loading of random object code is allowed, not very safe sandboxes since external code of course know not of Perl's vtables). An example of a smaller &quot;sandbox&quot; is that this feature can be used to implement per-thread working directories: Win32 already does this.<div class="spacer">
</div>
See also &quot;Extend PerlIO and PerlIO::Scalar&quot;.</div>
<div class="subsection">
<h2>Investigate PADTMP hash pessimisation</h2> The peephole optimiser converts constants used for hash key lookups to shared hash key scalars. Under ithreads, something is undoing this work. See http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2007-09/msg00793.html &lt;http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2007-09/msg00793.html&gt;</div>
<div class="subsection">
<h2>Store the current pad in the OP slab allocator</h2> Currently we leak ops in various cases of parse failure. I suggested that we could solve this by always using the op slab allocator, and walking it to free ops. Dave comments that as some ops are already freed during optree creation one would have to mark which ops are freed, and not double free them when walking the slab. He notes that one problem with this is that for some ops you have to know which pad was current at the time of allocation, which does change. I suggested storing a pointer to the current pad in the memory allocated for the slab, and swapping to a new slab each time the pad changes. Dave thinks that this would work.</div>
<div class="subsection">
<h2>repack the optree</h2> Repacking the optree after execution order is determined could allow removal of NULL ops, and optimal ordering of OPs with respect to cache-line filling.  The slab allocator could be reused for this purpose.  I think that the best way to do this is to make it an optional step just before the completed optree is attached to anything else, and to use the slab allocator unchanged, so that freeing ops is identical whether or not this step runs. Note that the slab allocator allocates ops downwards in memory, so one would have to actually &quot;allocate&quot; the ops in reverse-execution order to get them contiguous in memory in execution order.<div class="spacer">
</div>
See &lt;http://www.nntp.perl.org/group/perl.perl5.porters/2007/12/msg131975.html&gt;<div class="spacer">
</div>
Note that running this copy, and then freeing all the old location ops would cause their slabs to be freed, which would eliminate possible memory wastage if the previous suggestion is implemented, and we swap slabs more frequently.</div>
<div class="subsection">
<h2>eliminate incorrect line numbers in warnings</h2> This code<div class="spacer">
</div>
<br/>
    use warnings;<br/>
    my $undef;<br/>
    <br/>
    if ($undef == 3) {<br/>
    } elsif ($undef == 0) {<br/>
    }<br/>
<div class="spacer">
</div>
used to produce this output:<div class="spacer">
</div>
<br/>
    Use of uninitialized value in numeric eq (==) at wrong.pl line 4.<br/>
    Use of uninitialized value in numeric eq (==) at wrong.pl line 4.<br/>
<div class="spacer">
</div>
where the line of the second warning was misreported - it should be line 5. Rafael fixed this - the problem arose because there was no nextstate OP between the execution of the &quot;if&quot; and the &quot;elsif&quot;, hence &quot;PL_curcop&quot; still reports that the currently executing line is line 4. The solution was to inject a nextstate OPs for each &quot;elsif&quot;, although it turned out that the nextstate OP needed to be a nulled OP, rather than a live nextstate OP, else other line numbers became misreported. (Jenga!)<div class="spacer">
</div>
The problem is more general than &quot;elsif&quot; (although the &quot;elsif&quot; case is the most common and the most confusing). Ideally this code<div class="spacer">
</div>
<br/>
    use warnings;<br/>
    my $undef;<br/>
    <br/>
    my $a = $undef + 1;<br/>
    my $b<br/>
      = $undef<br/>
      + 1;<br/>
<div class="spacer">
</div>
would produce this output<div class="spacer">
</div>
<br/>
    Use of uninitialized value $undef in addition (+) at wrong.pl line 4.<br/>
    Use of uninitialized value $undef in addition (+) at wrong.pl line 7.<br/>
<div class="spacer">
</div>
(rather than lines 4 and 5), but this would seem to require every OP to carry (at least) line number information.<div class="spacer">
</div>
What might work is to have an optional line number in memory just before the BASEOP structure, with a flag bit in the op to say whether it's present. Initially during compile every OP would carry its line number. Then add a late pass to the optimiser (potentially combined with &quot;repack the optree&quot;) which looks at the two ops on every edge of the graph of the execution path. If the line number changes, flags the destination OP with this information. Once all paths are traced, replace every op with the flag with a nextstate-light op (that just updates &quot;PL_curcop&quot;), which in turn then passes control on to the true op. All ops would then be replaced by variants that do not store the line number. (Which, logically, why it would work best in conjunction with &quot;repack the optree&quot;, as that is already copying/reallocating all the OPs)<div class="spacer">
</div>
(Although I should note that we're not certain that doing this for the general case is worth it)</div>
<div class="subsection">
<h2>optimize tail-calls</h2> Tail-calls present an opportunity for broadly applicable optimization; anywhere that &quot;return foo(...)&quot; is called, the outer return can be replaced by a goto, and foo will return directly to the outer caller, saving (conservatively) 25% of perl's call&amp;return cost, which is relatively higher than in C.  The scheme language is known to do this heavily.  B::Concise provides good insight into where this optimization is possible, ie anywhere entersub,leavesub op-sequence occurs.<div class="spacer">
</div>
<br/>
 perl -MO=Concise,-exec,a,b,-main -e 'sub a{ 1 }; sub b {a()}; b(2)'<br/>
<div class="spacer">
</div>
Bottom line on this is probably a new pp_tailcall function which combines the code in pp_entersub, pp_leavesub.  This should probably be done 1st in XS, and using B::Generate to patch the new OP into the optrees.</div>
<div class="subsection">
<h2>Add &quot;00dddd&quot;</h2> It has been proposed that octal constants be specifiable through the syntax &quot;0oddddd&quot;, parallel to the existing construct to specify hex constants 0xddddd</div>
</div>
<div class="section">
<h1>Big projects</h1> Tasks that will get your name mentioned in the description of the &quot;Highlights of 5.14&quot;<div class="subsection">
<h2>make ithreads more robust</h2> Generally make ithreads more robust. See also &quot;iCOW&quot;<div class="spacer">
</div>
This task is incremental - even a little bit of work on it will help, and will be greatly appreciated.<div class="spacer">
</div>
One bit would be to determine how to clone directory handles on systems without a &quot;fchdir&quot; function (in sv.c:Perl_dirp_dup).<div class="spacer">
</div>
Fix Perl_sv_dup, et al so that threads can return objects.</div>
<div class="subsection">
<h2>iCOW</h2> Sarathy and Arthur have a proposal for an improved Copy On Write which specifically will be able to COW new ithreads. If this can be implemented it would be a good thing.</div>
<div class="subsection">
<h2>(?{...}) closures in regexps</h2> Fix (or rewrite) the implementation of the &quot;/(?{...})/&quot; closures.</div>
<div class="subsection">
<h2>Add class set operations to regexp engine</h2> Apparently these are quite useful. Anyway, Jeffery Friedl wants them.<div class="spacer">
</div>
demerphq has this on his todo list, but right at the bottom.</div>
</div>
<div class="section">
<h1>Tasks for microperl</h1> [ Each and every one of these may be obsolete, but they were listed<br/>
  in the old Todo.micro file]<div class="subsection">
<h2>make creating uconfig.sh automatic</h2></div>
<div class="subsection">
<h2>make creating Makefile.micro automatic</h2></div>
<div class="subsection">
<h2>do away with fork/exec/wait?</h2> (system, popen should be enough?)</div>
<div class="subsection">
<h2>some of the uconfig.sh really needs to be probed (using cc) in buildtime:</h2> (uConfigure? :-) native datatype widths and endianness come to mind</div>
</div>
<table class="foot">
<tr>
<td class="foot-date">
2011-09-26</td>
<td class="foot-os">
perl v5.14.2</td>
</tr>
</table>
</div>
</body>
</html>

