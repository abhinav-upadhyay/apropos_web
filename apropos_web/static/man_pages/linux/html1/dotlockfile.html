<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/linux/style.css" type="text/css" media="all"/>
<title>
DOTLOCKFILE(1)</title>
</head>
<body>
<div class="mandoc">
<table class="head">
<tbody>
<tr>
<td class="head-ltitle">
DOTLOCKFILE(1)</td>
<td class="head-vol">
Cistron Utilities</td>
<td class="head-rtitle">
DOTLOCKFILE(1)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1>NAME</h1> dotlockfile - Utility to manage lockfiles</div>
<div class="section">
<h1>SYNOPSIS</h1> <b>/usr/bin/dotlockfile</b> [<b>-l</b> [<b>-r</b> <i>retries</i>] |<b>-u</b>|<b>-t</b>|<b>-c</b>] [<b>-p</b>] [<b>-m</b>|<b>lockfile</b>]</div>
<div class="section">
<h1>DESCRIPTION</h1> <b>dotlockfile</b> is a command line utility to reliably create, test and remove lockfiles. It creates lockfiles <i>reliably</i> on local and NFS filesystems, because the crucial steps of testing for a preexisting lockfile and creating it are performed <i>atomically</i> by a <i>single</i> call to <i>link</i>(2). Manpage <i>lockfile_create</i>(3) describes the used algorithm.<div class="spacer">
</div>
<b>dotlockfile</b> is installed with attribute <b>SETGID</b><i>&#160;mail</i> and thus can also be used to lock and unlock mailboxes <i>even</i> if the mailspool directory is only writable by group mail.<div class="spacer">
</div>
The name <b>dotlockfile</b> comes from the way mailboxes are locked for updates on a lot of UNIX systems. A lockfile is created with the same filename as the mailbox but with the string &quot; <i>.lock</i>&quot; appended.<div class="spacer">
</div>
The names <b>dotlock</b> and <b>lockfile</b> were already taken - hence the name  <b>dotlockfile</b> <i>:)</i>.</div>
<div class="section">
<h1>OPTIONS</h1><dl>
<dt>
<b>-l</b></dt>
<dd>
Create a lockfile if no preexisting valid lockfile is found, else wait and retry according to option  <b>-r</b>. This option is the default.<div style="height: 1.00em;">
&#160;</div>
A lockfile is treated as valid,<div style="height: 0.00em;">
&#160;</div>
&#8226;&#160;&#160;if it holds the <i>process-id</i> of a running process,<div style="height: 0.00em;">
&#160;</div>
&#8226;&#160;&#160;or if it does not hold any <i>process-id</i> and has been touched less than 5&#160;minutes ago (timestamp is younger than 5&#160;minutes).</dd>
</dl>
<dl>
<dt>
<b>-r retries</b></dt>
<dd>
The number of times <b>dotlockfile</b> retries to acquire the lock if it failed the first time before giving up. The initial sleep after failing to acquire the lock is 5&#160;seconds. After each retry the sleep intervall is increased incrementally by 5&#160;seconds up to a maximum sleep of 60&#160;seconds between tries. The default number of retries is 5. To try only once, use &quot; <b>-r 0</b>&quot;. To try indefinitely, use &quot; <b>-r -1</b>&quot;.</dd>
</dl>
<dl>
<dt>
<b>-u</b></dt>
<dd>
Remove a lockfile.</dd>
</dl>
<dl>
<dt>
<b>-t</b></dt>
<dd>
Touch an existing lockfile (update the timestamp). Useful for lockfiles on NFS filesystems. For lockfiles on local filesystems the <b>-p</b> option is preferable.</dd>
</dl>
<dl>
<dt>
<b>-c</b></dt>
<dd>
For debugging only:  Check for the existence of a <i>valid</i> lockfile.<div style="height: 1.00em;">
&#160;</div>
Note:  Testing for a preexisting lockfile and writing of the lockfile <i>must</i> be done by the <i>same</i> &quot; <b>dotlockfile -l</b>&quot; or &quot;<b>dotlockfile -m</b>&quot; command, else the lockfile creation cannot be reliable.</dd>
</dl>
<dl>
<dt>
<b>-p</b></dt>
<dd>
Write the <i>process-id</i> of the calling process into the lockfile. Also when testing for an existing lockfile, check the contents for the <i>process-id</i> of a running process to verify if the lockfile is still valid. Obviously useful only for lockfiles on local filesystems.</dd>
</dl>
<dl>
<dt>
<b>-m</b></dt>
<dd>
Lock or unlock the current users mailbox. The path to the mailbox is the default system mailspool directory (usually <i>/var/mail</i>) with the username as gotten from <i>getpwuid</i>() appended. If the environment variable <i>$MAIL</i> is set, that is used instead. Then the string &quot; <i>.lock</i>&quot; is appended to get the name of the actual lockfile.</dd>
</dl>
<dl>
<dt>
lockfile</dt>
<dd>
The lockfile to be created or removed. Must not be specified, if the  <b>-m</b> option is in effect.</dd>
</dl>
</div>
<div class="section">
<h1>RETURN&#160;VALUE</h1> Zero on success, and non-zero on failure. For the  <b>-c</b> option, sucess means that a valid lockfile is already present. When locking (the default, or with the  <b>-l</b> option) <b>dotlockfile</b> returns the same values as the library function <i>lockfile_create</i>(3). Unlocking a non-existant lockfile is not an error.</div>
<div class="section">
<h1>NOTES</h1> The lockfile is created exactly as named on the command line. The extension &quot; <i>.lock</i>&quot; is <i>not</i> automatically appended.<div class="spacer">
</div>
This utility is a lot like the <i>lockfile</i>(1) utility included with <i>procmail</i>, and the <i>mutt_dotlock</i>(1) utility included with <i>mutt</i>. However the command-line arguments differ, and so does the return status. It is believed, that <i>dotlockfile</i> is the most flexible implementation, since it automatically detects when it needs to use priviliges to lock a mailbox, and does it safely.<div class="spacer">
</div>
The above mentioned <i>lockfile_create</i>(3) manpage is present in the <i>liblockfile-dev</i> package.</div>
<div class="section">
<h1>BUGS</h1> None known.</div>
<div class="section">
<h1>SEE&#160;ALSO</h1> <i>lockfile_create</i>(3), <i>maillock</i>(3)</div>
<div class="section">
<h1>AUTHOR</h1> Miquel van Smoorenburg, miquels@cistron.nl</div>
<table class="foot">
<tr>
<td class="foot-date">
September 8, 2009</td>
<td class="foot-os">
</td>
</tr>
</table>
</div>
</body>
</html>

