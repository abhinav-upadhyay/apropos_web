<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/linux/style.css" type="text/css" media="all"/>
<title>
lockfile-progs(1)</title>
</head>
<body>
<div class="mandoc">
<table class="head">
<tbody>
<tr>
<td class="head-ltitle">
lockfile-progs(1)</td>
<td class="head-vol">
Lockfile programs</td>
<td class="head-rtitle">
lockfile-progs(1)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1>NAME</h1> lockfile-progs - command-line programs to safely lock and unlock files and mailboxes (via liblockfile).</div>
<div class="section">
<h1>SYNOPSIS</h1><br/>
<b>mail-lock</b> [--use-pid] [--retry <i>retry-count</i>]<br/>
<b>mail-unlock</b><br/>
<b>mail-touchlock</b> [--oneshot]<div class="spacer">
</div>
<br/>
<b>lockfile-create</b> [--use-pid] [--retry <i>retry-count</i>] [--lock-name] <i>filename</i><br/>
<b>lockfile-remove</b> [--lock-name] <i>filename</i><br/>
<b>lockfile-touch</b> [--oneshot] [--lock-name] <i>filename</i><br/>
<b>lockfile-check</b> [--use-pid] [--lock-name] <i>filename</i><br/>
</div>
<div class="section">
<h1>DESCRIPTION</h1> Lockfile-progs provides a set a programs that can be used to lock and unlock mailboxes and files safely (via liblockfile):<div style="height: 1.00em;">
&#160;</div>
<div style="margin-left: 4.00ex;">
<b>mail-lock</b> - lock the current user's mailbox<br/>
<b>mail-unlock</b> - unlock the current user's mailbox<br/>
<b>mail-touchlock</b> - touch the lock on the current user's mailbox<div class="spacer">
</div>
<br/>
<b>lockfile-create</b> - lock a given file<br/>
<b>lockfile-remove</b> - remove the lock on a given file<br/>
<b>lockfile-touch</b> - touch the lock on a given file<br/>
<b>lockfile-check</b> - check the lock on a given file</div>
<br/>
<div style="height: 1.00em;">
&#160;</div>
By default, the <i>filename</i> argument refers to the name of the file to be locked, and the name of the lockfile will be  <i>filename</i> .lock.  However, if the --lock-name argument is specified, then  <i>filename</i> will be taken as the name of the lockfile itself.<div style="height: 1.00em;">
&#160;</div>
Each of the mail locking commands attempts to lock /var/spool/mail/&lt;user&gt;, where &lt;user&gt; is the name associated with the effective user ID, as determined by via geteuid(2).<div style="height: 1.00em;">
&#160;</div>
Once a file is locked, the lock must be touched at least once every five minutes or the lock will be considered stale, and subsequent lock attempts will succeed.  Also see the  <b>--use-pid</b> option and the  <b>lockfile_create</b>(3) manpage.<div style="height: 1.00em;">
&#160;</div>
The <b>lockfile-check</b> command tests whether or not a valid lock already exists.<div style="height: 1.00em;">
&#160;</div>
</div>
<div class="section">
<h1>OPTIONS</h1>  <b>-q</b>, <b>--quiet</b><div style="margin-left: 4.00ex;">
Suppress any output.  Success or failure will only be indicated by the exit status.</div>
<div class="spacer">
</div>
<b>-v</b>, <b>--verbose</b><div style="margin-left: 4.00ex;">
Enable diagnostic output.</div>
<div class="spacer">
</div>
<b>-l</b>, <b>--lock-name</b><div style="margin-left: 4.00ex;">
Do not append .lock to the <i>filename</i>.  This option applies to  <b>lockfile-create</b>, <b>lockfile-remove</b>, <b>lockfile-touch</b>, or  <b>lockfile-check</b>.</div>
<div class="spacer">
</div>
<b>-p</b>, <b>--use-pid</b><div style="margin-left: 4.00ex;">
Write the parent process id (PPID) to the lockfile whenever a lockfile is created, and use that pid when checking a lock's validity.  See the  <b>lockfile_create</b>(3) manpage for more information.  This option applies to  <b>lockfile-create</b> and <b>lockfile-check</b>.  NOTE: this option will not work correctly between machines sharing a filesystem.</div>
<div class="spacer">
</div>
<b>-o</b>, <b>--oneshot</b><div style="margin-left: 4.00ex;">
Touch the lock and exit immediately.  This option applies to  <b>lockfile-touch</b> and <b>mail-touchlock</b>.  When not provided, these commands will run forever, touching the lock once every minute until killed.</div>
<div class="spacer">
</div>
<b>-r</b> <i>retry-count</i>, <b>--retry</b> <i>retry-count</i><div style="margin-left: 4.00ex;">
Try to lock <i>filename</i> <i>retry-count</i> times before giving up. Each attempt will be delayed a bit longer than the last (in 5 second increments) until reaching a maximum delay of one minute between retries.  If  <i>retry-count</i> is unspecified, the default is 9 which will give up after 180 seconds (3 minutes) if all 9 lock attempts fail.<div style="height: 1.00em;">
&#160;</div>
</div>
</div>
<div class="section">
<h1>EXAMPLES</h1> <b>Locking a file during a lengthy process:</b><div style="height: 1.00em;">
&#160;</div>
<br/>
  lockfile-create /some/file<br/>
  lockfile-touch /some/file &amp;<br/>
  # Save the PID of the lockfile-touch process<br/>
  BADGER=&quot;$!&quot;<br/>
  do-something-important-with /some/file<br/>
  kill &quot;${BADGER}&quot;<br/>
  lockfile-remove /some/file<div style="height: 1.00em;">
&#160;</div>
</div>
<div class="section">
<h1>EXIT STATUS</h1>  <b>0</b><div style="margin-left: 4.00ex;">
For <b>lockfile-check</b> this indicates that a valid lock exists, otherwise it just indicates successful program execution.</div>
<div class="spacer">
</div>
<b>Not 0</b><div style="margin-left: 4.00ex;">
For <b>lockfile-check</b> a non-zero exit status indicates that the specified lock does not exist or is not valid.  For other programs it indicates that some problem was encountered.</div>
</div>
<div class="section">
<h1>SEE ALSO</h1><br/>
<b>maillock</b>(3)<br/>
<b>touchlock</b>(3)<br/>
<b>mailunlock</b>(3)<br/>
<b>lockfile_create</b>(3)<br/>
<b>lockfile_remove</b>(3)<br/>
<b>lockfile_touch</b>(3)<br/>
<b>lockfile_check</b>(3)<br/>
<div style="height: 1.00em;">
&#160;</div>
</div>
<div class="section">
<h1>AUTHOR</h1> Written by Rob Browning &lt;rlb@defaultvalue.org&gt;</div>
<table class="foot">
<tr>
<td class="foot-date">
2008-02-10</td>
<td class="foot-os">
0.1.12</td>
</tr>
</table>
</div>
</body>
</html>

