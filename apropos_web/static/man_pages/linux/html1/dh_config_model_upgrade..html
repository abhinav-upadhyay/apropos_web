<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/linux/style.css" type="text/css" media="all"/>
<title>
DH_CONFIG_MODEL_UPGRADE(1p)</title>
</head>
<body>
<div class="mandoc">
<table class="head">
<tbody>
<tr>
<td class="head-ltitle">
DH_CONFIG_MODEL_UPGRADE(1p)</td>
<td class="head-vol">
User Contributed Perl Documentation</td>
<td class="head-rtitle">
DH_CONFIG_MODEL_UPGRADE(1p)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1>NAME</h1> dh_config_model_upgrade - add Config::Model based configuration merge</div>
<div class="section">
<h1>SYNOPSIS</h1><br/>
 dh_config_model_upgrade [ debhelper options ] [ --model_name xx ] \<br/>
  [ --model_package xx [ --model_version yy ] ] \<br/>
  [ --edit_option &quot;...&quot; ] [ -p pkg ]<br/>
</div>
<div class="section">
<h1>DESCRIPTION</h1>  <b>dh_config_model_upgrade is experimental</b><div class="spacer">
</div>
dh_config_model_upgrade is a debhelper that will modify the package script to perform configuration merge on package upgrade. This merge is based on config-edit from Config::Model.<div class="spacer">
</div>
Model information can be specified by command options or a configuration file: &quot;debian/foo.config-model&quot;<div class="spacer">
</div>
A Model must be either :<dl>
<dt>
&#8226;</dt>
<dd>
Delivered in the package in &quot;debian/config-model/models/&quot; directory</dd>
</dl>
<dl>
<dt>
&#8226;</dt>
<dd>
Provided by another package</dd>
</dl>
</div>
<div class="section">
<h1>REQUIREMENTS</h1> For this program to work, package maintainer must ensure that:<dl>
<dt>
&#8226;</dt>
<dd>
ensure that *.postinst and *.config have a #DEBHELPER#  line (if these files exist)</dd>
</dl>
<dl>
<dt>
&#8226;</dt>
<dd>
ensure that control file has a dependency on ${misc:Depends}</dd>
</dl>
</div>
<div class="section">
<h1>OPTIONS</h1><div class="subsection">
<h2>--model_name XX</h2> Specifies the model name (a la &quot;Config::Model&quot;) that will be used to perform the upgrade. Without this information, &quot;dh_config_model_upgrade&quot; will do nothing. (shortcut &quot;--mn&quot;)</div>
<div class="subsection">
<h2>--model_for &quot;xx yy&quot;</h2> Specifies the package to act upon. Without this option, &quot;dh_config_model_upgrade&quot; will do nothing. To specify several packages, list the packages between quotes.  (shortcut &quot;--mf&quot;)</div>
<div class="subsection">
<h2>--model_package XX</h2> Specifies the debian package that provide the model specified bu &quot;-model_name&quot;. (shortcut &quot;--mp&quot;)</div>
<div class="subsection">
<h2>--model_version YY</h2> Specifies the minimal version of the package that provides the model. (shortcut &quot;--mv&quot;)</div>
<div class="subsection">
<h2>--edit_option &quot;...&quot;</h2> Specify a list of options or command that will be passed verbatim to config-edit during upgrade. Be sure to use quotes.</div>
<div class="subsection">
<h2>-p</h2> debhelper option to specify which package(s) to act on.</div>
</div>
<div class="section">
<h1>Usage</h1> &quot;dh_config_model_upgrade&quot; can be used with only command line options. For instance<div class="spacer">
</div>
<br/>
 dh_config_model_upgrade --model_name Sshd  -p openssh-server \<br/>
           --model_package lib-config-model-openssh-perl --model_version 1.206<br/>
<div class="spacer">
</div>
Alternatively, you can specify relevant information in configuration files. For instance:<div class="spacer">
</div>
<br/>
 $ cat debian/openssh-server.config-model<br/>
 model_name: Sshd<br/>
 model_package: lib-config-model-openssh-perl<br/>
 model_version: 1.206<br/>
 $ cat debian/openssh-client.config-model<br/>
 model_name: Ssh<br/>
 model_package: lib-config-model-openssh-perl<br/>
 model_version: 1.206<br/>
<div class="spacer">
</div>
In this case, &quot;dh_config_model_upgrade&quot; will be invoked this way<div class="spacer">
</div>
<br/>
 dh_config_model_upgrade<br/>
<div class="spacer">
</div>
If the model are delivered within the package, you will have to specify them in xx.install file.<div class="spacer">
</div>
Here's a example based on &quot;approx&quot; package where the model file and the parser/writer are delivered in approx package.<div class="spacer">
</div>
Debian dir contains:<div class="spacer">
</div>
<br/>
  debian/config-model/Approx.pm<br/>
  debian/config-model/models/Approx.pl<br/>
<div class="spacer">
</div>
&quot;debian/approx.install&quot; contains:<div class="spacer">
</div>
<br/>
  debian/config-model/Approx.pm usr/share/perl5/Config/Model<br/>
  debian/config-model/models/Approx.pl usr/share/perl5/Config/Model/models<br/>
<div class="spacer">
</div>
dh_config_model_upgrade is invoked as :<div class="spacer">
</div>
<br/>
  dh_config_model_upgrade -model_name Approx<br/>
</div>
<div class="section">
<h1>debian files setup</h1> &quot;dh_config_model_upgrade&quot; will work if:<dl>
<dt>
&#8226;</dt>
<dd>
&quot;control&quot; file contains a &quot;S{misc:Depends}&quot; variable in &quot;Depends&quot; line</dd>
</dl>
<dl>
<dt>
&#8226;</dt>
<dd>
&quot;rules&quot; contains a &quot;#DEBHELPER#&quot; line to insert generated postinst snippet</dd>
</dl>
</div>
<div class="section">
<h1>EXAMPLES</h1> &quot;dh_config_model_upgrade&quot; can be called in the rules file via the dh command (no options are possible, you will have to specify &quot;debian/*.config_model&quot; files):<div class="spacer">
</div>
<br/>
 %:<br/>
   dh --with config_model<br/>
<div class="spacer">
</div>
Or directly at the start of the build with<div class="spacer">
</div>
<br/>
 build:<br/>
   dh_config_model_upgrade -model_name FooBar<br/>
<div class="spacer">
</div>
Here's an example to avoid using Augeas when upgrading<div class="spacer">
</div>
<br/>
 build:<br/>
   dh_config_model_upgrade -model_name Sshd -edit_option &quot;-backend custom&quot;<br/>
</div>
<div class="section">
<h1>CAVEATS</h1> Using options with a single dash (e.g. &quot;-model_name&quot; instead of &quot;--model_name&quot;) will lead to &quot;&quot;Unknown option&quot;&quot; errors.</div>
<div class="section">
<h1>ENVIRONMENT</h1> This program will  <i>exit</i>(0) if &quot;DH_NO_ACT&quot; is set or if &quot;DEB_BUILD_OPTIONS&quot; contains &quot;noconfigmodel&quot;.</div>
<div class="section">
<h1>SEE ALSO</h1> debhelper<div class="spacer">
</div>
This program is an addendum to debhelper (part of libconfig-model-perl).</div>
<div class="section">
<h1>AUTHOR</h1> Dominique Dumont &lt;dod@debian.org&gt;</div>
<table class="foot">
<tr>
<td class="foot-date">
2012-02-24</td>
<td class="foot-os">
perl v5.14.2</td>
</tr>
</table>
</div>
</body>
</html>

