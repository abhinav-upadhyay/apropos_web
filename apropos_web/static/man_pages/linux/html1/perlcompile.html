<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/linux/style.css" type="text/css" media="all"/>
<title>
PERLCOMPILE(1)</title>
</head>
<body>
<div class="mandoc">
<table class="head">
<tbody>
<tr>
<td class="head-ltitle">
PERLCOMPILE(1)</td>
<td class="head-vol">
Perl Programmers Reference Guide</td>
<td class="head-rtitle">
PERLCOMPILE(1)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1>NAME</h1> perlcompile - Introduction to the Perl Compiler-Translator</div>
<div class="section">
<h1>DESCRIPTION</h1> Perl has always had a compiler: your source is compiled into an internal form (a parse tree) which is then optimized before being run.  Since version 5.005, Perl has shipped with a module capable of inspecting the optimized parse tree (&quot;B&quot;), and this has been used to write many useful utilities, including a module that lets you turn your Perl into C source code that can be compiled into a native executable.<div class="spacer">
</div>
The &quot;B&quot; module provides access to the parse tree, and other modules (&quot;back ends&quot;) do things with the tree.  Some write it out as semi-human-readable text.  Another traverses the parse tree to build a cross-reference of which subroutines, formats, and variables are used where.  Another checks your code for dubious constructs.  Yet another back end dumps the parse tree back out as Perl source, acting as a source code beautifier or deobfuscator.<div class="spacer">
</div>
Because its original purpose was to be a way to produce C code corresponding to a Perl program, and in turn a native executable, the &quot;B&quot; module and its associated back ends are known as &quot;the compiler&quot;, even though they don't really compile anything. Different parts of the compiler are more accurately a &quot;translator&quot;, or an &quot;inspector&quot;, but people want Perl to have a &quot;compiler option&quot; not an &quot;inspector gadget&quot;.  What can you do?<div class="spacer">
</div>
This document covers the use of the Perl compiler: which modules it comprises, how to use the most important of the back end modules, what problems there are, and how to work around them.<div class="subsection">
<h2>Layout</h2> The compiler back ends are in the &quot;B::&quot; hierarchy, and the front-end (the module that you, the user of the compiler, will sometimes interact with) is the O module.<div class="spacer">
</div>
Here are the important back ends to know about, with their status expressed as a number from 0 (outline for later implementation) to 10 (if there's a bug in it, we're very surprised):<dl>
<dt>
B::Lint</dt>
<dd>
Complains if it finds dubious constructs in your source code.  Status: 6 (it works adequately, but only has a very limited number of areas that it checks).</dd>
</dl>
<dl>
<dt>
B::Deparse</dt>
<dd>
Recreates the Perl source, making an attempt to format it coherently. Status: 8 (it works nicely, but a few obscure things are missing).</dd>
</dl>
<dl>
<dt>
B::Xref</dt>
<dd>
Reports on the declaration and use of subroutines and variables. Status: 8 (it works nicely, but still has a few lingering bugs).</dd>
</dl>
</div>
</div>
<div class="section">
<h1>Using The Back Ends</h1> The following sections describe how to use the various compiler back ends.  They're presented roughly in order of maturity, so that the most stable and proven back ends are described first, and the most experimental and incomplete back ends are described last.<div class="spacer">
</div>
The O module automatically enabled the <b>-c</b> flag to Perl, which prevents Perl from executing your code once it has been compiled. This is why all the back ends print:<div class="spacer">
</div>
<br/>
  myperlprogram syntax OK<br/>
<div class="spacer">
</div>
before producing any other output.<div class="subsection">
<h2>The Cross-Referencing Back End</h2> The cross-referencing back end (B::Xref) produces a report on your program, breaking down declarations and uses of subroutines and variables (and formats) by file and subroutine.  For instance, here's part of the report from the  <i>pod2man</i> program that comes with Perl:<div class="spacer">
</div>
<br/>
  Subroutine clear_noremap<br/>
    Package (lexical)<br/>
      $ready_to_print   i1069, 1079<br/>
    Package main<br/>
      $&amp;                1086<br/>
      $.                1086<br/>
      $0                1086<br/>
      $1                1087<br/>
      $2                1085, 1085<br/>
      $3                1085, 1085<br/>
      $ARGV             1086<br/>
      %HTML_Escapes     1085, 1085<br/>
<div class="spacer">
</div>
This shows the variables used in the subroutine &quot;clear_noremap&quot;.  The variable $ready_to_print is a  <i>my()</i> (lexical) variable,  <b>i</b>ntroduced (first declared with <i>my()</i>) on line 1069, and used on line 1079.  The variable $&amp; from the main package is used on 1086, and so on.<div class="spacer">
</div>
A line number may be prefixed by a single letter:<dl>
<dt>
i</dt>
<dd>
Lexical variable introduced (declared with <i>my()</i>) for the first time.</dd>
</dl>
<dl>
<dt>
&amp;</dt>
<dd>
Subroutine or method call.</dd>
</dl>
<dl>
<dt>
s</dt>
<dd>
Subroutine defined.</dd>
</dl>
<dl>
<dt>
r</dt>
<dd>
Format defined.</dd>
</dl>
<div class="spacer">
</div>
The most useful option the cross referencer has is to save the report to a separate file.  For instance, to save the report on  <i>myperlprogram</i> to the file <i>report</i>:<div class="spacer">
</div>
<br/>
  $ perl -MO=Xref,-oreport myperlprogram<br/>
</div>
<div class="subsection">
<h2>The Decompiling Back End</h2> The Deparse back end turns your Perl source back into Perl source.  It can reformat along the way, making it useful as a deobfuscator.  The most basic way to use it is:<div class="spacer">
</div>
<br/>
  $ perl -MO=Deparse myperlprogram<br/>
<div class="spacer">
</div>
You'll notice immediately that Perl has no idea of how to paragraph your code.  You'll have to separate chunks of code from each other with newlines by hand.  However, watch what it will do with one-liners:<div class="spacer">
</div>
<br/>
  $ perl -MO=Deparse -e '$op=shift||die &quot;usage: $0<br/>
  code [...]&quot;;chomp(@ARGV=&lt;&gt;)unless@ARGV; for(@ARGV){$was=$_;eval$op;<br/>
  die$@ if$@; rename$was,$_ unless$was eq $_}'<br/>
  -e syntax OK<br/>
  $op = shift @ARGV || die(&quot;usage: $0 code [...]&quot;);<br/>
  chomp(@ARGV = &lt;ARGV&gt;) unless @ARGV;<br/>
  foreach $_ (@ARGV) {<br/>
      $was = $_;<br/>
      eval $op;<br/>
      die $@ if $@;<br/>
      rename $was, $_ unless $was eq $_;<br/>
  }<br/>
<div class="spacer">
</div>
The decompiler has several options for the code it generates.  For instance, you can set the size of each indent from 4 (as above) to 2 with:<div class="spacer">
</div>
<br/>
  $ perl -MO=Deparse,-si2 myperlprogram<br/>
<div class="spacer">
</div>
The <b>-p</b> option adds parentheses where normally they are omitted:<div class="spacer">
</div>
<br/>
  $ perl -MO=Deparse -e 'print &quot;Hello, world\n&quot;'<br/>
  -e syntax OK<br/>
  print &quot;Hello, world\n&quot;;<br/>
  $ perl -MO=Deparse,-p -e 'print &quot;Hello, world\n&quot;'<br/>
  -e syntax OK<br/>
  print(&quot;Hello, world\n&quot;);<br/>
<div class="spacer">
</div>
See B::Deparse for more information on the formatting options.</div>
<div class="subsection">
<h2>The Lint Back End</h2> The lint back end (B::Lint) inspects programs for poor style.  One programmer's bad style is another programmer's useful tool, so options let you select what is complained about.<div class="spacer">
</div>
To run the style checker across your source code:<div class="spacer">
</div>
<br/>
  $ perl -MO=Lint myperlprogram<br/>
<div class="spacer">
</div>
To disable context checks and undefined subroutines:<div class="spacer">
</div>
<br/>
  $ perl -MO=Lint,-context,-undefined-subs myperlprogram<br/>
<div class="spacer">
</div>
See B::Lint for information on the options.</div>
</div>
<div class="section">
<h1>Module List for the Compiler Suite</h1><dl>
<dt>
B</dt>
<dd>
This module is the introspective (&quot;reflective&quot; in Java terms) module, which allows a Perl program to inspect its innards.  The back end modules all use this module to gain access to the compiled parse tree.  You, the user of a back end module, will not need to interact with B.</dd>
</dl>
<dl>
<dt>
O</dt>
<dd>
This module is the front-end to the compiler's back ends.  Normally called something like this:<div style="height: 1.00em;">
&#160;</div>
<br/>
  $ perl -MO=Deparse myperlprogram<br/>
<div style="height: 1.00em;">
&#160;</div>
This is like saying &quot;use O 'Deparse'&quot; in your Perl program.</dd>
</dl>
<dl>
<dt>
B::Concise</dt>
<dd>
This module prints a concise (but complete) version of the Perl parse tree.  Its output is more customizable than the one of B::Terse or B::Debug (and it can emulate them). This module is useful for people who are writing their own back end, or who are learning about the Perl internals.  It's not useful to the average programmer.</dd>
</dl>
<dl>
<dt>
B::Debug</dt>
<dd>
This module dumps the Perl parse tree in verbose detail to STDOUT. It's useful for people who are writing their own back end, or who are learning about the Perl internals.  It's not useful to the average programmer.</dd>
</dl>
<dl>
<dt>
B::Deparse</dt>
<dd>
This module produces Perl source code from the compiled parse tree. It is useful in debugging and deconstructing other people's code, also as a pretty-printer for your own source.  See &quot;The Decompiling Back End&quot; for details about usage.</dd>
</dl>
<dl>
<dt>
B::Lint</dt>
<dd>
This module inspects the compiled form of your source code for things which, while some people frown on them, aren't necessarily bad enough to justify a warning.  For instance, use of an array in scalar context without explicitly saying &quot;scalar(@array)&quot; is something that Lint can identify.  See &quot;The Lint Back End&quot; for details about usage.</dd>
</dl>
<dl>
<dt>
B::Showlex</dt>
<dd>
This module prints out the <i>my()</i> variables used in a function or a file.  To get a list of the  <i>my()</i> variables used in the subroutine  <i>mysub()</i> defined in the file myperlprogram:<div style="height: 1.00em;">
&#160;</div>
<br/>
  $ perl -MO=Showlex,mysub myperlprogram<br/>
<div style="height: 1.00em;">
&#160;</div>
To get a list of the <i>my()</i> variables used in the file myperlprogram:<div style="height: 1.00em;">
&#160;</div>
<br/>
  $ perl -MO=Showlex myperlprogram<br/>
<div style="height: 1.00em;">
&#160;</div>
[BROKEN]</dd>
</dl>
<dl>
<dt>
B::Terse</dt>
<dd>
This module prints the contents of the parse tree, but without as much information as B::Debug.  For comparison, &quot;print &quot;Hello, world.&quot;&quot; produced 96 lines of output from B::Debug, but only 6 from B::Terse.<div style="height: 1.00em;">
&#160;</div>
This module is useful for people who are writing their own back end, or who are learning about the Perl internals.  It's not useful to the average programmer.</dd>
</dl>
<dl>
<dt>
B::Xref</dt>
<dd>
This module prints a report on where the variables, subroutines, and formats are defined and used within a program and the modules it loads.  See &quot;The Cross-Referencing Back End&quot; for details about usage.</dd>
</dl>
</div>
<div class="section">
<h1>KNOWN PROBLEMS</h1> BEGIN{} blocks are executed while compiling your code.  Any external state that is initialized in BEGIN{}, such as opening files, initiating database connections etc., do not behave properly.  To work around this, Perl has an INIT{} block that corresponds to code being executed before your program begins running but after your program has finished being compiled.  Execution order: BEGIN{}, (possible save of state through compiler back-end), INIT{}, program runs, END{}.</div>
<div class="section">
<h1>AUTHOR</h1> This document was originally written by Nathan Torkington, and is now maintained by the perl5-porters mailing list  <i>perl5-porters@perl.org</i>.</div>
<table class="foot">
<tr>
<td class="foot-date">
2011-09-26</td>
<td class="foot-os">
perl v5.14.2</td>
</tr>
</table>
</div>
</body>
</html>

