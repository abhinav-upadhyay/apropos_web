<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/linux/style.css" type="text/css" media="all"/>
<title>
GIT-UPDATE-REF(1)</title>
</head>
<body>
<div class="mandoc">
<table class="head">
<tbody>
<tr>
<td class="head-ltitle">
GIT-UPDATE-REF(1)</td>
<td class="head-vol">
Git Manual</td>
<td class="head-rtitle">
GIT-UPDATE-REF(1)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1>NAME</h1> git-update-ref - Update the object name stored in a ref safely</div>
<div class="section">
<h1>SYNOPSIS</h1><br/>
<i>git update-ref</i> [-m &lt;reason&gt;] (-d &lt;ref&gt; [&lt;oldvalue&gt;] | [--no-deref] [--create-reflog] &lt;ref&gt; &lt;newvalue&gt; [&lt;oldvalue&gt;] | --stdin [-z])<br/>
<div style="height: 1.00em;">
&#160;</div>
</div>
<div class="section">
<h1>DESCRIPTION</h1> Given two arguments, stores the &lt;newvalue&gt; in the &lt;ref&gt;, possibly dereferencing the symbolic refs. E.g. git update-ref HEAD &lt;newvalue&gt; updates the current branch head to the new object.<div style="height: 1.00em;">
&#160;</div>
Given three arguments, stores the &lt;newvalue&gt; in the &lt;ref&gt;, possibly dereferencing the symbolic refs, after verifying that the current value of the &lt;ref&gt; matches &lt;oldvalue&gt;. E.g. git update-ref refs/heads/master &lt;newvalue&gt; &lt;oldvalue&gt; updates the master branch head to &lt;newvalue&gt; only if its current value is &lt;oldvalue&gt;. You can specify 40 &quot;0&quot; or an empty string as &lt;oldvalue&gt; to make sure that the ref you are creating does not exist.<div style="height: 1.00em;">
&#160;</div>
It also allows a &quot;ref&quot; file to be a symbolic pointer to another ref file by starting with the four-byte header sequence of &quot;ref:&quot;.<div style="height: 1.00em;">
&#160;</div>
More importantly, it allows the update of a ref file to follow these symbolic pointers, whether they are symlinks or these &quot;regular file symbolic refs&quot;. It follows <b>real</b> symlinks only if they start with &quot;refs/&quot;: otherwise it will just try to read them and update them as a regular file (i.e. it will allow the filesystem to follow them, but will overwrite such a symlink to somewhere else with a regular filename).<div style="height: 1.00em;">
&#160;</div>
If --no-deref is given, &lt;ref&gt; itself is overwritten, rather than the result of following the symbolic pointers.<div style="height: 1.00em;">
&#160;</div>
In general, using<div style="height: 1.00em;">
&#160;</div>
<div style="margin-left: 4.00ex;">
<br/>
git update-ref HEAD &quot;$head&quot;<br/>
</div>
<div style="height: 1.00em;">
&#160;</div>
should be a <i>lot</i> safer than doing<div style="height: 1.00em;">
&#160;</div>
<div style="margin-left: 4.00ex;">
<br/>
echo &quot;$head&quot; &gt; &quot;$GIT_DIR/HEAD&quot;<br/>
</div>
<div style="height: 1.00em;">
&#160;</div>
both from a symlink following standpoint <b>and</b> an error checking standpoint. The &quot;refs/&quot; rule for symlinks means that symlinks that point to &quot;outside&quot; the tree are safe: they&#8217;ll be followed for reading but not for writing (so we&#8217;ll never write through a ref symlink to some other tree, if you have copied a whole archive by creating a symlink tree).<div style="height: 1.00em;">
&#160;</div>
With -d flag, it deletes the named &lt;ref&gt; after verifying it still contains &lt;oldvalue&gt;.<div style="height: 1.00em;">
&#160;</div>
With --stdin, update-ref reads instructions from standard input and performs all modifications together. Specify commands of the form:<div style="height: 1.00em;">
&#160;</div>
<div style="margin-left: 4.00ex;">
<br/>
update SP &lt;ref&gt; SP &lt;newvalue&gt; [SP &lt;oldvalue&gt;] LF<br/>
create SP &lt;ref&gt; SP &lt;newvalue&gt; LF<br/>
delete SP &lt;ref&gt; [SP &lt;oldvalue&gt;] LF<br/>
verify SP &lt;ref&gt; [SP &lt;oldvalue&gt;] LF<br/>
option SP &lt;opt&gt; LF<br/>
</div>
<div style="height: 1.00em;">
&#160;</div>
With --create-reflog, update-ref will create a reflog for each ref even if one would not ordinarily be created.<div style="height: 1.00em;">
&#160;</div>
Quote fields containing whitespace as if they were strings in C source code; i.e., surrounded by double-quotes and with backslash escapes. Use 40 &quot;0&quot; characters or the empty string to specify a zero value. To specify a missing value, omit the value and its preceding SP entirely.<div style="height: 1.00em;">
&#160;</div>
Alternatively, use -z to specify in NUL-terminated format, without quoting:<div style="height: 1.00em;">
&#160;</div>
<div style="margin-left: 4.00ex;">
<br/>
update SP &lt;ref&gt; NUL &lt;newvalue&gt; NUL [&lt;oldvalue&gt;] NUL<br/>
create SP &lt;ref&gt; NUL &lt;newvalue&gt; NUL<br/>
delete SP &lt;ref&gt; NUL [&lt;oldvalue&gt;] NUL<br/>
verify SP &lt;ref&gt; NUL [&lt;oldvalue&gt;] NUL<br/>
option SP &lt;opt&gt; NUL<br/>
</div>
<div style="height: 1.00em;">
&#160;</div>
In this format, use 40 &quot;0&quot; to specify a zero value, and use the empty string to specify a missing value.<div style="height: 1.00em;">
&#160;</div>
In either format, values can be specified in any form that Git recognizes as an object name. Commands in any other format or a repeated &lt;ref&gt; produce an error. Command meanings are:<div class="spacer">
</div>
update<div style="margin-left: 4.00ex;">
Set &lt;ref&gt; to &lt;newvalue&gt; after verifying &lt;oldvalue&gt;, if given. Specify a zero &lt;newvalue&gt; to ensure the ref does not exist after the update and/or a zero &lt;oldvalue&gt; to make sure the ref does not exist before the update.</div>
<div class="spacer">
</div>
create<div style="margin-left: 4.00ex;">
Create &lt;ref&gt; with &lt;newvalue&gt; after verifying it does not exist. The given &lt;newvalue&gt; may not be zero.</div>
<div class="spacer">
</div>
delete<div style="margin-left: 4.00ex;">
Delete &lt;ref&gt; after verifying it exists with &lt;oldvalue&gt;, if given. If given, &lt;oldvalue&gt; may not be zero.</div>
<div class="spacer">
</div>
verify<div style="margin-left: 4.00ex;">
Verify &lt;ref&gt; against &lt;oldvalue&gt; but do not change it. If &lt;oldvalue&gt; zero or missing, the ref must not exist.</div>
<div class="spacer">
</div>
option<div style="margin-left: 4.00ex;">
Modify behavior of the next command naming a &lt;ref&gt;. The only valid option is no-deref to avoid dereferencing a symbolic ref.</div>
<div style="height: 1.00em;">
&#160;</div>
If all &lt;ref&gt;s can be locked with matching &lt;oldvalue&gt;s simultaneously, all modifications are performed. Otherwise, no modifications are performed. Note that while each individual &lt;ref&gt; is updated or deleted atomically, a concurrent reader may still see a subset of the modifications.</div>
<div class="section">
<h1>LOGGING UPDATES</h1> If config parameter &quot;core.logAllRefUpdates&quot; is true and the ref is one under &quot;refs/heads/&quot;, &quot;refs/remotes/&quot;, &quot;refs/notes/&quot;, or the symbolic ref HEAD; or the file &quot;$GIT_DIR/logs/&lt;ref&gt;&quot; exists then git update-ref will append a line to the log file &quot;$GIT_DIR/logs/&lt;ref&gt;&quot; (dereferencing all symbolic refs before creating the log name) describing the change in ref value. Log lines are formatted as:<div style="height: 1.00em;">
&#160;</div>
<div style="margin-left: 4.00ex;">
 1.oldsha1 SP newsha1 SP committer LF<div style="height: 1.00em;">
&#160;</div>
Where &quot;oldsha1&quot; is the 40 character hexadecimal value previously stored in &lt;ref&gt;, &quot;newsha1&quot; is the 40 character hexadecimal value of &lt;newvalue&gt; and &quot;committer&quot; is the committer&#8217;s name, email address and date in the standard Git committer ident format.</div>
<div style="height: 1.00em;">
&#160;</div>
Optionally with -m:<div style="height: 1.00em;">
&#160;</div>
<div style="margin-left: 4.00ex;">
 1.oldsha1 SP newsha1 SP committer TAB message LF<div style="height: 1.00em;">
&#160;</div>
Where all fields are as described above and &quot;message&quot; is the value supplied to the -m option.</div>
<div style="height: 1.00em;">
&#160;</div>
An update will fail (without changing &lt;ref&gt;) if the current user is unable to create a new log file, append to the existing log file or does not have committer information available.</div>
<div class="section">
<h1>GIT</h1> Part of the  <b>git</b>(1) suite</div>
<table class="foot">
<tr>
<td class="foot-date">
04/03/2016</td>
<td class="foot-os">
Git 2.8.1</td>
</tr>
</table>
</div>
</body>
</html>

