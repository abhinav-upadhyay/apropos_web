<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/linux/style.css" type="text/css" media="all"/>
<title>
SSH-VULNKEY(1)</title>
</head>
<body>
<div class="mandoc">
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">ssh-vulnkey</b> &#8212; <span class="desc">check blacklist of compromised keys</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1><table class="synopsis">
<col style="width: 11.00ex;"/>
<col/>
<tbody>
<tr>
<td>
ssh-vulnkey</td>
<td>
[<span class="opt"><b class="flag">-q</b> | <b class="flag">-v</b></span>] <i class="arg">file ...</i></td>
</tr>
</tbody>
</table>
<br/>
<table class="synopsis">
<col style="width: 11.00ex;"/>
<col/>
<tbody>
<tr>
<td>
ssh-vulnkey</td>
<td>
<b class="flag">-a</b></td>
</tr>
</tbody>
</table>
</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> <b class="name">ssh-vulnkey</b> checks a key against a blacklist of compromised keys.<div class="spacer">
</div>
A substantial number of keys are known to have been generated using a broken version of OpenSSL distributed by Debian which failed to seed its random number generator correctly. Keys generated using these OpenSSL versions should be assumed to be compromised. This tool may be useful in checking for such keys.<div class="spacer">
</div>
Keys that are compromised cannot be repaired; replacements must be generated using <a class="link-man" href="/man/linux/1/ssh-keygen">ssh-keygen(1)</a>. Make sure to update <i class="file">authorized_keys</i> files on all systems where compromised keys were permitted to authenticate.<div class="spacer">
</div>
The argument list will be interpreted as a list of paths to public key files or <i class="file">authorized_keys</i> files. If no suitable file is found at a given path, <b class="name">ssh-vulnkey</b> will append <i class="file">.pub</i> and retry, in case it was given a private key file. If no files are given as arguments, <b class="name">ssh-vulnkey</b> will check <i class="file">~/.ssh/id_rsa</i>, <i class="file">~/.ssh/id_dsa</i>, <i class="file">~/.ssh/identity</i>, <i class="file">~/.ssh/authorized_keys</i> and <i class="file">~/.ssh/authorized_keys2</i>, as well as the system's host keys if readable.<div class="spacer">
</div>
If &#8220;-&#8221; is given as an argument, <b class="name">ssh-vulnkey</b> will read from standard input. This can be used to process output from <a class="link-man" href="/man/linux/1/ssh-keyscan">ssh-keyscan(1)</a>, for example:<div class="spacer">
</div>
<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit">$ ssh-keyscan -t rsa remote.example.org | ssh-vulnkey -</code></div>
</blockquote>
<div class="spacer">
</div>
Unless the <b class="flag">PermitBlacklistedKeys</b> option is used, <a class="link-man" href="/man/linux/8/sshd">sshd(8)</a> will reject attempts to authenticate with keys in the compromised list.<div class="spacer">
</div>
The output from <b class="name">ssh-vulnkey</b> looks like this:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
/etc/ssh/ssh_host_key:1: COMPROMISED: RSA1 2048 xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx root@host 
/home/user/.ssh/id_dsa:1: Not blacklisted: DSA 1024 xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx /home/user/.ssh/id_dsa.pub 
/home/user/.ssh/authorized_keys:3: Unknown (blacklist file not installed): RSA 1024 xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx user@host</pre>
<div class="spacer">
</div>
Each line is of the following format (any lines beginning with &#8220;#&#8221; should be ignored by scripts):<div class="spacer">
</div>
<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit"><i class="arg">filename</i>:<i class="arg">line</i>: <i class="arg">status</i>: <i class="arg">type</i> <i class="arg">size</i> <i class="arg">fingerprint</i> <i class="arg">comment</i></code></div>
</blockquote>
<div class="spacer">
</div>
It is important to distinguish between the possible values of <i class="arg">status</i>:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
COMPROMISED</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
These keys are listed in a blacklist file, normally because their corresponding private keys are well-known. Replacements must be generated using <a class="link-man" href="/man/linux/1/ssh-keygen">ssh-keygen(1)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
Not blacklisted</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
A blacklist file exists for this key type and size, but this key is not listed in it. Unless there is some particular reason to believe otherwise, this key may be used safely. (Note that DSA keys used with the broken version of OpenSSL distributed by Debian may be compromised in the event that anyone captured a network trace, even if they were generated with a secure version of OpenSSL.)</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
Unknown (blacklist file not installed)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
No blacklist file exists for this key type and size. You should find a suitable published blacklist and install it before deciding whether this key is safe to use.</dd>
</dl>
<div class="spacer">
</div>
The options are as follows:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-a</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Check keys of all users on the system. You will typically need to run <b class="name">ssh-vulnkey</b> as root to use this option. For each user, <b class="name">ssh-vulnkey</b> will check <i class="file">~/.ssh/id_rsa</i>, <i class="file">~/.ssh/id_dsa</i>, <i class="file">~/.ssh/identity</i>, <i class="file">~/.ssh/authorized_keys</i> and <i class="file">~/.ssh/authorized_keys2</i>. It will also check the system's host keys.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-q</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Quiet mode. Normally, <b class="name">ssh-vulnkey</b> outputs the fingerprint of each key scanned, with a description of its status. This option suppresses that output.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">-v</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Verbose mode. Normally, <b class="name">ssh-vulnkey</b> does not output anything for keys that are not listed in their corresponding blacklist file (although it still produces output for keys for which there is no blacklist file, since their status is unknown). This option causes <b class="name">ssh-vulnkey</b> to produce output for all keys.</dd>
</dl>
</div>
<div class="section">
<h1 id="x4558495420535441545553">EXIT STATUS</h1> <b class="name">ssh-vulnkey</b> will exit zero if any of the given keys were in the compromised list, otherwise non-zero.</div>
<div class="section">
<h1 id="x424c41434b4c4953542046494c4520464f524d4154">BLACKLIST FILE FORMAT</h1> The blacklist file may start with comments, on lines starting with &#8220;#&#8221;. After these initial comments, it must follow a strict format:<div class="spacer">
</div>
<ul style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 6.00ex;" class="list list-bul">
<li class="list-bul" style="margin-top: 0.00em;">
All the lines must be exactly the same length (20 characters followed by a newline) and must be in sorted order.</li>
<li class="list-bul" style="margin-top: 0.00em;">
Each line must consist of the lower-case hexadecimal MD5 key fingerprint, without colons, and with the first 12 characters removed (that is, the least significant 80 bits of the fingerprint).</li>
</ul>
<div class="spacer">
</div>
The key fingerprint may be generated using <a class="link-man" href="/man/linux/1/ssh-keygen">ssh-keygen(1)</a>:<div class="spacer">
</div>
<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit">$ ssh-keygen -l -f /path/to/key</code></div>
</blockquote>
<div class="spacer">
</div>
This strict format is necessary to allow the blacklist file to be checked quickly, using a binary-search algorithm.</div>
<div class="section">
<h1 id="x46494c4553">FILES</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="file">~/.ssh/id_rsa</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
If present, contains the protocol version 2 RSA authentication identity of the user.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="file">~/.ssh/id_dsa</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
If present, contains the protocol version 2 DSA authentication identity of the user.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="file">~/.ssh/identity</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
If present, contains the protocol version 1 RSA authentication identity of the user.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="file">~/.ssh/authorized_keys</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
If present, lists the public keys (RSA/DSA) that can be used for logging in as this user.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="file">~/.ssh/authorized_keys2</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Obsolete name for <i class="file">~/.ssh/authorized_keys</i>. This file may still be present on some old systems, but should not be created if it is missing.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="file">/etc/ssh/ssh_host_rsa_key</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
If present, contains the protocol version 2 RSA identity of the system.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="file">/etc/ssh/ssh_host_dsa_key</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
If present, contains the protocol version 2 DSA identity of the system.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="file">/etc/ssh/ssh_host_key</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
If present, contains the protocol version 1 RSA identity of the system.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="file">/usr/share/ssh/blacklist.</i><i class="arg">TYPE</i><i class="file">-</i><i class="arg">LENGTH</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
If present, lists the blacklisted keys of type <i class="arg">TYPE</i> (&#8220;RSA&#8221; or &#8220;DSA&#8221;) and bit length <i class="arg">LENGTH</i>. The format of this file is described above. RSA1 keys are converted to RSA before being checked in the blacklist. Note that the fingerprints of RSA1 keys are computed differently, so you will not be able to find them in the blacklist by hand.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="file">/etc/ssh/blacklist.</i><i class="arg">TYPE</i><i class="file">-</i><i class="arg">LENGTH</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Same as <i class="file">/usr/share/ssh/blacklist.</i><i class="arg">TYPE</i><i class="file">-</i><i class="arg">LENGTH</i>, but may be edited by the system administrator to add new blacklist entries.</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="/man/linux/1/ssh-keygen">ssh-keygen(1)</a>, <a class="link-man" href="/man/linux/8/sshd">sshd(8)</a></div>
<div class="section">
<h1 id="x415554484f5253">AUTHORS</h1> <span class="author">Colin Watson</span> &#10216;cjwatson@ubuntu.com&#10217;<div class="spacer">
</div>
Florian Weimer suggested the option to check keys of all users, and the idea of processing <a class="link-man" href="/man/linux/1/ssh-keyscan">ssh-keyscan(1)</a> output.</div>
</div>
</body>
</html>

