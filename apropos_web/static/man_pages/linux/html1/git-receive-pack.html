<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/linux/style.css" type="text/css" media="all"/>
<title>
GIT-RECEIVE-PACK(1)</title>
</head>
<body>
<div class="mandoc">
<table class="head">
<tbody>
<tr>
<td class="head-ltitle">
GIT-RECEIVE-PACK(1)</td>
<td class="head-vol">
Git Manual</td>
<td class="head-rtitle">
GIT-RECEIVE-PACK(1)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1>NAME</h1> git-receive-pack - Receive what is pushed into the repository</div>
<div class="section">
<h1>SYNOPSIS</h1><br/>
<i>git-receive-pack</i> &lt;directory&gt;<br/>
<div style="height: 1.00em;">
&#160;</div>
</div>
<div class="section">
<h1>DESCRIPTION</h1> Invoked by  <i>git send-pack</i> and updates the repository with the information fed from the remote end.<div style="height: 1.00em;">
&#160;</div>
This command is usually not invoked directly by the end user. The UI for the protocol is on the <i>git send-pack</i> side, and the program pair is meant to be used to push updates to remote repository. For pull operations, see <b>git-fetch-pack</b>(1).<div style="height: 1.00em;">
&#160;</div>
The command allows for creation and fast-forwarding of sha1 refs (heads/tags) on the remote end (strictly speaking, it is the local end <i>git-receive-pack</i> runs, but to the user who is sitting at the send-pack end, it is updating the remote. Confused?)<div style="height: 1.00em;">
&#160;</div>
There are other real-world examples of using update and post-update hooks found in the Documentation/howto directory.<div style="height: 1.00em;">
&#160;</div>
<i>git-receive-pack</i> honours the receive.denyNonFastForwards config option, which tells it if updates to a ref should be denied if they are not fast-forwards.</div>
<div class="section">
<h1>OPTIONS</h1> &lt;directory&gt;<div style="margin-left: 4.00ex;">
The repository to sync into.</div>
</div>
<div class="section">
<h1>PRE-RECEIVE HOOK</h1> Before any ref is updated, if $GIT_DIR/hooks/pre-receive file exists and is executable, it will be invoked once with no parameters. The standard input of the hook will be one line per ref to be updated:<div style="height: 1.00em;">
&#160;</div>
<div style="margin-left: 4.00ex;">
<br/>
sha1-old SP sha1-new SP refname LF<br/>
</div>
<div style="height: 1.00em;">
&#160;</div>
The refname value is relative to $GIT_DIR; e.g. for the master head this is &quot;refs/heads/master&quot;. The two sha1 values before each refname are the object names for the refname before and after the update. Refs to be created will have sha1-old equal to 0{40}, while refs to be deleted will have sha1-new equal to 0{40}, otherwise sha1-old and sha1-new should be valid objects in the repository.<div style="height: 1.00em;">
&#160;</div>
When accepting a signed push (see <b>git-push</b>(1)), the signed push certificate is stored in a blob and an environment variable GIT_PUSH_CERT can be consulted for its object name. See the description of post-receive hook for an example. In addition, the certificate is verified using GPG and the result is exported with the following environment variables:<div class="spacer">
</div>
GIT_PUSH_CERT_SIGNER<div style="margin-left: 4.00ex;">
The name and the e-mail address of the owner of the key that signed the push certificate.</div>
<div class="spacer">
</div>
GIT_PUSH_CERT_KEY<div style="margin-left: 4.00ex;">
The GPG key ID of the key that signed the push certificate.</div>
<div class="spacer">
</div>
GIT_PUSH_CERT_STATUS<div style="margin-left: 4.00ex;">
The status of GPG verification of the push certificate, using the same mnemonic as used in %G? format of git log family of commands (see  <b>git-log</b>(1)).</div>
<div class="spacer">
</div>
GIT_PUSH_CERT_NONCE<div style="margin-left: 4.00ex;">
The nonce string the process asked the signer to include in the push certificate. If this does not match the value recorded on the &quot;nonce&quot; header in the push certificate, it may indicate that the certificate is a valid one that is being replayed from a separate &quot;git push&quot; session.</div>
<div class="spacer">
</div>
GIT_PUSH_CERT_NONCE_STATUS<div style="margin-left: 4.00ex;">
<div class="spacer">
</div>
UNSOLICITED<div style="margin-left: 4.00ex;">
&quot;git push --signed&quot; sent a nonce when we did not ask it to send one.</div>
<div class="spacer">
</div>
MISSING<div style="margin-left: 4.00ex;">
&quot;git push --signed&quot; did not send any nonce header.</div>
<div class="spacer">
</div>
BAD<div style="margin-left: 4.00ex;">
&quot;git push --signed&quot; sent a bogus nonce.</div>
<div class="spacer">
</div>
OK<div style="margin-left: 4.00ex;">
&quot;git push --signed&quot; sent the nonce we asked it to send.</div>
<div class="spacer">
</div>
SLOP<div style="margin-left: 4.00ex;">
&quot;git push --signed&quot; sent a nonce different from what we asked it to send now, but in a previous session. See GIT_PUSH_CERT_NONCE_SLOP environment variable.</div>
</div>
<div class="spacer">
</div>
GIT_PUSH_CERT_NONCE_SLOP<div style="margin-left: 4.00ex;">
&quot;git push --signed&quot; sent a nonce different from what we asked it to send now, but in a different session whose starting time is different by this many seconds from the current session. Only meaningful when GIT_PUSH_CERT_NONCE_STATUS says SLOP. Also read about receive.certNonceSlop variable in  <b>git-config</b>(1).</div>
<div style="height: 1.00em;">
&#160;</div>
This hook is called before any refname is updated and before any fast-forward checks are performed.<div style="height: 1.00em;">
&#160;</div>
If the pre-receive hook exits with a non-zero exit status no updates will be performed, and the update, post-receive and post-update hooks will not be invoked either. This can be useful to quickly bail out if the update is not to be supported.</div>
<div class="section">
<h1>UPDATE HOOK</h1> Before each ref is updated, if $GIT_DIR/hooks/update file exists and is executable, it is invoked once per ref, with three parameters:<div style="height: 1.00em;">
&#160;</div>
<div style="margin-left: 4.00ex;">
<br/>
$GIT_DIR/hooks/update refname sha1-old sha1-new<br/>
</div>
<div style="height: 1.00em;">
&#160;</div>
The refname parameter is relative to $GIT_DIR; e.g. for the master head this is &quot;refs/heads/master&quot;. The two sha1 arguments are the object names for the refname before and after the update. Note that the hook is called before the refname is updated, so either sha1-old is 0{40} (meaning there is no such ref yet), or it should match what is recorded in refname.<div style="height: 1.00em;">
&#160;</div>
The hook should exit with non-zero status if it wants to disallow updating the named ref. Otherwise it should exit with zero.<div style="height: 1.00em;">
&#160;</div>
Successful execution (a zero exit status) of this hook does not ensure the ref will actually be updated, it is only a prerequisite. As such it is not a good idea to send notices (e.g. email) from this hook. Consider using the post-receive hook instead.</div>
<div class="section">
<h1>POST-RECEIVE HOOK</h1> After all refs were updated (or attempted to be updated), if any ref update was successful, and if $GIT_DIR/hooks/post-receive file exists and is executable, it will be invoked once with no parameters. The standard input of the hook will be one line for each successfully updated ref:<div style="height: 1.00em;">
&#160;</div>
<div style="margin-left: 4.00ex;">
<br/>
sha1-old SP sha1-new SP refname LF<br/>
</div>
<div style="height: 1.00em;">
&#160;</div>
The refname value is relative to $GIT_DIR; e.g. for the master head this is &quot;refs/heads/master&quot;. The two sha1 values before each refname are the object names for the refname before and after the update. Refs that were created will have sha1-old equal to 0{40}, while refs that were deleted will have sha1-new equal to 0{40}, otherwise sha1-old and sha1-new should be valid objects in the repository.<div style="height: 1.00em;">
&#160;</div>
The GIT_PUSH_CERT* environment variables can be inspected, just as in pre-receive hook, after accepting a signed push.<div style="height: 1.00em;">
&#160;</div>
Using this hook, it is easy to generate mails describing the updates to the repository. This example script sends one mail message per ref listing the commits pushed to the repository, and logs the push certificates of signed pushes with good signatures to a logger service:<div style="height: 1.00em;">
&#160;</div>
<div style="margin-left: 4.00ex;">
<br/>
#!/bin/sh<br/>
# mail out commit update information.<br/>
while read oval nval ref<br/>
do<br/>
        if expr &quot;$oval&quot; : '0*$' &gt;/dev/null<br/>
        then<br/>
                echo &quot;Created a new ref, with the following commits:&quot;<br/>
                git rev-list --pretty &quot;$nval&quot;<br/>
        else<br/>
                echo &quot;New commits:&quot;<br/>
                git rev-list --pretty &quot;$nval&quot; &quot;^$oval&quot;<br/>
        fi |<br/>
        mail -s &quot;Changes to ref $ref&quot; commit-list@mydomain<br/>
done<br/>
# log signed push certificate, if any<br/>
if test -n &quot;${GIT_PUSH_CERT-}&quot; &amp;&amp; test ${GIT_PUSH_CERT_STATUS} = G<br/>
then<br/>
        (<br/>
                echo expected nonce is ${GIT_PUSH_NONCE}<br/>
                git cat-file blob ${GIT_PUSH_CERT}<br/>
        ) | mail -s &quot;push certificate from $GIT_PUSH_CERT_SIGNER&quot; push-log@mydomain<br/>
fi<br/>
exit 0<br/>
</div>
<div style="height: 1.00em;">
&#160;</div>
The exit code from this hook invocation is ignored, however a non-zero exit code will generate an error message.<div style="height: 1.00em;">
&#160;</div>
Note that it is possible for refname to not have sha1-new when this hook runs. This can easily occur if another user modifies the ref after it was updated by <i>git-receive-pack</i>, but before the hook was able to evaluate it. It is recommended that hooks rely on sha1-new rather than the current value of refname.</div>
<div class="section">
<h1>POST-UPDATE HOOK</h1> After all other processing, if at least one ref was updated, and if $GIT_DIR/hooks/post-update file exists and is executable, then post-update will be called with the list of refs that have been updated. This can be used to implement any repository wide cleanup tasks.<div style="height: 1.00em;">
&#160;</div>
The exit code from this hook invocation is ignored; the only thing left for <i>git-receive-pack</i> to do at that point is to exit itself anyway.<div style="height: 1.00em;">
&#160;</div>
This hook can be used, for example, to run git update-server-info if the repository is packed and is served via a dumb transport.<div style="height: 1.00em;">
&#160;</div>
<div style="margin-left: 4.00ex;">
<br/>
#!/bin/sh<br/>
exec git update-server-info<br/>
</div>
</div>
<div class="section">
<h1>SEE ALSO</h1>  <b>git-send-pack</b>(1), <b>gitnamespaces</b>(7)</div>
<div class="section">
<h1>GIT</h1> Part of the  <b>git</b>(1) suite</div>
<table class="foot">
<tr>
<td class="foot-date">
04/03/2016</td>
<td class="foot-os">
Git 2.8.1</td>
</tr>
</table>
</div>
</body>
</html>

