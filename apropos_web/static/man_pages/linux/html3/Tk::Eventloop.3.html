<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/linux/style.css" type="text/css" media="all"/>
<title>
Eventloop(3pm)</title>
</head>
<body>
<div class="mandoc">
<table class="head">
<tbody>
<tr>
<td class="head-ltitle">
Eventloop(3pm)</td>
<td class="head-vol">
User Contributed Perl Documentation</td>
<td class="head-rtitle">
Eventloop(3pm)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1>NAME</h1> Tk::Event - ToolKit for Events</div>
<div class="section">
<h1>SYNOPSIS</h1><br/>
 use Tk::Event;<br/>
<br/>
 Tk::Event-&gt;fileevent(\*FH, 'readable' =&gt; callback);<br/>
<br/>
 Tk::Event-&gt;lineavail(\*FH, callback);<br/>
<br/>
 use Tk::Event::Signal qw(INT);<br/>
<br/>
 $SIG{'INT'} = callback;<br/>
<br/>
 use Tk::Event::process;<br/>
<br/>
 Tk::Event-&gt;proc($pid, callback);<br/>
<br/>
 QueueEvent(callback [, position])<br/>
</div>
<div class="section">
<h1>DESCRIPTION</h1> That is better than nothing but still hard to use. Most scripts want higher level result (a line, a &quot;block&quot; of data etc.)<div class="spacer">
</div>
So it has occured to me that we could use new-ish TIEHANDLE thus:<div class="spacer">
</div>
<br/>
 my $obj = tie SOMEHANDLE,Tk::Event::IO;<br/>
 <br/>
 while (&lt;SOMEHANDLE&gt;)<br/>
  {<br/>
  }<br/>
<div class="spacer">
</div>
Then the READLINE routine registers a callback and looks something like:<div class="spacer">
</div>
<br/>
 sub READLINE<br/>
  {<br/>
   my $obj = shift;<br/>
   Event-&gt;io(*$obj,'readable',sub { sysread(*$obj,${*$obj},1,length(${*$obj}) });<br/>
   my $pos;<br/>
   while (($pos = index(${*$obj},$/) &lt; 0)<br/>
    {<br/>
     DoOneEvent();<br/>
    }<br/>
   Event-&gt;io(*$obj,'readable',''); # unregister<br/>
   $pos += length($/);<br/>
   my $result = substr(${*$obj},0,$pos);<br/>
   substr(${*$obj},0,$pos) = '';<br/>
   return $result;<br/>
  }<br/>
<div class="spacer">
</div>
This is using the scalar part of the glob representing the _inner_ IO as a buffer in which to accumulate chars.</div>
<table class="foot">
<tr>
<td class="foot-date">
2007-02-10</td>
<td class="foot-os">
perl v5.14.2</td>
</tr>
</table>
</div>
</body>
</html>

