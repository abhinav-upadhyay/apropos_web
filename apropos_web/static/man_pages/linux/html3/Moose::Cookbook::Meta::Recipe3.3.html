<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/linux/style.css" type="text/css" media="all"/>
<title>
Moose::Cookbook::Meta::Recipe3(3pm)</title>
</head>
<body>
<div class="mandoc">
<table class="head">
<tbody>
<tr>
<td class="head-ltitle">
Moose::Cookbook::Meta::Recipe3(3pm)</td>
<td class="head-vol">
User Contributed Perl Documentation</td>
<td class="head-rtitle">
Moose::Cookbook::Meta::Recipe3(3pm)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1>NAME</h1> Moose::Cookbook::Meta::Recipe3 - Labels implemented via attribute traits</div>
<div class="section">
<h1>VERSION</h1> version 2.0401</div>
<div class="section">
<h1>SYNOPSIS</h1><br/>
  package MyApp::Meta::Attribute::Trait::Labeled;<br/>
  use Moose::Role;<br/>
<br/>
  has label =&gt; (<br/>
      is        =&gt; 'rw',<br/>
      isa       =&gt; 'Str',<br/>
      predicate =&gt; 'has_label',<br/>
  );<br/>
<br/>
  package Moose::Meta::Attribute::Custom::Trait::Labeled;<br/>
  sub register_implementation {'MyApp::Meta::Attribute::Trait::Labeled'}<br/>
<br/>
  package MyApp::Website;<br/>
  use Moose;<br/>
<br/>
  has url =&gt; (<br/>
      traits =&gt; [qw/Labeled/],<br/>
      is     =&gt; 'rw',<br/>
      isa    =&gt; 'Str',<br/>
      label  =&gt; &quot;The site's URL&quot;,<br/>
  );<br/>
<br/>
  has name =&gt; (<br/>
      is  =&gt; 'rw',<br/>
      isa =&gt; 'Str',<br/>
  );<br/>
<br/>
  sub dump {<br/>
      my $self = shift;<br/>
<br/>
      my $meta = $self-&gt;meta;<br/>
<br/>
      my $dump = '';<br/>
<br/>
      for my $attribute ( map { $meta-&gt;get_attribute($_) }<br/>
          sort $meta-&gt;get_attribute_list ) {<br/>
<br/>
          if (   $attribute-&gt;does('MyApp::Meta::Attribute::Trait::Labeled')<br/>
              &amp;&amp; $attribute-&gt;has_label ) {<br/>
              $dump .= $attribute-&gt;label;<br/>
          }<br/>
          else {<br/>
              $dump .= $attribute-&gt;name;<br/>
          }<br/>
<br/>
          my $reader = $attribute-&gt;get_read_method;<br/>
          $dump .= &quot;: &quot; . $self-&gt;$reader . &quot;\n&quot;;<br/>
      }<br/>
<br/>
      return $dump;<br/>
  }<br/>
<br/>
  package main;<br/>
<br/>
  my $app = MyApp::Website-&gt;new( url =&gt; &quot;http://google.com&quot;, name =&gt; &quot;Google&quot; );<br/>
</div>
<div class="section">
<h1>BUT FIRST</h1> This recipe is a variation on Moose::Cookbook::Meta::Recipe2. Please read that recipe first.</div>
<div class="section">
<h1>MOTIVATION</h1> In Moose::Cookbook::Meta::Recipe2, we created an attribute metaclass which lets you provide a label for attributes.<div class="spacer">
</div>
Using a metaclass works fine until you realize you want to add a label  <i>and</i> an expiration, or some other combination of new behaviors. You could create yet another metaclass which subclasses those two, but that makes a mess, especially if you want to mix and match behaviors across many attributes.<div class="spacer">
</div>
Fortunately, Moose provides a much saner alternative, which is to encapsulate each extension as a role, not a class. We can make a role which adds a label to an attribute, and could make another to implement expiration.</div>
<div class="section">
<h1>TRAITS</h1> Roles that apply to metaclasses have a special name: traits. Don't let the change in nomenclature fool you,  <b>traits are just roles</b>.<div class="spacer">
</div>
&quot;has&quot; in Moose allows you to pass a &quot;traits&quot; parameter for an attribute. This parameter takes a list of trait names which are composed into an anonymous metaclass, and that anonymous metaclass is used for the attribute.<div class="spacer">
</div>
Yes, we still have lots of metaclasses in the background, but they're managed by Moose for you.<div class="spacer">
</div>
Traits can do anything roles can do. They can add or refine attributes, wrap methods, provide more methods, define an interface, etc. The only difference is that you're now changing the attribute metaclass instead of a user-level class.</div>
<div class="section">
<h1>DISSECTION</h1> A side-by-side look of the code examples in this recipe and recipe 2 show that defining and using a trait is very similar to a full-blown metaclass.<div class="spacer">
</div>
<br/>
  package MyApp::Meta::Attribute::Trait::Labeled;<br/>
  use Moose::Role;<br/>
<br/>
  has label =&gt; (<br/>
      is        =&gt; 'rw',<br/>
      isa       =&gt; 'Str',<br/>
      predicate =&gt; 'has_label',<br/>
  );<br/>
<div class="spacer">
</div>
Instead of subclassing Moose::Meta::Attribute, we define a role. As with our metaclass in recipe 2, registering our role allows us to refer to it by a short name.<div class="spacer">
</div>
<br/>
  package Moose::Meta::Attribute::Custom::Trait::Labeled;<br/>
  sub register_implementation { 'MyApp::Meta::Attribute::Trait::Labeled' }<br/>
<div class="spacer">
</div>
Moose looks for the &quot;register_implementation&quot; method in &quot;Moose::Meta::Attribute::Custom::Trait::$TRAIT_NAME&quot; to find the full name of the trait.<div class="spacer">
</div>
For the rest of the code, we will only cover what is <i>different</i> from recipe 2.<div class="spacer">
</div>
<br/>
  has url =&gt; (<br/>
      traits =&gt; [qw/Labeled/],<br/>
      is     =&gt; 'rw',<br/>
      isa    =&gt; 'Str',<br/>
      label  =&gt; &quot;The site's URL&quot;,<br/>
  );<br/>
<div class="spacer">
</div>
Instead of passing a &quot;metaclass&quot; parameter, this time we pass &quot;traits&quot;. This contains a list of trait names. Moose will build an anonymous attribute metaclass from these traits and use it for this attribute. Passing a &quot;label&quot; parameter works just as it did with the metaclass example.<div class="spacer">
</div>
<br/>
          if (   $attribute-&gt;does('MyApp::Meta::Attribute::Trait::Labeled')<br/>
              &amp;&amp; $attribute-&gt;has_label ) {<br/>
              $dump .= $attribute-&gt;label;<br/>
          }<br/>
<div class="spacer">
</div>
In the metaclass example, we used &quot;$attribute-&gt;isa&quot;. With a role, we instead ask if the meta-attribute object &quot;does&quot; the required role. If it does not do this role, the attribute meta object won't have the &quot;has_label&quot; method.<div class="spacer">
</div>
That's all. Everything else is the same!</div>
<div class="section">
<h1>TURNING A METACLASS INTO A TRAIT</h1> &quot;But wait!&quot; you protest. &quot;I've already written all of my extensions as attribute metaclasses. I don't want to break all that code out there.&quot;<div class="spacer">
</div>
Fortunately, you can easily turn a metaclass into a trait and still provide the original metaclass:<div class="spacer">
</div>
<br/>
  package MyApp::Meta::Attribute::Labeled;<br/>
  use Moose;<br/>
  extends 'Moose::Meta::Attribute';<br/>
  with 'MyApp::Meta::Attribute::Trait::Labeled';<br/>
<br/>
  package Moose::Meta::Attribute::Custom::Labeled;<br/>
  sub register_implementation { 'MyApp::Meta::Attribute::Labeled' }<br/>
<div class="spacer">
</div>
Unfortunately, going the other way (providing a trait created from a metaclass) is more tricky.</div>
<div class="section">
<h1>CONCLUSION</h1> If you're extending your attributes, it's easier and more flexible to provide composable bits of behavior than to subclass Moose::Meta::Attribute. Using traits lets you cooperate with other extensions, either from CPAN or that you might write in the future. Moose makes it easy to create attribute metaclasses on the fly by providing a list of trait names to &quot;has&quot; in Moose.</div>
<div class="section">
<h1>AUTHOR</h1> Moose is maintained by the Moose Cabal, along with the help of many contributors. See &quot;CABAL&quot; in Moose and &quot;CONTRIBUTORS&quot; in Moose for details.</div>
<div class="section">
<h1>COPYRIGHT AND LICENSE</h1> This software is copyright (c) 2011 by Infinity Interactive, Inc..<div class="spacer">
</div>
This is free software; you can redistribute it and/or modify it under the same terms as the Perl 5 programming language system itself.</div>
<table class="foot">
<tr>
<td class="foot-date">
2011-11-17</td>
<td class="foot-os">
perl v5.14.2</td>
</tr>
</table>
</div>
</body>
</html>

