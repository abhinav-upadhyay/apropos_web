<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/linux/style.css" type="text/css" media="all"/>
<title>
Config::Model::Tester(3pm)</title>
</head>
<body>
<div class="mandoc">
<table class="head">
<tbody>
<tr>
<td class="head-ltitle">
Config::Model::Tester(3pm)</td>
<td class="head-vol">
User Contributed Perl Documentation</td>
<td class="head-rtitle">
Config::Model::Tester(3pm)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1>NAME</h1> Config::Model::Tester - Test framework for Config::Model</div>
<div class="section">
<h1>VERSION</h1> version 2.005</div>
<div class="section">
<h1>SYNOPSIS</h1><br/>
 # in t/foo.t<br/>
 use warnings;<br/>
 use strict;<br/>
<br/>
 use Config::Model::Tester ;<br/>
 use ExtUtils::testlib;<br/>
<br/>
 my $arg = shift || '';<br/>
 my $test_only_model = shift || '';<br/>
 my $do = shift ;<br/>
<br/>
 run_tests($arg, $test_only_model, $do) ;<br/>
</div>
<div class="section">
<h1>DESCRIPTION</h1> This class provides a way to test configuration models with tests files. This class was designed to tests several models and severals tests cases per model.<div class="spacer">
</div>
A specific layout for test files must be followed<div class="subsection">
<h2>Test file layout</h2><br/>
 t/model_tests.d<br/>
 |-- fstab-examples<br/>
 |   |-- t0<br/>
 |   \-- t1<br/>
 |-- fstab-test-conf.pl<br/>
 |-- debian-dpkg-examples<br/>
 |   \-- libversion<br/>
 |       \-- debian<br/>
 |           |-- changelog<br/>
 |           |-- compat<br/>
 |           |-- control<br/>
 |           |-- copyright<br/>
 |           |-- rules<br/>
 |           |-- source<br/>
 |           |   \-- format<br/>
 |           \-- watch<br/>
 \-- debian-dpkg-test-conf.pl<br/>
<div class="spacer">
</div>
In the example above, we have 2 models to test: &quot;fstab&quot; and &quot;debian-dpkg&quot;.<div class="spacer">
</div>
Each model test has specification in &quot;*-test-conf.pl&quot; files. Test cases are either plain files or directories in &quot;*-examples&quot; . The former is fine if your model deal with one file (e.g. &quot;/etc/fstab&quot;. Complete directories are required if your model deal with several files (e.g. Debian source package).</div>
<div class="subsection">
<h2>Basic test specification</h2> Each model test is specified in &quot;&lt;model&gt;-test-conf.pl&quot;. This file contains a set of global variable. (yes, global variables are often bad ideas in programs, but they are handy for tests):<div class="spacer">
</div>
<br/>
 # config file name (used to copy test case into test wr_root directory)<br/>
 $conf_file_name = &quot;fstab&quot; ;<br/>
 # config dir where to copy the file<br/>
 #$conf_dir = &quot;etc&quot; ;<br/>
<div class="spacer">
</div>
Here, &quot;t0&quot; file will be copied in &quot;wr_root/test-t0/etc/fstab&quot;.<div class="spacer">
</div>
<br/>
 # config model name to test<br/>
 $model_to_test = &quot;Fstab&quot; ;<br/>
<br/>
 # list of tests<br/>
 @tests = (<br/>
    { <br/>
     # test name <br/>
     name =&gt; 't0',<br/>
     # add optional specification here for t0 test<br/>
    },<br/>
    { <br/>
     name =&gt; 't1',<br/>
     # add optional specification here for t1 test<br/>
     },<br/>
 );<br/>
<br/>
 1; # to keep Perl happy<br/>
</div>
<div class="subsection">
<h2>Test specification with arbitrary file names</h2> In some models (e.g. &quot;Multistrap&quot;, the config file is chosen by the user. In this case, the file name must be specified for each tests case:<div class="spacer">
</div>
<br/>
 $model_to_test = &quot;Multistrap&quot;;<br/>
<br/>
 @tests = (<br/>
    {<br/>
        name        =&gt; 'arm',<br/>
        config_file =&gt; '/home/foo/my_arm.conf',<br/>
        check       =&gt; {},<br/>
    },<br/>
 );<br/>
</div>
<div class="subsection">
<h2>test scenario</h2> Each subtest follow a sequence explained below. Each step of this sequence may be altered by adding specification in the test case:<dl>
<dt>
&#8226;</dt>
<dd>
Setup test in &quot;wr_root/&lt;subtest name&gt;/&quot;</dd>
</dl>
<dl>
<dt>
&#8226;</dt>
<dd>
Create configuration instance, load config data and check its validity. Use &quot;load_check =&gt; 'no'&quot; if your file is not valid.</dd>
</dl>
<dl>
<dt>
&#8226;</dt>
<dd>
Check for config data warning. You should pass the list of expected warnings. E.g.<div style="height: 1.00em;">
&#160;</div>
<br/>
    load_warnings =&gt; [ qr/Missing/, (qr/deprecated/) x 3 , ],<br/>
</dd>
</dl>
<dl>
<dt>
&#8226;</dt>
<dd>
Optionally load configuration data. You should design this config data to suppress any error or warning mentioned above. E.g:<div style="height: 1.00em;">
&#160;</div>
<br/>
    load =&gt; 'binary:seaview Synopsis=&quot;multiplatform interface for sequence alignment&quot;',<br/>
</dd>
</dl>
<dl>
<dt>
&#8226;</dt>
<dd>
Optionally, call apply_fixes:<div style="height: 1.00em;">
&#160;</div>
<br/>
    apply_fix =&gt; 1,<br/>
</dd>
</dl>
<dl>
<dt>
&#8226;</dt>
<dd>
Call dump_tree to check the validity of the data. Use &quot;dump_errors&quot; if you expect issues:<div style="height: 1.00em;">
&#160;</div>
<br/>
    dump_errors =&gt;  [ <br/>
        # the issues     the fix that will be applied<br/>
        qr/mandatory/ =&gt; 'Files:&quot;*&quot; Copyright:0=&quot;(c) foobar&quot;',<br/>
        qr/mandatory/ =&gt; ' License:FOO text=&quot;foo bar&quot; ! Files:&quot;*&quot; License short_name=&quot;FOO&quot; '<br/>
    ],<br/>
</dd>
</dl>
<dl>
<dt>
&#8226;</dt>
<dd>
Likewise, specify any expected warnings:<div style="height: 1.00em;">
&#160;</div>
<br/>
        dump_warnings =&gt; [ (qr/deprecated/) x 3 ],<br/>
<div style="height: 1.00em;">
&#160;</div>
You can tolerate any dump warning this way:<div style="height: 1.00em;">
&#160;</div>
<br/>
        dump_warnings =&gt; undef ,<br/>
</dd>
</dl>
<dl>
<dt>
&#8226;</dt>
<dd>
Run specific content check to verify that configuration data was retrieved correctly:<div style="height: 1.00em;">
&#160;</div>
<br/>
    check =&gt; { <br/>
        'fs:/proc fs_spec',           &quot;proc&quot; ,<br/>
        'fs:/proc fs_file',           &quot;/proc&quot; ,<br/>
        'fs:/home fs_file',          &quot;/home&quot;,<br/>
    },<br/>
<div style="height: 1.00em;">
&#160;</div>
You can run check using different check modes (See &quot;fetch( ... )&quot; in Config::Model::Value):<div style="height: 1.00em;">
&#160;</div>
<br/>
    check_layered  =&gt; {<br/>
                'sections:debian packages:0' ,'dpkg-dev',<br/>
                'sections:base packages:0', 'gcc-4.2-base',<br/>
            },<br/>
<div style="height: 1.00em;">
&#160;</div>
The mode is specified after &quot;check_&quot;.</dd>
</dl>
<dl>
<dt>
&#8226;</dt>
<dd>
Write back the config data in &quot;wr_root/&lt;subtest name&gt;/&quot;. You can skip warning when writing back with:<div style="height: 1.00em;">
&#160;</div>
<br/>
    no_warnings =&gt; 1,<br/>
</dd>
</dl>
<dl>
<dt>
&#8226;</dt>
<dd>
Check the content of the written files(s) with Test::File::Contents:<div style="height: 1.00em;">
&#160;</div>
<br/>
   file_content =&gt; { <br/>
            &quot;/home/foo/my_arm.conf&quot; =&gt; &quot;really big string&quot; ,<br/>
        }<br/>
</dd>
</dl>
<dl>
<dt>
&#8226;</dt>
<dd>
Check added or removed configuration files. If you expect changes, specify a subref to alter the file list:<div style="height: 1.00em;">
&#160;</div>
<br/>
    file_check_sub =&gt; sub { <br/>
        my $list_ref = shift ; <br/>
        # file added during tests<br/>
        push @$list_ref, &quot;/debian/source/format&quot; ;<br/>
    };<br/>
</dd>
</dl>
<dl>
<dt>
&#8226;</dt>
<dd>
Copy all config data from &quot;wr_root/&lt;subtest name&gt;/&quot; to &quot;wr_root/&lt;subtest name&gt;-w/&quot;. This steps is necessary to check that configuration written back has the same content as the original configuration.</dd>
</dl>
<dl>
<dt>
&#8226;</dt>
<dd>
Create another configuration instance to read the conf file that was just copied (configuration data is checked.)</dd>
</dl>
<dl>
<dt>
&#8226;</dt>
<dd>
Compare data read from original data.</dd>
</dl>
</div>
<div class="subsection">
<h2>running the test</h2> Run all tests:<div class="spacer">
</div>
<br/>
 perl -Ilib t/model_test.t<br/>
<div class="spacer">
</div>
By default, all tests are run on all models.<div class="spacer">
</div>
You can pass arguments to &quot;t/model_test.t&quot;:<dl>
<dt>
&#8226;</dt>
<dd>
a bunch of letters. 't' to get test traces. 'e' to get stack trace in case of errors, 'l' to have logs. All other letters are ignored. E.g.<div style="height: 1.00em;">
&#160;</div>
<br/>
  # run with log and error traces<br/>
  perl -Ilib t/model_test.t el<br/>
</dd>
</dl>
<dl>
<dt>
&#8226;</dt>
<dd>
The model name to tests. E.g.:<div style="height: 1.00em;">
&#160;</div>
<br/>
  # run only fstab tests<br/>
  perl -Ilib t/model_test.t x fstab<br/>
</dd>
</dl>
<dl>
<dt>
&#8226;</dt>
<dd>
The required subtest E.g.:<div style="height: 1.00em;">
&#160;</div>
<br/>
  # run only fstab tests t0<br/>
  perl -Ilib t/model_test.t x fstab t0<br/>
</dd>
</dl>
</div>
</div>
<div class="section">
<h1>Examples</h1> See http://config-model.hg.sourceforge.net/hgweb/config-model/config-model/file/tip/config-model-core/t/model_tests.d/debian-dpkg-copyright-test-conf.pl</div>
<div class="section">
<h1>AUTHOR</h1> Dominique Dumont, (ddumont at cpan dot org)</div>
<div class="section">
<h1>SEE ALSO</h1> Config::Model,</div>
<table class="foot">
<tr>
<td class="foot-date">
2012-02-24</td>
<td class="foot-os">
perl v5.14.2</td>
</tr>
</table>
</div>
</body>
</html>

