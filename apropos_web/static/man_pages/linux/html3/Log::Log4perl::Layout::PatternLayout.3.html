<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/linux/style.css" type="text/css" media="all"/>
<title>
Layout::PatternLayout(3pm)</title>
</head>
<body>
<div class="mandoc">
<table class="head">
<tbody>
<tr>
<td class="head-ltitle">
Layout::PatternLayout(3pm)</td>
<td class="head-vol">
User Contributed Perl Documentation</td>
<td class="head-rtitle">
Layout::PatternLayout(3pm)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1>NAME</h1> Log::Log4perl::Layout::PatternLayout - Pattern Layout</div>
<div class="section">
<h1>SYNOPSIS</h1><br/>
  use Log::Log4perl::Layout::PatternLayout;<br/>
<br/>
  my $layout = Log::Log4perl::Layout::PatternLayout-&gt;new(<br/>
                                                   &quot;%d (%F:%L)&gt; %m&quot;);<br/>
</div>
<div class="section">
<h1>DESCRIPTION</h1> Creates a pattern layout according to http://jakarta.apache.org/log4j/docs/api/org/apache/log4j/PatternLayout.html and a couple of Log::Log4perl-specific extensions.<div class="spacer">
</div>
The &quot;new()&quot; method creates a new PatternLayout, specifying its log format. The format string can contain a number of placeholders which will be replaced by the logging engine when it's time to log the message:<div class="spacer">
</div>
<br/>
    %c Category of the logging event.<br/>
    %C Fully qualified package (or class) name of the caller<br/>
    %d Current date in yyyy/MM/dd hh:mm:ss format<br/>
    %F File where the logging event occurred<br/>
    %H Hostname (if Sys::Hostname is available)<br/>
    %l Fully qualified name of the calling method followed by the<br/>
       callers source the file name and line number between <br/>
       parentheses.<br/>
    %L Line number within the file where the log statement was issued<br/>
    %m The message to be logged<br/>
    %m{chomp} The message to be logged, stripped off a trailing newline<br/>
    %M Method or function where the logging request was issued<br/>
    %n Newline (OS-independent)<br/>
    %p Priority of the logging event (%p{1} shows the first letter)<br/>
    %P pid of the current process<br/>
    %r Number of milliseconds elapsed from program start to logging <br/>
       event<br/>
    %R Number of milliseconds elapsed from last logging event to<br/>
       current logging event <br/>
    %T A stack trace of functions called<br/>
    %x The topmost NDC (see below)<br/>
    %X{key} The entry 'key' of the MDC (see below)<br/>
    %% A literal percent (%) sign<br/>
<div class="spacer">
</div>
NDC and MDC are explained in &quot;Nested Diagnostic Context (NDC)&quot; in Log::Log4perl and &quot;Mapped Diagnostic Context (MDC)&quot; in Log::Log4perl.<div class="spacer">
</div>
The granularity of time values is milliseconds if Time::HiRes is available. If not, only full seconds are used.<div class="spacer">
</div>
Every once in a while, someone uses the &quot;%m%n&quot; pattern and additionally provides an extra newline in the log message (e.g. &quot;-&gt;log(&quot;message\n&quot;)&quot;. To avoid printing an extra newline in this case, the PatternLayout will chomp the message, printing only one newline. This option can be controlled by PatternLayout's &quot;message_chomp_before_newline&quot; option. See &quot;Advanced options&quot; for details.<div class="subsection">
<h2>Quantify placeholders</h2> All placeholders can be extended with formatting instructions, just like in  <i>printf</i>:<div class="spacer">
</div>
<br/>
    %20c   Reserve 20 chars for the category, right-justify and fill<br/>
           with blanks if it is shorter<br/>
    %-20c  Same as %20c, but left-justify and fill the right side <br/>
           with blanks<br/>
    %09r   Zero-pad the number of milliseconds to 9 digits<br/>
    %.8c   Specify the maximum field with and have the formatter<br/>
           cut off the rest of the value<br/>
</div>
<div class="subsection">
<h2>Fine-tuning with curlies</h2> Some placeholders have special functions defined if you add curlies with content after them:<div class="spacer">
</div>
<br/>
    %c{1}  Just show the right-most category compontent, useful in large<br/>
           class hierarchies (Foo::Baz::Bar -&gt; Bar)<br/>
    %c{2}  Just show the two right most category components<br/>
           (Foo::Baz::Bar -&gt; Baz::Bar)<br/>
<br/>
    %F     Display source file including full path<br/>
    %F{1}  Just display filename<br/>
    %F{2}  Display filename and last path component (dir/test.log)<br/>
    %F{3}  Display filename and last two path components (d1/d2/test.log)<br/>
<br/>
    %M     Display fully qualified method/function name<br/>
    %M{1}  Just display method name (foo)<br/>
    %M{2}  Display method name and last path component (main::foo)<br/>
<div class="spacer">
</div>
In this way, you're able to shrink the displayed category or limit file/path components to save space in your logs.</div>
<div class="subsection">
<h2>Fine-tune the date</h2> If you're not happy with the default %d format for the date which looks like<div class="spacer">
</div>
<br/>
    yyyy/MM/DD HH:mm:ss<br/>
<div class="spacer">
</div>
(which is slightly different from Log4j which uses &quot;yyyy-MM-dd HH:mm:ss,SSS&quot;) you're free to fine-tune it in order to display only certain characteristics of a date, according to the SimpleDateFormat in the Java World (http://java.sun.com/j2se/1.3/docs/api/java/text/SimpleDateFormat.html):<div class="spacer">
</div>
<br/>
    %d{HH:mm}     &quot;23:45&quot; -- Just display hours and minutes<br/>
    %d{yy, EEEE}  &quot;02, Monday&quot; -- Just display two-digit year <br/>
                                  and spelled-out weekday<br/>
Here's the symbols and their meaning, according to the SimpleDateFormat<br/>
specification:<br/>
<br/>
    Symbol   Meaning                 Presentation     Example<br/>
    ------   -------                 ------------     -------<br/>
    G        era designator          (Text)           AD<br/>
    y        year                    (Number)         1996 <br/>
    M        month in year           (Text &amp; Number)  July &amp; 07<br/>
    d        day in month            (Number)         10<br/>
    h        hour in am/pm (1-12)    (Number)         12<br/>
    H        hour in day (0-23)      (Number)         0<br/>
    m        minute in hour          (Number)         30<br/>
    s        second in minute        (Number)         55<br/>
    E        day in week             (Text)           Tuesday<br/>
    D        day in year             (Number)         189<br/>
    a        am/pm marker            (Text)           PM<br/>
<br/>
    (Text): 4 or more pattern letters--use full form, &lt; 4--use short or <br/>
            abbreviated form if one exists. <br/>
<br/>
    (Number): the minimum number of digits. Shorter numbers are <br/>
              zero-padded to this amount. Year is handled <br/>
              specially; that is, if the count of 'y' is 2, the <br/>
              Year will be truncated to 2 digits. <br/>
<br/>
    (Text &amp; Number): 3 or over, use text, otherwise use number.<br/>
<div class="spacer">
</div>
There's also a bunch of pre-defined formats:<div class="spacer">
</div>
<br/>
    %d{ABSOLUTE}   &quot;HH:mm:ss,SSS&quot;<br/>
    %d{DATE}       &quot;dd MMM yyyy HH:mm:ss,SSS&quot;<br/>
    %d{ISO8601}    &quot;yyyy-MM-dd HH:mm:ss,SSS&quot;<br/>
</div>
<div class="subsection">
<h2>Custom cspecs</h2> First of all, &quot;cspecs&quot; is short for &quot;conversion specifiers&quot;, which is the log4j and the  <i>printf</i>(3) term for what Mike is calling &quot;placeholders.&quot; I suggested &quot;cspecs&quot; for this part of the api before I saw that Mike was using &quot;placeholders&quot; consistently in the log4perl documentation.  Ah, the joys of collaboration ;=) --kg<div class="spacer">
</div>
If the existing corpus of placeholders/cspecs isn't good enough for you, you can easily roll your own:<div class="spacer">
</div>
<br/>
    #'U' a global user-defined cspec     <br/>
    log4j.PatternLayout.cspec.U = sub { return &quot;UID: $&lt; &quot;}<br/>
    <br/>
    #'K' cspec local to appndr1                 (pid in hex)<br/>
    log4j.appender.appndr1.layout.cspec.K = sub { return sprintf &quot;%1x&quot;, $$}<br/>
    <br/>
    #and now you can use them<br/>
    log4j.appender.appndr1.layout.ConversionPattern = %K %U %m%n<br/>
<div class="spacer">
</div>
The benefit of this approach is that you can define and use the cspecs right next to each other in the config file.<div class="spacer">
</div>
If you're an API kind of person, there's also this call:<div class="spacer">
</div>
<br/>
    Log::Log4perl::Layout::PatternLayout::<br/>
                    add_global_cspec('Z', sub {'zzzzzzzz'}); #snooze?<br/>
<div class="spacer">
</div>
When the log message is being put together, your anonymous sub will be called with these arguments:<div class="spacer">
</div>
<br/>
    ($layout, $message, $category, $priority, $caller_level);<br/>
    <br/>
    layout: the PatternLayout object that called it<br/>
    message: the logging message (%m)<br/>
    category: e.g. groceries.beverages.adult.beer.schlitz<br/>
    priority: e.g. DEBUG|WARN|INFO|ERROR|FATAL<br/>
    caller_level: how many levels back up the call stack you have <br/>
        to go to find the caller<br/>
<div class="spacer">
</div>
Please note that the subroutines you're defining in this way are going to be run in the &quot;main&quot; namespace, so be sure to fully qualify functions and variables if they're located in different packages.  <i>Also make sure</i>  <i>these subroutines aren't using Log4perl, otherwise Log4perl will enter</i>  <i>an infinite recursion.</i><div class="spacer">
</div>
With Log4perl 1.20 and better, cspecs can be written with parameters in curly braces. Writing something like<div class="spacer">
</div>
<br/>
    log4perl.appender.Screen.layout.ConversionPattern = %U{user} %U{id} %m%n<br/>
<div class="spacer">
</div>
will cause the cspec function defined for %U to be called twice, once with the parameter 'user' and then again with the parameter 'id', and the placeholders in the cspec string will be replaced with the respective return values.<div class="spacer">
</div>
The parameter value is available in the 'curlies' entry of the first parameter passed to the subroutine (the layout object reference). So, if you wanted to map %U{xxx} to entries in the POE session hash, you'd write something like:<div class="spacer">
</div>
<br/>
   log4perl.PatternLayout.cspec.U = sub { \<br/>
     POE::Kernel-&gt;get_active_session-&gt;get_heap()-&gt;{ $_[0]-&gt;{curlies} } }<br/>
<div class="spacer">
</div>
<b>SECURITY NOTE</b><div class="spacer">
</div>
This feature means arbitrary perl code can be embedded in the config file. In the rare case where the people who have access to your config file are different from the people who write your code and shouldn't have execute rights, you might want to set<div class="spacer">
</div>
<br/>
    $Log::Log4perl::Config-&gt;allow_code(0);<br/>
<div class="spacer">
</div>
before you call <i>init()</i>.  Alternatively you can supply a restricted set of Perl opcodes that can be embedded in the config file as described in &quot;Restricting what Opcodes can be in a Perl Hook&quot; in Log::Log4perl.</div>
<div class="subsection">
<h2>Advanced Options</h2> The constructor of the &quot;Log::Log4perl::Layout::PatternLayout&quot; class takes an optional hash reference as a first argument to specify additional options in order to (ab)use it in creative ways:<div class="spacer">
</div>
<br/>
  my $layout = Log::Log4perl::Layout::PatternLayout-&gt;new(<br/>
    { time_function       =&gt; \&amp;my_time_func,<br/>
    }, <br/>
    &quot;%d (%F:%L)&gt; %m&quot;);<br/>
<div class="spacer">
</div>
Here's a list of parameters:<dl>
<dt>
time_function</dt>
<dd>
Takes a reference to a function returning the time for the time/date fields, either in seconds since the epoch or as an array, carrying seconds and microseconds, just like &quot;Time::HiRes::gettimeofday&quot; does.</dd>
</dl>
<dl>
<dt>
message_chomp_before_newline</dt>
<dd>
If a layout contains the pattern &quot;%m%n&quot; and the message ends with a newline, PatternLayout will chomp the message, to prevent printing two newlines. If this is not desired, and you want two newlines in this case, the feature can be turned off by setting the &quot;message_chomp_before_newline&quot; option to a false value:<div style="height: 1.00em;">
&#160;</div>
<br/>
  my $layout = Log::Log4perl::Layout::PatternLayout-&gt;new(<br/>
      { message_chomp_before_newline =&gt; 0<br/>
      }, <br/>
      &quot;%d (%F:%L)&gt; %m%n&quot;);<br/>
<div style="height: 1.00em;">
&#160;</div>
In a Log4perl configuration file, the feature can be turned off like this:<div style="height: 1.00em;">
&#160;</div>
<br/>
    log4perl.appender.App.layout   = PatternLayout<br/>
    log4perl.appender.App.layout.ConversionPattern = %d %m%n<br/>
      # Yes, I want two newlines<br/>
    log4perl.appender.App.layout.message_chomp_before_newline = 0<br/>
</dd>
</dl>
</div>
<div class="subsection">
<h2>Getting rid of newlines</h2> If your code contains logging statements like<div class="spacer">
</div>
<br/>
      # WRONG, don't do that!<br/>
    $logger-&gt;debug(&quot;Some message\n&quot;);<br/>
<div class="spacer">
</div>
then it's usually best to strip the newlines from these calls. As explained in &quot;Logging newlines&quot; in Log::Log4perl, logging statements should never contain newlines, but rely on appender layouts to add necessary newlines instead.<div class="spacer">
</div>
If changing the code is not an option, use the special PatternLayout placeholder %m{chomp} to refer to the message excluding a trailing newline:<div class="spacer">
</div>
<br/>
    log4perl.appender.App.layout.ConversionPattern = %d %m{chomp}%n<br/>
<div class="spacer">
</div>
This will add a single newline to every message, regardless if it complies with the Log4perl newline guidelines or not (thanks to Tim Bunce for this idea).</div>
</div>
<div class="section">
<h1>COPYRIGHT AND LICENSE</h1> Copyright 2002-2009 by Mike Schilli &lt;m@perlmeister.com&gt; and Kevin Goess &lt;cpan@goess.org&gt;.<div class="spacer">
</div>
This library is free software; you can redistribute it and/or modify it under the same terms as Perl itself.</div>
<table class="foot">
<tr>
<td class="foot-date">
2010-06-17</td>
<td class="foot-os">
perl v5.10.1</td>
</tr>
</table>
</div>
</body>
</html>

