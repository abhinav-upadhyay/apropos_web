<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/linux/style.css" type="text/css" media="all"/>
<title>
CAP_GET_FILE(3)</title>
</head>
<body>
<div class="mandoc">
<table class="head">
<tbody>
<tr>
<td class="head-ltitle">
CAP_GET_FILE(3)</td>
<td class="head-vol">
Linux Programmer's Manual</td>
<td class="head-rtitle">
CAP_GET_FILE(3)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1>NAME</h1> cap_get_file, cap_set_file, cap_get_fd, cap_set_fd - capability manipulation on files</div>
<div class="section">
<h1>SYNOPSIS</h1> <b>#include &lt;sys/capability.h&gt;</b><div style="height: 1.00em;">
&#160;</div>
<b>cap_t cap_get_file(const char *</b><i>path_p</i><b>);</b><div style="height: 1.00em;">
&#160;</div>
<b>int cap_set_file(const char *</b><i>path_p</i><b>, cap_t </b><i>cap_p</i><b>);</b><div style="height: 1.00em;">
&#160;</div>
<b>cap_t cap_get_fd(int </b><i>fd</i><b>);</b><div style="height: 1.00em;">
&#160;</div>
<b>int cap_set_fd(int </b><i>fd</i><b>, cap_t </b><i>caps</i><b>);</b><div style="height: 1.00em;">
&#160;</div>
Link with <i>-lcap</i>.</div>
<div class="section">
<h1>DESCRIPTION</h1> <b>cap_get_file</b>() and <b>cap_get_fd</b>() allocate a capability state in working storage and set it to represent the capability state of the pathname pointed to by <i>path_p</i> or the file open on descriptor <i>fd</i>. These functions return a pointer to the newly created capability state.  The effects of reading the capability state from any file other than a regular file is undefined.  The caller should free any releasable memory, when the capability state in working storage is no longer required, by calling <b>cap_free</b>() with the used <i>cap_t</i> as an argument.<div class="spacer">
</div>
<b>cap_set_file</b>() and <b>cap_set_fd</b>() set the values for all capability flags for all capabilities for the pathname pointed to by <i>path_p</i> or the file open on descriptor <i>fd</i>, with the capability state identified by <i>cap_p</i>. The new capability state of the file is completely determined by the contents of <i>cap_p</i>. A NULL value for <i>cap_p</i> is used to indicate that capabilities for the file should be deleted. For these functions to succeed, the calling process must have the effective capability, <b>CAP_SETFCAP</b>, enabled and either the effective user ID of the process must match the file owner or the calling process must have the <b>CAP_FOWNER</b> flag in its effective capability set.  The effects of writing the capability state to any file type other than a regular file are undefined.</div>
<div class="section">
<h1>RETURN VALUE</h1> <b>cap_get_file</b>() and <b>cap_get_fd</b>() return a non-NULL value on success, and NULL on failure.<div class="spacer">
</div>
<b>cap_set_file</b>() and <b>cap_set_fd</b>() return zero on success, and -1 on failure.<div class="spacer">
</div>
On failure, <i>errno</i> is set to <b>EACCES</b>, <b>EBADFD</b>, <b>ENAMETOOLONG</b>, <b>ENOENT</b>, <b>ENOMEM</b>, <b>ENOTDIR</b>, <b>EPERM</b>, or <b>EROFS</b>.</div>
<div class="section">
<h1>CONFORMING TO</h1> These functions are specified by withdrawn POSIX.1e draft specification.</div>
<div class="section">
<h1>NOTES</h1> Support for file capabilities is provided on Linux since version 2.6.24.<div style="height: 1.00em;">
&#160;</div>
On Linux, the file Effective set is a single bit. If it is enabled, then all Permitted capabilities are enabled in the Effective set of the calling process when the file is executed; otherwise, no capabilities are enabled in the process's Effective set following an <b>execve</b>(2). Because the file Effective set is a single bit, if any capability is enabled in the Effective set of the <i>cap_t</i> given to <b>cap_set_file</b>() or <b>cap_set_fd</b>(), then all capabilities whose Permitted or Inheritable flag is enabled must also have the Effective flag enabled. Conversely, if the Effective bit is enabled on a file, then the <i>cap_t</i> returned by <b>cap_get_file()</b> and <b>cap_get_fd()</b> will have the Effective flag enabled for each capability that has the Permitted or Inheritable flag enabled.</div>
<div class="section">
<h1>SEE ALSO</h1> <b>libcap</b>(3), <b>cap_clear</b>(3), <b>cap_copy_ext</b>(3), <b>cap_from_text</b>(3), <b>cap_get_proc</b>(3), <b>cap_init</b>(3), <b>capabilities</b>(7)</div>
<table class="foot">
<tr>
<td class="foot-date">
2008-05-11</td>
<td class="foot-os">
</td>
</tr>
</table>
</div>
</body>
</html>

