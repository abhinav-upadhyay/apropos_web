<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/linux/style.css" type="text/css" media="all"/>
<title>
Dpkg::Compression::FileHandle(3)</title>
</head>
<body>
<div class="mandoc">
<table class="head">
<tbody>
<tr>
<td class="head-ltitle">
Dpkg::Compression::FileHandle(3)</td>
<td class="head-vol">
libdpkg-perl</td>
<td class="head-rtitle">
Dpkg::Compression::FileHandle(3)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1>NAME</h1> Dpkg::Compression::FileHandle - object dealing transparently with file compression</div>
<div class="section">
<h1>SYNOPSIS</h1><br/>
    use Dpkg::Compression::FileHandle;<br/>
<br/>
    $fh = Dpkg::Compression::FileHandle-&gt;new(filename=&gt;&quot;sample.gz&quot;);<br/>
    print $fh &quot;Something\n&quot;;<br/>
    close $fh;<br/>
<br/>
    $fh = Dpkg::Compression::FileHandle-&gt;new();<br/>
    open($fh, &quot;&gt;&quot;, &quot;sample.bz2&quot;);<br/>
    print $fh &quot;Something\n&quot;;<br/>
    close $fh;<br/>
<br/>
    $fh = Dpkg::Compression::FileHandle-&gt;new();<br/>
    $fh-&gt;open(&quot;sample.xz&quot;, &quot;w&quot;);<br/>
    $fh-&gt;print(&quot;Something\n&quot;);<br/>
    $fh-&gt;close();<br/>
<br/>
    $fh = Dpkg::Compression::FileHandle-&gt;new(filename=&gt;&quot;sample.gz&quot;);<br/>
    my @lines = &lt;$fh&gt;;<br/>
    close $fh;<br/>
<br/>
    $fh = Dpkg::Compression::FileHandle-&gt;new();<br/>
    open($fh, &quot;&lt;&quot;, &quot;sample.bz2&quot;);<br/>
    my @lines = &lt;$fh&gt;;<br/>
    close $fh;<br/>
<br/>
    $fh = Dpkg::Compression::FileHandle-&gt;new();<br/>
    $fh-&gt;open(&quot;sample.xz&quot;, &quot;r&quot;);<br/>
    my @lines = $fh-&gt;getlines();<br/>
    $fh-&gt;close();<br/>
</div>
<div class="section">
<h1>DESCRIPTION</h1> Dpkg::Compression::FileHandle is an object that can be used like any filehandle and that deals transparently with compressed files. By default, the compression scheme is guessed from the filename but you can override this behaviour with the method &quot;set_compression&quot;.<div class="spacer">
</div>
If you don't open the file explicitly, it will be auto-opened on the first read or write operation based on the filename set at creation time (or later with the &quot;set_filename&quot; method).<div class="spacer">
</div>
Once a file has been opened, the filehandle must be closed before being able to open another file.</div>
<div class="section">
<h1>STANDARD FUNCTIONS</h1> The standard functions acting on filehandles should accept a Dpkg::Compression::FileHandle object transparently including &quot;open&quot; (only when using the variant with 3 parameters), &quot;close&quot;, &quot;binmode&quot;, &quot;eof&quot;, &quot;fileno&quot;, &quot;getc&quot;, &quot;print&quot;, &quot;printf&quot;, &quot;read&quot;, &quot;sysread&quot;, &quot;say&quot;, &quot;write&quot;, &quot;syswrite&quot;, &quot;seek&quot;, &quot;sysseek&quot;, &quot;tell&quot;.<div class="spacer">
</div>
Note however that &quot;seek&quot; and &quot;sysseek&quot; will only work on uncompressed files as compressed files are really pipes to the compressor programs and you can't seek on a pipe.</div>
<div class="section">
<h1>FileHandle METHODS</h1> The object inherits from FileHandle so all methods that work on this object should work for Dpkg::Compression::FileHandle too. There may be exceptions though.</div>
<div class="section">
<h1>PUBLIC METHODS</h1><dl>
<dt>
my $fh = Dpkg::Compression::FileHandle-&gt;new(%opts)</dt>
<dd>
Creates a new filehandle supporting on-the-fly compression/decompression. Supported options are &quot;filename&quot;, &quot;compression&quot;, &quot;compression_level&quot; (see respective set_* functions) and &quot;add_comp_ext&quot;. If &quot;add_comp_ext&quot; evaluates to true, then the extension corresponding to the selected compression scheme is automatically added to the recorded filename. It's obviously incompatible with automatic detection of the compression method.</dd>
</dl>
<dl>
<dt>
$fh-&gt;ensure_open($mode)</dt>
<dd>
Ensure the file is opened in the requested mode (&quot;r&quot; for read and &quot;w&quot; for write). Opens the file with the recorded filename if needed. If the file is already open but not in the requested mode, then it errors out.</dd>
</dl>
<dl>
<dt>
$fh-&gt;set_compression($comp)</dt>
<dd>
Defines the compression method used. $comp should one of the methods supported by  <b>Dpkg::Compression</b> or &quot;none&quot; or &quot;auto&quot;. &quot;none&quot; indicates that the file is uncompressed and &quot;auto&quot; indicates that the method must be guessed based on the filename extension used.</dd>
</dl>
<dl>
<dt>
$fh-&gt;set_compression_level($level)</dt>
<dd>
Indicate the desired compression level. It should be a value accepted by the function &quot;compression_is_valid_level&quot; of  <b>Dpkg::Compression</b>.</dd>
</dl>
<dl>
<dt>
$fh-&gt;set_filename($name, [$add_comp_ext])</dt>
<dd>
Use $name as filename when the file must be opened/created. If $add_comp_ext is passed, it indicates whether the default extension of the compression method must be automatically added to the filename (or not).</dd>
</dl>
<dl>
<dt>
my $file = $fh-&gt;<i>get_filename()</i></dt>
<dd>
Returns the filename that would be used when the filehandle must be opened (both in read and write mode). This function errors out if &quot;add_comp_ext&quot; is enableactivated while the compression method is set to &quot;auto&quot;. The returned filename includes the extension of the compression method if &quot;add_comp_ext&quot; is enabled.</dd>
</dl>
<dl>
<dt>
$ret = $fh-&gt;<i>use_compression()</i></dt>
<dd>
Returns &quot;0&quot; if no compression is used and the compression method used otherwise. If the compression is set to &quot;auto&quot;, the value returned depends on the extension of the filename obtained with the  <b>get_filename</b> method.</dd>
</dl>
<dl>
<dt>
my $real_fh = $fh-&gt;<i>get_filehandle()</i></dt>
<dd>
Returns the real underlying filehandle. Useful if you want to pass it along in a derived object.</dd>
</dl>
</div>
<div class="section">
<h1>DERIVED OBJECTS</h1> If you want to create an object that inherits from Dpkg::Compression::FileHandle you must be aware that the object is a reference to a GLOB that is returned by  <i>Symbol::gensym()</i> and as such it's not a HASH.<div class="spacer">
</div>
You can store internal data in a hash but you have to use &quot;*$self-&quot;{...}&gt; to access the associated hash like in the example below:<div class="spacer">
</div>
<br/>
    sub set_option {<br/>
        my ($self, $value) = @_;<br/>
        *$self-&gt;{&quot;option&quot;} = $value;<br/>
    }<br/>
</div>
<div class="section">
<h1>AUTHOR</h1> Rapha&#235;l Hertzog &lt;hertzog@debian.org&gt;</div>
<table class="foot">
<tr>
<td class="foot-date">
2010-05-20</td>
<td class="foot-os">
1.16.1.2</td>
</tr>
</table>
</div>
</body>
</html>

