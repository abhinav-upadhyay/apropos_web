<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/linux/style.css" type="text/css" media="all"/>
<title>
Appender::Socket(3pm)</title>
</head>
<body>
<div class="mandoc">
<table class="head">
<tbody>
<tr>
<td class="head-ltitle">
Appender::Socket(3pm)</td>
<td class="head-vol">
User Contributed Perl Documentation</td>
<td class="head-rtitle">
Appender::Socket(3pm)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1>NAME</h1> Log::Log4perl::Appender::Socket - Log to a socket</div>
<div class="section">
<h1>SYNOPSIS</h1><br/>
    use Log::Log4perl::Appender::Socket;<br/>
<br/>
    my $appender = Log::Log4perl::Appender::Socket-&gt;new(<br/>
      PeerAddr =&gt; &quot;server.foo.com&quot;,<br/>
      PeerPort =&gt; 1234,<br/>
    );<br/>
<br/>
    $appender-&gt;log(message =&gt; &quot;Log me\n&quot;);<br/>
</div>
<div class="section">
<h1>DESCRIPTION</h1> This is a simple appender for writing to a socket. It relies on IO::Socket::INET and offers all parameters this module offers.<div class="spacer">
</div>
Upon destruction of the object, pending messages will be flushed and the socket will be closed.<div class="spacer">
</div>
If the appender cannot contact the server during the initialization phase (while running the constructor &quot;new&quot;), it will &quot;die()&quot;.<div class="spacer">
</div>
If the appender fails to log a message because the socket's &quot;send()&quot; method fails (most likely because the server went down), it will try to reconnect once. If it succeeds, the message will be sent. If the reconnect fails, a warning is sent to STDERR and the &quot;log()&quot; method returns, discarding the message.<div class="spacer">
</div>
If the option &quot;silent_recovery&quot; is given to the constructor and set to a true value, the behaviour is different: If the socket connection can't be established at initialization time, a single warning is issued. Every log attempt will then try to establish the connection and discard the message silently if it fails. If you don't even want the warning, set the &quot;no_warning&quot; option to a true value.<div class="spacer">
</div>
Connecting at initialization time may not be the best option when running under Apache1 Apache2/prefork, because the parent process creates the socket and the connections are shared among the forked children--all the children writing to the same socket could intermingle messages.  So instead of that, you can use &quot;defer_connection&quot; which will put off making the connection until the first log message is sent.</div>
<div class="section">
<h1>EXAMPLE</h1> Write a server quickly using the IO::Socket::INET module:<div class="spacer">
</div>
<br/>
    use IO::Socket::INET;<br/>
<br/>
    my $sock = IO::Socket::INET-&gt;new(<br/>
        Listen    =&gt; 5,<br/>
        LocalAddr =&gt; 'localhost',<br/>
        LocalPort =&gt; 12345,<br/>
        Proto     =&gt; 'tcp');<br/>
<br/>
    while(my $client = $sock-&gt;accept()) {<br/>
        print &quot;Client connected\n&quot;;<br/>
        while(&lt;$client&gt;) {<br/>
            print &quot;$_\n&quot;;<br/>
        }<br/>
    }<br/>
<div class="spacer">
</div>
Start it and then run the following script as a client:<div class="spacer">
</div>
<br/>
    use Log::Log4perl qw(:easy);<br/>
<br/>
    my $conf = q{<br/>
        log4perl.category                  = WARN, Socket<br/>
        log4perl.appender.Socket           = Log::Log4perl::Appender::Socket<br/>
        log4perl.appender.Socket.PeerAddr  = localhost<br/>
        log4perl.appender.Socket.PeerPort  = 12345<br/>
        log4perl.appender.Socket.layout    = SimpleLayout<br/>
    };<br/>
<br/>
    Log::Log4perl-&gt;init(\$conf);<br/>
<br/>
    sleep(2);<br/>
<br/>
    for(1..10) {<br/>
        ERROR(&quot;Quack!&quot;);<br/>
        sleep(5);<br/>
    }<br/>
</div>
<div class="section">
<h1>COPYRIGHT AND LICENSE</h1> Copyright 2002-2009 by Mike Schilli &lt;m@perlmeister.com&gt; and Kevin Goess &lt;cpan@goess.org&gt;.<div class="spacer">
</div>
This library is free software; you can redistribute it and/or modify it under the same terms as Perl itself.</div>
<table class="foot">
<tr>
<td class="foot-date">
2010-02-24</td>
<td class="foot-os">
perl v5.10.1</td>
</tr>
</table>
</div>
</body>
</html>

