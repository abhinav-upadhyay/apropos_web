<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/linux/style.css" type="text/css" media="all"/>
<title>
Config::DOMConfigurator(3pm)</title>
</head>
<body>
<div class="mandoc">
<table class="head">
<tbody>
<tr>
<td class="head-ltitle">
Config::DOMConfigurator(3pm)</td>
<td class="head-vol">
User Contributed Perl Documentation</td>
<td class="head-rtitle">
Config::DOMConfigurator(3pm)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1>NAME</h1> Log::Log4perl::Config::DOMConfigurator - reads xml config files</div>
<div class="section">
<h1>SYNOPSIS</h1><br/>
    --------------------------<br/>
    --using the log4j DTD--<br/>
    --------------------------<br/>
<br/>
    &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;<br/>
    &lt;!DOCTYPE log4j:configuration SYSTEM &quot;log4j.dtd&quot;&gt;<br/>
<br/>
    &lt;log4j:configuration xmlns:log4j=&quot;http://jakarta.apache.org/log4j/&quot;&gt;<br/>
<br/>
    &lt;appender name=&quot;FileAppndr1&quot; class=&quot;org.apache.log4j.FileAppender&quot;&gt;<br/>
        &lt;layout class=&quot;Log::Log4perl::Layout::PatternLayout&quot;&gt;<br/>
                &lt;param name=&quot;ConversionPattern&quot;<br/>
                       value=&quot;%d %4r [%t] %-5p %c %t - %m%n&quot;/&gt;<br/>
        &lt;/layout&gt;<br/>
        &lt;param name=&quot;File&quot; value=&quot;t/tmp/DOMtest&quot;/&gt;<br/>
        &lt;param name=&quot;Append&quot; value=&quot;false&quot;/&gt;<br/>
    &lt;/appender&gt;<br/>
<br/>
    &lt;category name=&quot;a.b.c.d&quot; additivity=&quot;false&quot;&gt;<br/>
        &lt;level value=&quot;warn&quot;/&gt;  &lt;!-- note lowercase! --&gt;<br/>
        &lt;appender-ref ref=&quot;FileAppndr1&quot;/&gt;<br/>
    &lt;/category&gt;<br/>
<br/>
   &lt;root&gt;<br/>
        &lt;priority value=&quot;warn&quot;/&gt;<br/>
        &lt;appender-ref ref=&quot;FileAppndr1&quot;/&gt;<br/>
   &lt;/root&gt;<br/>
<br/>
   &lt;/log4j:configuration&gt;<br/>
   <br/>
   <br/>
   <br/>
   --------------------------<br/>
   --using the log4perl DTD--<br/>
   --------------------------<br/>
   <br/>
   &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;<br/>
    &lt;!DOCTYPE log4perl:configuration SYSTEM &quot;log4perl.dtd&quot;&gt;<br/>
<br/>
    &lt;log4perl:configuration xmlns:log4perl=&quot;http://log4perl.sourceforge.net/&quot;<br/>
        threshold=&quot;debug&quot; oneMessagePerAppender=&quot;true&quot;&gt;<br/>
<br/>
    &lt;log4perl:appender name=&quot;jabbender&quot; class=&quot;Log::Dispatch::Jabber&quot;&gt;<br/>
<br/>
            &lt;param-nested name=&quot;login&quot;&gt;<br/>
                   &lt;param name=&quot;hostname&quot; value=&quot;a.jabber.server&quot;/&gt;<br/>
                   &lt;param name=&quot;password&quot; value=&quot;12345&quot;/&gt;<br/>
                   &lt;param name=&quot;port&quot;     value=&quot;5222&quot;/&gt;<br/>
                   &lt;param name=&quot;resource&quot; value=&quot;logger&quot;/&gt;<br/>
                   &lt;param name=&quot;username&quot; value=&quot;bobjones&quot;/&gt;<br/>
            &lt;/param-nested&gt;<br/>
<br/>
            &lt;param name=&quot;to&quot; value=&quot;bob@a.jabber.server&quot;/&gt;<br/>
<br/>
            &lt;param-text name=&quot;to&quot;&gt;<br/>
                  mary@another.jabber.server<br/>
            &lt;/param-text&gt;<br/>
<br/>
            &lt;log4perl:layout class=&quot;org.apache.log4j.PatternLayout&quot;&gt;<br/>
                &lt;param name=&quot;ConversionPattern&quot; value = &quot;%K xx %G %U&quot;/&gt;<br/>
                &lt;cspec name=&quot;K&quot;&gt;<br/>
                    sub { return sprintf &quot;%1x&quot;, $$}<br/>
                &lt;/cspec&gt;<br/>
                &lt;cspec name=&quot;G&quot;&gt;<br/>
                    sub {return 'thisistheGcspec'}<br/>
                &lt;/cspec&gt;<br/>
            &lt;/log4perl:layout&gt;<br/>
    &lt;/log4perl:appender&gt;<br/>
<br/>
    &lt;log4perl:appender name=&quot;DBAppndr2&quot; class=&quot;Log::Log4perl::Appender::DBI&quot;&gt;<br/>
              &lt;param name=&quot;warp_message&quot; value=&quot;0&quot;/&gt;<br/>
              &lt;param name=&quot;datasource&quot; value=&quot;DBI:CSV:f_dir=t/tmp&quot;/&gt;<br/>
              &lt;param name=&quot;bufferSize&quot; value=&quot;2&quot;/&gt;<br/>
              &lt;param name=&quot;password&quot; value=&quot;sub { $ENV{PWD} }&quot;/&gt;<br/>
              &lt;param name=&quot;username&quot; value=&quot;bobjones&quot;/&gt;<br/>
<br/>
              &lt;param-text name=&quot;sql&quot;&gt;<br/>
                  INSERT INTO log4perltest<br/>
                            (loglevel, message, shortcaller, thingid,<br/>
                            category, pkg, runtime1, runtime2)<br/>
                  VALUES<br/>
                             (?,?,?,?,?,?,?,?)<br/>
              &lt;/param-text&gt;<br/>
<br/>
               &lt;param-nested name=&quot;params&quot;&gt;<br/>
                    &lt;param name=&quot;1&quot; value=&quot;%p&quot;/&gt;<br/>
                    &lt;param name=&quot;3&quot; value=&quot;%5.5l&quot;/&gt;<br/>
                    &lt;param name=&quot;5&quot; value=&quot;%c&quot;/&gt;<br/>
                    &lt;param name=&quot;6&quot; value=&quot;%C&quot;/&gt;<br/>
               &lt;/param-nested&gt;<br/>
<br/>
               &lt;layout class=&quot;Log::Log4perl::Layout::NoopLayout&quot;/&gt;<br/>
    &lt;/log4perl:appender&gt;<br/>
<br/>
    &lt;category name=&quot;animal.dog&quot;&gt;<br/>
               &lt;priority value=&quot;info&quot;/&gt;<br/>
               &lt;appender-ref ref=&quot;jabbender&quot;/&gt;<br/>
               &lt;appender-ref ref=&quot;DBAppndr2&quot;/&gt;<br/>
    &lt;/category&gt;<br/>
<br/>
    &lt;category name=&quot;plant&quot;&gt;<br/>
            &lt;priority value=&quot;debug&quot;/&gt;<br/>
            &lt;appender-ref ref=&quot;DBAppndr2&quot;/&gt;<br/>
    &lt;/category&gt;<br/>
<br/>
    &lt;PatternLayout&gt;<br/>
        &lt;cspec name=&quot;U&quot;&gt;&lt;![CDATA[<br/>
            sub {<br/>
                return &quot;UID $&lt; GID $(&quot;;<br/>
            }<br/>
        ]]&gt;&lt;/cspec&gt;<br/>
    &lt;/PatternLayout&gt;<br/>
<br/>
    &lt;/log4perl:configuration&gt;<br/>
</div>
<div class="section">
<h1>DESCRIPTION</h1> This module implements an XML config, complementing the properties-style config described elsewhere.</div>
<div class="section">
<h1>WHY</h1> &quot;Why would I want my config in XML?&quot; you ask.  Well, there are a couple reasons you might want to.  Maybe you have a personal preference for XML.  Maybe you manage your config with other tools that have an affinity for XML, like XML-aware editors or automated config generators.  Or maybe (and this is the big one) you don't like having to run your application just to check the syntax of your config file.<div class="spacer">
</div>
By using an XML config and referencing a DTD, you can use a namespace-aware validating parser to see if your XML config at least follows the rules set in the DTD.</div>
<div class="section">
<h1>HOW</h1> To reference a DTD, drop this in after the &lt;?xml...&gt; declaration in your config file:<div class="spacer">
</div>
<br/>
    &lt;!DOCTYPE log4perl:configuration SYSTEM &quot;log4perl.dtd&quot;&gt;<br/>
<div class="spacer">
</div>
That tells the parser to validate your config against the DTD in &quot;log4perl.dtd&quot;, which is available in the xml/ directory of the log4perl distribution.  Note that you'll also need to grab the log4j-1.2.dtd from there as well, since the it's included by log4perl.dtd.<div class="spacer">
</div>
Namespace-aware validating parsers are not the norm in Perl. But the Xerces project (http://xml.apache.org/xerces-c/index.html --lots of binaries available, even rpm's)  does provide just such a parser that you can use like this:<div class="spacer">
</div>
<br/>
    StdInParse -ns -v &lt; my-log4perl-config.xml<br/>
<div class="spacer">
</div>
This module itself does not use a validating parser, the obvious one XML::DOM::ValParser doesn't seem to handle namespaces.</div>
<div class="section">
<h1>WHY TWO DTDs</h1> The log4j DTD is from the log4j project, they designed it to handle their needs.  log4perl has added some extensions to the original log4j functionality which needed some extensions to the log4j DTD.  If you aren't using these features then you can validate your config against the log4j dtd and know that you're using unadulterated log4j config tags.<div class="spacer">
</div>
The features added by the log4perl dtd are:<dl>
<dt>
1 oneMessagePerAppender global setting</dt>
<dd>
<br/>
    log4perl.oneMessagePerAppender=1<br/>
</dd>
</dl>
<dl>
<dt>
2 globally defined user conversion specifiers</dt>
<dd>
<br/>
    log4perl.PatternLayout.cspec.G=sub { return &quot;UID $&lt; GID $(&quot;; }<br/>
</dd>
</dl>
<dl>
<dt>
3 appender-local custom conversion specifiers</dt>
<dd>
<br/>
     log4j.appender.appndr1.layout.cspec.K = sub {return sprintf &quot;%1x&quot;, $$ }<br/>
</dd>
</dl>
<dl>
<dt>
4 nested options</dt>
<dd>
<br/>
     log4j.appender.jabbender          = Log::Dispatch::Jabber<br/>
     #(note how these are nested under 'login')<br/>
     log4j.appender.jabbender.login.hostname = a.jabber.server<br/>
     log4j.appender.jabbender.login.port     = 5222<br/>
     log4j.appender.jabbender.login.username = bobjones<br/>
</dd>
</dl>
<dl>
<dt>
5 the log4perl-specific filters, see Log::Log4perl::Filter, lots of examples in t/044XML-Filter.t, here's a short one:</dt>
<dd>
<br/>
  &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; <br/>
  &lt;!DOCTYPE log4perl:configuration SYSTEM &quot;log4perl.dtd&quot;&gt;<br/>
<br/>
  &lt;log4perl:configuration xmlns:log4perl=&quot;http://log4perl.sourceforge.net/&quot;&gt;<br/>
   <br/>
  &lt;appender name=&quot;A1&quot; class=&quot;Log::Log4perl::Appender::TestBuffer&quot;&gt;<br/>
        &lt;layout class=&quot;Log::Log4perl::Layout::SimpleLayout&quot;/&gt;<br/>
        &lt;filter class=&quot;Log::Log4perl::Filter::Boolean&quot;&gt;<br/>
            &lt;param name=&quot;logic&quot; value=&quot;!Match3 &amp;amp;&amp;amp; (Match1 || Match2)&quot;/&gt; <br/>
        &lt;/filter&gt;<br/>
  &lt;/appender&gt;   <br/>
  <br/>
  &lt;appender name=&quot;A2&quot; class=&quot;Log::Log4perl::Appender::TestBuffer&quot;&gt;<br/>
        &lt;layout class=&quot;Log::Log4perl::Layout::SimpleLayout&quot;/&gt;<br/>
        &lt;filter-ref id=&quot;Match1&quot;/&gt;<br/>
  &lt;/appender&gt;   <br/>
  <br/>
  &lt;log4perl:filter name=&quot;Match1&quot; value=&quot;sub { /let this through/ }&quot; /&gt;<br/>
  <br/>
  &lt;log4perl:filter name=&quot;Match2&quot;&gt;<br/>
        sub { <br/>
            /and that, too/ <br/>
        }<br/>
   &lt;/log4perl:filter&gt;<br/>
  <br/>
  &lt;log4perl:filter name=&quot;Match3&quot; class=&quot;Log::Log4perl::Filter::StringMatch&quot;&gt;<br/>
    &lt;param name=&quot;StringToMatch&quot; value=&quot;suppress&quot;/&gt;<br/>
    &lt;param name=&quot;AcceptOnMatch&quot; value=&quot;true&quot;/&gt;<br/>
  &lt;/log4perl:filter&gt;<br/>
  <br/>
  &lt;log4perl:filter name=&quot;MyBoolean&quot; class=&quot;Log::Log4perl::Filter::Boolean&quot;&gt;<br/>
    &lt;param name=&quot;logic&quot; value=&quot;!Match3 &amp;amp;&amp;amp; (Match1 || Match2)&quot;/&gt;<br/>
  &lt;/log4perl:filter&gt;<br/>
  <br/>
   <br/>
   &lt;root&gt;<br/>
           &lt;priority value=&quot;info&quot;/&gt;<br/>
           &lt;appender-ref ref=&quot;A1&quot;/&gt;<br/>
   &lt;/root&gt;<br/>
   <br/>
   &lt;/log4perl:configuration&gt;<br/>
</dd>
</dl>
<div class="spacer">
</div>
So we needed to extend the log4j dtd to cover these additions. Now I could have just taken a 'steal this code' approach and mixed parts of the log4j dtd into a log4perl dtd, but that would be cut-n-paste programming.  So I've used namespaces and<dl>
<dt>
&#8226;</dt>
<dd>
replaced three elements:</dd>
</dl>
<div style="margin-left: 4.00ex;">
<dl>
<dt>
&lt;log4perl:configuration&gt;</dt>
<dd>
handles #1) and accepts &lt;PatternLayout&gt;</dd>
</dl>
<dl>
<dt>
&lt;log4perl:appender&gt;</dt>
<dd>
accepts &lt;param-nested&gt; and &lt;param-text&gt;</dd>
</dl>
<dl>
<dt>
&lt;log4perl:layout&gt;</dt>
<dd>
accepts custom cspecs for #3)</dd>
</dl>
</div>
<div style="margin-left: 4.00ex;">
</div>
<dl>
<dt>
&#8226;</dt>
<dd>
added a &lt;param-nested&gt; element (complementing the &lt;param&gt; element)<br/>
    to handle #4)</dd>
</dl>
<dl>
<dt>
&#8226;</dt>
<dd>
added a root &lt;PatternLayout&gt; element to handle #2)</dd>
</dl>
<dl>
<dt>
&#8226;</dt>
<dd>
added &lt;param-text&gt; which lets you put things like perl code<br/>
    into escaped CDATA between the tags, so you don't have to worry<br/>
    about escaping characters and quotes</dd>
</dl>
<dl>
<dt>
&#8226;</dt>
<dd>
added &lt;cspec&gt;</dd>
</dl>
<div class="spacer">
</div>
See the examples up in the &quot;SYNOPSIS&quot; for how all that gets used.</div>
<div class="section">
<h1>WHY NAMESPACES</h1> I liked the idea of using the log4j DTD  <i>in situ</i>, so I used namespaces to extend it.  If you really don't like having to type &lt;log4perl:appender&gt; instead of just &lt;appender&gt;, you can make your own DTD combining the two DTDs and getting rid of the namespace prefixes.  Then you can validate against that, and log4perl should accept it just fine.</div>
<div class="section">
<h1>VARIABLE SUBSTITUTION</h1> This supports variable substitution like &quot;${foobar}&quot; in text and in attribute values except for appender-ref.  If an environment variable is defined for that name, its value is substituted. So you can do stuff like<div class="spacer">
</div>
<br/>
        &lt;param name=&quot;${hostname}&quot; value=&quot;${hostnameval}.foo.com&quot;/&gt;<br/>
        &lt;param-text name=&quot;to&quot;&gt;${currentsysadmin}@foo.com&lt;/param-text&gt;<br/>
</div>
<div class="section">
<h1>REQUIRES</h1> To use this module you need XML::DOM installed.<div class="spacer">
</div>
To use the log4perl.dtd, you'll have to reference it in your XML config, and you'll also need to note that log4perl.dtd references the log4j dtd as &quot;log4j-1.2.dtd&quot;, so your validator needs to be able to find that file as well.  If you don't like having to schlep two files around, feel free to dump the contents of &quot;log4j-1.2.dtd&quot; into your &quot;log4perl.dtd&quot; file.</div>
<div class="section">
<h1>CAVEATS</h1> You can't mix a multiple param-nesteds with the same name, I'm going to leave that for now, there's presently no need for a list of structs in the config.</div>
<div class="section">
<h1>CHANGES</h1> 0.03 2/26/2003 Added support for log4perl extensions to the log4j dtd</div>
<div class="section">
<h1>SEE ALSO</h1> t/038XML-DOM1.t, t/039XML-DOM2.t for examples<div class="spacer">
</div>
xml/log4perl.dtd, xml/log4j-1.2.dtd<div class="spacer">
</div>
Log::Log4perl::Config<div class="spacer">
</div>
Log::Log4perl::Config::PropertyConfigurator<div class="spacer">
</div>
Log::Log4perl::Config::LDAPConfigurator (coming soon!)<div class="spacer">
</div>
The code is brazenly modeled on log4j's DOMConfigurator class, (by Christopher Taylor, Ceki GA~XlcA~X, and Anders Kristensen) and any perceived similarity is not coincidental.</div>
<div class="section">
<h1>COPYRIGHT AND LICENSE</h1> Copyright 2002-2009 by Mike Schilli &lt;m@perlmeister.com&gt; and Kevin Goess &lt;cpan@goess.org&gt;.<div class="spacer">
</div>
This library is free software; you can redistribute it and/or modify it under the same terms as Perl itself.</div>
<table class="foot">
<tr>
<td class="foot-date">
2010-02-24</td>
<td class="foot-os">
perl v5.10.1</td>
</tr>
</table>
</div>
</body>
</html>

