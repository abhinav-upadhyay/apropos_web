<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/linux/style.css" type="text/css" media="all"/>
<title>
Moose::Cookbook::Basics::Recipe6(3pm)</title>
</head>
<body>
<div class="mandoc">
<table class="head">
<tbody>
<tr>
<td class="head-ltitle">
Moose::Cookbook::Basics::Recipe6(3pm)</td>
<td class="head-vol">
User Contributed Perl Documentation</td>
<td class="head-rtitle">
Moose::Cookbook::Basics::Recipe6(3pm)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1>NAME</h1> Moose::Cookbook::Basics::Recipe6 - The augment/inner example</div>
<div class="section">
<h1>VERSION</h1> version 2.0401</div>
<div class="section">
<h1>SYNOPSIS</h1><br/>
  package Document::Page;<br/>
  use Moose;<br/>
<br/>
  has 'body' =&gt; ( is =&gt; 'rw', isa =&gt; 'Str', default =&gt; sub {''} );<br/>
<br/>
  sub create {<br/>
      my $self = shift;<br/>
      $self-&gt;open_page;<br/>
      inner();<br/>
      $self-&gt;close_page;<br/>
  }<br/>
<br/>
  sub append_body {<br/>
      my ( $self, $appendage ) = @_;<br/>
      $self-&gt;body( $self-&gt;body . $appendage );<br/>
  }<br/>
<br/>
  sub open_page  { (shift)-&gt;append_body('&lt;page&gt;') }<br/>
  sub close_page { (shift)-&gt;append_body('&lt;/page&gt;') }<br/>
<br/>
  package Document::PageWithHeadersAndFooters;<br/>
  use Moose;<br/>
<br/>
  extends 'Document::Page';<br/>
<br/>
  augment 'create' =&gt; sub {<br/>
      my $self = shift;<br/>
      $self-&gt;create_header;<br/>
      inner();<br/>
      $self-&gt;create_footer;<br/>
  };<br/>
<br/>
  sub create_header { (shift)-&gt;append_body('&lt;header/&gt;') }<br/>
  sub create_footer { (shift)-&gt;append_body('&lt;footer/&gt;') }<br/>
<br/>
  package TPSReport;<br/>
  use Moose;<br/>
<br/>
  extends 'Document::PageWithHeadersAndFooters';<br/>
<br/>
  augment 'create' =&gt; sub {<br/>
      my $self = shift;<br/>
      $self-&gt;create_tps_report;<br/>
      inner();<br/>
  };<br/>
<br/>
  sub create_tps_report {<br/>
      (shift)-&gt;append_body('&lt;report type=&quot;tps&quot;/&gt;');<br/>
  }<br/>
<br/>
  # &lt;page&gt;&lt;header/&gt;&lt;report type=&quot;tps&quot;/&gt;&lt;footer/&gt;&lt;/page&gt;<br/>
  my $report_xml = TPSReport-&gt;new-&gt;create;<br/>
</div>
<div class="section">
<h1>DESCRIPTION</h1> This recipe shows how the &quot;augment&quot; method modifier works. This modifier reverses the normal subclass to parent method resolution order. With an &quot;augment&quot; modifier the  <i>least</i> specific method is called first. Each successive call to &quot;inner&quot; descends the inheritance tree, ending at the most specific subclass.<div class="spacer">
</div>
The &quot;augment&quot; modifier lets you design a parent class that can be extended in a specific way. The parent provides generic wrapper functionality, and the subclasses fill in the details.<div class="spacer">
</div>
In the example above, we've created a set of document classes, with the most specific being the &quot;TPSReport&quot; class.<div class="spacer">
</div>
We start with the least specific class, &quot;Document::Page&quot;. Its create method contains a call to &quot;inner()&quot;:<div class="spacer">
</div>
<br/>
  sub create {<br/>
      my $self = shift;<br/>
      $self-&gt;open_page;<br/>
      inner();<br/>
      $self-&gt;close_page;<br/>
  }<br/>
<div class="spacer">
</div>
The &quot;inner&quot; function is exported by &quot;Moose&quot;, and is like &quot;super&quot; for augmented methods. When &quot;inner&quot; is called, Moose finds the next method in the chain, which is the &quot;augment&quot; modifier in &quot;Document::PageWithHeadersAndFooters&quot;. You'll note that we can call &quot;inner&quot; in our modifier:<div class="spacer">
</div>
<br/>
  augment 'create' =&gt; sub {<br/>
      my $self = shift;<br/>
      $self-&gt;create_header;<br/>
      inner();<br/>
      $self-&gt;create_footer;<br/>
  };<br/>
<div class="spacer">
</div>
This finds the next most specific modifier, in the &quot;TPSReport&quot; class.<div class="spacer">
</div>
Finally, in the &quot;TPSReport&quot; class, the chain comes to an end:<div class="spacer">
</div>
<br/>
  augment 'create' =&gt; sub {<br/>
      my $self = shift;<br/>
      $self-&gt;create_tps_report;<br/>
      inner();<br/>
  };<br/>
<div class="spacer">
</div>
We do call the &quot;inner&quot; function one more time, but since there is no more specific subclass, this is a no-op. Making this call means we can easily subclass &quot;TPSReport&quot; in the future.</div>
<div class="section">
<h1>CONCLUSION</h1> The &quot;augment&quot; modifier is a powerful tool for creating a set of nested wrappers. It's not something you will need often, but when you do, it is very handy.</div>
<div class="section">
<h1>AUTHOR</h1> Moose is maintained by the Moose Cabal, along with the help of many contributors. See &quot;CABAL&quot; in Moose and &quot;CONTRIBUTORS&quot; in Moose for details.</div>
<div class="section">
<h1>COPYRIGHT AND LICENSE</h1> This software is copyright (c) 2011 by Infinity Interactive, Inc..<div class="spacer">
</div>
This is free software; you can redistribute it and/or modify it under the same terms as the Perl 5 programming language system itself.</div>
<table class="foot">
<tr>
<td class="foot-date">
2011-11-17</td>
<td class="foot-os">
perl v5.14.2</td>
</tr>
</table>
</div>
</body>
</html>

