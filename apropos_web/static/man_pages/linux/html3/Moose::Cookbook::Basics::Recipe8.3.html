<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/linux/style.css" type="text/css" media="all"/>
<title>
Moose::Cookbook::Basics::Recipe8(3pm)</title>
</head>
<body>
<div class="mandoc">
<table class="head">
<tbody>
<tr>
<td class="head-ltitle">
Moose::Cookbook::Basics::Recipe8(3pm)</td>
<td class="head-vol">
User Contributed Perl Documentation</td>
<td class="head-rtitle">
Moose::Cookbook::Basics::Recipe8(3pm)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1>NAME</h1> Moose::Cookbook::Basics::Recipe8 - Builder methods and lazy_build</div>
<div class="section">
<h1>VERSION</h1> version 2.0401</div>
<div class="section">
<h1>SYNOPSIS</h1><br/>
  package BinaryTree;<br/>
  use Moose;<br/>
<br/>
  has 'node' =&gt; (is =&gt; 'rw', isa =&gt; 'Any');<br/>
<br/>
  has 'parent' =&gt; (<br/>
      is        =&gt; 'rw',<br/>
      isa       =&gt; 'BinaryTree',<br/>
      predicate =&gt; 'has_parent',<br/>
      weak_ref  =&gt; 1,<br/>
  );<br/>
<br/>
  has 'left' =&gt; (<br/>
      is        =&gt; 'rw',<br/>
      isa       =&gt; 'BinaryTree',<br/>
      predicate =&gt; 'has_left',<br/>
      lazy      =&gt; 1,<br/>
      builder   =&gt; '_build_child_tree',<br/>
  );<br/>
<br/>
  has 'right' =&gt; (<br/>
      is        =&gt; 'rw',<br/>
      isa       =&gt; 'BinaryTree',<br/>
      predicate =&gt; 'has_right',<br/>
      lazy      =&gt; 1,<br/>
      builder   =&gt; '_build_child_tree',<br/>
  );<br/>
<br/>
  before 'right', 'left' =&gt; sub {<br/>
      my ($self, $tree) = @_;<br/>
      $tree-&gt;parent($self) if defined $tree;<br/>
  };<br/>
<br/>
  sub _build_child_tree {<br/>
      my $self = shift;<br/>
<br/>
      return BinaryTree-&gt;new( parent =&gt; $self );<br/>
  }<br/>
</div>
<div class="section">
<h1>DESCRIPTION</h1> If you've already read Moose::Cookbook::Basics::Recipe3, then this example should look very familiar. In fact, all we've done here is replace the attribute's &quot;default&quot; parameter with a &quot;builder&quot;.<div class="spacer">
</div>
In this particular case, the &quot;default&quot; and &quot;builder&quot; options act in exactly the same way. When the &quot;left&quot; or &quot;right&quot; attribute is read, Moose calls the builder method to initialize the attribute.<div class="spacer">
</div>
Note that Moose calls the builder method <i>on the object which has the</i>  <i>attribute</i>. Here's an example:<div class="spacer">
</div>
<br/>
  my $tree = BinaryTree-&gt;new();<br/>
<br/>
  my $left = $tree-&gt;left();<br/>
<div class="spacer">
</div>
When &quot;$tree-&gt;left()&quot; is called, Moose calls &quot;$tree-&gt;_build_child_tree()&quot; in order to populate the &quot;left&quot; attribute. If we had passed &quot;left&quot; to the original constructor, the builder would not be called.<div class="spacer">
</div>
There are some differences between &quot;default&quot; and &quot;builder&quot;. Notably, a builder is subclassable, and can be composed from a role. See Moose::Manual::Attributes for more details.<div class="subsection">
<h2>The lazy_build shortcut</h2> The &quot;lazy_build&quot; attribute option can be used as sugar to specify a whole set of attribute options at once:<div class="spacer">
</div>
<br/>
  has 'animal' =&gt; (<br/>
      is         =&gt; 'ro',<br/>
      isa        =&gt; 'Animal',<br/>
      lazy_build =&gt; 1,<br/>
  );<br/>
<div class="spacer">
</div>
This is a shorthand for:<div class="spacer">
</div>
<br/>
  has 'animal' =&gt; (<br/>
      is        =&gt; 'ro',<br/>
      isa       =&gt; 'Animal',<br/>
      required  =&gt; 1,<br/>
      lazy      =&gt; 1,<br/>
      builder   =&gt; '_build_animal',<br/>
      predicate =&gt; 'has_animal',<br/>
      clearer   =&gt; 'clear_animal',<br/>
  );<br/>
<div class="spacer">
</div>
If your attribute starts with an underscore, Moose is smart and will do the right thing with the &quot;predicate&quot; and &quot;clearer&quot;, making them both start with an underscore. The &quot;builder&quot; method  <i>always</i> starts with an underscore.<div class="spacer">
</div>
You can read more about &quot;lazy_build&quot; in Moose::Meta::Attribute</div>
</div>
<div class="section">
<h1>CONCLUSION</h1> The &quot;builder&quot; option is a more OO-friendly version of the &quot;default&quot; functionality. It also separates the default-generating code into a well-defined method. Sprinkling your attribute definitions with anonymous subroutines can be quite ugly and hard to follow.</div>
<div class="section">
<h1>AUTHOR</h1> Moose is maintained by the Moose Cabal, along with the help of many contributors. See &quot;CABAL&quot; in Moose and &quot;CONTRIBUTORS&quot; in Moose for details.</div>
<div class="section">
<h1>COPYRIGHT AND LICENSE</h1> This software is copyright (c) 2011 by Infinity Interactive, Inc..<div class="spacer">
</div>
This is free software; you can redistribute it and/or modify it under the same terms as the Perl 5 programming language system itself.</div>
<table class="foot">
<tr>
<td class="foot-date">
2011-11-17</td>
<td class="foot-os">
perl v5.14.2</td>
</tr>
</table>
</div>
</body>
</html>

