<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/linux/style.css" type="text/css" media="all"/>
<title>
Moose::Cookbook::Roles::Recipe1(3pm)</title>
</head>
<body>
<div class="mandoc">
<table class="head">
<tbody>
<tr>
<td class="head-ltitle">
Moose::Cookbook::Roles::Recipe1(3pm)</td>
<td class="head-vol">
User Contributed Perl Documentation</td>
<td class="head-rtitle">
Moose::Cookbook::Roles::Recipe1(3pm)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1>NAME</h1> Moose::Cookbook::Roles::Recipe1 - The Moose::Role example</div>
<div class="section">
<h1>VERSION</h1> version 2.0401</div>
<div class="section">
<h1>SYNOPSIS</h1><br/>
  package Eq;<br/>
  use Moose::Role;<br/>
<br/>
  requires 'equal_to';<br/>
<br/>
  sub not_equal_to {<br/>
      my ( $self, $other ) = @_;<br/>
      not $self-&gt;equal_to($other);<br/>
  }<br/>
<br/>
  package Comparable;<br/>
  use Moose::Role;<br/>
<br/>
  with 'Eq';<br/>
<br/>
  requires 'compare';<br/>
<br/>
  sub equal_to {<br/>
      my ( $self, $other ) = @_;<br/>
      $self-&gt;compare($other) == 0;<br/>
  }<br/>
<br/>
  sub greater_than {<br/>
      my ( $self, $other ) = @_;<br/>
      $self-&gt;compare($other) == 1;<br/>
  }<br/>
<br/>
  sub less_than {<br/>
      my ( $self, $other ) = @_;<br/>
      $self-&gt;compare($other) == -1;<br/>
  }<br/>
<br/>
  sub greater_than_or_equal_to {<br/>
      my ( $self, $other ) = @_;<br/>
      $self-&gt;greater_than($other) || $self-&gt;equal_to($other);<br/>
  }<br/>
<br/>
  sub less_than_or_equal_to {<br/>
      my ( $self, $other ) = @_;<br/>
      $self-&gt;less_than($other) || $self-&gt;equal_to($other);<br/>
  }<br/>
<br/>
  package Printable;<br/>
  use Moose::Role;<br/>
<br/>
  requires 'to_string';<br/>
<br/>
  package US::Currency;<br/>
  use Moose;<br/>
<br/>
  with 'Comparable', 'Printable';<br/>
<br/>
  has 'amount' =&gt; ( is =&gt; 'rw', isa =&gt; 'Num', default =&gt; 0 );<br/>
<br/>
  sub compare {<br/>
      my ( $self, $other ) = @_;<br/>
      $self-&gt;amount &lt;=&gt; $other-&gt;amount;<br/>
  }<br/>
<br/>
  sub to_string {<br/>
      my $self = shift;<br/>
      sprintf '$%0.2f USD' =&gt; $self-&gt;amount;<br/>
  }<br/>
</div>
<div class="section">
<h1>DESCRIPTION</h1> Roles have two primary purposes: as interfaces, and as a means of code reuse. This recipe demonstrates the latter, with roles that define comparison and display code for objects.<div class="spacer">
</div>
Let's start with &quot;Eq&quot;. First, note that we've replaced &quot;use Moose&quot; with &quot;use Moose::Role&quot;. We also have a new sugar function, &quot;requires&quot;:<div class="spacer">
</div>
<br/>
  requires 'equal_to';<br/>
<div class="spacer">
</div>
This says that any class which consumes this role must provide an &quot;equal_to&quot; method. It can provide this method directly, or by consuming some other role.<div class="spacer">
</div>
The &quot;Eq&quot; role defines its &quot;not_equal_to&quot; method in terms of the required &quot;equal_to&quot; method. This lets us minimize the methods that consuming classes must provide.<div class="spacer">
</div>
The next role, &quot;Comparable&quot;, builds on the &quot;Eq&quot; role. We include &quot;Eq&quot; in &quot;Comparable&quot; using &quot;with&quot;, another new sugar function:<div class="spacer">
</div>
<br/>
  with 'Eq';<br/>
<div class="spacer">
</div>
The &quot;with&quot; function takes a list of roles to consume. In our example, the &quot;Comparable&quot; role provides the &quot;equal_to&quot; method required by &quot;Eq&quot;. However, it could opt not to, in which case a class that consumed &quot;Comparable&quot; would have to provide its own &quot;equal_to&quot;. In other words, a role can consume another role  <i>without</i> providing any required methods.<div class="spacer">
</div>
The &quot;Comparable&quot; role requires a method,  &quot;compare&quot;:<div class="spacer">
</div>
<br/>
  requires 'compare';<br/>
<div class="spacer">
</div>
The &quot;Comparable&quot; role also provides a number of other methods, all of which ultimately rely on &quot;compare&quot;.<div class="spacer">
</div>
<br/>
  sub equal_to {<br/>
      my ( $self, $other ) = @_;<br/>
      $self-&gt;compare($other) == 0;<br/>
  }<br/>
<br/>
  sub greater_than {<br/>
      my ( $self, $other ) = @_;<br/>
      $self-&gt;compare($other) == 1;<br/>
  }<br/>
<br/>
  sub less_than {<br/>
      my ( $self, $other ) = @_;<br/>
      $self-&gt;compare($other) == -1;<br/>
  }<br/>
<br/>
  sub greater_than_or_equal_to {<br/>
      my ( $self, $other ) = @_;<br/>
      $self-&gt;greater_than($other) || $self-&gt;equal_to($other);<br/>
  }<br/>
<br/>
  sub less_than_or_equal_to {<br/>
      my ( $self, $other ) = @_;<br/>
      $self-&gt;less_than($other) || $self-&gt;equal_to($other);<br/>
  }<br/>
<div class="spacer">
</div>
Finally, we define the &quot;Printable&quot; role. This role exists solely to provide an interface. It has no methods, just a list of required methods. In this case, it just requires a &quot;to_string&quot; method.<div class="spacer">
</div>
An interface role is useful because it defines both a method and a  <i>name</i>. We know that any class which does this role has a &quot;to_string&quot; method, but we can also assume that this method has the semantics we want. Presumably, in real code we would define those semantics in the documentation for the &quot;Printable&quot; role. (1)<div class="spacer">
</div>
Finally, we have the &quot;US::Currency&quot; class which consumes both the &quot;Comparable&quot; and &quot;Printable&quot; roles.<div class="spacer">
</div>
<br/>
  with 'Comparable', 'Printable';<br/>
<div class="spacer">
</div>
It also defines a regular Moose attribute, &quot;amount&quot;:<div class="spacer">
</div>
<br/>
  has 'amount' =&gt; ( is =&gt; 'rw', isa =&gt; 'Num', default =&gt; 0 );<br/>
<div class="spacer">
</div>
Finally we see the implementation of the methods required by our roles. We have a &quot;compare&quot; method:<div class="spacer">
</div>
<br/>
  sub compare {<br/>
      my ( $self, $other ) = @_;<br/>
      $self-&gt;amount &lt;=&gt; $other-&gt;amount;<br/>
  }<br/>
<div class="spacer">
</div>
By consuming the &quot;Comparable&quot; role and defining this method, we gain the following methods for free: &quot;equal_to&quot;, &quot;greater_than&quot;, &quot;less_than&quot;, &quot;greater_than_or_equal_to&quot; and &quot;less_than_or_equal_to&quot;.<div class="spacer">
</div>
Then we have our &quot;to_string&quot; method:<div class="spacer">
</div>
<br/>
  sub to_string {<br/>
      my $self = shift;<br/>
      sprintf '$%0.2f USD' =&gt; $self-&gt;amount;<br/>
  }<br/>
</div>
<div class="section">
<h1>CONCLUSION</h1> Roles can be very powerful. They are a great way of encapsulating reusable behavior, as well as communicating (semantic and interface) information about the methods our classes provide.</div>
<div class="section">
<h1>FOOTNOTES</h1><dl>
<dt>
(1)</dt>
<dd>
Consider two classes, &quot;Runner&quot; and &quot;Process&quot;, both of which define a &quot;run&quot; method. If we just require that an object implements a &quot;run&quot; method, we still aren't saying anything about what that method  <i>actually does</i>. If we require an object that implements the &quot;Executable&quot; role, we're saying something about semantics.</dd>
</dl>
</div>
<div class="section">
<h1>AUTHOR</h1> Moose is maintained by the Moose Cabal, along with the help of many contributors. See &quot;CABAL&quot; in Moose and &quot;CONTRIBUTORS&quot; in Moose for details.</div>
<div class="section">
<h1>COPYRIGHT AND LICENSE</h1> This software is copyright (c) 2011 by Infinity Interactive, Inc..<div class="spacer">
</div>
This is free software; you can redistribute it and/or modify it under the same terms as the Perl 5 programming language system itself.</div>
<table class="foot">
<tr>
<td class="foot-date">
2011-11-17</td>
<td class="foot-os">
perl v5.14.2</td>
</tr>
</table>
</div>
</body>
</html>

