<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/linux/style.css" type="text/css" media="all"/>
<title>
Moose::Manual::Construction(3pm)</title>
</head>
<body>
<div class="mandoc">
<table class="head">
<tbody>
<tr>
<td class="head-ltitle">
Moose::Manual::Construction(3pm)</td>
<td class="head-vol">
User Contributed Perl Documentation</td>
<td class="head-rtitle">
Moose::Manual::Construction(3pm)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1>NAME</h1> Moose::Manual::Construction - Object construction (and destruction) with Moose</div>
<div class="section">
<h1>VERSION</h1> version 2.0401</div>
<div class="section">
<h1>WHERE'S THE CONSTRUCTOR?</h1>  <b>Do not define a </b><b>&quot;new()&quot;</b><b> method for your classes!</b><div class="spacer">
</div>
When you &quot;use Moose&quot; in your class, your class becomes a subclass of Moose::Object. The Moose::Object provides a &quot;new()&quot; method for your class. If you follow our recommendations in Moose::Manual::BestPractices and make your class immutable, then you actually get a class-specific &quot;new()&quot; method &quot;inlined&quot; in your class.</div>
<div class="section">
<h1>OBJECT CONSTRUCTION AND ATTRIBUTES</h1> The Moose-provided constructor accepts a hash or hash reference of named parameters matching your attributes (actually, matching their &quot;init_arg&quot;s). This is just another way in which Moose keeps you from worrying  <i>how</i> classes are implemented. Simply define a class and you're ready to start creating objects!</div>
<div class="section">
<h1>OBJECT CONSTRUCTION HOOKS</h1> Moose lets you hook into object construction. You can validate an object's state, do logging, customize construction from parameters which do not match your attributes, or maybe allow non-hash(ref) constructor arguments. You can do this by creating &quot;BUILD&quot; and/or &quot;BUILDARGS&quot; methods.<div class="spacer">
</div>
If these methods exist in your class, Moose will arrange for them to be called as part of the object construction process.<div class="subsection">
<h2>BUILDARGS</h2> The &quot;BUILDARGS&quot; method is called as a class method  <i>before</i> an object is created. It will receive all of the arguments that were passed to &quot;new()&quot;  <i>as-is</i>, and is expected to return a hash reference. This hash reference will be used to construct the object, so it should contain keys matching your attributes' names (well, &quot;init_arg&quot;s).<div class="spacer">
</div>
One common use for &quot;BUILDARGS&quot; is to accommodate a non-hash(ref) calling style. For example, we might want to allow our Person class to be called with a single argument of a social security number, &quot;Person-&gt;new($ssn)&quot;.<div class="spacer">
</div>
Without a &quot;BUILDARGS&quot; method, Moose will complain, because it expects a hash or hash reference. We can use the &quot;BUILDARGS&quot; method to accommodate this calling style:<div class="spacer">
</div>
<br/>
  around BUILDARGS =&gt; sub {<br/>
      my $orig  = shift;<br/>
      my $class = shift;<br/>
<br/>
      if ( @_ == 1 &amp;&amp; !ref $_[0] ) {<br/>
          return $class-&gt;$orig( ssn =&gt; $_[0] );<br/>
      }<br/>
      else {<br/>
          return $class-&gt;$orig(@_);<br/>
      }<br/>
  };<br/>
<div class="spacer">
</div>
Note the call to &quot;$class-&gt;$orig&quot;. This will call the default &quot;BUILDARGS&quot; in Moose::Object. This method takes care of distinguishing between a hash reference and a plain hash for you.</div>
<div class="subsection">
<h2>BUILD</h2> The &quot;BUILD&quot; method is called  <i>after</i> an object is created. There are several reasons to use a &quot;BUILD&quot; method. One of the most common is to check that the object state is valid. While we can validate individual attributes through the use of types, we can't validate the state of a whole object that way.<div class="spacer">
</div>
<br/>
  sub BUILD {<br/>
      my $self = shift;<br/>
<br/>
      if ( $self-&gt;country_of_residence eq 'USA' ) {<br/>
          die 'All US residents must have an SSN'<br/>
              unless $self-&gt;has_ssn;<br/>
      }<br/>
  }<br/>
<div class="spacer">
</div>
Another use of a &quot;BUILD&quot; method could be for logging or tracking object creation.<div class="spacer">
</div>
<br/>
  sub BUILD {<br/>
      my $self = shift;<br/>
<br/>
      debug( 'Made a new person - SSN = ', $self-&gt;ssn, );<br/>
  }<br/>
<div class="spacer">
</div>
The &quot;BUILD&quot; method is called with the hash reference of the parameters passed to the constructor (after munging by &quot;BUILDARGS&quot;). This gives you a chance to do something with parameters that do not represent object attributes.<div class="spacer">
</div>
<br/>
  sub BUILD {<br/>
      my $self = shift;<br/>
      my $args = shift;<br/>
<br/>
      $self-&gt;add_friend(<br/>
          My::User-&gt;new(<br/>
              user_id =&gt; $args-&gt;{user_id},<br/>
          )<br/>
      );<br/>
  }<br/>
<div class="spacer">
</div>
<i>BUILD and parent classes</i><div class="spacer">
</div>
The interaction between multiple &quot;BUILD&quot; methods in an inheritance hierarchy is different from normal Perl methods.  <b>You should never call </b><b>&quot;$self-&gt;SUPER::BUILD&quot;</b><b></b>, nor should you ever apply a method modifier to &quot;BUILD&quot;.<div class="spacer">
</div>
Moose arranges to have all of the &quot;BUILD&quot; methods in a hierarchy called when an object is constructed,  <i>from parents to</i>  <i>children</i>. This might be surprising at first, because it reverses the normal order of method inheritance.<div class="spacer">
</div>
The theory behind this is that &quot;BUILD&quot; methods can only be used for increasing specialization of a class's constraints, so it makes sense to call the least specific &quot;BUILD&quot; method first. Also, this is how Perl 6 does it.</div>
</div>
<div class="section">
<h1>OBJECT DESTRUCTION</h1> Moose provides a hook for object destruction with the &quot;DEMOLISH&quot; method. As with &quot;BUILD&quot;, you should never explicitly call &quot;$self-&gt;SUPER::DEMOLISH&quot;. Moose will arrange for all of the &quot;DEMOLISH&quot; methods in your hierarchy to be called, from most to least specific.<div class="spacer">
</div>
Each &quot;DEMOLISH&quot; method is called with a single argument.<div class="spacer">
</div>
In most cases, Perl's built-in garbage collection is sufficient, and you won't need to provide a &quot;DEMOLISH&quot; method.<div class="subsection">
<h2>Error Handling During Destruction</h2> The interaction of object destruction and Perl's global $@ and $? variables can be very confusing.<div class="spacer">
</div>
Moose always localizes $? when an object is being destroyed. This means that if you explicitly call &quot;exit&quot;, that exit code will be preserved even if an object's destructor makes a system call.<div class="spacer">
</div>
Moose also preserves $@ against any &quot;eval&quot; calls that may happen during object destruction. However, if an object's &quot;DEMOLISH&quot; method actually dies, Moose explicitly rethrows that error.<div class="spacer">
</div>
If you do not like this behavior, you will have to provide your own &quot;DESTROY&quot; method and use that instead of the one provided by Moose::Object. You can do this to preserve $@  <i>and</i> capture any errors from object destruction by creating an error stack.</div>
</div>
<div class="section">
<h1>AUTHOR</h1> Moose is maintained by the Moose Cabal, along with the help of many contributors. See &quot;CABAL&quot; in Moose and &quot;CONTRIBUTORS&quot; in Moose for details.</div>
<div class="section">
<h1>COPYRIGHT AND LICENSE</h1> This software is copyright (c) 2011 by Infinity Interactive, Inc..<div class="spacer">
</div>
This is free software; you can redistribute it and/or modify it under the same terms as the Perl 5 programming language system itself.</div>
<table class="foot">
<tr>
<td class="foot-date">
2011-11-17</td>
<td class="foot-os">
perl v5.14.2</td>
</tr>
</table>
</div>
</body>
</html>

