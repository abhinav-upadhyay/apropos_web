<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/linux/style.css" type="text/css" media="all"/>
<title>
ffi_call(3)</title>
</head>
<body>
<div class="mandoc">
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">ffi_call</b> &#8212; <span class="desc">Invoke a foreign function.</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">ffi.h</a>&gt;</b><div class="spacer">
</div>
<i class="ftype">void</i><br/>
<b class="fname">ffi_call</b>(<i class="farg">ffi_cif *cif</i>, <i class="farg">void (*fn)(void)</i>, <i class="farg">void *rvalue</i>, <i class="farg">void **avalue</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="name">ffi_call</b> function provides a simple mechanism for invoking a function without requiring knowledge of the function's interface at compile time. <i class="farg">fn</i> is called with the values retrieved from the pointers in the <i class="farg">avalue</i> array. The return value from <i class="farg">fn</i> is placed in storage pointed to by <i class="farg">rvalue</i>. <i class="farg">cif</i> contains information describing the data types, sizes and alignments of the arguments to and return value from <i class="farg">fn</i>, and must be initialized with <b class="name">ffi_prep_cif</b> before it is used with <b class="name">ffi_call</b>.<div class="spacer">
</div>
<i class="farg">rvalue</i> must point to storage that is sizeof(ffi_arg) or larger for non-floating point types. For smaller-sized return value types, the <b class="name">ffi_arg</b> or <b class="name">ffi_sarg</b> integral type must be used to hold the return value.</div>
<div class="section">
<h1 id="x4558414d504c4553">EXAMPLES</h1><pre style="margin-left: 0.00ex;" class="lit display">
#include &lt;ffi.h&gt; 
#include &lt;stdio.h&gt; 
 
unsigned char 
foo(unsigned int, float); 
 
int 
main(int argc, const char **argv) 
{ 
    ffi_cif cif; 
    ffi_type *arg_types[2]; 
    void *arg_values[2]; 
    ffi_status status; 
 
    // Because the return value from foo() is smaller than sizeof(long), it 
    // must be passed as ffi_arg or ffi_sarg. 
    ffi_arg result; 
 
    // Specify the data type of each argument. Available types are defined 
    // in &lt;ffi/ffi.h&gt;. 
    arg_types[0] = &amp;ffi_type_uint; 
    arg_types[1] = &amp;ffi_type_float; 
 
    // Prepare the ffi_cif structure. 
    if ((status = ffi_prep_cif(&amp;cif, FFI_DEFAULT_ABI, 
        2, &amp;ffi_type_uint8, arg_types)) != FFI_OK) 
    { 
        // Handle the ffi_status error. 
    } 
 
    // Specify the values of each argument. 
    unsigned int arg1 = 42; 
    float arg2 = 5.1; 
 
    arg_values[0] = &amp;arg1; 
    arg_values[1] = &amp;arg2; 
 
    // Invoke the function. 
    ffi_call(&amp;cif, FFI_FN(foo), &amp;result, arg_values); 
 
    // The ffi_arg 'result' now contains the unsigned char returned from foo(), 
    // which can be accessed by a typecast. 
    printf(&quot;result is %hhu&quot;, (unsigned char)result); 
 
    return 0; 
} 
 
// The target function. 
unsigned char 
foo(unsigned int x, float y) 
{ 
    unsigned char result = x - y; 
    return result; 
}</pre>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="/man/linux/3/ffi">ffi(3)</a>, <a class="link-man" href="/man/linux/3/ffi_prep_cif">ffi_prep_cif(3)</a></div>
</div>
</body>
</html>

