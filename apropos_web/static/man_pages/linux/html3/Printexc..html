<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/linux/style.css" type="text/css" media="all"/>
<title>
Printexc(3)</title>
</head>
<body>
<div class="mandoc">
<table class="head">
<tbody>
<tr>
<td class="head-ltitle">
Printexc(3)</td>
<td class="head-vol">
OCaml library</td>
<td class="head-rtitle">
Printexc(3)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1>NAME</h1> Printexc - Facilities for printing exceptions and inspecting current call stack.</div>
<div class="section">
<h1>Module</h1> Module   Printexc</div>
<div class="section">
<h1>Documentation</h1> Module <b>Printexc</b><br/>
 : <b>sig end</b><div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
Facilities for printing exceptions and inspecting current call stack.<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<i>val to_string</i> : <b>exn -&gt; string</b><div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<b>Printexc.to_string e</b> returns a string representation of the exception <b>e</b> .<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<i>val print</i> : <b>('a -&gt; 'b) -&gt; 'a -&gt; 'b</b><div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<b>Printexc.print fn x</b> applies <b>fn</b> to <b>x</b> and returns the result. If the evaluation of <b>fn x</b> raises any exception, the name of the exception is printed on standard error output, and the exception is raised again. The typical use is to catch and report exceptions that escape a function application.<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<i>val catch</i> : <b>('a -&gt; 'b) -&gt; 'a -&gt; 'b</b><div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<b>Printexc.catch fn x</b> is similar to <b>Printexc.print</b> , but aborts the program with exit code 2 after printing the uncaught exception.  This function is deprecated: the runtime system is now able to print uncaught exceptions as precisely as <b>Printexc.catch</b> does.  Moreover, calling <b>Printexc.catch</b> makes it harder to track the location of the exception using the debugger or the stack backtrace facility. So, do not use <b>Printexc.catch</b> in new code.<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<i>val print_backtrace</i> : <b>Pervasives.out_channel -&gt; unit</b><div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<b>Printexc.print_backtrace oc</b> prints an exception backtrace on the output channel <b>oc</b> .  The backtrace lists the program locations where the most-recently raised exception was raised and where it was propagated through function calls.<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<b>Since</b> 3.11.0<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<i>val get_backtrace</i> : <b>unit -&gt; string</b><div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<b>Printexc.get_backtrace ()</b> returns a string containing the same exception backtrace that <b>Printexc.print_backtrace</b> would print.<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<b>Since</b> 3.11.0<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<i>val record_backtrace</i> : <b>bool -&gt; unit</b><div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<b>Printexc.record_backtrace b</b> turns recording of exception backtraces on (if <b>b = true</b> ) or off (if <b>b = false</b> ).  Initially, backtraces are not recorded, unless the <b>b</b> flag is given to the program through the <b>OCAMLRUNPARAM</b> variable.<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<b>Since</b> 3.11.0<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<i>val backtrace_status</i> : <b>unit -&gt; bool</b><div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<b>Printexc.backtrace_status()</b> returns <b>true</b> if exception backtraces are currently recorded, <b>false</b> if not.<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<b>Since</b> 3.11.0<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<i>val register_printer</i> : <b>(exn -&gt; string option) -&gt; unit</b><div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<b>Printexc.register_printer fn</b> registers <b>fn</b> as an exception printer.  The printer should return <b>None</b> or raise an exception if it does not know how to convert the passed exception, and <b>Some</b> <b>s</b> with <b>s</b> the resulting string if it can convert the passed exception. Exceptions raised by the printer are ignored.<div style="height: 1.00em;">
&#160;</div>
When converting an exception into a string, the printers will be invoked in the reverse order of their registrations, until a printer returns a <b>Some s</b> value (if no such printer exists, the runtime will use a generic printer).<div style="height: 1.00em;">
&#160;</div>
When using this mechanism, one should be aware that an exception backtrace is attached to the thread that saw it raised, rather than to the exception itself. Practically, it means that the code related to <b>fn</b> should not use the backtrace if it has itself raised an exception before.<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<b>Since</b> 3.11.2<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<div class="spacer">
</div>
<div style="height: 1.00em;">
&#160;</div>
<b>===</b> <b>Raw backtraces</b> <b>===</b><div style="height: 1.00em;">
&#160;</div>
<div class="spacer">
</div>
<i>type raw_backtrace</i><div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
The abstract type <b>raw_backtrace</b> stores a backtrace in a low-level format, instead of directly exposing them as string as the <b>get_backtrace()</b> function does.<div style="height: 1.00em;">
&#160;</div>
This allows delaying the formatting of backtraces to when they are actually printed, which may be useful if you record more backtraces than you print.<div style="height: 1.00em;">
&#160;</div>
Raw backtraces cannot be marshalled. If you need marshalling, you should use the array returned by the <b>backtrace_slots</b> function of the next section.<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<b>Since</b> 4.01.0<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<i>val get_raw_backtrace</i> : <b>unit -&gt; raw_backtrace</b><div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<b>Printexc.get_raw_backtrace ()</b> returns the same exception backtrace that <b>Printexc.print_backtrace</b> would print, but in a raw format.<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<b>Since</b> 4.01.0<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<i>val print_raw_backtrace</i> : <b>Pervasives.out_channel -&gt; raw_backtrace -&gt; unit</b><div style="height: 1.00em;">
&#160;</div>
Print a raw backtrace in the same format <b>Printexc.print_backtrace</b> uses.<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<b>Since</b> 4.01.0<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<i>val raw_backtrace_to_string</i> : <b>raw_backtrace -&gt; string</b><div style="height: 1.00em;">
&#160;</div>
Return a string from a raw backtrace, in the same format <b>Printexc.get_backtrace</b> uses.<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<b>Since</b> 4.01.0<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<div class="spacer">
</div>
<div style="height: 1.00em;">
&#160;</div>
<b>===</b> <b>Current call stack</b> <b>===</b><div style="height: 1.00em;">
&#160;</div>
<div class="spacer">
</div>
<div style="height: 1.00em;">
&#160;</div>
<i>val get_callstack</i> : <b>int -&gt; raw_backtrace</b><div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<b>Printexc.get_callstack n</b> returns a description of the top of the call stack on the current program point (for the current thread), with at most <b>n</b> entries.  (Note: this function is not related to exceptions at all, despite being part of the <b>Printexc</b> module.)<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<b>Since</b> 4.01.0<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<div class="spacer">
</div>
<div style="height: 1.00em;">
&#160;</div>
<b>===</b> <b>Uncaught exceptions</b> <b>===</b><div style="height: 1.00em;">
&#160;</div>
<div class="spacer">
</div>
<div style="height: 1.00em;">
&#160;</div>
<i>val set_uncaught_exception_handler</i> : <b>(exn -&gt; raw_backtrace -&gt; unit) -&gt; unit</b><div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<b>Printexc.set_uncaught_exception_handler fn</b> registers <b>fn</b> as the handler for uncaught exceptions. The default handler prints the exception and backtrace on standard error output.<div style="height: 1.00em;">
&#160;</div>
Note that when <b>fn</b> is called all the functions registered with <b>Pervasives.at_exit</b> have already been called. Because of this you must make sure any output channel <b>fn</b> writes on is flushed.<div style="height: 1.00em;">
&#160;</div>
Also note that exceptions raised by user code in the interactive toplevel are not passed to this function as they are caught by the toplevel itself.<div style="height: 1.00em;">
&#160;</div>
If <b>fn</b> raises an exception, both the exceptions passed to <b>fn</b> and raised by <b>fn</b> will be printed with their respective backtrace.<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<b>Since</b> 4.02.0<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<div class="spacer">
</div>
<div style="height: 1.00em;">
&#160;</div>
<b>===</b> <b>Manipulation of backtrace information</b> <b>Those function allow to traverse the slots of a raw backtrace,</b> <b>extract information from them in a programmer-friendly format. ===</b><div style="height: 1.00em;">
&#160;</div>
<div class="spacer">
</div>
<i>type backtrace_slot</i><div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
The abstract type <b>backtrace_slot</b> represents a single slot of a backtrace.<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<b>Since</b> 4.02<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<i>val backtrace_slots</i> : <b>raw_backtrace -&gt; backtrace_slot array option</b><div style="height: 1.00em;">
&#160;</div>
Returns the slots of a raw backtrace, or <b>None</b> if none of them contain useful information.<div style="height: 1.00em;">
&#160;</div>
In the return array, the slot at index <b>0</b> corresponds to the most recent function call, raise, or primitive <b>get_backtrace</b> call in the trace.<div style="height: 1.00em;">
&#160;</div>
Some possible reasons for returning <b>None</b> are as follow:<div style="height: 1.00em;">
&#160;</div>
-none of the slots in the trace come from modules compiled with debug information ( <b>-g</b> )<div style="height: 1.00em;">
&#160;</div>
-the program is a bytecode program that has not been linked with debug information enabled ( <b>ocamlc -g</b> )<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<b>Since</b> 4.02.0<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<i>type location</i> = {<br/>
 filename : <b>string</b> ;<br/>
 line_number : <b>int</b> ;<br/>
 start_char : <b>int</b> ;<br/>
 end_char : <b>int</b> ;<br/>
 }<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
The type of location information found in backtraces. <b>start_char</b> and <b>end_char</b> are positions relative to the beginning of the line.<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<b>Since</b> 4.02<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<i>module Slot :</i> <b>sig end</b><div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<div class="spacer">
</div>
<div style="height: 1.00em;">
&#160;</div>
<b>===</b> <b>Raw backtrace slots</b> <b>===</b><div style="height: 1.00em;">
&#160;</div>
<div class="spacer">
</div>
<i>type raw_backtrace_slot</i><div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
This type allows direct access to raw backtrace slots, without any conversion in an OCaml-usable data-structure. Being process-specific, they must absolutely not be marshalled, and are unsafe to use for this reason (marshalling them may not fail, but un-marshalling and using the result will result in undefined behavior).<div style="height: 1.00em;">
&#160;</div>
Elements of this type can still be compared and hashed: when two elements are equal, then they represent the same source location (the converse is not necessarily true in presence of inlining, for example).<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<b>Since</b> 4.02.0<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<i>val raw_backtrace_length</i> : <b>raw_backtrace -&gt; int</b><div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<b>raw_backtrace_length bckt</b> returns the number of slots in the backtrace <b>bckt</b> .<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<b>Since</b> 4.02<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<i>val get_raw_backtrace_slot</i> : <b>raw_backtrace -&gt; int -&gt; raw_backtrace_slot</b><div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<b>get_slot bckt pos</b> returns the slot in position <b>pos</b> in the backtrace <b>bckt</b> .<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<b>Since</b> 4.02<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<i>val convert_raw_backtrace_slot</i> : <b>raw_backtrace_slot -&gt; backtrace_slot</b><div style="height: 1.00em;">
&#160;</div>
Extracts the user-friendly <b>backtrace_slot</b> from a low-level <b>raw_backtrace_slot</b> .<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<b>Since</b> 4.02<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<div class="spacer">
</div>
<div style="height: 1.00em;">
&#160;</div>
<b>===</b> <b>Exception slots</b> <b>===</b><div style="height: 1.00em;">
&#160;</div>
<div class="spacer">
</div>
<div style="height: 1.00em;">
&#160;</div>
<i>val exn_slot_id</i> : <b>exn -&gt; int</b><div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<b>Printexc.exn_slot_id</b> returns an integer which uniquely identifies the constructor used to create the exception value <b>exn</b> (in the current runtime).<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<b>Since</b> 4.02.0<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<i>val exn_slot_name</i> : <b>exn -&gt; string</b><div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<b>Printexc.exn_slot_id exn</b> returns the internal name of the constructor used to create the exception value <b>exn</b> .<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
<b>Since</b> 4.02.0<div style="height: 1.00em;">
&#160;</div>
<div style="height: 1.00em;">
&#160;</div>
</div>
<table class="foot">
<tr>
<td class="foot-date">
2015-08-12</td>
<td class="foot-os">
OCamldoc</td>
</tr>
</table>
</div>
</body>
</html>

