<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/linux/style.css" type="text/css" media="all"/>
<title>
XkbSetMap(3)</title>
</head>
<body>
<div class="mandoc">
<table class="head">
<tbody>
<tr>
<td class="head-ltitle">
XkbSetMap(3)</td>
<td class="head-vol">
XKB FUNCTIONS</td>
<td class="head-rtitle">
XkbSetMap(3)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1>NAME</h1> XkbSetMap - Send a complete new set of values for entire components to the server.</div>
<div class="section">
<h1>SYNOPSIS</h1><div style="margin-left: 5.00ex;text-indent: -5.00ex;" class="spacer">
<b>Bool XkbSetMap</b> <b>(Display *</b><i>dpy</i><b>,</b> <b>unsigned int </b><i>which</i><b>,</b> <b>XkbDescPtr </b><i>xkb</i><b>);</b></div>
</div>
<div class="section">
<h1>ARGUMENTS</h1><dl>
<dt>
<i>- dpy</i></dt>
<dd>
connection to X server</dd>
</dl>
<dl>
<dt>
<i>- which</i></dt>
<dd>
mask selecting subcomponents to update</dd>
</dl>
<dl>
<dt>
<i>- xkb</i></dt>
<dd>
description from which new values are taken</dd>
</dl>
</div>
<div class="section">
<h1>DESCRIPTION</h1> There are two ways to make changes to map components: either change a local copy of the keyboard map and call <i>XkbSetMap</i> to send the modified map to the server, or, to reduce network traffic, use an XkbMapChangesRec structure and call <i>XkbChangeMap.</i><div style="height: 1.00em;">
&#160;</div>
Use <i>XkbSetMap</i> to send a complete new set of values for entire components (for example, all symbols, all actions, and so on) to the server. The <i>which</i> parameter specifies the components to be sent to the server, and is a bitwise inclusive OR of the masks listed in Table 1. The <i>xkb</i> parameter is a pointer to an XkbDescRec structure and contains the information to be copied to the server. For each bit set in the <i>which</i> parameter, <i>XkbSetMap</i> takes the corresponding structure values from the <i>xkb</i> parameter and sends it to the server specified by <i>dpy.</i><div style="height: 1.00em;">
&#160;</div>
If any components specified by <i>which</i> are not present in the <i>xkb</i> parameter, <i>XkbSetMap</i> returns False. Otherwise, it sends the update request to the server and returns True. <i>XkbSetMap</i> can generate BadAlloc, BadLength, and BadValue protocol errors.<div style="height: 1.00em;">
&#160;</div>
Key types, symbol maps, and actions are all interrelated; changes in one require changes in the others. Xkb provides functions to make it easier to edit these components and handle the interdependencies. Table 1 lists these helper functions and provides a pointer to where they are defined.<div style="height: 1.00em;">
&#160;</div>
<table class="tbl">
<col style="width: 25.00ex;"/>
<col style="width: 65.00ex;"/>
<col style="width: 3.00ex;"/>
<col style="width: 6.00ex;"/>
<col style="width: 11.00ex;"/>
<tbody>
<tr>
<td>
Table 1 Xkb Mapping Component Masks</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td>
and Convenience Functions</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td colspan="0">
</td>
</tr>
<tr>
<td>
Mask</td>
<td>
Value</td>
<td>
Map</td>
<td>
Fields</td>
<td>
Convenience</td>
</tr>
<tr>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
Functions</td>
</tr>
<tr>
<td colspan="0">
</td>
</tr>
<tr>
<td>
XkbKeyTypesMask</td>
<td>
(1&lt;&lt;0)</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td>
types</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td>
size_types</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td>
num_types</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td>
T}</td>
<td>
XkbGetKeyTypes  XkbResizeKeyType  XkbCopyKeyType  XkbCopyKeyTypes</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td>
XkbKeySymsMask</td>
<td>
(1&lt;&lt;1)</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td>
syms</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td>
size_syms</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td>
num_syms</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td>
key_sym_map</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td>
T}</td>
<td>
XkbGetKeySyms  XkbResizeKeySyms  XkbChangeTypesOfKey</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td>
XkbModifierMapMask</td>
<td>
(1&lt;&lt;2)</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td>
XkbGetKeyModifierMap</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td>
T}</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td>
XkbExplicitComponentsMask</td>
<td>
(1&lt;&lt;3)</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td>
explicit</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td>
T}</td>
<td>
XkbGetKeyExplicitComponents</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td>
XkbKeyActionsMask</td>
<td>
(1&lt;&lt;4)</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td>
key_acts</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td>
acts</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td>
num_acts</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td>
size_acts</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td>
T}</td>
<td>
XkbGetKeyActions  XkbResizeKeyActions</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td>
XkbKeyBehaviorsMask</td>
<td>
(1&lt;&lt;5)</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td>
behaviors</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td>
T}</td>
<td>
XkbGetKeyBehaviors</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td>
XkbVirtualModsMask</td>
<td>
(1&lt;&lt;6)</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td>
vmods</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td>
T}</td>
<td>
XkbGetVirtualMods</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td>
XkbVirtualModMapMask</td>
<td>
(1&lt;&lt;7)</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td>
vmodmap</td>
<td>
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td>
T}</td>
<td>
XkbGetVirtualModMap</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
</tbody>
</table>
<div style="height: 1.00em;">
&#160;</div>
The <i>changed</i> field identifies the map components that have changed in an XkbDescRec structure and may contain any of the bits in Table 1, which are also shown in Table 2. Every 1 bit in <i>changed</i> also identifies which other fields in the XkbMapChangesRec structure contain valid values, as indicated in Table 2. The <i>min_key_code</i> and <i>max_key_code</i> fields are for reference only; they are ignored on any requests sent to the server and are always updated by the server whenever it returns the data for an XkbMapChangesRec.<table class="tbl">
<col style="width: 40.00ex;"/>
<col style="width: 19.00ex;"/>
<col style="width: 38.00ex;"/>
<tbody>
<tr>
<td>
Table 2 XkbMapChangesRec Masks</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td colspan="0">
</td>
</tr>
<tr>
<td>
</td>
<td>
Valid</td>
<td>
</td>
</tr>
<tr>
<td>
Mask</td>
<td>
XkbMapChangesRec</td>
<td>
XkbDescRec Field Containing</td>
</tr>
<tr>
<td>
</td>
<td>
Fields</td>
<td>
Changed Data</td>
</tr>
<tr>
<td colspan="0">
</td>
</tr>
<tr>
<td>
XkbKeyTypesMask</td>
<td>
first_type,</td>
<td>
map-&gt;type[first_type] ..</td>
</tr>
<tr>
<td>
</td>
<td>
num_types</td>
<td>
map-&gt;type[first_type + num_types - 1]</td>
</tr>
<tr>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td>
XkbKeySymsMask</td>
<td>
first_key_sym,</td>
<td>
map-&gt;key_sym_map[first_key_sym] ..</td>
</tr>
<tr>
<td>
</td>
<td>
num_key_syms</td>
<td>
map-&gt;key_sym_map[first_key_sym +</td>
</tr>
<tr>
<td>
</td>
<td>
</td>
<td>
num_key_syms - 1]</td>
</tr>
<tr>
<td>
XkbModifierMapMask</td>
<td>
first_modmap_key,</td>
<td>
map-&gt;modmap[first_modmap_key] ..</td>
</tr>
<tr>
<td>
</td>
<td>
num_modmap_keys</td>
<td>
map-&gt;modmap[first_modmap_key +</td>
</tr>
<tr>
<td>
</td>
<td>
</td>
<td>
num_modmap_keys-1]</td>
</tr>
<tr>
<td>
XkbExplicitComponentsMask</td>
<td>
first_key_explicit,</td>
<td>
</td>
</tr>
<tr>
<td>
server-&gt;explicit[first_key_explicit] ..</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td>
</td>
<td>
num_key_explicit</td>
<td>
server-&gt;explicit[first_key_explicit +</td>
</tr>
<tr>
<td>
</td>
<td>
</td>
<td>
num_key_explicit - 1]</td>
</tr>
<tr>
<td>
XkbKeyActionsMask</td>
<td>
first_key_act,</td>
<td>
server-&gt;key_acts[first_key_act] ..</td>
</tr>
<tr>
<td>
</td>
<td>
num_key_acts</td>
<td>
server-&gt;key_acts[first_key_act +</td>
</tr>
<tr>
<td>
</td>
<td>
</td>
<td>
num_key_acts - 1]</td>
</tr>
<tr>
<td>
XkbKeyBehaviorsMask</td>
<td>
first_key_behavior,</td>
<td>
</td>
</tr>
<tr>
<td>
server-&gt;behaviors[first_key_behavior] ..</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td>
</td>
<td>
num_key_behaviors</td>
<td>
server-&gt;behaviors[first_key_behavior +</td>
</tr>
<tr>
<td>
</td>
<td>
</td>
<td>
num_key_behaviors - 1]</td>
</tr>
<tr>
<td>
XkbVirtualModsMask</td>
<td>
vmods</td>
<td>
server-&gt;vmods[*]</td>
</tr>
<tr>
<td>
XkbVirtualModMapMask</td>
<td>
first_vmodmap_key,</td>
<td>
</td>
</tr>
<tr>
<td>
server-&gt;vmodmap[first_vmodmap_key]</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td>
</td>
<td>
num_vmodmap_keys</td>
<td>
 ..</td>
</tr>
<tr>
<td>
</td>
<td>
</td>
<td>
server-&gt;vmodmap[first_vmodmap_key</td>
</tr>
<tr>
<td>
</td>
<td>
</td>
<td>
+ num_vmodmap_keys - 1]</td>
</tr>
</tbody>
</table>
</div>
<div class="section">
<h1>RETURN VALUES</h1><dl>
<dt>
True</dt>
<dd>
The <i>XkbSetMap</i> function returns True all components specified by <i>which</i> are present in the <i>xkb</i> parameter.</dd>
</dl>
<dl>
<dt>
False</dt>
<dd>
The <i>XkbSetMap</i> function returns False if any component specified by <i>which</i> is not present in the <i>xkb</i> parameter.</dd>
</dl>
</div>
<div class="section">
<h1>STRUCTURES</h1><div style="height: 1.00em;">
&#160;</div>
Use the XkbMapChangesRec structure to identify and track partial modifications to the mapping components and to reduce the amount of traffic between the server and clients.<div class="spacer">
</div>
<br/>
typedef struct _XkbMapChanges {<br/>
    unsigned short   changed;            /&#8727; identifies valid components in structure */<br/>
    KeyCode          min_key_code;       /&#8727; lowest numbered keycode for device */<br/>
    KeyCode          max_key_code;       /&#8727; highest numbered keycode for device */<br/>
    unsigned char    first_type;         /&#8727; index of first key type modified */<br/>
    unsigned char    num_types;          /&#8727; # types modified */<br/>
    KeyCode          first_key_sym;      /&#8727; first key whose key_sym_map changed */<br/>
    unsigned char    num_key_syms;       /&#8727; # key_sym_map entries changed */<br/>
    KeyCode          first_key_act;      /&#8727; first key whose key_acts entry changed */<br/>
    unsigned char    num_key_acts;       /&#8727; # key_acts entries changed */<br/>
    KeyCode          first_key_behavior; /&#8727; first key whose behaviors changed */<br/>
    unsigned char    num_key_behaviors;  /&#8727; # behaviors entries changed */<br/>
    KeyCode          first_key_explicit; /&#8727; first key whose explicit entry changed */<br/>
    unsigned char    num_key_explicit;   /&#8727; # explicit entries changed */<br/>
    KeyCode          first_modmap_key;   /&#8727; first key whose modmap entry changed */<br/>
    unsigned char    num_modmap_keys;    /&#8727; # modmap entries changed */<br/>
    KeyCode          first_vmodmap_key;  /&#8727; first key whose vmodmap changed */<br/>
    unsigned char    num_vmodmap_keys;   /&#8727; # vmodmap entries changed */<br/>
    unsigned char    pad1;               /&#8727; reserved */<br/>
    unsigned short   vmods;              /&#8727; mask indicating which vmods changed */<br/>
} XkbMapChangesRec,*XkbMapChangesPtr;<div class="spacer">
</div>
<br/>
<div style="height: 1.00em;">
&#160;</div>
The complete description of an Xkb keyboard is given by an XkbDescRec. The component structures in the XkbDescRec represent the major Xkb components.<div style="height: 1.00em;">
&#160;</div>
<br/>
typedef struct {<br/>
   struct _XDisplay * display;      /&#8727; connection to X server */<br/>
   unsigned short     flags;        /&#8727; private to Xkb, do not modify */<br/>
   unsigned short     device_spec;  /&#8727; device of interest */<br/>
   KeyCode            min_key_code; /&#8727; minimum keycode for device */<br/>
   KeyCode            max_key_code; /&#8727; maximum keycode for device */<br/>
   XkbControlsPtr     ctrls;        /&#8727; controls */<br/>
   XkbServerMapPtr    server;       /&#8727; server keymap */<br/>
   XkbClientMapPtr    map;          /&#8727; client keymap */<br/>
   XkbIndicatorPtr    indicators;   /&#8727; indicator map */<br/>
   XkbNamesPtr        names;        /&#8727; names for all components */<br/>
   XkbCompatMapPtr    compat;       /&#8727; compatibility map */<br/>
   XkbGeometryPtr     geom;         /&#8727; physical geometry of keyboard */<br/>
} XkbDescRec, *XkbDescPtr;<div class="spacer">
</div>
<br/>
The <i>display</i> field points to an X display structure. The <i>flags field is private to the library: modifying</i> <i>flags</i> may yield unpredictable results. The <i>device_spec</i> field specifies the device identifier of the keyboard input device, or XkbUseCoreKeyboard, which specifies the core keyboard device. The <i>min_key_code</i> and <i>max_key_code</i> fields specify the least and greatest keycode that can be returned by the keyboard.<div style="height: 1.00em;">
&#160;</div>
Each structure component has a corresponding mask bit that is used in function calls to indicate that the structure should be manipulated in some manner, such as allocating it or freeing it. These masks and their relationships to the fields in the XkbDescRec are shown in Table 3.<table class="tbl">
<col style="width: 20.00ex;"/>
<col style="width: 16.00ex;"/>
<col style="width: 7.00ex;"/>
<tbody>
<tr>
<td>
Table 3 Mask Bits for XkbDescRec</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td colspan="0">
</td>
</tr>
<tr>
<td>
Mask Bit</td>
<td>
XkbDescRec Field</td>
<td>
Value</td>
</tr>
<tr>
<td colspan="0">
</td>
</tr>
<tr>
<td>
XkbControlsMask</td>
<td>
ctrls</td>
<td>
(1L&lt;&lt;0)</td>
</tr>
<tr>
<td>
XkbServerMapMask</td>
<td>
server</td>
<td>
(1L&lt;&lt;1)</td>
</tr>
<tr>
<td>
XkbIClientMapMask</td>
<td>
map</td>
<td>
(1L&lt;&lt;2)</td>
</tr>
<tr>
<td>
XkbIndicatorMapMask</td>
<td>
indicators</td>
<td>
(1L&lt;&lt;3)</td>
</tr>
<tr>
<td>
XkbNamesMask</td>
<td>
names</td>
<td>
(1L&lt;&lt;4)</td>
</tr>
<tr>
<td>
XkbCompatMapMask</td>
<td>
compat</td>
<td>
(1L&lt;&lt;5)</td>
</tr>
<tr>
<td>
XkbGeometryMask</td>
<td>
geom</td>
<td>
(1L&lt;&lt;6)</td>
</tr>
<tr>
<td>
XkbAllComponentsMask</td>
<td>
All Fields</td>
<td>
(0x7f)</td>
</tr>
</tbody>
</table>
</div>
<div class="section">
<h1>DIAGNOSTICS</h1><dl>
<dt>
<b>BadAlloc</b></dt>
<dd>
Unable to allocate storage</dd>
</dl>
<dl>
<dt>
<b>BadLength</b></dt>
<dd>
The length of a request is shorter or longer than that required to minimally contain the arguments</dd>
</dl>
<dl>
<dt>
<b>BadValue</b></dt>
<dd>
An argument is out of range</dd>
</dl>
</div>
<div class="section">
<h1>SEE ALSO</h1> <b>XkbChangeMap</b>(3), <b>XkbChangeTypesOfKey</b>(3), <b>XkbCopyKeyType</b>(3), <b>XkbCopyKeyTypes</b>(3), <b>XkbGetKeyActions</b>(3), <b>XkbGetKeyBehaviors</b>(3), <b>XkbGetKeyExplicitComponents</b>(3), <b>XkbGetKeyModifierMap</b>(3), <b>XkbGetKeySyms</b>(3), <b>XkbGetKeyTypes</b>(3), <b>XkbResizeKeyActions</b>(3), <b>XkbResizeKeySyms</b>(3), <b>XkbResizeKeyType</b>(3), <b>XkbGetVirtualModMap</b>(3), <b>XkbGetVirtualMods</b>(3)</div>
<table class="foot">
<tr>
<td class="foot-date">
libX11 1.4.99.1</td>
<td class="foot-os">
X Version 11</td>
</tr>
</table>
</div>
</body>
</html>

