<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/linux/style.css" type="text/css" media="all"/>
<title>
Fuse(3pm)</title>
</head>
<body>
<div class="mandoc">
<table class="head">
<tbody>
<tr>
<td class="head-ltitle">
Fuse(3pm)</td>
<td class="head-vol">
User Contributed Perl Documentation</td>
<td class="head-rtitle">
Fuse(3pm)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1>NAME</h1> Fuse - write filesystems in Perl using FUSE</div>
<div class="section">
<h1>SYNOPSIS</h1><br/>
  use Fuse;<br/>
  my ($mountpoint) = &quot;&quot;;<br/>
  $mountpoint = shift(@ARGV) if @ARGV;<br/>
  Fuse::main(mountpoint=&gt;$mountpoint, getattr=&gt;&quot;main::my_getattr&quot;, getdir=&gt;&quot;main::my_getdir&quot;, ...);<br/>
</div>
<div class="section">
<h1>DESCRIPTION</h1> This lets you implement filesystems in perl, through the FUSE (Filesystem in USErspace) kernel/lib interface.<div class="spacer">
</div>
FUSE expects you to implement callbacks for the various functions.<div class="spacer">
</div>
In the following definitions, &quot;errno&quot; can be 0 (for a success), -EINVAL, -ENOENT, -EONFIRE, any integer less than 1 really.<div class="spacer">
</div>
You can import standard error constants by saying something like &quot;use POSIX qw(EDOTDOT ENOANO);&quot;.<div class="spacer">
</div>
Every constant you need (file types, <i>open()</i> flags, error values, etc) can be imported either from POSIX or from Fcntl, often both. See their respective documentations, for more information.<div class="subsection">
<h2>EXPORTED SYMBOLS</h2> None by default.<div class="spacer">
</div>
You can request all exportable symbols by using the tag &quot;:all&quot;.<div class="spacer">
</div>
You can request the extended attribute symbols by using the tag &quot;:xattr&quot;. This will export XATTR_CREATE and XATTR_REPLACE.</div>
<div class="subsection">
<h2>FUNCTIONS</h2>  <i>Fuse::main</i><div class="spacer">
</div>
Takes arguments in the form of hash key=&gt;value pairs.  There are many valid keys.  Most of them correspond with names of callback functions, as described in section 'FUNCTIONS YOUR FILESYSTEM MAY IMPLEMENT'. A few special keys also exist:<div class="spacer">
</div>
debug =&gt; boolean<div style="height: 1.00em;">
&#160;</div>
<div style="margin-left: 1.00ex;">
This turns FUSE call tracing on and off.  Default is 0 (which means off).</div>
<div class="spacer">
</div>
mountpoint =&gt; string<div style="height: 1.00em;">
&#160;</div>
<div style="margin-left: 1.00ex;">
The point at which to mount this filesystem.  There is no default, you must specify this.  An example would be '/mnt'.</div>
<div class="spacer">
</div>
mountopts =&gt; string<div style="height: 1.00em;">
&#160;</div>
<div style="margin-left: 1.00ex;">
This is a comma seperated list of mount options to pass to the FUSE kernel module.<div style="height: 1.00em;">
&#160;</div>
At present, it allows the specification of the allow_other argument when mounting the new FUSE filesystem. To use this, you will also need 'user_allow_other' in /etc/fuse.conf as per the FUSE documention<div style="height: 1.00em;">
&#160;</div>
<br/>
  mountopts =&gt; &quot;allow_other&quot; or<br/>
  mountopts =&gt; &quot;&quot;<br/>
</div>
<div class="spacer">
</div>
threaded =&gt; boolean<div style="height: 1.00em;">
&#160;</div>
<div style="margin-left: 1.00ex;">
This turns FUSE multithreading on and off.  The default is 0, meaning your FUSE script will run in single-threaded mode.  Note that single-threaded mode also means that you will not have to worry about reentrancy, though you will have to worry about recursive lookups.  In single-threaded mode, FUSE holds a global lock on your filesystem, and will wait for one callback to return before calling another.  This can lead to deadlocks, if your script makes any attempt to access files or directories in the filesystem it is providing.  (This includes calling  <i>stat()</i> on the mount-point, <i>statfs()</i> calls from the 'df' command, and so on and so forth.)  It is worth paying a little attention and being careful about this.<div style="height: 1.00em;">
&#160;</div>
Enabling multithreading will cause FUSE to make multiple simultaneous calls into the various callback functions of your perl script.  If you enable threaded mode, you can enjoy all the parallel execution and interactive response benefits of threads, and you get to enjoy all the benefits of race conditions and locking bugs, too.  Please also ensure any other perl modules you're using are also thread-safe.<div style="height: 1.00em;">
&#160;</div>
(If enabled, this option will cause a warning if your perl interpreter was not built with USE_ITHREADS, or if you have failed to use threads or threads::shared.)</div>
</div>
<div class="subsection">
<h2>FUNCTIONS YOUR FILESYSTEM MAY IMPLEMENT</h2>  <i>getattr</i><div class="spacer">
</div>
Arguments:  filename. Returns a list, very similar to the 'stat' function (see perlfunc).  On error, simply return a single numeric scalar value (e.g. &quot;return - <i>ENOENT()</i>;&quot;).<div class="spacer">
</div>
FIXME: the &quot;ino&quot; field is currently ignored.  I tried setting it to 0 in an example script, which consistently caused segfaults.<div class="spacer">
</div>
Fields (the following was stolen from <i>perlfunc</i>(1) with apologies):<div class="spacer">
</div>
($dev,$ino,$mode,$nlink,$uid,$gid,$rdev,$size,<br/>
        $atime,$mtime,$ctime,$blksize,$blocks)<br/>
                         = getattr($filename);<div class="spacer">
</div>
Here are the meaning of the fields:<div class="spacer">
</div>
<br/>
 0 dev      device number of filesystem<br/>
 1 ino      inode number<br/>
 2 mode     file mode  (type and permissions)<br/>
 3 nlink    number of (hard) links to the file<br/>
 4 uid      numeric user ID of file's owner<br/>
 5 gid      numeric group ID of file's owner<br/>
 6 rdev     the device identifier (special files only)<br/>
 7 size     total size of file, in bytes<br/>
 8 atime    last access time in seconds since the epoch<br/>
 9 mtime    last modify time in seconds since the epoch<br/>
10 ctime    inode change time (NOT creation time!) in seconds<br/>
            since the epoch<br/>
11 blksize  preferred block size for file system I/O<br/>
12 blocks   actual number of blocks allocated<br/>
<div class="spacer">
</div>
(The epoch was at 00:00 January 1, 1970 GMT.)<div class="spacer">
</div>
<i>readlink</i><div class="spacer">
</div>
Arguments:  link pathname. Returns a scalar: either a numeric constant, or a text string.<div class="spacer">
</div>
This is called when dereferencing symbolic links, to learn the target.<div class="spacer">
</div>
example rv: return &quot;/proc/self/fd/stdin&quot;;<div class="spacer">
</div>
<i>getdir</i><div class="spacer">
</div>
Arguments:  Containing directory name. Returns a list: 0 or more text strings (the filenames), followed by a numeric errno (usually 0).<div class="spacer">
</div>
This is used to obtain directory listings.  Its <i>opendir()</i>, <i>readdir()</i>, <i>filldir()</i> and <i>closedir()</i> all in one call.<div class="spacer">
</div>
example rv: return ('.', 'a', 'b', 0);<div class="spacer">
</div>
<i>mknod</i><div class="spacer">
</div>
Arguments:  Filename, numeric modes, numeric device Returns an errno (0 upon success, as usual).<div class="spacer">
</div>
This function is called for all non-directory, non-symlink nodes, not just devices.<div class="spacer">
</div>
<i>mkdir</i><div class="spacer">
</div>
Arguments:  New directory pathname, numeric modes. Returns an errno.<div class="spacer">
</div>
Called to create a directory.<div class="spacer">
</div>
<i>unlink</i><div class="spacer">
</div>
Arguments:  Filename. Returns an errno.<div class="spacer">
</div>
Called to remove a file, device, or symlink.<div class="spacer">
</div>
<i>rmdir</i><div class="spacer">
</div>
Arguments:  Pathname. Returns an errno.<div class="spacer">
</div>
Called to remove a directory.<div class="spacer">
</div>
<i>symlink</i><div class="spacer">
</div>
Arguments:  Existing filename, symlink name. Returns an errno.<div class="spacer">
</div>
Called to create a symbolic link.<div class="spacer">
</div>
<i>rename</i><div class="spacer">
</div>
Arguments:  old filename, new filename. Returns an errno.<div class="spacer">
</div>
Called to rename a file, and/or move a file from one directory to another.<div class="spacer">
</div>
<i>link</i><div class="spacer">
</div>
Arguments:  Existing filename, hardlink name. Returns an errno.<div class="spacer">
</div>
Called to create hard links.<div class="spacer">
</div>
<i>chmod</i><div class="spacer">
</div>
Arguments:  Pathname, numeric modes. Returns an errno.<div class="spacer">
</div>
Called to change permissions on a file/directory/device/symlink.<div class="spacer">
</div>
<i>chown</i><div class="spacer">
</div>
Arguments:  Pathname, numeric uid, numeric gid. Returns an errno.<div class="spacer">
</div>
Called to change ownership of a file/directory/device/symlink.<div class="spacer">
</div>
<i>truncate</i><div class="spacer">
</div>
Arguments:  Pathname, numeric offset. Returns an errno.<div class="spacer">
</div>
Called to truncate a file, at the given offset.<div class="spacer">
</div>
<i>utime</i><div class="spacer">
</div>
Arguments:  Pathname, numeric actime, numeric modtime. Returns an errno.<div class="spacer">
</div>
Called to change access/modification times for a file/directory/device/symlink.<div class="spacer">
</div>
<i>open</i><div class="spacer">
</div>
Arguments:  Pathname, numeric flags (which is an OR-ing of stuff like O_RDONLY and O_SYNC, constants you can import from POSIX). Returns an errno.<div class="spacer">
</div>
No creation, or truncation flags (O_CREAT, O_EXCL, O_TRUNC) will be passed to <i>open()</i>. Your  <i>open()</i> method needs only check if the operation is permitted for the given flags, and return 0 for success.<div class="spacer">
</div>
<i>read</i><div class="spacer">
</div>
Arguments:  Pathname, numeric requestedsize, numeric offset. Returns a numeric errno, or a string scalar with up to $requestedsize bytes of data.<div class="spacer">
</div>
Called in an attempt to fetch a portion of the file.<div class="spacer">
</div>
<i>write</i><div class="spacer">
</div>
Arguments:  Pathname, scalar buffer, numeric offset.  You can use length($buffer) to find the buffersize. Returns an errno.<div class="spacer">
</div>
Called in an attempt to write (or overwrite) a portion of the file.  Be prepared because $buffer could contain random binary data with NULLs and all sorts of other wonderful stuff.<div class="spacer">
</div>
<i>statfs</i><div class="spacer">
</div>
Arguments:  none Returns any of the following:<div class="spacer">
</div>
-<i>ENOANO()</i><div class="spacer">
</div>
or<div class="spacer">
</div>
$namelen, $files, $files_free, $blocks, $blocks_avail, $blocksize<div class="spacer">
</div>
or<div class="spacer">
</div>
-<i>ENOANO()</i>, $namelen, $files, $files_free, $blocks, $blocks_avail, $blocksize<div class="spacer">
</div>
<i>flush</i><div class="spacer">
</div>
Arguments: Pathname Returns an errno or 0 on success.<div class="spacer">
</div>
Called to synchronise any cached data. This is called before the file is closed. It may be called multiple times before a file is closed.<div class="spacer">
</div>
<i>release</i><div class="spacer">
</div>
Arguments: Pathname, numeric flags passed to open Returns an errno or 0 on success.<div class="spacer">
</div>
Called to indicate that there are no more references to the file. Called once for every file with the same pathname and flags as were passed to open.<div class="spacer">
</div>
<i>fsync</i><div class="spacer">
</div>
Arguments: Pathname, numeric flags Returns an errno or 0 on success.<div class="spacer">
</div>
Called to synchronise the file's contents. If flags is non-zero, only synchronise the user data. Otherwise synchronise the user and meta data.<div class="spacer">
</div>
<i>setxattr</i><div class="spacer">
</div>
Arguments: Pathname, extended attribute's name, extended attribute's value, numeric flags (which is an OR-ing of XATTR_CREATE and XATTR_REPLACE Returns an errno or 0 on success.<div class="spacer">
</div>
Called to set the value of the named extended attribute.<div class="spacer">
</div>
If you wish to reject setting of a particular form of extended attribute name (e.g.: regexps matching user\..* or security\..*), then return - EOPNOTSUPP.<div class="spacer">
</div>
If flags is set to XATTR_CREATE and the extended attribute already exists, this should fail with - EEXIST. If flags is set to XATTR_REPLACE and the extended attribute doesn't exist, this should fail with - ENOATTR.<div class="spacer">
</div>
XATTR_CREATE and XATTR_REPLACE are provided by this module, but not exported by default. To import them:<div class="spacer">
</div>
<br/>
    use Fuse ':xattr';<br/>
<div class="spacer">
</div>
or:<div class="spacer">
</div>
<br/>
    use Fuse ':all';<br/>
<div class="spacer">
</div>
<i>getxattr</i><div class="spacer">
</div>
Arguments: Pathname, extended attribute's name Returns an errno, 0 if there was no value, or the extended attribute's value.<div class="spacer">
</div>
Called to get the value of the named extended attribute.<div class="spacer">
</div>
<i>listxattr</i><div class="spacer">
</div>
Arguments: Pathname Returns a list: 0 or more text strings (the extended attribute names), followed by a numeric errno (usually 0).<div class="spacer">
</div>
<i>removexattr</i><div class="spacer">
</div>
Arguments: Pathname, extended attribute's name Returns an errno or 0 on success.</div>
</div>
<div class="section">
<h1>AUTHOR</h1> Mark Glines, &lt;mark@glines.org&gt;</div>
<div class="section">
<h1>SEE ALSO</h1> perl, the FUSE documentation.</div>
<table class="foot">
<tr>
<td class="foot-date">
2012-07-03</td>
<td class="foot-os">
perl v5.14.2</td>
</tr>
</table>
</div>
</body>
</html>

