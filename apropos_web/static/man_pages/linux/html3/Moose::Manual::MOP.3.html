<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/linux/style.css" type="text/css" media="all"/>
<title>
Moose::Manual::MOP(3pm)</title>
</head>
<body>
<div class="mandoc">
<table class="head">
<tbody>
<tr>
<td class="head-ltitle">
Moose::Manual::MOP(3pm)</td>
<td class="head-vol">
User Contributed Perl Documentation</td>
<td class="head-rtitle">
Moose::Manual::MOP(3pm)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1>NAME</h1> Moose::Manual::MOP - The Moose (and Class::MOP) meta API</div>
<div class="section">
<h1>VERSION</h1> version 2.0401</div>
<div class="section">
<h1>INTRODUCTION</h1> Moose provides a powerful introspection API built on top of &quot;Class::MOP&quot;. &quot;MOP&quot; stands for Meta-Object Protocol. In plainer English, a MOP is an API for performing introspection on classes, attributes, methods, and so on.<div class="spacer">
</div>
In fact, it is &quot;Class::MOP&quot; that provides many of Moose's core features, including attributes, before/after/around method modifiers, and immutability. In most cases, Moose takes an existing &quot;Class::MOP&quot; class and subclasses it to add additional features. Moose also adds some entirely new features of its own, such as roles, the augment modifier, and types.<div class="spacer">
</div>
If you're interested in the MOP, it's important to know about &quot;Class::MOP&quot; so you know what docs to read. Often, the introspection method that you're looking for is defined in a &quot;Class::MOP&quot; class, rather than Moose itself.<div class="spacer">
</div>
The MOP provides more than just <i>read-only</i> introspection. It also lets you add attributes and methods, apply roles, and much more. In fact, all of the declarative Moose sugar is simply a thin layer on top of the MOP API.<div class="spacer">
</div>
If you want to write Moose extensions, you'll need to learn some of the MOP API. The introspection methods are also handy if you want to generate docs or inheritance graphs, or do some other runtime reflection.<div class="spacer">
</div>
This document is not a complete reference for the meta API. We're just going to cover some of the highlights, and give you a sense of how it all works. To really understand it, you'll have to read a lot of other docs, and possibly even dig into the Moose guts a bit.</div>
<div class="section">
<h1>GETTING STARTED</h1> The usual entry point to the meta API is through a class's metaclass object, which is a Moose::Meta::Class. This is available by calling the &quot;meta&quot; method on a class or object:<div class="spacer">
</div>
<br/>
  package User;<br/>
<br/>
  use Moose;<br/>
<br/>
  my $meta = __PACKAGE__-&gt;meta;<br/>
<div class="spacer">
</div>
The &quot;meta&quot; method is added to a class when it uses Moose.<div class="spacer">
</div>
You can also use &quot;Class::MOP::Class-&gt;initialize($name)&quot; to get a metaclass object for any class. This is safer than calling &quot;$class-&gt;meta&quot; when you're not sure that the class has a meta method.<div class="spacer">
</div>
The &quot;Class::MOP::Class-&gt;initialize&quot; constructor will return an existing metaclass if one has already been created (via Moose or some other means). If it hasn't, it will return a new &quot;Class::MOP::Class&quot; object. This will work for classes that use Moose, meta API classes, and classes which don't use Moose at all.</div>
<div class="section">
<h1>USING THE METACLASS OBJECT</h1> The metaclass object can tell you about a class's attributes, methods, roles, parents, and more. For example, to look at all of the class's attributes:<div class="spacer">
</div>
<br/>
  for my $attr ( $meta-&gt;get_all_attributes ) {<br/>
      print $attr-&gt;name, &quot;\n&quot;;<br/>
  }<br/>
<div class="spacer">
</div>
The &quot;get_all_attributes&quot; method is documented in &quot;Class::MOP::Class&quot;. For Moose-using classes, it returns a list of Moose::Meta::Attribute objects for attributes defined in the class and its parents.<div class="spacer">
</div>
You can also get a list of methods:<div class="spacer">
</div>
<br/>
  for my $method ( $meta-&gt;get_all_methods ) {<br/>
      print $method-&gt;fully_qualified_name, &quot;\n&quot;;<br/>
  }<br/>
<div class="spacer">
</div>
Now we're looping over a list of Moose::Meta::Method objects. Note that some of these objects may actually be a subclass of Moose::Meta::Method, as Moose uses different classes to represent wrapped methods, delegation methods, constructors, etc.<div class="spacer">
</div>
We can look at a class's parent classes and subclasses:<div class="spacer">
</div>
<br/>
  for my $class ( $meta-&gt;linearized_isa ) {<br/>
      print &quot;$class\n&quot;;<br/>
  }<br/>
<br/>
  for my $subclass ( $meta-&gt;subclasses ) {<br/>
      print &quot;$subclass\n&quot;;<br/>
  }<br/>
<div class="spacer">
</div>
Note that both these methods return class <i>names</i>, not metaclass objects.</div>
<div class="section">
<h1>ALTERING CLASSES WITH THE MOP</h1> The metaclass object can change the class directly, by adding attributes, methods, etc.<div class="spacer">
</div>
As an example, we can add a method to a class:<div class="spacer">
</div>
<br/>
  $meta-&gt;add_method( 'say' =&gt; sub { print @_, &quot;\n&quot; } );<br/>
<div class="spacer">
</div>
Or an attribute:<div class="spacer">
</div>
<br/>
  $meta-&gt;add_attribute( 'size' =&gt; ( is =&gt; 'rw', isa  =&gt; 'Int' ) );<br/>
<div class="spacer">
</div>
Obviously, this is much more cumbersome than using Perl syntax or Moose sugar for defining methods and attributes, but this API allows for very powerful extensions.<div class="spacer">
</div>
You might remember that we've talked about making classes immutable elsewhere in the manual. This is a good practice. However, once a class is immutable, calling any of these update methods will throw an exception.<div class="spacer">
</div>
You can make a class mutable again simply by calling &quot;$meta-&gt;make_mutable&quot;. Once you're done changing it, you can restore immutability by calling &quot;$meta-&gt;make_immutable&quot;.<div class="spacer">
</div>
However, the most common use for this part of the meta API is as part of Moose extensions. These extensions should assume that they are being run before you make a class immutable.</div>
<div class="section">
<h1>GOING FURTHER</h1> If you're interested in extending Moose, we recommend reading all of the &quot;Meta&quot; and &quot;Extending&quot; recipes in the Moose::Cookbook. Those recipes show various practical applications of the MOP.<div class="spacer">
</div>
If you'd like to write your own extensions, one of the best ways to learn more about this is to look at other similar extensions to see how they work. You'll probably also need to read various API docs, including the docs for the various &quot;Moose::Meta::*&quot; and &quot;Class::MOP::*&quot; classes.<div class="spacer">
</div>
Finally, we welcome questions on the Moose mailing list and IRC. Information on the mailing list, IRC, and more references can be found in the Moose.pm docs.</div>
<div class="section">
<h1>AUTHOR</h1> Moose is maintained by the Moose Cabal, along with the help of many contributors. See &quot;CABAL&quot; in Moose and &quot;CONTRIBUTORS&quot; in Moose for details.</div>
<div class="section">
<h1>COPYRIGHT AND LICENSE</h1> This software is copyright (c) 2011 by Infinity Interactive, Inc..<div class="spacer">
</div>
This is free software; you can redistribute it and/or modify it under the same terms as the Perl 5 programming language system itself.</div>
<table class="foot">
<tr>
<td class="foot-date">
2011-11-17</td>
<td class="foot-os">
perl v5.14.2</td>
</tr>
</table>
</div>
</body>
</html>

