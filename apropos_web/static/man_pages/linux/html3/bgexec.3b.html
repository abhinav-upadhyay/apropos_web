<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/linux/style.css" type="text/css" media="all"/>
<title>
bgexec(n)</title>
</head>
<body>
<div class="mandoc">
<table class="head">
<tbody>
<tr>
<td class="head-ltitle">
bgexec(n)</td>
<td class="head-vol">
BLT Built-In Commands</td>
<td class="head-rtitle">
bgexec(n)</td>
</tr>
</tbody>
</table>
<br/>
<br/>
<div class="section">
<h1>NAME</h1> bgexec - Run programs in the background while handling Tk events.</div>
<div class="section">
<h1>SYNOPSIS</h1>  <b>blt::bgexec </b><i>varName</i> ?<i>option value</i>?... <i>program</i> ?<i>arg</i>?...<br/>
<br/>
<div style="height: 0.00em;">
&#160;</div>
</div>
<div class="section">
<h1>DESCRIPTION</h1> The  <b>bgexec</b> command executes programs in the background, allowing Tk to handle events.  A global Tcl variable  <i>varName</i> is set when the program has completed.</div>
<div class="section">
<h1>INTRODUCTION</h1> Tcl's  <b>exec</b> command is very useful for gathering information from the operating system.  It runs a program and returns the output as its result.  This works well for Tcl-only applications. But for Tk applications, a problem occurs when the program takes time to process.  Let's say we want the get the disk usage of a directory.  We'll use the Unix program du to get the summary.<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">
&#160;</div>
<br/>
set out [exec du -s $dir]<br/>
puts &quot;Disk usage for $dir is $out&quot;<br/>
</div>
<div style="height: 1.00em;">
&#160;</div>
While du is running, scrollbars won't respond.  None of the Tk widgets will be redrawn properly.  The  <b>send</b> command won't work. And the worst part is that the application appears hung up or dead. The problem is that while  <b>exec</b> is waiting for <i>du</i> to finish, Tk is not able to handle X events.<div class="spacer">
</div>
The <b>bgexec</b> command performs the same functions as <b>exec</b>, but also allows Tk to handle events.  You can execute a long-running program and the Tk widgets will behave normally.  When the program finishes, its output and the exit status are written to Tcl variables.  This makes it easy to monitor and save the output of a program.</div>
<div class="section">
<h1>EXAMPLE</h1> Here is the disk usage example again, this time using  <b>bgexec</b>. The syntax to invoke &quot;du&quot; is exactly the same as the previous example, when we used  <b>exec</b>.<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">
&#160;</div>
<br/>
global myStatus myOutput<br/>
blt::bgexec myStatus -output myOutput du -s $dir<br/>
puts &quot;Disk usage for $dir is $myOutput&quot;<br/>
</div>
<div style="height: 1.00em;">
&#160;</div>
Two global variables, myStatus and myOutput, will be set by  <b>bgexec</b> when du has completed. MyStatus will contain the program's exit status.  MyOutput, specified by the  <b>-output</b> option, will store the output of the program.<div class="spacer">
</div>
You can also terminate the program by setting the variable myStatus.  If myStatus is set before du has completed, the process is killed. Under Unix, this is done sending by a configurable signal (by default it's SIGKILL). Under Win32, this is done by calling  <b>TerminateProcess</b>. It makes no difference what myStatus is set to.<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">
&#160;</div>
<br/>
set myStatus {}<br/>
</div>
<div style="height: 1.00em;">
&#160;</div>
There are several <b>bgexec</b> options to collect different types of information.<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">
&#160;</div>
<br/>
global myStatus myOutput myErrs<br/>
blt::bgexec myStatus -output myOutput -error myErrs du -s $dir<br/>
</div>
<div style="height: 1.00em;">
&#160;</div>
The <b>-error</b> option is similar to <b>-output</b>.  It sets a global variable when the program completes.  The variable will contain any data written to stderr by the program.<div class="spacer">
</div>
The <b>-output</b> and <b>-error</b> variables are set only after the program completes.  But if the program takes a long time, to run you may want to receive its partial output.  You can gather data as it becomes available using the  <b>-onoutput</b> option.  It specifies a Tcl command prefix.  Whenever new data is available, this command is executed, with the data appended as an argument to the command.<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">
&#160;</div>
<br/>
proc GetInfo { data } {<br/>
    puts $data<br/>
}<br/>
blt::bgexec myStatus -onoutput GetInfo du -s $dir<br/>
</div>
<div style="height: 1.00em;">
&#160;</div>
When output is available, the procedure GetInfo is called. The  <b>-onerror</b> option performs a similar function for the stderr data stream.<div class="spacer">
</div>
Like <b>exec</b>, <b>bgexec</b> returns an error if the exit code of the program is not zero.  If you think you may get a non-zero exit code, you might want to invoke  <b>bgexec</b> from within a <b>catch</b>.<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">
&#160;</div>
<br/>
catch { blt::bgexec myStatus -output myOutput du -s $dir }<br/>
</div>
<div style="height: 1.00em;">
&#160;</div>
By default, <b>bgexec</b> will wait for the program to finish. But you can detach the program making ampersand (&amp;) the last argument on the command line.<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">
&#160;</div>
<br/>
global myStatus myOutput<br/>
blt::bgexec myStatus -output myOutput du -s $dir &amp;<br/>
</div>
<div style="height: 1.00em;">
&#160;</div>
<b>Bgexec</b> will return immediately and its result will be a list of the spawned process ids.  If at some point you need to wait for the program to finish up, you can use  <b>tkwait</b>.  When the program finishes, the variable myStatus will be written to, breaking out the  <b>tkwait</b> command.<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">
&#160;</div>
<br/>
global myStatus myOutput<br/>
blt::bgexec myStatus -output myOutput du -s $dir &amp;<br/>
	...<br/>
tkwait variable myStatus<br/>
</div>
<div style="height: 1.00em;">
&#160;</div>
</div>
<div class="section">
<h1>SYNTAX</h1> The  <b>bgexec</b> command takes the following form:<div style="height: 1.00em;">
&#160;</div>
<b>	blt::bgexec </b><i>varName</i> ?<i>option value</i>?... <i>program</i> ?<i>arg</i>?...<div style="height: 1.00em;">
&#160;</div>
<i>VarName</i> is the name of a global variable which is set when  <i>program</i> has finished executing.  The exit status of will be stored in  <i>varName</i>.  The exit status is a list of a status token, the process-id of the program, the exit code, and a status message.  You can also prematurely terminate the program by setting  <i>varName</i>.  Under Unix, the program will be sent a signal to terminate it (by default the signal is a SIGKILL; see the  <b>-killsignal</b> option).<div class="spacer">
</div>
<i>Program</i> is the name of the program to be executed and <i>args</i> are any extra arguments for  <i>program</i>.  The syntax of  <i>program</i> and <i>args</i> is the same as the <b>exec</b> command. So you can redirect I/O, execute pipelines, etc. (see the  <b>exec</b> manual for further information) just like  <b>exec</b>.  If the last argument is an ampersand (&amp;), the program will be run detached, and  <b>bgexec</b> will return immediately.  <i>VarName</i> will still be set with the return status when  <i>program</i> completes.</div>
<div class="section">
<h1>OPTIONS</h1>  <i>Option</i> refers to the switch name always beginning with a dash (-).  <i>Value</i> is the value of the option.  Option-value pairs are terminated either by the program name, or double dashes (--). The following options are available for  <b>bgexec</b>:<dl>
<dt>
<b>-decodeerror </b><i>encodingName</i></dt>
<dd>
<div style="height: 0.00em;">
&#160;</div>
Specifies the encoding of the stderr channel. This affects only data returned to the Tcl interpreter.  No translation is done on file redirection.<div style="height: 0.00em;">
&#160;</div>
For example if data is to be converted from Unicode for use in Tcl, you would use the &quot;unicode&quot; encoding. The default is that no translation is performed.</dd>
</dl>
<dl>
<dt>
<b>-decodeoutput </b><i>encodingName</i></dt>
<dd>
<div style="height: 0.00em;">
&#160;</div>
Specifies the encoding of the stdout channels. This affects only data returned to the Tcl interpreter.  No translation is done on file redirection.<div style="height: 0.00em;">
&#160;</div>
For example if data is to be converted from Unicode for use in Tcl, you would use the &quot;unicode&quot; encoding. The default is that no translation is performed.</dd>
</dl>
<dl>
<dt>
<b>-error </b><i>varName</i></dt>
<dd>
<div style="height: 0.00em;">
&#160;</div>
Specifies that a global variable <i>varName</i> is to be set with the contents of stderr after the program has completed.</dd>
</dl>
<dl>
<dt>
<b>-keepnewline </b><i>boolean</i></dt>
<dd>
Specifies that a trailing newline should be retained in the output. If  <i>boolean</i> is true, the trailing newline is truncated from the output of the  <b>-onoutput</b> and <b>-output</b> variables. The default value is true.</dd>
</dl>
<dl>
<dt>
<b>-killsignal </b><i>signal</i></dt>
<dd>
Specifies the signal to be sent to the program when terminating. This is available only under Unix.  <i>Signal</i> can either be a number (typically 1-32) or a mnemonic (such as SIGINT). If  <i>signal</i> is the empty string, then no signal is sent.  The default signal is 9 (SIGKILL).</dd>
</dl>
<dl>
<dt>
<b>-lasterror </b><i>varName</i></dt>
<dd>
Specifies a variable <i>varName</i> that is updated whenever data becomes available from standard error of the program.  <i>VarName</i> is a global variable. Unlike the <b>-error</b> option, data is available as soon as it arrives.</dd>
</dl>
<dl>
<dt>
<b>-lastoutput </b><i>varName</i></dt>
<dd>
Specifies a variable <i>varName</i> that is updated whenever data becomes available from standard output of the program.  <i>VarName</i> is a global variable. Unlike the <b>-output</b> option, data is available as soon as it arrives.</dd>
</dl>
<dl>
<dt>
<b>-linebuffered </b><i>boolean</i></dt>
<dd>
Specifies that updates should be made on a line-by-line basis. Normally when new data is available  <b>bgexec</b> will set the variable ( <b>-lastoutput</b> and <b>-lasterror</b> options) or invoke the command ( <b>-onoutput</b> and <b>-onerror</b> options) delivering all the new data currently available.  If  <i>boolean</i> is true, only one line at a time will be delivered.  This can be useful when you want to process the output on a line-by-line basis. The default value is false.</dd>
</dl>
<dl>
<dt>
<b>-output </b><i>varName</i></dt>
<dd>
<div style="height: 0.00em;">
&#160;</div>
Specifies that a global variable <i>varName</i> is to be set with the output of the program, once it has completed.  If this option is not set, no output will be accumulated.</dd>
</dl>
<dl>
<dt>
<b>-onerror </b><i>command</i></dt>
<dd>
Specifies the start of a Tcl command that will be executed whenever new data is available from standard error. The data is appended to the command as an extra argument before it is executed.</dd>
</dl>
<dl>
<dt>
<b>-onoutput </b><i>command</i></dt>
<dd>
Specifies the start of a Tcl command that will be executed whenever new data is available from standard output. The data is appended to the command as an extra argument before it is executed.</dd>
</dl>
<dl>
<dt>
<b>-update </b><i>varName</i></dt>
<dd>
Deprecated. This option is replaced by <b>-lasterror</b>.</dd>
</dl>
<dl>
<dt>
<b>--</b></dt>
<dd>
This marks the end of the options.  The following argument will be considered the name of a program even if it starts with a dash ( <b>-</b>).</dd>
</dl>
</div>
<div class="section">
<h1>PREEMPTION</h1> Because  <b>bgexec</b> allows Tk to handle events while a program is running, it's possible for an application to preempt itself with further user-interactions.  Let's say your application has a button that runs the disk usage example.  And while the du program is running, the user accidently presses the button again.  A second  <b>bgexec</b> program will preempt the first.  What this means is that the first program can not finish until the second program has completed.<div class="spacer">
</div>
Care must be taken to prevent an application from preempting itself by blocking further user-interactions (such as button clicks).  The BLT  <b>busy</b> command is very useful for just these situations. See the  <b>busy</b> manual for details.</div>
<div class="section">
<h1>DIFFERENCES WITH FILEEVENT</h1> Since Tk 4.0, a subset of  <b>bgexec</b> can be also achieved using the  <b>fileevent</b> command.  The steps for running a program in the background are:<div class="spacer">
</div>
Execute the program with the <b>open</b> command (using the &quot;|&quot; syntax) and save the file handle.<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">
&#160;</div>
<br/>
global fileId <br/>
set fileId [open &quot;|du -s $dir&quot; r]<br/>
</div>
<div style="height: 1.00em;">
&#160;</div>
Next register a Tcl code snippet with <b>fileevent</b> to be run whenever output is available on the file handle.  The code snippet will read from the file handle and save the output in a variable.<div style="margin-left: 5.00ex;">
<div style="height: 1.00em;">
&#160;</div>
<br/>
fileevent fileId readable { <br/>
    if { [gets $fileId line] &lt; 0 } {<br/>
	close $fileId<br/>
	set output $temp<br/>
	unset fileId temp<br/>
    } else {<br/>
	append temp $line<br/>
    }<br/>
}<br/>
</div>
<div style="height: 1.00em;">
&#160;</div>
<div class="spacer">
</div>
The biggest advantage of <b>bgexec</b> is that, unlike <b>fileevent</b>, it requires no additional Tcl code to run a program.  It's simpler and less error prone.  You don't have to worry about non-blocking I/O. It's handled transparently for you.<div class="spacer">
</div>
<b>Bgexec</b> runs programs that <b>fileevent</b> can not.  <b>Fileevent</b> assumes that the when stdout is closed the program has completed.  But some programs, like the Unix compress program, reopen stdout, fooling  <b>fileevent</b> into thinking the program has terminated.  In the example above, we assume that the program will write and flush its output line-by-line.  However running another program, your application may block in the  <b>gets</b> command reading a partial line.<div class="spacer">
</div>
<b>Bgexec</b> lets you get back the exit status of the program. It also allows you to collect data from both stdout and stderr simultaneously. Finally, since data collection is handled in C code,  <b>bgexec</b> is faster. You get back to the Tk event loop more quickly, making your application seem more responsive.</div>
<div class="section">
<h1>SEE ALSO</h1> busy, exec, tkwait</div>
<div class="section">
<h1>KEYWORDS</h1> exec, background, busy</div>
<table class="foot">
<tr>
<td class="foot-date">
2.4</td>
<td class="foot-os">
BLT</td>
</tr>
</table>
</div>
</body>
</html>

