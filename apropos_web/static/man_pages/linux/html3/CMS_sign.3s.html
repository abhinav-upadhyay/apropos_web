<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/linux/style.css" type="text/css" media="all"/>
<title>
CMS_sign(3SSL)</title>
</head>
<body>
<div class="mandoc">
<table class="head">
<tbody>
<tr>
<td class="head-ltitle">
CMS_sign(3SSL)</td>
<td class="head-vol">
OpenSSL</td>
<td class="head-rtitle">
CMS_sign(3SSL)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1>NAME</h1><br/>
 CMS_sign - create a CMS SignedData structure<br/>
</div>
<div class="section">
<h1>SYNOPSIS</h1><br/>
 #include &lt;openssl/cms.h&gt;<br/>
<br/>
 CMS_ContentInfo *CMS_sign(X509 *signcert, EVP_PKEY *pkey, STACK_OF(X509) *certs, BIO *data, unsigned int flags);<br/>
</div>
<div class="section">
<h1>DESCRIPTION</h1>  <i>CMS_sign()</i> creates and returns a CMS SignedData structure. <b>signcert</b> is the certificate to sign with,  <b>pkey</b> is the corresponding private key.  <b>certs</b> is an optional additional set of certificates to include in the CMS structure (for example any intermediate CAs in the chain). Any or all of these parameters can be  <b>NULL</b>, see <b>NOTES</b> below.<div class="spacer">
</div>
The data to be signed is read from BIO <b>data</b>.<div class="spacer">
</div>
<b>flags</b> is an optional set of flags.</div>
<div class="section">
<h1>NOTES</h1> Any of the following flags (ored together) can be passed in the  <b>flags</b> parameter.<div class="spacer">
</div>
Many S/MIME clients expect the signed content to include valid MIME headers. If the  <b>CMS_TEXT</b> flag is set MIME headers for type <b>text/plain</b> are prepended to the data.<div class="spacer">
</div>
If <b>CMS_NOCERTS</b> is set the signer's certificate will not be included in the CMS_ContentInfo structure, the signer's certificate must still be supplied in the  <b>signcert</b> parameter though. This can reduce the size of the signature if the signers certificate can be obtained by other means: for example a previously signed message.<div class="spacer">
</div>
The data being signed is included in the CMS_ContentInfo structure, unless  <b>CMS_DETACHED</b> is set in which case it is omitted. This is used for CMS_ContentInfo detached signatures which are used in S/MIME plaintext signed messages for example.<div class="spacer">
</div>
Normally the supplied content is translated into MIME canonical format (as required by the S/MIME specifications) if  <b>CMS_BINARY</b> is set no translation occurs. This option should be used if the supplied data is in binary format otherwise the translation will corrupt it.<div class="spacer">
</div>
The SignedData structure includes several CMS signedAttributes including the signing time, the CMS content type and the supported list of ciphers in an SMIMECapabilities attribute. If  <b>CMS_NOATTR</b> is set then no signedAttributes will be used. If  <b>CMS_NOSMIMECAP</b> is set then just the SMIMECapabilities are omitted.<div class="spacer">
</div>
If present the SMIMECapabilities attribute indicates support for the following algorithms in preference order: 256 bit AES, Gost R3411-94, Gost 28147-89, 192 bit AES, 128 bit AES, triple DES, 128 bit RC2, 64 bit RC2, DES and 40 bit RC2. If any of these algorithms is not available then it will not be included: for example the GOST algorithms will not be included if the GOST ENGINE is not loaded.<div class="spacer">
</div>
OpenSSL will by default identify signing certificates using issuer name and serial number. If  <b>CMS_USE_KEYID</b> is set it will use the subject key identifier value instead. An error occurs if the signing certificate does not have a subject key identifier extension.<div class="spacer">
</div>
If the flags <b>CMS_STREAM</b> is set then the returned <b>CMS_ContentInfo</b> structure is just initialized ready to perform the signing operation. The signing is however  <b>not</b> performed and the data to be signed is not read from the  <b>data</b> parameter. Signing is deferred until after the data has been written. In this way data can be signed in a single pass.<div class="spacer">
</div>
If the <b>CMS_PARTIAL</b> flag is set a partial <b>CMS_ContentInfo</b> structure is output to which additional signers and capabilities can be added before finalization.<div class="spacer">
</div>
If the flag <b>CMS_STREAM</b> is set the returned <b>CMS_ContentInfo</b> structure is  <b>not</b> complete and outputting its contents via a function that does not properly finalize the  <b>CMS_ContentInfo</b> structure will give unpredictable results.<div class="spacer">
</div>
Several functions including <i>SMIME_write_CMS()</i>, <i>i2d_CMS_bio_stream()</i>,  <i>PEM_write_bio_CMS_stream()</i> finalize the structure. Alternatively finalization can be performed by obtaining the streaming ASN1  <b>BIO</b> directly using  <i>BIO_new_CMS()</i>.<div class="spacer">
</div>
If a signer is specified it will use the default digest for the signing algorithm. This is  <b>SHA1</b> for both RSA and DSA keys.<div class="spacer">
</div>
If <b>signcert</b> and <b>pkey</b> are NULL then a certificates only CMS structure is output.<div class="spacer">
</div>
The function <i>CMS_sign()</i> is a basic CMS signing function whose output will be suitable for many purposes. For finer control of the output format the  <b>certs</b>, <b>signcert</b> and <b>pkey</b> parameters can all be <b>NULL</b> and the  <b>CMS_PARTIAL</b> flag set. Then one or more signers can be added using the function  <i>CMS_sign_add1_signer()</i>, non default digests can be used and custom attributes added.  <b></b><b><i>CMS_final()</i></b><b></b> must then be called to finalize the structure if streaming is not enabled.</div>
<div class="section">
<h1>BUGS</h1> Some attributes such as counter signatures are not supported.</div>
<div class="section">
<h1>RETURN VALUES</h1>  <i>CMS_sign()</i> returns either a valid CMS_ContentInfo structure or NULL if an error occurred. The error can be obtained from  <i>ERR_get_error</i>(3).</div>
<div class="section">
<h1>SEE ALSO</h1>  <i>ERR_get_error</i>(3), <i>CMS_verify</i>(3)</div>
<div class="section">
<h1>HISTORY</h1>  <i>CMS_sign()</i> was added to OpenSSL 0.9.8<div class="spacer">
</div>
The <b>CMS_STREAM</b> flag is only supported for detached data in OpenSSL 0.9.8, it is supported for embedded data in OpenSSL 1.0.0 and later.</div>
<table class="foot">
<tr>
<td class="foot-date">
2009-09-30</td>
<td class="foot-os">
1.0.1</td>
</tr>
</table>
</div>
</body>
</html>

