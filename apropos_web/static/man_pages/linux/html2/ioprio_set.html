<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/linux/style.css" type="text/css" media="all"/>
<title>
IOPRIO_SET(2)</title>
</head>
<body>
<div class="mandoc">
<table class="head">
<tbody>
<tr>
<td class="head-ltitle">
IOPRIO_SET(2)</td>
<td class="head-vol">
Linux Programmer's Manual</td>
<td class="head-rtitle">
IOPRIO_SET(2)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1>NAME</h1> ioprio_get, ioprio_set - get/set I/O scheduling class and priority</div>
<div class="section">
<h1>SYNOPSIS</h1><br/>
<b>int ioprio_get(int </b><i>which</i><b>, int </b><i>who</i><b>);</b><br/>
<b>int ioprio_set(int </b><i>which</i><b>, int </b><i>who</i><b>, int </b><i>ioprio</i><b>);</b><br/>
</div>
<div class="section">
<h1>DESCRIPTION</h1> The <b>ioprio_get</b>() and <b>ioprio_set</b>() system calls respectively get and set the I/O scheduling class and priority of one or more processes.<div style="height: 1.00em;">
&#160;</div>
The <i>which</i> and <i>who</i> arguments identify the process(es) on which the system calls operate. The <i>which</i> argument determines how <i>who</i> is interpreted, and has one of the following values:<dl>
<dt>
<b>IOPRIO_WHO_PROCESS</b></dt>
<dd>
<i>who</i> is a process ID identifying a single process.</dd>
</dl>
<dl>
<dt>
<b>IOPRIO_WHO_PGRP</b></dt>
<dd>
<i>who</i> is a process group ID identifying all the members of a process group.</dd>
</dl>
<dl>
<dt>
<b>IOPRIO_WHO_USER</b></dt>
<dd>
<i>who</i> is a user ID identifying all of the processes that have a matching real UID.</dd>
</dl>
<div class="spacer">
</div>
If <i>which</i> is specified as <b>IOPRIO_WHO_PGRP</b> or <b>IOPRIO_WHO_USER</b> when calling <b>ioprio_get</b>(), and more than one process matches <i>who</i>, then the returned priority will be the highest one found among all of the matching processes. One priority is said to be higher than another one if it belongs to a higher priority class (<b>IOPRIO_CLASS_RT</b> is the highest priority class; <b>IOPRIO_CLASS_IDLE</b> is the lowest) or if it belongs to the same priority class as the other process but has a higher priority level (a lower priority number means a higher priority level).<div style="height: 1.00em;">
&#160;</div>
The <i>ioprio</i> argument given to <b>ioprio_set</b>() is a bit mask that specifies both the scheduling class and the priority to be assigned to the target process(es). The following macros are used for assembling and dissecting <i>ioprio</i> values:<dl>
<dt>
<b>IOPRIO_PRIO_VALUE(</b><i>class</i><b>, </b><i>data</i><b>)</b></dt>
<dd>
Given a scheduling <i>class</i> and priority (<i>data</i>), this macro combines the two values to produce an <i>ioprio</i> value, which is returned as the result of the macro.</dd>
</dl>
<dl>
<dt>
<b>IOPRIO_PRIO_CLASS(</b><i>mask</i><b>)</b></dt>
<dd>
Given <i>mask</i> (an <i>ioprio</i> value), this macro returns its I/O class component, that is, one of the values <b>IOPRIO_CLASS_RT</b>, <b>IOPRIO_CLASS_BE</b>, or <b>IOPRIO_CLASS_IDLE</b>.</dd>
</dl>
<dl>
<dt>
<b>IOPRIO_PRIO_DATA(</b><i>mask</i><b>)</b></dt>
<dd>
Given <i>mask</i> (an <i>ioprio</i> value), this macro returns its priority (<i>data</i>) component.</dd>
</dl>
<div class="spacer">
</div>
See the NOTES section for more information on scheduling classes and priorities.<div style="height: 1.00em;">
&#160;</div>
I/O priorities are supported for reads and for synchronous (<b>O_DIRECT</b>, <b>O_SYNC</b>) writes. I/O priorities are not supported for asynchronous writes because they are issued outside the context of the program dirtying the memory, and thus program-specific priorities do not apply.</div>
<div class="section">
<h1>RETURN VALUE</h1> On success, <b>ioprio_get</b>() returns the <i>ioprio</i> value of the process with highest I/O priority of any of the processes that match the criteria specified in <i>which</i> and <i>who</i>. On error, -1 is returned, and <i>errno</i> is set to indicate the error.<div class="spacer">
</div>
On success, <b>ioprio_set</b>() returns 0. On error, -1 is returned, and <i>errno</i> is set to indicate the error.</div>
<div class="section">
<h1>ERRORS</h1><dl>
<dt>
<b>EINVAL</b></dt>
<dd>
Invalid value for <i>which</i> or <i>ioprio</i>. Refer to the NOTES section for available scheduler classes and priority levels for <i>ioprio</i>.</dd>
</dl>
<dl>
<dt>
<b>EPERM</b></dt>
<dd>
The calling process does not have the privilege needed to assign this <i>ioprio</i> to the specified process(es). See the NOTES section for more information on required privileges for <b>ioprio_set</b>().</dd>
</dl>
<dl>
<dt>
<b>ESRCH</b></dt>
<dd>
No process(es) could be found that matched the specification in <i>which</i> and <i>who</i>.</dd>
</dl>
</div>
<div class="section">
<h1>VERSIONS</h1> These system calls have been available on Linux since kernel 2.6.13.</div>
<div class="section">
<h1>CONFORMING TO</h1> These system calls are Linux-specific.</div>
<div class="section">
<h1>NOTES</h1> Glibc does not provide wrapper for these system calls; call them using <b>syscall</b>(2).<div style="height: 1.00em;">
&#160;</div>
These system calls only have an effect when used in conjunction with an I/O scheduler that supports I/O priorities. As at kernel 2.6.17 the only such scheduler is the Completely Fair Queuing (CFQ) I/O scheduler.<div class="subsection">
<h2>Selecting an I/O Scheduler</h2> I/O Schedulers are selected on a per-device basis via the special file <i>/sys/block/&lt;device&gt;/queue/scheduler</i>.<div style="height: 1.00em;">
&#160;</div>
One can view the current I/O scheduler via the <i>/sys</i> file system. For example, the following command displays a list of all schedulers currently loaded in the kernel:<div style="height: 1.00em;">
&#160;</div>
<div style="margin-left: 5.00ex;">
<br/>
$<b> cat /sys/block/hda/queue/scheduler</b><br/>
noop anticipatory deadline [cfq]<br/>
</div>
<div style="height: 1.00em;">
&#160;</div>
The scheduler surrounded by brackets is the one actually in use for the device (<i>hda</i> in the example). Setting another scheduler is done by writing the name of the new scheduler to this file. For example, the following command will set the scheduler for the <i>hda</i> device to <i>cfq</i>:<div style="height: 1.00em;">
&#160;</div>
<div style="margin-left: 5.00ex;">
<br/>
$<b> su</b><br/>
Password:<br/>
#<b> echo cfq &gt; /sys/block/hda/queue/scheduler</b><br/>
</div>
</div>
<div class="subsection">
<h2>The Completely Fair Queuing (CFQ) I/O Scheduler</h2> Since v3 (aka CFQ Time Sliced) CFQ implements I/O nice levels similar to those of CPU scheduling. These nice levels are grouped in three scheduling classes each one containing one or more priority levels:<dl>
<dt>
<b>IOPRIO_CLASS_RT</b> (1)</dt>
<dd>
This is the real-time I/O class. This scheduling class is given higher priority than any other class: processes from this class are given first access to the disk every time. Thus this I/O class needs to be used with some care: one I/O real-time process can starve the entire system. Within the real-time class, there are 8 levels of class data (priority) that determine exactly how much time this process needs the disk for on each service. The highest real-time priority level is 0; the lowest is 7. In the future this might change to be more directly mappable to performance, by passing in a desired data rate instead.</dd>
</dl>
<dl>
<dt>
<b>IOPRIO_CLASS_BE</b> (2)</dt>
<dd>
This is the best-effort scheduling class, which is the default for any process that hasn't set a specific I/O priority. The class data (priority) determines how much I/O bandwidth the process will get. Best-effort priority levels are analogous to CPU nice values (see <b>getpriority</b>(2)). The priority level determines a priority relative to other processes in the best-effort scheduling class. Priority levels range from 0 (highest) to 7 (lowest).</dd>
</dl>
<dl>
<dt>
<b>IOPRIO_CLASS_IDLE</b> (3)</dt>
<dd>
This is the idle scheduling class. Processes running at this level only get I/O time when no-one else needs the disk. The idle class has no class data. Attention is required when assigning this priority class to a process, since it may become starved if higher priority processes are constantly accessing the disk.</dd>
</dl>
<div class="spacer">
</div>
Refer to <i>Documentation/block/ioprio.txt</i> for more information on the CFQ I/O Scheduler and an example program.</div>
<div class="subsection">
<h2>Required permissions to set I/O priorities</h2> Permission to change a process's priority is granted or denied based on two assertions:<dl>
<dt>
<b>Process ownership</b></dt>
<dd>
An unprivileged process may only set the I/O priority of a process whose real UID matches the real or effective UID of the calling process. A process which has the <b>CAP_SYS_NICE</b> capability can change the priority of any process.</dd>
</dl>
<dl>
<dt>
<b>What is the desired priority</b></dt>
<dd>
Attempts to set very high priorities (<b>IOPRIO_CLASS_RT</b>) require the <b>CAP_SYS_ADMIN</b> capability. Kernel versions up to 2.6.24 also required <b>CAP_SYS_ADMIN</b> to set a very low priority (<b>IOPRIO_CLASS_IDLE</b>), but since Linux 2.6.25, this is no longer required.</dd>
</dl>
<div class="spacer">
</div>
A call to <b>ioprio_set</b>() must follow both rules, or the call will fail with the error <b>EPERM</b>.</div>
</div>
<div class="section">
<h1>BUGS</h1> Glibc does not yet provide a suitable header file defining the function prototypes and macros described on this page. Suitable definitions can be found in <i>linux/ioprio.h</i>.</div>
<div class="section">
<h1>SEE ALSO</h1> <b>getpriority</b>(2), <b>open</b>(2), <b>capabilities</b>(7)<div style="height: 1.00em;">
&#160;</div>
Documentation/block/ioprio.txt in the kernel source tree.</div>
<div class="section">
<h1>COLOPHON</h1> This page is part of release 3.35 of the Linux <i>man-pages</i> project. A description of the project, and information about reporting bugs, can be found at http://man7.org/linux/man-pages/.</div>
<table class="foot">
<tr>
<td class="foot-date">
2008-07-09</td>
<td class="foot-os">
Linux</td>
</tr>
</table>
</div>
</body>
</html>

