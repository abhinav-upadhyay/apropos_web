<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/linux/style.css" type="text/css" media="all"/>
<title>
SCHED_SETAFFINITY(2)</title>
</head>
<body>
<div class="mandoc">
<table class="head">
<tbody>
<tr>
<td class="head-ltitle">
SCHED_SETAFFINITY(2)</td>
<td class="head-vol">
Linux Programmer's Manual</td>
<td class="head-rtitle">
SCHED_SETAFFINITY(2)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1>NAME</h1> sched_setaffinity, sched_getaffinity - set and get a process's CPU affinity mask</div>
<div class="section">
<h1>SYNOPSIS</h1><br/>
<b>#define _GNU_SOURCE</b>             /* See feature_test_macros(7) */ <b>#include &lt;sched.h&gt;</b><div style="height: 1.00em;">
&#160;</div>
<br/>
<b>int sched_setaffinity(pid_t </b><i>pid</i><b>, size_t </b><i>cpusetsize</i><b>,</b><br/>
<b>                      cpu_set_t *</b><i>mask</i><b>);</b><div style="height: 1.00em;">
&#160;</div>
<br/>
<b>int sched_getaffinity(pid_t </b><i>pid</i><b>, size_t </b><i>cpusetsize</i><b>,</b><br/>
<b>                      cpu_set_t *</b><i>mask</i><b>);</b><br/>
</div>
<div class="section">
<h1>DESCRIPTION</h1> A process's CPU affinity mask determines the set of CPUs on which it is eligible to run. On a multiprocessor system, setting the CPU affinity mask can be used to obtain performance benefits. For example, by dedicating one CPU to a particular process (i.e., setting the affinity mask of that process to specify a single CPU, and setting the affinity mask of all other processes to exclude that CPU), it is possible to ensure maximum execution speed for that process. Restricting a process to run on a single CPU also avoids the performance cost caused by the cache invalidation that occurs when a process ceases to execute on one CPU and then recommences execution on a different CPU.<div style="height: 1.00em;">
&#160;</div>
A CPU affinity mask is represented by the <i>cpu_set_t</i> structure, a &quot;CPU set&quot;, pointed to by <i>mask</i>. A set of macros for manipulating CPU sets is described in <b>CPU_SET</b>(3).<div style="height: 1.00em;">
&#160;</div>
<b>sched_setaffinity</b>() sets the CPU affinity mask of the process whose ID is <i>pid</i> to the value specified by <i>mask</i>. If <i>pid</i> is zero, then the calling process is used. The argument <i>cpusetsize</i> is the length (in bytes) of the data pointed to by <i>mask</i>. Normally this argument would be specified as <i>sizeof(cpu_set_t)</i>.<div style="height: 1.00em;">
&#160;</div>
If the process specified by <i>pid</i> is not currently running on one of the CPUs specified in <i>mask</i>, then that process is migrated to one of the CPUs specified in <i>mask</i>.<div style="height: 1.00em;">
&#160;</div>
<b>sched_getaffinity</b>() writes the affinity mask of the process whose ID is <i>pid</i> into the <i>cpu_set_t</i> structure pointed to by <i>mask</i>. The <i>cpusetsize</i> argument specifies the size (in bytes) of <i>mask</i>. If <i>pid</i> is zero, then the mask of the calling process is returned.</div>
<div class="section">
<h1>RETURN VALUE</h1> On success, <b>sched_setaffinity</b>() and <b>sched_getaffinity</b>() return 0. On error, -1 is returned, and <i>errno</i> is set appropriately.</div>
<div class="section">
<h1>ERRORS</h1><dl>
<dt>
<b>EFAULT</b></dt>
<dd>
A supplied memory address was invalid.</dd>
</dl>
<dl>
<dt>
<b>EINVAL</b></dt>
<dd>
The affinity bit mask <i>mask</i> contains no processors that are currently physically on the system and permitted to the process according to any restrictions that may be imposed by the &quot;cpuset&quot; mechanism described in <b>cpuset</b>(7).</dd>
</dl>
<dl>
<dt>
<b>EINVAL</b></dt>
<dd>
(<b>sched_getaffinity</b>() and, in kernels before 2.6.9, <b>sched_setaffinity</b>()) <i>cpusetsize</i> is smaller than the size of the affinity mask used by the kernel.</dd>
</dl>
<dl>
<dt>
<b>EPERM</b></dt>
<dd>
(<b>sched_setaffinity</b>()) The calling process does not have appropriate privileges. The caller needs an effective user ID equal to the real user ID or effective user ID of the process identified by <i>pid</i>, or it must possess the <b>CAP_SYS_NICE</b> capability.</dd>
</dl>
<dl>
<dt>
<b>ESRCH</b></dt>
<dd>
The process whose ID is <i>pid</i> could not be found.</dd>
</dl>
</div>
<div class="section">
<h1>VERSIONS</h1> The CPU affinity system calls were introduced in Linux kernel 2.5.8. The system call wrappers were introduced in glibc 2.3. Initially, the glibc interfaces included a <i>cpusetsize</i> argument, typed as <i>unsigned int</i>. In glibc 2.3.3, the <i>cpusetsize</i> argument was removed, but was then restored in glibc 2.3.4, with type <i>size_t</i>.</div>
<div class="section">
<h1>CONFORMING TO</h1> These system calls are Linux-specific.</div>
<div class="section">
<h1>NOTES</h1> After a call to <b>sched_setaffinity</b>(), the set of CPUs on which the process will actually run is the intersection of the set specified in the <i>mask</i> argument and the set of CPUs actually present on the system. The system may further restrict the set of CPUs on which the process runs if the &quot;cpuset&quot; mechanism described in <b>cpuset</b>(7) is being used. These restrictions on the actual set of CPUs on which the process will run are silently imposed by the kernel.<div style="height: 1.00em;">
&#160;</div>
<b>sched_setscheduler</b>(2) has a description of the Linux scheduling scheme.<div class="spacer">
</div>
The affinity mask is actually a per-thread attribute that can be adjusted independently for each of the threads in a thread group. The value returned from a call to <b>gettid</b>(2) can be passed in the argument <i>pid</i>. Specifying <i>pid</i> as 0 will set the attribute for the calling thread, and passing the value returned from a call to <b>getpid</b>(2) will set the attribute for the main thread of the thread group. (If you are using the POSIX threads API, then use <b>pthread_setaffinity_np</b>(3) instead of <b>sched_setaffinity</b>().)<div style="height: 1.00em;">
&#160;</div>
A child created via <b>fork</b>(2) inherits its parent's CPU affinity mask. The affinity mask is preserved across an <b>execve</b>(2).<div style="height: 1.00em;">
&#160;</div>
This manual page describes the glibc interface for the CPU affinity calls. The actual system call interface is slightly different, with the <i>mask</i> being typed as <i>unsigned long *</i>, reflecting the fact that the underlying implementation of CPU sets is a simple bit mask. On success, the raw <b>sched_getaffinity</b>() system call returns the size (in bytes) of the <i>cpumask_t</i> data type that is used internally by the kernel to represent the CPU set bit mask.</div>
<div class="section">
<h1>SEE ALSO</h1> <b>clone</b>(2), <b>getcpu</b>(2), <b>getpriority</b>(2), <b>gettid</b>(2), <b>nice</b>(2), <b>sched_get_priority_max</b>(2), <b>sched_get_priority_min</b>(2), <b>sched_getscheduler</b>(2), <b>sched_setscheduler</b>(2), <b>setpriority</b>(2), <b>CPU_SET</b>(3), <b>pthread_setaffinity_np</b>(3), <b>sched_getcpu</b>(3), <b>capabilities</b>(7), <b>cpuset</b>(7)</div>
<div class="section">
<h1>COLOPHON</h1> This page is part of release 3.35 of the Linux <i>man-pages</i> project. A description of the project, and information about reporting bugs, can be found at http://man7.org/linux/man-pages/.</div>
<table class="foot">
<tr>
<td class="foot-date">
2010-11-06</td>
<td class="foot-os">
Linux</td>
</tr>
</table>
</div>
</body>
</html>

