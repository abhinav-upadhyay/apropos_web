<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/linux/style.css" type="text/css" media="all"/>
<title>
APT-SECURE(8)</title>
</head>
<body>
<div class="mandoc">
<table class="head">
<tbody>
<tr>
<td class="head-ltitle">
APT-SECURE(8)</td>
<td class="head-vol">
APT</td>
<td class="head-rtitle">
APT-SECURE(8)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1>NAME</h1> apt-secure - Archive authentication support for APT</div>
<div class="section">
<h1>DESCRIPTION</h1> Starting with version 0.6,  <b>apt</b> contains code that does signature checking of the Release file for all archives. This ensures that packages in the archive can't be modified by people who have no access to the Release file signing key.<div class="spacer">
</div>
If a package comes from a archive without a signature or with a signature that apt does not have a key for that package is considered untrusted and installing it will result in a big warning.  <b>apt-get</b> will currently only warn for unsigned archives, future releases might force all sources to be verified before downloading packages from them.<div class="spacer">
</div>
The package frontends  <b>apt-get</b>(8),  <b>aptitude</b>(8) and  <b>synaptic</b>(8) support this new authentication feature.</div>
<div class="section">
<h1>TRUSTED ARCHIVES</h1> The chain of trust from an apt archive to the end user is made up of different steps.  <b>apt-secure</b> is the last step in this chain, trusting an archive does not mean that the packages that you trust it do not contain malicious code but means that you trust the archive maintainer. It's the archive maintainer responsibility to ensure that the archive integrity is correct.<div class="spacer">
</div>
apt-secure does not review signatures at a package level. If you require tools to do this you should look at  <b>debsig-verify</b> and  <b>debsign</b> (provided in the debsig-verify and devscripts packages respectively).<div class="spacer">
</div>
The chain of trust in Debian starts when a maintainer uploads a new package or a new version of a package to the Debian archive. This upload in order to become effective needs to be signed by a key of a maintainer within the Debian maintainer's keyring (available in the debian-keyring package). Maintainer's keys are signed by other maintainers following pre-established procedures to ensure the identity of the key holder.<div class="spacer">
</div>
Once the uploaded package is verified and included in the archive, the maintainer signature is stripped off, an MD5 sum of the package is computed and put in the Packages file. The MD5 sum of all of the packages files are then computed and put into the Release file. The Release file is then signed by the archive key (which is created once a year) and distributed through the FTP server. This key is also on the Debian keyring.<div class="spacer">
</div>
Any end user can check the signature of the Release file, extract the MD5 sum of a package from it and compare it with the MD5 sum of the package he downloaded. Prior to version 0.6 only the MD5 sum of the downloaded Debian package was checked. Now both the MD5 sum and the signature of the Release file are checked.<div class="spacer">
</div>
Notice that this is distinct from checking signatures on a per package basis. It is designed to prevent two possible attacks:<div style="height: 1.00em;">
&#160;</div>
<div style="margin-left: 4.00ex;">
&#8226;Network &quot;man in the middle&quot; attacks. Without signature checking, a malicious agent can introduce himself in the package download process and provide malicious software either by controlling a network element (router, switch, etc.) or by redirecting traffic to a rogue server (through arp or DNS spoofing attacks).</div>
<div style="height: 1.00em;">
&#160;</div>
<div style="margin-left: 4.00ex;">
&#8226;Mirror network compromise. Without signature checking, a malicious agent can compromise a mirror host and modify the files in it to propagate malicious software to all users downloading packages from that host.</div>
<div class="spacer">
</div>
However, it does not defend against a compromise of the Debian master server itself (which signs the packages) or against a compromise of the key used to sign the Release files. In any case, this mechanism can complement a per-package signature.</div>
<div class="section">
<h1>USER CONFIGURATION</h1><div style="height: 1.00em;">
&#160;</div>
<b>apt-key</b> is the program that manages the list of keys used by apt. It can be used to add or remove keys although an installation of this release will automatically provide the default Debian archive signing keys used in the Debian package repositories.<div class="spacer">
</div>
In order to add a new key you need to first download it (you should make sure you are using a trusted communication channel when retrieving it), add it with  <b>apt-key</b> and then run  <b>apt-get update</b> so that apt can download and verify the InRelease or Release.gpg files from the archives you have configured.</div>
<div class="section">
<h1>ARCHIVE CONFIGURATION</h1> If you want to provide archive signatures in an archive under your maintenance you have to:<div style="height: 1.00em;">
&#160;</div>
<div style="margin-left: 4.00ex;">
&#8226;<i>Create a toplevel Release file</i>, if it does not exist already. You can do this by running  <b>apt-ftparchive release</b> (provided in apt-utils).</div>
<div style="height: 1.00em;">
&#160;</div>
<div style="margin-left: 4.00ex;">
&#8226;<i>Sign it</i>. You can do this by running  <b>gpg --clearsign -o InRelease Release</b> and  <b>gpg -abs -o Release.gpg Release</b>.</div>
<div style="height: 1.00em;">
&#160;</div>
<div style="margin-left: 4.00ex;">
&#8226;<i>Publish the key fingerprint</i>, that way your users will know what key they need to import in order to authenticate the files in the archive.</div>
<div class="spacer">
</div>
Whenever the contents of the archive changes (new packages are added or removed) the archive maintainer has to follow the first two steps previously outlined.</div>
<div class="section">
<h1>SEE ALSO</h1><div style="height: 1.00em;">
&#160;</div>
<b>apt.conf</b>(5),  <b>apt-get</b>(8),  <b>sources.list</b>(5),  <b>apt-key</b>(8),  <b>apt-ftparchive</b>(1),  <b>debsign</b>(1)  <b>debsig-verify</b>(1),  <b>gpg</b>(1)<div class="spacer">
</div>
For more background information you might want to review the  <b>Debian Security Infrastructure</b>[1] chapter of the Securing Debian Manual (available also in the harden-doc package) and the  <b>Strong Distribution HOWTO</b>[2] by V. Alex Brennen.</div>
<div class="section">
<h1>BUGS</h1>  <b>APT bug page</b>[3]. If you wish to report a bug in APT, please see /usr/share/doc/debian/bug-reporting.txt or the  <b>reportbug</b>(1) command.</div>
<div class="section">
<h1>AUTHOR</h1> APT was written by the APT team &lt;apt@packages.debian.org&gt;.</div>
<div class="section">
<h1>MANPAGE AUTHORS</h1> This man-page is based on the work of Javier Fern&#225;ndez-Sanguino Pe&#241;a, Isaac Jones, Colin Walters, Florian Weimer and Michael Vogt.</div>
<div class="section">
<h1>AUTHOR</h1>  <b>Jason Gunthorpe</b><div style="margin-left: 4.00ex;">
</div>
</div>
<div class="section">
<h1>COPYRIGHT</h1> Copyright &#169; 1998-2001 Jason Gunthorpe<div style="height: 0.00em;">
&#160;</div>
</div>
<div class="section">
<h1>NOTES</h1><dl>
<dt>
 1.</dt>
<dd>
Debian Security Infrastructure</dd>
</dl>
<div style="margin-left: 4.00ex;">
http://www.debian.org/doc/manuals/securing-debian-howto/ch7.en.html</div>
<dl>
<dt>
 2.</dt>
<dd>
Strong Distribution HOWTO</dd>
</dl>
<div style="margin-left: 4.00ex;">
http://www.cryptnet.net/fdp/crypto/strong_distro.html</div>
<dl>
<dt>
 3.</dt>
<dd>
APT bug page</dd>
</dl>
<div style="margin-left: 4.00ex;">
http://bugs.debian.org/src:apt</div>
</div>
<table class="foot">
<tr>
<td class="foot-date">
28 October 2008</td>
<td class="foot-os">
Linux</td>
</tr>
</table>
</div>
</body>
</html>

