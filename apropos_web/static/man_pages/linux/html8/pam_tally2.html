<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/linux/style.css" type="text/css" media="all"/>
<title>
PAM_TALLY2(8)</title>
</head>
<body>
<div class="mandoc">
<table class="head">
<tbody>
<tr>
<td class="head-ltitle">
PAM_TALLY2(8)</td>
<td class="head-vol">
Linux-PAM Manual</td>
<td class="head-rtitle">
PAM_TALLY2(8)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1>NAME</h1> pam_tally2 - The login counter (tallying) module</div>
<div class="section">
<h1>SYNOPSIS</h1><div style="margin-left: 15.00ex;text-indent: -15.00ex;" class="spacer">
<b>pam_tally2.so</b> [file=<i>/path/to/counter</i>] [onerr=[<i>fail</i>|<i>succeed</i>]] [magic_root] [even_deny_root] [deny=<i>n</i>] [lock_time=<i>n</i>] [unlock_time=<i>n</i>] [root_unlock_time=<i>n</i>] [serialize] [audit] [silent] [no_log_info]</div>
<div class="spacer">
</div>
<div style="margin-left: 11.00ex;text-indent: -11.00ex;" class="spacer">
<b>pam_tally2</b> [--file&#160;<i>/path/to/counter</i>] [--user&#160;<i>username</i>] [--reset[=<i>n</i>]] [--quiet]</div>
</div>
<div class="section">
<h1>DESCRIPTION</h1> This module maintains a count of attempted accesses, can reset count on success, can deny access if too many attempts fail.<div class="spacer">
</div>
pam_tally2 comes in two parts:  <b>pam_tally2.so</b> and  <b>pam_tally2</b>. The former is the PAM module and the latter, a stand-alone program.  <b>pam_tally2</b> is an (optional) application which can be used to interrogate and manipulate the counter file. It can display users' counts, set individual counts, or clear all counts. Setting artificially high counts may be useful for blocking users without changing their passwords. For example, one might find it useful to clear all counts every midnight from a cron job.<div class="spacer">
</div>
Normally, failed attempts to access  <i>root</i> will  <b>not</b> cause the root account to become blocked, to prevent denial-of-service: if your users aren't given shell accounts and root may only login via  <b>su</b> or at the machine console (not telnet/rsh, etc), this is safe.</div>
<div class="section">
<h1>OPTIONS</h1> GLOBAL OPTIONS<div style="margin-left: 4.00ex;">
This can be used for  <i>auth</i> and  <i>account</i> module types.<div class="spacer">
</div>
<b>onerr=[</b><b></b><i>fail</i><b>|</b><b></b><i>succeed</i><b>]</b><div style="margin-left: 4.00ex;">
If something weird happens (like unable to open the file), return with  <b>PAM_SUCCESS</b> if  <b>onerr=</b><b></b><i>succeed</i> is given, else with the corresponding PAM error code.</div>
<div class="spacer">
</div>
<b>file=</b><b></b><i>/path/to/counter</i><div style="margin-left: 4.00ex;">
File where to keep counts. Default is /var/log/tallylog.</div>
<div class="spacer">
</div>
<b>audit</b><div style="margin-left: 4.00ex;">
Will log the user name into the system log if the user is not found.</div>
<div class="spacer">
</div>
<b>silent</b><div style="margin-left: 4.00ex;">
Don't print informative messages.</div>
<div class="spacer">
</div>
<b>no_log_info</b><div style="margin-left: 4.00ex;">
Don't log informative messages via  <b>syslog</b>(3).</div>
</div>
<div class="spacer">
</div>
AUTH OPTIONS<div style="margin-left: 4.00ex;">
Authentication phase first increments attempted login counter and checks if user should be denied access. If the user is authenticated and the login process continues on call to  <b>pam_setcred</b>(3) it resets the attempts counter.<div class="spacer">
</div>
<b>deny=</b><b></b><i>n</i><div style="margin-left: 4.00ex;">
Deny access if tally for this user exceeds  <i>n</i>.</div>
<div class="spacer">
</div>
<b>lock_time=</b><b></b><i>n</i><div style="margin-left: 4.00ex;">
Always deny for  <i>n</i> seconds after failed attempt.</div>
<div class="spacer">
</div>
<b>unlock_time=</b><b></b><i>n</i><div style="margin-left: 4.00ex;">
Allow access after  <i>n</i> seconds after failed attempt. If this option is used the user will be locked out for the specified amount of time after he exceeded his maximum allowed attempts. Otherwise the account is locked until the lock is removed by a manual intervention of the system administrator.</div>
<div class="spacer">
</div>
<b>magic_root</b><div style="margin-left: 4.00ex;">
If the module is invoked by a user with uid=0 the counter is not incremented. The sysadmin should use this for user launched services, like  <b>su</b>, otherwise this argument should be omitted.</div>
<div class="spacer">
</div>
<b>no_lock_time</b><div style="margin-left: 4.00ex;">
Do not use the .fail_locktime field in /var/log/faillog for this user.</div>
<div class="spacer">
</div>
<b>even_deny_root</b><div style="margin-left: 4.00ex;">
Root account can become unavailable.</div>
<div class="spacer">
</div>
<b>root_unlock_time=</b><b></b><i>n</i><div style="margin-left: 4.00ex;">
This option implies  <b>even_deny_root</b> option. Allow access after  <i>n</i> seconds to root account after failed attempt. If this option is used the root user will be locked out for the specified amount of time after he exceeded his maximum allowed attempts.</div>
<div class="spacer">
</div>
<b>serialize</b><div style="margin-left: 4.00ex;">
Serialize access to the tally file using locks. This option might be used only for non-multithreaded services because it depends on the fcntl locking of the tally file. Also it is a good idea to use this option only in such configurations where the time between auth phase and account or setcred phase is not dependent on the authenticating client. Otherwise the authenticating client will be able to prevent simultaneous authentications by the same user by simply artificially prolonging the time the file record lock is held.</div>
</div>
<div class="spacer">
</div>
ACCOUNT OPTIONS<div style="margin-left: 4.00ex;">
Account phase resets attempts counter if the user is  <b>not</b> magic root. This phase can be used optionally for services which don't call  <b>pam_setcred</b>(3) correctly or if the reset should be done regardless of the failure of the account phase of other modules.<div class="spacer">
</div>
<b>magic_root</b><div style="margin-left: 4.00ex;">
If the module is invoked by a user with uid=0 the counter is not changed. The sysadmin should use this for user launched services, like  <b>su</b>, otherwise this argument should be omitted.</div>
</div>
</div>
<div class="section">
<h1>MODULE TYPES PROVIDED</h1> The  <b>auth</b> and  <b>account</b> module types are provided.</div>
<div class="section">
<h1>RETURN VALUES</h1> PAM_AUTH_ERR<div style="margin-left: 4.00ex;">
A invalid option was given, the module was not able to retrieve the user name, no valid counter file was found, or too many failed logins.</div>
<div class="spacer">
</div>
PAM_SUCCESS<div style="margin-left: 4.00ex;">
Everything was successful.</div>
<div class="spacer">
</div>
PAM_USER_UNKNOWN<div style="margin-left: 4.00ex;">
User not known.</div>
</div>
<div class="section">
<h1>NOTES</h1> pam_tally2 is not compatible with the old pam_tally faillog file format. This is caused by requirement of compatibility of the tallylog file format between 32bit and 64bit architectures on multiarch systems.<div class="spacer">
</div>
There is no setuid wrapper for access to the data file such as when the  <b>pam_tally2.so</b> module is called from xscreensaver. As this would make it impossible to share PAM configuration with such services the following workaround is used: If the data file cannot be opened because of insufficient permissions ( <b>EACCES</b>) the module returns  <b>PAM_IGNORE</b>.</div>
<div class="section">
<h1>EXAMPLES</h1> Add the following line to /etc/pam.d/login to lock the account after 4 failed logins. Root account will be locked as well. The accounts will be automatically unlocked after 20 minutes. The module does not have to be called in the account phase because the  <b>login</b> calls  <b>pam_setcred</b>(3) correctly.<div style="height: 1.00em;">
&#160;</div>
<div style="margin-left: 4.00ex;">
<br/>
auth     required       pam_securetty.so<br/>
auth     required       pam_tally2.so deny=4 even_deny_root unlock_time=1200<br/>
auth     required       pam_env.so<br/>
auth     required       pam_unix.so<br/>
auth     required       pam_nologin.so<br/>
account  required       pam_unix.so<br/>
password required       pam_unix.so<br/>
session  required       pam_limits.so<br/>
session  required       pam_unix.so<br/>
session  required       pam_lastlog.so nowtmp<br/>
session  optional       pam_mail.so standard<br/>
    <br/>
</div>
</div>
<div class="section">
<h1>FILES</h1> /var/log/tallylog<div style="margin-left: 4.00ex;">
failure count logging file</div>
</div>
<div class="section">
<h1>SEE ALSO</h1><div style="height: 1.00em;">
&#160;</div>
<b>pam.conf</b>(5),  <b>pam.d</b>(5),  <b>pam</b>(8)</div>
<div class="section">
<h1>AUTHOR</h1> pam_tally2 was written by Tim Baverstock and Tomas Mraz.</div>
<table class="foot">
<tr>
<td class="foot-date">
06/04/2011</td>
<td class="foot-os">
Linux-PAM Manual</td>
</tr>
</table>
</div>
</body>
</html>

