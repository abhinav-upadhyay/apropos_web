<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<link rel="stylesheet" href="/static/man_pages/linux/style.css" type="text/css" media="all"/>
<title>
PKLOCALAUTHORITY(8)</title>
</head>
<body>
<div class="mandoc">
<table class="head">
<tbody>
<tr>
<td class="head-ltitle">
PKLOCALAUTHORITY(8)</td>
<td class="head-vol">
pklocalauthority</td>
<td class="head-rtitle">
PKLOCALAUTHORITY(8)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1>NAME</h1> pklocalauthority - PolicyKit Local Authority</div>
<div class="section">
<h1>DESCRIPTION</h1> The Local Authority is the default PolicyKit authority implementation. Configuration for the Local Authority and information pertaining to authorization decisions are read from local files on the disk. One design goal of the Local Authority is to split configuration items into separate files such that 3rd party packages and users won't conflict trying to edit the same files. This policy also ensures smooth upgrades when distributing PolicyKit using a package management system.<div class="spacer">
</div>
Files shipped with PolicyKit and 3rd party packages (e.g. under package manager control) typically have comments (such as &#8220;DO NOT EDIT THIS FILE, it will be overwritten on update&#8221;) telling the system administrator that changes will be overwritten on update.</div>
<div class="section">
<h1>ADMINISTRATOR AUTHENTICATION</h1> PolicyKit makes a distinction between  <i>user authentication</i> (to make the user in front of the system prove he really is the user) and  <i>administrator authentication</i> (to make the user in front of the system prove he really is an administrator). Since various operating systems (or even flavors of the same operating system) has different ways of defining &quot;administrator&quot;, the Local Authority provides a way to specify what &quot;administrator authentication&quot; means.<div class="spacer">
</div>
By default, &quot;administrator authentication&quot; is defined as asking for the root password. Since some systems, for usability reasons, don't have a root password and instead rely on a group of users being member of an administrative group that gives them super-user privileges, the Local Authority can be configured to support this use-case as well.<div class="spacer">
</div>
Configuration for the Local Authority is read from files in the /etc/polkit-1/localauthority.conf.d directory. All files are read in lexigraphical order (using the C locale) meaning that later files can override earlier ones. The file 50-localauthority.conf contains the settings provided by the OS vendor. Users and 3rd party packages can drop configuration files with a priority higher than 60 to change the defaults. The configuration file format is simple. Each configuration file is a  <i>key file</i> (also commonly known as a  <i>ini file</i>) with a single group called [Configuration]. Only a single key, AdminIdentities is read. The value of this key is a semi-colon separated list of identities that can be used when administrator authentication is required. Users are specified by prefixing the user name with unix-user:, groups of users are specified by prefixing with unix-group:, and netgroups of users are specified with unix-netgroup:. See the section called &#8220;EXAMPLES&#8221; for an example of a configuration file.</div>
<div class="section">
<h1>DIRECTORY STRUCTURE</h1> The Local Authority reads files with .pkla extension from all directories located inside the /etc/polkit-1/localauthority and /var/lib/polkit-1/localauthority directories. By default, the following sub-directories are installed.<div style="height: 1.00em;">
&#160;</div>
<div style="margin-left: 4.00ex;">
<br/>
/etc/polkit-1/<br/>
`-- localauthority<br/>
    |-- 10-vendor.d<br/>
    |-- 20-org.d<br/>
    |-- 30-site.d<br/>
    |-- 50-local.d<br/>
    `-- 90-mandatory.d<br/>
    <br/>
</div>
<div class="spacer">
</div>
and<div style="height: 1.00em;">
&#160;</div>
<div style="margin-left: 4.00ex;">
<br/>
/var/lib/polkit-1/<br/>
`-- localauthority<br/>
    |-- 10-vendor.d<br/>
    |-- 20-org.d<br/>
    |-- 30-site.d<br/>
    |-- 50-local.d<br/>
    `-- 90-mandatory.d<br/>
    <br/>
</div>
<div class="spacer">
</div>
The /etc/polkit-1/localauthority hierarchy is inteded for local configuration and the /var/lib/polkit-1/localauthority is intended for 3rd party packages.<div class="spacer">
</div>
Each .pkla file contains one or more authorization entries. If the underlying filesystem supports file monitoring, the Local Authority will reload information whenever .pkla files are added, removed or changed.<div class="spacer">
</div>
Each directory is intended for a specific audience<div class="spacer">
</div>
<i>10-vendor.d</i><div style="margin-left: 4.00ex;">
Intended for use by the OS vendor.</div>
<div class="spacer">
</div>
<i>20-org.d</i><div style="margin-left: 4.00ex;">
Intended for the organization deploying the OS.</div>
<div class="spacer">
</div>
<i>30-site.d</i><div style="margin-left: 4.00ex;">
Intended for the site deploying the system.</div>
<div class="spacer">
</div>
<i>50-local.d</i><div style="margin-left: 4.00ex;">
Intended for local usage.</div>
<div class="spacer">
</div>
<i>90-mandatory.d</i><div style="margin-left: 4.00ex;">
Intended for the organization deploying the OS.</div>
<div class="spacer">
</div>
and new directories can be added/removed as needed.<div class="spacer">
</div>
As to regards to the content, each .pkla file is a standard  <i>key file</i> and contains key/value pairs in one or more groups with each group representing an authorization entry. A .pkla file MUST be named by using a scheme to ensure that the name is unique, e.g. reverse DNS notation or similar. For example, if the organization is &#8220;Acme Corp&#8221; needs to modify policy for the product &#8220;Frobnicator&#8221;, a name like com.acme.frobnicator.pkla would be suitable.</div>
<div class="section">
<h1>AUTHORIZATION ENTRY</h1> Each group in a .pkla file must have a name that is unique within the file it belongs to. The following keys are are recognized:<div class="spacer">
</div>
<i>Identity</i><div style="margin-left: 4.00ex;">
A semi-colon separated list of globs to match identities. Each glob should start with unix-user: or unix-group: to specify whether to match on a UNIX user name or a UNIX group name. Netgroups are supported with the unix-netgroup: prefix, but cannot support glob syntax.</div>
<div class="spacer">
</div>
<i>Action</i><div style="margin-left: 4.00ex;">
A semi-colon separated list of globs to match action identifiers.</div>
<div class="spacer">
</div>
<i>ResultActive</i><div style="margin-left: 4.00ex;">
The result to return for subjects in an active local session that matches one or more of the given identities. Allowed values are similar to what can be used in the  <i>defaults</i> section of .policy files used to define actions, e.g. yes, no, auth_self, auth_self_keep, auth_admin and auth_admin_keep.</div>
<div class="spacer">
</div>
<i>ResultInactive</i><div style="margin-left: 4.00ex;">
Like  <i>ResultActive</i> but instead applies to subjects in inactive local sessions.</div>
<div class="spacer">
</div>
<i>ResultAny</i><div style="margin-left: 4.00ex;">
Like  <i>ResultActive</i> but instead applies to any subject.</div>
<div class="spacer">
</div>
<i>ReturnValue</i><div style="margin-left: 4.00ex;">
A semi-colon separated list of key/value pairs (of the form key=value) that are added to the details of authorization result on positive matches.</div>
<div class="spacer">
</div>
All keys specified above are required except that only at least one of  <i>ResultAny</i>,  <i>ResultInactive</i> and  <i>ResultActive</i> must be present. The  <i>ReturnValue</i> key is optional.</div>
<div class="section">
<h1>EVALUATION ORDER</h1> When a Mechanism requests services from the Authority to check if a given Subject is authorized for a given Action, the authorization entries discussed above are consulted using the following algorithm.<div class="spacer">
</div>
The authorization entries from all .pkla files are ordered using the following rules. First all the basename of all sub-directories (e.g.  <i>30-site.d</i>) from both the /etc/polkit-1/localauthority and /var/lib/polkit-1/localauthority directories are enumerated and sorted (using the C locale). If a name exists in both /etc and /var, the one in /etc takes precedence. Then all .pkla files are read in order from this list of sub-directories. For each .pkla file, authorizations from each file are appended in order resulting in an ordered list of authorization entries.<div class="spacer">
</div>
For example, given the following files<div style="height: 1.00em;">
&#160;</div>
<div style="margin-left: 4.00ex;">
<br/>
/var/lib/polkit-1<br/>
&#9492;&#9472;&#9472; localauthority<br/>
    &#9500;&#9472;&#9472; 10-vendor.d<br/>
    &#9474;   &#9492;&#9472;&#9472; 10-desktop-policy.pkla<br/>
    &#9500;&#9472;&#9472; 20-org.d<br/>
    &#9500;&#9472;&#9472; 30-site.d<br/>
    &#9500;&#9472;&#9472; 50-local.d<br/>
    &#9500;&#9472;&#9472; 55-org.my.company.d<br/>
    &#9474;   &#9492;&#9472;&#9472; 10-org.my.company.product.pkla<br/>
    &#9492;&#9472;&#9472; 90-mandatory.d<div class="spacer">
</div>
<br/>
/etc/polkit-1<br/>
&#9492;&#9472;&#9472; localauthority<br/>
    &#9500;&#9472;&#9472; 10-vendor.d<br/>
    &#9474;   &#9492;&#9472;&#9472; 01-some-changes-from-a-subvendor.pkla<br/>
    &#9500;&#9472;&#9472; 20-org.d<br/>
    &#9500;&#9472;&#9472; 30-site.d<br/>
    &#9500;&#9472;&#9472; 50-local.d<br/>
    &#9500;&#9472;&#9472; 55-org.my.company.d<br/>
    &#9474;   &#9492;&#9472;&#9472; 10-org.my.company.product.pkla<br/>
    &#9492;&#9472;&#9472; 90-mandatory.d<br/>
    <br/>
</div>
<div class="spacer">
</div>
the evaluation order of the .pkla files is:<div style="height: 1.00em;">
&#160;</div>
<div style="margin-left: 4.00ex;">
 1.<div style="height: 1.00em;">
&#160;</div>
10-desktop-policy.pkla</div>
<div style="height: 1.00em;">
&#160;</div>
<div style="margin-left: 4.00ex;">
 2.<div style="height: 1.00em;">
&#160;</div>
01-some-changes-from-a-subvendor.pkla</div>
<div style="height: 1.00em;">
&#160;</div>
<div style="margin-left: 4.00ex;">
 3.<div style="height: 1.00em;">
&#160;</div>
10-org.my.company.product.pkla (the /var one)</div>
<div style="height: 1.00em;">
&#160;</div>
<div style="margin-left: 4.00ex;">
 4.<div style="height: 1.00em;">
&#160;</div>
10-org.my.company.product.pkla (the /etc one)</div>
<div class="spacer">
</div>
When the list of authorization entries has been calculated, the authorization check can be made. First, the user of the Subject is determined and the groups that the user belongs are looked up. For each group identity, the authorization entries are consulted in order. If the authorization check matches the data from the authorization check, then the authorization result from  <i>RequireAny</i>,  <i>RequireInactive</i> or  <i>RequireActive</i> is used and  <i>ReturnValue</i> is added to the authorization result.<div class="spacer">
</div>
Finally, the authorization entries are consulted using the user identity in the same manner.<div class="spacer">
</div>
Note that processing continues even after a match. This allows for socalled &#8220;negative authorizations&#8221;, see the section called &#8220;EXAMPLES&#8221; for further discussion.</div>
<div class="section">
<h1>EXAMPLES</h1> The following .conf file<div style="height: 1.00em;">
&#160;</div>
<div style="margin-left: 4.00ex;">
<br/>
[Configuration]<br/>
AdminIdentities=unix-group:desktop_admin_r<br/>
    <br/>
</div>
<div class="spacer">
</div>
that any user in the desktop_admin_r UNIX group can be used for authentication when administrator authentication is needed. This file would typically be installed in the /etc/polkit-1/localauthority.conf.d directory and given the name 60-desktop-policy.conf to ensure that it is evaluted after the 50-localauthority.conf file shipped with PolicyKit. If the local administrator wants to override this (suppose 60-desktop-policy.conf was shipped as part of the OS) he can simply create a file 99-my-admin-configuration.conf with the following content<div style="height: 1.00em;">
&#160;</div>
<div style="margin-left: 4.00ex;">
<br/>
[Configuration]<br/>
AdminIdentities=unix-user:lisa;unix-user:marge<br/>
    <br/>
</div>
<div class="spacer">
</div>
to specify that only the users lisa and marge can authenticate when administrator authentication is needed.<div class="spacer">
</div>
The following .pkla file grants authorization to all users in the staff group for actions matching the glob com.example.awesomeproduct.* provided they are in an active session on the local console:<div style="height: 1.00em;">
&#160;</div>
<div style="margin-left: 4.00ex;">
<br/>
[Normal Staff Permissions]<br/>
Identity=unix-group:staff<br/>
Action=com.example.awesomeproduct.*<br/>
ResultAny=no<br/>
ResultInactive=no<br/>
ResultActive=yes<br/>
    <br/>
</div>
<div class="spacer">
</div>
If the users homer and grimes are member of the staff group but policy requires that an administrator needs to authenticate every time authorization for any action matching com.example.awesomeproduct.* is required, one would add<div style="height: 1.00em;">
&#160;</div>
<div style="margin-left: 4.00ex;">
<br/>
[Exclude Some Problematic Users]<br/>
Identity=unix-user:homer;unix-user:grimes<br/>
Action=com.example.awesomeproduct.*<br/>
ResultAny=no<br/>
ResultInactive=no<br/>
ResultActive=auth_admin<br/>
    <br/>
</div>
<div class="spacer">
</div>
and make sure this authorization entry is after the first one.</div>
<div class="section">
<h1>AUTHOR</h1> Written by David Zeuthen davidz@redhat.com with a lot of help from many others.</div>
<div class="section">
<h1>BUGS</h1> Please send bug reports to either the distribution or the polkit-devel mailing list, see the link  <b>http://lists.freedesktop.org/mailman/listinfo/polkit-devel</b> on how to subscribe.</div>
<div class="section">
<h1>SEE ALSO</h1><div style="height: 1.00em;">
&#160;</div>
<b>polkit</b>(8)</div>
<table class="foot">
<tr>
<td class="foot-date">
May 2009</td>
<td class="foot-os">
polkit</td>
</tr>
</table>
</div>
</body>
</html>

