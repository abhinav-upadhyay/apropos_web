<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/../4/strict.dtd">
>
<head>
<meta http-equiv="Content-Type" content="te../; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
CONFIG.SAMPLES(5)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
CONFIG.SAMPLES(5)</td>
<td class="head-vol" align="center">
File Formats Manual</td>
<td class="head-rtitle" align="right">
CONFIG.SAMPLES(5)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">config.samples</b> &#8212; <span class="desc">kernel configuration file syntax examples</span></div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1><div class="subsection">
<h2 id="x446576696365732c206472697665727320616e6420696e7374616e636573">Devices, drivers and instances</h2> For a given device, at most one driver will attach. In order for a driver to attach, the kernel configuration file must include a compatible instance of the driver for the location of the device. The following lines from the <i class="file">GENERIC</i> kernel configuration file of <span class="unix">NetBSD</span>/i386 are examples of instances of drivers:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
pchb*	at pci? dev ? function ?	# PCI-Host bridges 
pcib*	at pci? dev ? function ?	# PCI-ISA bridges 
ppb*	at pci? dev ? function ?	# PCI-PCI bridges 
 
siop*	at pci? dev ? function ?	# Symbios 53c8xx SCSI 
esiop*	at pci? dev ? function ?	# Symbios 53c875 SCSI and newer 
 
ix0	at isa? port 0x300 irq 10	# EtherExpress/16</pre>
<p>
The first three instances allow three different drivers to attach to all the matching devices found on any PCI bus. This is the most generic case.<p>
The next two lines allow two distinct drivers to attach to any matching device found on any PCI bus, but those two drivers are special because they both support some of the same devices. Each of the driver has a matching function that returns their score for the device that is being considered. <a class="link-man" href="../9/autoconf">autoconf(9)</a> decides at run-time which driver will attach. Of course, it is deterministic so if the user wants to change the driver that attaches to the device, the instance of the other driver will have to be removed, e.g. by commenting it out.<p>
The last line configures an instance of an ISA device. Unlike the PCI bus, the ISA bus cannot discover the devices that are present on the bus. The driver has to try accessing the device in order to discover it. That implies locators must be specified to some extent: a driver would usually need the base address of the device, some need the IRQ line that the device is configured to use, though some others would just try a set of known values, at the risk of badly interacting with other devices on the bus.</div>
<div class="subsection">
<h2 id="x486172641e776972696e67206b65726e656c20636f6e66696775726174696f6e">Hard-wiring kernel configuration</h2> This technique consists in specifying exactly the location of the devices on a given system. In the general case it has very little use, because it does not change the size of the kernel, and it will prevent it from finding devices in case the hardware changes, even slightly.<p>
Let's consider the following excerpt of <a class="link-man" href="../8/dmesg">dmesg(8)</a> output:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
auich0 at pci0 dev 31 function 5: i82801DB/DBM (ICH4/ICH4M) AC-97 Audio</pre>
<p>
The <a class="link-man" href="../4/auich">auich(4)</a> driver (which controls Intel's AC-97 audio chips) attached there because of the following instance of <i class="file">GENERIC</i>:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
auich* at pci? dev ? function ?</pre>
<p>
Hard-wiring that instance means re-writing it to the following:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
auich0 at pci0 dev 31 function 5</pre>
<p>
and that way, <i class="arg">auich0</i> will attach to that specific location, or will not attach.</div>
<div class="subsection">
<h2 id="x52656d6f76696e67206f7074696f6e7320616e642064726976657273">Removing options and drivers</h2> When two kernel configurations differ by a very small number of changes, it is easier to manage them by having one include the other, and add or remove the differences. Removing options and drivers is also useful in the situation of a user who wants to follow the development of <span class="unix">NetBSD</span>: drivers and options get added to the configuration files found in the source tree, such as <i class="file">GENERIC</i>, so one can include it and remove all options and drivers that are not relevant to the considered system. Additions to <i class="file">GENERIC</i> will then automatically be followed and used in case they are relevant.<p>
While negating an options (with <b class="cmd">no options</b>) is unambiguous, it is not as clear for devices instances.<p>
The <b class="cmd">no</b> <i class="arg">instance definition</i> statements of <a class="link-man" href="../1/config">config(1)</a> syntax only apply on the current state of the configuration file, not on the resulting kernel binary. <a class="link-man" href="../9/autoconf">autoconf(9)</a> has no knowledge of instance negation, thus it is currently impossible to express the following in a kernel configuration file:<p>
<div style="margin-left: 5.00ex;" class="display">
&#8220;I want support for <a class="link-man" href="../4/ath">ath(4)</a> attaching at <a class="link-man" href="../4/pci">pci(4)</a>, but I do not want any instance of <a class="link-man" href="../4/ath">ath(4)</a> attaching at <i class="arg">pci3</i>.&#8221;</div>
<p>
For a real-world use of <b class="cmd">no device at</b> <i class="arg">instance</i> consider the following, taken from <span class="unix">NetBSD</span>/i386:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
include "arch/i386/conf/GENERIC" 
 
acpi0 at mainbus? 
 
com* at acpi? 
[... more instances of legacy devices attaching at acpi? ...] 
 
no device at isa0</pre>
<p>
One could actually live without the <i class="arg">isa0</i> instance, as all the legacy devices are attached at <i class="arg">acpi0</i>. But unfortunately, dependencies on the <i class="arg">isa</i> attribute are not well registered all through the source tree, so an instance of the <a class="link-man" href="../4/isa">isa(4)</a> driver is required to compile a kernel. So while:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
no isa*</pre>
<p>
is what is intended, the <a class="link-man" href="../4/isa">isa(4)</a> instance itself must be kept, and that is precisely the difference made by:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
no device at isa0</pre>
</div>
<div class="subsection">
<h2 id="x496e746572666163652061747472696275746573">Interface attributes</h2> <span class="emph">Interface attributes</span> are a subtlety of <a class="link-man" href="../1/config">config(1)</a> and <a class="link-man" href="../9/autoconf">autoconf(9)</a>, which often confuses users and utilities that parse <a class="link-man" href="../8/dmesg">dmesg(8)</a> output to manipulate kernel configuration files. What they are is best shown by the following example.<p>
The <a class="link-man" href="../8/dmesg">dmesg(8)</a> output look like this:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
auvia0 at pci0 dev 17 function 5: VIA Technologies VT8235 AC'97 Audio (rev 0x50) 
audio0 at auvia0: full duplex, mmap, independent</pre>
<p>
while the kernel configuration look like this:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
auvia* at pci? dev ? function ? 
audio* at audiobus?</pre>
<p>
It is not obvious from the kernel configuration file that an <a class="link-man" href="../4/audio">audio(4)</a> device can attach at an <a class="link-man" href="../4/auvia">auvia(4)</a> device. <i class="arg">audiobus</i> is an <span class="emph">interface attribute</span>, exposed by <i class="arg">auvia</i>.<p>
Of course, it is possible to specify<p>
<pre style="margin-left: 5.00ex;" class="lit display">
audio* at auvia?</pre>
in the kernel configuration file, but then one instance per audio controller would be needed. <span class="emph">Interface attributes</span> reflect the fact there is a standard way to attach a device to its parent, no matter what the latter is precisely. It also means lower maintainance of the kernel configuration files because drivers for audio controllers are added more easily.<p>
Most attachments are done through <span class="emph">interface attributes</span>, although only a few of them are specified that way in the configuration files found in the tree. Another example of such an attribute is <i class="arg">ata</i>:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
viaide0 at pci0 dev 17 function 1 
atabus0 at viaide0 channel 0 
 
viaide* at pci? dev ? function ? 
atabus* at ata?</pre>
</div>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../1/config">config(1)</a>, <a class="link-man" href="../4/options">options(4)</a>, <a class="link-man" href="../5/config">config(5)</a>, <a class="link-man" href="../8/dmesg">dmesg(8)</a></div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
June 4, 2006</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
<>

