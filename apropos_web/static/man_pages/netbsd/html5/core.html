<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="/static/man_pages/netbsd/style.css" type="text/css" media="all">
<title>
CORE(5)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
CORE(5)</td>
<td class="head-vol" align="center">
File Formats Manual</td>
<td class="head-rtitle" align="right">
CORE(5)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">core</b> &#8212; <span class="desc">memory image file format</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">sys/param.h</a>&gt;</b><p>
For a.out-format core files:<p>
<br>
<b class="includes">#include &lt;<a class="link-includes">sys/core.h</a>&gt;</b><p>
For ELF-format core files:<p>
<br>
<b class="includes">#include &lt;<a class="link-includes">sys/exec.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">sys/exec_elf.h</a>&gt;</b></div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> A small number of signals which cause abnormal termination of a process also cause a record of the process's in-core state to be written to disk for later examination by one of the available debuggers (see <a class="link-man" href="../7/signal">signal(7)</a>).<p>
This memory image is written to a file named from a per-process template; provided the terminated process had write permission, and provided the abnormality did not cause a system crash. (In this event, the decision to save the core file is arbitrary, see <a class="link-man" href="../8/savecore">savecore(8)</a>.) The file is named from a per-process template, mapped to the sysctl variable <span class="emph">proc.&lt;pid&gt;.corename</span> (where &lt;pid&gt; has to be replaced by the pid in decimal format of the process). This template is either an absolute or relative path name, in which format characters can be used, preceded by the percent character (&#8220;%&#8221;). The following characters are recognized as format and substituted:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="symb">n</span></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
The process's name</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="symb">p</span></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
The PID of the process (in decimal)</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="symb">t</span></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
The process's creation date (a la <a class="link-man" href="../3/time">time(3)</a>, in decimal)</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="symb">u</span></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
The login name, as returned by <a class="link-man" href="../2/getlogin">getlogin(2)</a></dd>
</dl>
<p>
By default, the per-process template string points to the default core name template, which is mapped to the sysctl variable <span class="emph">kern.defcorename</span>. Changing this value on a live system will change the core name template for all processes which didn't have a per-process template set. The default value of the default core name template is <b class="name">%n.core</b> and can be changed at compile-time with the kernel configuration option <b class="config">options DEFCORENAME</b> (see <a class="link-man" href="../4/options">options(4)</a>)<p>
The per-process template string is inherited on process creation, but is reset to point to the default core name template on execution of a set-id binary.<p>
The maximum size of a core file is limited by <a class="link-man" href="../2/setrlimit">setrlimit(2)</a>. Files which would be larger than the limit are not created.<div class="subsection">
<h2 id="x454c4620434f524520464f524d4154">ELF CORE FORMAT</h2> ELF-format core files are described by a standard ELF exec header and a series of ELF program headers. Each program header describes a range of the virtual address space of the process.<p>
In addition, <span class="unix">NetBSD</span> ELF core files include an ELF note section which provides additional information about the process. The first note in the note section has a note name of &#8220;NetBSD-CORE&#8221; and a note type of ELF_NOTE_NETBSD_CORE_PROCINFO (1), and contains the following structure:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
struct netbsd_elfcore_procinfo { 
   /* Version 1 fields start here. */ 
    uint32_t cpi_version;      /* netbsd_elfcore_procinfo version */ 
    uint32_t cpi_cpisize;      /* sizeof(netbsd_elfcore_procinfo) */ 
    uint32_t cpi_signo;        /* killing signal */ 
    uint32_t cpi_sigcode;      /* signal code */ 
    uint32_t cpi_sigpend[4];   /* pending signals */ 
    uint32_t cpi_sigmask[4];   /* blocked signals */ 
    uint32_t cpi_sigignore[4]; /* blocked signals */ 
    uint32_t cpi_sigcatch[4];  /* blocked signals */ 
    int32_t  cpi_pid;          /* process ID */ 
    int32_t  cpi_ppid;         /* parent process ID */ 
    int32_t  cpi_pgrp;         /* process group ID */ 
    int32_t  cpi_sid;          /* session ID */ 
    uint32_t cpi_ruid;         /* real user ID */ 
    uint32_t cpi_euid;         /* effective user ID */ 
    uint32_t cpi_svuid;        /* saved user ID */ 
    uint32_t cpi_rgid;         /* real group ID */ 
    uint32_t cpi_egid;         /* effective group ID */ 
    uint32_t cpi_svgid;        /* saved group ID */ 
    uint32_t cpi_nlwps;        /* number of LWPs */ 
    int8_t   cpi_name[32];     /* copy of p-&gt;p_comm */ 
    /* Add version 2 fields below here. */ 
};</pre>
<p>
The fields of <i class="farg">struct netbsd_elfcore_procinfo</i> are as follows:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
cpi_version</dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
The version of this structure. The current version is defined by the <span class="define">NETBSD_ELFCORE_PROCINFO_VERSION</span> constant.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
cpi_cpisize</dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
The size of this structure.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
cpi_signo</dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
Signal that caused the process to dump core.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
cpi_sigcode</dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
Signal-specific code, if any, corresponding to <b class="var">cpi_signo</b>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
cpi_sigpend</dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
A mask of signals pending delivery to the process. This may be examined by copying it to a <i class="farg">sigset_t</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
cpi_sigmask</dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
The set of signals currently blocked by the process. This may be examined by copying it to a <i class="farg">sigset_t</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
cpi_sigignore</dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
The set of signals currently being ignored by the process. This may be examined by copying it to a <i class="farg">sigset_t</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
cpi_sigcatch</dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
The set of signals with registers signals handlers for the process. This may be examined by copying it to a <i class="farg">sigset_t</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
cpi_pid</dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
Process ID of the process.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
cpi_ppid</dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
Process ID of the parent process.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
cpi_pgrp</dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
Process group ID of the process.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
cpi_sid</dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
Session ID of the process.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
cpi_ruid</dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
Real user ID of the process.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
cpi_euid</dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
Effective user ID of the process.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
cpi_svuid</dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
Saved user ID of the process.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
cpi_rgid</dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
Real group ID of the process.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
cpi_egid</dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
Effective group ID of the process.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
cpi_svgid</dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
Saved group ID of the process.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
cpi_nlwps</dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
Number of kernel-visible execution contexts (LWPs) of the process.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
cpi_name</dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
Process name, copied from the p_comm field of <i class="farg">struct proc</i>.</dd>
</dl>
<p>
The note section also contains additional notes for each kernel-visible execution context of the process (LWP). These notes have names of the form &#8220;NetBSD-CORE@nn&#8221; where &#8220;nn&#8221; is the LWP ID of the execution context, for example: &#8220;NetBSD-CORE@1&#8221;. These notes contain register and other per-execution context data in the same format as is used by the <a class="link-man" href="../2/ptrace">ptrace(2)</a> system call. The note types correspond to the <a class="link-man" href="../2/ptrace">ptrace(2)</a> request numbers that return the same data. For example, a note with a note type of PT_GETREGS would contain a <i class="farg">struct reg</i> with the register contents of the execution context. For a complete list of available <a class="link-man" href="../2/ptrace">ptrace(2)</a> request types for a given architecture, refer to that architecture's &#60;<i class="file">machine/ptrace.h</i>&#62; header file.</div>
<div class="subsection">
<h2 id="x412e4f555420434f524520464f524d4154">A.OUT CORE FORMAT</h2> The core file consists of a core header followed by a number of segments. Each segment is preceded by a core segment header. Both the core header and core segment header are defined in <b class="includes">&lt;<a class="link-includes">sys/core.h</a>&gt;</b>.<p>
The core header, <i class="farg">struct core</i>, specifies the lengths of the core header itself and each of the following core segment headers to allow for any machine dependent alignment requirements.<p>
<pre style="margin-left: 0.00ex;" class="lit display">
struct core { 
    uint32_t c_midmag;         /* magic, id, flags */ 
    uint16_t c_hdrsize;        /* Size of this header (machdep algn) */ 
    uint16_t c_seghdrsize;     /* Size of a segment header */ 
    uint32_t c_nseg;           /* # of core segments */ 
    char      c_name[MAXCOMLEN+1];	/* Copy of p-&gt;p_comm */ 
    uint32_t c_signo;          /* Killing signal */ 
    u_long    c_ucode;          /* Signal code */ 
    u_long    c_cpusize;        /* Size of machine dependent segment */ 
    u_long    c_tsize;          /* Size of traditional text segment */ 
    u_long    c_dsize;          /* Size of traditional data segment */ 
    u_long    c_ssize;          /* Size of traditional stack segment */ 
};</pre>
<p>
The fields of <i class="farg">struct core</i> are as follows:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
c_midmag</dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
Core file machine ID, magic value, and flags. These values may be extracted with the <b class="fname">CORE_GETMID</b>(), <b class="fname">CORE_GETMAGIC</b>(), and <b class="fname">CORE_GETFLAG</b>() macros. The machine ID values are listed in <b class="includes">&lt;<a class="link-includes">sys/exec_aout.h</a>&gt;</b>. For a valid core file, the magic value in the header must be <span class="define">COREMAGIC</span>. No flags are defined for the core header.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
c_hdrsize</dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
Size of this data structure.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
c_seghdrsize</dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
Size of a segment header.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
c_nseg</dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
Number of segments that follow this header.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
c_name</dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
Process name, copied from the p_comm field of <i class="farg">struct proc</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
c_signo</dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
Signal that caused the process to dump core.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
c_ucode</dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
Code associated with the signal.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
c_cpusize</dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
Size of the segment containing CPU-specific information. This segment will have the <span class="define">CORE_CPU</span> flag set.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
c_tsize</dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
Size of the segment containing the program text.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
c_dsize</dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
Size of the segment containing the program's traditional data area.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
c_ssize</dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
Size of the segment containing the program's traditional stack area. This segment will have the <span class="define">CORE_STACK</span> flag set.</dd>
</dl>
The header is followed by <i class="farg">c_nseg</i> segments, each of which is preceded with a segment header, <i class="farg">struct coreseg</i>:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
struct coreseg { 
   uint32_t c_midmag;  /* magic, id, flags */ 
   u_long    c_addr;    /* Virtual address of segment */ 
   u_long    c_size;    /* Size of this segment */ 
};</pre>
<p>
The fields of <i class="farg">struct coreseg</i> are as follows:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
c_midmag</dt>
<dd class="list-tag" style="margin-left: 11.00ex;">
Core segment magic value and flags. These values may be extracted with the <b class="fname">CORE_GETMAGIC</b>() and <b class="fname">CORE_GETFLAG</b>() macros. The magic value in the segment header must be <span class="define">CORESEGMAGIC</span>. Exactly one of the flags <span class="define">CORE_CPU</span>, <span class="define">CORE_DATA</span>, or <span class="define">CORE_STACK</span> will be set to indicate the segment type.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
c_addr</dt>
<dd class="list-tag" style="margin-left: 11.00ex;">
Virtual address of the segment in the program image. Meaningless if the segment type is <span class="define">CORE_CPU</span>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
c_size</dt>
<dd class="list-tag" style="margin-left: 11.00ex;">
Size of the segment, not including this header.</dd>
</dl>
</div>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../1/gdb">gdb(1)</a>, <a class="link-man" href="../2/setrlimit">setrlimit(2)</a>, <a class="link-man" href="../3/sysctl">sysctl(3)</a>, <a class="link-man" href="../5/a.out">a.out(5)</a>, <a class="link-man" href="../5/elf">elf(5)</a>, <a class="link-man" href="../7/signal">signal(7)</a>, <a class="link-man" href="../8/sysctl">sysctl(8)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> A <b class="name">core</b> file format appeared in Version&#160;6 AT&amp;T UNIX. The <span class="unix">NetBSD</span> a.out core file format was introduced in <span class="unix">NetBSD&#160;1.0</span>. The <span class="unix">NetBSD</span> ELF core file format was introduced in <span class="unix">NetBSD&#160;1.6</span>.<p>
In releases previous to <span class="unix">NetBSD&#160;1.6</span>, ELF program images produced a.out-format core files.</div>
<div class="section">
<h1 id="x42554753">BUGS</h1> There is no standard location or name for the CPU-dependent data structure stored in the <span class="define">CORE_CPU</span> segment.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
July 8, 2002</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

