<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="/static/man_pages/netbsd/style.css" type="text/css" media="all">
<title>
UTMP(5)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
UTMP(5)</td>
<td class="head-vol" align="center">
File Formats Manual</td>
<td class="head-rtitle" align="right">
UTMP(5)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">utmp</b>, <b class="name">wtmp</b>, <b class="name">lastlog</b> &#8212; <span class="desc">login records</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">utmp.h</a>&gt;</b></div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The file <b class="includes">&lt;<a class="link-includes">utmp.h</a>&gt;</b> declares the structures used to record information about current users in the file <b class="name">utmp</b>, logins and logouts in the file <b class="name">wtmp</b>, and last logins in the file <b class="name">lastlog</b>. The time stamps of date changes, shutdowns and reboots are also logged in the <b class="name">wtmp</b> file.<p>
The <b class="name">wtmp</b> file can grow rapidly on busy systems, and is normally rotated with <a class="link-man" href="../8/newsyslog">newsyslog(8)</a>.<p>
These files must be created manually; if they do not exist, they are not created automatically.<p>
<pre style="margin-left: 5.00ex;" class="lit display">
#define _PATH_UTMP      "/var/run/utmp" 
#define _PATH_WTMP      "/var/log/wtmp" 
#define _PATH_LASTLOG   "/var/log/lastlog" 
 
#define UT_NAMESIZE     8 
#define UT_LINESIZE     8 
#define UT_HOSTSIZE     16 
 
struct lastlog { 
        time_t  ll_time; 
        char    ll_line[UT_LINESIZE]; 
        char    ll_host[UT_HOSTSIZE]; 
}; 
 
struct utmp { 
        char    ut_line[UT_LINESIZE]; 
        char    ut_name[UT_NAMESIZE]; 
        char    ut_host[UT_HOSTSIZE]; 
        time_t	ut_time; 
};</pre>
<p>
Each time a user logs in, the <a class="link-man" href="../1/login">login(1)</a> program looks up the user's UID in the file <b class="name">lastlog</b>. If it is found, the timestamp of the last time the user logged in, the terminal line and the hostname are written to the standard output, providing the login is not set <span class="emph">quiet</span>; see <a class="link-man" href="../1/login">login(1)</a>. The <a class="link-man" href="../1/login">login(1)</a> program then records the new login time in the file <b class="name">lastlog</b>.<p>
After the new <i class="farg">lastlog</i> record is written, the file <b class="name">utmp</b> is opened and the <i class="farg">utmp</i> record for the user inserted. This record remains there until the user logs out at which time it is deleted (by clearing the user and host fields, and updating the timestamp field). The <b class="name">utmp</b> file is used by the programs <a class="link-man" href="../1/rwho">rwho(1)</a>, <a class="link-man" href="../1/users">users(1)</a>, <a class="link-man" href="../1/w">w(1)</a>, and <a class="link-man" href="../1/who">who(1)</a>.<p>
Next, the <a class="link-man" href="../1/login">login(1)</a> program opens the file <b class="name">wtmp</b>, and appends the user's <i class="farg">utmp</i> record. When the user logs out, a <i class="farg">utmp</i> record with the tty line, an updated time stamp, and cleared user and host fields is appended to the file by <a class="link-man" href="../8/init">init(8)</a>. The <b class="name">wtmp</b> file is used by the programs <a class="link-man" href="../1/last">last(1)</a> and <a class="link-man" href="../8/ac">ac(8)</a>.<p>
In the event of a date change, a shutdown or reboot, the following items are logged in the <b class="name">wtmp</b> file.<p>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<code class="lit">reboot</code></dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<code class="lit">shutdown</code></dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
A system reboot or shutdown has been initiated. The character &#8216;<code class="lit">~</code>&#8217; is placed in the field <i class="farg">ut_line</i>, and <code class="lit">reboot</code> or <code class="lit">shutdown</code> in the field <i class="farg">ut_name</i> (see <a class="link-man" href="../8/shutdown">shutdown(8)</a> and <a class="link-man" href="../8/reboot">reboot(8)</a>).<p>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<code class="lit">date</code></dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
The system time has been manually or automatically updated by <a class="link-man" href="../1/date">date(1)</a>. The command name <span class="emph">date</span> is recorded in the field <i class="farg">ut_name</i>. In the field <i class="farg">ut_line</i>, the character &#8216;<code class="lit">*(Ba</code>&#8217; indicates the time prior to the change, and the character &#8216;<code class="lit">{</code>&#8217; indicates the new time.</dd>
</dl>
</div>
<div class="section">
<h1 id="x46494c4553">FILES</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/var/run/utmp</i></dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
The <b class="name">utmp</b> file.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/var/log/wtmp</i></dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
The <b class="name">wtmp</b> file.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/var/log/lastlog</i></dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
The <b class="name">lastlog</b> file.</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../1/last">last(1)</a>, <a class="link-man" href="../1/login">login(1)</a>, <a class="link-man" href="../1/w">w(1)</a>, <a class="link-man" href="../1/who">who(1)</a>, <a class="link-man" href="../5/utmpx">utmpx(5)</a>, <a class="link-man" href="../8/ac">ac(8)</a>, <a class="link-man" href="../8/init">init(8)</a>, <a class="link-man" href="../8/lastlogin">lastlogin(8)</a>, <a class="link-man" href="../8/newsyslog">newsyslog(8)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> A <b class="name">utmp</b> and <b class="name">wtmp</b> file format appeared in Version&#160;6 AT&amp;T UNIX. The <b class="name">lastlog</b> file format appeared in <span class="unix">3.0BSD</span>.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
May 14, 2003</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

