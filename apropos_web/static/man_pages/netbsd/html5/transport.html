<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="/static/man_pages/netbsd/style.css" type="text/css" media="all">
<title>
TRANSPORT(5)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
TRANSPORT(5)</td>
<td class="head-vol" align="center">
File Formats Manual</td>
<td class="head-rtitle" align="right">
TRANSPORT(5)</td>
</tr>
</tbody>
</table>
<br>
<div class="section">
<h1>NAME</h1> transport &#45; Postfix transport table format</div>
<div class="section">
<h1>SYNOPSIS</h1><br>
<b>postmap /etc/postfix/transport</b><p>
<br>
<b>postmap -q "</b><i>string</i><b>" /etc/postfix/transport</b><p>
<br>
<b>postmap -q - /etc/postfix/transport &lt;</b><i>inputfile</i></div>
<div class="section">
<h1>DESCRIPTION</h1><br>
The optional <b>transport</b>(5) table specifies a mapping from email addresses to message delivery transports and next-hop destinations. Message delivery transports such as  <b>local</b> or <b>smtp</b> are defined in the  <b>master.cf</b> file, and next-hop destinations are typically hosts or domain names. The table is searched by the  <b>trivial-rewrite</b>(8) daemon.<div style="height: 1.00em;">
&#160;</div>
This mapping overrides the default <i>transport</i>:<i>nexthop</i> selection that is built into Postfix:<dl>
<dt>
<b>local_transport (default: local:$myhostname)</b></dt>
<dd>
This is the default for final delivery to domains listed with  <b>mydestination</b>, and for [<i>ipaddress</i>] destinations that match  <b>$inet_interfaces</b> or  <b>$proxy_interfaces</b>. The default <i>nexthop</i> destination is the MTA hostname.</dd>
</dl>
<dl>
<dt>
<b>virtual_transport (default: virtual:)</b></dt>
<dd>
This is the default for final delivery to domains listed with  <b>virtual_mailbox_domains</b>. The default <i>nexthop</i> destination is the recipient domain.</dd>
</dl>
<dl>
<dt>
<b>relay_transport (default: relay:)</b></dt>
<dd>
This is the default for remote delivery to domains listed with  <b>relay_domains</b>. In order of decreasing precedence, the  <i>nexthop</i> destination is taken from <b>relay_transport</b>,  <b>sender_dependent_relayhost_maps</b>, <b>relayhost</b>, or from the recipient domain.</dd>
</dl>
<dl>
<dt>
<b>default_transport (default: smtp:)</b></dt>
<dd>
This is the default for remote delivery to other destinations. In order of decreasing precedence, the  <i>nexthop</i> destination is taken from  <b>sender_dependent_default_transport_maps,</b>  <b></b><b>default_transport</b>, <b>sender_dependent_relayhost_maps</b>,  <b>relayhost</b>, or from the recipient domain.</dd>
</dl>
<p>
Normally, the <b>transport</b>(5) table is specified as a text file that serves as input to the  <b>postmap</b>(1) command. The result, an indexed file in  <b>dbm</b> or <b>db</b> format, is used for fast searching by the mail system. Execute the command " <b>postmap /etc/postfix/transport</b>" to rebuild an indexed file after changing the corresponding transport table.<div style="height: 1.00em;">
&#160;</div>
When the table is provided via other means such as NIS, LDAP or SQL, the same lookups are done as for ordinary indexed files.<div style="height: 1.00em;">
&#160;</div>
Alternatively, the table can be provided as a regular-expression map where patterns are given as regular expressions, or lookups can be directed to TCP-based server. In those case, the lookups are done in a slightly different way as described below under "REGULAR EXPRESSION TABLES" or "TCP-BASED TABLES".</div>
<div class="section">
<h1>CASE FOLDING</h1><br>
The search string is folded to lowercase before database lookup. As of Postfix 2.3, the search string is not case folded with database types such as regexp: or pcre: whose lookup fields can match both upper and lower case.</div>
<div class="section">
<h1>TABLE FORMAT</h1><br>
The input format for the <b>postmap</b>(1) command is as follows:<dl>
<dt>
<i>pattern result</i></dt>
<dd>
When <i>pattern</i> matches the recipient address or domain, use the corresponding  <i>result</i>.</dd>
</dl>
<dl>
<dt>
blank lines and comments</dt>
<dd>
Empty lines and whitespace-only lines are ignored, as are lines whose first non-whitespace character is a `#'.</dd>
</dl>
<dl>
<dt>
multi-line text</dt>
<dd>
A logical line starts with non-whitespace text. A line that starts with whitespace continues a logical line.</dd>
</dl>
<p>
The <i>pattern</i> specifies an email address, a domain name, or a domain name hierarchy, as described in section "TABLE LOOKUP".<div style="height: 1.00em;">
&#160;</div>
The <i>result</i> is of the form <i>transport:nexthop</i> and specifies how or where to deliver mail. This is described in section "RESULT FORMAT".</div>
<div class="section">
<h1>TABLE SEARCH ORDER</h1><br>
With lookups from indexed files such as DB or DBM, or from networked tables such as NIS, LDAP or SQL, patterns are tried in the order as listed below:<dl>
<dt>
<i>user+extension@domain transport</i>:<i>nexthop</i></dt>
<dd>
Deliver mail for <i>user+extension@domain</i> through  <i>transport</i> to  <i>nexthop</i>.</dd>
</dl>
<dl>
<dt>
<i>user@domain transport</i>:<i>nexthop</i></dt>
<dd>
Deliver mail for <i>user@domain</i> through <i>transport</i> to  <i>nexthop</i>.</dd>
</dl>
<dl>
<dt>
<i>domain transport</i>:<i>nexthop</i></dt>
<dd>
Deliver mail for <i>domain</i> through <i>transport</i> to  <i>nexthop</i>.</dd>
</dl>
<dl>
<dt>
<i>.domain transport</i>:<i>nexthop</i></dt>
<dd>
Deliver mail for any subdomain of <i>domain</i> through  <i>transport</i> to <i>nexthop</i>. This applies only when the string  <b>transport_maps</b> is not listed in the  <b>parent_domain_matches_subdomains</b> configuration setting. Otherwise, a domain name matches itself and its subdomains.</dd>
</dl>
<dl>
<dt>
<b>*</b><i> transport</i>:<i>nexthop</i></dt>
<dd>
The special pattern <b>*</b> represents any address (i.e. it functions as the wild-card pattern, and is unique to Postfix transport tables).</dd>
</dl>
<p>
Note 1: the null recipient address is looked up as  <b>$empty_address_recipient</b>@<b>$myhostname</b> (default: mailer-daemon@hostname).<div style="height: 1.00em;">
&#160;</div>
Note 2: <i>user@domain</i> or <i>user+extension@domain</i> lookup is available in Postfix 2.0 and later.</div>
<div class="section">
<h1>RESULT FORMAT</h1><br>
The lookup result is of the form <i>transport</i><b>:</b><i>nexthop</i>. The  <i>transport</i> field specifies a mail delivery transport such as  <b>smtp</b> or <b>local</b>. The <i>nexthop</i> field specifies where and how to deliver mail.<div style="height: 1.00em;">
&#160;</div>
The transport field specifies the name of a mail delivery transport (the first name of a mail delivery service entry in the Postfix  <b>master.cf</b> file).<div style="height: 1.00em;">
&#160;</div>
The interpretation of the nexthop field is transport dependent. In the case of SMTP, specify a service on a non-default port as  <i>host</i>:<i>service</i>, and disable MX (mail exchanger) DNS lookups with [ <i>host</i>] or [<i>host</i>]:<i>port</i>. The [] form is required when you specify an IP address instead of a hostname.<div style="height: 1.00em;">
&#160;</div>
A null <i>transport</i> and null <i>nexthop</i> result means "do not change": use the delivery transport and nexthop information that would be used when the entire transport table did not exist.<div style="height: 1.00em;">
&#160;</div>
A non-null <i>transport</i> field with a null <i>nexthop</i> field resets the nexthop information to the recipient domain.<div style="height: 1.00em;">
&#160;</div>
A null <i>transport</i> field with non-null <i>nexthop</i> field does not modify the transport information.</div>
<div class="section">
<h1>EXAMPLES</h1><br>
In order to deliver internal mail directly, while using a mail relay for all other mail, specify a null entry for internal destinations (do not change the delivery transport or the nexthop information) and specify a wildcard for all other destinations.<div style="height: 1.00em;">
&#160;</div>
<br>
     <b>my.domain    :</b><br>
     <b>.my.domain   :</b><br>
     <b>*            smtp:outbound-relay.my.domain</b><br>
<div style="height: 1.00em;">
&#160;</div>
In order to send mail for <b>example.com</b> and its subdomains via the  <b>uucp</b> transport to the UUCP host named <b>example</b>:<div style="height: 1.00em;">
&#160;</div>
<br>
     <b>example.com      uucp:example</b><br>
     <b>.example.com     uucp:example</b><br>
<div style="height: 1.00em;">
&#160;</div>
When no nexthop host name is specified, the destination domain name is used instead. For example, the following directs mail for  <i>user</i>@<b>example.com</b> via the <b>slow</b> transport to a mail exchanger for  <b>example.com</b>.  The <b>slow</b> transport could be configured to run at most one delivery process at a time:<div style="height: 1.00em;">
&#160;</div>
<br>
     <b>example.com      slow:</b><br>
<div style="height: 1.00em;">
&#160;</div>
When no transport is specified, Postfix uses the transport that matches the address domain class (see DESCRIPTION above).  The following sends all mail for  <b>example.com</b> and its subdomains to host  <b>gateway.example.com</b>:<div style="height: 1.00em;">
&#160;</div>
<br>
     <b>example.com      :[gateway.example.com]</b><br>
     <b>.example.com     :[gateway.example.com]</b><br>
<div style="height: 1.00em;">
&#160;</div>
In the above example, the [] suppress MX lookups. This prevents mail routing loops when your machine is primary MX host for  <b>example.com</b>.<div style="height: 1.00em;">
&#160;</div>
In the case of delivery via SMTP, one may specify  <i>hostname</i>:<i>service</i> instead of just a host:<div style="height: 1.00em;">
&#160;</div>
<br>
     <b>example.com      smtp:bar.example:2025</b><br>
<div style="height: 1.00em;">
&#160;</div>
This directs mail for <i>user</i>@<b>example.com</b> to host <b>bar.example</b> port  <b>2025</b>. Instead of a numerical port a symbolic name may be used. Specify [] around the hostname if MX lookups must be disabled.<div style="height: 1.00em;">
&#160;</div>
The error mailer can be used to bounce mail:<div style="height: 1.00em;">
&#160;</div>
<br>
     <b>.example.com     error:mail for *.example.com is not deliverable</b><br>
<div style="height: 1.00em;">
&#160;</div>
This causes all mail for <i>user</i>@<i>anything</i><b>.example.com</b> to be bounced.</div>
<div class="section">
<h1>REGULAR EXPRESSION TABLES</h1><br>
This section describes how the table lookups change when the table is given in the form of regular expressions. For a description of regular expression lookup table syntax, see  <b>regexp_table</b>(5) or  <b>pcre_table</b>(5).<div style="height: 1.00em;">
&#160;</div>
Each pattern is a regular expression that is applied to the entire address being looked up. Thus,  <i>some.domain.hierarchy</i> is not looked up via its parent domains, nor is  <i>user+foo@domain</i> looked up as <i>user@domain</i>.<div style="height: 1.00em;">
&#160;</div>
Patterns are applied in the order as specified in the table, until a pattern is found that matches the search string.<div style="height: 1.00em;">
&#160;</div>
The <b>trivial-rewrite</b>(8) server disallows regular expression substitution of $1 etc. in regular expression lookup tables, because that could open a security hole (Postfix version 2.3 and later).</div>
<div class="section">
<h1>TCP-BASED TABLES</h1><br>
This section describes how the table lookups change when lookups are directed to a TCP-based server. For a description of the TCP client/server lookup protocol, see  <b>tcp_table</b>(5). This feature is not available up to and including Postfix version 2.4.<div style="height: 1.00em;">
&#160;</div>
Each lookup operation uses the entire recipient address once.  Thus,  <i>some.domain.hierarchy</i> is not looked up via its parent domains, nor is  <i>user+foo@domain</i> looked up as <i>user@domain</i>.<div style="height: 1.00em;">
&#160;</div>
Results are the same as with indexed file lookups.</div>
<div class="section">
<h1>CONFIGURATION PARAMETERS</h1><br>
The following <b>main.cf</b> parameters are especially relevant. The text below provides only a parameter summary. See  <b>postconf</b>(5) for more details including examples.<dl>
<dt>
<b>empty_address_recipient</b></dt>
<dd>
The address that is looked up instead of the null sender address.</dd>
</dl>
<dl>
<dt>
<b>parent_domain_matches_subdomains</b></dt>
<dd>
List of Postfix features that use <i>domain.tld</i> patterns to match  <i>sub.domain.tld</i> (as opposed to requiring  <i>.domain.tld</i> patterns).</dd>
</dl>
<dl>
<dt>
<b>transport_maps</b></dt>
<dd>
List of transport lookup tables.</dd>
</dl>
</div>
<div class="section">
<h1>SEE ALSO</h1><br>
trivial-rewrite(8), rewrite and resolve addresses<br>
master(5), master.cf file format<br>
postconf(5), configuration parameters<br>
postmap(1), Postfix lookup table manager</div>
<div class="section">
<h1>README FILES</h1><br>
Use "<b>postconf readme_directory</b>" or " <b>postconf html_directory</b>" to locate this information.<br>
ADDRESS_REWRITING_README, address rewriting guide<br>
DATABASE_README, Postfix lookup table overview<br>
FILTER_README, external content filter</div>
<div class="section">
<h1>LICENSE</h1><br>
The Secure Mailer license must be distributed with this software.</div>
<div class="section">
<h1>AUTHOR(S)</h1><br>
Wietse Venema<br>
IBM T.J. Watson Research<br>
P.O. Box 704<br>
Yorktown Heights, NY 10598, USA</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tr>
<td class="foot-date">
</td>
<td class="foot-os" align="right">
</td>
</tr>
</table>
</div>
</body>
</html>

