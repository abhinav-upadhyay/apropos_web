<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
NTP_CONF(5)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
NTP_CONF(5)</td>
<td class="head-vol" align="center">
File</td>
<td class="head-rtitle" align="right">
NTP_CONF(5)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">ntp.conf</b> &#8212; <span class="desc">Network Time Protocol (NTP) daemon configuration file format</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1><table class="synopsis">
<col style="width: 8.00ex;">
<col>
<tbody>
<tr>
<td>
ntp.conf</td>
<td>
&#91;<span class="opt"><b class="flag">&#45;&#45;option&#45;name</b></span>&#93; &#91;<span class="opt"><b class="flag">&#45;&#45;option&#45;name</b> <i class="arg">value</i></span>&#93;</td>
</tr>
</tbody>
</table>
<p>
All arguments must be options.</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="name">ntp.conf</b> configuration file is read at initial startup by the <a class="link-man" href="../html8/ntpd.html">ntpd(8)</a> daemon in order to specify the synchronization sources, modes and other related information. Usually, it is installed in the <i class="file">/etc</i> directory, but could be installed elsewhere (see the daemon's <b class="flag">&#45;c</b> command line option).<p>
The file format is similar to other <span class="unix">UNIX</span> configuration files. Comments begin with a &#8216;<code class="lit">#</code>&#8217; character and extend to the end of the line; blank lines are ignored. Configuration commands consist of an initial keyword followed by a list of arguments, some of which may be optional, separated by whitespace. Commands may not be continued over multiple lines. Arguments may be host names, host addresses written in numeric, dotted&#45;quad form, integers, floating point numbers (when specifying times in seconds) and text strings.<p>
The rest of this page describes the configuration and control options. The &#8220;Notes on Configuring NTP and Setting up an NTP Subnet&#8221; page (available as part of the HTML documentation provided in <i class="file">/usr/share/doc/ntp</i>) contains an extended discussion of these options. In addition to the discussion of general <i class="link-sec"><a class="link-sec" href="#x436f6e66696775726174696f6e204f7074696f6e73">Configuration Options</a></i>, there are sections describing the following supported functionality and the options used to control it:<ul style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-bul">
<li class="list-bul" style="margin-top: 1.00em;">
<i class="link-sec"><a class="link-sec" href="#x41757468656e7469636174696f6e20537570706f7274">Authentication Support</a></i></li>
<li class="list-bul" style="margin-top: 1.00em;">
<i class="link-sec"><a class="link-sec" href="#x4d6f6e69746f72696e6720537570706f7274">Monitoring Support</a></i></li>
<li class="list-bul" style="margin-top: 1.00em;">
<i class="link-sec"><a class="link-sec" href="#x41636365737320436f6e74726f6c20537570706f7274">Access Control Support</a></i></li>
<li class="list-bul" style="margin-top: 1.00em;">
<i class="link-sec"><a class="link-sec" href="#x4175746f6d61746963204e545020436f6e66696775726174696f6e204f7074696f6e73">Automatic NTP Configuration Options</a></i></li>
<li class="list-bul" style="margin-top: 1.00em;">
<i class="link-sec"><a class="link-sec" href="#x5265666572656e636520436c6f636b20537570706f7274">Reference Clock Support</a></i></li>
<li class="list-bul" style="margin-top: 1.00em;">
<i class="link-sec"><a class="link-sec" href="#x4d697363656c6c616e656f7573204f7074696f6e73">Miscellaneous Options</a></i></li>
</ul>
<p>
Following these is a section describing <i class="link-sec"><a class="link-sec" href="#x4d697363656c6c616e656f7573204f7074696f6e73">Miscellaneous Options</a></i>. While there is a rich set of options available, the only required option is one or more <b class="cmd">pool</b>, <b class="cmd">server</b>, <b class="cmd">peer</b>, <b class="cmd">broadcast</b> or <b class="cmd">manycastclient</b> commands.</div>
<div class="section">
<h1 id="x436f6e66696775726174696f6e20537570706f7274">Configuration Support</h1> Following is a description of the configuration commands in NTPv4. These commands have the same basic functions as in NTPv3 and in some cases new functions and new arguments. There are two classes of commands, configuration commands that configure a persistent association with a remote server or peer or reference clock, and auxiliary commands that specify environmental variables that control various related operations.<div class="subsection">
<h2 id="x436f6e66696775726174696f6e20436f6d6d616e6473">Configuration Commands</h2> The various modes are determined by the command keyword and the type of the required IP address. Addresses are classed by type as (s) a remote server or peer (IPv4 class A, B and C), (b) the broadcast address of a local interface, (m) a multicast address (IPv4 class D), or (r) a reference clock address (127.127.x.x). Note that only those options applicable to each command are listed below. Use of options not listed may not be caught as an error, but may result in some weird and even destructive behavior.<p>
If the Basic Socket Interface Extensions for IPv6 (RFC&#45;2553) is detected, support for the IPv6 address family is generated in addition to the default support of the IPv4 address family. In a few cases, including the reslist billboard generated by ntpdc, IPv6 addresses are automatically generated. IPv6 addresses can be identified by the presence of colons &#8220;:&#8221; in the address field. IPv6 addresses can be used almost everywhere where IPv4 addresses can be used, with the exception of reference clock addresses, which are always IPv4.<p>
Note that in contexts where a host name is expected, a <b class="flag">&#45;4</b> qualifier preceding the host name forces DNS resolution to the IPv4 namespace, while a <b class="flag">&#45;6</b> qualifier forces DNS resolution to the IPv6 namespace. See IPv6 references for the equivalent classes for that address family.<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">pool</b> <i class="arg">address</i> &#91;<span class="opt"><b class="flag">burst</b></span>&#93; &#91;<span class="opt"><b class="flag">iburst</b></span>&#93; &#91;<span class="opt"><b class="flag">version</b> <i class="arg">version</i></span>&#93; &#91;<span class="opt"><b class="flag">prefer</b></span>&#93; &#91;<span class="opt"><b class="flag">minpoll</b> <i class="arg">minpoll</i></span>&#93; &#91;<span class="opt"><b class="flag">maxpoll</b> <i class="arg">maxpoll</i></span>&#93;</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">server</b> <i class="arg">address</i> &#91;<span class="opt"><b class="flag">key</b> <i class="arg">key |</i> <b class="flag">autokey</b></span>&#93; &#91;<span class="opt"><b class="flag">burst</b></span>&#93; &#91;<span class="opt"><b class="flag">iburst</b></span>&#93; &#91;<span class="opt"><b class="flag">version</b> <i class="arg">version</i></span>&#93; &#91;<span class="opt"><b class="flag">prefer</b></span>&#93; &#91;<span class="opt"><b class="flag">minpoll</b> <i class="arg">minpoll</i></span>&#93; &#91;<span class="opt"><b class="flag">maxpoll</b> <i class="arg">maxpoll</i></span>&#93;</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">peer</b> <i class="arg">address</i> &#91;<span class="opt"><b class="flag">key</b> <i class="arg">key |</i> <b class="flag">autokey</b></span>&#93; &#91;<span class="opt"><b class="flag">version</b> <i class="arg">version</i></span>&#93; &#91;<span class="opt"><b class="flag">prefer</b></span>&#93; &#91;<span class="opt"><b class="flag">minpoll</b> <i class="arg">minpoll</i></span>&#93; &#91;<span class="opt"><b class="flag">maxpoll</b> <i class="arg">maxpoll</i></span>&#93;</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">broadcast</b> <i class="arg">address</i> &#91;<span class="opt"><b class="flag">key</b> <i class="arg">key |</i> <b class="flag">autokey</b></span>&#93; &#91;<span class="opt"><b class="flag">version</b> <i class="arg">version</i></span>&#93; &#91;<span class="opt"><b class="flag">prefer</b></span>&#93; &#91;<span class="opt"><b class="flag">minpoll</b> <i class="arg">minpoll</i></span>&#93; &#91;<span class="opt"><b class="flag">ttl</b> <i class="arg">ttl</i></span>&#93;</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">manycastclient</b> <i class="arg">address</i> &#91;<span class="opt"><b class="flag">key</b> <i class="arg">key |</i> <b class="flag">autokey</b></span>&#93; &#91;<span class="opt"><b class="flag">version</b> <i class="arg">version</i></span>&#93; &#91;<span class="opt"><b class="flag">prefer</b></span>&#93; &#91;<span class="opt"><b class="flag">minpoll</b> <i class="arg">minpoll</i></span>&#93; &#91;<span class="opt"><b class="flag">maxpoll</b> <i class="arg">maxpoll</i></span>&#93; &#91;<span class="opt"><b class="flag">ttl</b> <i class="arg">ttl</i></span>&#93;</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
</dd>
</dl>
<p>
These five commands specify the time server name or address to be used and the mode in which to operate. The <i class="arg">address</i> can be either a DNS name or an IP address in dotted&#45;quad notation. Additional information on association behavior can be found in the &#8220;Association Management&#8221; page (available as part of the HTML documentation provided in <i class="file">/usr/share/doc/ntp</i>).<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">pool</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
For type s addresses, this command mobilizes a persistent client mode association with a number of remote servers. In this mode the local clock can synchronized to the remote server, but the remote server can never be synchronized to the local clock.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">server</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
For type s and r addresses, this command mobilizes a persistent client mode association with the specified remote server or local radio clock. In this mode the local clock can synchronized to the remote server, but the remote server can never be synchronized to the local clock. This command should <span class="emph">not</span> be used for type b or m addresses.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">peer</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
For type s addresses (only), this command mobilizes a persistent symmetric&#45;active mode association with the specified remote peer. In this mode the local clock can be synchronized to the remote peer or the remote peer can be synchronized to the local clock. This is useful in a network of servers where, depending on various failure scenarios, either the local or remote peer may be the better source of time. This command should NOT be used for type b, m or r addresses.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">broadcast</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
For type b and m addresses (only), this command mobilizes a persistent broadcast mode association. Multiple commands can be used to specify multiple local broadcast interfaces (subnets) and/or multiple multicast groups. Note that local broadcast messages go only to the interface associated with the subnet specified, but multicast messages go to all interfaces. In broadcast mode the local server sends periodic broadcast messages to a client population at the <i class="arg">address</i> specified, which is usually the broadcast address on (one of) the local network(s) or a multicast address assigned to NTP. The IANA has assigned the multicast group address IPv4 224.0.1.1 and IPv6 ff05::101 (site local) exclusively to NTP, but other nonconflicting addresses can be used to contain the messages within administrative boundaries. Ordinarily, this specification applies only to the local server operating as a sender; for operation as a broadcast client, see the <b class="cmd">broadcastclient</b> or <b class="cmd">multicastclient</b> commands below.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">manycastclient</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
For type m addresses (only), this command mobilizes a manycast client mode association for the multicast address specified. In this case a specific address must be supplied which matches the address used on the <b class="cmd">manycastserver</b> command for the designated manycast servers. The NTP multicast address 224.0.1.1 assigned by the IANA should NOT be used, unless specific means are taken to avoid spraying large areas of the Internet with these messages and causing a possibly massive implosion of replies at the sender. The <b class="cmd">manycastserver</b> command specifies that the local server is to operate in client mode with the remote servers that are discovered as the result of broadcast/multicast messages. The client broadcasts a request message to the group address associated with the specified <i class="arg">address</i> and specifically enabled servers respond to these messages. The client selects the servers providing the best time and continues as with the <b class="cmd">server</b> command. The remaining servers are discarded as if never heard.</dd>
</dl>
<p>
Options:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">autokey</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
All packets sent to and received from the server or peer are to include authentication fields encrypted using the autokey scheme described in <i class="link-sec"><a class="link-sec" href="#x41757468656e7469636174696f6e204f7074696f6e73">Authentication Options</a></i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">burst</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
when the server is reachable, send a burst of eight packets instead of the usual one. The packet spacing is normally 2 s; however, the spacing between the first and second packets can be changed with the calldelay command to allow additional time for a modem or ISDN call to complete. This is designed to improve timekeeping quality with the <b class="cmd">server</b> command and s addresses.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">iburst</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
When the server is unreachable, send a burst of eight packets instead of the usual one. The packet spacing is normally 2 s; however, the spacing between the first two packets can be changed with the calldelay command to allow additional time for a modem or ISDN call to complete. This is designed to speed the initial synchronization acquisition with the <b class="cmd">server</b> command and s addresses and when <a class="link-man" href="../html8/ntpd.html">ntpd(8)</a> is started with the <b class="flag">&#45;q</b> option.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">key</b> <i class="arg">key</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
All packets sent to and received from the server or peer are to include authentication fields encrypted using the specified <i class="arg">key</i> identifier with values from 1 to 65534, inclusive. The default is to include no encryption field.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">minpoll</b> <i class="arg">minpoll</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">maxpoll</b> <i class="arg">maxpoll</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
These options specify the minimum and maximum poll intervals for NTP messages, as a power of 2 in seconds The maximum poll interval defaults to 10 (1,024 s), but can be increased by the <b class="flag">maxpoll</b> option to an upper limit of 17 (36.4 h). The minimum poll interval defaults to 6 (64 s), but can be decreased by the <b class="flag">minpoll</b> option to a lower limit of 4 (16 s).</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">noselect</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Marks the server as unused, except for display purposes. The server is discarded by the selection algroithm.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">prefer</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Marks the server as preferred. All other things being equal, this host will be chosen for synchronization among a set of correctly operating hosts. See the &#8220;Mitigation Rules and the prefer Keyword&#8221; page (available as part of the HTML documentation provided in <i class="file">/usr/share/doc/ntp</i>) for further information.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">ttl</b> <i class="arg">ttl</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This option is used only with broadcast server and manycast client modes. It specifies the time&#45;to&#45;live <i class="arg">ttl</i> to use on broadcast server and multicast server and the maximum <i class="arg">ttl</i> for the expanding ring search with manycast client packets. Selection of the proper value, which defaults to 127, is something of a black art and should be coordinated with the network administrator.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">version</b> <i class="arg">version</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Specifies the version number to be used for outgoing NTP packets. Versions 1&#45;4 are the choices, with version 4 the default.</dd>
</dl>
</div>
<div class="subsection">
<h2 id="x417578696c6961727920436f6d6d616e6473">Auxiliary Commands</h2><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">broadcastclient</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This command enables reception of broadcast server messages to any local interface (type b) address. Upon receiving a message for the first time, the broadcast client measures the nominal server propagation delay using a brief client/server exchange with the server, then enters the broadcast client mode, in which it synchronizes to succeeding broadcast messages. Note that, in order to avoid accidental or malicious disruption in this mode, both the server and client should operate using symmetric&#45;key or public&#45;key authentication as described in <i class="link-sec"><a class="link-sec" href="#x41757468656e7469636174696f6e204f7074696f6e73">Authentication Options</a></i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">manycastserver</b> <i class="arg">address ...</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This command enables reception of manycast client messages to the multicast group address(es) (type m) specified. At least one address is required, but the NTP multicast address 224.0.1.1 assigned by the IANA should NOT be used, unless specific means are taken to limit the span of the reply and avoid a possibly massive implosion at the original sender. Note that, in order to avoid accidental or malicious disruption in this mode, both the server and client should operate using symmetric&#45;key or public&#45;key authentication as described in <i class="link-sec"><a class="link-sec" href="#x41757468656e7469636174696f6e204f7074696f6e73">Authentication Options</a></i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">multicastclient</b> <i class="arg">address ...</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This command enables reception of multicast server messages to the multicast group address(es) (type m) specified. Upon receiving a message for the first time, the multicast client measures the nominal server propagation delay using a brief client/server exchange with the server, then enters the broadcast client mode, in which it synchronizes to succeeding multicast messages. Note that, in order to avoid accidental or malicious disruption in this mode, both the server and client should operate using symmetric&#45;key or public&#45;key authentication as described in <i class="link-sec"><a class="link-sec" href="#x41757468656e7469636174696f6e204f7074696f6e73">Authentication Options</a></i>.</dd>
</dl>
</div>
</div>
<div class="section">
<h1 id="x41757468656e7469636174696f6e20537570706f7274">Authentication Support</h1> Authentication support allows the NTP client to verify that the server is in fact known and trusted and not an intruder intending accidentally or on purpose to masquerade as that server. The NTPv3 specification RFC&#45;1305 defines a scheme which provides cryptographic authentication of received NTP packets. Originally, this was done using the Data Encryption Standard (DES) algorithm operating in Cipher Block Chaining (CBC) mode, commonly called DES&#45;CBC. Subsequently, this was replaced by the RSA Message Digest 5 (MD5) algorithm using a private key, commonly called keyed&#45;MD5. Either algorithm computes a message digest, or one&#45;way hash, which can be used to verify the server has the correct private key and key identifier.<p>
NTPv4 retains the NTPv3 scheme, properly described as symmetric key cryptography and, in addition, provides a new Autokey scheme based on public key cryptography. Public key cryptography is generally considered more secure than symmetric key cryptography, since the security is based on a private value which is generated by each server and never revealed. With Autokey all key distribution and management functions involve only public values, which considerably simplifies key distribution and storage. Public key management is based on X.509 certificates, which can be provided by commercial services or produced by utility programs in the OpenSSL software library or the NTPv4 distribution.<p>
While the algorithms for symmetric key cryptography are included in the NTPv4 distribution, public key cryptography requires the OpenSSL software library to be installed before building the NTP distribution. Directions for doing that are on the Building and Installing the Distribution page.<p>
Authentication is configured separately for each association using the <b class="flag">key</b> or <b class="flag">autokey</b> subcommand on the <b class="cmd">peer</b>, <b class="cmd">server</b>, <b class="cmd">broadcast</b> and <b class="cmd">manycastclient</b> configuration commands as described in <i class="link-sec"><a class="link-sec" href="#x436f6e66696775726174696f6e204f7074696f6e73">Configuration Options</a></i> page. The authentication options described below specify the locations of the key files, if other than default, which symmetric keys are trusted and the interval between various operations, if other than default.<p>
Authentication is always enabled, although ineffective if not configured as described below. If a NTP packet arrives including a message authentication code (MAC), it is accepted only if it passes all cryptographic checks. The checks require correct key ID, key value and message digest. If the packet has been modified in any way or replayed by an intruder, it will fail one or more of these checks and be discarded. Furthermore, the Autokey scheme requires a preliminary protocol exchange to obtain the server certificate, verify its credentials and initialize the protocol<p>
The <b class="flag">auth</b> flag controls whether new associations or remote configuration commands require cryptographic authentication. This flag can be set or reset by the <b class="cmd">enable</b> and <b class="cmd">disable</b> commands and also by remote configuration commands sent by a <a class="link-man" href="../html8/ntpdc.html">ntpdc(8)</a> program running in another machine. If this flag is enabled, which is the default case, new broadcast client and symmetric passive associations and remote configuration commands must be cryptographically authenticated using either symmetric key or public key cryptography. If this flag is disabled, these operations are effective even if not cryptographic authenticated. It should be understood that operating with the <b class="cmd">auth</b> flag disabled invites a significant vulnerability where a rogue hacker can masquerade as a falseticker and seriously disrupt system timekeeping. It is important to note that this flag has no purpose other than to allow or disallow a new association in response to new broadcast and symmetric active messages and remote configuration commands and, in particular, the flag has no effect on the authentication process itself.<p>
An attractive alternative where multicast support is available is manycast mode, in which clients periodically troll for servers as described in the <i class="link-sec"><a class="link-sec" href="#x4175746f6d61746963204e545020436f6e66696775726174696f6e204f7074696f6e73">Automatic NTP Configuration Options</a></i> page. Either symmetric key or public key cryptographic authentication can be used in this mode. The principle advantage of manycast mode is that potential servers need not be configured in advance, since the client finds them during regular operation, and the configuration files for all clients can be identical.<p>
The security model and protocol schemes for both symmetric key and public key cryptography are summarized below; further details are in the briefings, papers and reports at the NTP project page linked from <code class="lit">http://www.ntp.org/</code>.<div class="subsection">
<h2 id="x53796d6d65747269635c2d4b65792043727970746f677261706879">Symmetric&#45;Key Cryptography</h2> The original RFC&#45;1305 specification allows any one of possibly 65,534 keys, each distinguished by a 32&#45;bit key identifier, to authenticate an association. The servers and clients involved must agree on the key and key identifier to authenticate NTP packets. Keys and related information are specified in a key file, usually called <i class="file">ntp.keys</i>, which must be distributed and stored using secure means beyond the scope of the NTP protocol itself. Besides the keys used for ordinary NTP associations, additional keys can be used as passwords for the <a class="link-man" href="../html8/ntpq.html">ntpq(8)</a> and <a class="link-man" href="../html8/ntpdc.html">ntpdc(8)</a> utility programs.<p>
When <a class="link-man" href="../html8/ntpd.html">ntpd(8)</a> is first started, it reads the key file specified in the <b class="cmd">keys</b> configuration command and installs the keys in the key cache. However, individual keys must be activated with the <b class="cmd">trusted</b> command before use. This allows, for instance, the installation of possibly several batches of keys and then activating or deactivating each batch remotely using <a class="link-man" href="../html8/ntpdc.html">ntpdc(8)</a>. This also provides a revocation capability that can be used if a key becomes compromised. The <b class="cmd">requestkey</b> command selects the key used as the password for the <a class="link-man" href="../html8/ntpdc.html">ntpdc(8)</a> utility, while the <b class="cmd">controlkey</b> command selects the key used as the password for the <a class="link-man" href="../html8/ntpq.html">ntpq(8)</a> utility.</div>
<div class="subsection">
<h2 id="x5075626c6963204b65792043727970746f677261706879">Public Key Cryptography</h2> NTPv4 supports the original NTPv3 symmetric key scheme described in RFC&#45;1305 and in addition the Autokey protocol, which is based on public key cryptography. The Autokey Version 2 protocol described on the Autokey Protocol page verifies packet integrity using MD5 message digests and verifies the source with digital signatures and any of several digest/signature schemes. Optional identity schemes described on the Identity Schemes page and based on cryptographic challenge/response algorithms are also available. Using all of these schemes provides strong security against replay with or without modification, spoofing, masquerade and most forms of clogging attacks.<p>
The Autokey protocol has several modes of operation corresponding to the various NTP modes supported. Most modes use a special cookie which can be computed independently by the client and server, but encrypted in transmission. All modes use in addition a variant of the S&#45;KEY scheme, in which a pseudo&#45;random key list is generated and used in reverse order. These schemes are described along with an executive summary, current status, briefing slides and reading list on the <i class="link-sec"><a class="link-sec" href="#x4175746f6e6f6d6f75732041757468656e7469636174696f6e">Autonomous Authentication</a></i> page.<p>
The specific cryptographic environment used by Autokey servers and clients is determined by a set of files and soft links generated by the <a class="link-man" href="../html1ntpkeygenmdoc/ntp&#45;keygen.html">ntp&#45;keygen(1ntpkeygenmdoc)</a> program. This includes a required host key file, required certificate file and optional sign key file, leapsecond file and identity scheme files. The digest/signature scheme is specified in the X.509 certificate along with the matching sign key. There are several schemes available in the OpenSSL software library, each identified by a specific string such as <b class="flag">md5WithRSAEncryption</b>, which stands for the MD5 message digest with RSA encryption scheme. The current NTP distribution supports all the schemes in the OpenSSL library, including those based on RSA and DSA digital signatures.<p>
NTP secure groups can be used to define cryptographic compartments and security hierarchies. It is important that every host in the group be able to construct a certificate trail to one or more trusted hosts in the same group. Each group host runs the Autokey protocol to obtain the certificates for all hosts along the trail to one or more trusted hosts. This requires the configuration file in all hosts to be engineered so that, even under anticipated failure conditions, the NTP subnet will form such that every group host can find a trail to at least one trusted host.</div>
<div class="subsection">
<h2 id="x4e616d696e6720616e642041646472657373696e67">Naming and Addressing</h2> It is important to note that Autokey does not use DNS to resolve addresses, since DNS can't be completely trusted until the name servers have synchronized clocks. The cryptographic name used by Autokey to bind the host identity credentials and cryptographic values must be independent of interface, network and any other naming convention. The name appears in the host certificate in either or both the subject and issuer fields, so protection against DNS compromise is essential.<p>
By convention, the name of an Autokey host is the name returned by the Unix <a class="link-man" href="../html2/gethostname.html">gethostname(2)</a> system call or equivalent in other systems. By the system design model, there are no provisions to allow alternate names or aliases. However, this is not to say that DNS aliases, different names for each interface, etc., are constrained in any way.<p>
It is also important to note that Autokey verifies authenticity using the host name, network address and public keys, all of which are bound together by the protocol specifically to deflect masquerade attacks. For this reason Autokey includes the source and destinatino IP addresses in message digest computations and so the same addresses must be available at both the server and client. For this reason operation with network address translation schemes is not possible. This reflects the intended robust security model where government and corporate NTP servers are operated outside firewall perimeters.</div>
<div class="subsection">
<h2 id="x4f7065726174696f6e">Operation</h2> A specific combination of authentication scheme (none, symmetric key, public key) and identity scheme is called a cryptotype, although not all combinations are compatible. There may be management configurations where the clients, servers and peers may not all support the same cryptotypes. A secure NTPv4 subnet can be configured in many ways while keeping in mind the principles explained above and in this section. Note however that some cryptotype combinations may successfully interoperate with each other, but may not represent good security practice.<p>
The cryptotype of an association is determined at the time of mobilization, either at configuration time or some time later when a message of appropriate cryptotype arrives. When mobilized by a <b class="cmd">server</b> or <b class="cmd">peer</b> configuration command and no <b class="cmd">key</b> or <b class="cmd">autokey</b> subcommands are present, the association is not authenticated; if the <b class="cmd">key</b> subcommand is present, the association is authenticated using the symmetric key ID specified; if the <b class="cmd">autokey</b> subcommand is present, the association is authenticated using Autokey.<p>
When multiple identity schemes are supported in the Autokey protocol, the first message exchange determines which one is used. The client request message contains bits corresponding to which schemes it has available. The server response message contains bits corresponding to which schemes it has available. Both server and client match the received bits with their own and select a common scheme.<p>
Following the principle that time is a public value, a server responds to any client packet that matches its cryptotype capabilities. Thus, a server receiving an unauthenticated packet will respond with an unauthenticated packet, while the same server receiving a packet of a cryptotype it supports will respond with packets of that cryptotype. However, unconfigured broadcast or manycast client associations or symmetric passive associations will not be mobilized unless the server supports a cryptotype compatible with the first packet received. By default, unauthenticated associations will not be mobilized unless overridden in a decidedly dangerous way.<p>
Some examples may help to reduce confusion. Client Alice has no specific cryptotype selected. Server Bob has both a symmetric key file and minimal Autokey files. Alice's unauthenticated messages arrive at Bob, who replies with unauthenticated messages. Cathy has a copy of Bob's symmetric key file and has selected key ID 4 in messages to Bob. Bob verifies the message with his key ID 4. If it's the same key and the message is verified, Bob sends Cathy a reply authenticated with that key. If verification fails, Bob sends Cathy a thing called a crypto&#45;NAK, which tells her something broke. She can see the evidence using the <a class="link-man" href="../html8/ntpq.html">ntpq(8)</a> program.<p>
Denise has rolled her own host key and certificate. She also uses one of the identity schemes as Bob. She sends the first Autokey message to Bob and they both dance the protocol authentication and identity steps. If all comes out okay, Denise and Bob continue as described above.<p>
It should be clear from the above that Bob can support all the girls at the same time, as long as he has compatible authentication and identity credentials. Now, Bob can act just like the girls in his own choice of servers; he can run multiple configured associations with multiple different servers (or the same server, although that might not be useful). But, wise security policy might preclude some cryptotype combinations; for instance, running an identity scheme with one server and no authentication with another might not be wise.</div>
<div class="subsection">
<h2 id="x4b6579204d616e6167656d656e74">Key Management</h2> The cryptographic values used by the Autokey protocol are incorporated as a set of files generated by the <a class="link-man" href="../html1ntpkeygenmdoc/ntp&#45;keygen.html">ntp&#45;keygen(1ntpkeygenmdoc)</a> utility program, including symmetric key, host key and public certificate files, as well as sign key, identity parameters and leapseconds files. Alternatively, host and sign keys and certificate files can be generated by the OpenSSL utilities and certificates can be imported from public certificate authorities. Note that symmetric keys are necessary for the <a class="link-man" href="../html8/ntpq.html">ntpq(8)</a> and <a class="link-man" href="../html8/ntpdc.html">ntpdc(8)</a> utility programs. The remaining files are necessary only for the Autokey protocol.<p>
Certificates imported from OpenSSL or public certificate authorities have certian limitations. The certificate should be in ASN.1 syntax, X.509 Version 3 format and encoded in PEM, which is the same format used by OpenSSL. The overall length of the certificate encoded in ASN.1 must not exceed 1024 bytes. The subject distinguished name field (CN) is the fully qualified name of the host on which it is used; the remaining subject fields are ignored. The certificate extension fields must not contain either a subject key identifier or a issuer key identifier field; however, an extended key usage field for a trusted host must contain the value <b class="flag">trustRoot</b>;. Other extension fields are ignored.</div>
<div class="subsection">
<h2 id="x41757468656e7469636174696f6e20436f6d6d616e6473">Authentication Commands</h2><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">autokey</b> &#91;<span class="opt"><i class="arg">logsec</i></span>&#93;</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Specifies the interval between regenerations of the session key list used with the Autokey protocol. Note that the size of the key list for each association depends on this interval and the current poll interval. The default value is 12 (4096 s or about 1.1 hours). For poll intervals above the specified interval, a session key list with a single entry will be regenerated for every message sent.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">controlkey</b> <i class="arg">key</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Specifies the key identifier to use with the <a class="link-man" href="../html8/ntpq.html">ntpq(8)</a> utility, which uses the standard protocol defined in RFC&#45;1305. The <i class="arg">key</i> argument is the key identifier for a trusted key, where the value can be in the range 1 to 65,534, inclusive.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">crypto</b> &#91;<span class="opt"><b class="flag">cert</b> <i class="arg">file</i></span>&#93; &#91;<span class="opt"><b class="flag">leap</b> <i class="arg">file</i></span>&#93; &#91;<span class="opt"><b class="flag">randfile</b> <i class="arg">file</i></span>&#93; &#91;<span class="opt"><b class="flag">host</b> <i class="arg">file</i></span>&#93; &#91;<span class="opt"><b class="flag">sign</b> <i class="arg">file</i></span>&#93; &#91;<span class="opt"><b class="flag">gq</b> <i class="arg">file</i></span>&#93; &#91;<span class="opt"><b class="flag">gqpar</b> <i class="arg">file</i></span>&#93; &#91;<span class="opt"><b class="flag">iffpar</b> <i class="arg">file</i></span>&#93; &#91;<span class="opt"><b class="flag">mvpar</b> <i class="arg">file</i></span>&#93; &#91;<span class="opt"><b class="flag">pw</b> <i class="arg">password</i></span>&#93;</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This command requires the OpenSSL library. It activates public key cryptography, selects the message digest and signature encryption scheme and loads the required private and public values described above. If one or more files are left unspecified, the default names are used as described above. Unless the complete path and name of the file are specified, the location of a file is relative to the keys directory specified in the <b class="cmd">keysdir</b> command or default <i class="file">/usr/local/etc</i>. Following are the subcommands:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">cert</b> <i class="arg">file</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Specifies the location of the required host public certificate file. This overrides the link <i class="file">ntpkey_cert_</i><i class="arg">hostname</i> in the keys directory.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">gqpar</b> <i class="arg">file</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Specifies the location of the optional GQ parameters file. This overrides the link <i class="file">ntpkey_gq_</i><i class="arg">hostname</i> in the keys directory.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">host</b> <i class="arg">file</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Specifies the location of the required host key file. This overrides the link <i class="file">ntpkey_key_</i><i class="arg">hostname</i> in the keys directory.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">iffpar</b> <i class="arg">file</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Specifies the location of the optional IFF parameters file.This overrides the link <i class="file">ntpkey_iff_</i><i class="arg">hostname</i> in the keys directory.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">leap</b> <i class="arg">file</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Specifies the location of the optional leapsecond file. This overrides the link <i class="file">ntpkey_leap</i> in the keys directory.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">mvpar</b> <i class="arg">file</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Specifies the location of the optional MV parameters file. This overrides the link <i class="file">ntpkey_mv_</i><i class="arg">hostname</i> in the keys directory.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">pw</b> <i class="arg">password</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Specifies the password to decrypt files containing private keys and identity parameters. This is required only if these files have been encrypted.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">randfile</b> <i class="arg">file</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Specifies the location of the random seed file used by the OpenSSL library. The defaults are described in the main text above.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">sign</b> <i class="arg">file</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Specifies the location of the optional sign key file. This overrides the link <i class="file">ntpkey_sign_</i><i class="arg">hostname</i> in the keys directory. If this file is not found, the host key is also the sign key.</dd>
</dl>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">keys</b> <i class="arg">keyfile</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Specifies the complete path and location of the MD5 key file containing the keys and key identifiers used by <a class="link-man" href="../html8/ntpd.html">ntpd(8)</a>, <a class="link-man" href="../html8/ntpq.html">ntpq(8)</a> and <a class="link-man" href="../html8/ntpdc.html">ntpdc(8)</a> when operating with symmetric key cryptography. This is the same operation as the <b class="flag">&#45;k</b> command line option.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">keysdir</b> <i class="arg">path</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This command specifies the default directory path for cryptographic keys, parameters and certificates. The default is <i class="file">/usr/local/etc/</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">requestkey</b> <i class="arg">key</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Specifies the key identifier to use with the <a class="link-man" href="../html8/ntpdc.html">ntpdc(8)</a> utility program, which uses a proprietary protocol specific to this implementation of <a class="link-man" href="../html8/ntpd.html">ntpd(8)</a>. The <i class="arg">key</i> argument is a key identifier for the trusted key, where the value can be in the range 1 to 65,534, inclusive.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">revoke</b> <i class="arg">logsec</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Specifies the interval between re&#45;randomization of certain cryptographic values used by the Autokey scheme, as a power of 2 in seconds. These values need to be updated frequently in order to deflect brute&#45;force attacks on the algorithms of the scheme; however, updating some values is a relatively expensive operation. The default interval is 16 (65,536 s or about 18 hours). For poll intervals above the specified interval, the values will be updated for every message sent.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">trustedkey</b> <i class="arg">key ...</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Specifies the key identifiers which are trusted for the purposes of authenticating peers with symmetric key cryptography, as well as keys used by the <a class="link-man" href="../html8/ntpq.html">ntpq(8)</a> and <a class="link-man" href="../html8/ntpdc.html">ntpdc(8)</a> programs. The authentication procedures require that both the local and remote servers share the same key and key identifier for this purpose, although different keys can be used with different servers. The <i class="arg">key</i> arguments are 32&#45;bit unsigned integers with values from 1 to 65,534.</dd>
</dl>
</div>
<div class="subsection">
<h2 id="x4572726f7220436f646573">Error Codes</h2> The following error codes are reported via the NTP control and monitoring protocol trap mechanism.<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
101</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
(bad field format or length) The packet has invalid version, length or format.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
102</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
(bad timestamp) The packet timestamp is the same or older than the most recent received. This could be due to a replay or a server clock time step.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
103</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
(bad filestamp) The packet filestamp is the same or older than the most recent received. This could be due to a replay or a key file generation error.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
104</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
(bad or missing public key) The public key is missing, has incorrect format or is an unsupported type.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
105</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
(unsupported digest type) The server requires an unsupported digest/signature scheme.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
106</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
(mismatched digest types) Not used.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
107</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
(bad signature length) The signature length does not match the current public key.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
108</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
(signature not verified) The message fails the signature check. It could be bogus or signed by a different private key.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
109</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
(certificate not verified) The certificate is invalid or signed with the wrong key.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
110</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
(certificate not verified) The certificate is not yet valid or has expired or the signature could not be verified.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
111</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
(bad or missing cookie) The cookie is missing, corrupted or bogus.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
112</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
(bad or missing leapseconds table) The leapseconds table is missing, corrupted or bogus.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
113</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
(bad or missing certificate) The certificate is missing, corrupted or bogus.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
114</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
(bad or missing identity) The identity key is missing, corrupt or bogus.</dd>
</dl>
</div>
</div>
<div class="section">
<h1 id="x4d6f6e69746f72696e6720537570706f7274">Monitoring Support</h1> <a class="link-man" href="../html8/ntpd.html">ntpd(8)</a> includes a comprehensive monitoring facility suitable for continuous, long term recording of server and client timekeeping performance. See the <b class="cmd">statistics</b> command below for a listing and example of each type of statistics currently supported. Statistic files are managed using file generation sets and scripts in the <i class="file">./scripts</i> directory of this distribution. Using these facilities and <span class="unix">UNIX</span> <a class="link-man" href="../html8/cron.html">cron(8)</a> jobs, the data can be automatically summarized and archived for retrospective analysis.<div class="subsection">
<h2 id="x4d6f6e69746f72696e6720436f6d6d616e6473">Monitoring Commands</h2><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">statistics</b> <i class="arg">name ...</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Enables writing of statistics records. Currently, four kinds of <i class="arg">name</i> statistics are supported.<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">clockstats</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Enables recording of clock driver statistics information. Each update received from a clock driver appends a line of the following form to the file generation set named <b class="flag">clockstats</b>:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
49213 525.624 127.127.4.1 93 226 00:08:29.606 D</pre>
<p>
The first two fields show the date (Modified Julian Day) and time (seconds and fraction past UTC midnight). The next field shows the clock address in dotted&#45;quad notation. The final field shows the last timecode received from the clock in decoded ASCII format, where meaningful. In some clock drivers a good deal of additional information can be gathered and displayed as well. See information specific to each clock for further details.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">cryptostats</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This option requires the OpenSSL cryptographic software library. It enables recording of cryptographic public key protocol information. Each message received by the protocol module appends a line of the following form to the file generation set named <b class="flag">cryptostats</b>:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
49213 525.624 127.127.4.1 message</pre>
<p>
The first two fields show the date (Modified Julian Day) and time (seconds and fraction past UTC midnight). The next field shows the peer address in dotted&#45;quad notation, The final message field includes the message type and certain ancillary information. See the <i class="link-sec"><a class="link-sec" href="#x41757468656e7469636174696f6e204f7074696f6e73">Authentication Options</a></i> section for further information.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">loopstats</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Enables recording of loop filter statistics information. Each update of the local clock outputs a line of the following form to the file generation set named <b class="flag">loopstats</b>:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
50935 75440.031 0.000006019 13.778190 0.000351733 0.0133806</pre>
<p>
The first two fields show the date (Modified Julian Day) and time (seconds and fraction past UTC midnight). The next five fields show time offset (seconds), frequency offset (parts per million &#45; PPM), RMS jitter (seconds), Allan deviation (PPM) and clock discipline time constant.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">peerstats</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Enables recording of peer statistics information. This includes statistics records of all peers of a NTP server and of special signals, where present and configured. Each valid update appends a line of the following form to the current element of a file generation set named <b class="flag">peerstats</b>:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
48773 10847.650 127.127.4.1 9714 &#45;0.001605376 0.000000000 0.001424877 0.000958674</pre>
<p>
The first two fields show the date (Modified Julian Day) and time (seconds and fraction past UTC midnight). The next two fields show the peer address in dotted&#45;quad notation and status, respectively. The status field is encoded in hex in the format described in Appendix A of the NTP specification RFC 1305. The final four fields show the offset, delay, dispersion and RMS jitter, all in seconds.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">rawstats</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Enables recording of raw&#45;timestamp statistics information. This includes statistics records of all peers of a NTP server and of special signals, where present and configured. Each NTP message received from a peer or clock driver appends a line of the following form to the file generation set named <b class="flag">rawstats</b>:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
50928 2132.543 128.4.1.1 128.4.1.20 3102453281.584327000 3102453281.58622800031 02453332.540806000 3102453332.541458000</pre>
<p>
The first two fields show the date (Modified Julian Day) and time (seconds and fraction past UTC midnight). The next two fields show the remote peer or clock address followed by the local address in dotted&#45;quad notation. The final four fields show the originate, receive, transmit and final NTP timestamps in order. The timestamp values are as received and before processing by the various data smoothing and mitigation algorithms.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">sysstats</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Enables recording of ntpd statistics counters on a periodic basis. Each hour a line of the following form is appended to the file generation set named <b class="flag">sysstats</b>:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
50928 2132.543 36000 81965 0 9546 56 71793 512 540 10 147</pre>
<p>
The first two fields show the date (Modified Julian Day) and time (seconds and fraction past UTC midnight). The remaining ten fields show the statistics counter values accumulated since the last generated line.<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
Time since restart <b class="flag">36000</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Time in hours since the system was last rebooted.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
Packets received <b class="flag">81965</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Total number of packets received.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
Packets processed <b class="flag">0</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Number of packets received in response to previous packets sent</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
Current version <b class="flag">9546</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Number of packets matching the current NTP version.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
Previous version <b class="flag">56</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Number of packets matching the previous NTP version.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
Bad version <b class="flag">71793</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Number of packets matching neither NTP version.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
Access denied <b class="flag">512</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Number of packets denied access for any reason.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
Bad length or format <b class="flag">540</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Number of packets with invalid length, format or port number.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
Bad authentication <b class="flag">10</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Number of packets not verified as authentic.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
Rate exceeded <b class="flag">147</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Number of packets discarded due to rate limitation.</dd>
</dl>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">statsdir</b> <i class="arg">directory_path</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Indicates the full path of a directory where statistics files should be created (see below). This keyword allows the (otherwise constant) <b class="flag">filegen</b> filename prefix to be modified for file generation sets, which is useful for handling statistics logs.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">filegen</b> <i class="arg">name</i> &#91;<span class="opt"><b class="flag">file</b> <i class="arg">filename</i></span>&#93; &#91;<span class="opt"><b class="flag">type</b> <i class="arg">typename</i></span>&#93; &#91;<span class="opt"><b class="flag">link</b> | <b class="flag">nolink</b></span>&#93; &#91;<span class="opt"><b class="flag">enable</b> | <b class="flag">disable</b></span>&#93;</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Configures setting of generation file set name. Generation file sets provide a means for handling files that are continuously growing during the lifetime of a server. Server statistics are a typical example for such files. Generation file sets provide access to a set of files used to store the actual data. At any time at most one element of the set is being written to. The type given specifies when and how data will be directed to a new element of the set. This way, information stored in elements of a file set that are currently unused are available for administrational operations without the risk of disturbing the operation of ntpd. (Most important: they can be removed to free space for new data produced.)<p>
Note that this command can be sent from the <a class="link-man" href="../html8/ntpdc.html">ntpdc(8)</a> program running at a remote location.<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">name</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This is the type of the statistics records, as shown in the <b class="flag">statistics</b> command.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">file</b> <i class="arg">filename</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This is the file name for the statistics records. Filenames of set members are built from three concatenated elements <i class="arg">file ...</i> <b class="flag">prefix</b>, <i class="arg">file ...</i> <b class="flag">filename</b> and <i class="arg">file ...</i> <b class="flag">suffix</b>:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">prefix</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This is a constant filename path. It is not subject to modifications via the <i class="arg">filegen</i> option. It is defined by the server, usually specified as a compile&#45;time constant. It may, however, be configurable for individual file generation sets via other commands. For example, the prefix used with <i class="arg">loopstats</i> and <i class="arg">peerstats</i> generation can be configured using the <i class="arg">statsdir</i> option explained above.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">filename</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This string is directly concatenated to the prefix mentioned above (no intervening &#8216;<code class="lit">/</code>&#8217;). This can be modified using the file argument to the <i class="arg">filegen</i> statement. No <i class="file">..</i> elements are allowed in this component to prevent filenames referring to parts outside the filesystem hierarchy denoted by <i class="arg">prefix</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">suffix</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This part is reflects individual elements of a file set. It is generated according to the type of a file set.</dd>
</dl>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">type</b> <i class="arg">typename</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
A file generation set is characterized by its type. The following types are supported:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">none</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The file set is actually a single plain file.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">pid</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
One element of file set is used per incarnation of a ntpd server. This type does not perform any changes to file set members during runtime, however it provides an easy way of separating files belonging to different <a class="link-man" href="../html8/ntpd.html">ntpd(8)</a> server incarnations. The set member filename is built by appending a &#8216;<code class="lit">.</code>&#8217; to concatenated <i class="arg">prefix</i> and <i class="arg">filename</i> strings, and appending the decimal representation of the process ID of the <a class="link-man" href="../html8/ntpd.html">ntpd(8)</a> server process.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">day</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
One file generation set element is created per day. A day is defined as the period between 00:00 and 24:00 UTC. The file set member suffix consists of a &#8216;<code class="lit">.</code>&#8217; and a day specification in the form <b class="flag">YYYYMMdd</b>. <b class="flag">YYYY</b> is a 4&#45;digit year number (e.g., 1992). <b class="flag">MM</b> is a two digit month number. <b class="flag">dd</b> is a two digit day number. Thus, all information written at 10 December 1992 would end up in a file named <i class="arg">prefix</i> <i class="arg">filename</i>.19921210.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">week</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Any file set member contains data related to a certain week of a year. The term week is defined by computing day&#45;of&#45;year modulo 7. Elements of such a file generation set are distinguished by appending the following suffix to the file set filename base: A dot, a 4&#45;digit year number, the letter <b class="flag">W</b>, and a 2&#45;digit week number. For example, information from January, 10th 1992 would end up in a file with suffix .<i class="arg">1992W1</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">month</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
One generation file set element is generated per month. The file name suffix consists of a dot, a 4&#45;digit year number, and a 2&#45;digit month.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">year</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
One generation file element is generated per year. The filename suffix consists of a dot and a 4 digit year number.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">age</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This type of file generation sets changes to a new element of the file set every 24 hours of server operation. The filename suffix consists of a dot, the letter <b class="flag">a</b>, and an 8&#45;digit number. This number is taken to be the number of seconds the server is running at the start of the corresponding 24&#45;hour period. Information is only written to a file generation by specifying <b class="flag">enable</b>; output is prevented by specifying <b class="flag">disable</b>.</dd>
</dl>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">link</b> | <b class="flag">nolink</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
It is convenient to be able to access the current element of a file generation set by a fixed name. This feature is enabled by specifying <b class="flag">link</b> and disabled using <b class="flag">nolink</b>. If link is specified, a hard link from the current file set element to a file without suffix is created. When there is already a file with this name and the number of links of this file is one, it is renamed appending a dot, the letter <b class="flag">C</b>, and the pid of the ntpd server process. When the number of links is greater than one, the file is unlinked. This allows the current file to be accessed by a constant name.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">enable |</b> <b class="flag">disable</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Enables or disables the recording function.</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
</div>
</div>
<div class="section">
<h1 id="x41636365737320436f6e74726f6c20537570706f7274">Access Control Support</h1> The <a class="link-man" href="../html8/ntpd.html">ntpd(8)</a> daemon implements a general purpose address/mask based restriction list. The list contains address/match entries sorted first by increasing address values and and then by increasing mask values. A match occurs when the bitwise AND of the mask and the packet source address is equal to the bitwise AND of the mask and address in the list. The list is searched in order with the last match found defining the restriction flags associated with the entry. Additional information and examples can be found in the &#8220;Notes on Configuring NTP and Setting up a NTP Subnet&#8221; page (available as part of the HTML documentation provided in <i class="file">/usr/share/doc/ntp</i>).<p>
The restriction facility was implemented in conformance with the access policies for the original NSFnet backbone time servers. Later the facility was expanded to deflect cryptographic and clogging attacks. While this facility may be useful for keeping unwanted or broken or malicious clients from congesting innocent servers, it should not be considered an alternative to the NTP authentication facilities. Source address based restrictions are easily circumvented by a determined cracker.<p>
Clients can be denied service because they are explicitly included in the restrict list created by the restrict command or implicitly as the result of cryptographic or rate limit violations. Cryptographic violations include certificate or identity verification failure; rate limit violations generally result from defective NTP implementations that send packets at abusive rates. Some violations cause denied service only for the offending packet, others cause denied service for a timed period and others cause the denied service for an indefinate period. When a client or network is denied access for an indefinate period, the only way at present to remove the restrictions is by restarting the server.<div class="subsection">
<h2 id="x546865204b6973735c2d6f665c2d4465617468205061636b6574">The Kiss&#45;of&#45;Death Packet</h2> Ordinarily, packets denied service are simply dropped with no further action except incrementing statistics counters. Sometimes a more proactive response is needed, such as a server message that explicitly requests the client to stop sending and leave a message for the system operator. A special packet format has been created for this purpose called the "kiss&#45;of&#45;death" (KoD) packet. KoD packets have the leap bits set unsynchronized and stratum set to zero and the reference identifier field set to a four&#45;byte ASCII code. If the <b class="flag">noserve</b> or <b class="flag">notrust</b> flag of the matching restrict list entry is set, the code is "DENY"; if the <b class="flag">limited</b> flag is set and the rate limit is exceeded, the code is "RATE". Finally, if a cryptographic violation occurs, the code is "CRYP".<p>
A client receiving a KoD performs a set of sanity checks to minimize security exposure, then updates the stratum and reference identifier peer variables, sets the access denied (TEST4) bit in the peer flash variable and sends a message to the log. As long as the TEST4 bit is set, the client will send no further packets to the server. The only way at present to recover from this condition is to restart the protocol at both the client and server. This happens automatically at the client when the association times out. It will happen at the server only if the server operator cooperates.</div>
<div class="subsection">
<h2 id="x41636365737320436f6e74726f6c20436f6d6d616e6473">Access Control Commands</h2><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">discard</b> &#91;<span class="opt"><b class="flag">average</b> <i class="arg">avg</i></span>&#93; &#91;<span class="opt"><b class="flag">minimum</b> <i class="arg">min</i></span>&#93; &#91;<span class="opt"><b class="flag">monitor</b> <i class="arg">prob</i></span>&#93;</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Set the parameters of the <b class="flag">limited</b> facility which protects the server from client abuse. The <b class="flag">average</b> subcommand specifies the minimum average packet spacing, while the <b class="flag">minimum</b> subcommand specifies the minimum packet spacing. Packets that violate these minima are discarded and a kiss&#45;o'&#45;death packet returned if enabled. The default minimum average and minimum are 5 and 2, respectively. The monitor subcommand specifies the probability of discard for packets that overflow the rate&#45;control window.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">restrict address</b> &#91;<span class="opt"><b class="flag">mask</b> <i class="arg">mask</i></span>&#93; &#91;<span class="opt"><i class="arg">flag ...</i></span>&#93;</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The <i class="arg">address</i> argument expressed in dotted&#45;quad form is the address of a host or network. Alternatively, the <i class="arg">address</i> argument can be a valid host DNS name. The <i class="arg">mask</i> argument expressed in dotted&#45;quad form defaults to <b class="flag">255.255.255.255</b>, meaning that the <i class="arg">address</i> is treated as the address of an individual host. A default entry (address <b class="flag">0.0.0.0</b>, mask <b class="flag">0.0.0.0</b>) is always included and is always the first entry in the list. Note that text string <b class="flag">default</b>, with no mask option, may be used to indicate the default entry. In the current implementation, <b class="flag">flag</b> always restricts access, i.e., an entry with no flags indicates that free access to the server is to be given. The flags are not orthogonal, in that more restrictive flags will often make less restrictive ones redundant. The flags can generally be classed into two categories, those which restrict time service and those which restrict informational queries and attempts to do run&#45;time reconfiguration of the server. One or more of the following flags may be specified:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">ignore</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Deny packets of all kinds, including <a class="link-man" href="../html8/ntpq.html">ntpq(8)</a> and <a class="link-man" href="../html8/ntpdc.html">ntpdc(8)</a> queries.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">kod</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
If this flag is set when an access violation occurs, a kiss&#45;o'&#45;death (KoD) packet is sent. KoD packets are rate limited to no more than one per second. If another KoD packet occurs within one second after the last one, the packet is dropped.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">limited</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Deny service if the packet spacing violates the lower limits specified in the discard command. A history of clients is kept using the monitoring capability of <a class="link-man" href="../html8/ntpd.html">ntpd(8)</a>. Thus, monitoring is always active as long as there is a restriction entry with the <b class="flag">limited</b> flag.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">lowpriotrap</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Declare traps set by matching hosts to be low priority. The number of traps a server can maintain is limited (the current limit is 3). Traps are usually assigned on a first come, first served basis, with later trap requestors being denied service. This flag modifies the assignment algorithm by allowing low priority traps to be overridden by later requests for normal priority traps.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">nomodify</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Deny <a class="link-man" href="../html8/ntpq.html">ntpq(8)</a> and <a class="link-man" href="../html8/ntpdc.html">ntpdc(8)</a> queries which attempt to modify the state of the server (i.e., run time reconfiguration). Queries which return information are permitted.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">noquery</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Deny <a class="link-man" href="../html8/ntpq.html">ntpq(8)</a> and <a class="link-man" href="../html8/ntpdc.html">ntpdc(8)</a> queries. Time service is not affected.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">nopeer</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Deny packets which would result in mobilizing a new association. This includes broadcast and symmetric active packets when a configured association does not exist.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">noserve</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Deny all packets except <a class="link-man" href="../html8/ntpq.html">ntpq(8)</a> and <a class="link-man" href="../html8/ntpdc.html">ntpdc(8)</a> queries.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">notrap</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Decline to provide mode 6 control message trap service to matching hosts. The trap service is a subsystem of the ntpdq control message protocol which is intended for use by remote event logging programs.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">notrust</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Deny service unless the packet is cryptographically authenticated.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">ntpport</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This is actually a match algorithm modifier, rather than a restriction flag. Its presence causes the restriction entry to be matched only if the source port in the packet is the standard NTP UDP port (123). Both <b class="flag">ntpport</b> and <b class="flag">non&#45;ntpport</b> may be specified. The <b class="flag">ntpport</b> is considered more specific and is sorted later in the list.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">version</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Deny packets that do not match the current NTP version.</dd>
</dl>
<p>
Default restriction list entries with the flags ignore, interface, ntpport, for each of the local host's interface addresses are inserted into the table at startup to prevent the server from attempting to synchronize to its own time. A default entry is also always present, though if it is otherwise unconfigured; no flags are associated with the default entry (i.e., everything besides your own NTP server is unrestricted).</dd>
</dl>
</div>
</div>
<div class="section">
<h1 id="x4175746f6d61746963204e545020436f6e66696775726174696f6e204f7074696f6e73">Automatic NTP Configuration Options</h1><div class="subsection">
<h2 id="x4d616e7963617374696e67">Manycasting</h2> Manycasting is a automatic discovery and configuration paradigm new to NTPv4. It is intended as a means for a multicast client to troll the nearby network neighborhood to find cooperating manycast servers, validate them using cryptographic means and evaluate their time values with respect to other servers that might be lurking in the vicinity. The intended result is that each manycast client mobilizes client associations with some number of the "best" of the nearby manycast servers, yet automatically reconfigures to sustain this number of servers should one or another fail.<p>
Note that the manycasting paradigm does not coincide with the anycast paradigm described in RFC&#45;1546, which is designed to find a single server from a clique of servers providing the same service. The manycast paradigm is designed to find a plurality of redundant servers satisfying defined optimality criteria.<p>
Manycasting can be used with either symmetric key or public key cryptography. The public key infrastructure (PKI) offers the best protection against compromised keys and is generally considered stronger, at least with relatively large key sizes. It is implemented using the Autokey protocol and the OpenSSL cryptographic library available from <code class="lit">http://www.openssl.org/</code>. The library can also be used with other NTPv4 modes as well and is highly recommended, especially for broadcast modes.<p>
A persistent manycast client association is configured using the manycastclient command, which is similar to the server command but with a multicast (IPv4 class <b class="flag">D</b> or IPv6 prefix <b class="flag">FF</b>) group address. The IANA has designated IPv4 address 224.1.1.1 and IPv6 address FF05::101 (site local) for NTP. When more servers are needed, it broadcasts manycast client messages to this address at the minimum feasible rate and minimum feasible time&#45;to&#45;live (TTL) hops, depending on how many servers have already been found. There can be as many manycast client associations as different group address, each one serving as a template for a future ephemeral unicast client/server association.<p>
Manycast servers configured with the <b class="cmd">manycastserver</b> command listen on the specified group address for manycast client messages. Note the distinction between manycast client, which actively broadcasts messages, and manycast server, which passively responds to them. If a manycast server is in scope of the current TTL and is itself synchronized to a valid source and operating at a stratum level equal to or lower than the manycast client, it replies to the manycast client message with an ordinary unicast server message.<p>
The manycast client receiving this message mobilizes an ephemeral client/server association according to the matching manycast client template, but only if cryptographically authenticated and the server stratum is less than or equal to the client stratum. Authentication is explicitly required and either symmetric key or public key (Autokey) can be used. Then, the client polls the server at its unicast address in burst mode in order to reliably set the host clock and validate the source. This normally results in a volley of eight client/server at 2&#45;s intervals during which both the synchronization and cryptographic protocols run concurrently. Following the volley, the client runs the NTP intersection and clustering algorithms, which act to discard all but the "best" associations according to stratum and synchronization distance. The surviving associations then continue in ordinary client/server mode.<p>
The manycast client polling strategy is designed to reduce as much as possible the volume of manycast client messages and the effects of implosion due to near&#45;simultaneous arrival of manycast server messages. The strategy is determined by the <b class="cmd">manycastclient</b>, <b class="cmd">tos</b> and <b class="cmd">ttl</b> configuration commands. The manycast poll interval is normally eight times the system poll interval, which starts out at the <b class="flag">minpoll</b> value specified in the <b class="cmd">manycastclient</b>, command and, under normal circumstances, increments to the <b class="flag">maxpolll</b> value specified in this command. Initially, the TTL is set at the minimum hops specified by the ttl command. At each retransmission the TTL is increased until reaching the maximum hops specified by this command or a sufficient number client associations have been found. Further retransmissions use the same TTL.<p>
The quality and reliability of the suite of associations discovered by the manycast client is determined by the NTP mitigation algorithms and the <b class="flag">minclock</b> and <b class="flag">minsane</b> values specified in the <b class="cmd">tos</b> configuration command. At least <b class="flag">minsane</b> candidate servers must be available and the mitigation algorithms produce at least <b class="flag">minclock</b> survivors in order to synchronize the clock. Byzantine agreement principles require at least four candidates in order to correctly discard a single falseticker. For legacy purposes, <b class="flag">minsane</b> defaults to 1 and <b class="flag">minclock</b> defaults to 3. For manycast service <b class="flag">minsane</b> should be explicitly set to 4, assuming at least that number of servers are available.<p>
If at least <b class="flag">minclock</b> servers are found, the manycast poll interval is immediately set to eight times <b class="flag">maxpoll</b>. If less than <b class="flag">minclock</b> servers are found when the TTL has reached the maximum hops, the manycast poll interval is doubled. For each transmission after that, the poll interval is doubled again until reaching the maximum of eight times <b class="flag">maxpoll</b>. Further transmissions use the same poll interval and TTL values. Note that while all this is going on, each client/server association found is operating normally it the system poll interval.<p>
Administratively scoped multicast boundaries are normally specified by the network router configuration and, in the case of IPv6, the link/site scope prefix. By default, the increment for TTL hops is 32 starting from 31; however, the <b class="cmd">ttl</b> configuration command can be used to modify the values to match the scope rules.<p>
It is often useful to narrow the range of acceptable servers which can be found by manycast client associations. Because manycast servers respond only when the client stratum is equal to or greater than the server stratum, primary (stratum 1) servers fill find only primary servers in TTL range, which is probably the most common objective. However, unless configured otherwise, all manycast clients in TTL range will eventually find all primary servers in TTL range, which is probably not the most common objective in large networks. The <b class="cmd">tos</b> command can be used to modify this behavior. Servers with stratum below <b class="flag">floor</b> or above <b class="flag">ceiling</b> specified in the <b class="cmd">tos</b> command are strongly discouraged during the selection process; however, these servers may be temporally accepted if the number of servers within TTL range is less than <b class="flag">minclock</b>.<p>
The above actions occur for each manycast client message, which repeats at the designated poll interval. However, once the ephemeral client association is mobilized, subsequent manycast server replies are discarded, since that would result in a duplicate association. If during a poll interval the number of client associations falls below <b class="flag">minclock</b>, all manycast client prototype associations are reset to the initial poll interval and TTL hops and operation resumes from the beginning. It is important to avoid frequent manycast client messages, since each one requires all manycast servers in TTL range to respond. The result could well be an implosion, either minor or major, depending on the number of servers in range. The recommended value for <b class="flag">maxpoll</b> is 12 (4,096 s).<p>
It is possible and frequently useful to configure a host as both manycast client and manycast server. A number of hosts configured this way and sharing a common group address will automatically organize themselves in an optimum configuration based on stratum and synchronization distance. For example, consider an NTP subnet of two primary servers and a hundred or more dependent clients. With two exceptions, all servers and clients have identical configuration files including both <b class="cmd">multicastclient</b> and <b class="cmd">multicastserver</b> commands using, for instance, multicast group address 239.1.1.1. The only exception is that each primary server configuration file must include commands for the primary reference source such as a GPS receiver.<p>
The remaining configuration files for all secondary servers and clients have the same contents, except for the <b class="cmd">tos</b> command, which is specific for each stratum level. For stratum 1 and stratum 2 servers, that command is not necessary. For stratum 3 and above servers the <b class="flag">floor</b> value is set to the intended stratum number. Thus, all stratum 3 configuration files are identical, all stratum 4 files are identical and so forth.<p>
Once operations have stabilized in this scenario, the primary servers will find the primary reference source and each other, since they both operate at the same stratum (1), but not with any secondary server or client, since these operate at a higher stratum. The secondary servers will find the servers at the same stratum level. If one of the primary servers loses its GPS receiver, it will continue to operate as a client and other clients will time out the corresponding association and re&#45;associate accordingly.<p>
Some administrators prefer to avoid running <a class="link-man" href="../html8/ntpd.html">ntpd(8)</a> continuously and run either <a class="link-man" href="../html8/ntpdate.html">ntpdate(8)</a> or <a class="link-man" href="../html8/ntpd.html">ntpd(8)</a> <b class="flag">&#45;q</b> as a cron job. In either case the servers must be configured in advance and the program fails if none are available when the cron job runs. A really slick application of manycast is with <a class="link-man" href="../html8/ntpd.html">ntpd(8)</a> <b class="flag">&#45;q</b>. The program wakes up, scans the local landscape looking for the usual suspects, selects the best from among the rascals, sets the clock and then departs. Servers do not have to be configured in advance and all clients throughout the network can have the same configuration file.</div>
<div class="subsection">
<h2 id="x4d616e796361737420496e746572616374696f6e732077697468204175746f6b6579">Manycast Interactions with Autokey</h2> Each time a manycast client sends a client mode packet to a multicast group address, all manycast servers in scope generate a reply including the host name and status word. The manycast clients then run the Autokey protocol, which collects and verifies all certificates involved. Following the burst interval all but three survivors are cast off, but the certificates remain in the local cache. It often happens that several complete signing trails from the client to the primary servers are collected in this way.<p>
About once an hour or less often if the poll interval exceeds this, the client regenerates the Autokey key list. This is in general transparent in client/server mode. However, about once per day the server private value used to generate cookies is refreshed along with all manycast client associations. In this case all cryptographic values including certificates is refreshed. If a new certificate has been generated since the last refresh epoch, it will automatically revoke all prior certificates that happen to be in the certificate cache. At the same time, the manycast scheme starts all over from the beginning and the expanding ring shrinks to the minimum and increments from there while collecting all servers in scope.</div>
<div class="subsection">
<h2 id="x4d616e7963617374204f7074696f6e73">Manycast Options</h2><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">tos</b> &#91;<span class="opt"><b class="flag">ceiling</b> <i class="arg">ceiling</i> | <b class="flag">cohort { 0</b> | <b class="flag">1 }</b> | <b class="flag">floor</b> <i class="arg">floor</i> | <b class="flag">minclock</b> <i class="arg">minclock</i> | <b class="flag">minsane</b> <i class="arg">minsane</i></span>&#93;</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This command affects the clock selection and clustering algorithms. It can be used to select the quality and quantity of peers used to synchronize the system clock and is most useful in manycast mode. The variables operate as follows:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">ceiling</b> <i class="arg">ceiling</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Peers with strata above <b class="flag">ceiling</b> will be discarded if there are at least <b class="flag">minclock</b> peers remaining. This value defaults to 15, but can be changed to any number from 1 to 15.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">cohort</b> &#123;0 | 1&#125;</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This is a binary flag which enables (0) or disables (1) manycast server replies to manycast clients with the same stratum level. This is useful to reduce implosions where large numbers of clients with the same stratum level are present. The default is to enable these replies.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">floor</b> <i class="arg">floor</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Peers with strata below <b class="flag">floor</b> will be discarded if there are at least <b class="flag">minclock</b> peers remaining. This value defaults to 1, but can be changed to any number from 1 to 15.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">minclock</b> <i class="arg">minclock</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The clustering algorithm repeatedly casts out outlyer associations until no more than <b class="flag">minclock</b> associations remain. This value defaults to 3, but can be changed to any number from 1 to the number of configured sources.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">minsane</b> <i class="arg">minsane</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This is the minimum number of candidates available to the clock selection algorithm in order to produce one or more truechimers for the clustering algorithm. If fewer than this number are available, the clock is undisciplined and allowed to run free. The default is 1 for legacy purposes. However, according to principles of Byzantine agreement, <b class="flag">minsane</b> should be at least 4 in order to detect and discard a single falseticker.</dd>
</dl>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">ttl</b> <i class="arg">hop ...</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This command specifies a list of TTL values in increasing order, up to 8 values can be specified. In manycast mode these values are used in turn in an expanding&#45;ring search. The default is eight multiples of 32 starting at 31.</dd>
</dl>
</div>
</div>
<div class="section">
<h1 id="x5265666572656e636520436c6f636b20537570706f7274">Reference Clock Support</h1> The NTP Version 4 daemon supports some three dozen different radio, satellite and modem reference clocks plus a special pseudo&#45;clock used for backup or when no other clock source is available. Detailed descriptions of individual device drivers and options can be found in the &#8220;Reference Clock Drivers&#8221; page (available as part of the HTML documentation provided in <i class="file">/usr/share/doc/ntp</i>). Additional information can be found in the pages linked there, including the &#8220;Debugging Hints for Reference Clock Drivers&#8221; and &#8220;How To Write a Reference Clock Driver&#8221; pages (available as part of the HTML documentation provided in <i class="file">/usr/share/doc/ntp</i>). In addition, support for a PPS signal is available as described in the &#8220;Pulse&#45;per&#45;second (PPS) Signal Interfacing&#8221; page (available as part of the HTML documentation provided in <i class="file">/usr/share/doc/ntp</i>). Many drivers support special line discipline/streams modules which can significantly improve the accuracy using the driver. These are described in the &#8220;Line Disciplines and Streams Drivers&#8221; page (available as part of the HTML documentation provided in <i class="file">/usr/share/doc/ntp</i>).<p>
A reference clock will generally (though not always) be a radio timecode receiver which is synchronized to a source of standard time such as the services offered by the NRC in Canada and NIST and USNO in the US. The interface between the computer and the timecode receiver is device dependent, but is usually a serial port. A device driver specific to each reference clock must be selected and compiled in the distribution; however, most common radio, satellite and modem clocks are included by default. Note that an attempt to configure a reference clock when the driver has not been compiled or the hardware port has not been appropriately configured results in a scalding remark to the system log file, but is otherwise non hazardous.<p>
For the purposes of configuration, <a class="link-man" href="../html8/ntpd.html">ntpd(8)</a> treats reference clocks in a manner analogous to normal NTP peers as much as possible. Reference clocks are identified by a syntactically correct but invalid IP address, in order to distinguish them from normal NTP peers. Reference clock addresses are of the form <code class="lit">127.127.</code><i class="arg">t</i>.<i class="arg">u</i>, where <i class="arg">t</i> is an integer denoting the clock type and <i class="arg">u</i> indicates the unit number in the range 0&#45;3. While it may seem overkill, it is in fact sometimes useful to configure multiple reference clocks of the same type, in which case the unit numbers must be unique.<p>
The <b class="cmd">server</b> command is used to configure a reference clock, where the <i class="arg">address</i> argument in that command is the clock address. The <b class="flag">key</b>, <b class="flag">version</b> and <b class="flag">ttl</b> options are not used for reference clock support. The <b class="flag">mode</b> option is added for reference clock support, as described below. The <b class="flag">prefer</b> option can be useful to persuade the server to cherish a reference clock with somewhat more enthusiasm than other reference clocks or peers. Further information on this option can be found in the &#8220;Mitigation Rules and the prefer Keyword&#8221; (available as part of the HTML documentation provided in <i class="file">/usr/share/doc/ntp</i>) page. The <b class="flag">minpoll</b> and <b class="flag">maxpoll</b> options have meaning only for selected clock drivers. See the individual clock driver document pages for additional information.<p>
The <b class="cmd">fudge</b> command is used to provide additional information for individual clock drivers and normally follows immediately after the <b class="cmd">server</b> command. The <i class="arg">address</i> argument specifies the clock address. The <b class="flag">refid</b> and <b class="flag">stratum</b> options can be used to override the defaults for the device. There are two optional device&#45;dependent time offsets and four flags that can be included in the <b class="cmd">fudge</b> command as well.<p>
The stratum number of a reference clock is by default zero. Since the <a class="link-man" href="../html8/ntpd.html">ntpd(8)</a> daemon adds one to the stratum of each peer, a primary server ordinarily displays an external stratum of one. In order to provide engineered backups, it is often useful to specify the reference clock stratum as greater than zero. The <b class="flag">stratum</b> option is used for this purpose. Also, in cases involving both a reference clock and a pulse&#45;per&#45;second (PPS) discipline signal, it is useful to specify the reference clock identifier as other than the default, depending on the driver. The <b class="flag">refid</b> option is used for this purpose. Except where noted, these options apply to all clock drivers.<div class="subsection">
<h2 id="x5265666572656e636520436c6f636b20436f6d6d616e6473">Reference Clock Commands</h2><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">server</b> <code class="lit">127.127.</code><i class="arg">t</i>.<i class="arg">u</i> &#91;<span class="opt"><b class="flag">prefer</b></span>&#93; &#91;<span class="opt"><b class="flag">mode</b> <i class="arg">int</i></span>&#93; &#91;<span class="opt"><b class="flag">minpoll</b> <i class="arg">int</i></span>&#93; &#91;<span class="opt"><b class="flag">maxpoll</b> <i class="arg">int</i></span>&#93;</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This command can be used to configure reference clocks in special ways. The options are interpreted as follows:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">prefer</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Marks the reference clock as preferred. All other things being equal, this host will be chosen for synchronization among a set of correctly operating hosts. See the &#8220;Mitigation Rules and the prefer Keyword&#8221; page (available as part of the HTML documentation provided in <i class="file">/usr/share/doc/ntp</i>) for further information.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">mode</b> <i class="arg">int</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Specifies a mode number which is interpreted in a device&#45;specific fashion. For instance, it selects a dialing protocol in the ACTS driver and a device subtype in the parse drivers.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">minpoll</b> <i class="arg">int</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">maxpoll</b> <i class="arg">int</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
These options specify the minimum and maximum polling interval for reference clock messages, as a power of 2 in seconds For most directly connected reference clocks, both <b class="flag">minpoll</b> and <b class="flag">maxpoll</b> default to 6 (64 s). For modem reference clocks, <b class="flag">minpoll</b> defaults to 10 (17.1 m) and <b class="flag">maxpoll</b> defaults to 14 (4.5 h). The allowable range is 4 (16 s) to 17 (36.4 h) inclusive.</dd>
</dl>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">fudge</b> <code class="lit">127.127.</code><i class="arg">t</i>.<i class="arg">u</i> &#91;<span class="opt"><b class="flag">time1</b> <i class="arg">sec</i></span>&#93; &#91;<span class="opt"><b class="flag">time2</b> <i class="arg">sec</i></span>&#93; &#91;<span class="opt"><b class="flag">stratum</b> <i class="arg">int</i></span>&#93; &#91;<span class="opt"><b class="flag">refid</b> <i class="arg">string</i></span>&#93; &#91;<span class="opt"><b class="flag">mode</b> <i class="arg">int</i></span>&#93; &#91;<span class="opt"><b class="flag">flag1</b> <b class="flag">0 |</b> <b class="flag">1</b></span>&#93; &#91;<span class="opt"><b class="flag">flag2</b> <b class="flag">0 |</b> <b class="flag">1</b></span>&#93; &#91;<span class="opt"><b class="flag">flag3</b> <b class="flag">0 |</b> <b class="flag">1</b></span>&#93; &#91;<span class="opt"><b class="flag">flag4</b> <b class="flag">0 |</b> <b class="flag">1</b></span>&#93;</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This command can be used to configure reference clocks in special ways. It must immediately follow the <b class="cmd">server</b> command which configures the driver. Note that the same capability is possible at run time using the <a class="link-man" href="../html8/ntpdc.html">ntpdc(8)</a> program. The options are interpreted as follows:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">time1</b> <i class="arg">sec</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Specifies a constant to be added to the time offset produced by the driver, a fixed&#45;point decimal number in seconds. This is used as a calibration constant to adjust the nominal time offset of a particular clock to agree with an external standard, such as a precision PPS signal. It also provides a way to correct a systematic error or bias due to serial port or operating system latencies, different cable lengths or receiver internal delay. The specified offset is in addition to the propagation delay provided by other means, such as internal DIPswitches. Where a calibration for an individual system and driver is available, an approximate correction is noted in the driver documentation pages. Note: in order to facilitate calibration when more than one radio clock or PPS signal is supported, a special calibration feature is available. It takes the form of an argument to the <b class="cmd">enable</b> command described in <i class="link-sec"><a class="link-sec" href="#x4d697363656c6c616e656f7573204f7074696f6e73">Miscellaneous Options</a></i> page and operates as described in the &#8220;Reference Clock Drivers&#8221; page (available as part of the HTML documentation provided in <i class="file">/usr/share/doc/ntp</i>).</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">time2</b> <i class="arg">secs</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Specifies a fixed&#45;point decimal number in seconds, which is interpreted in a driver&#45;dependent way. See the descriptions of specific drivers in the &#8220;Reference Clock Drivers&#8221; page (available as part of the HTML documentation provided in <i class="file">/usr/share/doc/ntp</i>).</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">stratum</b> <i class="arg">int</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Specifies the stratum number assigned to the driver, an integer between 0 and 15. This number overrides the default stratum number ordinarily assigned by the driver itself, usually zero.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">refid</b> <i class="arg">string</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Specifies an ASCII string of from one to four characters which defines the reference identifier used by the driver. This string overrides the default identifier ordinarily assigned by the driver itself.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">mode</b> <i class="arg">int</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Specifies a mode number which is interpreted in a device&#45;specific fashion. For instance, it selects a dialing protocol in the ACTS driver and a device subtype in the parse drivers.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">flag1</b> <b class="flag">0 |</b> <b class="flag">1</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">flag2</b> <b class="flag">0 |</b> <b class="flag">1</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">flag3</b> <b class="flag">0 |</b> <b class="flag">1</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">flag4</b> <b class="flag">0 |</b> <b class="flag">1</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
These four flags are used for customizing the clock driver. The interpretation of these values, and whether they are used at all, is a function of the particular clock driver. However, by convention <b class="flag">flag4</b> is used to enable recording monitoring data to the <b class="flag">clockstats</b> file configured with the <b class="cmd">filegen</b> command. Further information on the <b class="cmd">filegen</b> command can be found in <i class="link-sec"><a class="link-sec" href="#x4d6f6e69746f72696e67204f7074696f6e73">Monitoring Options</a></i>.</dd>
</dl>
</dd>
</dl>
</div>
</div>
<div class="section">
<h1 id="x4d697363656c6c616e656f7573204f7074696f6e73">Miscellaneous Options</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">broadcastdelay</b> <i class="arg">seconds</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The broadcast and multicast modes require a special calibration to determine the network delay between the local and remote servers. Ordinarily, this is done automatically by the initial protocol exchanges between the client and server. In some cases, the calibration procedure may fail due to network or server access controls, for example. This command specifies the default delay to be used under these circumstances. Typically (for Ethernet), a number between 0.003 and 0.007 seconds is appropriate. The default when this command is not used is 0.004 seconds.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">calldelay</b> <i class="arg">delay</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This option controls the delay in seconds between the first and second packets sent in burst or iburst mode to allow additional time for a modem or ISDN call to complete.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">driftfile</b> <i class="arg">driftfile</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This command specifies the complete path and name of the file used to record the frequency of the local clock oscillator. This is the same operation as the <b class="flag">&#45;f</b> command line option. If the file exists, it is read at startup in order to set the initial frequency and then updated once per hour with the current frequency computed by the daemon. If the file name is specified, but the file itself does not exist, the starts with an initial frequency of zero and creates the file when writing it for the first time. If this command is not given, the daemon will always start with an initial frequency of zero.<p>
The file format consists of a single line containing a single floating point number, which records the frequency offset measured in parts&#45;per&#45;million (PPM). The file is updated by first writing the current drift value into a temporary file and then renaming this file to replace the old version. This implies that <a class="link-man" href="../html8/ntpd.html">ntpd(8)</a> must have write permission for the directory the drift file is located in, and that file system links, symbolic or otherwise, should be avoided.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">enable</b> &#91;<span class="opt"><b class="flag">auth</b> | <b class="flag">bclient</b> | <b class="flag">calibrate</b> | <b class="flag">kernel</b> | <b class="flag">monitor</b> | <b class="flag">ntp</b> | <b class="flag">pps</b> | <b class="flag">stats</b></span>&#93;</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">disable</b> &#91;<span class="opt"><b class="flag">auth</b> | <b class="flag">bclient</b> | <b class="flag">calibrate</b> | <b class="flag">kernel</b> | <b class="flag">monitor</b> | <b class="flag">ntp</b> | <b class="flag">pps</b> | <b class="flag">stats</b></span>&#93;</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Provides a way to enable or disable various server options. Flags not mentioned are unaffected. Note that all of these flags can be controlled remotely using the <a class="link-man" href="../html8/ntpdc.html">ntpdc(8)</a> utility program.<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">auth</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Enables the server to synchronize with unconfigured peers only if the peer has been correctly authenticated using either public key or private key cryptography. The default for this flag is <b class="cmd">enable</b>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">bclient</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Enables the server to listen for a message from a broadcast or multicast server, as in the <b class="cmd">multicastclient</b> command with default address. The default for this flag is <b class="cmd">disable</b>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">calibrate</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Enables the calibrate feature for reference clocks. The default for this flag is <b class="cmd">disable</b>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">kernel</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Enables the kernel time discipline, if available. The default for this flag is <b class="cmd">enable</b> if support is available, otherwise <b class="cmd">disable</b>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">monitor</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Enables the monitoring facility. See the <a class="link-man" href="../html8/ntpdc.html">ntpdc(8)</a> program and the <b class="cmd">monlist</b> command or further information. The default for this flag is <b class="cmd">enable</b>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">ntp</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Enables time and frequency discipline. In effect, this switch opens and closes the feedback loop, which is useful for testing. The default for this flag is <b class="cmd">enable</b>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">pps</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Enables the pulse&#45;per&#45;second (PPS) signal when frequency and time is disciplined by the precision time kernel modifications. See the &#8220;A Kernel Model for Precision Timekeeping&#8221; (available as part of the HTML documentation provided in <i class="file">/usr/share/doc/ntp</i>) page for further information. The default for this flag is <b class="cmd">disable</b>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">stats</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Enables the statistics facility. See the <i class="link-sec"><a class="link-sec" href="#x4d6f6e69746f72696e67204f7074696f6e73">Monitoring Options</a></i> section for further information. The default for this flag is <b class="cmd">disable</b>.</dd>
</dl>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">includefile</b> <i class="arg">includefile</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This command allows additional configuration commands to be included from a separate file. Include files may be nested to a depth of five; upon reaching the end of any include file, command processing resumes in the previous configuration file. This option is useful for sites that run <a class="link-man" href="../html8/ntpd.html">ntpd(8)</a> on multiple hosts, with (mostly) common options (e.g., a restriction list).</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">logconfig</b> <i class="arg">configkeyword</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This command controls the amount and type of output written to the system <a class="link-man" href="../html3/syslog.html">syslog(3)</a> facility or the alternate <b class="cmd">logfile</b> log file. By default, all output is turned on. All <i class="arg">configkeyword</i> keywords can be prefixed with &#8216;<code class="lit">=</code>&#8217;, &#8216;<code class="lit">+</code>&#8217; and &#8216;<code class="lit">&#45;</code>&#8217;, where &#8216;<code class="lit">=</code>&#8217; sets the <a class="link-man" href="../html3/syslog.html">syslog(3)</a> priority mask, &#8216;<code class="lit">+</code>&#8217; adds and &#8216;<code class="lit">&#45;</code>&#8217; removes messages. <a class="link-man" href="../html3/syslog.html">syslog(3)</a> messages can be controlled in four classes (<b class="flag">clock</b>, <b class="flag">peer</b>, <b class="flag">sys</b> and <b class="flag">sync</b>). Within these classes four types of messages can be controlled: informational messages (<b class="flag">info</b>), event messages (<b class="flag">events</b>), statistics messages (<b class="flag">statistics</b>) and status messages (<b class="flag">status</b>).<p>
Configuration keywords are formed by concatenating the message class with the event class. The <b class="flag">all</b> prefix can be used instead of a message class. A message class may also be followed by the <b class="flag">all</b> keyword to enable/disable all messages of the respective message class.Thus, a minimal log configuration could look like this:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
logconfig =syncstatus +sysevents</pre>
<p>
This would just list the synchronizations state of <a class="link-man" href="../html8/ntpd.html">ntpd(8)</a> and the major system events. For a simple reference server, the following minimum message configuration could be useful:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
logconfig =syncall +clockall</pre>
<p>
This configuration will list all clock information and synchronization information. All other events and messages about peers, system events and so on is suppressed.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">logfile</b> <i class="arg">logfile</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This command specifies the location of an alternate log file to be used instead of the default system <a class="link-man" href="../html3/syslog.html">syslog(3)</a> facility. This is the same operation as the &#45;l command line option.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">setvar</b> <i class="arg">variable</i> &#91;<span class="opt"><b class="flag">default</b></span>&#93;</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This command adds an additional system variable. These variables can be used to distribute additional information such as the access policy. If the variable of the form <b class="var">name=</b><i class="arg">value</i> is followed by the <b class="flag">default</b> keyword, the variable will be listed as part of the default system variables (<a class="link-man" href="../html8/ntpq.html">ntpq(8)</a> <b class="cmd">rv</b> command)). These additional variables serve informational purposes only. They are not related to the protocol other that they can be listed. The known protocol variables will always override any variables defined via the <b class="cmd">setvar</b> mechanism. There are three special variables that contain the names of all variable of the same group. The <b class="var">sys_var_list</b> holds the names of all system variables. The <b class="var">peer_var_list</b> holds the names of all peer variables and the <b class="var">clock_var_list</b> holds the names of the reference clock variables.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">tinker</b> &#91;<span class="opt"><b class="flag">allan</b> <i class="arg">allan</i> | <b class="flag">dispersion</b> <i class="arg">dispersion</i> | <b class="flag">freq</b> <i class="arg">freq</i> | <b class="flag">huffpuff</b> <i class="arg">huffpuff</i> | <b class="flag">panic</b> <i class="arg">panic</i> | <b class="flag">step</b> <i class="arg">srep</i> | <b class="flag">stepout</b> <i class="arg">stepout</i></span>&#93;</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This command can be used to alter several system variables in very exceptional circumstances. It should occur in the configuration file before any other configuration options. The default values of these variables have been carefully optimized for a wide range of network speeds and reliability expectations. In general, they interact in intricate ways that are hard to predict and some combinations can result in some very nasty behavior. Very rarely is it necessary to change the default values; but, some folks cannot resist twisting the knobs anyway and this command is for them. Emphasis added: twisters are on their own and can expect no help from the support group.<p>
The variables operate as follows:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">allan</b> <i class="arg">allan</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The argument becomes the new value for the minimum Allan intercept, which is a parameter of the PLL/FLL clock discipline algorithm. The value in log2 seconds defaults to 7 (1024 s), which is also the lower limit.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">dispersion</b> <i class="arg">dispersion</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The argument becomes the new value for the dispersion increase rate, normally .000015 s/s.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">freq</b> <i class="arg">freq</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The argument becomes the initial value of the frequency offset in parts&#45;per&#45;million. This overrides the value in the frequency file, if present, and avoids the initial training state if it is not.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">huffpuff</b> <i class="arg">huffpuff</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The argument becomes the new value for the experimental huff&#45;n'&#45;puff filter span, which determines the most recent interval the algorithm will search for a minimum delay. The lower limit is 900 s (15 m), but a more reasonable value is 7200 (2 hours). There is no default, since the filter is not enabled unless this command is given.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">panic</b> <i class="arg">panic</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The argument is the panic threshold, normally 1000 s. If set to zero, the panic sanity check is disabled and a clock offset of any value will be accepted.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">step</b> <i class="arg">step</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The argument is the step threshold, which by default is 0.128 s. It can be set to any positive number in seconds. If set to zero, step adjustments will never occur. Note: The kernel time discipline is disabled if the step threshold is set to zero or greater than the default.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">stepout</b> <i class="arg">stepout</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The argument is the stepout timeout, which by default is 900 s. It can be set to any positive number in seconds. If set to zero, the stepout pulses will not be suppressed.</dd>
</dl>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">rlimit</b> &#91;<span class="opt"><b class="flag">memlock</b> <i class="arg">Nmegabytes</i> | <b class="flag">stacksize</b> <i class="arg">N4kPages</i> <b class="flag">filenum</b> <i class="arg">Nfiledescriptors</i></span>&#93;</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">memlock</b> <i class="arg">Nmegabytes</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Specify the number of megabytes of memory that can be allocated. Probably only available under Linux, this option is useful when dropping root (the <b class="flag">&#45;i</b> option). The default is 32 megabytes. Setting this to zero will prevent any attemp to lock memory.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">stacksize</b> <i class="arg">N4kPages</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Specifies the maximum size of the process stack on systems with the</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">filenum</b> <i class="arg">Nfiledescriptors</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Specifies the maximum number of file descriptors ntpd may have open at once. Defaults to the system default. <b class="fname">mlockall</b>() function. Defaults to 50 4k pages (200 4k pages in OpenBSD).</dd>
</dl>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">trap</b> <i class="arg">host_address</i> &#91;<span class="opt"><b class="flag">port</b> <i class="arg">port_number</i></span>&#93; &#91;<span class="opt"><b class="flag">interface</b> <i class="arg">interface_address</i></span>&#93;</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This command configures a trap receiver at the given host address and port number for sending messages with the specified local interface address. If the port number is unspecified, a value of 18447 is used. If the interface address is not specified, the message is sent with a source address of the local interface the message is sent through. Note that on a multihomed host the interface used may vary from time to time with routing changes.<p>
The trap receiver will generally log event messages and other information from the server in a log file. While such monitor programs may also request their own trap dynamically, configuring a trap receiver will ensure that no messages are lost when the server is started.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">hop</b> <i class="arg">...</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This command specifies a list of TTL values in increasing order, up to 8 values can be specified. In manycast mode these values are used in turn in an expanding&#45;ring search. The default is eight multiples of 32 starting at 31.</dd>
</dl>
</div>
<div class="section">
<h1 id="x4f5054494f4e53">OPTIONS</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;&#45;help</b></dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
Display usage information and exit.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;&#45;more&#45;help</b></dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
Pass the extended usage information through a pager.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;&#45;version</b> &#91;<span class="opt">&#123;<i class="arg">v|c|n</i>&#125;</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
Output version of program and exit.  The default mode is `v', a simple version.  The `c' mode will print copyright information and `n' will print the full copyright notice.</dd>
</dl>
</div>
<div class="section">
<h1 id="x4f5054494f4e2050524553455453">OPTION PRESETS</h1> Any option that is not marked as  <i>not presettable</i> may be preset by loading values from environment variables named:<br>
  <b>NTP_CONF_&lt;option&#45;name&gt;</b> or <b>NTP_CONF</b> cvt_prog='/usr/local/gnu/share/autogen/texi2mdoc' cvt_prog=`cd &#768;dirname "$cvt_prog"&#768; &gt;/dev/null &amp;&amp; pwd<br>
         `/`basename "$cvt_prog"` cd $tmp_dir test &#45;x "$cvt_prog" || die "'$cvt_prog' is not executable" {<br>
    list='synopsis description options option&#45;presets'<br>
    for f in $list ; do cat $f ; echo ; done<br>
    rm &#45;f $list name<br>
    list='implementation&#45;notes environment files examples exit&#45;status errors<br>
        compatibility see&#45;also conforming&#45;to history authors copyright bugs<br>
        notes'<br>
    for f in $list ; do cat $f ; echo ; done &gt; .end&#45;doc<br>
    rm &#45;f $list<br>
    list=`ls &#45;1 *`' .end&#45;doc'<br>
    for f in $list ; do cat $f ; echo ; done<br>
    rm &#45;f $list } 1&gt;.doc 2&gt;/dev/null sed &#45;f .cmds .doc | /usr/local/gnu/bin/grep &#45;E &#45;v '^[ 	]*$' | $cvt_prog</div>
<div class="section">
<h1 id="x454e5649524f4e4d454e54">ENVIRONMENT</h1> See  <b>OPTION PRESETS</b> for configuration environment variables.</div>
<div class="section">
<h1 id="x46494c4553">FILES</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/etc/ntp.conf</i></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
the default name of the configuration file</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">ntp.keys</i></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
private MD5 keys</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">ntpkey</i></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
RSA private key</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">ntpkey_</i><i class="arg">host</i></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
RSA public key</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">ntp_dh</i></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Diffie&#45;Hellman agreement parameters</dd>
</dl>
</div>
<div class="section">
<h1 id="x4558495420535441545553">EXIT STATUS</h1> One of the following exit values will be returned:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
0  (EXIT_SUCCESS)</dt>
<dd class="list-tag" style="margin-left: 18.00ex;">
Successful program execution.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
1  (EXIT_FAILURE)</dt>
<dd class="list-tag" style="margin-left: 18.00ex;">
The operation failed or the command syntax was not valid.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
70  (EX_SOFTWARE)</dt>
<dd class="list-tag" style="margin-left: 18.00ex;">
libopts had an internal operational error.  Please report it to autogen&#45;users@lists.sourceforge.net.  Thank you.</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html8/ntpd.html">ntpd(8)</a>, <a class="link-man" href="../html8/ntpdc.html">ntpdc(8)</a>, <a class="link-man" href="../html8/ntpq.html">ntpq(8)</a><p>
In addition to the manual pages provided, comprehensive documentation is available on the world wide web at <code class="lit">http://www.ntp.org/</code>. A snapshot of this documentation is available in HTML format in <i class="file">/usr/share/doc/ntp</i>.<p>
<span class="ref"><span class="ref-auth">David L. Mills</span>, <span class="ref-title">Network Time Protocol (Version 4)</span>, <span class="ref-opt">RFC5905</span>.</span></div>
<div class="section">
<h1 id="x415554484f5253">AUTHORS</h1> The University of Delaware</div>
<div class="section">
<h1 id="x434f50595249474854">COPYRIGHT</h1> Copyright (C) 1970&#45;2013 The University of Delaware all rights reserved. This program is released under the terms of the NTP license, &lt;http://ntp.org/license&gt;.</div>
<div class="section">
<h1 id="x42554753">BUGS</h1> The syntax checking is not picky; some combinations of ridiculous and even hilarious options and modes may not be detected.<p>
The <i class="file">ntpkey_</i><i class="arg">host</i> files are really digital certificates. These should be obtained via secure directory services when they become universally available.<p>
Please send bug reports to: http://bugs.ntp.org, bugs@ntp.org</div>
<div class="section">
<h1 id="x4e4f544553">NOTES</h1> This document corresponds to version 4.2.7p404 of NTP. This document was derived from FreeBSD.<p>
This manual page was <i>AutoGen</i>&#45;erated from the <b>ntp.conf</b> option definitions.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
December 24 2013</td>
<td class="foot-os" align="right">
SunOS 5.10</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

