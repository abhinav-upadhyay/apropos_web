<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="/static/man_pages/netbsd/style.css" type="text/css" media="all">
<title>
VIRTUAL(5)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
VIRTUAL(5)</td>
<td class="head-vol" align="center">
File Formats Manual</td>
<td class="head-rtitle" align="right">
VIRTUAL(5)</td>
</tr>
</tbody>
</table>
<br>
<div class="section">
<h1>NAME</h1> virtual &#45; Postfix virtual alias table format</div>
<div class="section">
<h1>SYNOPSIS</h1><br>
<b>postmap /etc/postfix/virtual</b><p>
<br>
<b>postmap -q "</b><i>string</i><b>" /etc/postfix/virtual</b><p>
<br>
<b>postmap -q - /etc/postfix/virtual &lt;</b><i>inputfile</i></div>
<div class="section">
<h1>DESCRIPTION</h1><br>
The optional <b>virtual</b>(5) alias table rewrites recipient addresses for all local, all virtual, and all remote mail destinations. This is unlike the  <b>aliases</b>(5) table which is used only for  <b>local</b>(8) delivery.  Virtual aliasing is recursive, and is implemented by the Postfix  <b>cleanup</b>(8) daemon before mail is queued.<div style="height: 1.00em;">
&#160;</div>
The main applications of virtual aliasing are:<dl>
<dt>
&#8226;</dt>
<dd>
To redirect mail for one address to one or more addresses.</dd>
</dl>
<dl>
<dt>
&#8226;</dt>
<dd>
To implement virtual alias domains where all addresses are aliased to addresses in other domains.<div style="height: 1.00em;">
&#160;</div>
Virtual alias domains are not to be confused with the virtual mailbox domains that are implemented with the Postfix  <b>virtual</b>(8) mail delivery agent. With virtual mailbox domains, each recipient address can have its own mailbox.</dd>
</dl>
<p>
Virtual aliasing is applied only to recipient envelope addresses, and does not affect message headers. Use  <b>canonical</b>(5) mapping to rewrite header and envelope addresses in general.<div style="height: 1.00em;">
&#160;</div>
Normally, the <b>virtual</b>(5) alias table is specified as a text file that serves as input to the  <b>postmap</b>(1) command. The result, an indexed file in  <b>dbm</b> or <b>db</b> format, is used for fast searching by the mail system. Execute the command " <b>postmap /etc/postfix/virtual</b>" to rebuild an indexed file after changing the corresponding text file.<div style="height: 1.00em;">
&#160;</div>
When the table is provided via other means such as NIS, LDAP or SQL, the same lookups are done as for ordinary indexed files.<div style="height: 1.00em;">
&#160;</div>
Alternatively, the table can be provided as a regular-expression map where patterns are given as regular expressions, or lookups can be directed to TCP-based server. In those case, the lookups are done in a slightly different way as described below under "REGULAR EXPRESSION TABLES" or "TCP-BASED TABLES".</div>
<div class="section">
<h1>CASE FOLDING</h1><br>
The search string is folded to lowercase before database lookup. As of Postfix 2.3, the search string is not case folded with database types such as regexp: or pcre: whose lookup fields can match both upper and lower case.</div>
<div class="section">
<h1>TABLE FORMAT</h1><br>
The input format for the <b>postmap</b>(1) command is as follows:<dl>
<dt>
<i>pattern address, address, ...</i></dt>
<dd>
When <i>pattern</i> matches a mail address, replace it by the corresponding  <i>address</i>.</dd>
</dl>
<dl>
<dt>
blank lines and comments</dt>
<dd>
Empty lines and whitespace-only lines are ignored, as are lines whose first non-whitespace character is a `#'.</dd>
</dl>
<dl>
<dt>
multi-line text</dt>
<dd>
A logical line starts with non-whitespace text. A line that starts with whitespace continues a logical line.</dd>
</dl>
</div>
<div class="section">
<h1>TABLE SEARCH ORDER</h1><br>
With lookups from indexed files such as DB or DBM, or from networked tables such as NIS, LDAP or SQL, patterns are tried in the order as listed below:<dl>
<dt>
<i>user</i>@<i>domain address, address, ...</i></dt>
<dd>
Redirect mail for <i>user</i>@<i>domain</i> to <i>address</i>. This form has the highest precedence.</dd>
</dl>
<dl>
<dt>
<i>user address, address, ...</i></dt>
<dd>
Redirect mail for <i>user</i>@<i>site</i> to <i>address</i> when  <i>site</i> is equal to $<b>myorigin</b>, when <i>site</i> is listed in $ <b>mydestination</b>, or when it is listed in $<b>inet_interfaces</b> or $ <b>proxy_interfaces</b>.<div style="height: 1.00em;">
&#160;</div>
This functionality overlaps with functionality of the local  <i>aliases</i>(5) database. The difference is that <b>virtual</b>(5) mapping can be applied to non-local addresses.</dd>
</dl>
<dl>
<dt>
@<i>domain address, address, ...</i></dt>
<dd>
Redirect mail for other users in <i>domain</i> to <i>address</i>. This form has the lowest precedence.<div style="height: 1.00em;">
&#160;</div>
Note: @<i>domain</i> is a wild-card. With this form, the Postfix SMTP server accepts mail for any recipient in  <i>domain</i>, regardless of whether that recipient exists.  This may turn your mail system into a backscatter source: Postfix first accepts mail for non-existent recipients and then tries to return that mail as "undeliverable" to the often forged sender address.</dd>
</dl>
</div>
<div class="section">
<h1>RESULT ADDRESS REWRITING</h1><br>
The lookup result is subject to address rewriting:<dl>
<dt>
&#8226;</dt>
<dd>
When the result has the form @<i>otherdomain</i>, the result becomes the same  <i>user</i> in <i>otherdomain</i>. This works only for the first address in a multi-address lookup result.</dd>
</dl>
<dl>
<dt>
&#8226;</dt>
<dd>
When "<b>append_at_myorigin=yes</b>", append "<b>@$myorigin</b>" to addresses without "@domain".</dd>
</dl>
<dl>
<dt>
&#8226;</dt>
<dd>
When "<b>append_dot_mydomain=yes</b>", append " <b>.$mydomain</b>" to addresses without ".domain".</dd>
</dl>
</div>
<div class="section">
<h1>ADDRESS EXTENSION</h1><br>
When a mail address localpart contains the optional recipient delimiter (e.g.,  <i>user+foo</i>@<i>domain</i>), the lookup order becomes:  <i>user+foo</i>@<i>domain</i>, <i>user</i>@<i>domain</i>, <i>user+foo</i>,  <i>user</i>, and @<i>domain</i>.<div style="height: 1.00em;">
&#160;</div>
The <b>propagate_unmatched_extensions</b> parameter controls whether an unmatched address extension ( <i>+foo</i>) is propagated to the result of table lookup.</div>
<div class="section">
<h1>VIRTUAL ALIAS DOMAINS</h1><br>
Besides virtual aliases, the virtual alias table can also be used to implement virtual alias domains. With a virtual alias domain, all recipient addresses are aliased to addresses in other domains.<div style="height: 1.00em;">
&#160;</div>
Virtual alias domains are not to be confused with the virtual mailbox domains that are implemented with the Postfix  <b>virtual</b>(8) mail delivery agent. With virtual mailbox domains, each recipient address can have its own mailbox.<div style="height: 1.00em;">
&#160;</div>
With a virtual alias domain, the virtual domain has its own user name space. Local (i.e. non-virtual) usernames are not visible in a virtual alias domain. In particular, local  <b>aliases</b>(5) and local mailing lists are not visible as  <i>localname@virtual-alias.domain</i>.<div style="height: 1.00em;">
&#160;</div>
Support for a virtual alias domain looks like:<div style="height: 1.00em;">
&#160;</div>
<br>
/etc/postfix/main.cf:<br>
    virtual_alias_maps = hash:/etc/postfix/virtual<br>
<div style="height: 1.00em;">
&#160;</div>
Note: some systems use <b>dbm</b> databases instead of <b>hash</b>. See the output from " <b>postconf -m</b>" for available database types.<div style="height: 1.00em;">
&#160;</div>
<br>
/etc/postfix/virtual:<br>
    <i>virtual-alias.domain     anything</i> (right-hand content does not matter)<br>
    <i>postmaster@virtual-alias.domain  postmaster</i><br>
    <i>user1@virtual-alias.domain       address1</i><br>
    <i>user2@virtual-alias.domain       address2, address3</i><br>
<div style="height: 1.00em;">
&#160;</div>
The <i>virtual-alias.domain anything</i> entry is required for a virtual alias domain.  <b>Without this entry, mail is rejected</b>  <b>with "relay access denied", or bounces with</b>  <b>"mail loops back to myself".</b><div style="height: 1.00em;">
&#160;</div>
Do not specify virtual alias domain names in the <b>main.cf</b>  <b>mydestination</b> or <b>relay_domains</b> configuration parameters.<div style="height: 1.00em;">
&#160;</div>
With a virtual alias domain, the Postfix SMTP server accepts mail for  <i>known-user@virtual-alias.domain</i>, and rejects mail for  <i>unknown-user</i>@<i>virtual-alias.domain</i> as undeliverable.<div style="height: 1.00em;">
&#160;</div>
Instead of specifying the virtual alias domain name via the  <b>virtual_alias_maps</b> table, you may also specify it via the  <b>main.cf virtual_alias_domains</b> configuration parameter. This latter parameter uses the same syntax as the  <b>main.cf</b>  <b>mydestination</b> configuration parameter.</div>
<div class="section">
<h1>REGULAR EXPRESSION TABLES</h1><br>
This section describes how the table lookups change when the table is given in the form of regular expressions. For a description of regular expression lookup table syntax, see  <b>regexp_table</b>(5) or  <b>pcre_table</b>(5).<div style="height: 1.00em;">
&#160;</div>
Each pattern is a regular expression that is applied to the entire address being looked up. Thus,  <i>user@domain</i> mail addresses are not broken up into their  <i>user</i> and <i>@domain</i> constituent parts, nor is  <i>user+foo</i> broken up into <i>user</i> and <i>foo</i>.<div style="height: 1.00em;">
&#160;</div>
Patterns are applied in the order as specified in the table, until a pattern is found that matches the search string.<div style="height: 1.00em;">
&#160;</div>
Results are the same as with indexed file lookups, with the additional feature that parenthesized substrings from the pattern can be interpolated as  <b>$1</b>, <b>$2</b> and so on.</div>
<div class="section">
<h1>TCP-BASED TABLES</h1><br>
This section describes how the table lookups change when lookups are directed to a TCP-based server. For a description of the TCP client/server lookup protocol, see  <b>tcp_table</b>(5). This feature is not available up to and including Postfix version 2.4.<div style="height: 1.00em;">
&#160;</div>
Each lookup operation uses the entire address once.  Thus,  <i>user@domain</i> mail addresses are not broken up into their  <i>user</i> and <i>@domain</i> constituent parts, nor is  <i>user+foo</i> broken up into <i>user</i> and <i>foo</i>.<div style="height: 1.00em;">
&#160;</div>
Results are the same as with indexed file lookups.</div>
<div class="section">
<h1>BUGS</h1><br>
The table format does not understand quoting conventions.</div>
<div class="section">
<h1>CONFIGURATION PARAMETERS</h1><br>
The following <b>main.cf</b> parameters are especially relevant to this topic. See the Postfix  <b>main.cf</b> file for syntax details and for default values. Use the " <b>postfix reload</b>" command after a configuration change.<dl>
<dt>
<b>virtual_alias_maps</b></dt>
<dd>
List of virtual aliasing tables.</dd>
</dl>
<dl>
<dt>
<b>virtual_alias_domains</b></dt>
<dd>
List of virtual alias domains. This uses the same syntax as the  <b>mydestination</b> parameter.</dd>
</dl>
<dl>
<dt>
<b>propagate_unmatched_extensions</b></dt>
<dd>
A list of address rewriting or forwarding mechanisms that propagate an address extension from the original address to the result. Specify zero or more of  <b>canonical</b>, <b>virtual</b>, <b>alias</b>,  <b>forward</b>, <b>include</b>, or <b>generic</b>.</dd>
</dl>
<p>
Other parameters of interest:<dl>
<dt>
<b>inet_interfaces</b></dt>
<dd>
The network interface addresses that this system receives mail on. You need to stop and start Postfix when this parameter changes.</dd>
</dl>
<dl>
<dt>
<b>mydestination</b></dt>
<dd>
List of domains that this mail system considers local.</dd>
</dl>
<dl>
<dt>
<b>myorigin</b></dt>
<dd>
The domain that is appended to any address that does not have a domain.</dd>
</dl>
<dl>
<dt>
<b>owner_request_special</b></dt>
<dd>
Give special treatment to <b>owner-</b><i>xxx</i> and <i>xxx</i><b>-request</b> addresses.</dd>
</dl>
<dl>
<dt>
<b>proxy_interfaces</b></dt>
<dd>
Other interfaces that this machine receives mail on by way of a proxy agent or network address translator.</dd>
</dl>
</div>
<div class="section">
<h1>SEE ALSO</h1><br>
cleanup(8), canonicalize and enqueue mail<br>
postmap(1), Postfix lookup table manager<br>
postconf(5), configuration parameters<br>
canonical(5), canonical address mapping</div>
<div class="section">
<h1>README FILES</h1><br>
Use "<b>postconf readme_directory</b>" or " <b>postconf html_directory</b>" to locate this information.<br>
ADDRESS_REWRITING_README, address rewriting guide<br>
DATABASE_README, Postfix lookup table overview<br>
VIRTUAL_README, domain hosting guide</div>
<div class="section">
<h1>LICENSE</h1><br>
The Secure Mailer license must be distributed with this software.</div>
<div class="section">
<h1>AUTHOR(S)</h1><br>
Wietse Venema<br>
IBM T.J. Watson Research<br>
P.O. Box 704<br>
Yorktown Heights, NY 10598, USA</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tr>
<td class="foot-date">
</td>
<td class="foot-os" align="right">
</td>
</tr>
</table>
</div>
</body>
</html>

