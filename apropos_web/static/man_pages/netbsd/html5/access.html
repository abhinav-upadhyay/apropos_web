<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="/static/man_pages/netbsd/style.css" type="text/css" media="all">
<title>
ACCESS(5)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
ACCESS(5)</td>
<td class="head-vol" align="center">
File Formats Manual</td>
<td class="head-rtitle" align="right">
ACCESS(5)</td>
</tr>
</tbody>
</table>
<br>
<div class="section">
<h1>NAME</h1> access &#45; Postfix SMTP server access table</div>
<div class="section">
<h1>SYNOPSIS</h1><br>
<b>postmap /etc/postfix/access</b><p>
<br>
<b>postmap -q "</b><i>string</i><b>" /etc/postfix/access</b><p>
<br>
<b>postmap -q - /etc/postfix/access &lt;</b><i>inputfile</i></div>
<div class="section">
<h1>DESCRIPTION</h1><br>
This document describes access control on remote SMTP client information: host names, network addresses, and envelope sender or recipient addresses; it is implemented by the Postfix SMTP server.  See  <b>header_checks</b>(5) or  <b>body_checks</b>(5) for access control on the content of email messages.<div style="height: 1.00em;">
&#160;</div>
Normally, the <b>access</b>(5) table is specified as a text file that serves as input to the  <b>postmap</b>(1) command. The result, an indexed file in  <b>dbm</b> or <b>db</b> format, is used for fast searching by the mail system. Execute the command " <b>postmap /etc/postfix/access</b>" to rebuild an indexed file after changing the corresponding text file.<div style="height: 1.00em;">
&#160;</div>
When the table is provided via other means such as NIS, LDAP or SQL, the same lookups are done as for ordinary indexed files.<div style="height: 1.00em;">
&#160;</div>
Alternatively, the table can be provided as a regular-expression map where patterns are given as regular expressions, or lookups can be directed to TCP-based server. In those cases, the lookups are done in a slightly different way as described below under "REGULAR EXPRESSION TABLES" or "TCP-BASED TABLES".</div>
<div class="section">
<h1>CASE FOLDING</h1><br>
The search string is folded to lowercase before database lookup. As of Postfix 2.3, the search string is not case folded with database types such as regexp: or pcre: whose lookup fields can match both upper and lower case.</div>
<div class="section">
<h1>TABLE FORMAT</h1><br>
The input format for the <b>postmap</b>(1) command is as follows:<dl>
<dt>
<i>pattern action</i></dt>
<dd>
When <i>pattern</i> matches a mail address, domain or host address, perform the corresponding  <i>action</i>.</dd>
</dl>
<dl>
<dt>
blank lines and comments</dt>
<dd>
Empty lines and whitespace-only lines are ignored, as are lines whose first non-whitespace character is a `#'.</dd>
</dl>
<dl>
<dt>
multi-line text</dt>
<dd>
A logical line starts with non-whitespace text. A line that starts with whitespace continues a logical line.</dd>
</dl>
</div>
<div class="section">
<h1>EMAIL ADDRESS PATTERNS</h1><br>
With lookups from indexed files such as DB or DBM, or from networked tables such as NIS, LDAP or SQL, patterns are tried in the order as listed below:<dl>
<dt>
<i>user</i>@<i>domain</i></dt>
<dd>
Matches the specified mail address.</dd>
</dl>
<dl>
<dt>
<i>domain.tld</i></dt>
<dd>
Matches <i>domain.tld</i> as the domain part of an email address.<div style="height: 1.00em;">
&#160;</div>
The pattern <i>domain.tld</i> also matches subdomains, but only when the string  <b>smtpd_access_maps</b> is listed in the Postfix  <b>parent_domain_matches_subdomains</b> configuration setting.</dd>
</dl>
<dl>
<dt>
<i>.domain.tld</i></dt>
<dd>
Matches subdomains of <i>domain.tld</i>, but only when the string  <b>smtpd_access_maps</b> is not listed in the Postfix  <b>parent_domain_matches_subdomains</b> configuration setting.</dd>
</dl>
<dl>
<dt>
<i>user</i>@</dt>
<dd>
Matches all mail addresses with the specified user part.</dd>
</dl>
<p>
Note: lookup of the null sender address is not possible with some types of lookup table. By default, Postfix uses  <b>&lt;&gt;</b> as the lookup key for such addresses. The value is specified with the  <b>smtpd_null_access_lookup_key</b> parameter in the Postfix  <b>main.cf</b> file.</div>
<div class="section">
<h1>EMAIL ADDRESS EXTENSION</h1><br>
When a mail address localpart contains the optional recipient delimiter (e.g.,  <i>user+foo</i>@<i>domain</i>), the lookup order becomes:  <i>user+foo</i>@<i>domain</i>, <i>user</i>@<i>domain</i>, <i>domain</i>,  <i>user+foo</i>@, and <i>user</i>@.</div>
<div class="section">
<h1>HOST NAME/ADDRESS PATTERNS</h1><br>
With lookups from indexed files such as DB or DBM, or from networked tables such as NIS, LDAP or SQL, the following lookup patterns are examined in the order as listed:<dl>
<dt>
<i>domain.tld</i></dt>
<dd>
Matches <i>domain.tld</i>.<div style="height: 1.00em;">
&#160;</div>
The pattern <i>domain.tld</i> also matches subdomains, but only when the string  <b>smtpd_access_maps</b> is listed in the Postfix  <b>parent_domain_matches_subdomains</b> configuration setting.</dd>
</dl>
<dl>
<dt>
<i>.domain.tld</i></dt>
<dd>
Matches subdomains of <i>domain.tld</i>, but only when the string  <b>smtpd_access_maps</b> is not listed in the Postfix  <b>parent_domain_matches_subdomains</b> configuration setting.</dd>
</dl>
<dl>
<dt>
<i>net.work.addr.ess</i></dt>
<dd>
</dd>
</dl>
<dl>
<dt>
<i>net.work.addr</i></dt>
<dd>
</dd>
</dl>
<dl>
<dt>
<i>net.work</i></dt>
<dd>
</dd>
</dl>
<dl>
<dt>
<i>net</i></dt>
<dd>
Matches the specified IPv4 host address or subnetwork. An IPv4 host address is a sequence of four decimal octets separated by ".".<div style="height: 1.00em;">
&#160;</div>
Subnetworks are matched by repeatedly truncating the last ".octet" from the remote IPv4 host address string until a match is found in the access table, or until further truncation is not possible.<div style="height: 1.00em;">
&#160;</div>
NOTE 1: The access map lookup key must be in canonical form: do not specify unnecessary null characters, and do not enclose network address information with "[]" characters.<div style="height: 1.00em;">
&#160;</div>
NOTE 2: use the <b>cidr</b> lookup table type to specify network/netmask patterns. See  <b>cidr_table</b>(5) for details.</dd>
</dl>
<dl>
<dt>
<i>net:work:addr:ess</i></dt>
<dd>
</dd>
</dl>
<dl>
<dt>
<i>net:work:addr</i></dt>
<dd>
</dd>
</dl>
<dl>
<dt>
<i>net:work</i></dt>
<dd>
</dd>
</dl>
<dl>
<dt>
<i>net</i></dt>
<dd>
Matches the specified IPv6 host address or subnetwork. An IPv6 host address is a sequence of three to eight hexadecimal octet pairs separated by ":".<div style="height: 1.00em;">
&#160;</div>
Subnetworks are matched by repeatedly truncating the last ":octetpair" from the remote IPv6 host address string until a match is found in the access table, or until further truncation is not possible.<div style="height: 1.00em;">
&#160;</div>
NOTE 1: the truncation and comparison are done with the string representation of the IPv6 host address. Thus, not all the ":" subnetworks will be tried.<div style="height: 1.00em;">
&#160;</div>
NOTE 2: The access map lookup key must be in canonical form: do not specify unnecessary null characters, and do not enclose network address information with "[]" characters.<div style="height: 1.00em;">
&#160;</div>
NOTE 3: use the <b>cidr</b> lookup table type to specify network/netmask patterns. See  <b>cidr_table</b>(5) for details.<div style="height: 1.00em;">
&#160;</div>
IPv6 support is available in Postfix 2.2 and later.</dd>
</dl>
</div>
<div class="section">
<h1>ACCEPT ACTIONS</h1><br>
<dl>
<dt>
<b>OK</b></dt>
<dd>
Accept the address etc. that matches the pattern.</dd>
</dl>
<dl>
<dt>
<i>all-numerical</i></dt>
<dd>
An all-numerical result is treated as OK. This format is generated by address-based relay authorization schemes such as pop-before-smtp.</dd>
</dl>
<p>
For other accept actions, see "OTHER ACTIONS" below.</div>
<div class="section">
<h1>REJECT ACTIONS</h1><br>
Postfix version 2.3 and later support enhanced status codes as defined in RFC 3463. When no code is specified at the beginning of the  <i>text</i> below, Postfix inserts a default enhanced status code of "5.7.1" in the case of reject actions, and "4.7.1" in the case of defer actions. See "ENHANCED STATUS CODES" below.<dl>
<dt>
<b>4</b><i>NN text</i></dt>
<dd>
</dd>
</dl>
<dl>
<dt>
<b>5</b><i>NN text</i></dt>
<dd>
Reject the address etc. that matches the pattern, and respond with the numerical three-digit code and text.  <b>4</b><i>NN</i> means "try again later", while  <b>5</b><i>NN</i> means "do not try again".<div style="height: 1.00em;">
&#160;</div>
The following responses have special meaning for the Postfix SMTP server:</dd>
</dl>
<div style="margin-left: 5.00ex;">
<dl>
<dt>
<b>421 </b><i>text</i> (Postfix 2.3 and later)</dt>
<dd>
</dd>
</dl>
<dl>
<dt>
<b>521 </b><i>text</i> (Postfix 2.6 and later)</dt>
<dd>
After responding with the numerical three-digit code and text, disconnect immediately from the SMTP client.  This frees up SMTP server resources so that they can be made available to another SMTP client.</dd>
</dl>
<dl>
<dt>
</dt>
<dd>
Note: The "521" response should be used only with botnets and other malware where interoperability is of no concern. The "send 521 and disconnect" behavior is NOT defined in the SMTP standard.</dd>
</dl>
</div>
<dl>
<dt>
<b>REJECT </b><i>optional text...</i></dt>
<dd>
Reject the address etc. that matches the pattern. Reply with " <b>$access_map_reject_code </b><i>optional text...</i>" when the optional text is specified, otherwise reply with a generic error response message.</dd>
</dl>
<dl>
<dt>
<b>DEFER </b><i>optional text...</i></dt>
<dd>
Reject the address etc. that matches the pattern. Reply with " <b>$access_map_defer_code </b><i>optional text...</i>" when the optional text is specified, otherwise reply with a generic error response message.<div style="height: 1.00em;">
&#160;</div>
This feature is available in Postfix 2.6 and later.</dd>
</dl>
<dl>
<dt>
<b>DEFER_IF_REJECT </b><i>optional text...</i></dt>
<dd>
Defer the request if some later restriction would result in a REJECT action. Reply with " <b>$access_map_defer_code 4.7.1</b>  <b></b><i>optional text...</i>" when the optional text is specified, otherwise reply with a generic error response message.<div style="height: 1.00em;">
&#160;</div>
Prior to Postfix 2.6, the SMTP reply code is 450.<div style="height: 1.00em;">
&#160;</div>
This feature is available in Postfix 2.1 and later.</dd>
</dl>
<dl>
<dt>
<b>DEFER_IF_PERMIT </b><i>optional text...</i></dt>
<dd>
Defer the request if some later restriction would result in a an explicit or implicit PERMIT action. Reply with " <b>$access_map_defer_code 4.7.1 </b><i> optional</i>  <i>text...</i>" when the optional text is specified, otherwise reply with a generic error response message.<div style="height: 1.00em;">
&#160;</div>
Prior to Postfix 2.6, the SMTP reply code is 450.<div style="height: 1.00em;">
&#160;</div>
This feature is available in Postfix 2.1 and later.</dd>
</dl>
<p>
For other reject actions, see "OTHER ACTIONS" below.</div>
<div class="section">
<h1>OTHER ACTIONS</h1><br>
<dl>
<dt>
<i>restriction...</i></dt>
<dd>
Apply the named UCE restriction(s) (<b>permit</b>, <b>reject</b>,  <b>reject_unauth_destination</b>, and so on).</dd>
</dl>
<dl>
<dt>
<b>BCC </b><i>user@domain</i></dt>
<dd>
Send one copy of the message to the specified recipient.<div style="height: 1.00em;">
&#160;</div>
If multiple BCC actions are specified within the same SMTP MAIL transaction, only the last action will be used.<div style="height: 1.00em;">
&#160;</div>
This feature is not part of the stable Postfix release.</dd>
</dl>
<dl>
<dt>
<b>DISCARD </b><i>optional text...</i></dt>
<dd>
Claim successful delivery and silently discard the message. Log the optional text if specified, otherwise log a generic message.<div style="height: 1.00em;">
&#160;</div>
Note: this action currently affects all recipients of the message. To discard only one recipient without discarding the entire message, use the transport(5) table to direct mail to the discard(8) service.<div style="height: 1.00em;">
&#160;</div>
This feature is available in Postfix 2.0 and later.</dd>
</dl>
<dl>
<dt>
<b>DUNNO</b></dt>
<dd>
Pretend that the lookup key was not found. This prevents Postfix from trying substrings of the lookup key (such as a subdomain name, or a network address subnetwork).<div style="height: 1.00em;">
&#160;</div>
This feature is available in Postfix 2.0 and later.</dd>
</dl>
<dl>
<dt>
<b>FILTER </b><i>transport:destination</i></dt>
<dd>
After the message is queued, send the entire message through the specified external content filter. The  <i>transport</i> name specifies the first field of a mail delivery agent definition in master.cf; the syntax of the next-hop  <i>destination</i> is described in the manual page of the corresponding delivery agent.  More information about external content filters is in the Postfix FILTER_README file.<div style="height: 1.00em;">
&#160;</div>
Note 1: do not use $<i>number</i> regular expression substitutions for  <i>transport</i> or <i>destination</i> unless you know that the information has a trusted origin.<div style="height: 1.00em;">
&#160;</div>
Note 2: this action overrides the main.cf <b>content_filter</b> setting, and affects all recipients of the message. In the case that multiple  <b>FILTER</b> actions fire, only the last one is executed.<div style="height: 1.00em;">
&#160;</div>
Note 3: the purpose of the FILTER command is to override message routing.  To override the recipient's  <i>transport</i> but not the next-hop  <i>destination</i>, specify an empty filter  <i>destination</i> (Postfix 2.7 and later), or specify a  <i>transport:destination</i> that delivers through a different Postfix instance (Postfix 2.6 and earlier). Other options are using the recipient-dependent  <b>transport_maps</b> or the sender-dependent  <b>sender_dependent_default_transport_maps</b> features.<div style="height: 1.00em;">
&#160;</div>
This feature is available in Postfix 2.0 and later.</dd>
</dl>
<dl>
<dt>
<b>HOLD </b><i>optional text...</i></dt>
<dd>
Place the message on the <b>hold</b> queue, where it will sit until someone either deletes it or releases it for delivery. Log the optional text if specified, otherwise log a generic message.<div style="height: 1.00em;">
&#160;</div>
Mail that is placed on hold can be examined with the  <b>postcat</b>(1) command, and can be destroyed or released with the  <b>postsuper</b>(1) command.<div style="height: 1.00em;">
&#160;</div>
Note: use "<b>postsuper -r</b>" to release mail that was kept on hold for a significant fraction of  <b>$maximal_queue_lifetime</b> or  <b>$bounce_queue_lifetime</b>, or longer. Use "<b>postsuper -H</b>" only for mail that will not expire within a few delivery attempts.<div style="height: 1.00em;">
&#160;</div>
Note: this action currently affects all recipients of the message.<div style="height: 1.00em;">
&#160;</div>
This feature is available in Postfix 2.0 and later.</dd>
</dl>
<dl>
<dt>
<b>PREPEND </b><i>headername: headervalue</i></dt>
<dd>
Prepend the specified message header to the message. When more than one PREPEND action executes, the first prepended header appears before the second etc. prepended header.<div style="height: 1.00em;">
&#160;</div>
Note: this action must execute before the message content is received; it cannot execute in the context of  <b>smtpd_end_of_data_restrictions</b>.<div style="height: 1.00em;">
&#160;</div>
This feature is available in Postfix 2.1 and later.</dd>
</dl>
<dl>
<dt>
<b>REDIRECT </b><i>user@domain</i></dt>
<dd>
After the message is queued, send the message to the specified address instead of the intended recipient(s).<div style="height: 1.00em;">
&#160;</div>
Note: this action overrides the FILTER action, and currently affects all recipients of the message.<div style="height: 1.00em;">
&#160;</div>
This feature is available in Postfix 2.1 and later.</dd>
</dl>
<dl>
<dt>
<b>WARN </b><i>optional text...</i></dt>
<dd>
Log a warning with the optional text, together with client information and if available, with helo, sender, recipient and protocol information.<div style="height: 1.00em;">
&#160;</div>
This feature is available in Postfix 2.1 and later.</dd>
</dl>
</div>
<div class="section">
<h1>ENHANCED STATUS CODES</h1><br>
Postfix version 2.3 and later support enhanced status codes as defined in RFC 3463. When an enhanced status code is specified in an access table, it is subject to modification. The following transformations are needed when the same access table is used for client, helo, sender, or recipient access restrictions; they happen regardless of whether Postfix replies to a MAIL FROM, RCPT TO or other SMTP command.<dl>
<dt>
&#8226;</dt>
<dd>
When a sender address matches a REJECT action, the Postfix SMTP server will transform a recipient DSN status (e.g., 4.1.1-4.1.6) into the corresponding sender DSN status, and vice versa.</dd>
</dl>
<dl>
<dt>
&#8226;</dt>
<dd>
When non-address information matches a REJECT action (such as the HELO command argument or the client hostname/address), the Postfix SMTP server will transform a sender or recipient DSN status into a generic non-address DSN status (e.g., 4.0.0).</dd>
</dl>
</div>
<div class="section">
<h1>REGULAR EXPRESSION TABLES</h1><br>
This section describes how the table lookups change when the table is given in the form of regular expressions. For a description of regular expression lookup table syntax, see  <b>regexp_table</b>(5) or  <b>pcre_table</b>(5).<div style="height: 1.00em;">
&#160;</div>
Each pattern is a regular expression that is applied to the entire string being looked up. Depending on the application, that string is an entire client hostname, an entire client IP address, or an entire mail address. Thus, no parent domain or parent network search is done,  <i>user@domain</i> mail addresses are not broken up into their  <i>user@</i> and <i>domain</i> constituent parts, nor is  <i>user+foo</i> broken up into <i>user</i> and <i>foo</i>.<div style="height: 1.00em;">
&#160;</div>
Patterns are applied in the order as specified in the table, until a pattern is found that matches the search string.<div style="height: 1.00em;">
&#160;</div>
Actions are the same as with indexed file lookups, with the additional feature that parenthesized substrings from the pattern can be interpolated as  <b>$1</b>, <b>$2</b> and so on.</div>
<div class="section">
<h1>TCP-BASED TABLES</h1><br>
This section describes how the table lookups change when lookups are directed to a TCP-based server. For a description of the TCP client/server lookup protocol, see  <b>tcp_table</b>(5). This feature is not available up to and including Postfix version 2.4.<div style="height: 1.00em;">
&#160;</div>
Each lookup operation uses the entire query string once. Depending on the application, that string is an entire client hostname, an entire client IP address, or an entire mail address. Thus, no parent domain or parent network search is done,  <i>user@domain</i> mail addresses are not broken up into their  <i>user@</i> and <i>domain</i> constituent parts, nor is  <i>user+foo</i> broken up into <i>user</i> and <i>foo</i>.<div style="height: 1.00em;">
&#160;</div>
Actions are the same as with indexed file lookups.</div>
<div class="section">
<h1>EXAMPLE</h1><br>
The following example uses an indexed file, so that the order of table entries does not matter. The example permits access by the client at address 1.2.3.4 but rejects all other clients in 1.2.3.0/24. Instead of  <b>hash</b> lookup tables, some systems use  <b>dbm</b>.  Use the command " <b>postconf -m</b>" to find out what lookup tables Postfix supports on your system.<div style="height: 1.00em;">
&#160;</div>
<br>
/etc/postfix/main.cf:<br>
    smtpd_client_restrictions =<br>
        check_client_access hash:/etc/postfix/access<p>
<br>
/etc/postfix/access:<br>
    1.2.3   REJECT<br>
    1.2.3.4 OK<br>
<div style="height: 1.00em;">
&#160;</div>
Execute the command "<b>postmap /etc/postfix/access</b>" after editing the file.</div>
<div class="section">
<h1>BUGS</h1><br>
The table format does not understand quoting conventions.</div>
<div class="section">
<h1>SEE ALSO</h1><br>
postmap(1), Postfix lookup table manager<br>
smtpd(8), SMTP server<br>
postconf(5), configuration parameters<br>
transport(5), transport:nexthop syntax</div>
<div class="section">
<h1>README FILES</h1><br>
Use "<b>postconf readme_directory</b>" or " <b>postconf html_directory</b>" to locate this information.<br>
SMTPD_ACCESS_README, built-in SMTP server access control<br>
DATABASE_README, Postfix lookup table overview</div>
<div class="section">
<h1>LICENSE</h1><br>
The Secure Mailer license must be distributed with this software.</div>
<div class="section">
<h1>AUTHOR(S)</h1><br>
Wietse Venema<br>
IBM T.J. Watson Research<br>
P.O. Box 704<br>
Yorktown Heights, NY 10598, USA</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tr>
<td class="foot-date">
</td>
<td class="foot-os" align="right">
</td>
</tr>
</table>
</div>
</body>
</html>

