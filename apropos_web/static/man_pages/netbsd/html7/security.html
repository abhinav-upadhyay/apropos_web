<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
SECURITY(7)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
SECURITY(7)</td>
<td class="head-vol" align="center">
Miscellaneous Information Manual</td>
<td class="head-rtitle" align="right">
SECURITY(7)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">security</b> &#8212; <span class="desc"><span class="unix">NetBSD</span> security features</span></div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> <span class="unix">NetBSD</span> supports a variety of security features. Below is a brief description of them with some quick usage examples that will help you get started.<p>
Contents:<p>
<ul style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-hyph">
<li class="list-hyph" style="margin-top: 0.00em;">
Veriexec (file integrity)</li>
<li class="list-hyph" style="margin-top: 0.00em;">
Exploit mitigation</li>
<li class="list-hyph" style="margin-top: 0.00em;">
Per-user <i class="file">/tmp</i> directory</li>
<li class="list-hyph" style="margin-top: 0.00em;">
Information filtering</li>
<li class="list-hyph" style="margin-top: 0.00em;">
Administrative security</li>
</ul>
<div class="subsection">
<h2 id="x5665726965786563">Veriexec</h2> <span class="emph">Veriexec</span> is a file integrity subsystem.<p>
For more information about it, and a quick guide on how to use it, please see <a class="link-man" href="../8/veriexec">veriexec(8)</a>.<p>
In a nutshell, once enabled, <span class="emph">Veriexec</span> can be started as follows:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
# veriexecgen &amp;&amp; veriexecctl load</pre>
</div>
<div class="subsection">
<h2 id="x4578706c6f6974206d697469676174696f6e">Exploit mitigation</h2> <span class="unix">NetBSD</span> incorporates some exploit mitigation features. The purpose of exploit mitigation features is to interfere with the way exploits work, in order to prevent them from succeeding. Due to that, some features may have other impacts on the system, so be sure to fully understand the implications of each feature.<p>
<span class="unix">NetBSD</span> provides the following exploit mitigation features:<p>
<ul style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-hyph">
<li class="list-hyph" style="margin-top: 0.00em;">
PaX ASLR (Address Space Layout Randomization).</li>
<li class="list-hyph" style="margin-top: 0.00em;">
PaX MPROTECT (<a class="link-man" href="../2/mprotect">mprotect(2)</a> restrictions)</li>
<li class="list-hyph" style="margin-top: 0.00em;">
PaX SegvGuard</li>
<li class="list-hyph" style="margin-top: 0.00em;">
<a class="link-man" href="../1/gcc">gcc(1)</a> stack-smashing protection (SSP)</li>
<li class="list-hyph" style="margin-top: 0.00em;">
bounds checked libc functions (FORTIFY_SOURCE)</li>
<li class="list-hyph" style="margin-top: 0.00em;">
Protections against <span class="define">NULL</span> pointer dereferences</li>
</ul>
</div>
<div class="subsection">
<h2 id="x5061582041534c52">PaX ASLR</h2> <span class="emph">PaX ASLR</span> implements Address Space Layout Randomization (ASLR), meant to complement non-executable mappings. Its purpose is to harden prediction of the address space layout, namely location of library and application functions that can be used by an attacker to circumvent non-executable mappings by using a technique called &#8220;return to library&#8221; to bypass the need to write new code to (potentially executable) regions of memory.<p>
When <span class="emph">PaX ASLR</span> is used, it is more likely the attacker will fail to predict the addresses of such functions, causing the application to segfault. To detect cases where an attacker might try and brute-force the return address of respawning services, <span class="emph">PaX Segvguard</span> can be used (see below).<p>
For non-PIE (Position Independent Executable) executables, the <span class="unix">NetBSD</span> <span class="emph">PaX ASLR</span> implementation introduces randomization to the following memory regions:<p>
<ol style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-enum">
<li class="list-enum" style="margin-top: 0.00em;">
The stack</li>
</ol>
<p>
For PIE executables:<p>
<ol style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-enum">
<li class="list-enum" style="margin-top: 0.00em;">
The program itself (exec base)</li>
<li class="list-enum" style="margin-top: 0.00em;">
All shared libraries</li>
<li class="list-enum" style="margin-top: 0.00em;">
The data segment</li>
<li class="list-enum" style="margin-top: 0.00em;">
The stack</li>
</ol>
<p>
While it can be enabled globally, <span class="unix">NetBSD</span> provides a tool, <a class="link-man" href="../8/paxctl">paxctl(8)</a>, to enable <span class="emph">PaX ASLR</span> on a per-program basis.<p>
Example usage:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
# paxctl +A /usr/sbin/sshd</pre>
<p>
Enabling <span class="emph">PaX ASLR</span> globally:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
# sysctl -w security.pax.aslr.global=1</pre>
</div>
<div class="subsection">
<h2 id="x506158204d50524f54454354">PaX MPROTECT</h2> <span class="emph">PaX MPROTECT</span> implements memory protection restrictions, meant to complement non-executable mappings. The purpose is to prevent situations where malicious code attempts to mark writable memory regions as executable, often by trashing arguments to an <a class="link-man" href="../2/mprotect">mprotect(2)</a> call.<p>
While it can be enabled globally, <span class="unix">NetBSD</span> provides a tool, <a class="link-man" href="../8/paxctl">paxctl(8)</a>, to enable <span class="emph">PaX MPROTECT</span> on a per-program basis.<p>
Example usage:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
# paxctl +M /usr/sbin/sshd</pre>
<p>
Enabling <span class="emph">PaX MPROTECT</span> globally:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
# sysctl -w security.pax.mprotect.global=1</pre>
</div>
<div class="subsection">
<h2 id="x50615820536567766775617264">PaX Segvguard</h2> <span class="emph">PaX Segvguard</span> monitors the number of segmentation faults in a program on a per-user basis, in an attempt to detect on-going exploitation attempts and possibly prevent them. For instance, <span class="emph">PaX Segvguard</span> can help detect when an attacker tries to brute-force a function return address, when attempting to perform a return-to-lib attack.<p>
<span class="emph">PaX Segvguard</span> consumes kernel memory, so use it wisely. While it provides rate-limiting protections, records are tracked for all users on a per-program basis, meaning that irresponsible use may result in tracking all segmentation faults in the system, possibly consuming all kernel memory.<p>
For this reason, it is highly recommended to have <span class="emph">PaX Segvguard</span> enabled explicitly only for network services or other processes deemed as critical to system security. Enabling <span class="emph">PaX Segvguard</span> explicitly works like this:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
# paxctl +G /usr/sbin/sshd</pre>
<p>
However, a global knob is still provided, for use in strict environments with no local users (for example, some network appliances, embedded devices, and firewalls)<p>
<pre style="margin-left: 5.00ex;" class="lit display">
# sysctl -w security.pax.segvguard.global=1</pre>
<p>
Explicitly disabling <span class="emph">PaX Segvguard</span> is also possible:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
# paxctl +g /bin/ls</pre>
<p>
In addition, <span class="emph">PaX Segvguard</span> provides several tunable options. For example, to limit a program to 5 segmentation faults from the same user in a 60 second timeframe:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
# sysctl -w security.pax.segvguard.max_crashes=5 
# sysctl -w security.pax.segvguard.expiry_timeout=60</pre>
<p>
The number of seconds a user will be suspended from running the culprit program is also configurable. For example, 10 minutes seem like a sane setting:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
# sysctl -w security.pax.segvguard.suspend_timeout=600</pre>
</div>
<div class="subsection">
<h2 id="x47434320537461636b20536d617368696e672050726f74656374696f6e2028205353502029">GCC Stack Smashing Protection (SSP)</h2> As of <span class="unix">NetBSD&#160;4.0</span>, <a class="link-man" href="../1/gcc">gcc(1)</a> includes <span class="emph">SSP</span>, a set of compiler extensions to raise the bar on exploitation attempts by detecting corruption of variables and buffer overruns, which may be used to affect program control flow.<p>
Upon detection of a buffer overrun, <span class="emph">SSP</span> will immediately abort execution of the program and send a log message to <a class="link-man" href="../3/syslog">syslog(3)</a>.<p>
The system (userland and kernel) can be built with <span class="emph">SSP</span> by using the &#8220;USE_SSP&#8221; flag in <i class="file">/etc/mk.conf</i>:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
USE_SSP=yes</pre>
<p>
You are encouraged to use <span class="emph">SSP</span> for software you build, by providing one of the <b class="flag">&#45;fstack-protector</b> or <b class="flag">&#45;fstack-protector-all</b> flags to <a class="link-man" href="../1/gcc">gcc(1)</a>. Keep in mind, however, that <span class="emph">SSP</span> will not work for functions that make use of <a class="link-man" href="../3/alloca">alloca(3)</a>, as the latter modifies the stack size during run-time, while <span class="emph">SSP</span> relies on it being a compile-time static.<p>
Use of <span class="emph">SSP</span> is especially encouraged on platforms without per-page execute bit granularity such as i386. As of <span class="unix">NetBSD&#160;6.0</span>, <span class="emph">SSP</span> is used by default on i386 and amd64 architectures.</div>
<div class="subsection">
<h2 id="x464f52544946595f534f55524345">FORTIFY_SOURCE</h2> The so-called <span class="emph">FORTIFY_SOURCE</span> is a relatively simple technique to detect a subset of buffer overflows before these can do damage. It is integrated to <a class="link-man" href="../1/gcc">gcc(1)</a> together with some common memory and string functions in the standard C library of <span class="unix">NetBSD</span>.<p>
The underlying idea builds on the observation that there are cases where the compiler knows the size of a buffer. If a buffer overflow is suspected in a function that does little or no bounds checking, either a compile time warning can be issued or a safer substitute function can be used at runtime. Refer to <a class="link-man" href="../3/ssp">ssp(3)</a> for additional details.<p>
The <span class="emph">FORTIFY_SOURCE</span> is enabled by default in some parts of the <span class="unix">NetBSD</span> source tree. It is also possible to explicitly enable it by defining the following in <a class="link-man" href="../5/mk.conf">mk.conf(5)</a>:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
USE_FORT=yes</pre>
</div>
<div class="subsection">
<h2 id="x50726f74656374696f6e7320616761696e7374204e554c4c20706f696e7465722064657265666572656e636573">Protections against NULL pointer dereferences</h2> A certain class of attacks rely on kernel bugs that dereference <span class="define">NULL</span> pointers. If user processes are allowed to map the virtual address 0 with <a class="link-man" href="../2/mmap">mmap(2)</a> or by other means, there is a risk that code or data can be injected into the kernel address space.<p>
In <span class="unix">NetBSD</span> it is possible to restrict whether user processes are allowed to make mappings at the zero address. By default, address 0 mappings are restricted on all architectures. It is however known that some third-party programs may not function properly with the restriction. Such mappings can be allowed either by using the <span class="define">USER_VA0_DISABLE_DEFAULT</span> kernel configuration option or by changing the following variable at runtime:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
# sysctl -w vm.user_va0_disable=0</pre>
<p>
Note that if <span class="emph">securelevel</span> (see <a class="link-man" href="../9/secmodel_securelevel">secmodel_securelevel(9)</a>) is greater than zero, it is not possible to change the <a class="link-man" href="../8/sysctl">sysctl(8)</a> variable.</div>
<div class="subsection">
<h2 id="x5065721e757365722074656d706f726172792073746f72616765">Per-user temporary storage</h2> It is possible to configure per-user temporary storage to avoid potential security issues (race conditions, etc.) in programs that do not make secure usage of <i class="file">/tmp</i>.<p>
To enable per-user temporary storage, add the following line to <a class="link-man" href="../5/rc.conf">rc.conf(5)</a>:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
per_user_tmp=YES</pre>
<p>
If <i class="file">/tmp</i> is a mount point, you will also need to update its <a class="link-man" href="../5/fstab">fstab(5)</a> entry to use &#8220;/private/tmp&#8221; (or whatever directory you want, if you override the default using the &#8220;per_user_tmp_dir&#8221; <a class="link-man" href="../5/rc.conf">rc.conf(5)</a> keyword) instead of &#8220;/tmp&#8221;.<p>
Following that, run:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
# /etc/rc.d/perusertmp start</pre>
<p>
The per-user temporary storage is implemented by using &#8220;magic symlinks&#8221;. These are further described in <a class="link-man" href="../7/symlink">symlink(7)</a>.</div>
<div class="subsection">
<h2 id="x496e666f726d6174696f6e2066696c746572696e67">Information filtering</h2> <span class="unix">NetBSD</span> provides administrators the ability to restrict information passed from the kernel to userland so that users can only view information they &#8220;own&#8221;.<p>
The hooks that manage this restriction are located in various parts of the system and affect programs such as <a class="link-man" href="../1/ps">ps(1)</a>, <a class="link-man" href="../1/fstat">fstat(1)</a>, and <a class="link-man" href="../1/netstat">netstat(1)</a>. Information filtering is enabled as follows:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
# sysctl -w security.curtain=1</pre>
</div>
<div class="subsection">
<h2 id="x41646d696e697374726174697665207365637572697479">Administrative security</h2> Also certain administrative tasks are related to security. For instance, the daily maintenance script includes some basic consistency checks; see <a class="link-man" href="../5/security.conf">security.conf(5)</a> for more details. In particular, it is possible to configure <span class="unix">NetBSD</span> to automatically audit all third-party packages installed via <a class="link-man" href="../7/pkgsrc">pkgsrc(7)</a>. To audit for any known vulnerabilities on daily basis, set the following in <i class="file">/etc/daily.conf</i>:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
fetch_pkg_vulnerabilities=YES</pre>
</div>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../3/ssp">ssp(3)</a>, <a class="link-man" href="../4/options">options(4)</a>, <a class="link-man" href="../8/paxctl">paxctl(8)</a>, <a class="link-man" href="../8/sysctl">sysctl(8)</a>, <a class="link-man" href="../8/veriexec">veriexec(8)</a>, <a class="link-man" href="../9/kauth">kauth(9)</a><p>
<span class="ref"><span class="ref-auth">Joseph Kong</span>, <i class="ref-book">Designing BSD Rootkits: An Introduction to Kernel Hacking</i>, <i class="ref-issue">No Starch Press</i>, <span class="ref-date">2007</span>.</span><p>
<span class="ref"><span class="ref-auth">Enrico Perla</span> and <span class="ref-auth">Massimiliano Oldani</span>, <i class="ref-book">A Guide to Kernel Exploitation: Attacking the Core</i>, <i class="ref-issue">Elsevier</i>, <span class="ref-date">2010</span>.</span><p>
<span class="ref"><span class="ref-auth">Erik Buchanan</span>, <span class="ref-auth">Ryan Roemer</span>, <span class="ref-auth">Hovav Shacham</span>, and <span class="ref-auth">Stefan Savage</span>, <span class="ref-title">When Good Instructions Go Bad: Generalizing Return-Oriented Programming to RISC</span>, <i class="ref-issue">ACM Press</i>, <a class="link-ref" href="http://cseweb.ucsd.edu/~hovav/dist/sparc.pdf">http://cseweb.ucsd.edu/~hovav/dist/sparc.pdf</a>, <span class="ref-page">27-38</span>, <span class="ref-date">October 27-31, 2008</span>, <span class="ref-opt">CCS '08: Proceedings of the 15th ACM Conference on Computer and Communications Security</span>.</span><p>
<span class="ref"><span class="ref-auth">Sebastian Krahmer</span>, <span class="ref-title">x86-64 Buffer Overflow Exploits and the Borrowed Code Chunks Exploitation Technique</span>, <a class="link-ref" href="http://www.suse.de/~krahmer/no-nx.pdf">http://www.suse.de/~krahmer/no-nx.pdf</a>, <span class="ref-date">September 28, 2005</span>.</span></div>
<div class="section">
<h1 id="x415554484f5253">AUTHORS</h1> Many of the security features were pioneered by <span class="author">Elad Efrat</span> &#60;<a class="link-mail" href="mailto:elad@NetBSD.org">elad@NetBSD.org</a>&#62;.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
June 14, 2015</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

