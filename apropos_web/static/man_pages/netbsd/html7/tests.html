<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="/static/man_pages/netbsd/style.css" type="text/css" media="all">
<title>
TESTS(7)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
TESTS(7)</td>
<td class="head-vol" align="center">
Miscellaneous Information Manual</td>
<td class="head-rtitle" align="right">
TESTS(7)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">tests</b> &#8212; <span class="desc">introduction to the NetBSD test suite</span></div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <span class="unix">NetBSD</span> test suite provides a collection of automated tests for two major purposes. On the one hand, the test suite aids <span class="emph">developers</span> in catching bugs and regressions in the code when they are performing modifications to the source tree. On the other hand, the test suite allows <span class="emph">end users</span> (and, in particular, system administrators) to verify that fresh installations of the <span class="unix">NetBSD</span> operating system behave correctly in their hardware platform and also to ensure that the system does not suffer from regressions during regular system operation and maintenance.<p>
The <span class="unix">NetBSD</span> tests are implemented using the <span class="emph">Automated Testing Framework (ATF)</span>, a third-party package shipped with <span class="unix">NetBSD</span>; see <a class="link-man" href="../7/atf">atf(7)</a> for details. The <span class="unix">NetBSD</span> test suite is distributed as a separate installation set, named <i class="file">tests.tgz</i>, and the test programs are all installed under the <i class="file">/usr/tests</i> hierarchy.<p>
This manual page describes how to execute the test suite and how to configure some of its optional features.<div class="subsection">
<h2 id="x5768656e20746f2072756e207468652074657374733f">When to run the tests?</h2> Before diving into the details of how to run the test suite, here are some scenarios in which you should be running them:<ul style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-bul">
<li class="list-bul" style="margin-top: 1.00em;">
After a fresh installation of <span class="unix">NetBSD</span> to ensure that the system works correctly on your hardware platform.</li>
<li class="list-bul" style="margin-top: 1.00em;">
After an upgrade of <span class="unix">NetBSD</span> to a different version to ensure that the new code works well on your hardware platform and that the upgrade did not introduce regressions in your configuration.</li>
<li class="list-bul" style="margin-top: 1.00em;">
After performing changes to the source tree to catch any bugs and/or regressions introduced by the modifications.</li>
<li class="list-bul" style="margin-top: 1.00em;">
Periodically, maybe from a <a class="link-man" href="../8/cron">cron(8)</a> job, to ensure that any changes to the system (such as the installation of third-party packages or manual modifications to configuration files) do not introduce unexpected failures.</li>
</ul>
</div>
<div class="subsection">
<h2 id="x496e7374616c6c696e6720746865207465737473">Installing the tests</h2> If you chose to install the <i class="file">tests.tgz</i> distribution set while setting up your <span class="unix">NetBSD</span> system, the tests are already available in <i class="file">/usr/tests</i>. Otherwise, install the set now by running:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
# cd / 
# tar xzpf /path/to/tests.tgz</pre>
</div>
<div class="subsection">
<h2 id="x52756e6e696e6720746865207465737473">Running the tests</h2> Use the following commands to run the whole test suite:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
$ cd /usr/tests 
$ atf-run | atf-report</pre>
<p>
The above will go through all test programs in <i class="file">/usr/tests</i> recursively, execute them, and, at the very end, show a report of the results of the test suite. These results include the count of tests that succeeded (passed), the names of the tests that failed, and the count of the tests that were not executed (skipped) because the system configuration did not meet their requirements.<p>
If you are interested in saving the whole output of the test suite execution so that you can later investigate failures, use the following idiom instead:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
$ cd /usr/tests 
$ atf-run | tee ~/tests.log | atf-report</pre>
<p>
The above command will save the raw output of the test suite in <i class="file">~/tests.log</i>, which you can later inspect manually to look for failures. Note that the file contains a copy of the &#8216;stdout&#8217; and &#8216;stderr&#8217; of each test case, which becomes valuable during debugging.<p>
It is also possible to restrict which tests to execute so that only a small subsystem is tested; see <a class="link-man" href="../1/atf-run">atf-run(1)</a> for details. Additionally, it is also possible to run the test programs themselves by hand; see <a class="link-man" href="../1/atf-test-program">atf-test-program(1)</a> for more details, but be aware that you should only be doing this if you are debugging failing tests.</div>
<div class="subsection">
<h2 id="x5465737420656e7669726f6e6d656e7420636f6e73696465726174696f6e73">Test environment considerations</h2> Tests can be invoked as an unprivileged user, in which case tests that require privileges will be skipped. If run as root, an unprivileged user will be used for tests that require privileges. For maximal coverage, the standard approach is to invoke tests as root.<p>
Ideally, tests are self-contained and do not either depend on or perturb the host environment, aside from skipping tests when optional facilities are not available. In reality, tests load and unload modules, and do other things that might cause problems. While it is not entirely safe to run tests on a multi-user system, permanent problems or crashes from doing so are viewed as bugs and should be reported.</div>
<div class="subsection">
<h2 id="x436f6e6669677572696e6720746865207465737473">Configuring the tests</h2> Some test cases in the <span class="unix">NetBSD</span> test suite require the administrator to manually set up some configuration properties before they can run. Unless these properties are defined, the tests that require them will be marked as skipped and thus they will not be really executed.<p>
Each test suite is configured through a separate file that lives under <i class="file">/etc/atf/</i> and that carries the name of the test suite. Henceforth, to configure the properties that affect the execution of the <span class="unix">NetBSD</span> test suite, you need to edit <i class="file">/etc/atf/NetBSD.conf</i>. The suite-specific configuration file implicitly depends on <i class="file">/etc/atf/common.conf</i>, which contains properties shared among all test suites. These files conform to the configuration file format described in <a class="link-man" href="../5/atf-formats">atf-formats(5)</a>.<p>
The following configuration variables are available in the <span class="unix">NetBSD</span> test suite:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
fstype</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
When set to a filesystem type, restrict tests programs from the <i class="file">/usr/tests/fs/vfs/</i> tree to only run test cases for the given type.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
unprivileged-user</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
This variable allows setting an unprivileged user login name to be used by tests. Defaults to &#8216;_tests&#8217;.</dd>
</dl>
</div>
<div class="subsection">
<h2 id="x5768617420746f20646f20696620736f6d657468696e67206661696c733f">What to do if something fails?</h2> If there is <span class="emph">any failure</span> during the execution of the test suite, please considering reporting it to the <span class="unix">NetBSD</span> developers so that the failure can be analyzed and fixed. To do so, either send a message to the appropriate mailing list or file a problem report. For more details please refer to:<ul style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-bul">
<li class="list-bul" style="margin-top: 0.00em;">
<a class="link-ext" href="http://www.netbsd.org/mailinglists/">NetBSD mailing lists</a></li>
<li class="list-bul" style="margin-top: 0.00em;">
<a class="link-ext" href="http://www.netbsd.org/support/send-pr">NetBSD Problem Reports</a></li>
</ul>
</div>
</div>
<div class="section">
<h1 id="x46494c4553">FILES</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/etc/atf/NetBSD.conf</i></dt>
<dd class="list-tag" style="margin-left: 21.00ex;">
Configuration file for the <span class="unix">NetBSD</span> test suite.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/etc/atf/common.conf</i></dt>
<dd class="list-tag" style="margin-left: 21.00ex;">
Configuration file for all test suites.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/usr/tests/</i></dt>
<dd class="list-tag" style="margin-left: 21.00ex;">
Location of the test suites.</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../7/atf">atf(7)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="name">tests</b> manual page first appeared in <span class="unix">NetBSD&#160;6.0</span>.<p>
The ATF testing framework was first distributed with <span class="unix">NetBSD&#160;5.0</span> and the collection of test programs in <i class="file">/usr/tests</i> has been growing since then.</div>
<div class="section">
<h1 id="x415554484f5253">AUTHORS</h1> <span class="author">Julio Merino</span> &#60;<a class="link-mail" href="mailto:jmmv@NetBSD.org">jmmv@NetBSD.org</a>&#62;</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
July 13, 2014</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

