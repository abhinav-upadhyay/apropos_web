<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
MODULE(7)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
MODULE(7)</td>
<td class="head-vol" align="center">
Miscellaneous Information Manual</td>
<td class="head-rtitle" align="right">
MODULE(7)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">module</b> &#8212; <span class="desc">Kernel Modules interface</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="config">options MODULAR</b></div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> Kernel modules allow the system administrator to dynamically add and remove functionality from a running system. This ability also helps software developers to develop new parts of the kernel without constantly rebooting to test their changes.<p>
Additionally, the kernel may automatically load software modules as needed to perform requested operations. For example, an &#8220;xyzfs&#8221; module can be loaded automatically when an attempt is made to mount an &#8220;xyzfs&#8221; file system. Modules can also depend on other modules, and dependent modules are automatically loaded. When a module is no longer needed, it can be automatically unloaded.<p>
An in-kernel linker resolves symbol references between the module and the rest of the kernel.<p>
The <b class="name">module</b> interface is accessed with the <a class="link-man" href="../html2/modctl.html">modctl(2)</a> system call. All common operations involving kernel modules are handled by the <a class="link-man" href="../html8/modload.html">modload(8)</a>, <a class="link-man" href="../html8/modunload.html">modunload(8)</a>, and <a class="link-man" href="../html8/modstat.html">modstat(8)</a> programs. Users should never have to interact with <a class="link-man" href="../html2/modctl.html">modctl(2)</a> directly.</div>
<div class="section">
<h1 id="x4d4f44554c4520434c4153534553">MODULE CLASSES</h1><div class="subsection">
<h2 id="x5669727475616c2046696c652053797374656d206d6f64756c6573">Virtual File System modules</h2> Virtual file systems may be added via the <b class="name">module</b> interface.</div>
<div class="subsection">
<h2 id="x44657669636520447269766572206d6f64756c6573">Device Driver modules</h2> Many device drivers can be loaded as a kernel module. One potential problem specific to block and character device drivers is that the device nodes must exist for the devices to be accessed. These need to be created manually, after the driver module has been successfully loaded. The majority of the device driver modules however does not need any manual intervention to function properly.</div>
<div class="subsection">
<h2 id="x457865637574696f6e20496e74657270726574657273">Execution Interpreters</h2> Execution Interpreters can be loaded to provide support for executing binaries not normally supported by kernel. This also allows loading support for executing foreign system binaries. Execution Interpreters may require that an appropriate emulation module also be loaded.</div>
<div class="subsection">
<h2 id="x4d697363656c6c616e656f7573206d6f64756c6573">Miscellaneous modules</h2> Miscellaneous modules are modules for which there are not currently well-defined or well-used interfaces for extension. They are provided for extension, and the user-provided module initialization routine is expected to install the necessary "hooks" into the rest of the operating system. An example of a "miscellaneous module" might be a loader for card-specific VGA drivers or alternate terminal emulations in an appropriately layered console driver.</div>
<div class="subsection">
<h2 id="x53656375726974791e4d6f64656c206d6f64756c6573">Security-Model modules</h2> Alternate system security models may loaded using the <b class="name">module</b> facility.</div>
</div>
<div class="section">
<h1 id="x4558414d504c4553">EXAMPLES</h1> The common build tool of <span class="unix">NetBSD</span>, &#8220;build.sh&#8221;, automatically compiles and installs all modules during a full system build and install. Sometimes it is however useful to update only modules. The following example demonstrates one way to do this. It is assumed that the source code is under <i class="file">/usr/src</i>, while the object and toolchain directories are under <i class="file">/usr/obj</i> and <i class="file">/usr/tools</i>, respectively.<p>
<pre style="margin-left: 5.00ex;" class="lit display">
cd /usr/src/sys/modules 
 
export OBJDIR=/usr/obj 
export TOOLDIR=/usr/tools 
 
make clean 
make 
make install</pre>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html2/modctl.html">modctl(2)</a>, <a class="link-man" href="../html8/modload.html">modload(8)</a>, <a class="link-man" href="../html8/modstat.html">modstat(8)</a>, <a class="link-man" href="../html8/modunload.html">modunload(8)</a>, <a class="link-man" href="../html9/module.html">module(9)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="name">module</b> facility was designed to be similar in functionality to the loadable kernel modules facility provided by SunOS 4.1.3. The old <span class="define">LKM</span> interface was replaced by <b class="name">module</b> in <span class="unix">NetBSD&#160;5.0</span>.</div>
<div class="section">
<h1 id="x415554484f5253">AUTHORS</h1> The <b class="name">module</b> subsystem was implemented by <span class="author">Andrew Doran</span> &#60;ad@netbsd.org&#62;.</div>
<div class="section">
<h1 id="x43415645415453">CAVEATS</h1> The <b class="name">module</b> framework is still under active development. At least two potential caveats can be mentioned.<ol style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 2.00ex;" class="list list-enum">
<li class="list-enum" style="margin-top: 1.00em;">
Kernel modules are built to operate only with a specific version of the <span class="unix">NetBSD</span> kernel. When the kernel is updated to a new version, the contents of the <i class="file">/stand/${ARCH}/${VERSION}/modules/</i> directory should be updated as well. (This location has been the subject of much discussion, and may change in future versions of <span class="unix">NetBSD</span>.)</li>
<li class="list-enum" style="margin-top: 1.00em;">
If an attempt is made to boot the operating system from a file system for which the module is not built into the kernel, the boot may fail with the message &#8220;Cannot mount root, error 79&#8221;. On certain architectures (currently, i386 and amd64), one may be able to recover from this error by using the &#8220;load xxxfs&#8221; command before trying to boot. This command is only available on newer bootloaders.</li>
</ol>
<p>
The absence of required modules or the inability of the bootloader to load the modules are common reasons for failures to boot a <b class="config">MODULAR</b> kernel. It may be a good practice to maintain a non-MODULAR kernel in the root file system for recovery purposes.</div>
<div class="section">
<h1 id="x534543555249545920434f4e53494445524154494f4e53">SECURITY CONSIDERATIONS</h1> A module becomes part of the kernel once loaded. Compared to userland programs, all errors in the code can be fatal. There is no memory protection between modules and the rest of the kernel. Hence, a potential attacker with access to the <a class="link-man" href="../html2/modctl.html">modctl(2)</a> system call can acquire complete and total control over the system.<p>
To avoid associated security risks, new modules can only be loaded when <i class="file">securelevel</i> is less than or equal to zero, or if the kernel was built with <b class="config">options INSECURE</b>. Refer to <a class="link-man" href="../html9/secmodel_securelevel.html">secmodel_securelevel(9)</a> for additional details on the <i class="file">securelevel</i>. Only use modules from trusted sources.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
December 14, 2010</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

