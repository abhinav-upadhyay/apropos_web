<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/../4/strict.dtd">
>
<head>
<meta http-equiv="Content-Type" content="te../; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
FSCK_LFS(8)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
FSCK_LFS(8)</td>
<td class="head-vol" align="center">
System Manager's Manual</td>
<td class="head-rtitle" align="right">
FSCK_LFS(8)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">fsck_lfs</b> &#8212; <span class="desc">Log-structured File System consistency check and interactive repair</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1><table class="synopsis">
<col style="width: 8.00ex;">
<col>
<tbody>
<tr>
<td>
fsck_lfs</td>
<td>
&#91;<span class="opt"><b class="flag">&#45;dfpqU</b></span>&#93; &#91;<span class="opt"><b class="flag">&#45;b</b> <i class="arg">block</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;m</b> <i class="arg">mode</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;y</b> | <b class="flag">&#45;n</b></span>&#93; <i class="arg">filesystem</i> <i class="arg">...</i></td>
</tr>
</tbody>
</table>
</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> <b class="name">fsck_lfs</b> performs interactive filesystem consistency checks and repair for each of the filesystems specified on the command line. It is normally invoked from <a class="link-man" href="../8/fsck">fsck(8)</a>.<p>
The design of LFS takes care that no filesystem inconsistencies can happen unless hardware or software failures intervene. <b class="name">fsck_lfs</b> will report and optionally correct any such inconsistencies.<p>
For each corrected inconsistency one or more lines will be printed identifying the filesystem on which the correction will take place, and the nature of the correction. After successfully correcting a filesystem, <b class="name">fsck_lfs</b> will print the number of files on that filesystem, the number of used and free blocks, and the percentage of fragmentation.<p>
If sent a <span class="define">QUIT</span> signal, <b class="name">fsck_lfs</b> will finish the filesystem checks, then exit with an abnormal return status.<p>
Without the <b class="flag">&#45;p</b> option, <b class="name">fsck_lfs</b> audits and interactively repairs inconsistent conditions for filesystems. If the filesystem is inconsistent, the operator is prompted for concurrence before each correction is attempted. It should be noted that some of the corrective actions will result in some loss of data. The amount and severity of data lost may be determined from the diagnostic output. The default action for each consistency correction is to wait for the operator to respond <code class="lit">yes</code> or <code class="lit">no</code>. If the operator does not have write permission on the filesystem <b class="name">fsck_lfs</b> will default to a <b class="flag">&#45;n</b> action.<p>
The following flags are interpreted by <b class="name">fsck_lfs</b>:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;b</b> <i class="arg">block</i></dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
Use <i class="arg">block</i> as the super block for the filesystem.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;d</b></dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
Print debugging output.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;f</b></dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
Force checking of file systems. Normally, if a file system is cleanly unmounted, the kernel will set a &#8220;clean flag&#8221; in the file system superblock, and <b class="name">fsck_lfs</b> will not check the file system. This option forces <b class="name">fsck_lfs</b> to check the file system, regardless of the state of the clean flag.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;m</b> <i class="arg">mode</i></dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
Use <i class="arg">mode</i> specified in octal as the permission bits to use when creating the <i class="file">lost+found</i> directory rather than the default 1700. In particular, systems that do not wish to have lost files accessible by all users on the system should use a more restrictive set of permissions such as 700.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;n</b></dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
Assume a no response to all questions asked by <b class="name">fsck_lfs</b> except for &#8216;<code class="lit">CONTINUE?</code>&#8217;, which is assumed to be affirmative; do not open the filesystem for writing.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;p</b></dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
Specify &#8220;preen&#8221; mode. Currently, in this mode <b class="name">fsck_lfs</b> does nothing.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;q</b></dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
Quiet mode, do not output any messages for clean filesystems.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;U</b></dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
Resolve user ids to user names.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;y</b></dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
Assume a yes response to all questions asked by <b class="name">fsck_lfs</b>; this should be used with great caution as this is a free license to continue after essentially unlimited trouble has been encountered.</dd>
</dl>
<p>
Inconsistencies checked are as follows:<ol style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-enum">
<li class="list-enum" style="margin-top: 0.00em;">
Blocks claimed by more than one inode.</li>
<li class="list-enum" style="margin-top: 0.00em;">
Blocks claimed by an inode outside the range of the filesystem.</li>
<li class="list-enum" style="margin-top: 0.00em;">
Incorrect link counts.</li>
<li class="list-enum" style="margin-top: 0.00em;">
Size checks:<ul style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-item">
<li class="list-item" style="margin-top: 0.00em;">
Directory size not a multiple of DIRBLKSIZ.</li>
<li class="list-item" style="margin-top: 0.00em;">
Partially truncated file.</li>
</ul>
</li>
<li class="list-enum" style="margin-top: 0.00em;">
Bad inode format.</li>
<li class="list-enum" style="margin-top: 0.00em;">
Directory checks:<ul style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-item">
<li class="list-item" style="margin-top: 0.00em;">
File pointing to unallocated inode.</li>
<li class="list-item" style="margin-top: 0.00em;">
Inode number out of range.</li>
<li class="list-item" style="margin-top: 0.00em;">
Dot or dot-dot not the first two entries of a directory or having the wrong inode number.</li>
</ul>
</li>
<li class="list-enum" style="margin-top: 0.00em;">
Super Block checks:<ul style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-item">
<li class="list-item" style="margin-top: 0.00em;">
More blocks for inodes than there are in the filesystem.</li>
</ul>
</li>
<li class="list-enum" style="margin-top: 0.00em;">
Index File checks:<ul style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-item">
<li class="list-item" style="margin-top: 0.00em;">
&#8220;In use&#8221; inodes on free list, or free inodes not on free list.</li>
<li class="list-item" style="margin-top: 0.00em;">
Segment block counts incorrect, or &#8220;clean&#8221; segments containing live data.</li>
</ul>
</li>
</ol>
<p>
Orphaned files and directories (allocated but unreferenced) are, with the operator's concurrence, reconnected by placing them in the <i class="file">lost+found</i> directory. The name assigned is the inode number. If the <i class="file">lost+found</i> directory does not exist, it is created. If there is insufficient space its size is increased.<p>
Because of inconsistencies between the block device and the buffer cache, the raw device should always be used.</div>
<div class="section">
<h1 id="x444941474e4f5354494353">DIAGNOSTICS</h1> The diagnostics produced by <b class="name">fsck_lfs</b> are fully enumerated and explained in Appendix A of <span class="ref"><span class="ref-title">Fsck &#45; The UNIX File System Check Program</span>.</span></div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../5/fstab">fstab(5)</a>, <a class="link-man" href="../8/fsck">fsck(8)</a>, <a class="link-man" href="../8/newfs_lfs">newfs_lfs(8)</a>, <a class="link-man" href="../8/reboot">reboot(8)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="name">fsck_lfs</b> program was first made available in <span class="unix">NetBSD&#160;1.4</span>.</div>
<div class="section">
<h1 id="x415554484f5253">AUTHORS</h1> Most of the <b class="name">fsck_lfs</b> program was taken from <a class="link-man" href="../8/fsck_ffs">fsck_ffs(8)</a>; what was not was written by <span class="author">Konrad Schroder</span> &#60;<a class="link-mail" href="mailto:perseant@NetBSD.org">perseant@NetBSD.org</a>&#62;.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
July 12, 2014</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
<>

