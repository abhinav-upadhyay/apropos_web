<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/../4/strict.dtd">
>
<head>
<meta http-equiv="Content-Type" content="te../; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
RWHOD(8)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
RWHOD(8)</td>
<td class="head-vol" align="center">
System Manager's Manual</td>
<td class="head-rtitle" align="right">
RWHOD(8)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">rwhod</b> &#8212; <span class="desc">system status server</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1><table class="synopsis">
<col style="width: 5.00ex;">
<col>
<tbody>
<tr>
<td>
rwhod</td>
<td>
&#91;<span class="opt"><b class="flag">&#45;i</b> <i class="arg">interval</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;u</b> <i class="arg">user</i></span>&#93;</td>
</tr>
</tbody>
</table>
</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> <b class="name">rwhod</b> is the server which maintains the database used by the <a class="link-man" href="../1/rwho">rwho(1)</a> and <a class="link-man" href="../1/ruptime">ruptime(1)</a> programs. Its operation is predicated on the ability to <span class="emph">broadcast</span> messages on a network.<p>
The following options are available:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;i</b> <i class="arg">interval</i></dt>
<dd class="list-tag" style="margin-left: 11.00ex;">
Allows for the broadcast interval to be changed from the default 3 minutes. The <i class="arg">interval</i> argument is the number of seconds to change the interval to, or if the value is suffixed by &#8220;m&#8221; then it is interpreted as minutes. The maximum allowed value for the broadcast interval is 11 minutes because higher values will cause <a class="link-man" href="../1/ruptime">ruptime(1)</a> to mark the host as being down.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;u</b> <i class="arg">user</i></dt>
<dd class="list-tag" style="margin-left: 11.00ex;">
Drop privileges and become the user <i class="arg">user</i>.</dd>
</dl>
<p>
<b class="name">rwhod</b> operates as both a producer and consumer of status information. As a producer of information it periodically queries the state of the system and constructs status messages which are broadcast on a network. As a consumer of information, it listens for other <b class="name">rwhod</b> servers' status messages, validating them, then recording them in a collection of files located in the directory <i class="file">/var/rwho</i>.<p>
The server transmits and receives messages at the port indicated in the &#8220;who&#8221; service specification; see <a class="link-man" href="../5/services">services(5)</a>. The messages sent and received, are of the form:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
struct	outmp { 
	char	out_line[8];		/* tty name */ 
	char	out_name[8];		/* user id */ 
	int32_t	out_time;		/* time on */ 
}; 
 
struct	whod { 
	char	wd_vers; 
	char	wd_type; 
	char	wd_fill[2]; 
	int32_t	wd_sendtime; 
	int32_t	wd_recvtime; 
	char	wd_hostname[32]; 
	int32_t	wd_loadav[3]; 
	int32_t	wd_boottime; 
	struct	whoent { 
		struct	outmp we_utmp; 
		int32_t	we_idle; 
	} wd_we[1024 / sizeof (struct whoent)]; 
};</pre>
<p>
All fields are converted to network byte order prior to transmission. The load averages are as calculated by the <a class="link-man" href="../1/w">w(1)</a> program, and represent load averages over the 5, 10, and 15 minute intervals prior to a server's transmission; they are multiplied by 100 for representation in an integer. The host name included is that returned by the <a class="link-man" href="../3/gethostname">gethostname(3)</a> function call, with any trailing domain name omitted. The array at the end of the message contains information about the users logged in to the sending machine. This information includes the contents of the <a class="link-man" href="../5/utmp">utmp(5)</a> entry for each non-idle terminal line and a value indicating the time in seconds since a character was last received on the terminal line.<p>
Messages received by the <a class="link-man" href="../1/rwho">rwho(1)</a> server are discarded unless they originated at an <a class="link-man" href="../1/rwho">rwho(1)</a> server's port. In addition, if the host's name, as specified in the message, contains any unprintable ASCII characters, the message is discarded. Valid messages received by <b class="name">rwhod</b> are placed in files named <i class="file">whod.hostname</i> in the directory <i class="file">/var/rwho</i>. These files contain only the most recent message, in the format described above.<p>
Status messages are generated by default approximately once every 3 minutes.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../1/ruptime">ruptime(1)</a>, <a class="link-man" href="../1/rwho">rwho(1)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="name">rwhod</b> command appeared in <span class="unix">4.2BSD</span>.</div>
<div class="section">
<h1 id="x42554753">BUGS</h1> There should be a way to relay status information between networks. Status information should be sent only upon request rather than continuously. People often interpret the server dying or network communication failures as a machine going down.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
September 12, 2005</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
<>

