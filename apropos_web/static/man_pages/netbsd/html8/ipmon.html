<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
IPMON(8)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
IPMON(8)</td>
<td class="head-vol" align="center">
System Manager's Manual</td>
<td class="head-rtitle" align="right">
IPMON(8)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1>NAME</h1> ipmon &#45; monitors /dev/ipl for logged packets</div>
<div class="section">
<h1>SYNOPSIS</h1> <b>ipmon</b> [ <b>&#45;abBDFhnpstvxX</b> ] [ <b>&#45;N &lt;device&gt;</b> ] [ <b>&#45;L &lt;facility&gt;</b> ] [ <b>&#45;o [NSI]</b> ] [ <b>&#45;O [NSI]</b> ] [ <b>&#45;P &lt;pidfile&gt;</b> ] [ <b>&#45;S &lt;device&gt;</b> ] [ <b>&#45;f &lt;device&gt;</b> ] [ <b>&lt;filename&gt;</b> ]</div>
<div class="section">
<h1>DESCRIPTION</h1>  <b>ipmon</b> opens <b>/dev/ipl</b> for reading and awaits data to be saved from the packet filter.  The binary data read from the device is reprinted in human readable for, however, IP#'s are not mapped back to hostnames, nor are ports mapped back to service names.  The output goes to standard output by default or a filename, if given on the command line.  Should the  <b>&#45;s</b> option be used, output is instead sent to  <b>syslogd(8)</b>.  Messages sent via syslog have the day, month and year removed from the message, but the time (including microseconds), as recorded in the log, is still included.<p>
Messages generated by ipmon consist of whitespace separated fields. Fields common to all messages are:<p>
1. The date of packet receipt. This is suppressed when the message is sent to syslog.<p>
2. The time of packet receipt. This is in the form HH:MM:SS.F, for hours, minutes seconds, and fractions of a second (which can be several digits long).<p>
3. The name of the interface the packet was processed on, e.g., <b>we1</b>.<p>
4. The group and rule number of the rule, e.g., <b>@0:17</b>. These can be viewed with  <b>ipfstat -n</b>.<p>
5. The action: <b>p</b> for passed, <b>b</b> for blocked, <b></b> for a short packet,  <b>n</b> did not match any rules or <b>L</b> for a log rule.<p>
6. The addresses. This is actually three fields: the source address and port (separated by a comma), the  <b>-&gt;</b> symbol, and the destination address and port. E.g.:  <b>209.53.17.22,80 -&gt; 198.73.220.17,1722</b>.<p>
7. <b>PR</b> followed by the protocol name or number, e.g., <b>PR tcp</b>.<p>
8. <b>len</b> followed by the header length and total length of the packet, e.g.,  <b>len 20 40</b>.<p>
If the packet is a TCP packet, there will be an additional field starting with a hyphen followed by letters corresponding to any flags that were set. See the ipf.conf manual page for a list of letters and their flags.<p>
If the packet is an ICMP packet, there will be two fields at the end, the first always being `icmp', and the next being the ICMP message and submessage type, separated by a slash, e.g.,  <b>icmp 3/3</b> for a port unreachable message.<p>
In order for <b>ipmon</b> to properly work, the kernel option  <b>IPFILTER_LOG</b> must be turned on in your kernel.  Please see  <b>options(4)</b> for more details.<p>
<b>ipmon</b> reopens its log file(s) and rereads its configuration file when it receives a SIGHUP signal.</div>
<div class="section">
<h1>OPTIONS</h1><dl>
<dt>
<b>&#45;a</b></dt>
<dd>
Open all of the device logfiles for reading log entries from.  All entries are displayed to the same output 'device' (stderr or syslog).</dd>
</dl>
<dl>
<dt>
<b>&#45;b</b></dt>
<dd>
For rules which log the body of a packet, generate hex output representing the packet contents after the headers.</dd>
</dl>
<dl>
<dt>
<b>&#45;B &lt;binarylogfilename&gt;</b></dt>
<dd>
Enable logging of the raw, unformatted binary data to the specified  <i>&lt;binarylogfilename&gt;</i> file.  This can be read, later, using <b>ipmon</b> with the  <b>-f</b> option.</dd>
</dl>
<dl>
<dt>
<b>&#45;D</b></dt>
<dd>
Cause ipmon to turn itself into a daemon.  Using subshells or backgrounding of ipmon is not required to turn it into an orphan so it can run indefinitely.</dd>
</dl>
<dl>
<dt>
<b>&#45;f &lt;device&gt;</b></dt>
<dd>
specify an alternative device/file from which to read the log information for normal IP Filter log records.</dd>
</dl>
<dl>
<dt>
<b>&#45;F</b></dt>
<dd>
Flush the current packet log buffer.  The number of bytes flushed is displayed, even should the result be zero.</dd>
</dl>
<dl>
<dt>
<b>&#45;L &lt;facility&gt;</b></dt>
<dd>
Using this option allows you to change the default syslog facility that ipmon uses for syslog messages.  The default is local0.</dd>
</dl>
<dl>
<dt>
<b>&#45;n</b></dt>
<dd>
IP addresses and port numbers will be mapped, where possible, back into hostnames and service names.</dd>
</dl>
<dl>
<dt>
<b>&#45;N &lt;device&gt;</b></dt>
<dd>
Set the logfile to be opened for reading NAT log records from to &lt;device&gt;.</dd>
</dl>
<dl>
<dt>
<b>&#45;o</b></dt>
<dd>
Specify which log files to actually read data from.  N - NAT logfile, S - State logfile, I - normal IP Filter logfile.  The  <b>-a</b> option is equivalent to using  <b>-o NSI</b>.</dd>
</dl>
<dl>
<dt>
<b>&#45;O</b></dt>
<dd>
Specify which log files you do not wish to read from.  This is most sensibly used with the  <b>-a</b>.  Letters available as parameters to this are the same as for  <b>-o</b>.</dd>
</dl>
<dl>
<dt>
<b>&#45;p</b></dt>
<dd>
Cause the port number in log messages to always be printed as a number and never attempt to look it up as from  <i>/etc/services</i>, etc.</dd>
</dl>
<dl>
<dt>
<b>&#45;P &lt;pidfile&gt;</b></dt>
<dd>
Write the pid of the ipmon process to a file.  By default this is  <i>//etc/opt/ipf/ipmon.pid</i> (Solaris), <i>/var/run/ipmon.pid</i> (44BSD or later) or  <i>/etc/ipmon.pid</i> for all others.</dd>
</dl>
<dl>
<dt>
<b>&#45;s</b></dt>
<dd>
Packet information read in will be sent through syslogd rather than saved to a file.  The default facility when compiled and installed is  <b>local0</b>.  The following levels are used:</dd>
</dl>
<dl>
<dt>
</dt>
<dd>
<b>LOG_INFO</b> &#45; packets logged using the "log" keyword as the action rather than pass or block.</dd>
</dl>
<dl>
<dt>
</dt>
<dd>
<b>LOG_NOTICE</b> &#45; packets logged which are also passed</dd>
</dl>
<dl>
<dt>
</dt>
<dd>
<b>LOG_WARNING</b> &#45; packets logged which are also blocked</dd>
</dl>
<dl>
<dt>
</dt>
<dd>
<b>LOG_ERR</b> &#45; packets which have been logged and which can be considered "short".</dd>
</dl>
<dl>
<dt>
<b>&#45;S &lt;device&gt;</b></dt>
<dd>
Set the logfile to be opened for reading state log records from to &lt;device&gt;.</dd>
</dl>
<dl>
<dt>
<b>&#45;t</b></dt>
<dd>
read the input file/device in a manner akin to tail(1).</dd>
</dl>
<dl>
<dt>
<b>&#45;v</b></dt>
<dd>
show tcp window, ack and sequence fields.</dd>
</dl>
<dl>
<dt>
<b>&#45;x</b></dt>
<dd>
show the packet data in hex.</dd>
</dl>
<dl>
<dt>
<b>&#45;X</b></dt>
<dd>
show the log header record data in hex.</dd>
</dl>
</div>
<div class="section">
<h1>DIAGNOSTICS</h1>  <b>ipmon</b> expects data that it reads to be consistent with how it should be saved and will abort if it fails an assertion which detects an anomaly in the recorded data.</div>
<div class="section">
<h1>FILES</h1> /dev/ipl<div style="height: 0.00em;">
&#160;</div>
/dev/ipnat<div style="height: 0.00em;">
&#160;</div>
/dev/ipstate<div style="height: 0.00em;">
&#160;</div>
/etc/services</div>
<div class="section">
<h1>SEE ALSO</h1> ipl(4), ipf(8), ipfstat(8), ipnat(8)</div>
<div class="section">
<h1>BUGS</h1> If you find any, please send email to me at darrenr@pobox.com</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tr>
<td class="foot-date">
</td>
<td class="foot-os" align="right">
</td>
</tr>
</table>
</div>
</body>
</html>

