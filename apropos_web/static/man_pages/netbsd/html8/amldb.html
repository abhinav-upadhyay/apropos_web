<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="/static/man_pages/netbsd/style.css" type="text/css" media="all">
<title>
AMLDB(8)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
AMLDB(8)</td>
<td class="head-vol" align="center">
System Manager's Manual</td>
<td class="head-rtitle" align="right">
AMLDB(8)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">amldb</b> &#8212; <span class="desc">executing and debugging AML interpreter (with DSDT files)</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1><table class="synopsis">
<col style="width: 5.00ex;">
<col>
<tbody>
<tr>
<td>
amldb</td>
<td>
&#91;<span class="opt"><b class="flag">&#45;dhst</b></span>&#93; <i class="arg">dsdt_file ...</i></td>
</tr>
</tbody>
</table>
</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="name">amldb</b> utility parses the DSDT (Differentiated System Description Table) files, which usually are acquired from ACPI BIOS, and executes the sequence of ACPI Control Methods described in AML (ACPI Machine Language) with its AML interpreter. The <b class="name">amldb</b> utility also has a simple ACPI virtual machine. During execution of the Control Methods each access to the region, such as SystemMemory, SystemIO, PCI_Config, does not affect the real hardware but only the virtual machine. Because the sequence of virtual accesses is maintained in user space, AML interpreter developers need not worry about any effect on hardware when they analyze DSDT data files. They can develop and debug the interpreter, even if the machine has no ACPI BIOS.<p>
The developer will need to acquire a DSDT data file from any machine with ACPI BIOS through <a class="link-man" href="../8/acpidump">acpidump(8)</a>. The DSDT is a table, a part of the whole ACPI memory table located in somewhere in the BIOS area (<code class="lit">0xa0000 &#45; 0x100000</code>). It includes such information as the detailed hardware information for PnP, and the set of procedures which perform power management from the OS. The information is stored in AML format.<p>
The AML interpreter can execute any of the Control Methods specified by users. When executed, it interprets the byte sequence in the Control Method of DSDT, and disassembles the opcodes that it recognizes into ASL (ACPI Source Language) format to be displayed.<p>
If it encounters one of more accesses to the region such as SystemMemory in executing the Control Methods, its ACPI Virtual Machine simulates the input/output operations to the resources in the region. In writing to a certain region, the ACPI Virtual Machine prepares a piece of memory corresponding to its address, if necessary, and holds the specified value in the memory as the <span class="emph">region contents</span>. In reading from a certain region, it fetches the value in the memory (<span class="emph">region contents</span>), prompts with it as the following:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
DEBUG[read(0, 0x100b6813)&amp;mask:0x1](default: 0x1 / 1) &gt;&gt;</pre>
<p>
for users to have the opportunity to modify it, and hands it to the AML interpreter. In case that there is no corresponding region in the AML Virtual Machine, the value zero is handed.<p>
The interpreter continues to maintain all of the <span class="emph">region contents</span> until <b class="name">amldb</b> terminates. You can specify their initial values with the file <i class="file">region.ini</i> in the current directory. If it is executed with <b class="flag">&#45;d</b> option, it dumps the final status of all of its <span class="emph">region contents</span> to the file <i class="file">region.dmp</i> when it terminates. Each line of there files consists of the following fields, separated by tabs; region type, address, and value. Region types are specified as follows;<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="symb">Value</span></dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
<span class="symb">Region type</span></dd>
<dt class="list-tag" style="margin-top: 0.00em;">
0</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
SystemMemory</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
1</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
SystemIO</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
2</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
PCI_Config</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
3</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
EmbeddedControl</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
4</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
SMBus</dd>
</dl>
<p>
Interactive commands are described below:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">s</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
<span class="emph">Single step</span>: Performs single-step execution of the current Control Method. If the next instruction is an invocation of another Control Method, the step execution will continue in the following Control Method.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">n</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
<span class="emph">Step program</span>: Performs single-step execution of the current Control Method. Even if the next instruction is an invocation of another Control Method, the step execution will not continue.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">c</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
<span class="emph">Continue program being debugged</span>: Resumes execution of the AML interpreter. Because the current <b class="name">amldb</b> has no way of breakpoint, this command might not so much useful.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">q</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
<span class="emph">Quit method execution</span>: Terminates execution of the current Control Method. If <b class="name">amldb</b> is not in execution, this command causes to input the next DSDT data file. If there are no next DSDT data files, it terminates <b class="name">amldb</b> itself.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">t</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
<span class="emph">Show local name space tree and variables</span>: Displays the structure of the ACPI namespace tree. If <b class="name">amldb</b> is in execution, this command displays the structure that relates to the objects, arguments, and local variables below the scope of the current Control Method.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">i</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
<span class="emph">Toggle region input prompt</span>: Switches whether the prompt for modifying the value read from the <span class="emph">region contents</span> be showed or not. Default is On.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">o</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
<span class="emph">Toggle region output prompt</span>: Switches whether the prompt for modifying the value to be written to the region contents will be shown or not. The default is Off.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">m</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
<span class="emph">Show memory management statistics</span>: Displays the current statistics of the memory management system on the AML interpreter.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">r</b> <i class="arg">method</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
<span class="emph">Run specified method</span>: Executes the specified Control Method. If it requires one or more arguments, a prompt such as the following appears;<p>
<pre style="margin-left: 0.00ex;" class="lit display">
Method: Arg 1 From 0x280626ce To 0x28062775 
  Enter argument values (ex. number 1 / string foo). 'q' to quit. 
  Arg0 ?</pre>
<p>
For each argument, a pair of type string and value delimited by one or more spaces can be entered. Now only <b class="cmd">number</b> and <b class="cmd">string</b> can be specified as the type string. In the current implementation, only the first character of the type string, such as <b class="cmd">n</b> or <b class="cmd">s</b>, is identified. For example, we can enter as follows:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
  Arg0 ? n 1</pre>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">f</b> <i class="arg">string</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
<span class="emph">Find named objects from namespace</span>: Lists the named objects that includes the specified string as the terminate elements searching from the ACPI namespace. For the namespace is expressed as the sequence of four-character elements, appropriate number of additional underscore (&#8216;<code class="lit">_</code>&#8217;) characters are necessary for specifying objects which have less than four character string. Unless additional underscores specified, matching occurs as the beginning of word with the specified number of characters.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">h</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
<span class="emph">Show help messsage</span>: Displays the command summary of <b class="name">amldb</b>.</dd>
</dl>
</div>
<div class="section">
<h1 id="x4f5054494f4e53">OPTIONS</h1> Exactly one of the following options must be specified. Otherwise, <b class="name">amldb</b> shows its usage and terminates.<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;d</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Dump the final status of all of the <span class="emph">region contents</span> in the ACPI Virtual Machine to the file <i class="file">region.dmp</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;h</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Terminate with the usage of this command.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;s</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Display the statistics of the memory management system on the AML interpreter when <b class="name">amldb</b> terminates.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;t</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Display the tree structure of ACPI namespace after the DSDT data file is read.</dd>
</dl>
</div>
<div class="section">
<h1 id="x46494c4553">FILES</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">region.ini</i></dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">region.dmp</i></dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
</dd>
</dl>
</div>
<div class="section">
<h1 id="x4558414d504c4553">EXAMPLES</h1> The following is an example including, invoking the <b class="name">amldb</b>, searching <code class="lit">_PRS</code> (Possible Resource Settings) objects, and executing the <code class="lit">_PTS</code> (Prepare To Sleep) Control Method by the AML interpreter.<p>
<pre style="margin-left: 5.00ex;" class="lit display">
% amldb p2b.dsdt.dat 
Loading p2b.dsdt.dat...done 
AML&gt;f _PRS 
\_SB_.PCI0.ISA_.PS2M._PRS. 
\_SB_.PCI0.ISA_.IRDA._PRS. 
\_SB_.PCI0.ISA_.UAR2._PRS. 
\_SB_.PCI0.ISA_.UAR1._PRS. 
\_SB_.PCI0.ISA_.ECP_._PRS. 
\_SB_.PCI0.ISA_.LPT_._PRS. 
\_SB_.PCI0.ISA_.FDC0._PRS. 
\_SB_.LNKD._PRS. 
\_SB_.LNKC._PRS. 
\_SB_.LNKB._PRS. 
\_SB_.LNKA._PRS. 
AML&gt;r _PTS 
Method: Arg 1 From 0x2805f0a3 To 0x2805f0db 
  Enter argument values (ex. number 1 / string foo). 'q' to quit. 
  Arg0 ? n 5 
==== Running _PTS. ==== 
AML&gt;s 
[\_PTS. START] 
If(LNot(LEqual(Arg0, 0x5))) 
AML&gt; 
If(LEqual(Arg0, 0x1)) 
AML&gt; 
If(LEqual(Arg0, 0x2)) 
AML&gt; 
Store(One, TO12) 
[aml_region_write(1, 1, 0x1, 0xe42c, 0x18, 0x1)] 
amldb: region.ini: No such file or directory 
        [1:0x00@0xe42f]-&gt;[1:0x01@0xe42f] 
[write(1, 0x1, 0xe42f)] 
[aml_region_read(1, 1, 0xe42c, 0x18, 0x1)] 
        [1:0x01@0xe42f] 
DEBUG[read(1, 0xe42f)&amp;mask:0x1](default: 0x1 / 1) &gt;&gt; 
[read(1, 0xe42f)-&gt;0x1] 
AML&gt; 
Or(Arg0, 0xf0, Local2)[Copy number 0xf5] 
AML&gt;t 
_PTS  Method: Arg 1 From 0x2805f0a3 To 0x2805f0db 
  Arg0    Num:0x5 
  Local2  Num:0xf5 
AML&gt;s 
Store(Local2, DBG1) 
[aml_region_write(1, 1, 0xf5, 0x80, 0x0, 0x8)] 
        [1:0x00@0x80]-&gt;[1:0xf5@0x80] 
[write(1, 0xf5, 0x80)] 
[aml_region_read(1, 1, 0x80, 0x0, 0x8)] 
        [1:0xf5@0x80] 
DEBUG[read(1, 0x80)&amp;mask:0xf5](default: 0xf5 / 245) &gt;&gt; 
[read(1, 0x80)-&gt;0xf5] 
AML&gt; 
[\_PTS. END] 
_PTS  Method: Arg 1 From 0x2805f0a3 To 0x2805f0db 
NO object 
==== _PTS finished. ==== 
AML&gt;q 
%</pre>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../4/acpi">acpi(4)</a>, <a class="link-man" href="../8/acpidump">acpidump(8)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="name">amldb</b> utility appeared in <span class="unix">FreeBSD&#160;5.0</span>.</div>
<div class="section">
<h1 id="x415554484f5253">AUTHORS</h1> <span class="author">Takanori Watanabe</span> &#60;<a class="link-mail" href="mailto:takawata@FreeBSD.org">takawata@FreeBSD.org</a>&#62; <span class="author">Mitsuru IWASAKI</span> &#60;<a class="link-mail" href="mailto:iwasaki@FreeBSD.org">iwasaki@FreeBSD.org</a>&#62; <span class="author">Yasuo YOKOYAMA</span> &#60;<a class="link-mail" href="mailto:yokoyama@jp.FreeBSD.org">yokoyama@jp.FreeBSD.org</a>&#62;<p>
Some contributions made by <span class="author">Chitoshi Ohsawa</span> &#60;<a class="link-mail" href="mailto:ohsawa@catv1.ccn-net.ne.jp">ohsawa@catv1.ccn-net.ne.jp</a>&#62;, <span class="author">Takayasu IWANASHI</span> &#60;<a class="link-mail" href="mailto:takayasu@wendy.a.perfect-liberty.or.jp">takayasu@wendy.a.perfect-liberty.or.jp</a>&#62;, <span class="author">Norihiro KUMAGAI</span> &#60;<a class="link-mail" href="mailto:kumagai@home.com">kumagai@home.com</a>&#62;, <span class="author">Kenneth Ingham</span> &#60;<a class="link-mail" href="mailto:ingham@I-pi.com">ingham@I-pi.com</a>&#62;, and <span class="author">Michael Lucas</span> &#60;<a class="link-mail" href="mailto:mwlucas@blackhelicopters.org">mwlucas@blackhelicopters.org</a>&#62;.</div>
<div class="section">
<h1 id="x42554753">BUGS</h1> The ACPI virtual machine does not completely simulate the behavior of a machine with an ACPI BIOS. In the current implementation, the ACPI virtual machine only reads or writes the stored values by emulating access to regions such as SystemMemory.<p>
Because the AML interpreter interprets and disassembles simultaneously, it is impossible to implement such features as setting breakpoints with the specified line number in ASL. Setting breakpoints at certain Control Methods, which is not very difficult, has not yet implemented because nobody has ever needed it.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
August 31, 2000</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

