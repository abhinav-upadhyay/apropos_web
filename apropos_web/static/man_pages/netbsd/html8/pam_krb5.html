<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
PAM_KRB5(8)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
PAM_KRB5(8)</td>
<td class="head-vol" align="center">
System Manager's Manual</td>
<td class="head-rtitle" align="right">
PAM_KRB5(8)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">pam_krb5</b> &#8212; <span class="desc">Kerberos 5 PAM module</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> &#91;<span class="opt"><i class="arg">service-name</i></span>&#93; <i class="arg">module-type</i> <i class="arg">control-flag</i> <i class="file">pam_krb5</i> &#91;<span class="opt"><i class="arg">arguments</i></span>&#93;</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The Kerberos 5 service module for PAM provides functionality for three PAM categories: authentication, account management, and password management. It also provides null functions for session management.<div class="subsection">
<h2 id="x4b65726265726f7320352041757468656e7469636174696f6e204d6f64756c65">Kerberos 5 Authentication Module</h2> The Kerberos 5 authentication component provides functions to verify the identity of a user (<b class="fname">pam_sm_authenticate</b>()) and to set user specific credentials (<b class="fname">pam_sm_setcred</b>()). <b class="fname">pam_sm_authenticate</b>() converts the supplied username into a Kerberos principal, by appending the default local realm name. It also supports usernames with explicit realm names. If a realm name is supplied, then upon a successful return, it changes the username by mapping the principal name into a local username (calling <b class="fname">krb5_aname_to_localname</b>()). This typically just means the realm name is stripped.<p>
It prompts the user for a password and obtains a new Kerberos TGT for the principal. The TGT is verified by obtaining a service ticket for the local host.<p>
When prompting for the current password, the authentication module will use the prompt &#8220;<code class="lit">Password for &lt;principal&gt;:</code>&#8221;.<p>
The <b class="fname">pam_sm_setcred</b>() function stores the newly acquired credentials in a credentials cache, and sets the environment variable <span class="env">KRB5CCNAME</span> appropriately. The credentials cache should be destroyed by the user at logout with <a class="link-man" href="../1/kdestroy">kdestroy(1)</a>.<p>
The following options may be passed to the authentication module:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">debug</b></dt>
<dd class="list-tag" style="margin-left: 18.00ex;">
<a class="link-man" href="../3/syslog">syslog(3)</a> debugging information at <span class="define">LOG_DEBUG</span> level.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">no_warn</b></dt>
<dd class="list-tag" style="margin-left: 18.00ex;">
suppress warning messages to the user. These messages include reasons why the user's authentication attempt was declined.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">use_first_pass</b></dt>
<dd class="list-tag" style="margin-left: 18.00ex;">
If the authentication module is not the first in the stack, and a previous module obtained the user's password, that password is used to authenticate the user. If this fails, the authentication module returns failure without prompting the user for a password. This option has no effect if the authentication module is the first in the stack, or if no previous modules obtained the user's password.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">try_first_pass</b></dt>
<dd class="list-tag" style="margin-left: 18.00ex;">
This option is similar to the <b class="flag">use_first_pass</b> option, except that if the previously obtained password fails, the user is prompted for another password.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">renewable</b>=<i class="arg">timeperiod</i></dt>
<dd class="list-tag" style="margin-left: 18.00ex;">
Obtain renewable Kerberos credentials for the user. The renewable time can be specified, or it defaults to one month. Since spaces are not allowed in the pam configuration time, underscores are used to form parseable times (e.g., 1_month).</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">forwardable</b></dt>
<dd class="list-tag" style="margin-left: 18.00ex;">
Obtain forwardable Kerberos credentials for the user.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">no_ccache</b></dt>
<dd class="list-tag" style="margin-left: 18.00ex;">
Do not save the obtained credentials in a credentials cache. This is a useful option if the authentication module is used for services such as ftp or pop, where the user would not be able to destroy them. [This is not a recommendation to use the module for those services.]</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">ccache</b>=<i class="arg">name</i></dt>
<dd class="list-tag" style="margin-left: 18.00ex;">
Use <i class="arg">name</i> as the credentials cache. <i class="arg">name</i> must be in the form <i class="arg">type</i>:<i class="arg">residual</i>. The special tokens &#8216;<code class="lit">%u</code>&#8217;, to designate the decimal UID of the user; and &#8216;<code class="lit">%p</code>&#8217;, to designate the current process ID; can be used in <i class="arg">name</i>.</dd>
</dl>
</div>
<div class="subsection">
<h2 id="x4b65726265726f732035204163636f756e74204d616e6167656d656e74204d6f64756c65">Kerberos 5 Account Management Module</h2> The Kerberos 5 account management component provides a function to perform account management, <b class="fname">pam_sm_acct_mgmt</b>(). The function verifies that the authenticated principal is allowed to login to the local user account by calling <b class="fname">krb5_kuserok</b>() (which checks the user's <i class="file">.k5login</i> file).</div>
<div class="subsection">
<h2 id="x4b65726265726f7320352050617373776f7264204d616e6167656d656e74204d6f64756c65">Kerberos 5 Password Management Module</h2> The Kerberos 5 password management component provides a function to change passwords (<b class="fname">pam_sm_chauthtok</b>()). The username supplied (the user running the <a class="link-man" href="../1/passwd">passwd(1)</a> command, or the username given as an argument) is mapped into a Kerberos principal name, using the same technique as in the authentication module. Note that if a realm name was explicitly supplied during authentication, but not during a password change, the mapping done by the password management module may not result in the same principal as was used for authentication.<p>
Unlike when changing a <span class="unix">UNIX</span> password, the password management module will allow any user to change any principal's password (if the user knows the principal's old password, of course). Also unlike <span class="unix">UNIX</span>, root is always prompted for the principal's old password.<p>
The password management module uses the same heuristics as <a class="link-man" href="../1/kpasswd">kpasswd(1)</a> to determine how to contact the Kerberos password server.<p>
The following options may be passed to the password management module:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">debug</b></dt>
<dd class="list-tag" style="margin-left: 18.00ex;">
<a class="link-man" href="../3/syslog">syslog(3)</a> debugging information at <span class="define">LOG_DEBUG</span> level.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">use_first_pass</b></dt>
<dd class="list-tag" style="margin-left: 18.00ex;">
If the password management module is not the first in the stack, and a previous module obtained the user's old password, that password is used to authenticate the user. If this fails, the password management module returns failure without prompting the user for the old password. If successful, the new password entered to the previous module is also used as the new Kerberos password. If the new password fails, the password management module returns failure without prompting the user for a new password.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">try_first_pass</b></dt>
<dd class="list-tag" style="margin-left: 18.00ex;">
This option is similar to the <b class="flag">use_first_pass</b> option, except that if the previously obtained old or new passwords fail, the user is prompted for them.</dd>
</dl>
</div>
<div class="subsection">
<h2 id="x4b65726265726f7320352053657373696f6e204d616e6167656d656e74204d6f64756c65">Kerberos 5 Session Management Module</h2> The Kerberos 5 session management component provides functions to initiate (<b class="fname">pam_sm_open_session</b>()) and terminate (<b class="fname">pam_sm_close_session</b>()) sessions. Since session management is not defined under Kerberos 5, both of these functions simply return success. They are provided only because of the naming conventions for PAM modules.</div>
</div>
<div class="section">
<h1 id="x454e5649524f4e4d454e54">ENVIRONMENT</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="env">KRB5CCNAME</span></dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
Location of the credentials cache.</dd>
</dl>
</div>
<div class="section">
<h1 id="x46494c4553">FILES</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/tmp/krb5cc_</i><i class="arg">uid</i></dt>
<dd class="list-tag" style="margin-left: 26.00ex;">
default credentials cache (<i class="arg">uid</i> is the decimal UID of the user).</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">$HOME/.k5login</i></dt>
<dd class="list-tag" style="margin-left: 26.00ex;">
file containing Kerberos principals that are allowed access.</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../1/kdestroy">kdestroy(1)</a>, <a class="link-man" href="../1/passwd">passwd(1)</a>, <a class="link-man" href="../3/syslog">syslog(3)</a>, <a class="link-man" href="../5/pam.conf">pam.conf(5)</a>, <a class="link-man" href="../8/pam">pam(8)</a></div>
<div class="section">
<h1 id="x4e4f544553">NOTES</h1> Applications should not call <b class="fname">pam_authenticate</b>() more than once between calls to <b class="fname">pam_start</b>() and <b class="fname">pam_end</b>() when using the Kerberos 5 PAM module.</div>
<div class="section">
<h1 id="x534543555249545920434f4e53494445524154494f4e53">SECURITY CONSIDERATIONS</h1> The <b class="name">pam_krb5</b> module implements what is fundamentally a password authentication scheme. It does not use a Kerberos 5 exchange between client and server, but rather authenticates the password provided by the client against the Kerberos KDC. Therefore, care should be taken to only use this module over a secure session (secure TTY, encrypted session, etc.), otherwise the user's Kerberos 5 password could be compromised.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
March 10, 2007</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

