<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="/static/man_pages/netbsd/style.css" type="text/css" media="all">
<title>
RSHD(8)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
RSHD(8)</td>
<td class="head-vol" align="center">
System Manager's Manual</td>
<td class="head-rtitle" align="right">
RSHD(8)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">rshd</b> &#8212; <span class="desc">remote shell server</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1><table class="synopsis">
<col style="width: 4.00ex;">
<col>
<tbody>
<tr>
<td>
rshd</td>
<td>
&#91;<span class="opt"><b class="flag">&#45;aLln</b></span>&#93;</td>
</tr>
</tbody>
</table>
</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="name">rshd</b> server is the server for the <a class="link-man" href="../3/rcmd">rcmd(3)</a> routine and, consequently, for the <a class="link-man" href="../1/rsh">rsh(1)</a> program. The server provides remote execution facilities with authentication based on privileged port numbers from trusted hosts.<p>
The <b class="name">rshd</b> server listens for service requests at the port indicated in the &#8220;cmd&#8221; service specification; see <a class="link-man" href="../5/services">services(5)</a>. When a service request is received the following protocol is initiated:<ol style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-enum">
<li class="list-enum" style="margin-top: 1.00em;">
The server checks the client's source port. If the port is not in the range 512-1023, the server aborts the connection.</li>
<li class="list-enum" style="margin-top: 1.00em;">
The server reads characters from the socket up to a null (&#8216;&#92;0&#8217;) byte. The resultant string is interpreted as an ASCII number, base 10.</li>
<li class="list-enum" style="margin-top: 1.00em;">
If the number received in step 2 is non-zero, it is interpreted as the port number of a secondary stream to be used for the <span class="emph">stderr</span>. A second connection is then created to the specified port on the client's machine. The source port of this second connection is also in the range 512-1023.</li>
<li class="list-enum" style="margin-top: 1.00em;">
The server checks the client's source address and requests the corresponding host name (see <a class="link-man" href="../3/getnameinfo">getnameinfo(3)</a>, <a class="link-man" href="../5/hosts">hosts(5)</a>, and <a class="link-man" href="../8/named">named(8)</a>). If the hostname cannot be determined, the dot-notation representation of the host address is used. If the hostname is in the same domain as the server (according to the last two components of the domain name), or if the <b class="flag">&#45;a</b> option is given, the addresses for the hostname are requested, verifying that the name and address correspond. If address verification fails, the connection is aborted with the message &#8220;Host address mismatch.&#8221;</li>
<li class="list-enum" style="margin-top: 1.00em;">
A null terminated user name of at most 16 characters is retrieved on the initial socket. This user name is interpreted as the user identity on the <span class="emph">client</span>'s machine.</li>
<li class="list-enum" style="margin-top: 1.00em;">
A null terminated user name of at most 16 characters is retrieved on the initial socket. This user name is interpreted as a user identity to use on the <span class="symb">server</span>'s machine.</li>
<li class="list-enum" style="margin-top: 1.00em;">
A null terminated command to be passed to a shell is retrieved on the initial socket. The length of the command is limited by the upper bound on the size of the system's argument list.</li>
<li class="list-enum" style="margin-top: 1.00em;">
<b class="name">rshd</b> then validates the user using <a class="link-man" href="../3/ruserok">ruserok(3)</a>, which uses the file <i class="file">/etc/hosts.equiv</i> and the <i class="file">.rhosts</i> file found in the user's home directory. The <b class="flag">&#45;l</b> option prevents <a class="link-man" href="../3/ruserok">ruserok(3)</a> from doing any validation based on the user's &#8220;<i class="file">.rhosts</i>&#8221; file, unless the user is the superuser.</li>
<li class="list-enum" style="margin-top: 1.00em;">
If the file <i class="file">/etc/nologin</i> exists and the user is not the superuser, the connection is closed.</li>
<li class="list-enum" style="margin-top: 1.00em;">
A null byte is returned on the initial socket and the command line is passed to the normal login shell of the user. The shell inherits the network connections established by <b class="name">rshd</b>.</li>
</ol>
<p>
Transport-level keepalive messages are enabled unless the <b class="flag">&#45;n</b> option is present. The use of keepalive messages allows sessions to be timed out if the client crashes or becomes unreachable.<p>
The <b class="flag">&#45;L</b> option causes all successful accesses to be logged to <a class="link-man" href="../8/syslogd">syslogd(8)</a> as <code class="lit">auth.info</code> messages.</div>
<div class="section">
<h1 id="x444941474e4f5354494353">DIAGNOSTICS</h1> Except for the last one listed below, all diagnostic messages are returned on the initial socket, after which any network connections are closed. An error is indicated by a leading byte with a value of 1 (0 is returned in step 10 above upon successful completion of all the steps prior to the execution of the login shell).<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">Locuser too long.</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The name of the user on the client's machine is longer than 16 characters.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">Ruser too long.</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The name of the user on the remote machine is longer than 16 characters.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">Command too long</span>.</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The command line passed exceeds the size of the argument list (as configured into the system).</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">Login incorrect.</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
No password file entry for the user name existed.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">Remote directory.</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The <a class="link-man" href="../2/chdir">chdir(2)</a> to the home directory failed.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">Permission denied.</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The authentication procedure described above failed.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">Can't make pipe.</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The pipe needed for the <span class="emph">stderr</span>, wasn't created.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">Can't fork; try again.</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
A <a class="link-man" href="../2/fork">fork(2)</a> by the server failed.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">&lt;shellname&gt;: ...</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The user's login shell could not be started. This message is returned on the connection associated with the <span class="emph">stderr</span>, and is not preceded by a flag byte.</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../1/rsh">rsh(1)</a>, <a class="link-man" href="../1/ssh">ssh(1)</a>, <a class="link-man" href="../3/rcmd">rcmd(3)</a>, <a class="link-man" href="../3/ruserok">ruserok(3)</a>, <a class="link-man" href="../5/hosts_access">hosts_access(5)</a>, <a class="link-man" href="../5/login.conf">login.conf(5)</a>, <a class="link-man" href="../8/sshd">sshd(8)</a></div>
<div class="section">
<h1 id="x42554753">BUGS</h1> The authentication procedure used here assumes the integrity of every machine and every network that can reach the rshd/rlogind ports on the server. This is insecure, but is useful in an &#8220;open&#8221; environment. <a class="link-man" href="../8/sshd">sshd(8)</a> or a Kerberized version of this server are much more secure.<p>
A facility to allow all data exchanges to be encrypted should be present.<p>
A more extensible protocol (such as Telnet) should be used.<p>
<b class="name">rshd</b> intentionally rejects accesses from IPv4 mapped address on top of <span class="define">AF_INET6</span> socket, since IPv4 mapped address complicates host-address based authentication. If you would like to accept connections from IPv4 peers, you will need to run <b class="name">rshd</b> on top of an <span class="define">AF_INET</span> socket, not an <span class="define">AF_INET6</span> socket.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
March 9, 2005</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

