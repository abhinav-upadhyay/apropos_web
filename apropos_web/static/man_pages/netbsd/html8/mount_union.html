<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
MOUNT_UNION(8)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
MOUNT_UNION(8)</td>
<td class="head-vol" align="center">
System Manager's Manual</td>
<td class="head-rtitle" align="right">
MOUNT_UNION(8)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">mount_union</b> &#8212; <span class="desc">mount union filesystems</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1><table class="synopsis">
<col style="width: 11.00ex;">
<col>
<tbody>
<tr>
<td>
mount_union</td>
<td>
&#91;<span class="opt"><b class="flag">&#45;b</b></span>&#93; &#91;<span class="opt"><b class="flag">&#45;o</b> <i class="arg">options</i></span>&#93; <i class="arg">directory</i> <i class="arg">uniondir</i></td>
</tr>
</tbody>
</table>
</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="name">mount_union</b> command attaches <i class="arg">directory</i> above <i class="arg">uniondir</i> in such a way that the contents of both directory trees remain visible. By default, <i class="arg">directory</i> becomes the <span class="emph">upper</span> layer and <i class="arg">uniondir</i> becomes the <span class="emph">lower</span> layer.<p>
Both <i class="arg">directory</i> and <i class="arg">uniondir</i> are converted to absolute paths before use.<p>
The options are as follows:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;b</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Invert the default position, so that <i class="arg">directory</i> becomes the lower layer and <i class="arg">uniondir</i> becomes the upper layer. However, <i class="arg">uniondir</i> remains the mount point.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;o</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Options are specified with a <b class="flag">&#45;o</b> flag followed by a comma separated string of options. See the <a class="link-man" href="../8/mount">mount(8)</a> man page for possible options and their meanings.</dd>
</dl>
<p>
Filenames are looked up in the upper layer and then in the lower layer. If a directory is found in the lower layer, and there is no entry in the upper layer, then a <span class="emph">shadow</span> directory will be created in the upper layer. It will be owned by the user who originally did the union mount, with mode &#8220;rwxrwxrwx&#8221; (0777) modified by the umask in effect at that time.<p>
If a file exists in the upper layer then there is no way to access a file with the same name in the lower layer. If necessary, a combination of loopback and union mounts can be made which will still allow the lower files to be accessed by a different pathname.<p>
Except in the case of a directory, access to an object is granted via the normal filesystem access checks. For directories, the current user must have access to both the upper and lower directories (should they both exist).<p>
Requests to create or modify objects in <i class="arg">uniondir</i> are passed to the upper layer with the exception of a few special cases. An attempt to open for writing a file which exists in the lower layer causes a copy of the <span class="emph">entire</span> file to be made to the upper layer, and then for the upper layer copy to be opened. Similarly, an attempt to truncate a lower layer file to zero length causes an empty file to be created in the upper layer. Any other operation which would ultimately require modification to the lower layer fails with <span class="define">EROFS</span>.<p>
The union filesystem manipulates the namespace, rather than individual filesystems. The union operation applies recursively down the directory tree now rooted at <i class="arg">uniondir</i>. Thus any filesystems which are mounted under <i class="arg">uniondir</i> will take part in the union operation. This differs from the <span class="emph">union</span> option to <a class="link-man" href="../8/mount">mount(8)</a> which only applies the union operation to the mount point itself, and then only for lookups.</div>
<div class="section">
<h1 id="x4558414d504c4553">EXAMPLES</h1> The commands<p>
<pre style="margin-left: 5.00ex;" class="lit display">
mount -t cd9660 -o ro /dev/cd0a /usr/src 
mount -t union /var/obj /usr/src</pre>
<p>
mount the CD-ROM drive <i class="file">/dev/cd0a</i> on <i class="file">/usr/src</i> and then attaches <i class="file">/var/obj</i> on top. For most purposes the effect of this is to make the source tree appear writable even though it is stored on a CD-ROM.<p>
The command<p>
<pre style="margin-left: 5.00ex;" class="lit display">
mount -t union -o -b /sys $HOME/sys</pre>
<p>
attaches the system source tree below the <i class="file">sys</i> directory in the user's home directory. This allows individual users to make private changes to the source, and build new kernels, without those changes becoming visible to other users. Note that the files in the lower layer remain accessible via <i class="file">/sys</i>.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../2/intro">intro(2)</a>, <a class="link-man" href="../2/mount">mount(2)</a>, <a class="link-man" href="../2/unmount">unmount(2)</a>, <a class="link-man" href="../5/fstab">fstab(5)</a>, <a class="link-man" href="../8/fsck_ffs">fsck_ffs(8)</a>, <a class="link-man" href="../8/mount">mount(8)</a>, <a class="link-man" href="../8/mount_null">mount_null(8)</a>, <a class="link-man" href="../8/sysctl">sysctl(8)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="name">mount_union</b> command first appeared in <span class="unix">4.4BSD</span>.</div>
<div class="section">
<h1 id="x42554753">BUGS</h1> Without whiteout support from the filesystem backing the upper layer, there is no way that delete and rename operations on lower layer objects can be done. An attempt to mount a union directory under one which does not have whiteout support will return <span class="define">EOPNOTSUPP</span> (&#8220;Operation not supported&#8221;). Whiteout support can be added to an existing FFS filesystem by using the <b class="flag">&#45;c</b> option of <a class="link-man" href="../8/fsck_ffs">fsck_ffs(8)</a>.<p>
Running <a class="link-man" href="../1/find">find(1)</a> over a union tree has the side-effect of creating a tree of shadow directories in the upper layer.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
February 5, 2008</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

