<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
COMPAT_IBCS2(8)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
COMPAT_IBCS2(8)</td>
<td class="head-vol" align="center">
System Manager's Manual</td>
<td class="head-rtitle" align="right">
COMPAT_IBCS2(8)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">compat_ibcs2</b> &#8212; <span class="desc">setup procedure for running iBCS2 binaries</span></div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> <span class="unix">NetBSD</span> supports running Intel Binary Compatibility Standard 2 (iBCS2) binaries. This only applies to i386 systems for now. Binaries are supported from SCO <span class="unix">UNIX</span> and other systems derived from AT&amp;T System&#160;V Release&#160;3 UNIX. iBCS2 support is only well tested using SCO binaries. XENIX binaries are also supported although not as well tested. SVR4 binaries are supported by the <span class="define">COMPAT_SVR4</span> option.<p>
iBCS2 supports COFF, ELF, and x.out (XENIX) binary formats. Binaries from SCO OpenServer (version 5.x) are the only ELF binaries that have been tested. Most programs should work, but not ones that use or depend on:<p>
<ul style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-item">
<li class="list-item" style="margin-top: 0.00em;">
kernel internal data structures</li>
<li class="list-item" style="margin-top: 0.00em;">
STREAMS drivers (other than TCP/IP sockets)</li>
<li class="list-item" style="margin-top: 0.00em;">
local X displays (uses a STREAMS pipe)</li>
<li class="list-item" style="margin-top: 0.00em;">
virtual 8086 mode</li>
</ul>
<p>
The iBCS2 compatibility feature is active for kernels compiled with the <span class="define">COMPAT_IBCS2</span> option enabled. If support for iBCS2 ELF executables is desired, the <span class="define">EXEC_ELF32</span> option should be enabled in addition to <span class="define">COMPAT_IBCS2</span>.<p>
Many COFF-format programs and most ELF-format programs are dynamically linked. This means that you will also need the shared libraries that the program depends on. Also, you will need to create a &#8220;shadow root&#8221; directory for iBCS2 binaries on your <span class="unix">NetBSD</span> system. This directory is named <i class="file">/emul/ibcs2</i>. Any file operations done by iBCS2 programs run under <span class="unix">NetBSD</span> will look in this directory first. So, if an iBCS2 program opens, for example, <i class="file">/etc/passwd</i>, <span class="unix">NetBSD</span> will first try to open <i class="file">/emul/ibcs2/etc/passwd</i>, and if that does not exist open the &#8216;real&#8217; <i class="file">/etc/passwd</i> file. It is recommended that you install iBCS2 packages that include configuration files, etc. under <i class="file">/emul/ibcs2</i>, to avoid naming conflicts with possible <span class="unix">NetBSD</span> counterparts. Shared libraries should also be installed in the shadow tree.<p>
Generally, you will need to look for the shared libraries that iBCS2 binaries depend on only the first few times that you install an iBCS2 program on your <span class="unix">NetBSD</span> system. After a while, you will have a sufficient set of iBCS2 shared libraries on your system to be able to run newly imported iBCS2 binaries without any extra work.<div class="subsection">
<h2 id="x53657474696e6720757020736861726564206c6962726172696573">Setting up shared libraries</h2> How to get to know which shared libraries iBCS2 binaries need, and where to get them? Depending on the file type of the executable, there are different possibilities (when following these instructions: you will need to be root on your <span class="unix">NetBSD</span> system to do the necessary installation steps).<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
COFF binaries</dt>
<dd class="list-tag" style="margin-left: 13.00ex;">
You can simply copy all of the available shared libraries since they are fairly small in size. The COFF shared libraries are typically found in /shlib and can be obtained from the following sources:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
SCO UNIX version 3.x (aka ODT) 
SCO UNIX version 5.x (aka OpenServer) 
SCO UnixWare 
Many versions of SVR4.2/x86</pre>
<p>
After copying the shared libraries, you should have at least the following files on your system:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
<i class="file">/emul/ibcs2/shlib/libc_s</i> 
<i class="file">/emul/ibcs2/shlib/libnsl_s</i> 
<i class="file">/emul/ibcs2/shlib/protlib_s</i></pre>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
ELF binaries</dt>
<dd class="list-tag" style="margin-left: 13.00ex;">
You can simply copy all of the available shared libraries from the source system or distribution or use <a class="link-man" href="../1/ldd">ldd(1)</a> to determine the libraries required by a specific binary.<p>
After copying the shared libraries, you should have at least the following files on your system:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
<i class="file">/emul/ibcs2/usr/lib/libc.so.1</i> 
<i class="file">/emul/ibcs2/usr/lib/libcrypt.so</i> 
<i class="file">/emul/ibcs2/usr/lib/libndbm.so</i> 
<i class="file">/emul/ibcs2/usr/lib/libsocket.so.1</i></pre>
</dd>
</dl>
<p>
If you don't have access to a SCO system, you will need to get the extra files you need from a SCO distribution. As of January 1998, SCO sells a copy of SCO OpenServer (iBCS2) and/or SCO UnixWare (SVR4) for personal/non-commercial use for only the cost of shipping (about $20US). The distribution comes on an ISO9660-format CDROM which can be mounted and used to copy the necessary files.<p>
Run the following script to copy the basic set of files from a SCO distribution directory mounted somewhere locally:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
/usr/share/examples/emul/ibcs2/ibcs2-setup [directory]</pre>
<p>
You should now be set up for SCO binaries which only need standard shared libs.</div>
</div>
<div class="section">
<h1 id="x42554753">BUGS</h1> The information about SCO distributions may become outdated.<p>
Attempting to a use a nameserver on the local host does not currently work due to an absurd shortcut taken by the iBCS2 network code (remember that there are no kernel sockets).<p>
16/32/64 bit offsets may not be handled correctly in all cases.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
February 8, 1998</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

