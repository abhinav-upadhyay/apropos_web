<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
NPFCTL(8)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
NPFCTL(8)</td>
<td class="head-vol" align="center">
System Manager's Manual</td>
<td class="head-rtitle" align="right">
NPFCTL(8)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">npfctl</b> &#8212; <span class="desc">control NPF packet filter</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1><table class="synopsis">
<col style="width: 6.00ex;">
<col>
<tbody>
<tr>
<td>
npfctl</td>
<td>
<i class="arg">command</i> &#91;<span class="opt"><i class="arg">arguments</i></span>&#93;</td>
</tr>
</tbody>
</table>
</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="name">npfctl</b> command can be used to control the NPF packet filter. For a description of NPF's configuration file, see <a class="link-man" href="../html5/npf.conf.html">npf.conf(5)</a>.<p>
The first argument, <i class="arg">command</i>, specifies the action to take. Valid commands are:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 3.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">start</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Enable packet inspection using the currently loaded configuration, if any. Note that this command does not load or reload the configuration, or affect existing connections.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">stop</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Disable packet inspection. This command does not change the currently loaded configuration, or affect existing connections.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">reload</b> &#91;<span class="opt"><i class="arg">path</i></span>&#93;</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Load or reload configuration from file. The configuration file at <i class="file">/etc/npf.conf</i> will be used unless a file is specified by <i class="arg">path</i>. All connections will be preserved during the reload, except those which will lose NAT policy due to removal. NAT policy is determined by the translation type and address. Note that change of filter criteria will not expire associated connections. The reload operation (i.e., replacing the ruleset, NAT policies and tables) is atomic.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">flush</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Flush configuration. That is, remove all rules, tables and expire all connections. This command does not disable packet inspection.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">show</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Show the current state and configuration. Syntax of printed configuration is for the user and may not match the <a class="link-man" href="../html5/npf.conf.html">npf.conf(5)</a> syntax.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">validate</b> &#91;<span class="opt"><i class="arg">path</i></span>&#93;</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Validate the configuration file and the processed form. The configuration file at <i class="file">/etc/npf.conf</i> will be used unless a file is specified by <i class="arg">path</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">rule</b> <i class="arg">name</i> <b class="cmd">add</b> &#60;rule-syntax&#62;</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Add a rule to a dynamic ruleset specified by <i class="arg">name</i>. On success, returns a unique identifier which can be used to remove the rule with <b class="cmd">rem-id</b> command. The identifier is alphanumeric string.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">rule</b> <i class="arg">name</i> <b class="cmd">rem</b> &#60;rule-syntax&#62;</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Remove a rule from a dynamic ruleset specified by <i class="arg">name</i>. This method uses SHA1 hash computed on a rule to identify it. Although very unlikely, it is subject to hash collisions. For a fully reliable and more efficient method, it is recommended to use <b class="cmd">rem-id</b> command.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">rule</b> <i class="arg">name</i> <b class="cmd">rem-id</b> &#60;id&#62;</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Remove a rule specified by unique <i class="arg">id</i> from a dynamic ruleset specified by <i class="arg">name</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">rule</b> <i class="arg">name</i> <b class="cmd">list</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
List all rules in the dynamic ruleset specified by <i class="arg">name</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">rule</b> <i class="arg">name</i> <b class="cmd">flush</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Remove all rules from the dynamic ruleset specified by <i class="arg">name</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">table</b> <i class="arg">tid</i> <b class="cmd">add</b> &#60;<i class="arg">addr/mask</i>&#62;</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
In table <i class="arg">tid</i>, add the IP address and optionally netmask, specified by &#60;<i class="arg">addr/mask</i>&#62;. Only tree-type tables support masks.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">table</b> <i class="arg">tid</i> <b class="cmd">rem</b> &#60;<i class="arg">addr/mask</i>&#62;</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
In table <i class="arg">tid</i>, remove the IP address and optionally netmask, specified by &#60;<i class="arg">addr/mask</i>&#62;. Only tree-type tables support masks.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">table</b> <i class="arg">tid</i> <b class="cmd">test</b> &#60;<i class="arg">addr</i>&#62;</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Query the table <i class="arg">tid</i> for a specific IP address, specified by <i class="arg">addr</i>. If no mask is specified, a single host is assumed.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">table</b> <i class="arg">tid</i> <b class="cmd">list</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
List all entries in the currently loaded table specified by <i class="arg">tid</i>. This operation is expensive and should be used with caution.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">save</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Save the active configuration and a spanshot of the current connections. The data will be stored in the <i class="file">/var/db/npf.db</i> file. Administrator may want to stop the packet inspection before saving.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">load</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Load the saved configuration file and the connections from the file. Note that any existing connections will be destroyed. Administrator may want to start packet inspection after the load.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">stats</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Print various statistics.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">debug</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Process the configuration file, print the byte-code of each rule and dump the raw configuration. This is primarily for developer use.</dd>
</dl>
</div>
<div class="section">
<h1 id="x504552464f524d414e4345">PERFORMANCE</h1> Reloading the configuration is a relatively expensive operation. Therefore, frequent reloads should be avoided. Use of tables should be considered as an alternative design. See <a class="link-man" href="../html5/npf.conf.html">npf.conf(5)</a> for details.</div>
<div class="section">
<h1 id="x46494c4553">FILES</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/dev/npf</i></dt>
<dd class="list-tag" style="margin-left: 13.00ex;">
control device</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/etc/npf.conf</i></dt>
<dd class="list-tag" style="margin-left: 13.00ex;">
default configuration file</dd>
</dl>
</div>
<div class="section">
<h1 id="x4558414d504c4553">EXAMPLES</h1> Starting the NPF packet filter:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
# npfctl reload 
# npfctl start 
# npfctl show</pre>
<p>
Addition and removal of entries in the table whose ID is 2:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
# npfctl table 2 add 10.0.0.1 
# npfctl table 2 rem 182.168.0.0/24</pre>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html4/bpf.html">bpf(4)</a>, <a class="link-man" href="../html5/npf.conf.html">npf.conf(5)</a>, <a class="link-man" href="../html7/npf.html">npf(7)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> NPF first appeared in <span class="unix">NetBSD&#160;6.0</span>.</div>
<div class="section">
<h1 id="x415554484f5253">AUTHORS</h1> NPF was designed and implemented by <span class="author">Mindaugas Rasiukevicius</span>.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
August 2, 2014</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

