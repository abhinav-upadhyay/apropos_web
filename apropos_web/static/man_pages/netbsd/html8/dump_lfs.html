<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="/static/man_pages/netbsd/style.css" type="text/css" media="all">
<title>
DUMP_LFS(8)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
DUMP_LFS(8)</td>
<td class="head-vol" align="center">
System Manager's Manual</td>
<td class="head-rtitle" align="right">
DUMP_LFS(8)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">dump_lfs</b>, <b class="name">rdump_lfs</b> &#8212; <span class="desc">filesystem backup</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1><table class="synopsis">
<col style="width: 8.00ex;">
<col>
<tbody>
<tr>
<td>
dump_lfs</td>
<td>
&#91;<span class="opt"><b class="flag">&#45;0123456789aceFnStuX</b></span>&#93; &#91;<span class="opt"><b class="flag">&#45;B</b> <i class="arg">records</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;b</b> <i class="arg">blocksize</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;d</b> <i class="arg">density</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;f</b> <i class="arg">file</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;h</b> <i class="arg">level</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;k</b> <i class="arg">read-blocksize</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;L</b> <i class="arg">label</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;l</b> <i class="arg">timeout</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;r</b> <i class="arg">cachesize</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;s</b> <i class="arg">feet</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;T</b> <i class="arg">date</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;x</b> <i class="arg">snap-backup</i></span>&#93; <i class="arg">files-to-dump</i></td>
</tr>
</tbody>
</table>
<br>
<table class="synopsis">
<col style="width: 8.00ex;">
<col>
<tbody>
<tr>
<td>
dump_lfs</td>
<td>
&#91;<span class="opt"><b class="flag">&#45;W</b> <code class="lit">|</code> <b class="flag">&#45;w</b></span>&#93;</td>
</tr>
</tbody>
</table>
<p>
(The <span class="unix">4.3BSD</span> option syntax is implemented for backward compatibility, but is not documented here).</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> <b class="name">dump_lfs</b> examines files on a file system and determines which files need to be backed up. These files are copied to the given disk, tape or other storage medium for safe keeping (see the <b class="flag">&#45;f</b> option below for doing remote backups). A dump that is larger than the output medium is broken into multiple volumes. On most media the size is determined by writing until an end-of-media indication is returned. This can be enforced by using the <b class="flag">&#45;a</b> option.<p>
On media that cannot reliably return an end-of-media indication (such as some cartridge tape drives) each volume is of a fixed size; the actual size is determined by the tape size and density and/or block count options below. By default, the same output file name is used for each volume after prompting the operator to change media.<p>
<i class="arg">files-to-dump</i> is either a single file system, or a list of files and directories on a single file system to be backed up as a subset of the file system. In the former case, <i class="arg">files-to-dump</i> may be the device of a file system, the path to a currently mounted file system, the path to an unmounted file system listed in <i class="file">/etc/fstab</i>, or, if <b class="flag">&#45;F</b> is given, a file system image. In the latter case, certain restrictions are placed on the backup: <b class="flag">&#45;u</b> is ignored, the only dump level that is supported is <b class="flag">&#45;0</b>, and all of the files must reside on the same file system.<p>
The following options are supported by <b class="name">dump_lfs</b>:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;0&#45;9</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Dump levels. A level 0, full backup, guarantees the entire file system is copied (but see also the <b class="flag">&#45;h</b> option below). A level number above 0, incremental backup, tells dump to copy all files new or modified since the last dump of a lower level. The default level is 9.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;a</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
&#8220;auto-size&#8221;. Bypass all tape length considerations, and enforce writing until an end-of-media indication is returned. This fits best for most modern tape drives. Use of this option is particularly recommended when appending to an existing tape, or using a tape drive with hardware compression (where you can never be sure about the compression ratio).</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;B</b> <i class="arg">records</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The number of kilobytes per volume, rounded down to a multiple of the blocksize. This option overrides the calculation of tape size based on length and density.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;b</b> <i class="arg">blocksize</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The number of kilobytes per dump record.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;c</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Modify the calculation of the default density and tape size to be more appropriate for cartridge tapes.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;d</b> <i class="arg">density</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Set tape density to <i class="arg">density</i>. The default is 1600 Bits Per Inch (BPI).</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;e</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Eject tape automatically if a tape change is required.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;F</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Indicates that <i class="arg">files-to-dump</i> is a file system image.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;f</b> <i class="arg">file</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Write the backup to <i class="arg">file</i>; <i class="arg">file</i> may be a special device file like <i class="file">/dev/rst0</i> (a tape drive), <i class="file">/dev/rsd1c</i> (a disk drive), an ordinary file, or &#8216;<code class="lit"><b class="flag">&#45;</b></code>&#8217; (the standard output). Multiple file names may be given as a single argument separated by commas. Each file will be used for one dump volume in the order listed; if the dump requires more volumes than the number of names given, the last file name will used for all remaining volumes after prompting for media changes. If the name of the file is of the form &#8220;host:file&#8221;, or &#8220;user@host:file&#8221;, <b class="name">dump_lfs</b> writes to the named file on the remote host using <a class="link-man" href="../8/rmt">rmt(8)</a>. Note that methods more secure than <a class="link-man" href="../1/rsh">rsh(1)</a> (such as <a class="link-man" href="../1/ssh">ssh(1)</a>) can be used to invoke <a class="link-man" href="../8/rmt">rmt(8)</a> on the remote host, via the environment variable <span class="env">RCMD_CMD</span>. See <a class="link-man" href="../3/rcmd">rcmd(3)</a> for more details.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;h</b> <i class="arg">level</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Honor the user &#8220;nodump&#8221; flag (<span class="define">UF_NODUMP</span>) only for dumps at or above the given <i class="arg">level</i>. The default honor level is 1, so that incremental backups omit such files but full backups retain them.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;k</b> <i class="arg">read-blocksize</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The size in kilobyte of the read buffers, rounded up to a multiple of the file system block size. Default is 32k.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;l</b> <i class="arg">timeout</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
If a tape change is required, eject the tape and wait for the drive to be ready again. This is to be used with tape changers which automatically load the next tape when the tape is ejected. If after the timeout (in seconds) the drive is not ready <b class="name">dump_lfs</b> falls back to the default behavior, and prompts the operator for the next tape.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;L</b> <i class="arg">label</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The user-supplied text string <i class="arg">label</i> is placed into the dump header, where tools like <a class="link-man" href="../8/restore">restore(8)</a> and <a class="link-man" href="../1/file">file(1)</a> can access it. Note that this label is limited to be at most <span class="define">LBLSIZE</span> (currently 16) characters, which must include the terminating &#8216;<code class="lit">&#92;0</code>&#8217;.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;n</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Whenever <b class="name">dump_lfs</b> requires operator attention, notify all operators in the group &#8220;operator&#8221; using <a class="link-man" href="../1/wall">wall(1)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;r</b> <i class="arg">cachesize</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Use that many buffers for read cache operations. A value of zero disables the read cache altogether, higher values improve read performance by reading larger data blocks from the disk and maintaining them in an LRU cache. See the <b class="flag">&#45;k</b> option for the size of the buffers. Maximum is 512, the size of the cache is limited to 15% of the avail RAM by default.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;s</b> <i class="arg">feet</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Attempt to calculate the amount of tape needed at a particular density. If this amount is exceeded, <b class="name">dump_lfs</b> prompts for a new tape. It is recommended to be a bit conservative on this option. The default tape length is 2300 feet.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;S</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Display an estimate of the backup size and the number of tapes required, and exit without actually performing the dump.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;t</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
All informational log messages printed by <b class="name">dump_lfs</b> will have the time prepended to them. Also, the completion time interval estimations will have the estimated time at which the dump will complete printed at the end of the line.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;T</b> <i class="arg">date</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Use the specified date as the starting time for the dump instead of the time determined from looking in <i class="file">/etc/dumpdates</i>. The format of date is the same as that of <a class="link-man" href="../3/ctime">ctime(3)</a>. This option is useful for automated dump scripts that wish to dump over a specific period of time. The <b class="flag">&#45;T</b> option is mutually exclusive from the <b class="flag">&#45;u</b> option.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;u</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Update the file <i class="file">/etc/dumpdates</i> after a successful dump. The format of <i class="file">/etc/dumpdates</i> is readable by people, consisting of one free format record per line: file system name, increment level and <a class="link-man" href="../3/ctime">ctime(3)</a> format dump date. There may be only one entry per file system at each level. The file <i class="file">/etc/dumpdates</i> may be edited to change any of the fields, if necessary. If a list of files or subdirectories is being dumped (as opposed to an entire file system), then <b class="flag">&#45;u</b> is ignored.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;X</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Prevent the log from wrapping until the dump completes, guaranteeing a consistent backup. Processes that write to the filesystem will continue as usual until the entire log is full, after which they will block until the dump is complete. This functionality is analogous to what <a class="link-man" href="../4/fss">fss(4)</a> provides for other file systems. The <b class="flag">&#45;x</b> flag is provided for compatibility with <a class="link-man" href="../8/dump">dump(8)</a>; it functions exactly as the <b class="flag">&#45;X</b> flag does (its argument is ignored).</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;W</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
<b class="name">dump_lfs</b> tells the operator what file systems need to be dumped. This information is gleaned from the files <i class="file">/etc/dumpdates</i> and <i class="file">/etc/fstab</i>. The <b class="flag">&#45;W</b> option causes <b class="name">dump_lfs</b> to print out, for each file system in <i class="file">/etc/dumpdates</i> the most recent dump date and level, and highlights those file systems that should be dumped. If the <b class="flag">&#45;W</b> option is set, all other options are ignored, and <b class="name">dump_lfs</b> exits immediately.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;w</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Is like W, but prints only those file systems which need to be dumped.</dd>
</dl>
<p>
If <b class="name">dump_lfs</b> honors the &#8220;nodump&#8221; flag (<span class="define">UF_NODUMP</span>), files with the &#8220;nodump&#8221; flag will not be backed up. If a directory has the &#8220;nodump&#8221; flag, this directory and any file or directory under it will not be backed up.<p>
<b class="name">dump_lfs</b> requires operator intervention on these conditions: end of tape, end of dump, tape write error, tape open error or disk read error (if there are more than a threshold of 32). In addition to alerting all operators implied by the <b class="flag">&#45;n</b> option, <b class="name">dump_lfs</b> interacts with the operator on <b class="name">dump_lfs</b>'s control terminal at times when <b class="name">dump_lfs</b> can no longer proceed, or if something is grossly wrong. All questions <b class="name">dump_lfs</b> poses <span class="emph">must</span> be answered by typing &#8220;yes&#8221; or &#8220;no&#8221;, appropriately.<p>
Since making a dump involves a lot of time and effort for full dumps, <b class="name">dump_lfs</b> checkpoints itself at the start of each tape volume. If writing that volume fails for some reason, <b class="name">dump_lfs</b> will, with operator permission, restart itself from the checkpoint after the old tape has been rewound and removed, and a new tape has been mounted.<p>
<b class="name">dump_lfs</b> tells the operator what is going on at periodic intervals, including usually low estimates of the number of blocks to write, the number of tapes it will take, the time to completion, and the time to the tape change. The output is verbose, so that others know that the terminal controlling <b class="name">dump_lfs</b> is busy, and will be for some time.<p>
In the event of a catastrophic disk event, the time required to restore all the necessary backup tapes or files to disk can be kept to a minimum by staggering the incremental dumps. An efficient method of staggering incremental dumps to minimize the number of tapes follows:<ul style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-bul">
<li class="list-bul" style="margin-top: 1.00em;">
Always start with a level 0 backup, for example:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
/sbin/dump -0u -f /dev/nrst1 /usr/src</pre>
<p>
This should be done at set intervals, say once a month or once every two months, and on a set of fresh tapes that is saved forever.</li>
<li class="list-bul" style="margin-top: 1.00em;">
After a level 0, dumps of active file systems are taken on a daily basis, using a modified Tower of Hanoi algorithm, with this sequence of dump levels:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
3 2 5 4 7 6 9 8 9 9 ...</pre>
<p>
For the daily dumps, it should be possible to use a fixed number of tapes for each day, used on a weekly basis. Each week, a level 1 dump is taken, and the daily Hanoi sequence repeats beginning with 3. For weekly dumps, another fixed set of tapes per dumped file system is used, also on a cyclical basis.</li>
</ul>
<p>
After several months or so, the daily and weekly tapes should get rotated out of the dump cycle and fresh tapes brought in.<p>
If <b class="name">dump_lfs</b> receives a <span class="define">SIGINFO</span> signal (see the &#8220;status&#8221; argument of <a class="link-man" href="../1/stty">stty(1)</a>) whilst a backup is in progress, statistics on the amount completed, current transfer rate, and estimated finished time, will be written to the standard error output.</div>
<div class="section">
<h1 id="x454e5649524f4e4d454e54">ENVIRONMENT</h1> If the following environment variables exist, they are used by <b class="name">dump_lfs</b>.<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="env">TAPE</span></dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
If no -f option was specified, <b class="name">dump_lfs</b> will use the device specified via <span class="env">TAPE</span> as the dump device. <span class="env">TAPE</span> may be of the form &#8220;tapename&#8221;, &#8220;host:tapename&#8221;, or &#8220;user@host:tapename&#8221;.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="env">RCMD_CMD</span></dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
<b class="name">dump_lfs</b> will use <span class="env">RCMD_CMD</span> rather than <a class="link-man" href="../1/rsh">rsh(1)</a> to invoke <a class="link-man" href="../8/rmt">rmt(8)</a> on the remote machine.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="env">TIMEFORMAT</span></dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
can be used to control the format of the timestamps produced by the <b class="flag">&#45;t</b> option. <span class="env">TIMEFORMAT</span> is a string containing embedded formatting commands for <a class="link-man" href="../3/strftime">strftime(3)</a>. The total formatted string is limited to about 80 characters, if this limit is exceeded then &#8220;ERROR: TIMEFORMAT too long, reverting to default&#8221; will be printed and the time format will revert to the default one. If <span class="env">TIMEFORMAT</span> is not set then the format string defaults to &#8220;%T %Z&#8221;</dd>
</dl>
</div>
<div class="section">
<h1 id="x46494c4553">FILES</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/dev/nrst0</i></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
default tape unit to use. Taken from <span class="define">_PATH_DEFTAPE</span> in <i class="file">/usr/include/paths.h</i>.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/dev/rst*</i></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
raw SCSI tape interface</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/etc/dumpdates</i></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
dump date records</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/etc/fstab</i></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
dump table: file systems and frequency</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/etc/group</i></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
to find group <span class="emph">operator</span></dd>
</dl>
</div>
<div class="section">
<h1 id="x444941474e4f5354494353">DIAGNOSTICS</h1> Many, and verbose.<p>
<b class="name">dump_lfs</b> exits with zero status on success. Startup errors are indicated with an exit code of 1; abnormal termination is indicated with an exit code of 3.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../1/chflags">chflags(1)</a>, <a class="link-man" href="../1/rcmd">rcmd(1)</a>, <a class="link-man" href="../1/stty">stty(1)</a>, <a class="link-man" href="../1/wall">wall(1)</a>, <a class="link-man" href="../3/fts">fts(3)</a>, <a class="link-man" href="../3/rcmd">rcmd(3)</a>, <a class="link-man" href="../4/st">st(4)</a>, <a class="link-man" href="../5/fstab">fstab(5)</a>, <a class="link-man" href="../7/environ">environ(7)</a>, <a class="link-man" href="../8/restore">restore(8)</a>, <a class="link-man" href="../8/rmt">rmt(8)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> A <b class="name">dump_lfs</b> command appeared in <span class="unix">NetBSD&#160;1.5</span>.</div>
<div class="section">
<h1 id="x42554753">BUGS</h1> Fewer than 32 read errors on the file system are ignored.<p>
Each reel requires a new process, so parent processes for reels already written just hang around until the entire tape is written.<p>
<b class="name">dump_lfs</b> with the <b class="flag">&#45;W</b> or <b class="flag">&#45;w</b> options does not report file systems that have never been recorded in <i class="file">/etc/dumpdates</i>, even if listed in <i class="file">/etc/fstab</i>.<p>
When dumping a list of files or subdirectories, access privileges are required to scan the directory (as this is done via the <a class="link-man" href="../3/fts">fts(3)</a> routines rather than directly accessing the file system).<p>
It would be nice if <b class="name">dump_lfs</b> knew about the dump sequence, kept track of the tapes scribbled on, told the operator which tape to mount when, and provided more assistance for the operator running <a class="link-man" href="../8/restore">restore(8)</a>.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
July 23, 2006</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

