<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="/static/man_pages/netbsd/style.css" type="text/css" media="all">
<title>
PVMOVE(8)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
PVMOVE(8)</td>
<td class="head-vol" align="center">
System Manager's Manual</td>
<td class="head-rtitle" align="right">
PVMOVE(8)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1>NAME</h1> pvmove &#45; move physical extents</div>
<div class="section">
<h1>SYNOPSIS</h1> <b>pvmove</b> [&#45;&#45;abort] [&#45;&#45;alloc AllocationPolicy] [&#45;b|&#45;&#45;background] [&#45;d|&#45;&#45;debug] [&#45;h|&#45;&#45;help] [&#45;i|&#45;&#45;interval Seconds] [&#45;v|&#45;&#45;verbose] [&#45;n|&#45;&#45;name LogicalVolume] [SourcePhysicalVolume[:PE[-PE]...] [DestinationPhysicalVolume[:PE[-PE]...]...]]</div>
<div class="section">
<h1>DESCRIPTION</h1> <b>pvmove</b> allows you to move the allocated physical extents (PEs) on <i>SourcePhysicalVolume</i> to one or more other physical volumes (PVs). You can optionally specify a source <i>LogicalVolume</i> in which case only extents used by that LV will be moved to free (or specified) extents on <i>DestinationPhysicalVolume</i>(s). If no <i>DestinationPhysicalVolume</i> is specified, the normal allocation rules for the volume group are used.<div style="height: 1.00em;">
&#160;</div>
If <b>pvmove</b> gets interrupted for any reason (e.g. the machine crashes) then run  <b>pvmove</b> again without any PhysicalVolume arguments to restart any moves that were in progress from the last checkpoint. Alternatively use  <b>pvmove --abort</b> at any time to abort them at the last checkpoint.<div style="height: 1.00em;">
&#160;</div>
You can run more than one pvmove at once provided they are moving data off different SourcePhysicalVolumes, but additional pvmoves will ignore any logical volumes already in the process of being changed, so some data might not get moved.<div style="height: 1.00em;">
&#160;</div>
<b>pvmove</b> works as follows:<div style="height: 1.00em;">
&#160;</div>
1. A temporary 'pvmove' logical volume is created to store details of all the data movements required.<div style="height: 1.00em;">
&#160;</div>
2. Every logical volume in the volume group is searched for contiguous data that need moving according to the command line arguments. For each piece of data found, a new segment is added to the end of the pvmove LV. This segment takes the form of a temporary mirror to copy the data from the original location to a newly-allocated location. The original LV is updated to use the new temporary mirror segment in the pvmove LV instead of accessing the data directly.<div style="height: 1.00em;">
&#160;</div>
3. The volume group metadata is updated on disk.<div style="height: 1.00em;">
&#160;</div>
4. The first segment of the pvmove logical volume is activated and starts to mirror the first part of the data.  Only one segment is mirrored at once as this is usually more efficient.<div style="height: 1.00em;">
&#160;</div>
5. A daemon repeatedly checks progress at the specified time interval. When it detects that the first temporary mirror is in-sync, it breaks that mirror so that only the new location for that data gets used and writes a checkpoint into the volume group metadata on disk. Then it activates the mirror for the next segment of the pvmove LV.<div style="height: 1.00em;">
&#160;</div>
6. When there are no more segments left to be mirrored, the temporary logical volume is removed and the volume group metadata is updated so that the logical volumes reflect the new data locations.<div style="height: 1.00em;">
&#160;</div>
Note that this new process cannot support the original LVM1 type of on-disk metadata.  Metadata can be converted using  <b>vgconvert</b>(8).<div style="height: 1.00em;">
&#160;</div>
</div>
<div class="section">
<h1>OPTIONS</h1><dl>
<dt>
<i>&#45;&#45;abort</i></dt>
<dd>
Abort any moves in progress.</dd>
</dl>
<dl>
<dt>
<i>&#45;b, &#45;&#45;background</i></dt>
<dd>
Run the daemon in the background.</dd>
</dl>
<dl>
<dt>
<i>&#45;i, &#45;&#45;interval Seconds</i></dt>
<dd>
Report progress as a percentage at regular intervals.</dd>
</dl>
<dl>
<dt>
<i>&#45;n, &#45;&#45;name   <i>LogicalVolume</i></i></dt>
<dd>
Move only the extents belonging to <i>LogicalVolume</i> from <i>SourcePhysicalVolume</i> instead of all allocated extents to the destination physical volume(s).<div style="height: 1.00em;">
&#160;</div>
</dd>
</dl>
</div>
<div class="section">
<h1>EXAMPLES</h1> To move all logical extents of any logical volumes on <b>/dev/hda4</b> to free physical extents elsewhere in the volume group, giving verbose runtime information, use:<div style="height: 1.00em;">
&#160;</div>
	pvmove -v /dev/hda4<div style="height: 1.00em;">
&#160;</div>
</div>
<div class="section">
<h1>SEE ALSO</h1> <b>lvm</b>(8), <b>vgconvert</b>(8)</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tr>
<td class="foot-date">
LVM TOOLS 2.02.44-cvs (02-17-09)</td>
<td class="foot-os" align="right">
Sistina Software UK</td>
</tr>
</table>
</div>
</body>
</html>

