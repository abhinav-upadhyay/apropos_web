<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/../4/strict.dtd">
>
<head>
<meta http-equiv="Content-Type" content="te../; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
IFWATCHD(8)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
IFWATCHD(8)</td>
<td class="head-vol" align="center">
System Manager's Manual</td>
<td class="head-rtitle" align="right">
IFWATCHD(8)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">ifwatchd</b> &#8212; <span class="desc">watch for addresses added to or deleted from interfaces and call up/down-scripts for them</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1><table class="synopsis">
<col style="width: 8.00ex;">
<col>
<tbody>
<tr>
<td>
ifwatchd</td>
<td>
&#91;<span class="opt"><b class="flag">&#45;hiqv</b></span>&#93; &#91;<span class="opt"><b class="flag">&#45;A</b> <i class="arg">arrival-script</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;c</b> <i class="arg">carrier-script</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;D</b> <i class="arg">departure-script</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;d</b> <i class="arg">down-script</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;u</b> <i class="arg">up-script</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;n</b> <i class="arg">no-carrier-script</i></span>&#93; <i class="arg">ifname(s)</i></td>
</tr>
</tbody>
</table>
</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> <b class="name">ifwatchd</b> is used to monitor dynamic interfaces (for example PPP interfaces) for address changes, and to monitor static interfaces for carrier changes. Sometimes these interfaces are accompanied by a daemon program, which can take care of running any necessary scripts (like <a class="link-man" href="../8/pppd">pppd(8)</a> or <a class="link-man" href="../8/isdnd">isdnd(8)</a>), but sometimes the interfaces run completely autonomously (like <a class="link-man" href="../4/pppoe">pppoe(4)</a>).<p>
<b class="name">ifwatchd</b> provides a generic way to watch these types of changes. It works by monitoring the routing socket and interpreting &#8216;<code class="lit">RTM_NEWADDR</code>&#8217; (address added), &#8216;<code class="lit">RTM_DELADDR</code>&#8217; (address deleted) and &#8216;<code class="lit">RTM_IFINFO</code>&#8217; (carrier detect or loss of carrier) messages. It does not need special privileges to do this. The scripts called for up or down events are run with the same user id as <b class="name">ifwatchd</b> is run.<p>
The following options are available:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;A</b> <i class="arg">arrival-script</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Specify the command to invoke on arrival of new interfaces (like PCMCIA cards).</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;c</b> <i class="arg">carrier-script</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Specify the command to invoke when the carrier status transitions from no carrier to carrier.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;D</b> <i class="arg">departure-script</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Specify the command to invoke when an interface departs (for example a PCMCIA card is removed.)</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;d</b> <i class="arg">down-script</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Specify the command to invoke on &#8220;interface down&#8221; events (or: deletion of an address from an interface).</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;h</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Show the synopsis.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;i</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Inhibit a call to the up-script on startup for all watched interfaces already marked up. If this option is not given, <b class="name">ifwatchd</b> will check all watched interfaces on startup whether they are already marked up and, if they are, call the up-script with appropriate parameters. Additionally, if the interface is up and has a link, <b class="name">ifwatchd</b> will run the carrier script.<p>
Since ifwatchd typically is started late in the system boot sequence, some of the monitored interfaces may already have come up when it finally starts, but their up-scripts have not been called. By default <b class="name">ifwatchd</b> calls them on startup to account for this (and make the scripts easier.)</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;n</b> <i class="arg">no-carrier-script</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Specify the command to invoke when the carrier status transitions from carrier to no carrier.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;q</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Be quiet and don't log non-error messages to syslog.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;u</b> <i class="arg">up-script</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Specify the command to invoke on &#8220;interface up&#8221; events (or: addition of an address to an interface).</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;v</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Run in verbose debug mode and do not detach from the controlling terminal. Output verbose progress messages and flag errors ignored during normal operation. <span class="emph">You do not want to use this option in</span> <i class="file">/etc/rc.conf</i>!</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="arg">ifname(s)</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The name of the interface to watch. Multiple interfaces may be specified. Events for other interfaces are ignored.</dd>
</dl>
</div>
<div class="section">
<h1 id="x4558414d504c4553">EXAMPLES</h1><pre style="margin-left: 5.00ex;" class="lit display">
# ifwatchd -u /etc/ppp/ip-up -d /etc/ppp/ip-down pppoe0</pre>
<p>
If your pppoe0 interface is your main connection to the internet, the typical use of the up/down scripts is to add and remove a default route. This is an example for an up script doing this:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
#! /bin/sh 
/sbin/route add default $5 
/sbin/route add -inet6 default fe80::2 -iface ifp $1</pre>
<p>
As described below the fifth command line parameter will contain the peer address of the pppoe link. The corresponding ip-down script is:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
#! /bin/sh 
/sbin/route delete default $5 
/sbin/route delete -inet6 default fe80::2</pre>
<p>
Note that this is not a good idea if you have pppoe0 configured to connect only on demand (via the link1 flag), but works well for all permanent connected cases. Use<p>
<pre style="margin-left: 5.00ex;" class="lit display">
! /sbin/route add default -iface 0.0.0.1</pre>
<p>
in your <i class="file">/etc/ifconfig.pppoe0</i> file in the on-demand case.<p>
The next example is for dhclient users.<p>
<pre style="margin-left: 5.00ex;" class="lit display">
# ifwatchd -i -c /etc/dhcp/carrier-detect tlp0</pre>
<p>
With the above command, the carrier-detect script will be invoked when a carrier is detected on the interface <i class="arg">tlp0</i>. Note that the <b class="flag">&#45;i</b> flag prevents any action based on the initial state. A script like the following should work for most users, although it will not work for machines with multiple interfaces running <b class="flag">dhclient</b>.<p>
<pre style="margin-left: 5.00ex;" class="lit display">
#! /bin/sh 
# Arguments:  ifname tty speed address destination 
# If there is a dhclient already running, kill it. 
# (This step could be put in a distinct no-carrier script, 
# if desired.) 
if [ -f /var/run/dhclient.pid ]; then 
       /bin/kill `/bin/cat /var/run/dhclient.pid` 
fi 
# Start dhclient again on this interface 
/sbin/dhclient $1</pre>
</div>
<div class="section">
<h1 id="x504152414d45544552532050415353454420544f2053435249505453">PARAMETERS PASSED TO SCRIPTS</h1> The invoked scripts get passed these parameters:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="arg">ifname</i></dt>
<dd class="list-tag" style="margin-left: 11.00ex;">
The name of the interface this change is for (this allows to share the same script for multiple interfaces watched and dispatching on the interface name in the script).</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="arg">tty</i></dt>
<dd class="list-tag" style="margin-left: 11.00ex;">
Dummy parameter for compatibility with <a class="link-man" href="../8/pppd">pppd(8)</a> which will always be <span class="emph">/dev/null</span>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="arg">speed</i></dt>
<dd class="list-tag" style="margin-left: 11.00ex;">
Dummy parameter for compatibility with <a class="link-man" href="../8/pppd">pppd(8)</a> which will always be <span class="emph">9600</span>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="arg">address</i></dt>
<dd class="list-tag" style="margin-left: 11.00ex;">
The new address if this is an up event, or the no longer valid old address if this is a down event.<p>
The format of the address depends on the address family, for IPv4 it is the usual dotted quad notation, for IPv6 the colon separated standard notation.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="arg">destination</i></dt>
<dd class="list-tag" style="margin-left: 11.00ex;">
For point to point interfaces, this is the remote address of the interface. For other interfaces it is the broadcast address.</dd>
</dl>
</div>
<div class="section">
<h1 id="x4552524f5253">ERRORS</h1> The program logs to the syslog daemon as facility &#8220;daemon&#8221;. For detailed debugging use the <b class="flag">&#45;v</b> (verbose) option.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../4/pppoe">pppoe(4)</a>, <a class="link-man" href="../4/route">route(4)</a>, <a class="link-man" href="../5/ifconfig.if">ifconfig.if(5)</a>, <a class="link-man" href="../8/rc.d">rc.d(8)</a>, <a class="link-man" href="../8/route">route(8)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="name">ifwatchd</b> utility appeared in <span class="unix">NetBSD&#160;1.6</span>.</div>
<div class="section">
<h1 id="x415554484f5253">AUTHORS</h1> The program was written by <span class="author">Martin Husemann</span> &#60;martin@NetBSD.org&#62;.</div>
<div class="section">
<h1 id="x43415645415453">CAVEATS</h1> Due to the nature of the program a lot of stupid errors can not easily be caught in advance without removing the provided facility for advanced uses. For example typing errors in the interface name can not be detected by checking against the list of installed interfaces, because it is possible for a pcmcia card with the name given to be inserted later.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
April 16, 2010</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
<>

