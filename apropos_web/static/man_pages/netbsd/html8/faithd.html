<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/../4/strict.dtd">
>
<head>
<meta http-equiv="Content-Type" content="te../; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
FAITHD(8)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
FAITHD(8)</td>
<td class="head-vol" align="center">
System Manager's Manual</td>
<td class="head-rtitle" align="right">
FAITHD(8)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">faithd</b> &#8212; <span class="desc">FAITH IPv6/v4 translator daemon</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1><table class="synopsis">
<col style="width: 6.00ex;">
<col>
<tbody>
<tr>
<td>
faithd</td>
<td>
&#91;<span class="opt"><b class="flag">&#45;dp</b></span>&#93; &#91;<span class="opt"><b class="flag">&#45;f</b> <i class="arg">configfile</i></span>&#93; <i class="arg">service</i> &#91;<span class="opt"><i class="arg">serverpath</i> &#91;<span class="opt"><i class="arg">serverargs</i></span>&#93;</span>&#93;</td>
</tr>
</tbody>
</table>
<br>
<table class="synopsis">
<col style="width: 6.00ex;">
<col>
<tbody>
<tr>
<td>
faithd</td>
<td>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="name">faithd</b> utility provides IPv6-to-IPv4 TCP relaying. It can only be used on an IPv4/v6 dual stack router.<p>
When <b class="name">faithd</b> receives TCPv6 traffic, it will relay the TCPv6 traffic to TCPv4. The destination for the relayed TCPv4 connection will be determined by the last 4 octets of the original IPv6 destination. For example, if <code class="lit">2001:0db8:4819:ffff::</code> is reserved for <b class="name">faithd</b>, and the TCPv6 destination address is <code class="lit">2001:0db8:4819:ffff::0a01:0101</code>, the traffic will be relayed to IPv4 destination <code class="lit">10.1.1.1</code>.<p>
To use the <b class="name">faithd</b> translation service, an IPv6 address prefix must be reserved for mapping IPv4 addresses into. The kernel must be properly configured to route all the TCP connections toward the reserved IPv6 address prefix into the <a class="link-man" href="../4/faith">faith(4)</a> pseudo interface, using the <a class="link-man" href="../8/route">route(8)</a> command. Also, <a class="link-man" href="../8/sysctl">sysctl(8)</a> should be used to configure <span class="define">net.inet6.ip6.keepfaith</span> to <span class="define">1</span>.<p>
The router must be configured to capture all the TCP traffic for the reserved IPv6 address prefix, by using <a class="link-man" href="../8/route">route(8)</a> and <a class="link-man" href="../8/sysctl">sysctl(8)</a> commands.<p>
The <b class="name">faithd</b> utility needs special name-to-address translation logic, so that hostnames gets resolved into the special IPv6 address prefix. For small-scale installations, use <a class="link-man" href="../5/hosts">hosts(5)</a>; For large-scale installations, it is useful to have a DNS server with special address translation support. An implementation called <b class="name">totd</b> is available at <a class="link-ext" href="http://www.dillema.net/software/totd">http://www.dillema.net/software/totd</a>. Make sure you do not propagate translated DNS records over to normal DNS, as it can cause severe problems.<div class="subsection">
<h2 id="x4461656d6f6e206d6f6465">Daemon mode</h2> When <b class="name">faithd</b> is invoked as a standalone program, <b class="name">faithd</b> will daemonize itself. <b class="name">faithd</b> will listen to TCPv6 port <i class="arg">service</i>. If TCPv6 traffic to port <i class="arg">service</i> is found, it relays the connection.<p>
Since <b class="name">faithd</b> listens to TCP port <i class="arg">service</i>, it is not possible to run local TCP daemons for port <i class="arg">service</i> on the router, using <a class="link-man" href="../8/inetd">inetd(8)</a> or other standard mechanisms. By specifying <i class="arg">serverpath</i> to <b class="name">faithd</b>, you can run local daemons on the router. The <b class="name">faithd</b> utility will invoke ia local daemon at <i class="arg">serverpath</i> if the destination address is a local interface address, and will perform translation to IPv4 TCP in other cases. You can also specify <i class="arg">serverargs</i> for the arguments for the local daemon.<p>
The following options are available:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;d</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Debugging information will be generated using <a class="link-man" href="../3/syslog">syslog(3)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;f</b> <i class="arg">configfile</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Specify a configuration file for access control. See below.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;p</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Use privileged TCP port number as source port, for IPv4 TCP connection toward final destination. For relaying <a class="link-man" href="../1/ftp">ftp(1)</a> this flag is not necessary as special program code is supplied.</dd>
</dl>
<p>
<b class="name">faithd</b> will relay both normal and out-of-band TCP data. It is capable of emulating TCP half close as well. <b class="name">faithd</b> includes special support for protocols used by <a class="link-man" href="../1/ftp">ftp(1)</a>. When translating the FTP protocol, <b class="name">faithd</b> translates network level addresses in <code class="lit">PORT/LPRT/EPRT</code> and <code class="lit">PASV/LPSV/EPSV</code> commands.<p>
Inactive sessions will be disconnected in 30 minutes, to prevent stale sessions from chewing up resources. This may be inappropriate for some services (should this be configurable?).</div>
<div class="subsection">
<h2 id="x696e657464206d6f6465">inetd mode</h2> When <b class="name">faithd</b> is invoked via <a class="link-man" href="../8/inetd">inetd(8)</a>, <b class="name">faithd</b> will handle connections passed from standard input. If the connection endpoint is in the reserved IPv6 address prefix, <b class="name">faithd</b> will relay the connection. Otherwise, <b class="name">faithd</b> will invoke a service-specific daemon like <a class="link-man" href="../8/telnetd">telnetd(8)</a>, by using the command argument passed from <a class="link-man" href="../8/inetd">inetd(8)</a>.<p>
<b class="name">faithd</b> determines operation mode by the local TCP port number, and enables special protocol handling whenever necessary/possible. For example, if <b class="name">faithd</b> is invoked via <a class="link-man" href="../8/inetd">inetd(8)</a> on the FTP port, it will operate as an FTP relay.</div>
<div class="subsection">
<h2 id="x41636365737320636f6e74726f6c">Access control</h2> To prevent malicious access, <b class="name">faithd</b> implements a simple address-based access control. With <i class="file">/etc/faithd.conf</i> (or <i class="arg">configfile</i> specified by <b class="flag">&#45;f</b>), <b class="name">faithd</b> will avoid relaying unwanted traffic. The <i class="file">faithd.conf</i> configuration file contains directives of the following format:<ul style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-bul">
<li class="list-bul" style="margin-top: 1.00em;">
<i class="arg">src/slen</i> <code class="lit">deny</code> <i class="arg">dst/dlen</i><p>
If the source address of a query matches <i class="arg">src/slen</i>, and the translated destination address matches <i class="arg">dst/dlen</i>, deny the connection.</li>
<li class="list-bul" style="margin-top: 1.00em;">
<i class="arg">src/slen</i> <code class="lit">permit</code> <i class="arg">dst/dlen</i><p>
If the source address of a query matches <i class="arg">src/slen</i>, and the translated destination address matches <i class="arg">dst/dlen</i>, permit the connection.</li>
</ul>
<p>
The directives are evaluated in sequence, and the first matching entry will be effective. If there is no match (if we reach the end of the ruleset) the traffic will be denied.<p>
With inetd mode, traffic may be filtered by using access control functionality in <a class="link-man" href="../8/inetd">inetd(8)</a>.</div>
</div>
<div class="section">
<h1 id="x4558495420535441545553">EXIT STATUS</h1> <b class="name">faithd</b> exits with <span class="define">EXIT_SUCCESS</span> (0) on success, and <span class="define">EXIT_FAILURE</span> (1) on error.</div>
<div class="section">
<h1 id="x4558414d504c4553">EXAMPLES</h1> Before invoking <b class="name">faithd</b>, the <a class="link-man" href="../4/faith">faith(4)</a> interface has to be configured properly.<p>
<pre style="margin-left: 0.00ex;" class="lit display">
# sysctl -w net.inet6.ip6.accept_rtadv=0 
# sysctl -w net.inet6.ip6.forwarding=1 
# sysctl -w net.inet6.ip6.keepfaith=1 
# ifconfig faith0 create up 
# route add -inet6 2001:0db8:4819:ffff:: -prefixlen 96 ::1 
# route change -inet6 2001:0db8:4819:ffff:: -prefixlen 96 -ifp faith0</pre>
<div class="subsection">
<h2 id="x4461656d6f6e206d6f64652073616d706c6573">Daemon mode samples</h2> To translate <code class="lit">telnet</code> service, and provide no local telnet service, invoke <b class="name">faithd</b> as follows:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
# faithd telnet</pre>
<p>
If you would like to provide local telnet service via <a class="link-man" href="../8/telnetd">telnetd(8)</a> on <i class="file">/usr/libexec/telnetd</i>, use the following command line:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
# faithd telnet /usr/libexec/telnetd telnetd</pre>
<p>
If you would like to pass extra arguments to the local daemon:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
# faithd ftp /usr/libexec/ftpd ftpd -l</pre>
<p>
Here are some other examples. You may need <b class="flag">&#45;p</b> if the service checks the source port range.<p>
<pre style="margin-left: 0.00ex;" class="lit display">
# faithd ssh 
# faithd telnet /usr/libexec/telnetd telnetd</pre>
</div>
<div class="subsection">
<h2 id="x696e657464206d6f64652073616d706c6573">inetd mode samples</h2> Add the following lines into <a class="link-man" href="../5/inetd.conf">inetd.conf(5)</a>.<p>
<pre style="margin-left: 0.00ex;" class="lit display">
telnet  stream  faith/tcp6  nowait  root  faithd  telnetd 
ftp     stream  faith/tcp6  nowait  root  faithd  ftpd -l 
ssh     stream  faith/tcp6  nowait  root  faithd  /usr/sbin/sshd -i</pre>
<p>
<a class="link-man" href="../8/inetd">inetd(8)</a> will open listening sockets with kernel TCP relay support enabled. Whenever a connection comes in, <b class="name">faithd</b> will be invoked by <a class="link-man" href="../8/inetd">inetd(8)</a>. If the connection endpoint is in the reserved IPv6 address prefix. <b class="name">faithd</b> will relay the connection. Otherwise, <b class="name">faithd</b> will invoke service-specific daemon like <a class="link-man" href="../8/telnetd">telnetd(8)</a>.</div>
<div class="subsection">
<h2 id="x41636365737320636f6e74726f6c2073616d706c6573">Access control samples</h2> The following illustrates a simple <i class="file">faithd.conf</i> setting.<p>
<pre style="margin-left: 0.00ex;" class="lit display">
# permit anyone from 2001:0db8:ffff::/48 to use the translator, 
# to connect to the following IPv4 destinations: 
# - any location except 10.0.0.0/8 and 127.0.0.0/8. 
# Permit no other connections. 
# 
2001:0db8:ffff::/48 deny 10.0.0.0/8 
2001:0db8:ffff::/48 deny 127.0.0.0/8 
2001:0db8:ffff::/48 permit 0.0.0.0/0</pre>
</div>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../4/faith">faith(4)</a>, <a class="link-man" href="../8/route">route(8)</a>, <a class="link-man" href="../8/sysctl">sysctl(8)</a>, <i class="file">pkgsrc/net/totd</i><p>
<span class="ref"><span class="ref-auth">Jun-ichiro itojun Hagino</span> and <span class="ref-auth">Kazu Yamamoto</span>, <span class="ref-title">An IPv6-to-IPv4 transport relay translator</span>, <i class="ref-book">RFC 3142</i>, <a class="link-ref" href="http://www.ietf.org/rfc/rfc3142.txt">http://www.ietf.org/rfc/rfc3142.txt</a>, <span class="ref-date">June 2001</span>.</span></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="name">faithd</b> utility first appeared in the WIDE Hydrangea IPv6 protocol stack kit.</div>
<div class="section">
<h1 id="x534543555249545920434f4e53494445524154494f4e53">SECURITY CONSIDERATIONS</h1> It is very insecure to use IP-address based authentication, for connections relayed by <b class="name">faithd</b>, and any other TCP relaying services.<p>
Administrators are advised to limit accesses to <b class="name">faithd</b> using <i class="file">faithd.conf</i>, or by using IPv6 packet filters, to protect the <b class="name">faithd</b> service from malicious parties, and to avoid theft of service/bandwidth. IPv6 destination addresses can be limited by carefully configuring routing entries that point to <a class="link-man" href="../4/faith">faith(4)</a>, using <a class="link-man" href="../8/route">route(8)</a>. The IPv6 source address needs to be filtered using packet filters. The documents listed in <i class="link-sec"><a class="link-sec" href="#x53454520414c534f">SEE ALSO</a></i> have more information on this topic.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
January 9, 2010</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
<>

