<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/../4/strict.dtd">
>
<head>
<meta http-equiv="Content-Type" content="te../; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
TLSPROXY(8)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
TLSPROXY(8)</td>
<td class="head-vol" align="center">
System Manager's Manual</td>
<td class="head-rtitle" align="right">
TLSPROXY(8)</td>
</tr>
</tbody>
</table>
<br>
<div class="section">
<h1>NAME</h1> tlsproxy &#45; Postfix TLS proxy</div>
<div class="section">
<h1>SYNOPSIS</h1><br>
<b>tlsproxy</b> [generic Postfix daemon options]</div>
<div class="section">
<h1>DESCRIPTION</h1><br>
The <b>tlsproxy</b>(8) server implements a server-side TLS proxy. It is used by  <b>postscreen</b>(8) to talk SMTP-over-TLS with remote SMTP clients that are not whitelisted (including clients whose whitelist status has expired), but it should also work for non-SMTP protocols.<div style="height: 1.00em;">
&#160;</div>
Although one <b>tlsproxy</b>(8) process can serve multiple sessions at the same time, it is a good idea to allow the number of processes to increase with load, so that the service remains responsive.</div>
<div class="section">
<h1>PROTOCOL EXAMPLE</h1><br>
The example below concerns <b>postscreen</b>(8). However, the  <b>tlsproxy</b>(8) server is agnostic of the application protocol, and the example is easily adapted to other applications.<div style="height: 1.00em;">
&#160;</div>
After receiving a valid remote SMTP client STARTTLS command, the  <b>postscreen</b>(8) server sends the remote SMTP client endpoint string, the requested role (server), and the requested timeout to  <b>tlsproxy</b>(8).  <b>postscreen</b>(8) then receives a "TLS available" indication from  <b>tlsproxy</b>(8). If the TLS service is available,  <b>postscreen</b>(8) sends the remote SMTP client file descriptor to  <b>tlsproxy</b>(8), and sends the plaintext 220 greeting to the remote SMTP client.  This triggers TLS negotiations between the remote SMTP client and  <b>tlsproxy</b>(8).  Upon completion of the TLS-level handshake,  <b>tlsproxy</b>(8) translates between plaintext from/to  <b>postscreen</b>(8) and ciphertext to/from the remote SMTP client.</div>
<div class="section">
<h1>SECURITY</h1><br>
The <b>tlsproxy</b>(8) server is moderately security-sensitive. It talks to untrusted clients on the network. The process can be run chrooted at fixed low privilege.</div>
<div class="section">
<h1>DIAGNOSTICS</h1><br>
Problems and transactions are logged to <b>syslogd</b>(8).</div>
<div class="section">
<h1>CONFIGURATION PARAMETERS</h1><br>
Changes to <b>main.cf</b> are not picked up automatically, as  <b>tlsproxy</b>(8) processes may run for a long time depending on mail server load.  Use the command " <b>postfix</b>  <b>reload</b>" to speed up a change.<div style="height: 1.00em;">
&#160;</div>
The text below provides only a parameter summary. See  <b>postconf</b>(5) for more details including examples.</div>
<div class="section">
<h1>STARTTLS SUPPORT CONTROLS</h1><br>
<dl>
<dt>
<b>tlsproxy_tls_CAfile ($smtpd_tls_CAfile)</b></dt>
<dd>
A file containing (PEM format) CA certificates of root CAs trusted to sign either remote SMTP client certificates or intermediate CA certificates.</dd>
</dl>
<dl>
<dt>
<b>tlsproxy_tls_CApath ($smtpd_tls_CApath)</b></dt>
<dd>
A directory containing (PEM format) CA certificates of root CAs trusted to sign either remote SMTP client certificates or intermediate CA certificates.</dd>
</dl>
<dl>
<dt>
<b>tlsproxy_tls_always_issue_session_ids ($smtpd_tls_always_issue_session_ids)</b></dt>
<dd>
Force the Postfix <b>tlsproxy</b>(8) server to issue a TLS session id, even when TLS session caching is turned off.</dd>
</dl>
<dl>
<dt>
<b>tlsproxy_tls_ask_ccert ($smtpd_tls_ask_ccert)</b></dt>
<dd>
Ask a remote SMTP client for a client certificate.</dd>
</dl>
<dl>
<dt>
<b>tlsproxy_tls_ccert_verifydepth ($smtpd_tls_ccert_verifydepth)</b></dt>
<dd>
The verification depth for remote SMTP client certificates.</dd>
</dl>
<dl>
<dt>
<b>tlsproxy_tls_cert_file ($smtpd_tls_cert_file)</b></dt>
<dd>
File with the Postfix <b>tlsproxy</b>(8) server RSA certificate in PEM format.</dd>
</dl>
<dl>
<dt>
<b>tlsproxy_tls_ciphers ($smtpd_tls_ciphers)</b></dt>
<dd>
The minimum TLS cipher grade that the Postfix <b>tlsproxy</b>(8) server will use with opportunistic TLS encryption.</dd>
</dl>
<dl>
<dt>
<b>tlsproxy_tls_dcert_file ($smtpd_tls_dcert_file)</b></dt>
<dd>
File with the Postfix <b>tlsproxy</b>(8) server DSA certificate in PEM format.</dd>
</dl>
<dl>
<dt>
<b>tlsproxy_tls_dh1024_param_file ($smtpd_tls_dh1024_param_file)</b></dt>
<dd>
File with DH parameters that the Postfix <b>tlsproxy</b>(8) server should use with non-export EDH ciphers.</dd>
</dl>
<dl>
<dt>
<b>tlsproxy_tls_dh512_param_file ($smtpd_tls_dh512_param_file)</b></dt>
<dd>
File with DH parameters that the Postfix <b>tlsproxy</b>(8) server should use with export-grade EDH ciphers.</dd>
</dl>
<dl>
<dt>
<b>tlsproxy_tls_dkey_file ($smtpd_tls_dkey_file)</b></dt>
<dd>
File with the Postfix <b>tlsproxy</b>(8) server DSA private key in PEM format.</dd>
</dl>
<dl>
<dt>
<b>tlsproxy_tls_eccert_file ($smtpd_tls_eccert_file)</b></dt>
<dd>
File with the Postfix <b>tlsproxy</b>(8) server ECDSA certificate in PEM format.</dd>
</dl>
<dl>
<dt>
<b>tlsproxy_tls_eckey_file ($smtpd_tls_eckey_file)</b></dt>
<dd>
File with the Postfix <b>tlsproxy</b>(8) server ECDSA private key in PEM format.</dd>
</dl>
<dl>
<dt>
<b>tlsproxy_tls_eecdh_grade ($smtpd_tls_eecdh_grade)</b></dt>
<dd>
The Postfix <b>tlsproxy</b>(8) server security grade for ephemeral elliptic-curve Diffie-Hellman (EECDH) key exchange.</dd>
</dl>
<dl>
<dt>
<b>tlsproxy_tls_exclude_ciphers ($smtpd_tls_exclude_ciphers)</b></dt>
<dd>
List of ciphers or cipher types to exclude from the <b>tlsproxy</b>(8) server cipher list at all TLS security levels.</dd>
</dl>
<dl>
<dt>
<b>tlsproxy_tls_fingerprint_digest ($smtpd_tls_fingerprint_digest)</b></dt>
<dd>
The message digest algorithm to construct remote SMTP client-certificate fingerprints.</dd>
</dl>
<dl>
<dt>
<b>tlsproxy_tls_key_file ($smtpd_tls_key_file)</b></dt>
<dd>
File with the Postfix <b>tlsproxy</b>(8) server RSA private key in PEM format.</dd>
</dl>
<dl>
<dt>
<b>tlsproxy_tls_loglevel ($smtpd_tls_loglevel)</b></dt>
<dd>
Enable additional Postfix <b>tlsproxy</b>(8) server logging of TLS activity.</dd>
</dl>
<dl>
<dt>
<b>tlsproxy_tls_mandatory_ciphers ($smtpd_tls_mandatory_ciphers)</b></dt>
<dd>
The minimum TLS cipher grade that the Postfix <b>tlsproxy</b>(8) server will use with mandatory TLS encryption.</dd>
</dl>
<dl>
<dt>
<b>tlsproxy_tls_mandatory_exclude_ciphers ($smtpd_tls_mandatory_exclude_ciphers)</b></dt>
<dd>
Additional list of ciphers or cipher types to exclude from the  <b>tlsproxy</b>(8) server cipher list at mandatory TLS security levels.</dd>
</dl>
<dl>
<dt>
<b>tlsproxy_tls_mandatory_protocols ($smtpd_tls_mandatory_protocols)</b></dt>
<dd>
The SSL/TLS protocols accepted by the Postfix <b>tlsproxy</b>(8) server with mandatory TLS encryption.</dd>
</dl>
<dl>
<dt>
<b>tlsproxy_tls_protocols ($smtpd_tls_protocols)</b></dt>
<dd>
List of TLS protocols that the Postfix <b>tlsproxy</b>(8) server will exclude or include with opportunistic TLS encryption.</dd>
</dl>
<dl>
<dt>
<b>tlsproxy_tls_req_ccert ($smtpd_tls_req_ccert)</b></dt>
<dd>
With mandatory TLS encryption, require a trusted remote SMTP client certificate in order to allow TLS connections to proceed.</dd>
</dl>
<dl>
<dt>
<b>tlsproxy_tls_security_level ($smtpd_tls_security_level)</b></dt>
<dd>
The SMTP TLS security level for the Postfix <b>tlsproxy</b>(8) server; when a non-empty value is specified, this overrides the obsolete parameters smtpd_use_tls and smtpd_enforce_tls.</dd>
</dl>
<p>
Available in Postfix version 2.11 and later:<dl>
<dt>
<b>tlsmgr_service_name (tlsmgr)</b></dt>
<dd>
The name of the <b>tlsmgr</b>(8) service entry in master.cf.</dd>
</dl>
</div>
<div class="section">
<h1>OBSOLETE STARTTLS SUPPORT CONTROLS</h1><br>
These parameters are supported for compatibility with  <b>smtpd</b>(8) legacy parameters.<dl>
<dt>
<b>tlsproxy_use_tls ($smtpd_use_tls)</b></dt>
<dd>
Opportunistic TLS: announce STARTTLS support to remote SMTP clients, but do not require that clients use TLS encryption.</dd>
</dl>
<dl>
<dt>
<b>tlsproxy_enforce_tls ($smtpd_enforce_tls)</b></dt>
<dd>
Mandatory TLS: announce STARTTLS support to remote SMTP clients, and require that clients use TLS encryption.</dd>
</dl>
</div>
<div class="section">
<h1>RESOURCE CONTROLS</h1><br>
<dl>
<dt>
<b>tlsproxy_watchdog_timeout (10s)</b></dt>
<dd>
How much time a <b>tlsproxy</b>(8) process may take to process local or remote I/O before it is terminated by a built-in watchdog timer.</dd>
</dl>
</div>
<div class="section">
<h1>MISCELLANEOUS CONTROLS</h1><br>
<dl>
<dt>
<b>config_directory (see 'postconf -d' output)</b></dt>
<dd>
The default location of the Postfix main.cf and master.cf configuration files.</dd>
</dl>
<dl>
<dt>
<b>process_id (read-only)</b></dt>
<dd>
The process ID of a Postfix command or daemon process.</dd>
</dl>
<dl>
<dt>
<b>process_name (read-only)</b></dt>
<dd>
The process name of a Postfix command or daemon process.</dd>
</dl>
<dl>
<dt>
<b>syslog_facility (mail)</b></dt>
<dd>
The syslog facility of Postfix logging.</dd>
</dl>
<dl>
<dt>
<b>syslog_name (see 'postconf -d' output)</b></dt>
<dd>
The mail system name that is prepended to the process name in syslog records, so that "smtpd" becomes, for example, "postfix/smtpd".</dd>
</dl>
</div>
<div class="section">
<h1>SEE ALSO</h1><br>
postscreen(8), Postfix zombie blocker<br>
smtpd(8), Postfix SMTP server<br>
postconf(5), configuration parameters<br>
syslogd(5), system logging</div>
<div class="section">
<h1>LICENSE</h1><br>
The Secure Mailer license must be distributed with this software.</div>
<div class="section">
<h1>HISTORY</h1><br>
This service was introduced with Postfix version 2.8.</div>
<div class="section">
<h1>AUTHOR(S)</h1><br>
Wietse Venema<br>
IBM T.J. Watson Research<br>
P.O. Box 704<br>
Yorktown Heights, NY 10598, USA</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tr>
<td class="foot-date">
</td>
<td class="foot-os" align="right">
</td>
</tr>
</table>
</div>
</body>
<>

