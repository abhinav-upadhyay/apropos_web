<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="/static/man_pages/netbsd/style.css" type="text/css" media="all">
<title>
BLACKLISTD(8)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
BLACKLISTD(8)</td>
<td class="head-vol" align="center">
System Manager's Manual</td>
<td class="head-rtitle" align="right">
BLACKLISTD(8)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">blacklistd</b> &#8212; <span class="desc">block and release ports on demand to avoid DoS abuse</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1><table class="synopsis">
<col style="width: 10.00ex;">
<col>
<tbody>
<tr>
<td>
blacklistd</td>
<td>
&#91;<span class="opt"><b class="flag">&#45;dfrv</b></span>&#93; &#91;<span class="opt"><b class="flag">&#45;C</b> <i class="arg">controlprog</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;c</b> <i class="arg">configfile</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;D</b> <i class="arg">dbfile</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;P</b> <i class="arg">sockpathsfile</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;R</b> <i class="arg">rulename</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;s</b> <i class="arg">sockpath</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;t</b> <i class="arg">timeout</i></span>&#93;</td>
</tr>
</tbody>
</table>
</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> <b class="name">blacklistd</b> is a daemon similar to <a class="link-man" href="../8/syslogd">syslogd(8)</a> that listens to a sockets at paths specified in the <i class="arg">sockpathsfile</i> for notifications from other daemons about successful or failed connection attempts. If no such file is specified, then it only listens to the socket path specified by <i class="arg">sockspath</i> or if that is not specified to <i class="file">/var/run/blsock</i>. Each notification contains an (action, port, protocol, address, owner) tuple that identifies the remote connection and the action. This tuple is consulted against entries in <i class="arg">configfile</i> with syntax specified in <a class="link-man" href="../5/blacklistd.conf">blacklistd.conf(5)</a>. If an entry is matched, a state entry is created for that tuple. Each entry contains a number of tries limit and a duration.<p>
If the action is &#8220;add&#8221; and the number of tries limit is reached, then a control script <i class="arg">controlprog</i> is invoked with arguments:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
control add &lt;rulename&gt; &lt;proto&gt; &lt;address&gt; &lt;mask&gt; &lt;port&gt;</pre>
<p>
and should invoke a packet filter command to block the connection specified by the arguments. The <i class="arg">rulename</i> argument can be set from the command line (default <span class="define">blacklistd</span>). The script could print a numerical id to stdout as a handle for the rule that can be used later to remove that connection, but that is not required as all information to remove the rule is kept.<p>
If the action is &#8220;remove&#8221; Then the same control script is invoked as:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
control remove &lt;rulename&gt; &lt;proto&gt; &lt;address&gt; &lt;mask&gt; &lt;port&gt; &lt;id&gt;</pre>
<p>
where <i class="arg">id</i> is the number returned from the &#8220;add&#8221; action.<p>
<b class="name">blacklistd</b> maintains a database of known connections in <i class="arg">dbfile</i>. On startup it reads entries from that file, and updates its internal state.<p>
<b class="name">blacklistd</b> checks the list of active entries every <i class="arg">timeout</i> seconds (default <span class="define">15</span>) and removes entries and block rules using the control program as necessary.<p>
The following options are available:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;C</b> <i class="arg">controlprog</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Use <i class="arg">controlprog</i> to communicate with the packet filter, usually <i class="file">/libexec/blacklistd-helper</i>. The following arguments are passed to the control program:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
action</dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
The action to perform: <span class="define">add</span>, <span class="define">rem</span>, or <span class="define">flush</span> to add, remove or flush a firewall rule.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
name</dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
The rule name.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
protocol</dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
The optional protocol name (can be empty): <span class="define">tcp</span>, <span class="define">tcp6</span>, <span class="define">udp</span>, <span class="define">udp6</span>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
address</dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
The IPv4 or IPv6 numeric address to be blocked or released.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
mask</dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
The numeric mask to be applied to the blocked or released address</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
port</dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
The optional numeric port to be blocked (can be empty).</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
id</dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
For packet filters that support removal of rules by rule identifier, the identifier of the rule to be removed. The add command is expected to return the rule identifier string to stdout.</dd>
</dl>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;c</b> <i class="arg">configuration</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The name of the configuration file to read, usually <i class="file">/etc/blacklistd.conf</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;D</b> <i class="arg">dbfile</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The Berkeley DB file where <b class="name">blacklistd</b> stores its state, usually <i class="file">/var/run/blacklistd.db</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;d</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Normally, <b class="name">blacklistd</b> disassociates itself from the terminal unless the <b class="flag">&#45;d</b> flag is specified, in which case it stays in the foreground.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;f</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Truncate the state database and flush all the rules named <i class="arg">rulename</i> are deleted by invoking the control script as:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
control flush &lt;rulename&gt;</pre>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;P</b> <i class="arg">sockspathsfile</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
A file containing a list of pathnames, one per line that <b class="name">blacklistd</b> will create sockets to listen to. This is useful for chrooted environments.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;R</b> <i class="arg">rulename</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Specify the default rule name for the packet filter rules, usually <span class="define">blacklistd</span>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;r</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Re-read the firewall rules from the internal database, then remove and re-add them. This helps for packet filters that don't retain state across reboots.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;s</b> <i class="arg">sockpath</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Add <i class="arg">sockpath</i> to the list of Unix sockets <b class="name">blacklistd</b> listens to.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;t</b> <i class="arg">timeout</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The interval in seconds <b class="name">blacklistd</b> polls the state file to update the rules.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;v</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Cause <b class="name">blacklistd</b> to print diagnostic messages to <span class="define">stdout</span> instead of <a class="link-man" href="../8/syslogd">syslogd(8)</a>.</dd>
</dl>
</div>
<div class="section">
<h1 id="x46494c4553">FILES</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/libexec/blacklistd-helper</i></dt>
<dd class="list-tag" style="margin-left: 26.00ex;">
Shell script invoked to interface with the packet filter.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/etc/blacklistd.conf</i></dt>
<dd class="list-tag" style="margin-left: 26.00ex;">
Configuration file.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/var/db/blacklistd.db</i></dt>
<dd class="list-tag" style="margin-left: 26.00ex;">
Database of current connection entries.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/var/run/blsock</i></dt>
<dd class="list-tag" style="margin-left: 26.00ex;">
Socket to receive connection notifications.</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../5/blacklistd.conf">blacklistd.conf(5)</a>, <a class="link-man" href="../8/blacklistctl">blacklistctl(8)</a>, <a class="link-man" href="../8/npfctl">npfctl(8)</a>, <a class="link-man" href="../8/syslogd">syslogd(8)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> <b class="name">blacklistd</b> appeared in <span class="unix">NetBSD&#160;7</span>.</div>
<div class="section">
<h1 id="x415554484f5253">AUTHORS</h1> <span class="author">Christos Zoulas</span></div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
June 4, 2015</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

