<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/../4/strict.dtd">
>
<head>
<meta http-equiv="Content-Type" content="te../; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
POSTSCREEN(8)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
POSTSCREEN(8)</td>
<td class="head-vol" align="center">
System Manager's Manual</td>
<td class="head-rtitle" align="right">
POSTSCREEN(8)</td>
</tr>
</tbody>
</table>
<br>
<div class="section">
<h1>NAME</h1> postscreen &#45; Postfix zombie blocker</div>
<div class="section">
<h1>SYNOPSIS</h1><br>
<b>postscreen</b> [generic Postfix daemon options]</div>
<div class="section">
<h1>DESCRIPTION</h1><br>
The Postfix <b>postscreen</b>(8) server provides additional protection against mail server overload. One  <b>postscreen</b>(8) process handles multiple inbound SMTP connections, and decides which clients may talk to a Postfix SMTP server process. By keeping spambots away,  <b>postscreen</b>(8) leaves more SMTP server processes available for legitimate clients, and delays the onset of server overload conditions.<div style="height: 1.00em;">
&#160;</div>
This program should not be used on SMTP ports that receive mail from end-user clients (MUAs). In a typical deployment,  <b>postscreen</b>(8) handles the MX service on TCP port 25, while MUA clients submit mail via the  <b>submission</b> service on TCP port 587 which requires client authentication. Alternatively, a site could set up a dedicated, non-postscreen, "port 25" server that provides  <b>submission</b> service and client authentication, but no MX service.<div style="height: 1.00em;">
&#160;</div>
<b>postscreen</b>(8) maintains a temporary whitelist for clients that have passed a number of tests.  When an SMTP client IP address is whitelisted,  <b>postscreen</b>(8) hands off the connection immediately to a Postfix SMTP server process. This minimizes the overhead for legitimate mail.<div style="height: 1.00em;">
&#160;</div>
By default, <b>postscreen</b>(8) logs statistics and hands off every connection to a Postfix SMTP server process, while excluding clients in mynetworks from all tests (primarily, to avoid problems with non-standard SMTP implementations in network appliances).  This mode is useful for non-destructive testing.<div style="height: 1.00em;">
&#160;</div>
In a typical production setting, <b>postscreen</b>(8) is configured to reject mail from clients that fail one or more tests.  <b>postscreen</b>(8) logs rejected mail with the client address, helo, sender and recipient information.<div style="height: 1.00em;">
&#160;</div>
<b>postscreen</b>(8) is not an SMTP proxy; this is intentional. The purpose is to keep spambots away from Postfix SMTP server processes, while minimizing overhead for legitimate traffic.</div>
<div class="section">
<h1>SECURITY</h1><br>
The <b>postscreen</b>(8) server is moderately security-sensitive. It talks to untrusted clients on the network. The process can be run chrooted at fixed low privilege.</div>
<div class="section">
<h1>STANDARDS</h1><br>
RFC 821 (SMTP protocol)<br>
RFC 1123 (Host requirements)<br>
RFC 1652 (8bit-MIME transport)<br>
RFC 1869 (SMTP service extensions)<br>
RFC 1870 (Message Size Declaration)<br>
RFC 1985 (ETRN command)<br>
RFC 2034 (SMTP Enhanced Status Codes)<br>
RFC 2821 (SMTP protocol)<br>
Not: RFC 2920 (SMTP Pipelining)<br>
RFC 3207 (STARTTLS command)<br>
RFC 3461 (SMTP DSN Extension)<br>
RFC 3463 (Enhanced Status Codes)<br>
RFC 5321 (SMTP protocol, including multi-line 220 banners)</div>
<div class="section">
<h1>DIAGNOSTICS</h1><br>
Problems and transactions are logged to <b>syslogd</b>(8).</div>
<div class="section">
<h1>BUGS</h1><br>
The <b>postscreen</b>(8) built-in SMTP protocol engine currently does not announce support for AUTH, XCLIENT or XFORWARD. If you need to make these services available on port 25, then do not enable the optional "after 220 server greeting" tests, and do not use DNSBLs that reject traffic from dial-up and residential networks.<div style="height: 1.00em;">
&#160;</div>
The optional "after 220 server greeting" tests involve  <b>postscreen</b>(8)'s built-in SMTP protocol engine. When these tests succeed,  <b>postscreen</b>(8) adds the client to the temporary whitelist, but it cannot not hand off the "live" connection to a Postfix SMTP server process in the middle of a session.  Instead,  <b>postscreen</b>(8) defers attempts to deliver mail with a 4XX status, and waits for the client to disconnect.  When the client connects again,  <b>postscreen</b>(8) will allow the client to talk to a Postfix SMTP server process (provided that the whitelist status has not expired).   <b>postscreen</b>(8) mitigates the impact of this limitation by giving the "after 220 server greeting" tests a long expiration time.</div>
<div class="section">
<h1>CONFIGURATION PARAMETERS</h1><br>
Changes to main.cf are not picked up automatically, as  <b>postscreen</b>(8) processes may run for several hours. Use the command "postfix reload" after a configuration change.<div style="height: 1.00em;">
&#160;</div>
The text below provides only a parameter summary. See  <b>postconf</b>(5) for more details including examples.<div style="height: 1.00em;">
&#160;</div>
NOTE: Some <b>postscreen</b>(8) parameters implement stress-dependent behavior.  This is supported only when the default parameter value is stress-dependent (that is, it looks like ${stress?X}${stress:Y}, or it is the $ <i>name</i> of an smtpd parameter with a stress-dependent default). Other parameters always evaluate as if the  <b>stress</b> parameter value is the empty string.</div>
<div class="section">
<h1>COMPATIBILITY CONTROLS</h1><br>
<dl>
<dt>
<b>postscreen_command_filter ($smtpd_command_filter)</b></dt>
<dd>
A mechanism to transform commands from remote SMTP clients.</dd>
</dl>
<dl>
<dt>
<b>postscreen_discard_ehlo_keyword_address_maps ($smtpd_discard_ehlo_keyword_address_maps)</b></dt>
<dd>
Lookup tables, indexed by the remote SMTP client address, with case insensitive lists of EHLO keywords (pipelining, starttls, auth, etc.) that the  <b>postscreen</b>(8) server will not send in the EHLO response to a remote SMTP client.</dd>
</dl>
<dl>
<dt>
<b>postscreen_discard_ehlo_keywords ($smtpd_discard_ehlo_keywords)</b></dt>
<dd>
A case insensitive list of EHLO keywords (pipelining, starttls, auth, etc.) that the  <b>postscreen</b>(8) server will not send in the EHLO response to a remote SMTP client.</dd>
</dl>
</div>
<div class="section">
<h1>TROUBLE SHOOTING CONTROLS</h1><br>
<dl>
<dt>
<b>postscreen_expansion_filter (see 'postconf -d' output)</b></dt>
<dd>
List of characters that are permitted in postscreen_reject_footer attribute expansions.</dd>
</dl>
<dl>
<dt>
<b>postscreen_reject_footer ($smtpd_reject_footer)</b></dt>
<dd>
Optional information that is appended after a 4XX or 5XX  <b>postscreen</b>(8) server response.</dd>
</dl>
<dl>
<dt>
<b>soft_bounce (no)</b></dt>
<dd>
Safety net to keep mail queued that would otherwise be returned to the sender.</dd>
</dl>
</div>
<div class="section">
<h1>BEFORE-POSTSCREEN PROXY AGENT</h1><br>
Available in Postfix version 2.10 and later:<dl>
<dt>
<b>postscreen_upstream_proxy_protocol (empty)</b></dt>
<dd>
The name of the proxy protocol used by an optional before-postscreen proxy agent.</dd>
</dl>
<dl>
<dt>
<b>postscreen_upstream_proxy_timeout (5s)</b></dt>
<dd>
The time limit for the proxy protocol specified with the postscreen_upstream_proxy_protocol parameter.</dd>
</dl>
</div>
<div class="section">
<h1>PERMANENT WHITE/BLACKLIST TEST</h1><br>
This test is executed immediately after a remote SMTP client connects. If a client is permanently whitelisted, the client will be handed off immediately to a Postfix SMTP server process.<dl>
<dt>
<b>postscreen_access_list (permit_mynetworks)</b></dt>
<dd>
Permanent white/blacklist for remote SMTP client IP addresses.</dd>
</dl>
<dl>
<dt>
<b>postscreen_blacklist_action (ignore)</b></dt>
<dd>
The action that <b>postscreen</b>(8) takes when a remote SMTP client is permanently blacklisted with the postscreen_access_list parameter.</dd>
</dl>
</div>
<div class="section">
<h1>MAIL EXCHANGER POLICY TESTS</h1><br>
When <b>postscreen</b>(8) is configured to monitor all primary and backup MX addresses, it can refuse to whitelist clients that connect to a backup MX address only. For small sites, this requires configuring primary and backup MX addresses on the same MTA. Larger sites would have to share the  <b>postscreen</b>(8) cache between primary and backup MTAs, which would introduce a common point of failure.<dl>
<dt>
<b>postscreen_whitelist_interfaces (static:all)</b></dt>
<dd>
A list of local <b>postscreen</b>(8) server IP addresses where a non-whitelisted remote SMTP client can obtain  <b>postscreen</b>(8)'s temporary whitelist status.</dd>
</dl>
</div>
<div class="section">
<h1>BEFORE 220 GREETING TESTS</h1><br>
These tests are executed before the remote SMTP client receives the "220 servername" greeting. If no tests remain after the successful completion of this phase, the client will be handed off immediately to a Postfix SMTP server process.<dl>
<dt>
<b>dnsblog_service_name (dnsblog)</b></dt>
<dd>
The name of the <b>dnsblog</b>(8) service entry in master.cf.</dd>
</dl>
<dl>
<dt>
<b>postscreen_dnsbl_action (ignore)</b></dt>
<dd>
The action that <b>postscreen</b>(8) takes when a remote SMTP client's combined DNSBL score is equal to or greater than a threshold (as defined with the postscreen_dnsbl_sites and postscreen_dnsbl_threshold parameters).</dd>
</dl>
<dl>
<dt>
<b>postscreen_dnsbl_reply_map (empty)</b></dt>
<dd>
A mapping from actual DNSBL domain name which includes a secret password, to the DNSBL domain name that postscreen will reply with when it rejects mail.</dd>
</dl>
<dl>
<dt>
<b>postscreen_dnsbl_sites (empty)</b></dt>
<dd>
Optional list of DNS white/blacklist domains, filters and weight factors.</dd>
</dl>
<dl>
<dt>
<b>postscreen_dnsbl_threshold (1)</b></dt>
<dd>
The inclusive lower bound for blocking a remote SMTP client, based on its combined DNSBL score as defined with the postscreen_dnsbl_sites parameter.</dd>
</dl>
<dl>
<dt>
<b>postscreen_greet_action (ignore)</b></dt>
<dd>
The action that <b>postscreen</b>(8) takes when a remote SMTP client speaks before its turn within the time specified with the postscreen_greet_wait parameter.</dd>
</dl>
<dl>
<dt>
<b>postscreen_greet_banner ($smtpd_banner)</b></dt>
<dd>
The <i>text</i> in the optional "220-<i>text</i>..." server response that  <b>postscreen</b>(8) sends ahead of the real Postfix SMTP server's "220 text..." response, in an attempt to confuse bad SMTP clients so that they speak before their turn (pre-greet).</dd>
</dl>
<dl>
<dt>
<b>postscreen_greet_wait (${stress?2}${stress:6}s)</b></dt>
<dd>
The amount of time that <b>postscreen</b>(8) will wait for an SMTP client to send a command before its turn, and for DNS blocklist lookup results to arrive (default: up to 2 seconds under stress, up to 6 seconds otherwise).</dd>
</dl>
<dl>
<dt>
<b>smtpd_service_name (smtpd)</b></dt>
<dd>
The internal service that <b>postscreen</b>(8) hands off allowed connections to.</dd>
</dl>
<p>
Available in Postfix version 2.11 and later:<dl>
<dt>
<b>postscreen_dnsbl_whitelist_threshold (0)</b></dt>
<dd>
Allow a remote SMTP client to skip "before" and "after 220 greeting" protocol tests, based on its combined DNSBL score as defined with the postscreen_dnsbl_sites parameter.</dd>
</dl>
</div>
<div class="section">
<h1>AFTER 220 GREETING TESTS</h1><br>
These tests are executed after the remote SMTP client receives the "220 servername" greeting. If a client passes all tests during this phase, it will receive a 4XX response to all RCPT TO commands. After the client reconnects, it will be allowed to talk directly to a Postfix SMTP server process.<dl>
<dt>
<b>postscreen_bare_newline_action (ignore)</b></dt>
<dd>
The action that <b>postscreen</b>(8) takes when a remote SMTP client sends a bare newline character, that is, a newline not preceded by carriage return.</dd>
</dl>
<dl>
<dt>
<b>postscreen_bare_newline_enable (no)</b></dt>
<dd>
Enable "bare newline" SMTP protocol tests in the <b>postscreen</b>(8) server.</dd>
</dl>
<dl>
<dt>
<b>postscreen_disable_vrfy_command ($disable_vrfy_command)</b></dt>
<dd>
Disable the SMTP VRFY command in the <b>postscreen</b>(8) daemon.</dd>
</dl>
<dl>
<dt>
<b>postscreen_forbidden_commands ($smtpd_forbidden_commands)</b></dt>
<dd>
List of commands that the <b>postscreen</b>(8) server considers in violation of the SMTP protocol.</dd>
</dl>
<dl>
<dt>
<b>postscreen_helo_required ($smtpd_helo_required)</b></dt>
<dd>
Require that a remote SMTP client sends HELO or EHLO before commencing a MAIL transaction.</dd>
</dl>
<dl>
<dt>
<b>postscreen_non_smtp_command_action (drop)</b></dt>
<dd>
The action that <b>postscreen</b>(8) takes when a remote SMTP client sends non-SMTP commands as specified with the postscreen_forbidden_commands parameter.</dd>
</dl>
<dl>
<dt>
<b>postscreen_non_smtp_command_enable (no)</b></dt>
<dd>
Enable "non-SMTP command" tests in the <b>postscreen</b>(8) server.</dd>
</dl>
<dl>
<dt>
<b>postscreen_pipelining_action (enforce)</b></dt>
<dd>
The action that <b>postscreen</b>(8) takes when a remote SMTP client sends multiple commands instead of sending one command and waiting for the server to respond.</dd>
</dl>
<dl>
<dt>
<b>postscreen_pipelining_enable (no)</b></dt>
<dd>
Enable "pipelining" SMTP protocol tests in the <b>postscreen</b>(8) server.</dd>
</dl>
</div>
<div class="section">
<h1>CACHE CONTROLS</h1><br>
<dl>
<dt>
<b>postscreen_cache_cleanup_interval (12h)</b></dt>
<dd>
The amount of time between <b>postscreen</b>(8) cache cleanup runs.</dd>
</dl>
<dl>
<dt>
<b>postscreen_cache_map (btree:$data_directory/postscreen_cache)</b></dt>
<dd>
Persistent storage for the <b>postscreen</b>(8) server decisions.</dd>
</dl>
<dl>
<dt>
<b>postscreen_cache_retention_time (7d)</b></dt>
<dd>
The amount of time that <b>postscreen</b>(8) will cache an expired temporary whitelist entry before it is removed.</dd>
</dl>
<dl>
<dt>
<b>postscreen_bare_newline_ttl (30d)</b></dt>
<dd>
The amount of time that <b>postscreen</b>(8) will use the result from a successful "bare newline" SMTP protocol test.</dd>
</dl>
<dl>
<dt>
<b>postscreen_dnsbl_ttl (1h)</b></dt>
<dd>
The amount of time that <b>postscreen</b>(8) will use the result from a successful DNS blocklist test.</dd>
</dl>
<dl>
<dt>
<b>postscreen_greet_ttl (1d)</b></dt>
<dd>
The amount of time that <b>postscreen</b>(8) will use the result from a successful PREGREET test.</dd>
</dl>
<dl>
<dt>
<b>postscreen_non_smtp_command_ttl (30d)</b></dt>
<dd>
The amount of time that <b>postscreen</b>(8) will use the result from a successful "non_smtp_command" SMTP protocol test.</dd>
</dl>
<dl>
<dt>
<b>postscreen_pipelining_ttl (30d)</b></dt>
<dd>
The amount of time that <b>postscreen</b>(8) will use the result from a successful "pipelining" SMTP protocol test.</dd>
</dl>
</div>
<div class="section">
<h1>RESOURCE CONTROLS</h1><br>
<dl>
<dt>
<b>line_length_limit (2048)</b></dt>
<dd>
Upon input, long lines are chopped up into pieces of at most this length; upon delivery, long lines are reconstructed.</dd>
</dl>
<dl>
<dt>
<b>postscreen_client_connection_count_limit ($smtpd_client_connection_count_limit)</b></dt>
<dd>
How many simultaneous connections any remote SMTP client is allowed to have with the  <b>postscreen</b>(8) daemon.</dd>
</dl>
<dl>
<dt>
<b>postscreen_command_count_limit (20)</b></dt>
<dd>
The limit on the total number of commands per SMTP session for  <b>postscreen</b>(8)'s built-in SMTP protocol engine.</dd>
</dl>
<dl>
<dt>
<b>postscreen_command_time_limit (${stress?10}${stress:300}s)</b></dt>
<dd>
The time limit to read an entire command line with <b>postscreen</b>(8)'s built-in SMTP protocol engine.</dd>
</dl>
<dl>
<dt>
<b>postscreen_post_queue_limit ($default_process_limit)</b></dt>
<dd>
The number of clients that can be waiting for service from a real Postfix SMTP server process.</dd>
</dl>
<dl>
<dt>
<b>postscreen_pre_queue_limit ($default_process_limit)</b></dt>
<dd>
The number of non-whitelisted clients that can be waiting for a decision whether they will receive service from a real Postfix SMTP server process.</dd>
</dl>
<dl>
<dt>
<b>postscreen_watchdog_timeout (10s)</b></dt>
<dd>
How much time a <b>postscreen</b>(8) process may take to respond to a remote SMTP client command or to perform a cache operation before it is terminated by a built-in watchdog timer.</dd>
</dl>
</div>
<div class="section">
<h1>STARTTLS CONTROLS</h1><br>
<dl>
<dt>
<b>postscreen_tls_security_level ($smtpd_tls_security_level)</b></dt>
<dd>
The SMTP TLS security level for the <b>postscreen</b>(8) server; when a non-empty value is specified, this overrides the obsolete parameters postscreen_use_tls and postscreen_enforce_tls.</dd>
</dl>
<dl>
<dt>
<b>tlsproxy_service_name (tlsproxy)</b></dt>
<dd>
The name of the <b>tlsproxy</b>(8) service entry in master.cf.</dd>
</dl>
</div>
<div class="section">
<h1>OBSOLETE STARTTLS SUPPORT CONTROLS</h1><br>
These parameters are supported for compatibility with  <b>smtpd</b>(8) legacy parameters.<dl>
<dt>
<b>postscreen_use_tls ($smtpd_use_tls)</b></dt>
<dd>
Opportunistic TLS: announce STARTTLS support to remote SMTP clients, but do not require that clients use TLS encryption.</dd>
</dl>
<dl>
<dt>
<b>postscreen_enforce_tls ($smtpd_enforce_tls)</b></dt>
<dd>
Mandatory TLS: announce STARTTLS support to remote SMTP clients, and require that clients use TLS encryption.</dd>
</dl>
</div>
<div class="section">
<h1>MISCELLANEOUS CONTROLS</h1><br>
<dl>
<dt>
<b>config_directory (see 'postconf -d' output)</b></dt>
<dd>
The default location of the Postfix main.cf and master.cf configuration files.</dd>
</dl>
<dl>
<dt>
<b>delay_logging_resolution_limit (2)</b></dt>
<dd>
The maximal number of digits after the decimal point when logging sub-second delay values.</dd>
</dl>
<dl>
<dt>
<b>command_directory (see 'postconf -d' output)</b></dt>
<dd>
The location of all postfix administrative commands.</dd>
</dl>
<dl>
<dt>
<b>max_idle (100s)</b></dt>
<dd>
The maximum amount of time that an idle Postfix daemon process waits for an incoming connection before terminating voluntarily.</dd>
</dl>
<dl>
<dt>
<b>process_id (read-only)</b></dt>
<dd>
The process ID of a Postfix command or daemon process.</dd>
</dl>
<dl>
<dt>
<b>process_name (read-only)</b></dt>
<dd>
The process name of a Postfix command or daemon process.</dd>
</dl>
<dl>
<dt>
<b>syslog_facility (mail)</b></dt>
<dd>
The syslog facility of Postfix logging.</dd>
</dl>
<dl>
<dt>
<b>syslog_name (see 'postconf -d' output)</b></dt>
<dd>
The mail system name that is prepended to the process name in syslog records, so that "smtpd" becomes, for example, "postfix/smtpd".</dd>
</dl>
</div>
<div class="section">
<h1>SEE ALSO</h1><br>
smtpd(8), Postfix SMTP server<br>
tlsproxy(8), Postfix TLS proxy server<br>
dnsblog(8), DNS black/whitelist logger<br>
syslogd(8), system logging</div>
<div class="section">
<h1>README FILES</h1><br>
Use "<b>postconf readme_directory</b>" or "<b>postconf</b>  <b_directory</b>" to locate this information.<br>
POSTSCREEN_README, Postfix Postscreen Howto</div>
<div class="section">
<h1>LICENSE</h1><br>
The Secure Mailer license must be distributed with this software.</div>
<div class="section">
<h1>HISTORY</h1><br>
This service was introduced with Postfix version 2.8.<div style="height: 1.00em;">
&#160;</div>
Many ideas in <b>postscreen</b>(8) were explored in earlier work by Michael Tokarev, in OpenBSD spamd, and in MailChannels Traffic Control.</div>
<div class="section">
<h1>AUTHOR(S)</h1><br>
Wietse Venema<br>
IBM T.J. Watson Research<br>
P.O. Box 704<br>
Yorktown Heights, NY 10598, USA</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tr>
<td class="foot-date">
</td>
<td class="foot-os" align="right">
</td>
</tr>
</table>
</div>
</body>
<>

