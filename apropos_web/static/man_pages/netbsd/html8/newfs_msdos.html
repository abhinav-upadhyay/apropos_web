<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
NEWFS_MSDOS(8)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
NEWFS_MSDOS(8)</td>
<td class="head-vol" align="center">
System Manager's Manual</td>
<td class="head-rtitle" align="right">
NEWFS_MSDOS(8)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">newfs_msdos</b> &#8212; <span class="desc">construct a new MS-DOS (FAT) file system</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1><table class="synopsis">
<col style="width: 11.00ex;">
<col>
<tbody>
<tr>
<td>
newfs_msdos</td>
<td>
&#91;<span class="opt"><b class="flag">&#45;N</b></span>&#93; &#91;<span class="opt"><b class="flag">&#45;@</b> <i class="arg">offset</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;B</b> <i class="arg">boot</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;C</b> <i class="arg">create-size</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;F</b> <i class="arg">FAT-type</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;I</b> <i class="arg">volid</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;L</b> <i class="arg">label</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;O</b> <i class="arg">OEM</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;S</b> <i class="arg">sector-size</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;a</b> <i class="arg">FAT-size</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;b</b> <i class="arg">block-size</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;c</b> <i class="arg">cluster-size</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;e</b> <i class="arg">dirents</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;f</b> <i class="arg">format</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;h</b> <i class="arg">heads</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;i</b> <i class="arg">info</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;k</b> <i class="arg">backup</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;m</b> <i class="arg">media</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;n</b> <i class="arg">FATs</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;o</b> <i class="arg">hidden</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;r</b> <i class="arg">reserved</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;s</b> <i class="arg">total</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;u</b> <i class="arg">track-size</i></span>&#93; <i class="arg">special</i> &#91;<span class="opt"><i class="arg">disktype</i></span>&#93;</td>
</tr>
</tbody>
</table>
</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="name">newfs_msdos</b> utility creates a FAT12, FAT16, or FAT32 file system on device or file named <i class="arg">special</i>, using <a class="link-man" href="../html5/disktab.html">disktab(5)</a> entry <i class="arg">disktype</i> to determine geometry, if required.<p>
The options are as follow:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;N</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Don't create a file system: just print out parameters.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;@</b> <i class="arg">offset</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Build the filesystem at the specified offset in bytes in the device or file. A suffix s, k, m, g (lower or upper case) appended to the offset specifies that the number is in sectors, kilobytes, megabytes or gigabytes, respectively.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;B</b> <i class="arg">boot</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Get bootstrap from file.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;C</b> <i class="arg">create-size</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Create the image file with the specified size. A suffix character appended to the size is interpreted as for the <b class="flag">&#45;@</b> option. The file is created by truncating any existing file with the same name, seeking just before the required size and writing a single 0 byte. As a consequence, the space occupied on disk may be smaller than the size specified as a parameter.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;F</b> <i class="arg">FAT-type</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
FAT type (one of 12, 16, or 32).</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;I</b> <i class="arg">volid</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Volume ID.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;L</b> <i class="arg">label</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Volume label (up to 11 characters). The label should consist of only those characters permitted in regular DOS (8+3) filenames. The default is &#8220;<code class="lit">NO NAME</code>&#8221;.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;O</b> <i class="arg">OEM</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
OEM string (up to 8 characters). The default is &#8220;<code class="lit">NetBSD</code>&#8221;.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;S</b> <i class="arg">sector-size</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Number of bytes per sector. Acceptable values are powers of 2 in the range 512 through 32768.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;a</b> <i class="arg">FAT-size</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Number of sectors per FAT.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;b</b> <i class="arg">block-size</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
File system block size (bytes per cluster). This should resolve to an acceptable number of sectors per cluster (see below).</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;c</b> <i class="arg">cluster-size</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Sectors per cluster. Acceptable values are powers of 2 in the range 1 through 128. If the block or cluster size are not specified, the code uses a cluster between 512 bytes and 32K depending on the filesystem size.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;e</b> <i class="arg">dirents</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Number of root directory entries (FAT12 and FAT16 only).</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;f</b> <i class="arg">format</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Specify a standard (floppy disk) format. The standard formats are (capacities in kilobytes): 160, 180, 320, 360, 640, 720, 1200, 1232, 1440, 2880.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;h</b> <i class="arg">heads</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Number of drive heads.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;i</b> <i class="arg">info</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Location of the file system info sector (FAT32 only). A value of 0xffff signifies no info sector.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;k</b> <i class="arg">backup</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Location of the backup boot sector (FAT32 only). A value of 0xffff signifies no backup sector.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;m</b> <i class="arg">media</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Media descriptor (acceptable range 0xf0 to 0xff).</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;n</b> <i class="arg">FATs</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Number of FATs. Acceptable values are 1 to 16 inclusive. The default is 2.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;o</b> <i class="arg">hidden</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Number of hidden sectors.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;r</b> <i class="arg">reserved</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Number of reserved sectors.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;s</b> <i class="arg">total</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
File system size.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;u</b> <i class="arg">track-size</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Number of sectors per track.</dd>
</dl>
<p>
If <b class="name">newfs_msdos</b> receives a <span class="define">SIGINFO</span> signal (see the <span class="symb">status</span> argument for <a class="link-man" href="../html1/stty.html">stty(1)</a>), a line will be written to the standard error output indicating the name of the device currently being formatted, the sector number being written, and the total number of sectors to be written.</div>
<div class="section">
<h1 id="x4e4f544553">NOTES</h1> If some parameters (e.g. size, number of sectors, etc.) are not specified through options or disktype, the program tries to generate them automatically. In particular, the size is determined as the device or file size minus the offset specified with the <b class="flag">&#45;@</b> option. When the geometry is not available, it is assumed to be 63 sectors, 255 heads. The size is then rounded to become a multiple of the track size and avoid complaints by some filesystem code.<p>
FAT file system parameters occupy a "Boot Sector BPB (BIOS Parameter Block)" in the first of the "reserved" sectors which precede the actual file system. For reference purposes, this structure is presented below.<p>
<pre style="margin-left: 0.00ex;" class="lit display">
struct bsbpb { 
    u_int16_t	bps;		/* [-S] bytes per sector */ 
    u_int8_t	spc;		/* [-c] sectors per cluster */ 
    u_int16_t	res;		/* [-r] reserved sectors */ 
    u_int8_t	nft;		/* [-n] number of FATs */ 
    u_int16_t	rde;		/* [-e] root directory entries */ 
    u_int16_t	sec;		/* [-s] total sectors */ 
    u_int8_t	mid;		/* [-m] media descriptor */ 
    u_int16_t	spf;		/* [-a] sectors per FAT */ 
    u_int16_t	spt;		/* [-u] sectors per track */ 
    u_int16_t	hds;		/* [-h] drive heads */ 
    u_int32_t	hid;		/* [-o] hidden sectors */ 
    u_int32_t	bsec;		/* [-s] big total sectors */ 
}; 
/* FAT32 extensions */ 
struct bsxbpb { 
    u_int32_t	bspf;		/* [-a] big sectors per FAT */ 
    u_int16_t	xflg;		/* control flags */ 
    u_int16_t	vers;		/* file system version */ 
    u_int32_t	rdcl;		/* root directory start cluster */ 
    u_int16_t	infs;		/* [-i] file system info sector */ 
    u_int16_t	bkbs;		/* [-k] backup boot sector */ 
};</pre>
</div>
<div class="section">
<h1 id="x4558414d504c4553">EXAMPLES</h1><pre style="margin-left: 5.00ex;" class="lit display">
newfs_msdos /dev/rwd1a</pre>
<p>
Create a file system, using default parameters, on <i class="file">/dev/rwd1a</i>.<p>
<pre style="margin-left: 5.00ex;" class="lit display">
newfs_msdos -f 1440 -L foo /dev/rfd0a</pre>
<p>
Create a standard 1.44M file system, with volume label <i class="arg">foo</i>, on <i class="file">/dev/rfd0a</i>. Create a 30MB image file, with the FAT partition starting 63 sectors within the image file:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
newfs_msdos -C 30M -@63s ./somefile</pre>
</div>
<div class="section">
<h1 id="x444941474e4f5354494353">DIAGNOSTICS</h1> Exit status is 0 on success and 1 on error.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html5/disktab.html">disktab(5)</a>, <a class="link-man" href="../html8/disklabel.html">disklabel(8)</a>, <a class="link-man" href="../html8/fdisk.html">fdisk(8)</a>, <a class="link-man" href="../html8/newfs.html">newfs(8)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="name">newfs_msdos</b> command first appeared in <span class="unix">NetBSD&#160;1.3</span>.</div>
<div class="section">
<h1 id="x415554484f5253">AUTHORS</h1> <span class="author">Robert Nordier</span> &#60;<a class="link-mail" href="mailto:rnordier@FreeBSD.org">rnordier@FreeBSD.org</a>&#62;.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
April 24, 2014</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

