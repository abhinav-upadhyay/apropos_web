<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../../style.css" type="text/css" media="all">
<title>
ALTBOOT(8) (Sandpoint)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
ALTBOOT(8)</td>
<td class="head-vol" align="center">
System Manager's Manual (Sandpoint)</td>
<td class="head-rtitle" align="right">
ALTBOOT(8)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">altboot</b> &#8212; <span class="desc">program to boot <span class="unix">NetBSD</span> kernel from disk or network</span></div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> <b class="name">altboot</b> is a standalone program which works on top of a NAS product's bootloader. It is capable of loading a <span class="unix">NetBSD</span> kernel from an IDE or SATA disk drive, or via network with NFS or TFTP protocol. <b class="name">altboot</b> can be stored in flash ROM. Typically you will first copy it from flash into RAM and then invoke it there to boot the <span class="unix">NetBSD</span> kernel.<p>
<b class="name">altboot</b> runs in conjunction with popular U-Boot/PPCBoot bootloaders used by NAS products. With an appropriate boot command line, saved in the environment, <b class="name">altboot</b> can load and start a <span class="unix">NetBSD</span> kernel without manual intervention. The original U-Boot/PPCBoot bootloaders remain useful and altboot works as a functional extension of them.</div>
<div class="section">
<h1 id="x4558414d504c4553">EXAMPLES</h1> <b class="name">altboot</b> occupies less than 128KB in volume and can be stored to any vacant space of the system's flash. It is made to run at RAM address offset 0x0100'0000. U-Boot/PPCboot is instructed to copy the program to RAM in this way:<p>
<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit">=&gt; cp.b fffe0000 1000000 20000</code></div>
</blockquote>
<p>
Here 0xfffe'0000 is the flash address where <b class="name">altboot</b> is stored while 0x0100'0000 is the RAM address to copy to.<p>
The invocation syntax is:<p>
<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit">=&gt; go 1000000 <i class="arg">ide:N</i> <i class="arg">opt1</i> <i class="arg">opt2 ...</i> <i class="arg">bootname</i></code></div>
</blockquote>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="var">ide:N</b></dt>
<dd class="list-tag" style="margin-left: 2.00ex;">
where <i class="arg">N</i> is a string of digits, which defines the number of connected drives on each PATA channel. This option is useful to avoid the delays, when <b class="name">altboot</b> is trying to detect a non-existing drive. Examples:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
ide:<i class="arg">10</i></dt>
<dd class="list-tag" style="margin-left: 2.00ex;">
A single master drive on the first channel. Nothing on the second channel.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
ide:<i class="arg">22</i></dt>
<dd class="list-tag" style="margin-left: 2.00ex;">
A master and slave drive on both channels of the first controller.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
ide:<i class="arg">1111</i></dt>
<dd class="list-tag" style="margin-left: 2.00ex;">
A master drive on each channel. The first two digits belong to the first controller, the last two to the second controller.</dd>
</dl>
<p>
Unspecified digits will be read as <i class="arg">0</i>. The <i class="arg">ide</i> option has only a meaning for PATA disks. Omitting it makes it default to <i class="arg">ide:10</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="var">optN</b></dt>
<dd class="list-tag" style="margin-left: 2.00ex;">
multi, auto, ask, single, ddb, userconf, norm, quiet, verb, silent, debug<p>
Omitting optN makes <b class="name">altboot</b> default to multi-user mode boot.<p>
N.B., the maximum number of allowed go command arguments varies and depends on the U-Boot/PPCBoot buildtime configuration.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="var">bootname</b></dt>
<dd class="list-tag" style="margin-left: 2.00ex;">
One of the following:<p>
<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit">nfs:<i class="arg">filename</i></code></div>
</blockquote>
<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit">nfs:</code></div>
</blockquote>
<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit">tftp:<i class="arg">filename</i></code></div>
</blockquote>
<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit">tftp:</code></div>
</blockquote>
<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit">wd<i class="arg">Np</i>:<i class="arg">filename</i></code></div>
</blockquote>
<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit">wd<i class="arg">Np</i>:</code></div>
</blockquote>
<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit">mem:<i class="arg">address</i></code></div>
</blockquote>
<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit">net:</code></div>
</blockquote>
<p>
The last one is a synonym for &#8220;nfs&#8221;.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
nfs:<b class="var">filename</b></dt>
<dd class="list-tag" style="margin-left: 2.00ex;">
issue a DHCP request to determine the IP address and download <i class="arg">filename</i> from the NFS server.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
nfs:</dt>
<dd class="list-tag" style="margin-left: 2.00ex;">
target file is determined by <span class="symb">filename</span> field of <i class="file">/etc/dhcpd.conf</i></dd>
<dt class="list-tag" style="margin-top: 1.00em;">
tftp:<b class="var">filename</b></dt>
<dd class="list-tag" style="margin-left: 2.00ex;">
issue a DHCP request to determine IP address and download <i class="arg">filename</i> from the TFTP server.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
tftp:</dt>
<dd class="list-tag" style="margin-left: 2.00ex;">
target file is determined by <span class="symb">filename</span> field of <i class="file">/etc/dhcpd.conf</i></dd>
<dt class="list-tag" style="margin-top: 1.00em;">
wd<b class="var">Np</b>:<b class="var">filename</b></dt>
<dd class="list-tag" style="margin-left: 2.00ex;">
load the ELF <span class="unix">NetBSD</span> kernel <i class="arg">filename</i> from an FFSv2 or FFSv1 filesystem. <i class="arg">N</i> is a number to distinguish the target drive. <i class="arg">p</i> is a partition specifier. When omitted, partition &#8216;a&#8217; is assumed. &#8220;wd0a&#8221; means partition &#8216;a&#8217; of the first disk drive.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
wd<b class="var">Np</b>:</dt>
<dd class="list-tag" style="margin-left: 2.00ex;">
use filename &#8220;netbsd&#8221; for booting the ELF <span class="unix">NetBSD</span> kernel.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
mem:<b class="var">address</b></dt>
<dd class="list-tag" style="margin-left: 2.00ex;">
boots the ELF <span class="unix">NetBSD</span> kernel from any address in memory. The <i class="arg">address</i> argument has to be specified as a hexadecimal number and denotes the start address of the ELF image in memory.</dd>
</dl>
<p>
<b class="name">altboot</b> can boot from RAID 1 partitions, but only if the RAID partition is the first partition on the disk.<p>
U-Boot/PPCBoot provides a way to run a short list of commands right after power-on. The following is a procedure to setup the system for starting <span class="unix">NetBSD</span> after a 5 second delay, allowing the user to break into interactive mode. Note that a backslashed &#8216;;&#8217; is necessary to enter the script correctly.<p>
<pre style="margin-left: 5.00ex;" class="lit display">
=&gt; setenv bootcmd cp.b fffe0000 1000000 20000&#92;; go 1000000 wd0: 
=&gt; setenv bootdelay 5 
=&gt; saveenv</pre>
<p>
When U-Boot/PPCBoot is lacking important commands like cp or go, or is unable to save the enviroment, then there is still the option to replace the Linux kernel module by <i class="file">altboot.img</i> and save it to the same address in flash ROM. In this case you have only two options left to pass arguments:<p>
<ul style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-bul">
<li class="list-bul" style="margin-top: 0.00em;">
Enter the interactive command line mode, after <b class="name">altboot</b> has started. This requires a serial console.</li>
<li class="list-bul" style="margin-top: 0.00em;">
Write a fixed command line into flash, replacing the Linux initrd image. The command line is a normal ASCII file, started by the identifier <span class="emph">altboot:</span> and terminated by any control character between 0 and 31. Example:<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit">altboot:silent ide:1111 wd0:netbsd</code></div>
</blockquote>
</li>
</ul>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../../html8/dhcpd.html">dhcpd(8)</a>, <a class="link-man" href="../../html8/diskless.html">diskless(8)</a>, <a class="link-man" href="../../html8/nfsd.html">nfsd(8)</a>, <a class="link-man" href="../../html8/raidctl.html">raidctl(8)</a>, <a class="link-man" href="../../html8/tftpd.html">tftpd(8)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <span class="unix">NetBSD</span>/sandpoint <b class="name">altboot</b> first appeared in <span class="unix">NetBSD&#160;6.0</span>.</div>
<div class="section">
<h1 id="x42554753">BUGS</h1> The Realtek Gigabit Ethernet driver does not work correctly at 1000 Mbps. Another known problem of this driver is that it runs into a timeout after a coldstart. The system has to be rebooted at least once to make it work.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
October 7, 2013</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

