<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/../4/strict.dtd">
>
<head>
<meta http-equiv="Content-Type" content="te../; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
TBRCONFIG(8)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
TBRCONFIG(8)</td>
<td class="head-vol" align="center">
System Manager's Manual</td>
<td class="head-rtitle" align="right">
TBRCONFIG(8)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">tbrconfig</b> &#8212; <span class="desc">configure a token bucket regulator for an output queue</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1><table class="synopsis">
<col style="width: 9.00ex;">
<col>
<tbody>
<tr>
<td>
tbrconfig</td>
<td>
<i class="arg">interface</i> &#91;<span class="opt"><i class="arg">tokenrate</i> &#91;<span class="opt"><i class="arg">bucketsize</i></span>&#93;</span>&#93;</td>
</tr>
</tbody>
</table>
<br>
<table class="synopsis">
<col style="width: 9.00ex;">
<col>
<tbody>
<tr>
<td>
tbrconfig</td>
<td>
<b class="flag">&#45;d</b> <i class="arg">interface</i></td>
</tr>
</tbody>
</table>
<br>
<table class="synopsis">
<col style="width: 9.00ex;">
<col>
<tbody>
<tr>
<td>
tbrconfig</td>
<td>
<b class="flag">&#45;a</b></td>
</tr>
</tbody>
</table>
</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> <b class="name">tbrconfig</b> configures a token bucket regulator for the output network interface queue. A token bucket regulator limits both the average amount and instantaneous amount of packets that the underlying driver can dequeue from the network interface within the kernel.<p>
Conceptually, tokens accumulate in a bucket at the average <i class="arg">tokenrate</i>, up to the <i class="arg">bucketsize</i>. The driver can dequeue packets as long as there are positive amount of tokens, and the length of the dequeued packet is subtracted from the remaining tokens.  Tokens can be negative as a deficit, and packets are not dequeued from the interface queue until the tokens become positive again. The <i class="arg">tokenrate</i> limits the average rate, and the <i class="arg">bucketsize</i> limits the maximum burst size.<p>
Limiting the burst size is essential to packet scheduling, since the scheduler schedules packets backlogged at the network interface. Limiting the burst size is also needed for drivers which dequeues more packets than they can send and end up with discarding excess packets.<p>
When the <i class="arg">tokenrate</i> is set to higher than the actual transmission rate, the transmission complete interrupt will trigger the next dequeue. On the other hand, when the <i class="arg">tokenrate</i> is set to lower than the actual transmission rate, the transmission complete interrupt would occur before the tokens become positive. In this case, the next dequeue will be triggered by a timer event. Because the kernel timer has a limited granularity, a larger <i class="arg">bucketsize</i> is required for a higher <i class="arg">tokenrate</i>.<p>
The <i class="arg">interface</i> parameter is a string of the form &#8220;name unit&#8221;, for example, &#8220;en0&#8221;.<p>
The <i class="arg">tokenrate</i> parameter specifies the average rate in bits per second, and &#8220;K&#8221; or &#8220;M&#8221; can be appended to <i class="arg">tokenrate</i> as a short hand of &#8220;Kilo-bps&#8221; or &#8220;Mega-bps&#8221;, respectively. When <i class="arg">tokenrate</i> is omitted, <b class="name">tbrconfig</b> displays the current parameter values.<p>
The <i class="arg">bucketsize</i> parameter specifies the bucket size in bytes, and &#8220;K&#8221; can be appended to <i class="arg">bucketsize</i> as a short hand of &#8220;Kilo-bytes&#8221;. When <i class="arg">bucketsize</i> is omitted, <b class="name">tbrconfig</b> assumes the regulator is driven by transmission complete interrupts and, using heuristics, assigns a small bucket size according to the <i class="arg">tokenrate</i>. When the keyword &#8220;auto&#8221; is given as <i class="arg">bucketsize</i>, <b class="name">tbrconfig</b> assumes the regulator is driven by the kernel timer, and computes the bucket size from <i class="arg">tokenrate</i> and the kernel clock frequency.<p>
If the <b class="flag">&#45;d</b> flag is passed before an interface name, <b class="name">tbrconfig</b> will remove the token bucket regulator for the specified interface.<p>
Optionally, the <b class="flag">&#45;a</b> flag may be used instead of an interface name.  This flag instructs <b class="name">tbrconfig</b> to display information about all interfaces in the system.</div>
<div class="section">
<h1 id="x4558414d504c4553">EXAMPLES</h1> To configure a token bucket regulator for the interface en0 with 10Mbps token rate and 8KB bucket size,<p>
<pre style="margin-left: 5.00ex;" class="lit display">
# tbrconfig en0 10M 8K</pre>
<p>
To rate-limit the interface en0 up to 3Mbps,<p>
<pre style="margin-left: 5.00ex;" class="lit display">
# tbrconfig en0 3M auto</pre>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../5/altq.conf">altq.conf(5)</a>, <a class="link-man" href="../8/altqd">altqd(8)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="name">tbrconfig</b> command first appeared in WIDE/KAME IPv6 protocol stack kit as part of ALTQ tools.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
July 25, 2000</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
<>

