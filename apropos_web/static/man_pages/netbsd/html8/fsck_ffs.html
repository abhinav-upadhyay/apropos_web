<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
FSCK_FFS(8)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
FSCK_FFS(8)</td>
<td class="head-vol" align="center">
System Manager's Manual</td>
<td class="head-rtitle" align="right">
FSCK_FFS(8)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">fsck_ffs</b> &#8212; <span class="desc">Fast File System consistency check and interactive repair</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1><table class="synopsis">
<col style="width: 8.00ex;">
<col>
<tbody>
<tr>
<td>
fsck_ffs</td>
<td>
&#91;<span class="opt"><b class="flag">&#45;adFfPpqUX</b></span>&#93; &#91;<span class="opt"><b class="flag">&#45;B</b> <i class="arg">byteorder</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;b</b> <i class="arg">block</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;c</b> <i class="arg">level</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;m</b> <i class="arg">mode</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;x</b> <i class="arg">snap-backup</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;y</b> | <b class="flag">&#45;n</b></span>&#93; <i class="arg">filesystem ...</i></td>
</tr>
</tbody>
</table>
</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> <b class="name">fsck_ffs</b> performs interactive file system consistency checks and repair for each of the file systems specified on the command line. It is normally invoked from <a class="link-man" href="../8/fsck">fsck(8)</a>.<p>
The kernel takes care that only a restricted class of innocuous file system inconsistencies can happen unless hardware or software failures intervene. These are limited to the following:<p>
<ul style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-item">
<li class="list-item" style="margin-top: 0.00em;">
Unreferenced inodes</li>
<li class="list-item" style="margin-top: 0.00em;">
Link counts in inodes too large</li>
<li class="list-item" style="margin-top: 0.00em;">
Missing blocks in the free map</li>
<li class="list-item" style="margin-top: 0.00em;">
Blocks in the free map also in files</li>
<li class="list-item" style="margin-top: 0.00em;">
Counts in the super-block wrong</li>
</ul>
<p>
These are the only inconsistencies that <b class="name">fsck_ffs</b> in &#8220;preen&#8221; mode (with the <b class="flag">&#45;p</b> option) will correct; if it encounters other inconsistencies, it exits with an abnormal return status. For each corrected inconsistency one or more lines will be printed identifying the file system on which the correction will take place, and the nature of the correction. After successfully correcting a file system, <b class="name">fsck_ffs</b> will print the number of files on that file system, the number of used and free blocks, and the percentage of fragmentation.<p>
If sent a <span class="define">QUIT</span> signal, <b class="name">fsck_ffs</b> will finish the file system checks, then exit with an abnormal return status.<p>
If <b class="name">fsck_ffs</b> receives a <span class="define">SIGINFO</span> signal (see the <span class="symb">status</span> argument for <a class="link-man" href="../1/stty">stty(1)</a>), a line will be written to the standard error output indicating the name of the device currently being checked, the current phase number and phase-specific progress information.<p>
Without the <b class="flag">&#45;p</b> option, <b class="name">fsck_ffs</b> audits and interactively repairs inconsistent conditions for file systems. If the file system is inconsistent the operator is prompted for concurrence before each correction is attempted. It should be noted that some of the corrective actions which are not correctable under the <b class="flag">&#45;p</b> option will result in some loss of data. The amount and severity of data lost may be determined from the diagnostic output. The default action for each consistency correction is to wait for the operator to respond <code class="lit">yes</code> or <code class="lit">no</code>. If the operator does not have write permission on the file system <b class="name">fsck_ffs</b> will default to a <b class="flag">&#45;n</b> action.<p>
<b class="name">fsck_ffs</b> has more consistency checks than its predecessors <span class="emph">check</span>, <span class="emph">dcheck</span>, <span class="emph">fcheck</span>, and <span class="emph">icheck</span> combined.<p>
The following flags are interpreted by <b class="name">fsck_ffs</b>.<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;a</b></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Interpret the filesystem as an Apple UFS filesystem, even if there is no Apple UFS volume label present.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;B</b> <i class="arg">byteorder</i></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Convert the file system metadata to <i class="arg">byteorder</i> byte order if needed. Valid byte orders are &#8220;be&#8221; and &#8220;le&#8221;. If <b class="name">fsck_ffs</b> is interrupted while swapping the metadata byte order, the file system cannot be recovered. <b class="name">fsck_ffs</b> will print a message in interactive mode if the file system is not in host byte order.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;b</b> <i class="arg">block</i></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Use the block number <i class="arg">block</i> as the super block for the file system. Block 32 is usually an alternative super block. The <b class="flag">&#45;b</b> option of the <a class="link-man" href="../8/scan_ffs">scan_ffs(8)</a> utility can also be used to find the offset of other super block backups in a file system.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;c</b> <i class="arg">level</i></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Convert the FFSv1 file system to the level <i class="arg">level</i>. Note that the level of a file system can only be raised. There are currently five levels defined:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
0</dt>
<dd class="list-tag" style="margin-left: 3.00ex;">
The file system is in the old (static table) format.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
1</dt>
<dd class="list-tag" style="margin-left: 3.00ex;">
The file system is in the new (dynamic table) format. Such file systems are made by using the <b class="flag">&#45;O</b> <i class="arg">0</i> option to <a class="link-man" href="../8/newfs">newfs(8)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
2</dt>
<dd class="list-tag" style="margin-left: 3.00ex;">
The file system supports 32-bit UIDs and GIDs, short symbolic links are stored in the inode, and directories have an added field showing the file type. This format was introduced in <span class="unix">4.4BSD</span>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
3</dt>
<dd class="list-tag" style="margin-left: 3.00ex;">
If maxcontig is greater than one, build the free segment maps to aid in finding contiguous sets of blocks. If maxcontig is equal to one, delete any existing segment maps. This was the default before <span class="unix">NetBSD&#160;2.0</span>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
4</dt>
<dd class="list-tag" style="margin-left: 3.00ex;">
Rearrange the super block to the same layout as FFSv2; disable the rotational layout tables and per cylinder group block totals. Such file systems are made by using the <b class="flag">&#45;O</b> <i class="arg">1</i> option to <a class="link-man" href="../8/newfs">newfs(8)</a>.</dd>
</dl>
<p>
Note that FFSv2 file systems are always level 4.<p>
In interactive mode, <b class="name">fsck_ffs</b> will list the conversion to be made and ask whether the conversion should be done. If a negative answer is given, no further operations are done on the file system. In preen mode, the conversion is listed and done if possible without user interaction. Conversion in preen mode is best used when all the file systems are being converted at once.<p>
The output of <a class="link-man" href="../8/dumpfs">dumpfs(8)</a> can be examined to determine the format of the file system (&#8220;format&#8221; in the second line) and the file system level (&#8220;fslevel&#8221; in the sixth line).</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;d</b></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Print debugging output.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;F</b></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Indicates that <i class="arg">filesystem</i> is a file system image, rather than a raw character device. <i class="arg">filesystem</i> will be accessed &#8216;as-is&#8217;, and no attempts will be made to read a disklabel.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;f</b></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Force checking of file systems. Normally, if a file system is cleanly unmounted, the kernel will set a &#8220;clean flag&#8221; in the file system super block, and <b class="name">fsck_ffs</b> will not check the file system. This option forces <b class="name">fsck_ffs</b> to check the file system, regardless of the state of the clean flag.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;m</b> <i class="arg">mode</i></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Use the octal value <i class="arg">mode</i> as the permission bits to use when creating the <i class="file">lost+found</i> directory rather than the default 1700. In particular, systems that do not wish to have lost files accessible by all users on the system should use a more restrictive set of permissions such as 700.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;n</b></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Assume a no response to all questions asked by <b class="name">fsck_ffs</b> except for &#8216;<code class="lit">CONTINUE?</code>&#8217;, which is assumed to be affirmative; do not open the file system for writing.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;P</b></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Display a progress meter for the file system check. A new meter is displayed for each of the 5 file system check passes, unless <b class="flag">&#45;p</b> is specified, in which case only one meter for overall progress is displayed. Progress meters are disabled if the <b class="flag">&#45;d</b> option is specified.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;p</b></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Specify &#8220;preen&#8221; mode, described above.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;q</b></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Quiet mode, do not output any messages for clean filesystems.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;U</b></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Resolve user ids to usernames.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;X</b></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Similar to <b class="flag">&#45;x</b> but uses a file system internal snapshot on the file system to be checked.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;x</b> <i class="arg">snap-backup</i></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Use a snapshot with <i class="arg">snap-backup</i> as backup to check a read-write mounted filesystem. Must be used with <b class="flag">&#45;n</b>. See <a class="link-man" href="../4/fss">fss(4)</a> for more details. The point is to check an internally-consistent version of the filesystem to find out if it is damaged; on failure one should unmount the filesystem and repair it.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;y</b></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Assume a yes response to all questions asked by <b class="name">fsck_ffs</b>; this should be used with great caution as this is a free license to continue after essentially unlimited trouble has been encountered.</dd>
</dl>
<p>
Inconsistencies checked are as follows:<ol style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-enum">
<li class="list-enum" style="margin-top: 0.00em;">
Blocks claimed by more than one inode or the free map.</li>
<li class="list-enum" style="margin-top: 0.00em;">
Blocks claimed by an inode outside the range of the file system.</li>
<li class="list-enum" style="margin-top: 0.00em;">
Incorrect link counts.</li>
<li class="list-enum" style="margin-top: 0.00em;">
Size checks:<ul style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-item">
<li class="list-item" style="margin-top: 0.00em;">
Directory size not a multiple of DIRBLKSIZ.</li>
<li class="list-item" style="margin-top: 0.00em;">
Partially truncated file.</li>
</ul>
</li>
<li class="list-enum" style="margin-top: 0.00em;">
Bad inode format.</li>
<li class="list-enum" style="margin-top: 0.00em;">
Blocks not accounted for anywhere.</li>
<li class="list-enum" style="margin-top: 0.00em;">
Directory checks:<ul style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-item">
<li class="list-item" style="margin-top: 0.00em;">
File pointing to unallocated inode.</li>
<li class="list-item" style="margin-top: 0.00em;">
Inode number out of range.</li>
<li class="list-item" style="margin-top: 0.00em;">
Dot or dot-dot not the first two entries of a directory or having the wrong inode number.</li>
</ul>
</li>
<li class="list-enum" style="margin-top: 0.00em;">
Super Block checks:<ul style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-item">
<li class="list-item" style="margin-top: 0.00em;">
More blocks for inodes than there are in the file system.</li>
<li class="list-item" style="margin-top: 0.00em;">
Bad free block map format.</li>
<li class="list-item" style="margin-top: 0.00em;">
Total free block and/or free inode count incorrect.</li>
</ul>
</li>
</ol>
<p>
Orphaned files and directories (allocated but unreferenced) are, with the operator's concurrence, reconnected by placing them in the <i class="file">lost+found</i> directory. The name assigned is the inode number. If the <i class="file">lost+found</i> directory does not exist, it is created. If there is insufficient space its size is increased.<p>
Because of inconsistencies between the block device and the buffer cache, the raw device should always be used.</div>
<div class="section">
<h1 id="x444941474e4f5354494353">DIAGNOSTICS</h1> The diagnostics produced by <b class="name">fsck_ffs</b> are fully enumerated and explained in Appendix A of <span class="ref"><span class="ref-title">Fsck &#45; The UNIX File System Check Program</span>.</span></div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../4/fss">fss(4)</a>, <a class="link-man" href="../5/fs">fs(5)</a>, <a class="link-man" href="../5/fstab">fstab(5)</a>, <a class="link-man" href="../8/dumpfs">dumpfs(8)</a>, <a class="link-man" href="../8/fsck">fsck(8)</a>, <a class="link-man" href="../8/fsdb">fsdb(8)</a>, <a class="link-man" href="../8/newfs">newfs(8)</a>, <a class="link-man" href="../8/reboot">reboot(8)</a>, <a class="link-man" href="../8/scan_ffs">scan_ffs(8)</a></div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
March 6, 2012</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

