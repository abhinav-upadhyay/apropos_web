<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
NEWBTCONF(8)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
NEWBTCONF(8)</td>
<td class="head-vol" align="center">
System Manager's Manual</td>
<td class="head-rtitle" align="right">
NEWBTCONF(8)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">newbtconf</b> &#8212; <span class="desc">multiple boot-up configurations</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1><table class="synopsis">
<col style="width: 9.00ex;">
<col>
<tbody>
<tr>
<td>
newbtconf</td>
<td>
<i class="arg">new-conf-name</i> &#91;<span class="opt"><i class="arg">orig-conf-name</i></span>&#93;</td>
</tr>
</tbody>
</table>
<br>
<table class="synopsis">
<col style="width: 9.00ex;">
<col>
<tbody>
<tr>
<td>
newbtconf</td>
<td>
<b class="flag">init</b></td>
</tr>
</tbody>
</table>
<br>
<table class="synopsis">
<col style="width: 9.00ex;">
<col>
<tbody>
<tr>
<td>
newbtconf</td>
<td>
<b class="flag">revert</b></td>
</tr>
</tbody>
</table>
</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> <b class="name">newbtconf</b> is used to set up the system in such a way that the user is offered a selection of environments in which to boot the system up into. The most obvious application being for laptops to provide a network and non-network environment after a successful boot into multi-user mode.<div class="subsection">
<h2 id="x4261636b67726f756e64">Background</h2> In order to accomplish this task, the files usually associated with establishing the current system's running configuration are replaced with symbolic links which are adjusted with each boot to point to the appropriate file for the desired run-time environment. This is accomplished by directing all of the symbolic links through a directory which itself is a symbolic link (<i class="file">/etc/etc.current</i>), to the destination files. At each bootup, the selection made changes which directory <i class="file">/etc/etc.current</i> points to.<p>
Through doing this and reloading <i class="file">/etc/rc.conf</i> in <i class="file">/etc/rc</i> after the link has been established, the resulting run-time configuration is effectively controlled without the need to directly edit any files. The default boot-up environment is selected by manually directing which configuration directory <i class="file">/etc/etc.default</i> points to. As opposed to <i class="file">/etc/etc.current</i> (which is updated with every boot), <i class="file">/etc/etc.default</i> is not automatically updated.</div>
<div class="subsection">
<h2 id="x47657474696e672053746172746564">Getting Started</h2> By default, <span class="unix">NetBSD</span> only has one boot-up configuration - that set in the file <i class="file">/etc/rc.conf</i>. In order to initialize the system for operating in a manner which supports multiple boot configurations, <b class="name">newbtconf</b> must be run with an argument of &#8216;init&#8217;. This will create two symbolic links <i class="file">/etc/etc.current</i> and <i class="file">/etc/etc.default</i> to the directory <i class="file">/etc/etc.network</i>. The following files are all moved into that directory and symbolic links put in their place, in <i class="file">/etc</i>, pointing to <i class="file">/etc/etc.current/&lt;filename&gt;</i>:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
/etc/defaultdomain 
/etc/fstab 
/etc/ifconfig.* 
/etc/inetd.conf 
/etc/mrouted.conf 
/etc/mygate 
/etc/myname 
/etc/netstart 
/etc/nsswitch.conf 
/etc/ntp.conf 
/etc/rc.conf 
/etc/rc.conf.d 
/etc/resolv.conf</pre>
<p>
To test that this has been performed correctly, reboot your system into <span class="unix">NetBSD</span>. After the kernel has autoconfigured and tty flags have been set, a prompt should appear, preceded by the following like, looking like this:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
[network] 
Which configuration [network] ?</pre>
<p>
The []'s are used to indicate the default configuration, which can be selected by just pressing return. If there were other configurations available at this stage, you would have 30 seconds to enter that name and press <span class="symb">RETURN</span>.</div>
<div class="subsection">
<h2 id="x4d756c7469706c6520436f6e66696775726174696f6e73">Multiple Configurations</h2> Once an initial configuration has been set up, we can proceed to set up further run time environments. This is done by invoking <b class="name">newbtconf</b> with the name of the new configuration to be created. By default, this step will use the current configuration files as the basis for this setup unless a second parameter is given - that of the configuration to use as the basis for the new one. Upon completion, a new directory, <i class="file">/etc/etc.&lt;newname&gt;</i>, will have been created, priming the directory with the appropriate files for editing. For example, if we do <b class="name">newbtconf</b> <i class="arg">nonet network</i> it would create a directory named <i class="file">/etc/etc.nonet</i> and copy all the files from <i class="file">/etc/etc.network</i> into that directory. Upon rebooting, we should see:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
[network] nonet 
Which configuration [network] ?</pre>
<p>
To set up the system for booting into the &#8220;nonet&#8221; configuration, the files in <i class="file">/etc/etc.nonet</i> need be edited.<p>
If you wanted to make &#8220;nonet&#8221; the default configuration when booting, you would need delete the symbolic link <i class="file">/etc/etc.default</i> and create a new symbolic link (with the same name) to <i class="file">/etc/etc.nonet</i>. Booting up after having made such a change would result in the following being displayed:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
network [nonet] 
Which configuration [nonet] ?</pre>
</div>
<div class="subsection">
<h2 id="x5c264e6f204e6574776f726b">No Network</h2> Assuming that we performed the above command successfully, in order to successfully configure <span class="unix">NetBSD</span> to not configure interfaces (or generate no errors from attempting to do so), the following settings (at least) should be used in <i class="file">/etc/etc.nonet/rc.conf</i>:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
auto_ifconfig=NO 
net_interfaces=NO</pre>
<p>
Of course other networking services, such as NTP, routed, etc, are all expected to be &#8220;NO&#8221;. In general, the only setting that should be &#8220;YES&#8221; is syslogd, and perhaps cron (if your cron scripts don't need the network) or screenblank/wscons (if applicable). Other actions such as deleting any NFS mounts from <i class="file">/etc/etc.nonet/fstab</i> would also need to be undertaken.</div>
<div class="subsection">
<h2 id="x526576657274696e67206d756c7469706c6520626f6f7420636f6e66696775726174696f6e73">Reverting multiple boot configurations</h2> Multiple boot configurations can be deactivated by running <b class="name">newbtconf</b> with an argument of <b class="flag">revert</b>. All the symlinks mentioned above are then removed and the files they point to are copied to their default place. This effectively makes the currently selected configuration the only one active. The symbolic links <i class="file">/etc/etc.current</i> and <i class="file">/etc/etc.default</i> are also removed so upon rebooting no configuration selection menu is displayed. Note that the previously created configurations (in <i class="file">/etc/etc.&lt;name&gt;</i>) are not removed.</div>
</div>
<div class="section">
<h1 id="x46494c4553">FILES</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/etc/etc.current</i></dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
Symbolic link to current config directory.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/etc/etc.default</i></dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
Symbolic link to default config directory.<p>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/etc/defaultdomain</i></dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
These files all become symbolic links.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/etc/fstab</i></dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/etc/ifconfig.*</i></dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/etc/inetd.conf</i></dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/etc/mrouted.conf</i></dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/etc/mygate</i></dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/etc/myname</i></dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/etc/netstart</i></dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/etc/nsswitch.conf</i></dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/etc/ntp.conf</i></dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/etc/rc.conf</i></dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/etc/rc.conf.d</i></dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/etc/resolv.conf</i></dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html5/rc.conf.html">rc.conf(5)</a>, <a class="link-man" href="../html8/rc.html">rc(8)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="name">newbtconf</b> program first appeared in <span class="unix">NetBSD&#160;1.5</span>.</div>
<div class="section">
<h1 id="x415554484f5253">AUTHORS</h1> <span class="author"></span>This shell script was written by <span class="author">Darren Reed</span> &#60;darrenr@NetBSD.org&#62; with initial input from <span class="author">Matthew Green</span> &#60;mrg@NetBSD.org&#62; on how to approach this problem.</div>
<div class="section">
<h1 id="x42554753">BUGS</h1> It presently does not display a count down timer whilst waiting for input to select which configuration and nor does it abort said timer when a key is first pressed.<p>
The management of the overall collection of multiple configurations is much more manual than it ought to be. A general system configuration tool needs to be written to ease their management.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
September 30, 2005</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

