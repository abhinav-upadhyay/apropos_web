<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
RC.SUBR(8)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
RC.SUBR(8)</td>
<td class="head-vol" align="center">
System Manager's Manual</td>
<td class="head-rtitle" align="right">
RC.SUBR(8)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">rc.subr</b> &#8212; <span class="desc">functions used by system shell scripts</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1><ul style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-item">
<li class="list-item" style="margin-top: 1.00em;">
<code class="lit"></code>. <code class="lit">/etc/rc.subr</code></li>
<li class="list-item" style="margin-top: 1.00em;">
<b class="cmd">backup_file</b> <i class="arg">action</i> <i class="arg">file</i> <i class="arg">current</i> <i class="arg">backup</i></li>
<li class="list-item" style="margin-top: 1.00em;">
<b class="cmd">basename</b> <i class="arg">file</i> &#91;<span class="opt"><i class="arg">suffix</i></span>&#93;</li>
<li class="list-item" style="margin-top: 1.00em;">
<b class="cmd">checkyesno</b> <i class="arg">var</i></li>
<li class="list-item" style="margin-top: 1.00em;">
<b class="cmd">check_pidfile</b> <i class="arg">pidfile</i> <i class="arg">procname</i> &#91;<span class="opt"><i class="arg">interpreter</i></span>&#93;</li>
<li class="list-item" style="margin-top: 1.00em;">
<b class="cmd">check_process</b> <i class="arg">procname</i> &#91;<span class="opt"><i class="arg">interpreter</i></span>&#93;</li>
<li class="list-item" style="margin-top: 1.00em;">
<b class="cmd">collapse_backslash_newline</b></li>
<li class="list-item" style="margin-top: 1.00em;">
<b class="cmd">dirname</b> <i class="arg">file</i></li>
<li class="list-item" style="margin-top: 1.00em;">
<b class="cmd">err</b> <i class="arg">exitval</i> <i class="arg">message</i></li>
<li class="list-item" style="margin-top: 1.00em;">
<b class="cmd">load_rc_config</b> <i class="arg">command</i></li>
<li class="list-item" style="margin-top: 1.00em;">
<b class="cmd">load_rc_config_var</b> <i class="arg">command</i> <i class="arg">var</i></li>
<li class="list-item" style="margin-top: 1.00em;">
<b class="cmd">mount_critical_filesystems</b> <i class="arg">type</i></li>
<li class="list-item" style="margin-top: 1.00em;">
<b class="cmd">no_rc_postprocess</b> <i class="arg">command</i> &#91;<span class="opt"><i class="arg">arguments</i></span>&#93;</li>
<li class="list-item" style="margin-top: 1.00em;">
<b class="cmd">print_rc_metadata</b> <i class="arg">string</i></li>
<li class="list-item" style="margin-top: 1.00em;">
<b class="cmd">print_rc_normal</b> &#91;<span class="opt"><b class="flag">&#45;n</b></span>&#93; <i class="arg">string</i></li>
<li class="list-item" style="margin-top: 1.00em;">
<b class="cmd">rc_usage</b> <i class="arg">command</i> &#91;<span class="opt"><i class="arg">...</i></span>&#93;</li>
<li class="list-item" style="margin-top: 1.00em;">
<b class="cmd">reverse_list</b> <i class="arg">item</i> &#91;<span class="opt"><i class="arg">...</i></span>&#93;</li>
<li class="list-item" style="margin-top: 1.00em;">
<b class="cmd">run_rc_command</b> <i class="arg">argument [parameters]</i></li>
<li class="list-item" style="margin-top: 1.00em;">
<b class="cmd">run_rc_script</b> <i class="arg">file</i> <i class="arg">argument</i></li>
<li class="list-item" style="margin-top: 1.00em;">
<b class="cmd">stop_boot</b></li>
<li class="list-item" style="margin-top: 1.00em;">
<b class="cmd">twiddle</b></li>
<li class="list-item" style="margin-top: 1.00em;">
<b class="cmd">wait_for_pids</b> &#91;<span class="opt"><i class="arg">pid</i> &#91;<span class="opt"><i class="arg">...</i></span>&#93;</span>&#93;</li>
<li class="list-item" style="margin-top: 1.00em;">
<b class="cmd">warn</b> <i class="arg">message</i></li>
<li class="list-item" style="margin-top: 1.00em;">
<b class="cmd">yesno_to_truefalse</b> <i class="arg">var</i></li>
</ul>
</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> <b class="name">rc.subr</b> contains commonly used shell script functions which are used by various scripts such as <a class="link-man" href="../html8/rc.html">rc(8)</a>, and the periodic system services which are controlled by <a class="link-man" href="../html5/daily.conf.html">daily.conf(5)</a>, <a class="link-man" href="../html5/monthly.conf.html">monthly.conf(5)</a>, <a class="link-man" href="../html5/security.conf.html">security.conf(5)</a>, and <a class="link-man" href="../html5/weekly.conf.html">weekly.conf(5)</a>.<p>
The <b class="name">rc.subr</b> functions are accessed by sourcing <i class="file">/etc/rc.subr</i> into the current shell.<p>
The following shell functions are available:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">backup_file</b> <i class="arg">action</i> <i class="arg">file</i> <i class="arg">current</i> <i class="arg">backup</i></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
Make a backup copy of <i class="arg">file</i> into <i class="arg">current</i>. If the <a class="link-man" href="../html5/rc.conf.html">rc.conf(5)</a> variable <span class="symb">backup_uses_rcs</span> is &#8216;YES&#8217;, use <a class="link-man" href="../html1/rcs.html">rcs(1)</a> to archive the previous version of <i class="arg">current</i>, otherwise save the previous version of <i class="arg">current</i> as <i class="arg">backup</i>.<p>
<i class="arg">action</i> may be one of the following:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">add</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
<i class="arg">file</i> is now being backed up by or possibly re-entered into this backup mechanism. <i class="arg">current</i> is created, and if necessary, the <a class="link-man" href="../html1/rcs.html">rcs(1)</a> files are created as well.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">update</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
<i class="arg">file</i> has changed and needs to be backed up. If <i class="arg">current</i> exists, it is copied to <i class="arg">backup</i> or checked into <a class="link-man" href="../html1/rcs.html">rcs(1)</a> (if the repository file is old), and then <i class="arg">file</i> is copied to <i class="arg">current</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">remove</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
<i class="arg">file</i> is no longer being tracked by this backup mechanism. If <a class="link-man" href="../html1/rcs.html">rcs(1)</a> is being used, an empty file is checked in and <i class="arg">current</i> is removed, otherwise <i class="arg">current</i> is moved to <i class="arg">backup</i>.</dd>
</dl>
<b class="cmd">basename</b> <i class="arg">file</i> &#91;<span class="opt"><i class="arg">suffix</i></span>&#93; Just like <a class="link-man" href="../html1/basename.html">basename(1)</a>, except implemented using shell built-in commands, and usable before the <i class="file">/usr/bin</i> direcory is available.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">checkyesno</b> <i class="arg">var</i></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
Return 0 if <i class="arg">var</i> is defined to &#8216;YES&#8217;, &#8216;TRUE&#8217;, &#8216;ON&#8217;, or &#8216;1&#8217;. Return 1 if <i class="arg">var</i> is defined to &#8216;NO&#8217;, &#8216;FALSE&#8217;, &#8216;OFF&#8217;, or &#8216;0&#8217;. Otherwise, warn that <i class="arg">var</i> is not set correctly. The values are case insensitive.<p>
Note that the warning message shown by this function when <i class="arg">var</i> is not set references a manual page where the user can find more information. Its name is picked up from the <span class="symb">rcvar_manpage</span> variable.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">check_pidfile</b> <i class="arg">pidfile</i> <i class="arg">procname</i> &#91;<span class="opt"><i class="arg">interpreter</i></span>&#93;</dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
Parses the first word of the first line of <i class="arg">pidfile</i> for a PID, and ensures that the process with that PID is running and its first argument matches <i class="arg">procname</i>. Prints the matching PID if successful, otherwise nothing. If <i class="arg">interpreter</i> is provided, parse the first line of <i class="arg">procname</i>, ensure that the line is of the form<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit">#! interpreter [...]</code></div>
</blockquote>
and use <i class="arg">interpreter</i> with its optional arguments and <i class="arg">procname</i> appended as the process string to search for.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">check_process</b> <i class="arg">procname</i> &#91;<span class="opt"><i class="arg">interpreter</i></span>&#93;</dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
Prints the PIDs of any processes that are running with a first argument that matches <i class="arg">procname</i>. <i class="arg">interpreter</i> is handled as per <b class="cmd">check_pidfile</b>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">collapse_backslash_newline</b></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
Copy input to output, collapsing &#60;backslash&#62;&#60;newline&#62; to nothing, but leaving other backslashes alone. <b class="cmd">dirname</b> <i class="arg">file</i> Just like <a class="link-man" href="../html1/dirname.html">dirname(1)</a>, except implemented using shell built-in commands, and usable before the <i class="file">/usr/bin</i> direcory is available.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">err</b> <i class="arg">exitval</i> <i class="arg">message</i></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
Display an error message to <span class="emph">stderr</span>, log it to the system log using <a class="link-man" href="../html1/logger.html">logger(1)</a>, and <b class="flag">exit</b> with an exit value of <i class="arg">exitval</i>. The error message consists of the script name (from <span class="symb">$0</span>), followed by &#8220;: ERROR: &#8221;, and then <i class="arg">message</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">load_rc_config</b> <i class="arg">command</i></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
Source in the <a class="link-man" href="../html5/rc.conf.html">rc.conf(5)</a> configuration files for <i class="arg">command</i>. First, <i class="file">/etc/rc.conf</i> is sourced if it has not yet been read in. Then, <i class="file">/etc/rc.conf.d/</i><i class="arg">command</i> is sourced if it is an existing file. The latter may also contain other variable assignments to override <b class="cmd">run_rc_command</b> arguments defined by the calling script, to provide an easy mechanism for an administrator to override the behaviour of a given <a class="link-man" href="../html8/rc.d.html">rc.d(8)</a> script without requiring the editing of that script.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">load_rc_config_var</b> <i class="arg">command</i> <i class="arg">var</i></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
Read the <a class="link-man" href="../html5/rc.conf.html">rc.conf(5)</a> variable <i class="arg">var</i> for <i class="arg">command</i> and set in the current shell, using <b class="cmd">load_rc_config</b> in a sub-shell to prevent unwanted side effects from other variable assignments.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">mount_critical_filesystems</b> <i class="arg">type</i></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
Go through a list of critical file systems, as found in the <a class="link-man" href="../html5/rc.conf.html">rc.conf(5)</a> variable <span class="symb">critical_filesystems_</span><i class="arg">type</i>, mounting each one that is not currently mounted.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">no_rc_postprocess</b> <i class="arg">command</i> &#91;<span class="opt"><i class="arg">arguments</i></span>&#93;</dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
Execute the specified command with the specified arguments, in such a way that its output bypasses the post-processor that <a class="link-man" href="../html8/rc.html">rc(8)</a> uses for most commands. This implies that the output will not appear in the <i class="file">/var/run/rc.log</i> file, and will appear on the console regardless of the value of <b class="var">rc_silent</b>. This is expected to be useful for interactive commands, and this mechanism is automatically used by <b class="cmd">run_rc_command</b> when a script contains the <a class="link-man" href="../html8/rcorder.html">rcorder(8)</a> keyword &#8220;interactive&#8221;.<p>
If invoked from a context that does not appear to be under the control of <a class="link-man" href="../html8/rc.html">rc(8)</a>, then the command is executed without special treatment.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">print_rc_metadata</b> <i class="arg">string</i></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
Print the specified <i class="arg">string</i> in such a way that it should be handled as meta-data by the <a class="link-man" href="../html8/rc.html">rc(8)</a> post-processor. If invoked from a context that does not appear to be under the control of <a class="link-man" href="../html8/rc.html">rc(8)</a>, then the <i class="arg">string</i> is discarded.<p>
Any <a class="link-man" href="../html8/rc.d.html">rc.d(8)</a> script may invoke this function with an argument that begins with &#8220;note:&#8221;, followed by one line of arbitrary text; the text will be logged by <a class="link-man" href="../html8/rc.html">rc(8)</a> but will not be displayed on the console.<p>
The use of arguments that do not begin with &#8220;note:&#8221; is reserved for internal use by <a class="link-man" href="../html8/rc.html">rc(8)</a> and <b class="name">rc.subr</b>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">print_rc_normal</b> &#91;<span class="opt"><b class="flag">&#45;n</b></span>&#93; <i class="arg">string</i></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
Print the specified <i class="arg">string</i> in such a way that it should be handled as normal output by the <a class="link-man" href="../html8/rc.html">rc(8)</a> post-processor. If invoked from a context that does not appear to be under the control of <a class="link-man" href="../html8/rc.html">rc(8)</a>, then the <i class="arg">string</i> is printed to standard output.<p>
If the <b class="flag">&#45;n</b> flag is specified, then the string is printed without a newline.<p>
Intended use cases include:<ul style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-bul">
<li class="list-bul" style="margin-top: 1.00em;">
An rc.d script can use &#8220;<span class="symb">print_rc_normal</span> <b class="flag">&#45;n</b>&#8221; to print a partial line in such a way that it appears immediately instead of being buffered by <a class="link-man" href="../html8/rc.html">rc(8)</a>&#39;s post-processor.</li>
<li class="list-bul" style="margin-top: 1.00em;">
An rc.d script that is run via the <span class="symb">no_rc_postprocess</span> function (so most of its output is invisible to <a class="link-man" href="../html8/rc.html">rc(8)</a>&#39;s post-processor) can use <span class="symb">print_rc_normal</span> to force some of its output to be seen by the post-processor.</li>
</ul>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">rc_usage</b> <i class="arg">command</i> &#91;<span class="opt"><i class="arg">...</i></span>&#93;</dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
Print a usage message for <span class="symb">$0</span>, with <i class="arg">commands</i> being the list of valid arguments prefixed by &#8220;[fast|force|one]&#8221;.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">reverse_list</b> <i class="arg">item</i> &#91;<span class="opt"><i class="arg">...</i></span>&#93;</dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
Print the list of <i class="arg">items</i> in reverse order.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">run_rc_command</b> <i class="arg">argument</i> &#91;<span class="opt"><i class="arg">parameter ...</i></span>&#93;</dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
Run the <i class="arg">argument</i> method for the current <a class="link-man" href="../html8/rc.d.html">rc.d(8)</a> script, based on the settings of various shell variables. <b class="cmd">run_rc_command</b> is extremely flexible, and allows fully functional <a class="link-man" href="../html8/rc.d.html">rc.d(8)</a> scripts to be implemented in a small amount of shell code. The optional set of parameters is passed verbatim to the command, but not to its pre/post hooks.<p>
<i class="arg">argument</i> is searched for in the list of supported commands, which may be one of:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">start</span></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Start the service. This should check that the service is to be started as specified by <a class="link-man" href="../html5/rc.conf.html">rc.conf(5)</a>. Also checks if the service is already running and refuses to start if it is. This latter check is not performed by standard <span class="unix">NetBSD</span> scripts if the system is starting directly to multi-user mode, to speed up the boot process.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">stop</span></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
If the service is to be started as specified by <a class="link-man" href="../html5/rc.conf.html">rc.conf(5)</a>, stop the service. This should check that the service is running and complain if it's not.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">restart</span></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Perform a <span class="symb">stop</span> then a <span class="symb">start</span>. Defaults to displaying the process ID of the program (if running).</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">rcvar</span></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Display which <a class="link-man" href="../html5/rc.conf.html">rc.conf(5)</a> variables are used to control the startup of the service (if any).</dd>
</dl>
<p>
If <span class="symb">pidfile</span> or <span class="symb">procname</span> is set, also support:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">poll</span></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Wait for the command to exit.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">status</span></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Show the status of the process.</dd>
</dl>
<p>
Other supported commands are listed in the optional variable <span class="symb">extra_commands</span>.<p>
<i class="arg">argument</i> may have one of the following prefixes which alters its operation:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">fast</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Skip the check for an existing running process, and sets <span class="symb">rc_fast=YES</span>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">force</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Skip the checks for <span class="symb">rcvar</span> being set to yes, and sets <span class="symb">rc_force=YES</span>. This ignores <i class="arg">argument</i><span class="symb">_precmd</span> returning non-zero, and ignores any of the <span class="symb">required_*</span> tests failing, and always returns a zero exit status.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">one</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Skip the checks for <span class="symb">rcvar</span> being set to yes, but performs all the other prerequisite tests.</dd>
</dl>
<p>
<b class="cmd">run_rc_command</b> uses the following shell variables to control its behaviour. Unless otherwise stated, these are optional.<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">name</span></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
The name of this script. This is not optional.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">rcvar</span></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
The value of <span class="symb">rcvar</span> is checked with <b class="cmd">checkyesno</b> to determine if this method should be run.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">rcvar_manpage</span></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
The manual page containing information about <span class="symb">rcvar</span>. It will be part of the warning message shown when <span class="symb">rcvar</span> is undefined. Defaults to <a class="link-man" href="../html5/rc.conf.html">rc.conf(5)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">command</span></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
Full path to the command. Not required if <i class="arg">argument</i><span class="symb">_cmd</span> is defined for each supported keyword.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">command_args</span></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
Optional arguments and/or shell directives for <span class="symb">command</span>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">command_interpreter</span></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
<span class="symb">command</span> is started with<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit">#! command_interpreter [...]</code></div>
</blockquote>
which results in its <a class="link-man" href="../html1/ps.html">ps(1)</a> command being<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit">command_interpreter [...] command</code></div>
</blockquote>
so use that string to find the PID(s) of the running command rather than &#8216;<code class="lit">command</code>&#8217;.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">extra_commands</span></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
Extra commands/keywords/arguments supported.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">pidfile</span></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
Path to pid file. Used to determine the PID(s) of the running command. If <span class="symb">pidfile</span> is set, use<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit">check_pidfile $pidfile $procname</code></div>
</blockquote>
to find the PID. Otherwise, if <span class="symb">command</span> is set, use<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit">check_process $procname</code></div>
</blockquote>
to find the PID.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">procname</span></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
Process name to check for. Defaults to the value of <span class="symb">command</span>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">required_dirs</span></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
Check for the existence of the listed directories before running the default start method.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">required_files</span></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
Check for the readability of the listed files before running the default start method.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">required_vars</span></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
Perform <b class="cmd">checkyesno</b> on each of the list variables before running the default start method.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">${name}_chdir</span></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
Directory to <b class="cmd">cd</b> to before running <span class="symb">command</span>, if <span class="symb">${name}_chroot</span> is not provided.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">${name}_chroot</span></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
Directory to <a class="link-man" href="../html8/chroot.html">chroot(8)</a> to before running <span class="symb">command</span>. Only supported after <i class="file">/usr</i> is mounted.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">${name}_env</span></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
List of additional or modified environment variables to set when starting <span class="symb">command</span>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">${name}_flags</span></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
Arguments to call <span class="symb">command</span> with. This is usually set in <a class="link-man" href="../html5/rc.conf.html">rc.conf(5)</a>, and not in the <a class="link-man" href="../html8/rc.d.html">rc.d(8)</a> script. The environment variable &#8216;<span class="env">flags</span>&#8217; can be used to override this.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">${name}_nice</span></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
<a class="link-man" href="../html1/nice.html">nice(1)</a> level to run <span class="symb">command</span> as. Only supported after <i class="file">/usr</i> is mounted.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">${name}_user</span></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
User to run <span class="symb">command</span> as, using <a class="link-man" href="../html8/chroot.html">chroot(8)</a>. if <span class="symb">${name}_chroot</span> is set, otherwise uses <a class="link-man" href="../html1/su.html">su(1)</a>. Only supported after <i class="file">/usr</i> is mounted.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">${name}_group</span></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
Group to run the chrooted <span class="symb">command</span> as.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">${name}_groups</span></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
Comma separated list of supplementary groups to run the chrooted <span class="symb">command</span> with.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="arg">argument</i><span class="symb">_cmd</span></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
Shell commands which override the default method for <i class="arg">argument</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="arg">argument</i><span class="symb">_precmd</span></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
Shell commands to run just before running <i class="arg">argument</i><span class="symb">_cmd</span> or the default method for <i class="arg">argument</i>. If this returns a non-zero exit code, the main method is not performed. If the default method is being executed, this check is performed after the <span class="symb">required_*</span> checks and process (non-)existence checks.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="arg">argument</i><span class="symb">_postcmd</span></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
Shell commands to run if running <i class="arg">argument</i><span class="symb">_cmd</span> or the default method for <i class="arg">argument</i> returned a zero exit code.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">sig_stop</span></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
Signal to send the processes to stop in the default <span class="symb">stop</span> method. Defaults to <span class="define">SIGTERM</span>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">sig_reload</span></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
Signal to send the processes to reload in the default <span class="symb">reload</span> method. Defaults to <span class="define">SIGHUP</span>.</dd>
</dl>
<p>
For a given method <i class="arg">argument</i>, if <i class="arg">argument</i><span class="symb">_cmd</span> is not defined, then a default method is provided by <span class="symb">run_rc_command</span>:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">Argument</span></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
<span class="symb">Default method</span></dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">start</span></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
If <span class="symb">command</span> is not running and <b class="cmd">checkyesno</b> <span class="symb">rcvar</span> succeeds, start <span class="symb">command</span>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">stop</span></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
Determine the PIDs of <span class="symb">command</span> with <b class="cmd">check_pidfile</b> or <b class="cmd">check_process</b> (as appropriate), <b class="cmd">kill</b> <span class="symb">sig_stop</span> those PIDs, and run <b class="cmd">wait_for_pids</b> on those PIDs.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">reload</span></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
Similar to <span class="symb">stop</span>, except that it uses <span class="symb">sig_reload</span> instead, and doesn't run <b class="cmd">wait_for_pids</b>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">restart</span></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
Runs the <span class="symb">stop</span> method, then the <span class="symb">start</span> method.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">status</span></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
Show the PID of <span class="symb">command</span>, or some other script specific status operation.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">poll</span></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
Wait for <span class="symb">command</span> to exit.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">rcvar</span></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
Display which <a class="link-man" href="../html5/rc.conf.html">rc.conf(5)</a> variable is used (if any). This method always works, even if the appropriate <a class="link-man" href="../html5/rc.conf.html">rc.conf(5)</a> variable is set to &#8216;NO&#8217;.</dd>
</dl>
<p>
The following variables are available to the methods (such as <i class="arg">argument</i><span class="symb">_cmd</span>) as well as after <b class="cmd">run_rc_command</b> has completed:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">rc_arg</span></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
Argument provided to <span class="symb">run_rc_command</span>, after fast and force processing has been performed.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">rc_flags</span></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
Flags to start the default command with. Defaults to <span class="symb">${name}_flags</span>, unless overridden by the environment variable &#8216;<span class="env">flags</span>&#8217;. This variable may be changed by the <i class="arg">argument</i><span class="symb">_precmd</span> method.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">rc_pid</span></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
PID of <span class="symb">command</span> (if appropriate).</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">rc_fast</span></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
Not empty if &#8220;fast&#8221; prefix was used.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="symb">rc_force</span></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
Not empty if &#8220;force&#8221; prefix was used.</dd>
</dl>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">run_rc_script</b> <i class="arg">file</i> <i class="arg">argument</i></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
Start the script <i class="arg">file</i> with an argument of <i class="arg">argument</i>, and handle the return value from the script.<p>
Various shell variables are unset before <i class="arg">file</i> is started:<p>
<div style="margin-left: 5.00ex;" class="display">
<span class="symb">name</span>, <span class="symb">command</span>, <span class="symb">command_args</span>, <span class="symb">command_interpreter</span>, <span class="symb">extra_commands</span>, <span class="symb">pidfile</span>, <span class="symb">rcvar</span>, <span class="symb">required_dirs</span>, <span class="symb">required_files</span>, <span class="symb">required_vars</span>, <i class="arg">argument</i><span class="symb">_cmd</span>, <i class="arg">argument</i><span class="symb">_precmd</span>. <i class="arg">argument</i><span class="symb">_postcmd</span>.</div>
<p>
The startup behaviour of <i class="arg">file</i> depends upon the following checks:<ol style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-enum">
<li class="list-enum" style="margin-top: 1.00em;">
If <i class="arg">file</i> ends in <i class="file">.sh</i>, it is sourced into the current shell.</li>
<li class="list-enum" style="margin-top: 1.00em;">
If <i class="arg">file</i> appears to be a backup or scratch file (e.g., with a suffix of &#8216;~&#8217;, &#8216;#&#8217;, &#8216;.OLD&#8217;, or &#8216;.orig&#8217;), ignore it.</li>
<li class="list-enum" style="margin-top: 1.00em;">
If <i class="arg">file</i> is not executable, ignore it.</li>
<li class="list-enum" style="margin-top: 1.00em;">
If the <a class="link-man" href="../html5/rc.conf.html">rc.conf(5)</a> variable <span class="symb">rc_fast_and_loose</span> is empty, source <i class="arg">file</i> in a sub shell, otherwise source <i class="arg">file</i> into the current shell.</li>
<li class="list-enum" style="margin-top: 1.00em;">
If <i class="arg">file</i> contains the <a class="link-man" href="../html8/rcorder.html">rcorder(8)</a> keyword &#8220;interactive&#8221;, then the command is executed using <b class="cmd">no_rc_postprocess</b>.</li>
</ol>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">stop_boot</b></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
Prevent booting to multiuser mode. If the <span class="symb">autoboot</span> variable is &#8216;yes&#8217;, then a <span class="symb">SIGTERM</span> signal is sent to the parent process (which is assumed to be <a class="link-man" href="../html8/rc.html">rc(8)</a>). Otherwise, the shell exits with status <code class="lit">1</code>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">twiddle</b></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
Display one of the characters &#8216;/, -, &#92;, |&#8217;, followed by a backspace. Repeated calls to this function will create the appearance of a spinning symbol, as a different character is displayed on each call. Output is to <i class="file">/dev/tty</i>, so this function may be useful even inside a script whose output has been redirected.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">wait_for_pids</b> &#91;<span class="opt"><i class="arg">pid</i> &#91;<span class="opt"><i class="arg">...</i></span>&#93;</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
Wait until all of the provided <i class="arg">pids</i> don't exist any more, printing the list of outstanding <i class="arg">pids</i> every two seconds.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">warn</b> <i class="arg">message</i></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
Display a warning message to <span class="emph">stderr</span> and log it to the system log using <a class="link-man" href="../html1/logger.html">logger(1)</a>. The warning message consists of the script name (from <span class="symb">$0</span>), followed by &#8220;: WARNING: &#8221;, and then <i class="arg">message</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">yesno_to_truefalse</b> <i class="arg">var</i></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
Change the value of the specified variable from any of the forms acceptable to the <b class="cmd">checkyesno</b> function, to &#8220;true&#8221; or &#8220;false&#8221;.</dd>
</dl>
</div>
<div class="section">
<h1 id="x46494c4553">FILES</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/etc/rc.subr</i></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
The <b class="name">rc.subr</b> file resides in <i class="file">/etc</i>.</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html5/rc.conf.html">rc.conf(5)</a>, <a class="link-man" href="../html8/rc.html">rc(8)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> <b class="name">rc.subr</b> appeared in <span class="unix">NetBSD&#160;1.3</span>. The <a class="link-man" href="../html8/rc.d.html">rc.d(8)</a> support functions appeared in <span class="unix">NetBSD&#160;1.5</span>. Support for the <a class="link-man" href="../html8/rc.html">rc(8)</a> post-processor appeared in <span class="unix">NetBSD&#160;6.0</span>.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
December 17, 2012</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

