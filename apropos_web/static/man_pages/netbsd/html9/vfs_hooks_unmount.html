<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
VFS_HOOKS(9)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
VFS_HOOKS(9)</td>
<td class="head-vol" align="center">
Kernel Developer's Manual</td>
<td class="head-rtitle" align="right">
VFS_HOOKS(9)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">vfs_hooks</b>, <b class="name">vfs_hooks_unmount</b> &#8212; <span class="desc">VFS hooks interface</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">sys/param.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">sys/mount.h</a>&gt;</b><p>
<i class="ftype">void</i><br>
<b class="fname">vfs_hooks_unmount</b>(<i class="farg" style="white-space:nowrap;">struct mount *mp</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The VFS hooks interface provides a way for different kernel subsystems to attach custom functions to specific VFS operations. This enforces code separation by keeping the VFS's core sources uncluttered and makes all subsystem functionality reside in a single place. As an example, this interface is used by the NFS server code to automatically handle the exports list for each mount point.<p>
Hooks are described by a <i class="ftype">struct vfs_hooks</i> object, as seen below:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
struct vfs_hooks { 
	int	(*vh_unmount)(struct mount *); 
};</pre>
<p>
For simplicity, each field is named after the VFS operation it refers to. The purpose of each member function, alongside some important notes, is shown below:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">vh_unmount</b>(<i class="farg">mp</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This hook is executed during the unmount process of a file system.</dd>
</dl>
<p>
For more information about the purpose of each operation, see <a class="link-man" href="../html9/vfsops.html">vfsops(9)</a>. Note that any of these fields may be a null pointer.<p>
After the definition of a <i class="ftype">struct vfs_hooks</i> object, the kernel has to add it to the <b class="var">vfs_hooks</b> link set using the <b class="fname">VFS_HOOKS_ATTACH</b>(<i class="farg">struct vfs_hooks *</i>) macro.<p>
Please note that this interface is incomplete on purpose to keep it in its smallest possible size (i.e., do not provide a hook that is not used). If you feel the need to hook a routine to a VFS operation that is not yet supported by this interface, just add it to the files described in <i class="link-sec"><a class="link-sec" href="#x434f4445205245464552454e434553">CODE REFERENCES</a></i>.</div>
<div class="section">
<h1 id="x46554e4354494f4e53">FUNCTIONS</h1> The following functions are provided to the VFS code to run the hooked functions:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">vfs_hooks_unmount</b>(<i class="farg">mp</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Runs all hooks for the VFS unmount operation. Given that these operations shall not fail, it returns <i class="ftype">void</i>.</dd>
</dl>
</div>
<div class="section">
<h1 id="x434f4445205245464552454e434553">CODE REFERENCES</h1> The VFS hooks interface is implemented within the files <i class="file">sys/kern/vfs_hooks.c</i> and <i class="file">sys/sys/mount.h</i>.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html9/intro.html">intro(9)</a>, <a class="link-man" href="../html9/vfs.html">vfs(9)</a>, <a class="link-man" href="../html9/vfsops.html">vfsops(9)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The VFS hooks interface appeared in <span class="unix">NetBSD&#160;4.0</span>.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
September 23, 2005</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

