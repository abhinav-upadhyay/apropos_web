<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
WSDISPLAY(9)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
WSDISPLAY(9)</td>
<td class="head-vol" align="center">
Kernel Developer's Manual</td>
<td class="head-rtitle" align="right">
WSDISPLAY(9)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">wsdisplay</b>, <b class="name">wsdisplay_switchtoconsole</b>, <b class="name">wsdisplay_cnattach</b>, <b class="name">wsdisplaydevprint</b>, <b class="name">wsemuldisplaydevprint</b> &#8212; <span class="desc">wscons display support</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">dev/wscons/wsconsio.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">dev/wscons/wsdisplayvar.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">dev/wscons/wsemulvar.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">dev/wscons/wsemul_vt100var.h</a>&gt;</b><p>
<i class="ftype">void</i><br>
<b class="fname">wsdisplay_switchtoconsole</b>(<i class="farg" style="white-space:nowrap;"></i>);<p>
<i class="ftype">void</i><br>
<b class="fname">wsdisplay_cnattach</b>(<i class="farg" style="white-space:nowrap;">const struct wsscreen_descr *type</i>, <i class="farg" style="white-space:nowrap;">void *cookie</i>, <i class="farg" style="white-space:nowrap;">int ccol</i>, <i class="farg" style="white-space:nowrap;">int crow</i>, <i class="farg" style="white-space:nowrap;">long defattr</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">wsemul_xxx_cnattach</b>(<i class="farg" style="white-space:nowrap;">const struct wsscreen_descr *type</i>, <i class="farg" style="white-space:nowrap;">void *cookie</i>, <i class="farg" style="white-space:nowrap;">int ccol</i>, <i class="farg" style="white-space:nowrap;">int crow</i>, <i class="farg" style="white-space:nowrap;">long defattr</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">wsdisplaydevprint</b>(<i class="farg" style="white-space:nowrap;">void *aux</i>, <i class="farg" style="white-space:nowrap;">const char *pnp</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">wsemuldisplaydevprint</b>(<i class="farg" style="white-space:nowrap;">void * aux</i>, <i class="farg" style="white-space:nowrap;">const char *pnp</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="name">wsdisplay</b> module is a component of the <a class="link-man" href="../html9/wscons.html">wscons(9)</a> framework to provide machine-independent display support. Most of the support is provided by the <a class="link-man" href="../html4/wsdisplay.html">wsdisplay(4)</a> device driver, which must be a child of the hardware device driver.<p>
The wscons display interface is complicated by the fact that there are two different interfaces. The first interface corresponds to the simple bit-mapped display which doesn't provide terminal-emulation and console facilities. The second interface provides machine-independent terminal emulation for displays that can support glass-tty terminal emulations. These are character-oriented displays, with row and column numbers starting at zero in the upper left hand corner of the screen. Display drivers which cannot emulate terminals use the first interface. In most cases, the low-level hardware driver can use the <a class="link-man" href="../html9/rasops.html">rasops(9)</a> interface to provide enough support to allow glass-tty terminal emulation. If the display is not the console, terminal emulation does not make sense and the display operates using the bit-mapped interface.<p>
The wscons framework allows concurrent displays to be active. It also provides support for multiple screens for each display and therefore allows a virtual terminal on each screen. Multiple terminal emulations and fonts can be active at the same time allowing different emulations and fonts for each screen.<p>
Font manipulation facilities for the terminal emulation interface are available through the <a class="link-man" href="../html9/wsfont.html">wsfont(9)</a> module.</div>
<div class="section">
<h1 id="x44415441205459504553">DATA TYPES</h1> Display drivers providing support for wscons displays will make use of the following data types:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">struct wsdisplay_accessops</i></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
A structure used to specify the display access functions invoked by userland program which require direct device access, such as X11. All displays must provide this structure and pass it to the <a class="link-man" href="../html4/wsdisplay.html">wsdisplay(4)</a> child device. It has the following members:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
	int	(*ioctl)(void *v, void *vs, u_long cmd, 
			void *data, int flag, struct lwp *l); 
	paddr_t	(*mmap)(void *v, void *vs, off_t off, int prot); 
	int	(*alloc_screen)(void *, 
			const struct wsscreen_descr *, void **, 
			int *, int *, long *); 
	void	(*free_screen)(void *, void *); 
	int	(*show_screen)(void *, void *, int, 
			void (*)(), void *); 
	int	(*load_font)(void *, void *, 
			struct wsdisplay_font *); 
	void	(*pollc)(void *, int); 
	void	(*scroll)(void *, void *, int);</pre>
<p>
The <i class="farg">ioctl</i> member defines the function to be called to perform display-specific ioctl calls. The <i class="farg">mmap</i> member defines the function for mapping a part of the display device into user address space. The <i class="farg">alloc_screen</i> member defines a function for allocating a new screen which can be used as a virtual terminal. The <i class="farg">free_screen</i> member defines a function for de-allocating a screen. The <i class="farg">show_screen</i> member defines a function for mapping a screen onto the physical display. This function is used for switching between screens. The <i class="farg">load_font</i> member defines a function for loading a new font into the display. The <i class="farg">pollc</i> member defines a function for polling the console. The <i class="farg">scroll</i> member defines a function for scrolling the contents of the display.<p>
There is a <i class="farg">void *</i> cookie provided by the display driver associated with these functions, which is passed to them when they are invoked.<p>
The <i class="farg">void *vs</i> cookie, passed to <b class="fname">ioctl</b>() and <b class="fname">mmap</b>(), points to the virtual screen on which these operations were executed.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">struct wsdisplaydev_attach_args</i></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
A structure used to attach the <a class="link-man" href="../html4/wsdisplay.html">wsdisplay(4)</a> child device for the simple bit-mapped interface. It has the following members:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
	const struct wsdisplay_accessops *accessops; 
	void *accesscookie;</pre>
If the full terminal-emulation interface is to be used, then <span class="emph">struct wsemuldisplaydev_attach_args</span> should be used instead.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">struct wsemuldisplaydev_attach_args</i></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
A structure used to attach the <a class="link-man" href="../html4/wsdisplay.html">wsdisplay(4)</a> child device for the full terminal emulation interface. It has the following members:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
	int console; 
	const struct wsscreen_list *scrdata; 
	const struct wsdisplay_accessops *accessops; 
	void *accesscookie;</pre>
If the simple bit-mapped interface is to be used, then <span class="emph">struct wsdisplaydev_attach_args</span> should be used instead.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">struct wsdisplay_emulops</i></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
A structure used to specify the display emulation functions. All displays intending to provide terminal emulation must provide this structure and pass it to the <a class="link-man" href="../html4/wsdisplay.html">wsdisplay(4)</a> child device. It has the following members:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
	void	(*cursor)(void *c, int on, int row, int col); 
	int	(*mapchar)(void *, int, unsigned int *); 
	void	(*putchar)(void *c, int row, int col, 
			u_int uc, long attr); 
	void	(*copycols)(void *c, int row, int srccol, 
			int dstcol, int ncols); 
	void	(*erasecols)(void *c, int row, int startcol, 
			int ncols, long); 
	void	(*copyrows)(void *c, int srcrow, int dstrow, 
			int nrows); 
	void	(*eraserows)(void *c, int row, int nrows, long); 
	int	(*allocattr)(void *c, int fg, int bg, int flags, 
			long *); 
	void	(*replaceattr)(void *c, long oldattr, 
			long newattr);</pre>
<p>
The <i class="farg">cursor</i> member defines a function for painting (or unpainting, depending on the <b class="var">on</b> parameter) the cursor at the specified position. The <i class="farg">mapchar</i> member defines a function for changing the character mapped at a given position in the character table. The <i class="farg">putchar</i> member defines a function for writing a character on the screen, given its position and attribute. The <i class="farg">copycols</i> member defines a function for copying a set of columns within the same line. The <i class="farg">erasecols</i> member defines a function for clearing a set of columns in a line, filling the space with the given attribute. The <i class="farg">copyrows</i> member defines a function for copying a set of complete rows. The <i class="farg">eraserows</i> member defines a function for clearing a set of complete rows, filling the space with the given attribute. The <i class="farg">allocattr</i> member defines a function for converting an attribute specification given by its foreground color, background color and flags, to the internal representation used by the underlying graphics driver. The <i class="farg">replaceattr</i> member defines a function for replacing an attribute by another one across the whole visible part of the screen; this function is optional.<p>
There is a <i class="farg">void *</i> cookie provided by the display driver associated with these functions, which is passed to them when they are invoked.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">struct wsscreen_descr</i></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
A structure passed to wscons by the display driver to describe a screen. All displays which can operate as a console must provide this structure and pass it to the <a class="link-man" href="../html4/wsdisplay.html">wsdisplay(4)</a> child device. It contains the following members:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
        char *name; 
        int ncols, nrows; 
        const struct wsdisplay_emulops *textops; 
        int fontwidth, fontheight; 
        int capabilities;</pre>
<p>
The <span class="emph">capabilities</span> member is a set of flags describing the screen capabilities. It can contain the following flags:<p>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
WSSCREEN_WSCOLORS</dt>
<dd class="list-tag" style="margin-left: 18.00ex;">
minimal color capability</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
WSSCREEN_REVERSE</dt>
<dd class="list-tag" style="margin-left: 18.00ex;">
can display reversed</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
WSSCREEN_HILIT</dt>
<dd class="list-tag" style="margin-left: 18.00ex;">
can highlight (however)</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
WSSCREEN_BLINK</dt>
<dd class="list-tag" style="margin-left: 18.00ex;">
can blink</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
WSSCREEN_UNDERLINE</dt>
<dd class="list-tag" style="margin-left: 18.00ex;">
can underline</dd>
</dl>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">struct wsscreen_list</i></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
A structure passed to wscons by the display driver to tell about its capabilities. It contains the following members:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
	int nscreens; 
	const struct wsscreen_descr **screens;</pre>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">struct wscons_syncops</i></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
A structure passed to wscons by the display driver describing the interface for external screen switching/process synchronization. This structure is optional and only required by displays operating with terminal emulation and intending to support multiple screens. It contains the following members:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
	int	(*detach)(void *, int, void (*)(), void *); 
	int	(*attach)(void *, int, void (*)(), void *); 
	int	(*check)(void *); 
	void	(*destroy)(void *);</pre>
</dd>
</dl>
</div>
<div class="section">
<h1 id="x46554e4354494f4e53">FUNCTIONS</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">wsdisplay_switchtoconsole</b>(<i class="farg"></i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Switch the console display to its first screen.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">wsdisplay_cnattach</b>(<i class="farg">type</i>, <i class="farg">cookie</i>, <i class="farg">ccol</i>, <i class="farg">crow</i>, <i class="farg">defattr</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Attach this display as the console input by specifying the number of columns <i class="farg">ccol</i> and number of rows <i class="farg">crows</i>. The argument <i class="farg">defattr</i> specifies the default attribute (color) for the console.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">wsemul_xxx_cnattach</b>(<i class="farg">type</i>, <i class="farg">cookie</i>, <i class="farg">ccol</i>, <i class="farg">crow</i>, <i class="farg">defattr</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Attach this display as the console with terminal emulation described by the <span class="emph">xxx</span> and specifying the number of columns <i class="farg">ccol</i> and number of rows <i class="farg">crows</i>. The argument <i class="farg">defattr</i> specifies the default attribute (color) for the console. Different terminal emulations can be active at the same time on one display.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">wsdisplaydevprint</b>(<i class="farg">aux</i>, <i class="farg">pnp</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
The default wsdisplay printing routine used by <b class="fname">config_found</b>(). (see <a class="link-man" href="../html9/autoconf.html">autoconf(9)</a>).</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">wsemuldisplaydevprint</b>(<i class="farg">aux</i>, <i class="farg">pnp</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
The default wsemul printing routine used by <b class="fname">config_found</b>(). (see <a class="link-man" href="../html9/autoconf.html">autoconf(9)</a>).</dd>
</dl>
</div>
<div class="section">
<h1 id="x4155544f434f4e46494755524154494f4e">AUTOCONFIGURATION</h1> Display drivers which want to use the wsdisplay module must be a parent to the <a class="link-man" href="../html4/wsdisplay.html">wsdisplay(4)</a> device and provide an attachment interface. To attach the <a class="link-man" href="../html4/wsdisplay.html">wsdisplay(4)</a> device, the display driver must allocate and populate a <i class="farg">wsdisplaydev_attach_args</i> structure with the supported operations and callbacks and call <b class="fname">config_found</b>() to perform the attach (see <a class="link-man" href="../html9/autoconf.html">autoconf(9)</a>).<p>
Display drivers which want to use the wscons terminal emulation module must be a parent to the <a class="link-man" href="../html4/wsdisplay.html">wsdisplay(4)</a> device and provide a <i class="farg">wsemuldisplaydev_attach_args</i> structure instead of the standard <i class="farg">wsdisplaydev_attach_args</i> to <b class="fname">config_found</b>() to perform the attach. If the display is not the console the attachment is the same as wsdisplaydev_attach_args.</div>
<div class="section">
<h1 id="x4f5045524154494f4e">OPERATION</h1> If the display belongs to the system console, it must describe the default screen by invoking <b class="fname">wsdisplay_cnattach</b>() at console attach time.<p>
All display manipulation is performed by the wscons interface by using the callbacks defined in the <span class="emph">wsdisplay_accessops</span> structure. The <b class="fname">ioctl</b>() function is called by the wscons interface to perform display-specific ioctl operations (see <a class="link-man" href="../html2/ioctl.html">ioctl(2)</a>). The argument <i class="farg">cmd</i> to the <b class="fname">ioctl</b>() function specifies the specific command to perform using the data <i class="farg">data</i>. Valid commands are listed in <i class="file">sys/dev/wscons/wsconsio.h</i> and documented in <a class="link-man" href="../html4/wsdisplay.html">wsdisplay(4)</a>. Operations for terminal emulation are performed using the callbacks defined in the <span class="emph">wsdisplay_emulops</span> structure.</div>
<div class="section">
<h1 id="x434f4445205245464552454e434553">CODE REFERENCES</h1> The wscons subsystem is implemented within the directory <i class="file">sys/dev/wscons</i>. The <b class="name">wsdisplay</b> module itself is implemented within the file <i class="file">sys/dev/wscons/wsdisplay.c</i>. The terminal emulation support is implemented within the files <i class="file">sys/dev/wscons/wsemul_*</i>. <a class="link-man" href="../html2/ioctl.html">ioctl(2)</a> operations are listed in <i class="file">sys/dev/wscons/wsconsio.h</i>.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html2/ioctl.html">ioctl(2)</a>, <a class="link-man" href="../html4/wsdisplay.html">wsdisplay(4)</a>, <a class="link-man" href="../html9/autoconf.html">autoconf(9)</a>, <a class="link-man" href="../html9/driver.html">driver(9)</a>, <a class="link-man" href="../html9/intro.html">intro(9)</a>, <a class="link-man" href="../html9/rasops.html">rasops(9)</a>, <a class="link-man" href="../html9/wsfont.html">wsfont(9)</a>, <a class="link-man" href="../html9/wskbd.html">wskbd(9)</a>, <a class="link-man" href="../html9/wsmouse.html">wsmouse(9)</a></div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
April 15, 2006</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

