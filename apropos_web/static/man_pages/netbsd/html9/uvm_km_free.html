<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
UVM_KM(9)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
UVM_KM(9)</td>
<td class="head-vol" align="center">
Kernel Developer's Manual</td>
<td class="head-rtitle" align="right">
UVM_KM(9)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">uvm_km</b> &#8212; <span class="desc">raw kernel memory or address space allocator</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">sys/param.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">uvm/uvm.h</a>&gt;</b><p>
<i class="ftype">vaddr_t</i><br>
<b class="fname">uvm_km_alloc</b>(<i class="farg" style="white-space:nowrap;">struct vm_map *map</i>, <i class="farg" style="white-space:nowrap;">vsize_t size</i>, <i class="farg" style="white-space:nowrap;">vsize_t align</i>, <i class="farg" style="white-space:nowrap;">uvm_flag_t flags</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">uvm_km_free</b>(<i class="farg" style="white-space:nowrap;">struct vm_map *map</i>, <i class="farg" style="white-space:nowrap;">vaddr_t addr</i>, <i class="farg" style="white-space:nowrap;">vsize_t size</i>, <i class="farg" style="white-space:nowrap;">uvm_flag_t flags</i>);<p>
<i class="ftype">struct vm_map *</i><br>
<b class="fname">uvm_km_suballoc</b>(<i class="farg" style="white-space:nowrap;">struct vm_map *map</i>, <i class="farg" style="white-space:nowrap;">vaddr_t *min</i>, <i class="farg" style="white-space:nowrap;">vaddr_t *max</i>, <i class="farg" style="white-space:nowrap;">vsize_t size</i>, <i class="farg" style="white-space:nowrap;">int flags</i>, <i class="farg" style="white-space:nowrap;">bool fixed</i>, <i class="farg" style="white-space:nowrap;">struct vm_map *submap</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The UVM facility for allocation of kernel memory or address space in pages. Both wired and pageable memory can be allocated by this facility, as well as kernel address space. Note that this is a raw allocator. For general purpose memory allocation, <a class="link-man" href="../html9/kmem.html">kmem(9)</a> interface should be used.</div>
<div class="section">
<h1 id="x46554e4354494f4e53">FUNCTIONS</h1> <b class="fname">uvm_km_alloc</b>() allocates a contiguous range of <i class="farg">size</i> bytes of kernel memory in map <i class="farg">map</i> and returns the virtual address of the range, or returns zero on failure. The first address of the allocated memory range will be aligned according to the <i class="farg">align</i> argument (specify 0 if no alignment is necessary). The alignment must be a multiple of page size. The <i class="farg">flags</i> is a bitwise inclusive OR of the allocation type and operation flags.<p>
The allocation type should be one of:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
UVM_KMF_WIRED</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
Wired memory.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
UVM_KMF_PAGEABLE</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
Demand-paged zero-filled memory.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
UVM_KMF_VAONLY</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
Virtual address only. No physical pages are mapped in the allocated region. If necessary, it is the caller's responsibility to enter page mappings. It is also the caller's responsibility to clean up the mappings before freeing the address range.</dd>
</dl>
<p>
The following operation flags are available:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
UVM_KMF_CANFAIL</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
Can fail even if <span class="define">UVM_KMF_NOWAIT</span> is not specified and <span class="define">UVM_KMF_WAITVA</span> is specified.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
UVM_KMF_ZERO</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
Request zero-filled memory. Only supported for <span class="define">UVM_KMF_WIRED</span>. Should not be used with other types.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
UVM_KMF_TRYLOCK</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
Fail if cannot lock the map without sleeping.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
UVM_KMF_NOWAIT</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
Fail immediately if no memory is available.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
UVM_KMF_WAITVA</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
Sleep to wait for the virtual address resources if needed.</dd>
</dl>
<p>
If neither <span class="define">UVM_KMF_NOWAIT</span> nor <span class="define">UVM_KMF_CANFAIL</span> are specified and <span class="define">UVM_KMF_WAITVA</span> is specified, <b class="fname">uvm_km_alloc</b>() will never fail, but rather sleep indefinitely until the allocation succeeds.<p>
Pageability of the pages allocated with <span class="define">UVM_KMF_PAGEABLE</span> can be changed by <b class="fname">uvm_map_pageable</b>(). In that case, the entire range must be changed atomically. Changing a part of the range is not supported.<p>
<b class="fname">uvm_km_free</b>() frees the memory range allocated by <b class="fname">uvm_km_alloc</b>(). <i class="farg">addr</i> must be an address returned by <b class="fname">uvm_km_alloc</b>(). <i class="farg">map</i> and <i class="farg">size</i> must be the same as the ones used for the corresponding <b class="fname">uvm_km_alloc</b>(). <i class="farg">flags</i> must be the allocation type used for the corresponding <b class="fname">uvm_km_alloc</b>(). Note that <b class="fname">uvm_km_free</b>() is the only way to free memory ranges allocated by <b class="fname">uvm_km_alloc</b>(). <b class="fname">uvm_unmap</b>() must not be used.<p>
<b class="fname">uvm_km_suballoc</b>() allocates submap from <i class="farg">map</i>, creating a new map if <i class="farg">submap</i> is <span class="define">NULL</span>. The addresses of the submap can be specified explicitly by setting the <i class="farg">fixed</i> argument to true, which causes the <i class="farg">min</i> argument to specify the beginning of the address in the submap. If <i class="farg">fixed</i> is false, any address of size <i class="farg">size</i> will be allocated from <i class="farg">map</i> and the start and end addresses returned in <i class="farg">min</i> and <i class="farg">max</i>. The <i class="farg">flags</i> are used to initialize the created submap. The following flags can be set:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
VM_MAP_PAGEABLE</dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
Entries in the map may be paged out.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
VM_MAP_INTRSAFE</dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
Map should be interrupt-safe.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
VM_MAP_TOPDOWN</dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
A top-down mapping should be arranged.</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html9/kmem.html">kmem(9)</a>, <a class="link-man" href="../html9/pmap.html">pmap(9)</a>, <a class="link-man" href="../html9/pool_cache.html">pool_cache(9)</a>, <a class="link-man" href="../html9/uvm.html">uvm(9)</a>, <a class="link-man" href="../html9/uvm_map.html">uvm_map(9)</a>, <a class="link-man" href="../html9/vmem.html">vmem(9)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> UVM and <b class="name">uvm_km</b> first appeared in <span class="unix">NetBSD&#160;1.4</span>.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
June 3, 2011</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

