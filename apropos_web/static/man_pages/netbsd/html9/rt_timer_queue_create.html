<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/../4/strict.dtd">
>
<head>
<meta http-equiv="Content-Type" content="te../; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
RT_TIMER(9)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
RT_TIMER(9)</td>
<td class="head-vol" align="center">
Kernel Developer's Manual</td>
<td class="head-rtitle" align="right">
RT_TIMER(9)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">rt_timer</b>, <b class="name">rt_timer_add</b>, <b class="name">rt_timer_queue_create</b>, <b class="name">rt_timer_queue_change</b>, <b class="name">rt_timer_queue_destroy</b>, <b class="name">rt_timer_remove_all</b> &#8212; <span class="desc">route callout functions</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">net/route.h</a>&gt;</b><p>
<i class="ftype">struct rttimer_queue *</i><br>
<b class="fname">rt_timer_queue_create</b>(<i class="farg" style="white-space:nowrap;">time_t timeout</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">rt_timer_queue_change</b>(<i class="farg" style="white-space:nowrap;">struct rttimer_queue *q</i>, <i class="farg" style="white-space:nowrap;">time_t timeout</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">rt_timer_queue_destroy</b>(<i class="farg" style="white-space:nowrap;">struct rttimer_queue *q</i>, <i class="farg" style="white-space:nowrap;">int destroy</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">rt_timer_add</b>(<i class="farg" style="white-space:nowrap;">struct rtentry *rt</i>, <i class="farg" style="white-space:nowrap;">void(*f)(struct rtentry *, struct rttimer *)</i>, <i class="farg" style="white-space:nowrap;">struct rttimer_queue *q</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">rt_timer_remove_all</b>(<i class="farg" style="white-space:nowrap;">struct rtentry *rt</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="name">rt_timer</b> functions provide a generic route callout functionality. They allow a function to be called for a route at any time. This was originally intended to be used to remove routes added by path MTU discovery code.<p>
For maximum efficiency, a separate queue should be defined for each timeout period. For example, one queue should be created for the 10 minute path MTU discovery timeouts, another for 20 minute ARP timeouts after 20 minutes, and so on. This permits extremely fast queue manipulations so that the timeout functions remain scalable, even in the face of thousands of route manipulations per minute.<p>
It is possible to create only a single timeout queue for all possible timeout values, but doing so is not scalable as queue manipulations become quite expensive if the timeout deltas are not roughly constant.<p>
The <b class="name">rt_timer</b> interface provides the following functions:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">rt_timer_queue_create</b>(<i class="farg">time_t timeout</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
This function creates a new timer queue with the specified timeout period <i class="farg">timeout</i>, expressed in seconds.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">rt_timer_queue_change</b>(<i class="farg">rttimer_queue *q</i>, <i class="farg">time_t timeout</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
This function modifies the timeout period for a timer queue. Any value, including 0, is valid. The next time the timer queue's timeout expires (based on the previous timeout value), all entries which are valid to execute based on the new timeout will be executed, and the new timeout period scheduled.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">rt_timer_queue_destroy</b>(<i class="farg">rttimer_queue *q</i>, <i class="farg">int destroy</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
This function destroys a timeout queue. All entries are removed, and if the <i class="farg">destroy</i> argument is non-zero, the timeout action is performed for each entry.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">rt_timer_add</b>(<i class="farg">struct rtentry *rt</i>, <i class="farg">void(*f)(struct rtentry *, struct rttimer *)</i>, <i class="farg">struct rttimer_queue *q</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
This function adds an entry to a timeout queue. The function <i class="farg">f</i> will be called after the timeout period for queue <i class="farg">q</i> has elapsed. If <i class="farg">f</i> is NULL the route will be deleted when the timeout expires.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">rt_timer_remove_all</b>(<i class="farg">struct rtentry *rt</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
This function removes all references to the given route from the <b class="name">rt_timer</b> subsystem. This is used when a route is deleted to ensure that no dangling references remain.</dd>
</dl>
</div>
<div class="section">
<h1 id="x434f4445205245464552454e434553">CODE REFERENCES</h1> The <b class="name">rt_timer</b> interface is implemented in <i class="file">sys/net/route.h</i> and <i class="file">sys/net/route.c</i>.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../1/netstat">netstat(1)</a>, <a class="link-man" href="../9/arp">arp(9)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="name">rt_timer</b> interface appeared in <span class="unix">NetBSD&#160;1.4</span>.</div>
<div class="section">
<h1 id="x415554484f5253">AUTHORS</h1> This interface is roughly based on (but, alas, not compatible with) one designed by David Borman of BSDI. This implementation is by Kevin Lahey of the Numerical Aerospace Simulation Facility, NASA Ames Research Center.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
April 23, 1998</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
<>

