<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
SHUTDOWNHOOK_ESTABLISH(9)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
SHUTDOWNHOOK_ESTABLISH(9)</td>
<td class="head-vol" align="center">
Kernel Developer's Manual</td>
<td class="head-rtitle" align="right">
SHUTDOWNHOOK_ESTABLISH(9)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">shutdownhook_establish</b>, <b class="name">shutdownhook_disestablish</b> &#8212; <span class="desc">add or remove a shutdown hook</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <i class="ftype">void *</i><br>
<b class="fname">shutdownhook_establish</b>(<i class="farg" style="white-space:nowrap;">void (*fn)(void *)</i>, <i class="farg" style="white-space:nowrap;">void *arg</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">shutdownhook_disestablish</b>(<i class="farg" style="white-space:nowrap;">void *cookie</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> <span class="emph">The</span> <b class="name">shutdownhook_establish</b> <span class="emph">API is deprecated.</span><p>
The <b class="fname">shutdownhook_establish</b>() function adds <i class="farg">fn</i> to the list of hooks invoked by <a class="link-man" href="../html9/doshutdownhooks.html">doshutdownhooks(9)</a> at shutdown. When invoked, the hook function <i class="farg">fn</i> will be passed <i class="farg">arg</i> as its only argument.<p>
The <b class="fname">shutdownhook_disestablish</b>() function removes the hook described by the opaque pointer <i class="farg">cookie</i> from the list of hooks to be invoked at shutdown. If <i class="farg">cookie</i> is invalid, the result of <b class="fname">shutdownhook_disestablish</b>() is undefined.<p>
Shutdown hooks should be used to perform one-time activities that must happen immediately before the kernel exits. Because of the environment in which they are run, shutdown hooks cannot rely on many system services (including file systems, and timeouts and other interrupt-driven services), or even basic system integrity (because the system could be rebooting after a crash).</div>
<div class="section">
<h1 id="x52455455524e2056414c554553">RETURN VALUES</h1> If successful, <b class="fname">shutdownhook_establish</b>() returns an opaque pointer describing the newly-established shutdown hook. Otherwise, it returns NULL.</div>
<div class="section">
<h1 id="x4558414d504c4553">EXAMPLES</h1> It may be appropriate to use a shutdown hook to disable a device that does direct memory access, so that the device will not try to access memory while the system is rebooting.<p>
It may be appropriate to use a shutdown hook to inform watchdog timer hardware that the operating system is no longer running.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html9/doshutdownhooks.html">doshutdownhooks(9)</a></div>
<div class="section">
<h1 id="x42554753">BUGS</h1> The names are clumsy, at best.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
May 14, 2009</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

