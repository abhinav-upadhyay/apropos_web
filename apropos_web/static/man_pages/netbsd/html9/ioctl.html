<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
IOCTL(9)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
IOCTL(9)</td>
<td class="head-vol" align="center">
Kernel Developer's Manual</td>
<td class="head-rtitle" align="right">
IOCTL(9)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">ioctl</b> &#8212; <span class="desc">how to implement a new ioctl call to access device drivers</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">sys/ioctl.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">sys/ioccom.h</a>&gt;</b><p>
<i class="ftype">int</i><br>
<b class="fname">ioctl</b>(<i class="farg" style="white-space:nowrap;">int</i>, <i class="farg" style="white-space:nowrap;">unsigned long</i>, <i class="farg" style="white-space:nowrap;">...</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> <b class="name">ioctl</b> are internally defined as<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
#define FOOIOCTL fun(t,n,pt)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
</dd>
</dl>
<p>
where the different variables and functions are:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">FOOIOCTL</b></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
the name which will later be given in the <a class="link-man" href="../2/ioctl">ioctl(2)</a> system call as second argument, e.g.,<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit">ioctl(s, FOOIOCTL, ...).</code></div>
</blockquote>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">fun</b>()</dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
a macro which can be one of<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
_IO</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
the call is a simple message to the kernel by itself. It does not copy anything into the kernel, nor does it want anything back.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
_IOR</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
the call only reads parameters from the kernel and does not pass any to it</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
_IOW</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
the call only writes parameters to the kernel, but does not want anything back</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
_IOWR</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
the call writes data to the kernel and wants information back.</dd>
</dl>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="arg">t</i></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
This integer describes to which subsystem the ioctl applies. <i class="arg">t</i> can be one of<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
'1'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
pulse-per-second interface</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'4'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
<a class="link-man" href="../4/isdn">isdn(4)</a></dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'a'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
ISO networking</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'A'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
ac devices (hp300)</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'A'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
Advanced Power Management (hpcmips, i386, sparc), see <a class="link-man" href="../4/apm">apm(4)</a></dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'A'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
ADB devices (mac68k, macppc)</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'A'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
<a class="link-man" href="../4/audio">audio(4)</a></dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'A'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
<a class="link-man" href="../4/isdntel">isdntel(4)</a></dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'b'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
<a class="link-man" href="../4/tb">tb(4)</a></dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'b'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
Bluetooth HCI sockets, see <a class="link-man" href="../4/bluetooth">bluetooth(4)</a></dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'b'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
Bluetooth Hub Control, see <a class="link-man" href="../4/bthub">bthub(4)</a></dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'b'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
Bluetooth SCO audio driver, see <a class="link-man" href="../4/btsco">btsco(4)</a></dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'B'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
bell device (x68k)</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'B'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
<a class="link-man" href="../4/bpf">bpf(4)</a></dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'c'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
coda</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'c'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
<a class="link-man" href="../4/cd">cd(4)</a></dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'c'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
<a class="link-man" href="../4/ch">ch(4)</a></dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'C'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
clock devices (amiga, atari, hp300, x68k)</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'C'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
<a class="link-man" href="../4/isdnctl">isdnctl(4)</a></dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'd'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
the disk subsystem</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'E'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
<a class="link-man" href="../4/envsys">envsys(4)</a></dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'f'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
files</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'F'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
Sun-compatible framebuffers</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'F'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
<a class="link-man" href="../4/ccd">ccd(4)</a> and <a class="link-man" href="../4/vnd">vnd(4)</a></dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'g'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
qdss framebuffers</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'G'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
grf devices (amiga, atari, hp300, mac68k, x68k)</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'h'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
HIL devices (hp300)</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'H'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
HIL devices (hp300)</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'H'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
HPc framebuffers</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'i'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
a (pseudo) interface</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'I'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
<a class="link-man" href="../4/ite">ite(4)</a> (mac68k)</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'J'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
ISA joystick interface</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'k'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
Sun-compatible (and other) keyboards</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'l'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
leo devices (atari)</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'm'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
<a class="link-man" href="../4/mtio">mtio(4)</a></dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'M'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
mouse devices (atari)</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'M'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
<a class="link-man" href="../4/mlx">mlx(4)</a></dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'n'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
virtual console device (arm32)</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'n'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
SMB networking</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'O'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
OpenPROM and OpenFirmware</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'p'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
power control (x68k)</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'P'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
parallel port (amiga, x68k)</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'P'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
profiling (arm32)</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'P'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
printer/plotter interface (hp300)</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'P'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
pci(4)</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'P'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
compat/ossaudio and soundcard.h</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'P'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
<a class="link-man" href="../4/magma">magma(4)</a> bpp (sparc)</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'q'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
<a class="link-man" href="../9/altq">altq(9)</a></dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'q'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
pmax graphics devices</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'Q'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
<a class="link-man" href="../9/altq">altq(9)</a></dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'Q'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
raw SCSI commands</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'r'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
the routing subsystem</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'r'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
<a class="link-man" href="../4/md">md(4)</a></dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'R'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
<a class="link-man" href="../4/isdnbchan">isdnbchan(4)</a></dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'R'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
<a class="link-man" href="../4/rnd">rnd(4)</a></dd>
<dt class="list-tag" style="margin-top: 0.00em;">
's'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
the socket layer</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
's'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
satlink devices</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'S'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
SCSI disks (arc, hp300, pmax)</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'S'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
watchdog devices (sh3)</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'S'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
ISA speaker devices</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'S'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
stic devices</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'S'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
scanners</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
't'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
the tty layer</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'u'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
user defined ???</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'U'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
scsibus (see <a class="link-man" href="../4/scsi">scsi(4)</a>)</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'v'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
Sun-compatible &#8220;firm events&#8221;</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'V'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
view device (amiga, atari)</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'V'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
sram device (x68k)</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'w'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
watchdog devices</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'W'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
wt devices</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'W'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
wscons devices</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'x'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
bt8xx devices</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'Z'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
ite devices (amiga, atari, x68k)</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
'Z'</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
passthrough ioctls</dd>
</dl>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="arg">n</i></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
This numbers the ioctl within the group. There may be only one <i class="arg">n</i> for a given <i class="arg">t</i>. This is an unsigned 8 bit number.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="arg">pt</i></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
This specifies the type of the passed parameter. This one gets internally transformed to the size of the parameter, so for example, if you want to pass a structure, then you have to specify that structure and not a pointer to it or sizeof(struct foo)</dd>
</dl>
<p>
In order for the new ioctl to be known to the system it is installed in either &#60;<i class="file">sys/ioctl.h</i>&#62; or one of the files that are reached from &#60;<i class="file">sys/ioctl.h</i>&#62;.</div>
<div class="section">
<h1 id="x52455455524e2056414c554553">RETURN VALUES</h1> All <b class="fname">ioctl</b>() routines should return either 0 or a defined error code. The use of magic numbers such as &#45;1, to indicate that a given ioctl code was not handled is strongly discouraged. The value &#45;1 coincides with the historic value for <b class="flag">ERESTART</b> which was shown to produce user space code that never returned from a call to <a class="link-man" href="../2/ioctl">ioctl(2)</a>.<p>
For ioctl codes that are not handled by a given routine, the pseudo error value <b class="flag">EPASSTHROUGH</b> is provided. <b class="flag">EPASSTHROUGH</b> indicates that no error occurred during processing (it did not fail), but neither was anything processed (it did not succeed). This supersedes the use of either <b class="flag">ENOTTY</b> (which is an explicit failure) or &#45;1 (which has no contextual meaning) as a return value. <b class="flag">ENOTTY</b> will get passed directly back to user space and bypass any further processing by other ioctl layers. Only code that wishes to suppress possible further processing of an ioctl code (e.g., the tty line discipline code) should return <b class="flag">ENOTTY</b>. All other code should return <b class="flag">EPASSTHROUGH</b>, even if it knows that no other layers will be called upon.<p>
If the value <b class="flag">EPASSTHROUGH</b> is returned to <b class="fname">sys_ioctl</b>(), then it will there be changed to <b class="flag">ENOTTY</b> to be returned to user space, thereby providing the proper error notification to the application.</div>
<div class="section">
<h1 id="x4558414d504c4553">EXAMPLES</h1><pre style="margin-left: 5.00ex;" class="lit display">
#define	FOOIOCTL	_IOWR('i', 23, int) 
 
int a = 3; 
error = ioctl(s, FOOICTL, &amp;a);</pre>
<p>
Within the <b class="fname">ioctl</b>()-routine of the driver, it can be then accessed like<p>
<pre style="margin-left: 5.00ex;" class="lit display">
driver_ioctl(..., u_long cmd, void *data) 
{ 
	... 
	switch (cmd) { 
 
	case FOOIOCTL: 
		int *a = (int *)data; 
		printf(" Value passed: %d&#92;n", *a); 
		break; 
	} 
}</pre>
</div>
<div class="section">
<h1 id="x4e4f544553">NOTES</h1> Note that if you for example try to read information from an ethernet driver where the name of the card is included in the third argument (e.g., ioctl(s, READFROMETH, struct ifreq *)), then you have to use the <b class="fname">_IOWR</b>() form not the <b class="fname">_IOR</b>(), as passing the name of the card to the kernel already consists of writing data.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../2/ioctl">ioctl(2)</a></div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
December 11, 2010</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

