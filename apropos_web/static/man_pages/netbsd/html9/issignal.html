<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
SIGNAL(9)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
SIGNAL(9)</td>
<td class="head-vol" align="center">
Kernel Developer's Manual</td>
<td class="head-rtitle" align="right">
SIGNAL(9)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">signal</b>, <b class="name">siginit</b>, <b class="name">sigactsinit</b>, <b class="name">sigactsunshare</b>, <b class="name">sigactsfree</b>, <b class="name">execsigs</b>, <b class="name">sigaction1</b>, <b class="name">sigprocmask1</b>, <b class="name">sigpending1</b>, <b class="name">sigsuspend1</b>, <b class="name">sigaltstack1</b>, <b class="name">pgsignal</b>, <b class="name">kpgsignal</b>, <b class="name">psignal</b>, <b class="name">kpsignal</b>, <b class="name">issignal</b>, <b class="name">postsig</b>, <b class="name">killproc</b>, <b class="name">sigexit</b>, <b class="name">trapsignal</b>, <b class="name">sendsig</b>, <b class="name">sigcode</b>, <b class="name">sigtramp</b> &#8212; <span class="desc">software signal facilities</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">sys/signal.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">sys/signalvar.h</a>&gt;</b><p>
<i class="ftype">void</i><br>
<b class="fname">siginit</b>(<i class="farg" style="white-space:nowrap;">struct proc *p</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">sigactsinit</b>(<i class="farg" style="white-space:nowrap;">struct proc *pp</i>, <i class="farg" style="white-space:nowrap;">int share</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">sigactsunshare</b>(<i class="farg" style="white-space:nowrap;">struct proc *p</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">sigactsfree</b>(<i class="farg" style="white-space:nowrap;">struct proc *p</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">execsigs</b>(<i class="farg" style="white-space:nowrap;">struct proc *p</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">sigaction1</b>(<i class="farg" style="white-space:nowrap;">struct lwp *l</i>, <i class="farg" style="white-space:nowrap;">int signum</i>, <i class="farg" style="white-space:nowrap;">const struct sigaction *nsa</i>, <i class="farg" style="white-space:nowrap;">struct sigaction *osa</i>, <i class="farg" style="white-space:nowrap;">void *tramp</i>, <i class="farg" style="white-space:nowrap;">int vers</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">sigprocmask1</b>(<i class="farg" style="white-space:nowrap;">struct lwp *l</i>, <i class="farg" style="white-space:nowrap;">int how</i>, <i class="farg" style="white-space:nowrap;">const sigset_t *nss</i>, <i class="farg" style="white-space:nowrap;">sigset_t *oss</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">sigpending1</b>(<i class="farg" style="white-space:nowrap;">struct lwp *l</i>, <i class="farg" style="white-space:nowrap;">sigset_t *ss</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">sigsuspend1</b>(<i class="farg" style="white-space:nowrap;">struct lwp *l</i>, <i class="farg" style="white-space:nowrap;">const sigset_t *ss</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">sigaltstack1</b>(<i class="farg" style="white-space:nowrap;">struct lwp *l</i>, <i class="farg" style="white-space:nowrap;">const struct sigaltstack *nss</i>, <i class="farg" style="white-space:nowrap;">struct sigaltstack *oss</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">pgsignal</b>(<i class="farg" style="white-space:nowrap;">struct pgrp *pgrp</i>, <i class="farg" style="white-space:nowrap;">int signum</i>, <i class="farg" style="white-space:nowrap;">int checkctty</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">kpgsignal</b>(<i class="farg" style="white-space:nowrap;">struct pgrp *pgrp</i>, <i class="farg" style="white-space:nowrap;">ksiginfo_t *ks</i>, <i class="farg" style="white-space:nowrap;">void *data</i>, <i class="farg" style="white-space:nowrap;">int checkctty</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">psignal</b>(<i class="farg" style="white-space:nowrap;">struct proc *p</i>, <i class="farg" style="white-space:nowrap;">int signum</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">kpsignal</b>(<i class="farg" style="white-space:nowrap;">struct proc *p</i>, <i class="farg" style="white-space:nowrap;">ksiginfo_t *ks</i>, <i class="farg" style="white-space:nowrap;">void *data</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">issignal</b>(<i class="farg" style="white-space:nowrap;">struct lwp *l</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">postsig</b>(<i class="farg" style="white-space:nowrap;">int signum</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">killproc</b>(<i class="farg" style="white-space:nowrap;">struct proc *p</i>, <i class="farg" style="white-space:nowrap;">const char *why</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">sigexit</b>(<i class="farg" style="white-space:nowrap;">struct lwp *l</i>, <i class="farg" style="white-space:nowrap;">int signum</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">trapsignal</b>(<i class="farg" style="white-space:nowrap;">struct lwp *l</i>, <i class="farg" style="white-space:nowrap;">const ksiginfo_t *ks</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">sendsig</b>(<i class="farg" style="white-space:nowrap;">const ksiginfo_t *ks</i>, <i class="farg" style="white-space:nowrap;">const sigset_t *mask</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The system defines a set of signals that may be delivered to a process. These functions implement the kernel portion of the signal facility.<p>
Signal numbers used throughout the kernel signal facilities should always be within the range of &#91;1-NSIG&#93;.<p>
Most of the kernel's signal infrastructure is implemented in machine-independent code. Machine-dependent code provides support for invoking a process's signal handler, restoring context when the signal handler returns, generating signals when hardware traps occur, triggering the delivery of signals when a process is about to return from the kernel to userspace.<p>
The signal state for a process is contained in <i class="farg">struct sigctx</i>. This includes the list of signals with delivery pending, information about the signal handler stack, the signal mask, and the address of the signal trampoline.<p>
The registered signal handlers for a process are recorded in <i class="farg">struct sigacts</i>. This structure may be shared by multiple processes.<p>
The kernel's signal facilities are implemented by the following functions:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">siginit</b>(<i class="farg">p</i>)</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
<p>
This function initializes the signal state of <b class="var">proc0</b> to the system default. This signal state is then inherited by <a class="link-man" href="../8/init">init(8)</a> when it is started by the kernel.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">sigactsinit</b>(<i class="farg">pp</i>, <i class="farg">share</i>)</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
<p>
This function creates an initial <i class="farg">struct sigacts</i> for the process <i class="farg">pp</i>. If the <i class="farg">share</i> argument is non-zero, then <i class="farg">pp</i> shares the <i class="farg">struct sigacts</i> by holding a reference. Otherwise, <i class="farg">pp</i> receives a new <i class="farg">struct sigacts</i> which is copied from the parent.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">sigactsunshare</b>(<i class="farg">p</i>)</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
<p>
This function causes the process <i class="farg">p</i> to no longer share its <i class="farg">struct sigacts</i> The current state of the signal actions is maintained in the new copy.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">sigactsfree</b>(<i class="farg">p</i>)</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
<p>
This function decrements the reference count on the <i class="farg">struct sigacts</i> of process <i class="farg">p</i>. If the reference count reaches zero, the <i class="farg">struct sigacts</i> is freed.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">execsigs</b>(<i class="farg">p</i>)</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
<p>
This function is used to reset the signal state of the process <i class="farg">p</i> to the system defaults when the process execs a new program image.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">sigaction1</b>(<i class="farg">l</i>, <i class="farg">signum</i>, <i class="farg">nsa</i>, <i class="farg">osa</i>, <i class="farg">tramp</i>, <i class="farg">vers</i>)</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
<p>
This function implements the <a class="link-man" href="../2/sigaction">sigaction(2)</a> system call. The <i class="farg">tramp</i> and <i class="farg">vers</i> arguments provide support for userspace signal trampolines. Trampoline version 0 is reserved for the legacy kernel-provided signal trampoline; <i class="farg">tramp</i> must be <span class="define">NULL</span> in this case. Otherwise, <i class="farg">vers</i> specifies the ABI of the trampoline specified by <i class="farg">tramp</i>. The signal trampoline ABI is machine-dependent, and must be coordinated with the <b class="fname">sendsig</b>() function.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">sigprocmask1</b>(<i class="farg">l</i>, <i class="farg">how</i>, <i class="farg">nss</i>, <i class="farg">oss</i>)</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
<p>
This function implements the <a class="link-man" href="../2/sigprocmask">sigprocmask(2)</a> system call.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">sigpending1</b>(<i class="farg">l</i>, <i class="farg">ss</i>)</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
<p>
This function implements the <a class="link-man" href="../2/sigpending">sigpending(2)</a> system call.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">sigsuspend1</b>(<i class="farg">l</i>, <i class="farg">ss</i>)</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
<p>
This function implements the <a class="link-man" href="../2/sigsuspend">sigsuspend(2)</a> system call.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">sigaltstack1</b>(<i class="farg">l</i>, <i class="farg">nss</i>, <i class="farg">oss</i>)</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
<p>
This function implements the <a class="link-man" href="../2/sigaltstack">sigaltstack(2)</a> system call.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">pgsignal</b>(<i class="farg">pgrp</i>, <i class="farg">signum</i>, <i class="farg">checkctty</i>)</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
<p>
This is a wrapper function for <b class="fname">kpgsignal</b>() which is described below.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">kpgsignal</b>(<i class="farg">pgrp</i>, <i class="farg">ks</i>, <i class="farg">data</i>, <i class="farg">checkctty</i>)</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
<p>
Schedule the signal <i class="farg">ks-&gt;ksi_signo</i> to be delivered to all members of the process group <i class="farg">pgrp</i>. If <i class="farg">checkctty</i> is non-zero, the signal is only sent to processes which have a controlling terminal. The <i class="farg">data</i> argument and the complete signal scheduling semantics are described in the <b class="fname">kpsignal</b>() function below.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">trapsignal</b>(<i class="farg">l</i>, <i class="farg">ks</i>)</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
<p>
Sends the signal <i class="farg">ks-&gt;ksi_signo</i> caused by a hardware trap to the current process.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">psignal</b>(<i class="farg">p</i>, <i class="farg">signum</i>)</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
<p>
This is a wrapper function for <b class="fname">kpsignal</b>() which is described below.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">kpsignal</b>(<i class="farg">p</i>, <i class="farg">ks</i>, <i class="farg">data</i>)</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
<p>
Schedule the signal <i class="farg">ks-&gt;ksi_signo</i> to be delivered to the process <i class="farg">p</i>. The <i class="farg">data</i> argument, if not <span class="define">NULL</span>, points to the file descriptor data that caused the signal to be generated in the <code class="lit">SIGIO</code> case.<p>
With a few exceptions noted below, the target process signal disposition is updated and is marked as runnable, so further handling of the signal is done in the context of the target process after a context switch; see <b class="fname">issignal</b>() below. Note that <b class="fname">kpsignal</b>() does not by itself cause a context switch to happen.<p>
The target process is not marked as runnable in the following cases:<ul style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-bul">
<li class="list-bul" style="margin-top: 1.00em;">
The target process is sleeping uninterruptibly. The signal will be noticed when the process returns from the system call or trap.</li>
<li class="list-bul" style="margin-top: 1.00em;">
The target process is currently ignoring the signal.</li>
<li class="list-bul" style="margin-top: 1.00em;">
If a stop signal is sent to a sleeping process that takes the default action (see <a class="link-man" href="../2/sigaction">sigaction(2)</a>), the process is stopped without awakening it.</li>
<li class="list-bul" style="margin-top: 1.00em;">
SIGCONT restarts a stopped process (or puts them back to sleep) regardless of the signal action (e.g., blocked or ignored).</li>
</ul>
<p>
If the target process is being traced, <b class="fname">kpsignal</b>() behaves as if the target process were taking the default action for <i class="farg">signum</i>. This allows the tracing process to be notified of the signal.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">issignal</b>(<i class="farg">l</i>)</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
<p>
This function determines which signal, if any, is to be posted to the current process. A signal is to be posted if:<ul style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-bul">
<li class="list-bul" style="margin-top: 1.00em;">
The signal has a handler provided by the program image.</li>
<li class="list-bul" style="margin-top: 1.00em;">
The signal should cause the process to dump core and/or terminate.</li>
<li class="list-bul" style="margin-top: 1.00em;">
The signal should interrupt the current system call.</li>
</ul>
<p>
Signals which cause the process to be stopped are handled within <b class="fname">issignal</b>() directly.<p>
<b class="fname">issignal</b>() should be called by machine-dependent code when returning to userspace from a system call or other trap or interrupt by using the following code:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
while (signum = CURSIG(curproc)) 
	postsig(signum);</pre>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">postsig</b>(<i class="farg">signum</i>)</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
<p>
The <b class="fname">postsig</b>() function is used to invoke the action for the signal <i class="farg">signum</i> in the current process. If the default action of a signal is to terminate the process, and the signal does not have a registered handler, the process exits using <b class="fname">sigexit</b>(), dumping a core image if necessary.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">killproc</b>(<i class="farg">p</i>, <i class="farg">why</i>)</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
<p>
This function sends a SIGKILL signal to the specified process. The message provided by <i class="farg">why</i> is sent to the system log and is also displayed on the process's controlling terminal.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">sigexit</b>(<i class="farg">l</i>, <i class="farg">signum</i>)</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
<p>
This function forces the current process to exit with the signal <i class="farg">signum</i>, generating a core file if appropriate. No checks are made for masked or caught signals; the process always exits.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">sendsig</b>(<i class="farg">ks</i>, <i class="farg">mask</i>)</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
<p>
This function is provided by machine-dependent code, and is used to invoke a signal handler for the current process. <b class="fname">sendsig</b>() must prepare the registers and stack of the current process to invoke the signal handler stored in the process's <i class="farg">struct sigacts</i>. This may include switching to an alternate signal stack specified by the process. The previous register, stack, and signal state are stored in a <i class="farg">ucontext_t</i>, which is then copied out to the user's stack.<p>
The registers and stack must be set up to invoke the signal handler as follows:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
(*handler)(int signum, siginfo_t *info, void *ctx)</pre>
<p>
where <i class="farg">signum</i> is the signal number, <i class="farg">info</i> contains additional signal specific information when <code class="lit">SA_SIGINFO</code> is specified when setting up the signal handler. <i class="farg">ctx</i> is the pointer to <i class="farg">ucontext_t</i> on the user's stack. The registers and stack must also arrange for the signal handler to return to the signal trampoline. The trampoline is then used to return to the code which was executing when the signal was delivered using the <a class="link-man" href="../2/setcontext">setcontext(2)</a> system call.<p>
For performance reasons, it is recommended that <b class="fname">sendsig</b>() arrange for the signal handler to be invoked directly on architectures where it is convenient to do so. In this case, the trampoline is used only for the signal return path. If it is not feasible to directly invoke the signal handler, the trampoline is also used to invoke the handler, performing any final set up that was not possible for <b class="fname">sendsig</b>() to perform.<p>
<b class="fname">sendsig</b>() must invoke the signal trampoline with the correct ABI. The ABI of the signal trampoline is specified on a per-signal basis in the <b class="fname">sigacts</b>() structure for the process. Trampoline version 0 is reserved for the legacy kernel-provided, on-stack signal trampoline. All other trampoline versions indicate a specific trampoline ABI. This ABI is coordinated with machine-dependent code in the system C library.</dd>
</dl>
<div class="subsection">
<h2 id="x5349474e414c205452414d504f4c494e45">SIGNAL TRAMPOLINE</h2> The signal trampoline is a special piece of code which provides support for invoking the signal handlers for a process. The trampoline is used to return from the signal handler back to the code which was executing when the signal was delivered, and is also used to invoke the handler itself on architectures where it is not feasible to have the kernel invoke the handler directly.<p>
In traditional <span class="unix">UNIX</span> systems, the signal trampoline, also referred to as the &#8220;sigcode&#8221;, is provided by the kernel and copied to the top of the user's stack when a new process is created or a new program image is exec'd. Starting in <span class="unix">NetBSD&#160;2.0</span>, the signal trampoline is provided by the system C library. This allows for more flexibility when the signal facility is extended, makes dealing with signals easier in debuggers, such as <a class="link-man" href="../1/gdb">gdb(1)</a>, and may also enhance system security by allowing the kernel to disallow execution of code on the stack.<p>
The signal trampoline is specified on a per-signal basis. The correct trampoline is selected automatically by the C library when a signal handler is registered by a process.<p>
Signal trampolines have a special naming convention which enables debuggers to determine the characteristics of the signal handler and its arguments. Trampoline functions are named like so:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
__sigtramp_&lt;flavor&gt;_&lt;version&gt;</pre>
<p>
where:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
&#60;flavor&#62;</dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
The flavor of the signal handler. The following flavors are valid:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
sigcontext</dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Specifies a traditional BSD-style (deprecated) signal handler with the following signature:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
void (*handler)(int signum, 
	int code, 
	struct sigcontext *scp);</pre>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
siginfo</dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Specifies a POSIX-style signal handler with the following signature:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
void (*handler)(int signum, 
	siginfo_t *si, 
	void *uc);</pre>
<p>
Note: sigcontext style signal handlers are deprecated, and retained only for compatibility with older binaries.</dd>
</dl>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#60;version&#62;</dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
Specifies the ABI version of the signal trampoline. The trampoline ABI is coordinated with the machine-dependent kernel <b class="fname">sendsig</b>() function. The trampoline version needs to be unique even across different trampoline flavors, in order to simplify trampoline selection in the kernel.</dd>
</dl>
<p>
The following is an example if a signal trampoline name which indicates that the trampoline is used for traditional BSD-style signal handlers and implements version 1 of the signal trampoline ABI:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
__sigtramp_sigcontext_1</pre>
<p>
The current signal trampoline is:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
__sigtramp_siginfo_2</pre>
</div>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../2/sigaction">sigaction(2)</a>, <a class="link-man" href="../7/signal">signal(7)</a>, <a class="link-man" href="../9/condvar">condvar(9)</a></div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
April 29, 2010</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

