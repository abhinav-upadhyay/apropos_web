<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/../4/strict.dtd">
>
<head>
<meta http-equiv="Content-Type" content="te../; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
IOASIC(9)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
IOASIC(9)</td>
<td class="head-vol" align="center">
Kernel Developer's Manual</td>
<td class="head-rtitle" align="right">
IOASIC(9)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">IOASIC</b>, <b class="name">ioasic_intr_establish</b>, <b class="name">ioasic_intr_disestablish</b>, <b class="name">ioasic_intr_evcnt</b>, <b class="name">ioasic_attach_devs</b>, <b class="name">ioasic_submatch</b> &#8212; <span class="desc">baseboard I/O control ASIC for DEC TURBOchannel systems</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">sys/bus.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">dev/tc/tcvar.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">dev/tc/ioasicreg.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">dev/tc/ioasicvar.h</a>&gt;</b><p>
<i class="ftype">void</i><br>
<b class="fname">ioasic_intr_establish</b>(<i class="farg" style="white-space:nowrap;">struct device *dev</i>, <i class="farg" style="white-space:nowrap;">void *cookie</i>, <i class="farg" style="white-space:nowrap;">int level</i>, <i class="farg" style="white-space:nowrap;">int (*handler)(void *)</i>, <i class="farg" style="white-space:nowrap;">void *arg</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">ioasic_intr_disestablish</b>(<i class="farg" style="white-space:nowrap;">struct device *dev</i>, <i class="farg" style="white-space:nowrap;">void *cookie</i>);<p>
<i class="ftype">const struct evcnt *</i><br>
<b class="fname">ioasic_intr_evcnt</b>(<i class="farg" style="white-space:nowrap;">struct device *dev</i>, <i class="farg" style="white-space:nowrap;">void *cookie</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">ioasic_attach_devs</b>(<i class="farg" style="white-space:nowrap;">struct ioasic_softc *sc</i>, <i class="farg" style="white-space:nowrap;">struct ioasic_dev *ioasic_devs</i>, <i class="farg" style="white-space:nowrap;">int ioasic_ndevs</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">ioasic_submatch</b>(<i class="farg" style="white-space:nowrap;">struct cfdata *match</i>, <i class="farg" style="white-space:nowrap;">struct ioasicdev_attach_args *ia</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="name">IOASIC</b> device provides support for the DEC proprietary IOCTL ASIC found on all DEC TURBOchannel machines with MIPS (DECstation 5000 series, excluding the 5000/200) and Alpha (3000-series) systems. The <b class="name">IOASIC</b> is memory-mapped into the TURBOchannel system slot to interface up to sixteen I/O devices. It connects the TURBOchannel to a 16-bit wide I/O bus and supplies various control signals to the devices that share this bus.<p>
The <b class="name">IOASIC</b> provides hardware DMA channels and interrupt support. DMA transfers are between one and four 32-bit words (16 bytes) in length, depending on the device. The <b class="name">IOASIC</b> stores the data in internal data registers. The data is transferred to and from the registers in 16-bit words to the device. Various interrupts are signalled on DMA pointer-related conditions.</div>
<div class="section">
<h1 id="x44415441205459504553">DATA TYPES</h1> Drivers for devices attached to the <b class="name">IOASIC</b> will make use of the following data types:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">struct ioasicdev_attach_args</i></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
A structure used to inform the driver of the <b class="name">IOASIC</b> device properties. It contains the following members:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
	char			iada_modname 
	tc_offset_t		iada_offset 
	tc_addr_t		iada_addr 
	void			*iada_cookie;</pre>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">struct ioasic_softc</i></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
The parent structure which contains at the following members which are useful for drivers:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
	bus_space_tag_t		sc_bst; 
	bus_space_handle_t	sc_bsh; 
	bus_dma_tag_t		sc_dmat;</pre>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">struct ioasic_dev</i></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
A structure describing the machine-dependent devices attached to the <b class="name">IOASIC</b> containing the following members:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
	char			*iad_modname; 
	tc_offset_t		iad_offset; 
	void			*iad_cookie; 
	uint32_t		iad_intrbits;</pre>
</dd>
</dl>
</div>
<div class="section">
<h1 id="x46554e4354494f4e53">FUNCTIONS</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">ioasic_intr_establish</b>(<i class="farg">dev</i>, <i class="farg">cookie</i>, <i class="farg">level</i>, <i class="farg">handler</i>, <i class="farg">arg</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Establish an interrupt handler with device <i class="farg">dev</i> for the interrupt described completely by <i class="farg">cookie</i>. The priority of the interrupt is specified by <i class="farg">level</i>. When the interrupt occurs the function <i class="farg">handler</i> is called with argument <i class="farg">arg</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">ioasic_intr_disestablish</b>(<i class="farg">dev</i>, <i class="farg">cookie</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Dis-establish the interrupt handler with device <i class="farg">dev</i> for the interrupt described complete ly <i class="farg">cookie</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">ioasic_intr_evcnt</b>(<i class="farg">dev</i>, <i class="farg">cookie</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Do interrupt event counting with device <i class="farg">dev</i> for the event described completely by <i class="farg">cookie</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">ioasic_attach_devs</b>(<i class="farg">sc</i>, <i class="farg">ioasic_devs</i>, <i class="farg">ioasic_ndevs</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Configure each of the <i class="farg">ioasic_ndevs</i> devices in <i class="farg">ioasic_devs</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">ioasic_submatch</b>(<i class="farg">match</i>, <i class="farg">ia</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Check that the device offset is not OASIC_OFFSET_UNKNOWN.</dd>
</dl>
<p>
The <b class="fname">ioasic_intr_establish</b>(), <b class="fname">ioasic_intr_disestablish</b>(), and <b class="fname">ioasic_intr_evcnt</b>() functions are likely to used by all <b class="name">IOASIC</b> device drivers. The <b class="fname">ioasic_attach_devs</b>() function is used by ioasic driver internally and is of interest to driver writers because it must be aware of your device for it to be found during autoconfiguration.</div>
<div class="section">
<h1 id="x4155544f434f4e46494755524154494f4e">AUTOCONFIGURATION</h1> The IOASIC is a direct-connection bus. During autoconfiguration, machine-dependent code will provide an array of <i class="farg">struct ioasic_devs</i> describing devices attached to the <b class="name">IOASIC</b> to be used by the ioasic driver. The ioasic driver will pass this array to <b class="fname">ioasic_attach_devs</b>() to attach the drivers with the devices.<p>
Drivers match the device using <i class="farg">iada_modname</i>.<p>
During attach, all drivers should use the parent's bus_space and bus_dma resources, and map the appropriate bus_space region using <b class="fname">bus_space_subregion</b>() with <i class="farg">iada_offset</i>.</div>
<div class="section">
<h1 id="x444d4120535550504f5254">DMA SUPPORT</h1> No additional support is provided for <b class="name">IOASIC</b> DMA beyond the facilities provided by the <a class="link-man" href="../9/bus_dma">bus_dma(9)</a> interface.<p>
The <b class="name">IOASIC</b> provides two pairs of DMA address pointers (transmitting and receiving) for each DMA-capable device. The pair of address pointers point to consecutive (but not necessarily contiguous) DMA blocks of size IOASIC_DMA_BLOCKSIZE. Upon successful transfer of the first block, DMA continues to the next block and an interrupt is posted to signal an address pointer update. DMA transfers are enabled and disabled by bits inside the <b class="name">IOASIC</b> status (CSR) register.<p>
The interrupt handler must update the address pointers to point to the next block in the DMA transfer. The address pointer update must be completed before the completion of the second DMA block, otherwise a DMA overrun error condition will occur.</div>
<div class="section">
<h1 id="x434f4445205245464552454e434553">CODE REFERENCES</h1> The IOASIC subsystem itself is implemented within the file <i class="file">sys/dev/tc/ioasic_subr.c</i>. Machine-dependent portions can be found in <i class="file">sys/arch/&lt;arch&gt;/tc/ioasic.c</i>.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../4/ioasic">ioasic(4)</a>, <a class="link-man" href="../9/autoconf">autoconf(9)</a>, <a class="link-man" href="../9/bus_dma">bus_dma(9)</a>, <a class="link-man" href="../9/bus_space">bus_space(9)</a>, <a class="link-man" href="../9/driver">driver(9)</a></div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
August 6, 2000</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
<>

