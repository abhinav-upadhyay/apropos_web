<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
FIRMLOAD(9)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
FIRMLOAD(9)</td>
<td class="head-vol" align="center">
Kernel Developer's Manual</td>
<td class="head-rtitle" align="right">
FIRMLOAD(9)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">firmload</b> &#8212; <span class="desc">Firmware loader API for device drivers</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">dev/firmload.h</a>&gt;</b><p>
<i class="ftype">int</i><br>
<b class="fname">firmware_open</b>(<i class="farg" style="white-space:nowrap;">const char *drvname</i>, <i class="farg" style="white-space:nowrap;">const char *imgname</i>, <i class="farg" style="white-space:nowrap;">firmware_handle_t *fhp</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">firmware_close</b>(<i class="farg" style="white-space:nowrap;">firmware_handle_t fh</i>);<p>
<i class="ftype">off_t</i><br>
<b class="fname">firmware_get_size</b>(<i class="farg" style="white-space:nowrap;">firmware_handle_t fh</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">firmware_read</b>(<i class="farg" style="white-space:nowrap;">firmware_handle_t fh</i>, <i class="farg" style="white-space:nowrap;">off_t offset</i>, <i class="farg" style="white-space:nowrap;">void *buf</i>, <i class="farg" style="white-space:nowrap;">size_t size</i>);<p>
<i class="ftype">void *</i><br>
<b class="fname">firmware_malloc</b>(<i class="farg" style="white-space:nowrap;">size_t size</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">firmware_free</b>(<i class="farg" style="white-space:nowrap;">void *buf</i>, <i class="farg" style="white-space:nowrap;">size_t size</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> <b class="name">firmload</b> provides a simple and convenient API for device drivers to load firmware images from files residing in the file system that are necessary for the devices that they control. Firmware images reside in sub-directories, one for each driver, of a series of colon-separated path prefixes specified by the sysctl variable <span class="define">hw.firmware.path</span>.</div>
<div class="section">
<h1 id="x46554e4354494f4e53">FUNCTIONS</h1> The following functions are provided by the <b class="name">firmload</b> API:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">firmware_open</b>(<i class="farg">drvname</i>, <i class="farg">imgname</i>, <i class="farg">fhp</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
<p>
Open the firmware image <i class="farg">imgname</i> for the driver <i class="farg">drvname</i>. The path to the firmware image file is constructed by appending the string &#8220;/drvname/imgname&#8221; to each configured path prefix until opening the firmware image file succeeds. Upon success, <b class="fname">firmware_open</b>() returns 0 and stores a firmware image handle in the location pointed to by <i class="farg">fhp</i>. Otherwise, an error code is returned to indicate the reason for failure.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">firmware_close</b>(<i class="farg">fh</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
<p>
Close the firmware image file associated with the firmware handle <i class="farg">fh</i>. Returns 0 upon success or an error code to indicate the reason for failure.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">firmware_get_size</b>(<i class="farg">fh</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
<p>
Returns the size of the image file associated with the firmware handle <i class="farg">fh</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">firmware_read</b>(<i class="farg">fh</i>, <i class="farg">offset</i>, <i class="farg">buf</i>, <i class="farg">size</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
<p>
Reads from the image file associated with the firmware handle <i class="farg">fh</i> beginning at offset <i class="farg">offset</i> for length <i class="farg">size</i>. The firmware image data is placed into the buffer specified by <i class="farg">buf</i>. Returns 0 upon success or an error code to indicate the reason for failure.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">firmware_malloc</b>(<i class="farg">size</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
<p>
Allocates a region of wired kernel memory of size <i class="farg">size</i>. Note: <b class="fname">firmware_malloc</b>() may block.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">firmware_free</b>(<i class="farg">buf</i>, <i class="farg">size</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
<p>
Frees a region of memory previously allocated by <b class="fname">firmware_malloc</b>().</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../9/autoconf">autoconf(9)</a>, <a class="link-man" href="../9/malloc">malloc(9)</a>, <a class="link-man" href="../9/vnsubr">vnsubr(9)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="name">firmload</b> framework first appeared in <span class="unix">NetBSD&#160;4.0</span>.</div>
<div class="section">
<h1 id="x415554484f5253">AUTHORS</h1> <span class="author">Jason Thorpe</span> &#60;<a class="link-mail" href="mailto:thorpej@NetBSD.org">thorpej@NetBSD.org</a>&#62;</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
January 17, 2006</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

