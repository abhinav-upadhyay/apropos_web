<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/../4/strict.dtd">
>
<head>
<meta http-equiv="Content-Type" content="te../; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
CONFIG(9)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
CONFIG(9)</td>
<td class="head-vol" align="center">
Kernel Developer's Manual</td>
<td class="head-rtitle" align="right">
CONFIG(9)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">config</b> &#8212; <span class="desc">the autoconfiguration framework &#8220;device definition&#8221; language</span></div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> In <span class="unix">NetBSD</span>, the <a class="link-man" href="../1/config">config(1)</a> program reads and verifies a machine description file (documented in <a class="link-man" href="../5/config">config(5)</a>) that specifies the devices to include in the kernel. A table is produced by <a class="link-man" href="../1/config">config(1)</a> which is used by the kernel during autoconfiguration (see <a class="link-man" href="../9/autoconf">autoconf(9)</a>) giving needed hints and details on matching hardware devices with device drivers.<p>
Each device in the machine description file has:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
A Name</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The name is simply an alphanumeric string that ends in a unit number (e.g., "sd0", "sd1", and so forth). These unit numbers identify particular instances of a base device name; the base name in turn maps directly to a device driver. Device unit numbers are independent of hardware features.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
A Parent</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Every device must have a parent. The pairing is denoted by "child at parent". These pairings form the links in a directed graph. The root device is the only exception, as it does not have a parent.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
Locators</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Locators are used to augment the parent/child pairings that locate specific devices. Each locator value is simply an integer that represents some sort of device address on the parent bus or controller. This can be a memory address, an I/O port, a driver number, or any other value. Locators can sometimes be wildcarded on devices that support direct connection.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
Attributes</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
An attribute describes the device's relationship with the code; it then serves to constrain the device graph. A <span class="emph">plain attribute</span> describes some attribute of a device. An <span class="emph">interface attribute</span> describes a kind of &#8220;software interface&#8221; and declares the device's ability to support other devices that use that interface. In addition, an interface attribute usually identifies additional locators.</dd>
</dl>
<p>
During autoconfiguration, the directed graph is turned into a tree by nominating one device as the root node and matching drivers with devices by doing a depth-first traversal through the graph starting at this root node.<p>
However, there must be constraints on the parent/child pairings that are possible. These constraints are embedded in the &#8220;device definition&#8221; files. The remainder of this page describes the &#8220;device definition&#8221; language and how to use this language to add new functionality to the <span class="unix">NetBSD</span> kernel.</div>
<div class="section">
<h1 id="x44455649434520444546494e4954494f4e2046494c4553">DEVICE DEFINITION FILES</h1> The device definition files are separated into machine-dependent and machine-independent files. The machine-dependent file is located in <i class="file">sys/arch/&lt;arch&gt;/conf/files.&lt;arch&gt;</i>, where &lt;arch&gt; is the name of <span class="unix">NetBSD</span> architecture. The machine-independent file is located in <i class="file">sys/conf/files</i>. It in turn includes files for the machine-independent drivers located in <i class="file">sys/dev/&lt;bus&gt;/files.&lt;bus&gt;</i>, where &lt;bus&gt; is the name of the machine-independent bus.<p>
These files define all legal devices and pseudo-devices. They also define all attributes and interfaces, establishing the rules that determine allowable machine descriptions, and list the source files that make up the kernel.<p>
Each device definition file consists of a list of statements, typically one per line. Comments may be inserted anywhere using the &#8220;#&#8221; character, and any line that begins with white space continues the previous line. Valid statements are:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
cinclude filename</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Conditionally include contents of file <i class="arg">filename</i> to currently processed configuration. If the specified <i class="arg">filename</i> doesn't exist, a warning is printed, but the error ignored.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
defflag [filename] {options}</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The space-separated list of pre-processor macros <span class="emph">options</span> are defined in file <span class="emph">filename</span>. This statement permits ``options FOO'' for FOO (i.e, without a value) in the machine description file. <a class="link-man" href="../1/config">config(1)</a> will generate an error if a value is given. If the filename field is not specified, it will be constructed based upon the lower-case of the option name, ``opt_foo.h'' for example. The <span class="emph">option</span> is case-sensitive.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
defparam [filename] {options}</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The space-separated list of pre-processor macros <span class="emph">options</span> are defined in file <span class="emph">filename</span>. This statement permits ``options FOO=bar'' or ``option FOO="&#92;"com&#92;""'' in the machine description file. <a class="link-man" href="../1/config">config(1)</a> will generate an error if a value is not given. If the filename field is not specified, it will be constructed based upon the lower-case of the option name, ``opt_foo.h'' for example. The <span class="emph">option</span> is case-sensitive.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
defopt [filename] {options}</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The space-separated list of pre-processor macros <span class="emph">options</span> are defined in file <span class="emph">filename</span>. This statement permits the syntax of either the defflag and defparam statements and <a class="link-man" href="../1/config">config(1)</a> does not perform any checking of whether ``options FOO'' takes a value. Therefore, the use of the defopt statement is deprecated in favour of the defflag and defparam statements. If the filename field is not specified, it will be constructed based upon the lower-case of the option name, ``opt_foo.h'' for example. The <span class="emph">option</span> is case-sensitive.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
deffs name [[name] ...]</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Define a filesystem <span class="emph">name</span>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
devclass name</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Define a device class <span class="emph">name</span>. A device class is similar to an attribute.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
define name [{locators}]</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The attribute <span class="emph">name</span> is defined and device definitions can then refer to it. If the attribute is an interface attribute and defines optional <span class="emph">locators</span>, device attributes that refer to <span class="emph">name</span> are assumed to share the interface and require the same locators.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
device name [{locators}]: [attributes]</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The device <span class="emph">name</span> is defined and requires the optional comma-separated list of locators <span class="emph">locators</span>. The optional <span class="emph">attributes</span> define attribute dependencies.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
attach name at interface [with ifname]: [attributes]</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The device <span class="emph">name</span> is defined and supports the interface <span class="emph">interface</span>. If <span class="emph">ifname</span> is specified, it is used to specify the interface to the driver for device <span class="emph">name</span> (see <a class="link-man" href="../9/driver">driver(9)</a> for details). The optional <span class="emph">attributes</span> define attribute dependencies.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
defpseudo name: [{locators}]</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The pseudo-device <span class="emph">name</span> is defined. The optional <span class="emph">locators</span> may be defined, but are largely pointless since no device can attach to a pseudo-device.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
file pathname [attributes [flags]] [rule]</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The file <span class="emph">pathname</span> is added to the list of files used to build the kernel. If no attributes are specified, the file is always added to the kernel compilation. If any of the attributes are specified by other devices in the machine description file, then the file is included in compilation, otherwise it is omitted. Valid values for the optional flags are:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
needs-count</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Specify that config should generate a file for each of the attributes notifying the driver how many of some particular device or set of devices are configured in the kernel. This flag allows drivers to make calculations of driver used at compile time. This option prevents autoconfiguration cloning.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
needs-flag</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This flag performs the same operation as <span class="emph">needs-count</span> but only records if the number is nonzero. Since the count is not exact, <span class="emph">needs-flag</span> does not prevent autoconfiguration cloning.</dd>
</dl>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
device-major name char [block] [attributes]</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The character device switch <span class="emph">name</span> associated with a character major device number is added to the list of device switches used to build the kernel. If <span class="emph">block</span> is specified, the block device switch associated with a block major device number is also added. If all of attributes are specified by devices in the machine description files, then device switches are added into the device switches' table of the kernel in compilation, otherwise they are omitted.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
include <i class="arg">filename</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Include contents of file <i class="arg">filename</i> to currently processed configuration. If the specified <i class="arg">filename</i> doesn't exist, <a class="link-man" href="../1/config">config(1)</a> exits with error.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
package <i class="arg">filename</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Changes prefix to directory of <i class="arg">filename</i>, processes contents of <i class="arg">filename</i>, and switches back to previous prefix. This is syntactic sugar for:<pre style="margin-left: 5.00ex;" class="lit display">
<code class="lit">prefix</code> <i class="arg">dirname(filename)</i> 
<code class="lit">include</code> <i class="arg">basename(filename)</i> 
<code class="lit">prefix</code></pre>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
prefix &#91;<span class="opt"><i class="arg">dirname</i></span>&#93;</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
If <i class="arg">dirname</i> is specified, it is pushed on top of prefix stack. Any further files specified via option <i class="arg">file</i> would have the prefix implicitly prepended before its <i class="arg">filename</i>. If <i class="arg">dirname</i> is not specified, pops (removes) a prefix from prefix stack.</dd>
</dl>
<p>
To allow locators to be wildcarded in the machine description file, their default value must be defined in the attribute definition. To allow locators to be omitted entirely in the machine description file, enclose the locator in square brackets. This can be used when some locators do not make sense for some devices, but the software interface requires them.</div>
<div class="section">
<h1 id="x434f4445205245464552454e434553">CODE REFERENCES</h1> The device definition files are in <i class="file">sys/conf/files</i>, <i class="file">sys/arch/&lt;arch&gt;/conf/files.&lt;arch&gt;</i>, and <i class="file">sys/dev/&lt;bus&gt;/files.&lt;bus&gt;</i>.<p>
The grammar for machine description files can be found in <a class="link-man" href="../1/config">config(1)</a>, in <i class="file">usr.bin/config/gram.y</i>.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../1/config">config(1)</a>, <a class="link-man" href="../5/config">config(5)</a>, <a class="link-man" href="../9/autoconf">autoconf(9)</a>, <a class="link-man" href="../9/driver">driver(9)</a><p>
<span class="ref"><span class="ref-title">Building 4.4 BSD Systems with Config</span>.</span><p>
<span class="ref"><span class="ref-auth">Chris Torek</span>, <span class="ref-title">Device Configuration in 4.4BSD</span>, <span class="ref-date">1992</span>.</span></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> Autoconfiguration first appeared in <span class="unix">4.1BSD</span>. The autoconfiguration framework was completely revised in <span class="unix">4.4BSD</span>. It has been modified within <span class="unix">NetBSD</span> to support bus-independent drivers and bus-dependent attachments.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
March 3, 2010</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
<>

