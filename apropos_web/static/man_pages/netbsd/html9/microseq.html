<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
MICROSEQ(9)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
MICROSEQ(9)</td>
<td class="head-vol" align="center">
Kernel Developer's Manual</td>
<td class="head-rtitle" align="right">
MICROSEQ(9)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">microseq</b> &#8212; <span class="desc">ppbus microseqencer developer's guide</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">sys/types.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">dev/ppbus/ppbus_conf.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">dev/ppbus/ppbus_msq.h</a>&gt;</b></div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> See <a class="link-man" href="../html4/ppbus.html">ppbus(4)</a> for <b class="name">ppbus</b> description and general info about the microsequencer.<p>
The purpose of this document is to encourage developers to use the microsequencer mechanism in order to have:<ol style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-enum">
<li class="list-enum" style="margin-top: 1.00em;">
a uniform programming model</li>
<li class="list-enum" style="margin-top: 1.00em;">
efficient code</li>
</ol>
<p>
Before using microsequences, you are encouraged to look at the <a class="link-man" href="../html4/atppc.html">atppc(4)</a> microsequencer implementation and an example of how using it in <a class="link-man" href="../html4/vpo.html">vpo(4)</a>.<div class="subsection">
<h2 id="x5050425553207265676973746572206d6f64656c">PPBUS register model</h2></div>
<div class="subsection">
<h2 id="x4261636b67726f756e64">Background</h2> The parallel port model chosen for <a class="link-man" href="../html4/ppbus.html">ppbus(4)</a> is the PC parallel port model. Thus, any register described later has the same semantic than its counterpart in a PC parallel port. For more info about ISA/ECP programming, get the Microsoft standard referenced &#8220;Extended Capabilities Port Protocol and ISA interface Standard&#8221;. Registers described later are standard parallel port registers.<p>
Mask macros are defined in the standard <a class="link-man" href="../html4/ppbus.html">ppbus(4)</a> include files for each valid bit of parallel port registers.</div>
<div class="subsection">
<h2 id="x44617461207265676973746572">Data register</h2> In compatible or nibble mode, writing to this register will drive data to the parallel port data lines. In any other mode, drivers may be tri-stated by setting the direction bit (PCD) in the control register. Reads to this register return the value on the data lines.</div>
<div class="subsection">
<h2 id="x44657669636520737461747573207265676973746572">Device status register</h2> This read-only register reflects the inputs on the parallel port interface.<p>
<table style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-col">
<col style="width: 3.00ex;">
<col style="width: 4.00ex;">
<col style="min-width: 11.00ex;">
<tbody>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
<span class="emph">Bit</span></td>
<td class="list-col" style="margin-top: 0.00em;">
<span class="emph">Name</span></td>
<td class="list-col" style="margin-top: 0.00em;">
<span class="emph">Description</span></td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
7</td>
<td class="list-col" style="margin-top: 0.00em;">
nBUSY</td>
<td class="list-col" style="margin-top: 0.00em;">
inverted version of parallel port Busy signal</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
6</td>
<td class="list-col" style="margin-top: 0.00em;">
nACK</td>
<td class="list-col" style="margin-top: 0.00em;">
version of parallel port nAck signal</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
5</td>
<td class="list-col" style="margin-top: 0.00em;">
PERROR</td>
<td class="list-col" style="margin-top: 0.00em;">
version of parallel port PERROR signal</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
4</td>
<td class="list-col" style="margin-top: 0.00em;">
SELECT</td>
<td class="list-col" style="margin-top: 0.00em;">
version of parallel port Select signal</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
3</td>
<td class="list-col" style="margin-top: 0.00em;">
nFAULT</td>
<td class="list-col" style="margin-top: 0.00em;">
version of parallel port nFault signal</td>
</tr>
</tbody>
</table>
<p>
Others are reserved and return undefined result when read.</div>
<div class="subsection">
<h2 id="x44657669636520636f6e74726f6c207265676973746572">Device control register</h2> This register directly controls several output signals as well as enabling some functions.<p>
<table style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-col">
<col style="width: 3.00ex;">
<col style="width: 8.00ex;">
<col style="min-width: 11.00ex;">
<tbody>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
<span class="emph">Bit</span></td>
<td class="list-col" style="margin-top: 0.00em;">
<span class="emph">Name</span></td>
<td class="list-col" style="margin-top: 0.00em;">
<span class="emph">Description</span></td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
5</td>
<td class="list-col" style="margin-top: 0.00em;">
PCD</td>
<td class="list-col" style="margin-top: 0.00em;">
direction bit in extended modes</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
4</td>
<td class="list-col" style="margin-top: 0.00em;">
IRQENABLE</td>
<td class="list-col" style="margin-top: 0.00em;">
1 enables an interrupt on the rising edge of nAck</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
3</td>
<td class="list-col" style="margin-top: 0.00em;">
SELECTIN</td>
<td class="list-col" style="margin-top: 0.00em;">
inverted and driven as parallel port nSelectin signal</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
2</td>
<td class="list-col" style="margin-top: 0.00em;">
nINIT</td>
<td class="list-col" style="margin-top: 0.00em;">
driven as parallel port nInit signal</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
1</td>
<td class="list-col" style="margin-top: 0.00em;">
AUTOFEED</td>
<td class="list-col" style="margin-top: 0.00em;">
inverted and driven as parallel port nAutoFd signal</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
0</td>
<td class="list-col" style="margin-top: 0.00em;">
STROBE</td>
<td class="list-col" style="margin-top: 0.00em;">
inverted and driven as parallel port nStrobe signal</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section">
<h1 id="x4d4943524f494e535452554354494f4e53">MICROINSTRUCTIONS</h1><div class="subsection">
<h2 id="x4465736372697074696f6e">Description</h2> <span class="emph">Microinstructions</span> are either parallel port accesses, program iterations, submicrosequence or C calls. The parallel port must be considered as the logical model described in <a class="link-man" href="../html4/ppbus.html">ppbus(4)</a>.<p>
Available microinstructions are:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
#define MS_OP_GET       0	/* get &lt;ptr&gt;, &lt;len&gt;			*/ 
#define MS_OP_PUT       1	/* put &lt;ptr&gt;, &lt;len&gt;			*/ 
#define MS_OP_RFETCH	2	/* rfetch &lt;reg&gt;, &lt;mask&gt;, &lt;ptr&gt;		*/ 
#define MS_OP_RSET	3	/* rset &lt;reg&gt;, &lt;mask&gt;, &lt;mask&gt;		*/ 
#define MS_OP_RASSERT	4	/* rassert &lt;reg&gt;, &lt;mask&gt;		*/ 
#define MS_OP_DELAY     5	/* delay &lt;val&gt;				*/ 
#define MS_OP_SET       6	/* set &lt;val&gt;				*/ 
#define MS_OP_DBRA      7	/* dbra &lt;offset&gt;			*/ 
#define MS_OP_BRSET     8	/* brset &lt;mask&gt;, &lt;offset&gt;		*/ 
#define MS_OP_BRCLEAR   9	/* brclear &lt;mask&gt;, &lt;offset&gt;		*/ 
#define MS_OP_RET       10	/* ret &lt;retcode&gt;			*/ 
#define MS_OP_C_CALL	11	/* c_call &lt;function&gt;, &lt;parameter&gt;	*/ 
#define MS_OP_PTR	12	/* ptr &lt;pointer&gt;			*/ 
#define MS_OP_ADELAY	13	/* adelay &lt;val&gt;				*/ 
#define MS_OP_BRSTAT	14	/* brstat &lt;mask&gt;, &lt;mask&gt;, &lt;offset&gt;	*/ 
#define MS_OP_SUBRET	15	/* subret &lt;code&gt;			*/ 
#define MS_OP_CALL	16	/* call &lt;microsequence&gt;			*/ 
#define MS_OP_RASSERT_P	17	/* rassert_p &lt;iter&gt;, &lt;reg&gt;		*/ 
#define MS_OP_RFETCH_P	18	/* rfetch_p &lt;iter&gt;, &lt;reg&gt;, &lt;mask&gt;	*/ 
#define MS_OP_TRIG	19	/* trigger &lt;reg&gt;, &lt;len&gt;, &lt;array&gt;	*/</pre>
</div>
<div class="subsection">
<h2 id="x457865637574696f6e20636f6e74657874">Execution context</h2> The <span class="emph">execution context</span> of microinstructions is:<ul style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-bul">
<li class="list-bul" style="margin-top: 1.00em;">
the <span class="emph">program counter</span> which points to the next microinstruction to execute either in the main microsequence or in a subcall</li>
<li class="list-bul" style="margin-top: 1.00em;">
the current value of <span class="emph">ptr</span> which points to the next char to send/receive</li>
<li class="list-bul" style="margin-top: 1.00em;">
the current value of the internal <span class="emph">branch register</span></li>
</ul>
<p>
This data is modified by some of the microinstructions, not all.</div>
<div class="subsection">
<h2 id="x4d535f4f505f47455420616e64204d535f4f505f505554">MS_OP_GET and MS_OP_PUT</h2> are microinstructions used to do either predefined standard IEEE1284-1994 transfers or programmed non-standard I/O.</div>
<div class="subsection">
<h2 id="x4d535f4f505f524645544348202d205265676973746572204645544348">MS_OP_RFETCH - Register FETCH</h2> is used to retrieve the current value of a parallel port register, apply a mask and save it in a buffer.<p>
Parameters:<ol style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-enum">
<li class="list-enum" style="margin-top: 1.00em;">
register</li>
<li class="list-enum" style="margin-top: 1.00em;">
character mask</li>
<li class="list-enum" style="margin-top: 1.00em;">
pointer to the buffer</li>
</ol>
<p>
Predefined macro: MS_RFETCH(reg,mask,ptr)</div>
<div class="subsection">
<h2 id="x4d535f4f505f52534554202d20526567697374657220534554">MS_OP_RSET - Register SET</h2> is used to assert/clear some bits of a particular parallel port register, two masks are applied.<p>
Parameters:<ol style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-enum">
<li class="list-enum" style="margin-top: 1.00em;">
register</li>
<li class="list-enum" style="margin-top: 1.00em;">
mask of bits to assert</li>
<li class="list-enum" style="margin-top: 1.00em;">
mask of bits to clear</li>
</ol>
<p>
Predefined macro: MS_RSET(reg,assert,clear)</div>
<div class="subsection">
<h2 id="x4d535f4f505f52415353455254202d20526567697374657220415353455254">MS_OP_RASSERT - Register ASSERT</h2> is used to assert all bits of a particular parallel port register.<p>
Parameters:<ol style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-enum">
<li class="list-enum" style="margin-top: 1.00em;">
register</li>
<li class="list-enum" style="margin-top: 1.00em;">
byte to assert</li>
</ol>
<p>
Predefined macro: MS_RASSERT(reg,byte)</div>
<div class="subsection">
<h2 id="x4d535f4f505f44454c4159202d206d6963726f7365636f6e642044454c4159">MS_OP_DELAY - microsecond DELAY</h2> is used to delay the execution of the microsequence.<p>
Parameter:<ol style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-enum">
<li class="list-enum" style="margin-top: 1.00em;">
delay in microseconds</li>
</ol>
<p>
Predefined macro: MS_DELAY(delay)</div>
<div class="subsection">
<h2 id="x4d535f4f505f534554202d2053455420696e7465726e616c206272616e6368207265676973746572">MS_OP_SET - SET internal branch register</h2> is used to set the value of the internal branch register.<p>
Parameter:<ol style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-enum">
<li class="list-enum" style="margin-top: 1.00em;">
integer value</li>
</ol>
<p>
Predefined macro: MS_SET(accum)</div>
<div class="subsection">
<h2 id="x4d535f4f505f44425241202d205c2a5b416d5d446f204252416e6368">MS_OP_DBRA - *[Am]Do BRAnch</h2> is used to branch if internal branch register decremented by one result value is positive.<p>
Parameter:<ol style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-enum">
<li class="list-enum" style="margin-top: 1.00em;">
integer offset in the current executed (sub)microsequence. Offset is added to the index of the next microinstruction to execute.</li>
</ol>
<p>
Predefined macro: MS_DBRA(offset)</div>
<div class="subsection">
<h2 id="x4d535f4f505f4252534554202d204252616e6368206f6e20534554">MS_OP_BRSET - BRanch on SET</h2> is used to branch if some of the status register bits of the parallel port are set.<p>
Parameter:<ol style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-enum">
<li class="list-enum" style="margin-top: 1.00em;">
bits of the status register</li>
<li class="list-enum" style="margin-top: 1.00em;">
integer offset in the current executed (sub)microsequence. Offset is added to the index of the next microinstruction to execute.</li>
</ol>
<p>
Predefined macro: MS_BRSET(mask,offset)</div>
<div class="subsection">
<h2 id="x4d535f4f505f4252434c454152202d204252616e6368206f6e20434c454152">MS_OP_BRCLEAR - BRanch on CLEAR</h2> is used to branch if some of the status register bits of the parallel port are cleared.<p>
Parameter:<ol style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-enum">
<li class="list-enum" style="margin-top: 1.00em;">
bits of the status register</li>
<li class="list-enum" style="margin-top: 1.00em;">
integer offset in the current executed (sub)microsequence. Offset is added to the index of the next microinstruction to execute.</li>
</ol>
<p>
Predefined macro: MS_BRCLEAR(mask,offset)</div>
<div class="subsection">
<h2 id="x4d535f4f505f524554202d2052455475726e">MS_OP_RET - RETurn</h2> is used to return from a microsequence. This instruction is mandatory. This is the only way for the microsequencer to detect the end of the microsequence. The return code is returned in the integer pointed by the (int *) parameter of the ppb_MS_microseq().<p>
Parameter:<ol style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-enum">
<li class="list-enum" style="margin-top: 1.00em;">
integer return code</li>
</ol>
<p>
Predefined macro: MS_RET(code)</div>
<div class="subsection">
<h2 id="x4d535f4f505f435f43414c4c202d20432066756e6374696f6e2043414c4c">MS_OP_C_CALL - C function CALL</h2> is used to call C functions from microsequence execution. This may be useful when a non-standard I/O is performed to retrieve a data character from the parallel port.<p>
Parameter:<ol style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-enum">
<li class="list-enum" style="margin-top: 1.00em;">
the C function to call</li>
<li class="list-enum" style="margin-top: 1.00em;">
the parameter to pass to the function call</li>
</ol>
<p>
The C function shall be declared as a <i class="ftype">int(*)(void *p, char *ptr)</i>. The ptr parameter is the current position in the buffer currently scanned.<p>
Predefined macro: MS_C_CALL(func,param)</div>
<div class="subsection">
<h2 id="x4d535f4f505f505452202d20696e697469616c697a6520696e7465726e616c20505452">MS_OP_PTR - initialize internal PTR</h2> is used to initialize the internal pointer to the currently scanned buffer. This pointer is passed to any C call (see above).<p>
Parameter:<ol style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-enum">
<li class="list-enum" style="margin-top: 1.00em;">
pointer to the buffer that shall be accessed by <b class="fname">xxx_P</b>() microsequence calls. Note that this pointer is automatically incremented during <b class="fname">xxx_P</b>() calls.</li>
</ol>
<p>
Predefined macro: MS_PTR(ptr)</div>
<div class="subsection">
<h2 id="x4d535f4f505f4144454c4159202d20646f20616e204173796e6368726f6e6f75732044454c4159">MS_OP_ADELAY - do an Asynchronous DELAY</h2> is used to make a <a class="link-man" href="../html9/cv_timedwait.html">cv_timedwait(9)</a> during microsequence execution.<p>
Parameter:<ol style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-enum">
<li class="list-enum" style="margin-top: 1.00em;">
delay in ms</li>
</ol>
<p>
Predefined macro: MS_ADELAY(delay)</div>
<div class="subsection">
<h2 id="x4d535f4f505f425253544154202d204252616e6368206f6e205354415465">MS_OP_BRSTAT - BRanch on STATe</h2> is used to branch on status register state condition.<p>
Parameter:<ol style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-enum">
<li class="list-enum" style="margin-top: 1.00em;">
mask of asserted bits. Bits that shall be asserted in the status register are set in the mask</li>
<li class="list-enum" style="margin-top: 1.00em;">
mask of cleared bits. Bits that shall be cleared in the status register are set in the mask</li>
<li class="list-enum" style="margin-top: 1.00em;">
integer offset in the current executed (sub)microsequence. Offset is added to the index of the next microinstruction to execute.</li>
</ol>
<p>
Predefined macro: MS_BRSTAT(asserted_bits,clear_bits,offset)</div>
<div class="subsection">
<h2 id="x4d535f4f505f535542524554202d205355426d6963726f73657175656e63652052455475726e">MS_OP_SUBRET - SUBmicrosequence RETurn</h2> is used to return from the submicrosequence call. This action is mandatory before a RET call. Some microinstructions (PUT, GET) may not be callable within a submicrosequence.<p>
No parameter.<p>
Predefined macro: MS_SUBRET()</div>
<div class="subsection">
<h2 id="x4d535f4f505f43414c4c202d207375626d6963726f73657175656e63652043414c4c">MS_OP_CALL - submicrosequence CALL</h2> is used to call a submicrosequence. A submicrosequence is a microsequence with a SUBRET call. Parameter:<ol style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-enum">
<li class="list-enum" style="margin-top: 1.00em;">
the submicrosequence to execute</li>
</ol>
<p>
Predefined macro: MS_CALL(microseq)</div>
<div class="subsection">
<h2 id="x4d535f4f505f524153534552545f50202d205265676973746572204153534552542066726f6d20696e7465726e616c20505452">MS_OP_RASSERT_P - Register ASSERT from internal PTR</h2> is used to assert a register with data currently pointed by the internal PTR pointer. Parameter:<ol style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-enum">
<li class="list-enum" style="margin-top: 1.00em;">
amount of data to write to the register</li>
<li class="list-enum" style="margin-top: 1.00em;">
register</li>
</ol>
<p>
Predefined macro: MS_RASSERT_P(iter,reg)</div>
<div class="subsection">
<h2 id="x4d535f4f505f5246455443485f50202d20526567697374657220464554434820746f20696e7465726e616c20505452">MS_OP_RFETCH_P - Register FETCH to internal PTR</h2> is used to fetch data from a register. Data is stored in the buffer currently pointed by the internal PTR pointer. Parameter:<ol style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-enum">
<li class="list-enum" style="margin-top: 1.00em;">
amount of data to read from the register</li>
<li class="list-enum" style="margin-top: 1.00em;">
register</li>
<li class="list-enum" style="margin-top: 1.00em;">
mask applied to fetched data</li>
</ol>
<p>
Predefined macro: MS_RFETCH_P(iter,reg,mask)</div>
<div class="subsection">
<h2 id="x4d535f4f505f54524947202d2054524947207265676973746572">MS_OP_TRIG - TRIG register</h2> is used to trigger the parallel port. This microinstruction is intended to provide a very efficient control of the parallel port. Triggering a register is writing data, wait a while, write data, wait a while... This allows to write magic sequences to the port. Parameter:<ol style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-enum">
<li class="list-enum" style="margin-top: 1.00em;">
amount of data to read from the register</li>
<li class="list-enum" style="margin-top: 1.00em;">
register</li>
<li class="list-enum" style="margin-top: 1.00em;">
size of the array</li>
<li class="list-enum" style="margin-top: 1.00em;">
array of unsigned chars. Each couple of u_chars define the data to write to the register and the delay in us to wait. The delay is limited to 255 us to simplify and reduce the size of the array.</li>
</ol>
<p>
Predefined macro: MS_TRIG(reg,len,array)</div>
</div>
<div class="section">
<h1 id="x4d4943524f53455155454e434553">MICROSEQUENCES</h1><div class="subsection">
<h2 id="x432073747275637475726573">C structures</h2><pre style="margin-left: 0.00ex;" class="lit display">
union ppb_insarg { 
     int     i; 
     char    c; 
     void    *p; 
     int     (* f)(void *, char *); 
}; 
 
struct ppb_microseq { 
     int                     opcode;         /* microins. opcode */ 
     union ppb_insarg        arg[PPB_MS_MAXARGS];    /* arguments */ 
};</pre>
</div>
<div class="subsection">
<h2 id="x5573696e67206d6963726f73657175656e636573">Using microsequences</h2> To instantiate a microsequence, just declare an array of ppb_microseq structures and initialize it as needed. You may either use predefined macros or code directly your microinstructions according to the ppb_microseq definition. For example,<p>
<pre style="margin-left: 0.00ex;" class="lit display">
     struct ppb_microseq select_microseq[] = { 
 
	     /* parameter list 
	      */ 
	     #define SELECT_TARGET    MS_PARAM(0, 1, MS_TYP_INT) 
	     #define SELECT_INITIATOR MS_PARAM(3, 1, MS_TYP_INT) 
 
	     /* send the select command to the drive */ 
	     MS_DASS(MS_UNKNOWN), 
	     MS_CASS(H_nAUTO | H_nSELIN |  H_INIT | H_STROBE), 
	     MS_CASS( H_AUTO | H_nSELIN |  H_INIT | H_STROBE), 
	     MS_DASS(MS_UNKNOWN), 
	     MS_CASS( H_AUTO | H_nSELIN | H_nINIT | H_STROBE), 
 
	     /* now, wait until the drive is ready */ 
	     MS_SET(VP0_SELTMO), 
/* loop: */     MS_BRSET(H_ACK, 2 /* ready */), 
	     MS_DBRA(-2 /* loop */), 
/* error: */    MS_RET(1), 
/* ready: */    MS_RET(0) 
     };</pre>
<p>
Here, some parameters are undefined and must be filled before executing the microsequence. In order to initialize each microsequence, one should use the <b class="fname">ppb_MS_init_msq</b>() function like this:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
ppb_MS_init_msq(select_microseq, 2, 
		SELECT_TARGET, 1 &lt;&lt; target, 
		SELECT_INITIATOR, 1 &lt;&lt; initiator);</pre>
<p>
and then execute the microsequence.</div>
<div class="subsection">
<h2 id="x546865206d6963726f73657175656e636572">The microsequencer</h2> The microsequencer is executed either at ppbus or adapter level (see <a class="link-man" href="../html4/ppbus.html">ppbus(4)</a> for info about ppbus system layers). Most of the microsequencer is executed at <a class="link-man" href="../html4/atppc.html">atppc(4)</a> level to avoid <a class="link-man" href="../html4/ppbus.html">ppbus(4)</a> to adapter function call overhead. But some actions like deciding whereas the transfer is IEEE1284-1994 compliant are executed at <a class="link-man" href="../html4/ppbus.html">ppbus(4)</a> layer.</div>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html4/atppc.html">atppc(4)</a>, <a class="link-man" href="../html4/ppbus.html">ppbus(4)</a>, <a class="link-man" href="../html4/vpo.html">vpo(4)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="name">microseq</b> manual page first appeared in <span class="unix">FreeBSD&#160;3.0</span>.</div>
<div class="section">
<h1 id="x415554484f5253">AUTHORS</h1> This manual page is based on the <span class="unix">FreeBSD</span> <b class="name">microseq</b> manual page and was update for the <span class="unix">NetBSD</span> port by <span class="author">Gary Thorpe</span>.</div>
<div class="section">
<h1 id="x42554753">BUGS</h1> Only one level of submicrosequences is allowed.<p>
When triggering the port, maximum delay allowed is 255 us.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
December 29, 2003</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

