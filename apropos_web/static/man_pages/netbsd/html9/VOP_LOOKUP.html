<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="/static/man_pages/netbsd/style.css" type="text/css" media="all">
<title>
VNODEOPS(9)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
VNODEOPS(9)</td>
<td class="head-vol" align="center">
Kernel Developer's Manual</td>
<td class="head-rtitle" align="right">
VNODEOPS(9)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">vnodeops</b>, <b class="name">VOP_LOOKUP</b>, <b class="name">VOP_CREATE</b>, <b class="name">VOP_MKNOD</b>, <b class="name">VOP_OPEN</b>, <b class="name">VOP_CLOSE</b>, <b class="name">VOP_ACCESS</b>, <b class="name">VOP_GETATTR</b>, <b class="name">VOP_SETATTR</b>, <b class="name">VOP_READ</b>, <b class="name">VOP_WRITE</b>, <b class="name">VOP_FALLOCATE</b>, <b class="name">VOP_FDISCARD</b>, <b class="name">VOP_IOCTL</b>, <b class="name">VOP_FCNTL</b>, <b class="name">VOP_POLL</b>, <b class="name">VOP_KQFILTER</b>, <b class="name">VOP_REVOKE</b>, <b class="name">VOP_MMAP</b>, <b class="name">VOP_FSYNC</b>, <b class="name">VOP_SEEK</b>, <b class="name">VOP_REMOVE</b>, <b class="name">VOP_LINK</b>, <b class="name">VOP_RENAME</b>, <b class="name">VOP_MKDIR</b>, <b class="name">VOP_RMDIR</b>, <b class="name">VOP_SYMLINK</b>, <b class="name">VOP_READDIR</b>, <b class="name">VOP_READLINK</b>, <b class="name">VOP_ABORTOP</b>, <b class="name">VOP_INACTIVE</b>, <b class="name">VOP_RECLAIM</b>, <b class="name">VOP_LOCK</b>, <b class="name">VOP_UNLOCK</b>, <b class="name">VOP_ISLOCKED</b>, <b class="name">VOP_BMAP</b>, <b class="name">VOP_PRINT</b>, <b class="name">VOP_PATHCONF</b>, <b class="name">VOP_ADVLOCK</b>, <b class="name">VOP_WHITEOUT</b>, <b class="name">VOP_GETPAGES</b>, <b class="name">VOP_PUTPAGES</b>, <b class="name">VOP_STRATEGY</b>, <b class="name">VOP_BWRITE</b>, <b class="name">VOP_GETEXTATTR</b>, <b class="name">VOP_SETEXTATTR</b>, <b class="name">VOP_LISTEXTATTR</b>, <b class="name">VOP_DELETEEXTATTR</b> &#8212; <span class="desc">vnode operations</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">sys/param.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">sys/buf.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">sys/dirent.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">sys/vnode.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">sys/mount.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">sys/namei.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">sys/unistd.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">sys/fcntl.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">sys/lockf.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">sys/extattr.h</a>&gt;</b><p>
<i class="ftype">int</i><br>
<b class="fname">VOP_LOOKUP</b>(<i class="farg" style="white-space:nowrap;">struct vnode *dvp</i>, <i class="farg" style="white-space:nowrap;">struct vnode **vpp</i>, <i class="farg" style="white-space:nowrap;">struct componentname *cnp</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">VOP_CREATE</b>(<i class="farg" style="white-space:nowrap;">struct vnode *dvp</i>, <i class="farg" style="white-space:nowrap;">struct vnode **vpp</i>, <i class="farg" style="white-space:nowrap;">struct componentname *cnp</i>, <i class="farg" style="white-space:nowrap;">struct vattr *vap</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">VOP_MKNOD</b>(<i class="farg" style="white-space:nowrap;">struct vnode *dvp</i>, <i class="farg" style="white-space:nowrap;">struct vnode **vpp</i>, <i class="farg" style="white-space:nowrap;">struct componentname *cnp</i>, <i class="farg" style="white-space:nowrap;">struct vattr *vap</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">VOP_OPEN</b>(<i class="farg" style="white-space:nowrap;">struct vnode *vp</i>, <i class="farg" style="white-space:nowrap;">int mode</i>, <i class="farg" style="white-space:nowrap;">kauth_cred_t cred</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">VOP_CLOSE</b>(<i class="farg" style="white-space:nowrap;">struct vnode *vp</i>, <i class="farg" style="white-space:nowrap;">int fflag</i>, <i class="farg" style="white-space:nowrap;">kauth_cred_t cred</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">VOP_ACCESS</b>(<i class="farg" style="white-space:nowrap;">struct vnode *vp</i>, <i class="farg" style="white-space:nowrap;">int mode</i>, <i class="farg" style="white-space:nowrap;">kauth_cred_t cred</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">VOP_GETATTR</b>(<i class="farg" style="white-space:nowrap;">struct vnode *vp</i>, <i class="farg" style="white-space:nowrap;">struct vattr *vap</i>, <i class="farg" style="white-space:nowrap;">kauth_cred_t cred</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">VOP_SETATTR</b>(<i class="farg" style="white-space:nowrap;">struct vnode *vp</i>, <i class="farg" style="white-space:nowrap;">struct vattr *vap</i>, <i class="farg" style="white-space:nowrap;">kauth_cred_t cred</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">VOP_READ</b>(<i class="farg" style="white-space:nowrap;">struct vnode *vp</i>, <i class="farg" style="white-space:nowrap;">struct uio *uio</i>, <i class="farg" style="white-space:nowrap;">int ioflag</i>, <i class="farg" style="white-space:nowrap;">kauth_cred_t cred</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">VOP_WRITE</b>(<i class="farg" style="white-space:nowrap;">struct vnode *vp</i>, <i class="farg" style="white-space:nowrap;">struct uio *uio</i>, <i class="farg" style="white-space:nowrap;">int ioflag</i>, <i class="farg" style="white-space:nowrap;">kauth_cred_t cred</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">VOP_FALLOCATE</b>(<i class="farg" style="white-space:nowrap;">struct vnode *vp</i>, <i class="farg" style="white-space:nowrap;">off_t pos</i>, <i class="farg" style="white-space:nowrap;">off_t len</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">VOP_FDISCARD</b>(<i class="farg" style="white-space:nowrap;">struct vnode *vp</i>, <i class="farg" style="white-space:nowrap;">off_t pos</i>, <i class="farg" style="white-space:nowrap;">off_t len</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">VOP_IOCTL</b>(<i class="farg" style="white-space:nowrap;">struct vnode *vp</i>, <i class="farg" style="white-space:nowrap;">u_long command</i>, <i class="farg" style="white-space:nowrap;">void *data</i>, <i class="farg" style="white-space:nowrap;">int fflag</i>, <i class="farg" style="white-space:nowrap;">kauth_cred_t cred</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">VOP_FCNTL</b>(<i class="farg" style="white-space:nowrap;">struct vnode *vp</i>, <i class="farg" style="white-space:nowrap;">u_int command</i>, <i class="farg" style="white-space:nowrap;">void *data</i>, <i class="farg" style="white-space:nowrap;">int fflag</i>, <i class="farg" style="white-space:nowrap;">kauth_cred_t cred</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">VOP_POLL</b>(<i class="farg" style="white-space:nowrap;">struct vnode *vp</i>, <i class="farg" style="white-space:nowrap;">int events</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">VOP_KQFILTER</b>(<i class="farg" style="white-space:nowrap;">struct vnode *vp</i>, <i class="farg" style="white-space:nowrap;">struct knote *kn</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">VOP_REVOKE</b>(<i class="farg" style="white-space:nowrap;">struct vnode *vp</i>, <i class="farg" style="white-space:nowrap;">int flags</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">VOP_MMAP</b>(<i class="farg" style="white-space:nowrap;">struct vnode *vp</i>, <i class="farg" style="white-space:nowrap;">vm_prot_t prot</i>, <i class="farg" style="white-space:nowrap;">kauth_cred_t cred</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">VOP_FSYNC</b>(<i class="farg" style="white-space:nowrap;">struct vnode *vp</i>, <i class="farg" style="white-space:nowrap;">kauth_cred_t cred</i>, <i class="farg" style="white-space:nowrap;">int flags</i>, <i class="farg" style="white-space:nowrap;">off_t offlo</i>, <i class="farg" style="white-space:nowrap;">off_t offhi</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">VOP_SEEK</b>(<i class="farg" style="white-space:nowrap;">struct vnode *vp</i>, <i class="farg" style="white-space:nowrap;">off_t oldoff</i>, <i class="farg" style="white-space:nowrap;">off_t newoff</i>, <i class="farg" style="white-space:nowrap;">kauth_cred_t cred</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">VOP_REMOVE</b>(<i class="farg" style="white-space:nowrap;">struct vnode *dvp</i>, <i class="farg" style="white-space:nowrap;">struct vnode *vp</i>, <i class="farg" style="white-space:nowrap;">struct componentname *cnp</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">VOP_LINK</b>(<i class="farg" style="white-space:nowrap;">struct vnode *dvp</i>, <i class="farg" style="white-space:nowrap;">struct vnode *vp</i>, <i class="farg" style="white-space:nowrap;">struct componentname *cnp</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">VOP_RENAME</b>(<i class="farg" style="white-space:nowrap;">struct vnode *fdvp</i>, <i class="farg" style="white-space:nowrap;">struct vnode *fvp</i>, <i class="farg" style="white-space:nowrap;">struct componentname *fcnp</i>, <i class="farg" style="white-space:nowrap;">struct vnode *tdvp</i>, <i class="farg" style="white-space:nowrap;">struct vnode *tvp</i>, <i class="farg" style="white-space:nowrap;">struct componentname *tcnp</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">VOP_MKDIR</b>(<i class="farg" style="white-space:nowrap;">struct vnode *dvp</i>, <i class="farg" style="white-space:nowrap;">struct vnode **vpp</i>, <i class="farg" style="white-space:nowrap;">struct componentname *cnp</i>, <i class="farg" style="white-space:nowrap;">struct vattr *vap</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">VOP_RMDIR</b>(<i class="farg" style="white-space:nowrap;">struct vnode *dvp</i>, <i class="farg" style="white-space:nowrap;">struct vnode *vp</i>, <i class="farg" style="white-space:nowrap;">struct componentname *cnp</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">VOP_SYMLINK</b>(<i class="farg" style="white-space:nowrap;">struct vnode *dvp</i>, <i class="farg" style="white-space:nowrap;">struct vnode **vpp</i>, <i class="farg" style="white-space:nowrap;">struct componentname *cnp</i>, <i class="farg" style="white-space:nowrap;">struct vattr *vap</i>, <i class="farg" style="white-space:nowrap;">char *target</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">VOP_READDIR</b>(<i class="farg" style="white-space:nowrap;">struct vnode *vp</i>, <i class="farg" style="white-space:nowrap;">struct uio *uio</i>, <i class="farg" style="white-space:nowrap;">kauth_cred_t cred</i>, <i class="farg" style="white-space:nowrap;">int *eofflag</i>, <i class="farg" style="white-space:nowrap;">off_t **cookies</i>, <i class="farg" style="white-space:nowrap;">int *ncookies</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">VOP_READLINK</b>(<i class="farg" style="white-space:nowrap;">struct vnode *vp</i>, <i class="farg" style="white-space:nowrap;">struct uio *uio</i>, <i class="farg" style="white-space:nowrap;">kauth_cred_t cred</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">VOP_ABORTOP</b>(<i class="farg" style="white-space:nowrap;">struct vnode *dvp</i>, <i class="farg" style="white-space:nowrap;">struct componentname *cnp</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">VOP_INACTIVE</b>(<i class="farg" style="white-space:nowrap;">struct vnode *vp</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">VOP_RECLAIM</b>(<i class="farg" style="white-space:nowrap;">struct vnode *vp</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">VOP_LOCK</b>(<i class="farg" style="white-space:nowrap;">struct vnode *vp</i>, <i class="farg" style="white-space:nowrap;">int flags</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">VOP_UNLOCK</b>(<i class="farg" style="white-space:nowrap;">struct vnode *vp</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">VOP_ISLOCKED</b>(<i class="farg" style="white-space:nowrap;">struct vnode *vp</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">VOP_BMAP</b>(<i class="farg" style="white-space:nowrap;">struct vnode *vp</i>, <i class="farg" style="white-space:nowrap;">daddr_t bn</i>, <i class="farg" style="white-space:nowrap;">struct vnode **vpp</i>, <i class="farg" style="white-space:nowrap;">daddr_t *bnp</i>, <i class="farg" style="white-space:nowrap;">int *runp</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">VOP_PRINT</b>(<i class="farg" style="white-space:nowrap;">struct vnode *vp</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">VOP_PATHCONF</b>(<i class="farg" style="white-space:nowrap;">struct vnode *vp</i>, <i class="farg" style="white-space:nowrap;">int name</i>, <i class="farg" style="white-space:nowrap;">register_t *retval</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">VOP_ADVLOCK</b>(<i class="farg" style="white-space:nowrap;">struct vnode *vp</i>, <i class="farg" style="white-space:nowrap;">void *id</i>, <i class="farg" style="white-space:nowrap;">int op</i>, <i class="farg" style="white-space:nowrap;">struct flock *fl</i>, <i class="farg" style="white-space:nowrap;">int flags</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">VOP_WHITEOUT</b>(<i class="farg" style="white-space:nowrap;">struct vnode *dvp</i>, <i class="farg" style="white-space:nowrap;">struct componentname *cnp</i>, <i class="farg" style="white-space:nowrap;">int flags</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">VOP_GETPAGES</b>(<i class="farg" style="white-space:nowrap;">struct vnode *vp</i>, <i class="farg" style="white-space:nowrap;">voff_t offset</i>, <i class="farg" style="white-space:nowrap;">struct vm_page **m</i>, <i class="farg" style="white-space:nowrap;">int *count</i>, <i class="farg" style="white-space:nowrap;">int centeridx</i>, <i class="farg" style="white-space:nowrap;">vm_prot_t access_type</i>, <i class="farg" style="white-space:nowrap;">int advice</i>, <i class="farg" style="white-space:nowrap;">int flags</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">VOP_PUTPAGES</b>(<i class="farg" style="white-space:nowrap;">struct vnode *vp</i>, <i class="farg" style="white-space:nowrap;">voff_t offlo</i>, <i class="farg" style="white-space:nowrap;">voff_t offhi</i>, <i class="farg" style="white-space:nowrap;">int flags</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">VOP_STRATEGY</b>(<i class="farg" style="white-space:nowrap;">struct vnode *vp</i>, <i class="farg" style="white-space:nowrap;">struct buf *bp</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">VOP_BWRITE</b>(<i class="farg" style="white-space:nowrap;">struct vnode *vp</i>, <i class="farg" style="white-space:nowrap;">struct buf *bp</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">VOP_GETEXTATTR</b>(<i class="farg" style="white-space:nowrap;">struct vnode *vp</i>, <i class="farg" style="white-space:nowrap;">int attrnamespace</i>, <i class="farg" style="white-space:nowrap;">const char *name</i>, <i class="farg" style="white-space:nowrap;">struct uio *uio</i>, <i class="farg" style="white-space:nowrap;">size_t *size</i>, <i class="farg" style="white-space:nowrap;">kauth_cred_t cred</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">VOP_SETEXTATTR</b>(<i class="farg" style="white-space:nowrap;">struct vnode *vp</i>, <i class="farg" style="white-space:nowrap;">int attrnamespace</i>, <i class="farg" style="white-space:nowrap;">const char *name</i>, <i class="farg" style="white-space:nowrap;">struct uio *uio</i>, <i class="farg" style="white-space:nowrap;">kauth_cred_t cred</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">VOP_LISTEXTATTR</b>(<i class="farg" style="white-space:nowrap;">struct vnode *vp</i>, <i class="farg" style="white-space:nowrap;">int attrnamespace</i>, <i class="farg" style="white-space:nowrap;">struct uio *uio</i>, <i class="farg" style="white-space:nowrap;">size_t *size</i>, <i class="farg" style="white-space:nowrap;">kauth_cred_t cred</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">VOP_DELETEEXTATTR</b>(<i class="farg" style="white-space:nowrap;">struct vnode *vp</i>, <i class="farg" style="white-space:nowrap;">int attrnamespace</i>, <i class="farg" style="white-space:nowrap;">const char *name</i>, <i class="farg" style="white-space:nowrap;">kauth_cred_t cred</i>);<p>
Not all header files are required for each function.</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The vnode operations vector describes what operations can be done to the file associated with the vnode. The system maintains one vnode operations vector for each file system type configured into the kernel. The vnode operations vector contains a pointer to a function for each operation supported by the file system. Many of the functions described in the vnode operations vector are closely related to their corresponding system calls. In most cases, they are called as a result of the system call associated with the operation being invoked.<p>
Functions in the vnode operations vector are invoked using specialized macros. The following table gives a summary of the operations.<p>
<table style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-col">
<col style="width: 17.00ex;">
<col style="min-width: 32.00ex;">
<tbody>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
<span class="symb">Macro</span></td>
<td class="list-col" style="margin-top: 0.00em;">
<span class="symb">Description</span></td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
VOP_LOOKUP</td>
<td class="list-col" style="margin-top: 0.00em;">
Lookup file name in name cache</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
VOP_CREATE</td>
<td class="list-col" style="margin-top: 0.00em;">
Create a new file</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
VOP_MKNOD</td>
<td class="list-col" style="margin-top: 0.00em;">
Make a new device</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
VOP_OPEN</td>
<td class="list-col" style="margin-top: 0.00em;">
Open a file</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
VOP_CLOSE</td>
<td class="list-col" style="margin-top: 0.00em;">
Close a file</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
VOP_ACCESS</td>
<td class="list-col" style="margin-top: 0.00em;">
Determine file accessibility</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
VOP_GETATTR</td>
<td class="list-col" style="margin-top: 0.00em;">
Get file attributes</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
VOP_SETATTR</td>
<td class="list-col" style="margin-top: 0.00em;">
Set file attributes</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
VOP_READ</td>
<td class="list-col" style="margin-top: 0.00em;">
Read from a file</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
VOP_WRITE</td>
<td class="list-col" style="margin-top: 0.00em;">
Write to a file</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
VOP_FALLOCATE</td>
<td class="list-col" style="margin-top: 0.00em;">
Allocate backing for a file</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
VOP_FDISCARD</td>
<td class="list-col" style="margin-top: 0.00em;">
Discard backing for a file</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
VOP_IOCTL</td>
<td class="list-col" style="margin-top: 0.00em;">
Perform device-specific I/O</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
VOP_FCNTL</td>
<td class="list-col" style="margin-top: 0.00em;">
Perform file control</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
VOP_POLL</td>
<td class="list-col" style="margin-top: 0.00em;">
Test if poll event has occurred</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
VOP_KQFILTER</td>
<td class="list-col" style="margin-top: 0.00em;">
Register a knote</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
VOP_REVOKE</td>
<td class="list-col" style="margin-top: 0.00em;">
Eliminate vnode activity</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
VOP_MMAP</td>
<td class="list-col" style="margin-top: 0.00em;">
Map file into user address space</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
VOP_FSYNC</td>
<td class="list-col" style="margin-top: 0.00em;">
Flush pending data to disk</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
VOP_SEEK</td>
<td class="list-col" style="margin-top: 0.00em;">
Test if file is seekable</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
VOP_REMOVE</td>
<td class="list-col" style="margin-top: 0.00em;">
Remove a file</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
VOP_LINK</td>
<td class="list-col" style="margin-top: 0.00em;">
Link a file</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
VOP_RENAME</td>
<td class="list-col" style="margin-top: 0.00em;">
Rename a file</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
VOP_MKDIR</td>
<td class="list-col" style="margin-top: 0.00em;">
Make a new directory</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
VOP_RMDIR</td>
<td class="list-col" style="margin-top: 0.00em;">
Remove a directory</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
VOP_SYMLINK</td>
<td class="list-col" style="margin-top: 0.00em;">
Create a symbolic link</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
VOP_READDIR</td>
<td class="list-col" style="margin-top: 0.00em;">
Read directory entry</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
VOP_READLINK</td>
<td class="list-col" style="margin-top: 0.00em;">
Read contents of a symlink</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
VOP_ABORTOP</td>
<td class="list-col" style="margin-top: 0.00em;">
Abort pending operation</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
VOP_INACTIVE</td>
<td class="list-col" style="margin-top: 0.00em;">
Release the inactive vnode</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
VOP_RECLAIM</td>
<td class="list-col" style="margin-top: 0.00em;">
Reclaim vnode for another file</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
VOP_LOCK</td>
<td class="list-col" style="margin-top: 0.00em;">
Sleep until vnode lock is free</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
VOP_UNLOCK</td>
<td class="list-col" style="margin-top: 0.00em;">
Wake up process sleeping on lock</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
VOP_ISLOCKED</td>
<td class="list-col" style="margin-top: 0.00em;">
Test if vnode is locked</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
VOP_BMAP</td>
<td class="list-col" style="margin-top: 0.00em;">
Logical block number conversion</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
VOP_PRINT</td>
<td class="list-col" style="margin-top: 0.00em;">
Print debugging information</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
VOP_PATHCONF</td>
<td class="list-col" style="margin-top: 0.00em;">
Return POSIX pathconf data</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
VOP_ADVLOCK</td>
<td class="list-col" style="margin-top: 0.00em;">
Advisory record locking</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
VOP_WHITEOUT</td>
<td class="list-col" style="margin-top: 0.00em;">
Whiteout vnode</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
VOP_GETPAGES</td>
<td class="list-col" style="margin-top: 0.00em;">
Read VM pages from file</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
VOP_PUTPAGES</td>
<td class="list-col" style="margin-top: 0.00em;">
Write VM pages to file</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
VOP_STRATEGY</td>
<td class="list-col" style="margin-top: 0.00em;">
Read/write a file system buffer</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
VOP_BWRITE</td>
<td class="list-col" style="margin-top: 0.00em;">
Write a file system buffer</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
VOP_GETEXTATTR</td>
<td class="list-col" style="margin-top: 0.00em;">
Get extended attribute</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
VOP_SETEXTATTR</td>
<td class="list-col" style="margin-top: 0.00em;">
Set extended attribute</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
VOP_LISTEXTATTR</td>
<td class="list-col" style="margin-top: 0.00em;">
List extended attributes</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
VOP_DELETEEXTATTR</td>
<td class="list-col" style="margin-top: 0.00em;">
Remove extended attribute</td>
</tr>
</tbody>
</table>
<p>
The implementation details of the vnode operations vector are not quite what is described here.<p>
If the file system type does not support a specific operation, it must nevertheless assign an appropriate stub in the vnode operations vector to do the minimum required of it. In most cases, such functions either do nothing or return an error value to the effect that it is not supported.<p>
Many of the functions in the vnode operations vector take a componentname structure. It is used to encapsulate many parameters into a single function argument. It has the following structure:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
struct componentname { 
        /* 
         * Arguments to lookup. 
         */ 
        uint32_t cn_nameiop;    /* namei operation */ 
        uint32_t cn_flags;      /* flags to namei */ 
        kauth_cred_t cn_cred;   /* credentials */ 
        /* 
         * Shared between lookup and commit routines. 
         */ 
        const char *cn_nameptr; /* pointer to looked up name */ 
        size_t  cn_namelen;     /* length of looked up component */ 
        size_t  cn_consume;     /* chars to consume in lookup() */ 
};</pre>
<p>
The top half of the structure is used exclusively for the pathname lookups using <b class="fname">VOP_LOOKUP</b>() and is initialized by the caller. The semantics of the lookup are affected by the lookup operation specified in <span class="emph">cn_nameiop</span> and the flags specified in <span class="emph">cn_flags</span>. Valid operations are:<p>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
LOOKUP</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
perform name lookup only</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
CREATE</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
set up for file creation</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
DELETE</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
set up for file deletion</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
RENAME</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
set up for file renaming</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
OPMASK</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
mask for operation</dd>
</dl>
<p>
Valid values for <span class="emph">cn-&gt;cn_flags</span> are:<p>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
LOCKLEAF</dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
lock inode on return</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
LOCKPARENT</dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
want parent vnode returned locked</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
NOCACHE</dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
name must not be left in name cache (see <a class="link-man" href="../9/namecache">namecache(9)</a>)</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
FOLLOW</dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
follow symbolic links</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
NOFOLLOW</dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
do not follow symbolic links (pseudo)</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
MODMASK</dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
mask of operational modifiers</dd>
</dl>
<p>
No vnode operations may be called from interrupt context. Most operations also require the vnode to be locked on entry. To prevent deadlocks, when acquiring locks on multiple vnodes, the lock of parent directory must be acquired before the lock on the child directory.<p>
Vnode operations for a file system type generally should not be called directly from the kernel, but accessed indirectly through the high-level convenience functions discussed in <a class="link-man" href="../9/vnsubr">vnsubr(9)</a>.</div>
<div class="section">
<h1 id="x46554e4354494f4e53">FUNCTIONS</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">VOP_LOOKUP</b>(<i class="farg">dvp</i>, <i class="farg">vpp</i>, <i class="farg">cnp</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Lookup a single pathname component in a given directory. The argument <i class="farg">dvp</i> is the locked vnode of the directory to search and <i class="farg">cnp</i> is the pathname component to be searched for. If the pathname component is found, the address of the resulting unlocked vnode is returned in <i class="farg">vpp</i>. The operation specified in <span class="emph">cnp-&gt;cn_nameiop</span> indicates <b class="fname">VOP_LOOKUP</b>() the reason for requesting the lookup and uses it to cache file system type specific information in the vnode for subsequent operations.<p>
There are three types of lookups: ".", ".." (ISDOTDOT), and regular. If the pathname component being searched for is ".", then <i class="farg">dvp</i> has an extra reference added to it and it is returned in <i class="farg">*vpp</i>. For other pathname components, <b class="fname">VOP_LOOKUP</b>() checks the accessibility of the directory and searches the name cache for the pathname component. See <a class="link-man" href="../9/namecache">namecache(9)</a>. If the pathname is not found in the name cache, the directory is searched for the pathname. The resulting unlocked vnode is returned in <i class="farg">vpp</i>. <i class="farg">dvp</i> is always returned locked.<p>
On failure <i class="farg">*vpp</i> is <span class="define">NULL</span>, and <i class="farg">*dvp</i> is left locked. If the operation is successful <i class="farg">*vpp</i> is unlocked and zero is returned. Typically, if <i class="farg">*vpp</i> and <i class="farg">dvp</i> are the same vnode the caller will need to release twice (decrement the reference count) and unlock once.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">VOP_CREATE</b>(<i class="farg">dvp</i>, <i class="farg">vpp</i>, <i class="farg">cnp</i>, <i class="farg">vap</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Create a new file in a given directory. The argument <i class="farg">dvp</i> is the locked vnode of the directory to create the new file in and <i class="farg">cnp</i> is the pathname component of the new file. The argument <i class="farg">vap</i> specifies the attributes that the new file should be created with. If the file is successfully created, the address of the resulting unlocked vnode is returned in <i class="farg">vpp</i> and zero is returned.<p>
This function is called after <b class="fname">VOP_LOOKUP</b>() when a file is being created. Normally, <b class="fname">VOP_LOOKUP</b>() will have set the SAVENAME flag in <span class="emph">cnp-&gt;cn_flags</span> to keep the memory pointed to by <span class="emph">cnp-&gt;cn_pnbuf</span> valid. If an error is detected when creating the file, this memory is released. If the file is created successfully it will be released unless the SAVESTART flags in specified in <span class="emph">cnp-&gt;cn_flags</span>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">VOP_MKNOD</b>(<i class="farg">dvp</i>, <i class="farg">vpp</i>, <i class="farg">cnp</i>, <i class="farg">vap</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Make a new device-special file in a given directory. The argument <i class="farg">dvp</i> is the locked vnode of the directory to create the new device-special file in and <i class="farg">cnp</i> is the pathname component of the new device-special file. The argument <i class="farg">vap</i> specifies the attributes that the new device-special file should be created with. If the file is successfully created, the address of the resulting unlocked vnode is returned in <i class="farg">vpp</i> and zero is returned.<p>
This function is called after <b class="fname">VOP_LOOKUP</b>() when a device-special file is being created. Normally, <b class="fname">VOP_LOOKUP</b>() will have set the SAVENAME flag in <span class="emph">cnp-&gt;cn_flags</span> to keep the memory pointed to by <span class="emph">cnp-&gt;cn_pnbuf</span> valid. If an error is detected when creating the device-special file, this memory is released. If the device-special file is created successfully it will be released unless the SAVESTART flags in specified in <span class="emph">cnp-&gt;cn_flags</span>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">VOP_OPEN</b>(<i class="farg">vp</i>, <i class="farg">mode</i>, <i class="farg">cred</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Open a file. The argument <i class="farg">vp</i> is the vnode of the file to open and <i class="farg">mode</i> specifies the access mode required by the calling process. The calling credentials are specified by <i class="farg">cred</i>. The access mode is a set of flags, including FREAD, FWRITE, O_NONBLOCK, O_APPEND, etc. <b class="fname">VOP_OPEN</b>() must be called before a file can be accessed by a thread. The vnode reference count is incremented.<p>
<b class="fname">VOP_OPEN</b>() expects the vnode <i class="farg">vp</i> to be locked on entry and will leave it locked on return. If the operation is successful zero is returned, otherwise an appropriate error code is returned.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">VOP_CLOSE</b>(<i class="farg">vp</i>, <i class="farg">fflag</i>, <i class="farg">cred</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Close a file. The argument <i class="farg">vp</i> is the vnode of the file to close and <i class="farg">fflag</i> specifies the access mode by the calling process. The possible flags are <span class="define">FREAD</span>, <span class="define">FWRITE</span> and <span class="define">FNONBLOCK</span>. The calling credentials are specified by <i class="farg">cred</i>. <b class="fname">VOP_CLOSE</b>() frees resources allocated by <b class="fname">VOP_OPEN</b>().<p>
The vnode <i class="farg">vp</i> will be locked on entry and should remain locked on return.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">VOP_ACCESS</b>(<i class="farg">vp</i>, <i class="farg">mode</i>, <i class="farg">cred</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Determine the accessibility (permissions) of the file against the specified credentials. The argument <i class="farg">vp</i> is the vnode of the file to check, <i class="farg">mode</i> is the type of access required and <i class="farg">cred</i> contains the user credentials to check. The argument <i class="farg">mode</i> is a mask which can contain VREAD, VWRITE or VEXEC. If the file is accessible in the specified way, zero is returned, otherwise an appropriate error code is returned.<p>
The vnode <i class="farg">vp</i> will be locked on entry and should remain locked on return.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">VOP_GETATTR</b>(<i class="farg">vp</i>, <i class="farg">vap</i>, <i class="farg">cred</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Get specific vnode attributes on a file. The argument <i class="farg">vp</i> is the vnode of the file to get the attributes for. The argument <i class="farg">cred</i> specifies the calling credentials. <b class="fname">VOP_GETATTR</b>() uses the file system type specific data object <span class="emph">vp-&gt;v_data</span> to reference the underlying file attributes. Attributes associated with the file are collected by setting the required attribute bits in <span class="emph">vap-&gt;va_mask</span>. The attributes are returned in <i class="farg">vap</i>. Attributes which are not available are set to the value VNOVAL.<p>
For more information on vnode attributes see <a class="link-man" href="../9/vattr">vattr(9)</a>. Historically it was considered acceptable to call <b class="fname">VOP_GETATTR</b>() without first locking the vnode. This usage is deprecated.<p>
The vnode <i class="farg">vp</i> will be locked on entry and should remain locked on return.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">VOP_SETATTR</b>(<i class="farg">vp</i>, <i class="farg">vap</i>, <i class="farg">cred</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Set specific vnode attributes on a file. The argument <i class="farg">vp</i> is the locked vnode of the file to set the attributes for. The argument <i class="farg">cred</i> specifies the calling credentials. <b class="fname">VOP_SETATTR</b>() uses the file system type specific data object <span class="emph">vp-&gt;v_data</span> to reference the underlying file attributes. The new attributes are defined in <i class="farg">vap</i>. Attributes associated with the file are set by setting the required attribute bits in <span class="emph">vap-&gt;va_mask</span>. Attributes which are not being modified by <b class="fname">VOP_SETATTR</b>() should be set to the value VNOVAL. If the operation is successful zero is returned, otherwise an appropriate error is returned.<p>
For more information on vnode attributes see <a class="link-man" href="../9/vattr">vattr(9)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">VOP_READ</b>(<i class="farg">vp</i>, <i class="farg">uio</i>, <i class="farg">ioflag</i>, <i class="farg">cred</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Read the contents of a file. The argument <i class="farg">vp</i> is the vnode of the file to read from, <i class="farg">uio</i> is the location to read the data into, <i class="farg">ioflag</i> is a set of flags and <i class="farg">cred</i> are the credentials of the calling process.<p>
The <i class="farg">ioflag</i> argument is used to give directives and hints to the file system. When attempting a read, the high 16 bits are used to provide a read-ahead hint (in unit of file system blocks) that the file system should attempt. The low 16 bits are a bit mask which can contain the following flags:<p>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
IO_UNIT</dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
do I/O as atomic unit</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
IO_APPEND</dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
append write to end</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
IO_SYNC</dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
sync I/O file integrity completion</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
IO_NODELOCKED</dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
underlying node already locked</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
IO_NDELAY</dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
FNDELAY flag set in file table</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
IO_DSYNC</dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
sync I/O data integrity completion</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
IO_ALTSEMANTICS</dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
use alternate I/O semantics</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
IO_NORMAL</dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
operate on regular data</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
IO_EXT</dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
operate on extended attributes</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
IO_DIRECT</dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
do not buffer data in the kernel</dd>
</dl>
<p>
Zero is returned on success, otherwise an error is returned. The vnode should be locked on entry and remains locked on exit.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">VOP_WRITE</b>(<i class="farg">vp</i>, <i class="farg">uio</i>, <i class="farg">ioflag</i>, <i class="farg">cred</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Write to a file. The argument <i class="farg">vp</i> is the vnode of the file to write to, <i class="farg">uio</i> is the location of the data to write, <i class="farg">ioflag</i> is a set of flags and <i class="farg">cred</i> are the credentials of the calling process.<p>
The <i class="farg">ioflag</i> argument is used to give directives and hints to the file system. The low 16 bits are a bit mask which can contain the same flags as <b class="fname">VOP_READ</b>().<p>
Zero is returned on success, otherwise an error is returned. The vnode should be locked on entry and remains locked on exit.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">VOP_FALLOCATE</b>(<i class="farg">vp</i>, <i class="farg">pos</i>, <i class="farg">len</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Allocate backing store. The argument <i class="farg">vp</i> is the vnode for the file. The <i class="farg">pos</i> and <i class="farg">len</i> arguments (specified in bytes) name an extent within the file. The blocks underlying this range, rounding up at the top and down at the bottom if needed, are checked; if no physical storage is allocated, a physical block is allocated and zeroed. This operation removes &#8220;holes&#8221; from files.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">VOP_FDISCARD</b>(<i class="farg">vp</i>, <i class="farg">pos</i>, <i class="farg">len</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Discard backing store. The argument <i class="farg">vp</i> is the vnode for the file. The <i class="farg">pos</i> and <i class="farg">len</i> arguments (specified in bytes) name an extent within the file. The blocks underlying this range, rounding down at the top and up at the bottom if needed, are checked. If any physical storage is used, it is deallocated. This operation creates &#8220;holes&#8221; in files. Discarded blocks of regular files read back afterwards as zeroes. On devices, the underlying discard-block operation if any (e.g. ATA TRIM) is issued. The device handles this as it sees fit. In particular it is <span class="emph">not</span> guaranteed that discarded blocks on devices will be zeroed; reading a discarded block might produce zeros, or ones, or the previously existing data, or some other data, or trash.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">VOP_IOCTL</b>(<i class="farg">vp</i>, <i class="farg">command</i>, <i class="farg">data</i>, <i class="farg">fflag</i>, <i class="farg">cred</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Perform device-specific I/O. The argument <i class="farg">vp</i> is the locked vnode of the file, normally representing a device. The argument <i class="farg">command</i> specifies the device-specific operation to perform and <i class="farg">cnp</i> provides extra data for the specified operation. The argument <i class="farg">fflags</i> is a set of flags. The argument <i class="farg">cred</i> is the caller's credentials. If the operation is successful, zero is returned, otherwise an appropriate error code is returned.<p>
Most file systems do not supply a function for <b class="fname">VOP_IOCTL</b>(). This function implements the <a class="link-man" href="../2/ioctl">ioctl(2)</a> system call.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">VOP_FCNTL</b>(<i class="farg">vp</i>, <i class="farg">command</i>, <i class="farg">data</i>, <i class="farg">fflag</i>, <i class="farg">cred</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Perform file control. The argument <i class="farg">vp</i> is the locked vnode of the file. The argument <i class="farg">command</i> specifies the operation to perform and <i class="farg">cnp</i> provides extra data for the specified operation. The argument <i class="farg">fflags</i> is a set of flags. The argument <i class="farg">cred</i> is the caller's credentials. If the operation is successful, zero is returned, otherwise an appropriate error code is returned.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">VOP_POLL</b>(<i class="farg">vp</i>, <i class="farg">events</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Test if a poll event has occurred. The argument <i class="farg">vp</i> is the vnode of the file to poll. It returns any events of interest as specified by <i class="farg">events</i> that may have occurred for the file. The argument <i class="farg">events</i> is a set of flags as specified by <a class="link-man" href="../2/poll">poll(2)</a>.<p>
The vnode <i class="farg">vp</i> remains unlocked throughout the whole operation.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">VOP_KQFILTER</b>(<i class="farg">vp</i>, <i class="farg">kn</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Register a knote <i class="farg">kn</i> with the vnode <i class="farg">vn</i>. If the operation is successful zero is returned, otherwise an appropriate error code is returned.<p>
The vnode <i class="farg">vp</i> remains unlocked throughout the whole operation.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">VOP_REVOKE</b>(<i class="farg">vp</i>, <i class="farg">flags</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Eliminate all activity associated with the vnode <i class="farg">vp</i>. The argument <i class="farg">flags</i> is a set of flags. If REVOKEALL is set in <i class="farg">flags</i> all vnodes aliased to the vnode <i class="farg">vp</i> are also eliminated. If the operation is successful zero is returned, otherwise an appropriate error is returned.<p>
The vnode <i class="farg">vp</i> remains unlocked throughout the whole operation.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">VOP_MMAP</b>(<i class="farg">vp</i>, <i class="farg">prot</i>, <i class="farg">cred</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Inform file system that <i class="farg">vp</i> is in the process of being memory mapped. The argument <i class="farg">prot</i> specifies the vm access protection the vnode is going to be mapped with. The argument <i class="farg">cred</i> is the caller's credentials. If the file system allows the memory mapping, zero is returned, otherwise an appropriate error code is returned.<p>
Most file systems do not supply a function for <b class="fname">VOP_MMAP</b>() and use <b class="fname">genfs_mmap</b>() to default for success. Only file systems which do not integrate with the page cache at all typically want to disallow memory mapping.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">VOP_FSYNC</b>(<i class="farg">vp</i>, <i class="farg">cred</i>, <i class="farg">flags</i>, <i class="farg">offlo</i>, <i class="farg">offhi</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Flush pending data buffers for a file to disk. The argument <i class="farg">vp</i> is the locked vnode of the file for flush. The argument <i class="farg">cred</i> is the caller's credentials. The argument <i class="farg">flags</i> is a set of flags. If FSYNC_WAIT is specified in <i class="farg">flags</i>, the function should wait for I/O to complete before returning. The argument <i class="farg">offlo</i> and <i class="farg">offhi</i> specify the range of file to flush. If the operation is successful zero is returned, otherwise an appropriate error code is returned.<p>
This function implements the <a class="link-man" href="../2/sync">sync(2)</a> and <a class="link-man" href="../2/fsync">fsync(2)</a> system calls.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">VOP_SEEK</b>(<i class="farg">vp</i>, <i class="farg">oldoff</i>, <i class="farg">newoff</i>, <i class="farg">cred</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Test if the file is seekable for the specified offset <i class="farg">newoff</i>. The argument <i class="farg">vp</i> is the locked vnode of the file to test. For most file systems this function simply tests if <i class="farg">newoff</i> is valid. If the specified <i class="farg">newoff</i> is less than zero, the function returns error code EINVAL.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">VOP_REMOVE</b>(<i class="farg">dvp</i>, <i class="farg">vp</i>, <i class="farg">cnp</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Remove a file. The argument <i class="farg">dvp</i> is the locked vnode of the directory to remove the file from and <i class="farg">vp</i> is the locked vnode of the file to remove. The argument <i class="farg">cnp</i> is the pathname component about the file to remove. If the operation is successful zero is returned, otherwise an appropriate error code is returned. Both <i class="farg">dvp</i> and <i class="farg">vp</i> are locked on entry and are to be unlocked before returning.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">VOP_LINK</b>(<i class="farg">dvp</i>, <i class="farg">vp</i>, <i class="farg">cnp</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Link to a file. The argument <i class="farg">dvp</i> is the locked node of the directory to create the new link and <i class="farg">vp</i> is the vnode of the file to be linked. The argument <i class="farg">cnp</i> is the pathname component of the new link. If the operation is successful zero is returned, otherwise an error code is returned. The directory vnode <i class="farg">dvp</i> should be locked on entry and will be released and unlocked on return. The vnode <i class="farg">vp</i> should not be locked on entry and will remain unlocked on return.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">VOP_RENAME</b>(<i class="farg">fdvp</i>, <i class="farg">fvp</i>, <i class="farg">fcnp</i>, <i class="farg">tdvp</i>, <i class="farg">tvp</i>, <i class="farg">tcnp</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Rename a file. The argument <i class="farg">fdvp</i> is the vnode of the old parent directory containing in the file to be renamed and <i class="farg">fvp</i> is the vnode of the file to be renamed. The argument <i class="farg">fcnp</i> is the pathname component about the file to be renamed. The argument <i class="farg">tdvp</i> is the vnode of the new directory of the target file and <i class="farg">tvp</i> is the vnode of the target file (if it exists). The argument <i class="farg">tcnp</i> is the pathname component about the file's new name. If the operation is successful zero is returned, otherwise an error code is returned.<p>
The caller must hold the target file system's rename lock. The source directory and file vnodes should be unlocked and their reference counts should be incremented before entry. The target directory and file vnodes should both be locked on entry. <b class="fname">VOP_RENAME</b>() updates the reference counts prior to returning.<p>
Because of the complexity and nastiness of the interface, please do not write new code that calls <b class="fname">VOP_RENAME</b>() directly until such time as ongoing cleanup work reaches a point where the interface has been rendered halfway sane.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">VOP_MKDIR</b>(<i class="farg">dvp</i>, <i class="farg">vpp</i>, <i class="farg">cnp</i>, <i class="farg">vap</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Make a new directory in a given directory. The argument <i class="farg">dvp</i> is the locked vnode of the directory to create the new directory in and <i class="farg">cnp</i> is the pathname component of the new directory. The argument <i class="farg">vap</i> specifies the attributes that the new directory should be created with. If the file is successfully created, the address of the resulting unlocked vnode is returned in <i class="farg">vpp</i> and zero is returned.<p>
This function is called after <b class="fname">VOP_LOOKUP</b>() when a directory is being created. Normally, <b class="fname">VOP_LOOKUP</b>() will have set the SAVENAME flag in <span class="emph">cnp-&gt;cn_flags</span> to keep the memory pointed to by <span class="emph">cnp-&gt;cn_pnbuf</span> valid. If an error is detected when creating the directory, this memory is released. If the directory is created successfully it will be released unless the SAVESTART flags in specified in <span class="emph">cnp-&gt;cn_flags</span>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">VOP_RMDIR</b>(<i class="farg">dvp</i>, <i class="farg">vp</i>, <i class="farg">cnp</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Remove a directory in a given directory. The argument <i class="farg">dvp</i> is the locked vnode of the directory to remove the directory from and <i class="farg">vp</i> is the locked vnode of the directory to remove. The argument <i class="farg">cnp</i> is the pathname component of the directory. Zero is returned on success, otherwise an error code is returned. Both <i class="farg">dvp</i> and <i class="farg">vp</i> should be locked on entry and will be released and unlocked on return.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">VOP_SYMLINK</b>(<i class="farg">dvp</i>, <i class="farg">vpp</i>, <i class="farg">cnp</i>, <i class="farg">vap</i>, <i class="farg">target</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Create a symbolic link in a given directory. The argument <i class="farg">dvp</i> is the locked vnode of the directory to create the symbolic link in and <i class="farg">cnp</i> is the pathname component of the symbolic link. The argument <i class="farg">vap</i> specifies the attributes that the symbolic link should be created with and <i class="farg">target</i> specifies the pathname of the target of the symbolic link. If the symbolic link is successfully created, the address of the resulting unlocked vnode is returned in <i class="farg">vpp</i> and zero is returned.<p>
This function is called after <b class="fname">VOP_LOOKUP</b>() when a symbolic link is being created. Normally, <b class="fname">VOP_LOOKUP</b>() will have set the SAVENAME flag in <span class="emph">cnp-&gt;cn_flags</span> to keep the memory pointed to by <span class="emph">cnp-&gt;cn_pnbuf</span> valid. If an error is detected when creating the symbolic link, this memory is released. If the symbolic link is created successfully it will be released unless the SAVESTART flags in specified in <span class="emph">cnp-&gt;cn_flags</span>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">VOP_READDIR</b>(<i class="farg">vp</i>, <i class="farg">uio</i>, <i class="farg">cred</i>, <i class="farg">eofflag</i>, <i class="farg">cookies</i>, <i class="farg">ncookies</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Read directory entry. The argument <i class="farg">vp</i> is the vnode of the directory to read the contents of and <i class="farg">uio</i> is the destination location to read the contents into. The argument <i class="farg">cred</i> is the caller's credentials. The argument <i class="farg">eofflag</i> is the pointer to a flag which is set by <b class="fname">VOP_READDIR</b>() to indicate an end-of-file condition. If <i class="farg">eofflag</i> is <span class="define">NULL</span>, the end-of-file condition is not returned. The arguments <i class="farg">cookies</i> and <i class="farg">ncookies</i> specify the addresses for the list and number of directory seek cookies generated for NFS. Both <i class="farg">cookies</i> and <i class="farg">ncookies</i> should be <span class="define">NULL</span> if they aren't required to be returned by <b class="fname">VOP_READDIR</b>(). The directory contents are read into struct dirent structures and <i class="farg">uio-&gt;uio_offset</i> is set to the offset of the next unread directory entry. This offset may be used in a following invocation to continue a sequential read of the directory contents. If the operation is successful zero is returned, otherwise an appropriate error code is returned.<p>
The directory should be locked on entry and will remain locked on return.<p>
In case <i class="farg">ncookies</i> and <i class="farg">cookies</i> are supplied, one cookie should be returned per directory entry. The value of the cookie for each directory entry should be the offset within the directory where the on-disk version of the following directory entry starts. That is, for each directory entry <i class="farg">i</i>, the corresponding cookie should refer to the offset of directory entry <i class="farg">i + 1</i>.<p>
Note that the <i class="farg">cookies</i> array must be allocated by the callee using the M_TEMP malloc type as callers of <b class="fname">VOP_READDIR</b>() must be able to free the allocation.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">VOP_READLINK</b>(<i class="farg">vp</i>, <i class="farg">uio</i>, <i class="farg">cred</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Read the contents of a symbolic link. The argument <i class="farg">vp</i> is the locked vnode of the symlink and <i class="farg">uio</i> is the destination location to read the contents into. The argument <i class="farg">cred</i> is the credentials of the caller. If the operation is successful zero is returned, otherwise an error code is returned.<p>
The vnode should be locked on entry and will remain locked on return.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">VOP_ABORTOP</b>(<i class="farg">dvp</i>, <i class="farg">cnp</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Abort pending operation on vnode <i class="farg">dvp</i> and free resources allocated in <i class="farg">cnp</i>.<p>
This operation is rarely implemented in file systems and <b class="fname">genfs_abortop</b>() is typically used instead.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">VOP_INACTIVE</b>(<i class="farg">vp</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Release the inactive vnode. <b class="fname">VOP_INACTIVE</b>() is called when the kernel is no longer using the vnode. This may be because the reference count reaches zero or it may be that the file system is being forcibly unmounted while there are open files. It can be used to reclaim space for open but deleted files. The argument <i class="farg">vp</i> is the locked vnode to be released. If the operation is successful zero is returned, otherwise an appropriate error code is returned. The vnode <i class="farg">vp</i> must be locked on entry, and will be unlocked on return.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">VOP_RECLAIM</b>(<i class="farg">vp</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Reclaim the vnode for another file system. <b class="fname">VOP_RECLAIM</b>() is called when a vnode is being reused for a different file system. Any file system specific resources associated with the vnode should be freed. The argument <i class="farg">vp</i> is the vnode to be reclaimed. If the operation is successful zero is returned, otherwise an appropriate error code is returned. The vnode <i class="farg">vp</i> should not be locked on entry, and will remain unlocked on return.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">VOP_LOCK</b>(<i class="farg">vp</i>, <i class="farg">flags</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Sleep until vnode lock is free. The argument <i class="farg">vp</i> is the vnode of the file to be locked. The argument <i class="farg">flags</i> is <span class="define">LK_EXCLUSIVE</span> to take the lock exclusively or <span class="define">LK_SHARED</span> to take a shared lock. If <i class="farg">flags</i> contains <span class="define">LK_NOWAIT</span> and the lock is busy, the operation will return immediately with an error code. If <i class="farg">flags</i> contains <span class="define">LK_RETRY</span> this is a hint the caller wants the lock on dead vnodes too. If the operation is successful zero is returned, otherwise an appropriate error code is returned. <b class="fname">VOP_LOCK</b>() is used to serialize access to the file system such as to prevent two writes to the same file from happening at the same time. Kernel code should use <a class="link-man" href="../9/vn_lock">vn_lock(9)</a> to lock a vnode rather than calling <b class="fname">VOP_LOCK</b>() directly.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">VOP_UNLOCK</b>(<i class="farg">vp</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Wake up process sleeping on lock. The argument <i class="farg">vp</i> is the vnode of the file to be unlocked. If the operation is successful zero is returned, otherwise an appropriate error code is returned. <b class="fname">VOP_UNLOCK</b>() is used to serialize access to the file system such as to prevent two writes to the same file from happening at the same time.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">VOP_ISLOCKED</b>(<i class="farg">vp</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Test if the vnode <i class="farg">vp</i> is locked. Possible return values are <span class="define">LK_EXCLUSIVE</span>, <span class="define">LK_SHARED</span> or 0 for lock held exclusively by the calling thread, shared lock held by anyone or unlocked, respectively.<p>
This function must never be used to make locking decisions at run time: it is provided only for diagnostic purposes.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">VOP_BMAP</b>(<i class="farg">vp</i>, <i class="farg">bn</i>, <i class="farg">vpp</i>, <i class="farg">bnp</i>, <i class="farg">runp</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Convert the logical block number <i class="farg">bn</i> of a file specified by vnode <i class="farg">vp</i> to its physical block number on the disk. The physical block is returned in <i class="farg">bnp</i>. In case the logical block is not allocated, &#45;1 is used.<p>
If <i class="farg">vpp</i> is not <span class="define">NULL</span>, the vnode of the device vnode for the file system is returned in the address specified by <i class="farg">vpp</i>. If <i class="farg">runp</i> is not <span class="define">NULL</span>, the number of contiguous blocks starting from the next block after the queried block will be returned in <i class="farg">runp</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">VOP_PRINT</b>(<i class="farg">vp</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Print debugging information. The argument <i class="farg">vp</i> is the vnode to print. If the operation is successful zero is returned, otherwise an appropriate error code is returned.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">VOP_PATHCONF</b>(<i class="farg">vp</i>, <i class="farg">name</i>, <i class="farg">retval</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Implement POSIX <a class="link-man" href="../2/pathconf">pathconf(2)</a> and <a class="link-man" href="../2/fpathconf">fpathconf(2)</a> support. The argument <i class="farg">vp</i> is the locked vnode to get information about. The argument <i class="farg">name</i> specified the type of information to return. The information is returned in the address specified by <i class="farg">retval</i>. Valid values for <i class="farg">name</i> are:<p>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
_PC_LINK_MAX</dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
return the maximum number of links to a file</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
_PC_NAME_MAX</dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
return the maximum number of bytes in a file name</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
_PC_PATH_MAX</dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
return the maximum number of bytes in a pathname</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
_PC_PIPE_BUF</dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
return the maximum number of bytes which will be written atomically to a pipe</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
_PC_CHOWN_RESTRICTED</dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
return 1 if appropriate privileges are required for the <a class="link-man" href="../2/chown">chown(2)</a> system call, otherwise zero</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
_PC_NO_TRUNC</dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
return 0 if file names longer than &#123;<span class="define">NAME_MAX</span>&#125; are silently truncated</dd>
</dl>
<p>
If <i class="farg">name</i> is recognized, <i class="farg">*retval</i> is set to the specified value and zero is returned, otherwise an appropriate error is returned.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">VOP_ADVLOCK</b>(<i class="farg">vp</i>, <i class="farg">id</i>, <i class="farg">op</i>, <i class="farg">fl</i>, <i class="farg">flags</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Manipulate Advisory record locks on a vnode. The argument <i class="farg">vp</i> is the vnode on which locks are manipulated. The argument <i class="farg">id</i> is the id token which is changing the lock and <i class="farg">op</i> is the <a class="link-man" href="../2/fcntl">fcntl(2)</a> operation to perform. Valid values are:<p>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
F_SETLK</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
set lock</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
F_GETLK</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
get the first conflicted lock</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
F_UNLCK</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
clear lock</dd>
</dl>
<p>
The argument <i class="farg">fl</i> is a description of the lock. In the case of <span class="define">SEEK_CUR</span>, The caller should add the current file offset to fl-&gt;l_start beforehand. <b class="fname">VOP_ADVLOCK</b>() treats <span class="define">SEEK_CUR</span> as <span class="define">SEEK_SET</span>.<p>
The argument <i class="farg">flags</i> is the set of flags. Valid values are:<p>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
F_WAIT</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
wait until lock is granted</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
F_FLOCK</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
use <a class="link-man" href="../2/flock">flock(2)</a> semantics for lock</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
F_POSIX</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
use POSIX semantics for lock</dd>
</dl>
<p>
If the operation is successful zero is returned, otherwise an appropriate error is returned.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">VOP_WHITEOUT</b>(<i class="farg">dvp</i>, <i class="farg">cnp</i>, <i class="farg">flags</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Whiteout pathname component in directory with vnode <i class="farg">dvp</i>. The argument <i class="farg">cnp</i> specifies the pathname component to whiteout.<p>
The vnode <i class="farg">dvp</i> should be locked on entry and will remain locked on return.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">VOP_GETPAGES</b>(<i class="farg">vp</i>, <i class="farg">offset</i>, <i class="farg">m</i>, <i class="farg">count</i>, <i class="farg">centeridx</i>, <i class="farg">access_type</i>, <i class="farg">advice</i>, <i class="farg">flags</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Read VM pages from file. The argument <i class="farg">vp</i> is the locked vnode to read the VM pages from. The argument <i class="farg">offset</i> is offset in the file to start accessing and <i class="farg">m</i> is an array of VM pages. The argument <i class="farg">count</i> points a variable that specifies the number of pages to read. If the operation is successful zero is returned, otherwise an appropriate error code is returned. If PGO_LOCKED is specified in <span class="emph">flags</span>, <b class="fname">VOP_GETPAGES</b>() might return less pages than requested. In that case, the variable pointed to by <span class="emph">count</span> will be updated.<p>
This function is primarily used by the page-fault handing mechanism.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">VOP_PUTPAGES</b>(<i class="farg">vp</i>, <i class="farg">offlo</i>, <i class="farg">offhi</i>, <i class="farg">flags</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Write modified (dirty) VM pages to file. The argument <i class="farg">vp</i> is the vnode to write the VM pages to. The vnode's vm object lock (<b class="var">v_uobj.vmobjlock</b>) must be held by the caller and will be released upon return. The arguments <i class="farg">offlo</i> and <i class="farg">offhi</i> specify the range of VM pages to write. In case <i class="farg">offhi</i> is given as 0, all pages at and after the start offset <i class="farg">offlo</i> belonging the vnode <i class="farg">vp</i> will be written. The argument <i class="farg">flags</i> controls the behavior of the routine and takes the vm pager's flags (<span class="define">PGO_ -prefixed</span>). If the operation is successful zero is returned, otherwise an appropriate error code is returned.<p>
The function is primarily used by the pageout handling mechanism and is commonly implemented indirectly by <b class="fname">genfs_putpages</b>() with the help of <b class="fname">VOP_STRATEGY</b>() and <b class="fname">VOP_BMAP</b>().</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">VOP_STRATEGY</b>(<i class="farg">vp</i>, <i class="farg">bp</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Read/write a file system buffer. The argument <i class="farg">vp</i> is the vnode to read/write to. The argument <i class="farg">bp</i> is the buffer to be read or written. <b class="fname">VOP_STRATEGY</b>() will either read or write data to the file depending on the value of <span class="emph">bp-&gt;b_flags</span>. If the operation is successful zero is returned, otherwise an appropriate error code is returned.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">VOP_BWRITE</b>(<i class="farg">vp</i>, <i class="farg">bp</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Write a file system buffer. The argument <i class="farg">vp</i> is the vnode to write to. The argument <i class="farg">bp</i> specifies the buffer to be written. If the operation is successful zero is returned, otherwise an appropriate error code is returned.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">VOP_GETEXTATTR</b>(<i class="farg">vp</i>, <i class="farg">attrnamespace</i>, <i class="farg">name</i>, <i class="farg">uio</i>, <i class="farg">size</i>, <i class="farg">cred</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Get an extended attribute. The argument <i class="farg">vp</i> is the locked vnode of the file or directory from which to retrieve the attribute. The argument <i class="farg">attrnamespace</i> specifies the extended attribute namespace. The argument <i class="farg">name</i> is a nul-terminated character string naming the attribute to retrieve. The argument <i class="farg">uio</i>, if not <span class="define">NULL</span>, specifies where the extended attribute value is to be written. The argument <i class="farg">size</i>, if not <span class="define">NULL</span>, will contain the number of bytes required to read all of the attribute data upon return. In most cases, <i class="farg">uio</i> will be <span class="define">NULL</span> when <i class="farg">size</i> is not, and vice versa. The argument <i class="farg">cred</i> specifies the user credentials to use when authorizing the request.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">VOP_SETEXTATTR</b>(<i class="farg">vp</i>, <i class="farg">attrnamespace</i>, <i class="farg">name</i>, <i class="farg">uio</i>, <i class="farg">cred</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Set an extended attribute. The argument <i class="farg">vp</i> is the locked vnode of the file or directory to which to store the attribute. The argument <i class="farg">namespace</i> specifies the extended attribute namespace. The argument <i class="farg">name</i> is a nul-terminated character string naming the attribute to store. The argument <i class="farg">uio</i> specifies the source of the extended attribute data. The argument <i class="farg">cred</i> specifies the user credentials to use when authorizing the request.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">VOP_LISTEXTATTR</b>(<i class="farg">vp</i>, <i class="farg">attrnamespace</i>, <i class="farg">uio</i>, <i class="farg">size</i>, <i class="farg">cred</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Retrieve the list of extended attributes. The argument <i class="farg">vp</i> is the locked vnode of the file or directory whose attributes are to be listed. The argument <i class="farg">attrnamespace</i> specifies the extended attribute namespace. The argument <i class="farg">uio</i>, if not <span class="define">NULL</span>, specifies where the extended attribute list is to be written. The argument <i class="farg">size</i>, if not <span class="define">NULL</span>, will contain the number of bytes required to read all of the attribute names upon return. In most cases, <i class="farg">uio</i> will be <span class="define">NULL</span> when <i class="farg">size</i> is not, and vice versa. The argument <i class="farg">cred</i> specifies the user credentials to use when authorizing the request.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">VOP_DELETEEXTATTR</b>(<i class="farg">vp</i>, <i class="farg">attrnamespace</i>, <i class="farg">name</i>, <i class="farg">cred</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Remove attribute <i class="farg">name</i> from file associated with <i class="farg">vp</i>. The argument <i class="farg">attrnamespace</i> specifies the extended attribute namespace. If full removal is not supported, the file system should return <span class="errno">EOPNOTSUPP</span> to allow the caller to zero out the value with <b class="fname">VOP_SETEXTATTR</b>().<p>
The vnode <i class="farg">vp</i> should be locked on entry and will remain locked on return.</dd>
</dl>
</div>
<div class="section">
<h1 id="x46494c4553">FILES</h1> <i class="file">src/sys/kern/vnode_if.src</i> contains the list of vnode functions, their definitions and an exact locking protocol.</div>
<div class="section">
<h1 id="x4552524f5253">ERRORS</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EACCES</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
Access for the specified operation is denied.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EDQUOT</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
Quota exceeded.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EINVAL</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
attempt to read from an illegal offset in the directory; unrecognized input</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EIO</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
a read error occurred while reading the directory or reading the contents of a symbolic link</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EJUSTRETURN</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
A CREATE or RENAME operation would be successful.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ENOATTR</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The requested attribute is not defined for this vnode.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ENOENT</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The component was not found in the directory.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ENOSPC</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The file system is full.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ENOTDIR</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The vnode does not represent a directory.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ENOTEMPTY</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
attempt to remove a directory which is not empty</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EPERM</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
an attempt was made to change an immutable file</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EROFS</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
the file system is read-only</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../9/extattr">extattr(9)</a>, <a class="link-man" href="../9/intro">intro(9)</a>, <a class="link-man" href="../9/namei">namei(9)</a>, <a class="link-man" href="../9/vattr">vattr(9)</a>, <a class="link-man" href="../9/vfs">vfs(9)</a>, <a class="link-man" href="../9/vfsops">vfsops(9)</a>, <a class="link-man" href="../9/vnode">vnode(9)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The vnode operations vector, its functions and the corresponding macros appeared in <span class="unix">4.3BSD</span>.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
July 21, 2014</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

