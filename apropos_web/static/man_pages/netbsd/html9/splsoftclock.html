<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="/static/man_pages/netbsd/style.css" type="text/css" media="all">
<title>
SPL(9)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
SPL(9)</td>
<td class="head-vol" align="center">
Kernel Developer's Manual</td>
<td class="head-rtitle" align="right">
SPL(9)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">spl</b>, <b class="name">spl0</b>, <b class="name">splhigh</b>, <b class="name">splvm</b>, <b class="name">splsched</b>, <b class="name">splsoftbio</b>, <b class="name">splsoftclock</b>, <b class="name">splsoftnet</b>, <b class="name">splsoftserial</b>, <b class="name">splx</b> &#8212; <span class="desc">modify system interrupt priority level</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">sys/intr.h</a>&gt;</b><p>
<i class="ftype">void</i><br>
<b class="fname">spl0</b>(<i class="farg" style="white-space:nowrap;">void</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">splhigh</b>(<i class="farg" style="white-space:nowrap;">void</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">splsched</b>(<i class="farg" style="white-space:nowrap;">void</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">splvm</b>(<i class="farg" style="white-space:nowrap;">void</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">splsoftbio</b>(<i class="farg" style="white-space:nowrap;">void</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">splsoftclock</b>(<i class="farg" style="white-space:nowrap;">void</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">splsoftserial</b>(<i class="farg" style="white-space:nowrap;">void</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">splsoftnet</b>(<i class="farg" style="white-space:nowrap;">void</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">splx</b>(<i class="farg" style="white-space:nowrap;">int s</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> These functions raise and lower the interrupt priority level. They are used by kernel code to block interrupts in critical sections, in order to protect data structures.<p>
In a multi-CPU system, these functions change the interrupt priority level on the local CPU only. In general, device drivers should not make use of these interfaces. To ensure correct synchronization, device drivers should use the <a class="link-man" href="../9/condvar">condvar(9)</a>, <a class="link-man" href="../9/mutex">mutex(9)</a>, and <a class="link-man" href="../9/rwlock">rwlock(9)</a> interfaces.<p>
Interrupt priorities are arranged in a strict hierarchy, although sometimes levels may be equivalent (overlap). The hierarchy means that raising the IPL to any level will block interrupts at that level, and at all lower levels. The hierarchy is used to minimize data loss due to interrupts not being serviced in a timely fashion.<p>
The levels may be divided into two groups: hard and soft. Hard interrupts are generated by hardware devices. Soft interrupts are a way of deferring hardware interrupts to do more expensive processing at a lower interrupt priority, and are explicitly scheduled by the higher-level interrupt handler. Software interrupts are further described by <a class="link-man" href="../9/softint">softint(9)</a>.<p>
Note that hard interrupt handlers do not possess process (thread) context and so it is not valid to use kernel facilities that may attempt to sleep from a hardware interrupt. For example, it is not possible to acquire a reader/writer lock from a hardware interrupt. Soft interrupt handlers possess limited process context and so may sleep briefly in order to acquire a reader/writer lock or adaptive mutex, but may not sleep for any other reason.<p>
In order of highest to lowest priority, the priority-raising functions along with their counterpart symbolic tags are:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">splhigh</b>(), <b class="fname">IPL_HIGH</b>()</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
<p>
Blocks all hard and soft interrupts, including the highest level I/O interrupts, such as interrupts from serial interfaces and the statistics clock (if any). It is also used for code that cannot tolerate any interrupts.<p>
Code running at this level may not (in general) directly access machine independent kernel services. For example, it is illegal to call the kernel <b class="fname">printf</b>() function or to try and allocate memory. The methods of synchronization available are: spin mutexes and scheduling a soft interrupt. Generally, all code run at this level must schedule additional processing to run in a software interrupt.<p>
Code with thread context running at this level must not use a kernel interface that may cause the current LWP to sleep, such as the <a class="link-man" href="../9/condvar">condvar(9)</a> interfaces.<p>
Interrupt handlers at this level cannot acquire the global kernel_lock and so must be coded to ensure correct synchronization on multiprocessor systems.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">splsched</b>(), <b class="fname">IPL_SCHED</b>()</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
<p>
Blocks all medium priority hardware interrupts, such as interrupts from audio devices, and the clock interrupt.<p>
Interrupt handlers running at this level endure the same restrictions as at IPL_HIGH, but may access scheduler interfaces, and so may awaken LWPs (light weight processes) using the <a class="link-man" href="../9/condvar">condvar(9)</a> interfaces, and may schedule callouts using the <a class="link-man" href="../9/callout">callout(9)</a> interfaces.<p>
Code with thread context running at this level may sleep via the <a class="link-man" href="../9/condvar">condvar(9)</a> interfaces, and may use other kernel facilities that could cause the current LWP to sleep.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">splvm</b>(), <b class="fname">IPL_VM</b>()</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
<p>
Blocks hard interrupts from &#8220;low&#8221; priority hardware interrupts, such as interrupts from network, block I/O and tty devices.<p>
Code running at this level endures the same restrictions as at IPL_SCHED, but may use the deprecated <a class="link-man" href="../9/malloc">malloc(9)</a> or endorsed <a class="link-man" href="../9/pool_cache">pool_cache(9)</a> interfaces to allocate memory.<p>
At the time of writing, the global <span class="define">kernel_lock</span> is automatically acquired for interrupts at this level, in order to support device drivers that do not provide their own multiprocessor synchronization. A future release of the system may allow the automatic acquisition of <span class="define">kernel_lock</span> to be disabled for individual interrupt handlers.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">splsoftserial</b>(), <b class="fname">IPL_SOFTSERIAL</b>()</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
<p>
Blocks soft interrupts at the IPL_SOFTSERIAL symbolic level.<p>
This is the first of the software levels. Soft interrupts at this level and lower may acquire reader/writer locks or adaptive mutexes.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">splsoftnet</b>(), <b class="fname">IPL_SOFTNET</b>()</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
<p>
Blocks soft interrupts at the IPL_SOFTNET symbolic level.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">splsoftbio</b>(), <b class="fname">IPL_SOFTBIO</b>()</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
<p>
Blocks soft interrupts at the IPL_SOFTBIO symbolic level.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">splsoftclock</b>(), <b class="fname">IPL_SOFTCLOCK</b>()</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
<p>
Blocks soft interrupts at the IPL_SOFTCLOCK symbolic level.<p>
This is the priority at which callbacks generated by the <a class="link-man" href="../9/callout">callout(9)</a> facility runs.</dd>
</dl>
<p>
One function lowers the system priority level:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">spl0</b>(), <b class="fname">IPL_NONE</b>()</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
<p>
Unblocks all interrupts. This should rarely be used directly; <b class="fname">splx</b>() should be used instead.</dd>
</dl>
<p>
The <b class="fname">splx</b>() function restores the system priority level to the one encoded in <i class="farg">s</i>, which must be a value previously returned by one of the other <b class="name">spl</b> functions.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../9/condvar">condvar(9)</a>, <a class="link-man" href="../9/i386/splraise">i386/splraise(9)</a>, <a class="link-man" href="../9/kpreempt">kpreempt(9)</a>, <a class="link-man" href="../9/mutex">mutex(9)</a>, <a class="link-man" href="../9/rwlock">rwlock(9)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> In <span class="unix">4.4BSD</span>, <b class="fname">splnet</b>() was used to block network software interrupts. Most device drivers used <b class="fname">splimp</b>() to block hardware interrupts. To avoid unnecessarily blocking other interrupts, in <span class="unix">NetBSD&#160;1.1</span> a new function was added that blocks only network hardware interrupts. For consistency with other <b class="name">spl</b> functions, the old <b class="fname">splnet</b>() function was renamed to <b class="fname">splsoftnet</b>(), and the new function was named <b class="fname">splnet</b>().<p>
Originally, <b class="fname">splsoftclock</b>() lowered the system priority level. During the <span class="unix">NetBSD&#160;1.5</span> development cycle, <b class="fname">spllowersoftclock</b>() was introduced and the semantics of <b class="fname">splsoftclock</b>() were changed.<p>
The <b class="fname">splimp</b>() call was removed from the kernel between <span class="unix">NetBSD&#160;1.5</span> and <span class="unix">NetBSD&#160;1.6</span>. The function of <b class="fname">splimp</b>() was replaced by <b class="fname">splvm</b>() and code which abused the semantics of <b class="fname">splimp</b>() was changed to not mix interrupt priority levels.<p>
Between <span class="unix">NetBSD&#160;4.0</span> and <span class="unix">NetBSD&#160;5.0</span>, the hardware levels were reduced in number and a strict hierarchy defined.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
February 16, 2010</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

