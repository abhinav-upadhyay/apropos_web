<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="/static/man_pages/netbsd/style.css" type="text/css" media="all">
<title>
ISA(9)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
ISA(9)</td>
<td class="head-vol" align="center">
Kernel Developer's Manual</td>
<td class="head-rtitle" align="right">
ISA(9)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">ISA</b>, <b class="name">isa_intr_alloc</b>, <b class="name">isa_intr_establish</b>, <b class="name">isa_intr_disestablish</b>, <b class="name">isa_intr_evcnt</b>, <b class="name">isa_dmamap_create</b>, <b class="name">isa_dmamap_destroy</b>, <b class="name">isa_dmamem_alloc</b>, <b class="name">isa_dmamem_free</b>, <b class="name">isa_dmamem_map</b>, <b class="name">isa_dmamem_unmap</b>, <b class="name">isa_malloc</b>, <b class="name">isa_free</b>, <b class="name">isa_dmastart</b>, <b class="name">isa_dmaabort</b>, <b class="name">isa_dmacount</b>, <b class="name">isa_dmadone</b>, <b class="name">isa_dmamaxsize</b>, <b class="name">isa_drq_alloc</b>, <b class="name">isa_drq_free</b>, <b class="name">isa_drq_isfree</b>, <b class="name">isa_dmacascade</b>, <b class="name">isa_mappage</b> &#8212; <span class="desc">Industry-standard Architecture</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">sys/bus.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">dev/isa/isareg.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">dev/isa/isavar.h</a>&gt;</b><p>
<i class="ftype">int</i><br>
<b class="fname">isa_intr_alloc</b>(<i class="farg" style="white-space:nowrap;">isa_chipset_tag_t ic</i>, <i class="farg" style="white-space:nowrap;">int mask</i>, <i class="farg" style="white-space:nowrap;">int type</i>, <i class="farg" style="white-space:nowrap;">int *irq</i>);<p>
<i class="ftype">const struct evcnt *</i><br>
<b class="fname">isa_intr_evcnt</b>(<i class="farg" style="white-space:nowrap;">isa_chipset_tag_t ic</i>, <i class="farg" style="white-space:nowrap;">int irq</i>);<p>
<i class="ftype">void *</i><br>
<b class="fname">isa_intr_establish</b>(<i class="farg" style="white-space:nowrap;">isa_chipset_tag_t ic</i>, <i class="farg" style="white-space:nowrap;">int irq</i>, <i class="farg" style="white-space:nowrap;">int type</i>, <i class="farg" style="white-space:nowrap;">int level</i>, <i class="farg" style="white-space:nowrap;">int (*handler)(void *)</i>, <i class="farg" style="white-space:nowrap;">void *arg</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">isa_intr_disestablish</b>(<i class="farg" style="white-space:nowrap;">isa_chipset_tag_t ic</i>, <i class="farg" style="white-space:nowrap;">void *ih</i>);<p>
<b class="includes">#include &lt;<a class="link-includes">dev/isa/isadmareg.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">dev/isa/isadmavar.h</a>&gt;</b><p>
<i class="ftype">int</i><br>
<b class="fname">isa_dmamap_create</b>(<i class="farg" style="white-space:nowrap;">isa_chipset_tag_t ic</i>, <i class="farg" style="white-space:nowrap;">int chan</i>, <i class="farg" style="white-space:nowrap;">bus_size_t size</i>, <i class="farg" style="white-space:nowrap;">int flags</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">isa_dmamap_destroy</b>(<i class="farg" style="white-space:nowrap;">isa_chipset_tag_t ic</i>, <i class="farg" style="white-space:nowrap;">int chan</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">isa_dmamem_alloc</b>(<i class="farg" style="white-space:nowrap;">isa_chipset_tag_t ic</i>, <i class="farg" style="white-space:nowrap;">int chan</i>, <i class="farg" style="white-space:nowrap;">bus_size_t size</i>, <i class="farg" style="white-space:nowrap;">bus_addr_t *addrp</i>, <i class="farg" style="white-space:nowrap;">int flags</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">isa_dmamem_free</b>(<i class="farg" style="white-space:nowrap;">isa_chipset_tag_t ic</i>, <i class="farg" style="white-space:nowrap;">int chan</i>, <i class="farg" style="white-space:nowrap;">bus_addr_t addr</i>, <i class="farg" style="white-space:nowrap;">bus_size_t size</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">isa_dmamem_map</b>(<i class="farg" style="white-space:nowrap;">isa_chipset_tag_t ic</i>, <i class="farg" style="white-space:nowrap;">int chan</i>, <i class="farg" style="white-space:nowrap;">bus_addr_t addr</i>, <i class="farg" style="white-space:nowrap;">bus_size_t size</i>, <i class="farg" style="white-space:nowrap;">void **kvap</i>, <i class="farg" style="white-space:nowrap;">int flags</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">isa_dmamem_unmap</b>(<i class="farg" style="white-space:nowrap;">isa_chipset_tag_t ic</i>, <i class="farg" style="white-space:nowrap;">int chan</i>, <i class="farg" style="white-space:nowrap;">void *kva</i>, <i class="farg" style="white-space:nowrap;">size_t size</i>);<p>
<i class="ftype">void *</i><br>
<b class="fname">isa_malloc</b>(<i class="farg" style="white-space:nowrap;">isa_chipset_tag_t ic</i>, <i class="farg" style="white-space:nowrap;">int chan</i>, <i class="farg" style="white-space:nowrap;">size_t size</i>, <i class="farg" style="white-space:nowrap;">int pool</i>, <i class="farg" style="white-space:nowrap;">int flags</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">isa_free</b>(<i class="farg" style="white-space:nowrap;">void *addrp</i>, <i class="farg" style="white-space:nowrap;">int pool</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">isa_dmastart</b>(<i class="farg" style="white-space:nowrap;">isa_chipset_tag_t ic</i>, <i class="farg" style="white-space:nowrap;">int chan</i>, <i class="farg" style="white-space:nowrap;">bus_addr_t addr</i>, <i class="farg" style="white-space:nowrap;">bus_size_t size</i>, <i class="farg" style="white-space:nowrap;">struct lwp *lwp</i>, <i class="farg" style="white-space:nowrap;">int flags</i>, <i class="farg" style="white-space:nowrap;">int bf</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">isa_dmaabort</b>(<i class="farg" style="white-space:nowrap;">isa_chipset_tag_t ic</i>, <i class="farg" style="white-space:nowrap;">int chan</i>);<p>
<i class="ftype">bus_size_t</i><br>
<b class="fname">isa_dmacount</b>(<i class="farg" style="white-space:nowrap;">isa_chipset_tag_t ic</i>, <i class="farg" style="white-space:nowrap;">int chan</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">isa_dmadone</b>(<i class="farg" style="white-space:nowrap;">isa_chipset_tag_t ic</i>, <i class="farg" style="white-space:nowrap;">int chan</i>);<p>
<i class="ftype">bus_size_t</i><br>
<b class="fname">isa_dmamaxsize</b>(<i class="farg" style="white-space:nowrap;">isa_chipset_tag_t ic</i>, <i class="farg" style="white-space:nowrap;">int chan</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">isa_drq_alloc</b>(<i class="farg" style="white-space:nowrap;">isa_chipset_tag_t ic</i>, <i class="farg" style="white-space:nowrap;">int chan</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">isa_drq_free</b>(<i class="farg" style="white-space:nowrap;">isa_chipset_tag_t ic</i>, <i class="farg" style="white-space:nowrap;">int chan</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">isa_drq_isfree</b>(<i class="farg" style="white-space:nowrap;">isa_chipset_tag_t ic</i>, <i class="farg" style="white-space:nowrap;">int chan</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">isa_dmacascade</b>(<i class="farg" style="white-space:nowrap;">isa_chipset_tag_t ic</i>, <i class="farg" style="white-space:nowrap;">int chan</i>);<p>
<i class="ftype">paddr_t</i><br>
<b class="fname">isa_mappage</b>(<i class="farg" style="white-space:nowrap;">void *mem</i>, <i class="farg" style="white-space:nowrap;">off_t offset</i>, <i class="farg" style="white-space:nowrap;">int prot</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The machine-independent <b class="name">ISA</b> subsystem provides support for the ISA bus.<p>
The ISA bus was introduced on the IBM PC/AT. It is an extension to the original bus found on the original IBM PC. The ISA bus is essentially the host bus of the Intel 80286 processor, however the widespread acceptance of the bus as a de facto standard has seen it appear on systems without Intel processors.<p>
The ISA bus has a 16-bit data bus, a 24-bit memory address bus, a 16-bit I/O address bus, and operates at 8MHz. It provides 15 interrupt lines and 8 DMA channels supporting DMA transfers of 64KB or 128KB transfers depending on the width of the channel being used. Historically, some devices only decoded the 10 lowest bits of the I/O address bus, preventing use of the full 16-bit address space.<p>
On newer machines, the ISA bus is no longer connected directly to the host bus, and is usually connected via a PCI-ISA bridge. Either way, the bus looks the same to the device driver.</div>
<div class="section">
<h1 id="x44415441205459504553">DATA TYPES</h1> Drivers for devices attached to the <b class="name">ISA</b> bus will make use of the following data types:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">isa_chipset_tag_t</i></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Chipset tag for the ISA bus.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">struct isa_attach_args</i></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Location hints for devices are recorded in this structure. It contains the following members:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
	bus_space_tag_t ia_iot;		/* isa i/o space tag */ 
	bus_space_tag_t ia_memt;	/* isa mem space tag */ 
	bus_dma_tag_t ia_dmat;		/* DMA tag */ 
	isa_chipset_tag_t ia_ic; 
	int ia_iobase;			/* base i/o address */ 
	int ia_iosize;			/* span of ports used */ 
	int ia_maddr;			/* physical mem addr */ 
	u_int ia_msize;			/* size of memory */ 
	int ia_irq;			/* interrupt request */ 
	int ia_drq;			/* DMA request */ 
	int ia_drq2;			/* second DMA request */ 
	void *ia_aux;			/* driver specific */</pre>
</dd>
</dl>
</div>
<div class="section">
<h1 id="x46554e4354494f4e53">FUNCTIONS</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">isa_intr_alloc</b>(<i class="farg">ic</i>, <i class="farg">mask</i>, <i class="farg">type</i>, <i class="farg">irq</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
This function is generally not required by device drivers. It is used by bridges attaching other busses to the ISA bus.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">isa_intr_evcnt</b>(<i class="farg">ic</i>, <i class="farg">irq</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Returns the event counter associated with interrupt line <i class="farg">irq</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">isa_intr_establish</b>(<i class="farg">ic</i>, <i class="farg">irq</i>, <i class="farg">type</i>, <i class="farg">level</i>, <i class="farg">handler</i>, <i class="farg">arg</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
To establish an ISA interrupt handler, a driver calls <b class="fname">isa_intr_establish</b>() with the interrupt number <i class="farg">irq</i>, type <i class="farg">type</i>, and level <i class="farg">level</i>. When the interrupt occurs the function <i class="farg">handler</i> is called with argument <i class="farg">arg</i>. Valid values for <i class="farg">type</i> are:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
IST_NONE</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Reserve interrupt, but don't actually establish.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
IST_EDGE</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Edge-triggered interrupt.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
IST_LEVEL</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Level-triggered interrupt.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
IST_PULSE</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Pulse-triggered interrupt.</dd>
</dl>
<p>
<b class="fname">isa_intr_establish</b>() returns an opaque handle to an event descriptor if it succeeds, and returns NULL on failure.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">isa_intr_disestablish</b>(<i class="farg">ic</i>, <i class="farg">ih</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Dis-establish the interrupt handler with handle <i class="farg">ih</i>. The handle was returned from <b class="fname">isa_intr_establish</b>().</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">isa_drq_alloc</b>(<i class="farg">ic</i>, <i class="farg">chan</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Reserves the DMA channel <i class="farg">chan</i> for future use. Normally, this call precedes an <b class="fname">isa_dmamap_create</b>() call. It is an error to start DMA on a channel that has not been reserved with <b class="fname">isa_drq_alloc</b>().</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">isa_drq_free</b>(<i class="farg">ic</i>, <i class="farg">chan</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Marks the DMA channel <i class="farg">chan</i> as available again.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">isa_dmamap_create</b>(<i class="farg">ic</i>, <i class="farg">chan</i>, <i class="farg">size</i>, <i class="farg">flags</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Creates a DMA map for channel <i class="farg">chan</i>. It is initialised to accept maximum DMA transfers of size <i class="farg">size</i>. Valid values for the <i class="farg">flags</i> argument are the same as for <b class="fname">bus_dmamap_create</b>() (see <a class="link-man" href="../9/bus_dma">bus_dma(9)</a>). This function returns zero on success or an error value on failure.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">isa_dmamap_destroy</b>(<i class="farg">ic</i>, <i class="farg">chan</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Destroy the DMA map for DMA channel <i class="farg">chan</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">isa_dmamem_alloc</b>(<i class="farg">ic</i>, <i class="farg">chan</i>, <i class="farg">size</i>, <i class="farg">addrp</i>, <i class="farg">flags</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Allocate DMA-safe memory of size <i class="farg">size</i> for channel <i class="farg">chan</i>. Valid values for the <i class="farg">flags</i> argument are the same as for <b class="fname">bus_dmamem_alloc</b>() (see <a class="link-man" href="../9/bus_dma">bus_dma(9)</a>). The bus-address of the memory is returned in <i class="farg">addrp</i>. This function returns zero on success or an error value on failure.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">isa_dmamem_free</b>(<i class="farg">ic</i>, <i class="farg">chan</i>, <i class="farg">addr</i>, <i class="farg">size</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Frees memory previously allocated by <b class="fname">isa_dmamem_alloc</b>() for channel <i class="farg">chan</i>. The bus-address and size of the memory are specified by <i class="farg">addr</i> and <i class="farg">size</i> respectively.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">isa_dmamem_map</b>(<i class="farg">ic</i>, <i class="farg">chan</i>, <i class="farg">addr</i>, <i class="farg">size</i>, <i class="farg">kvap</i>, <i class="farg">flags</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Maps DMA-safe memory (allocated with <b class="fname">isa_dmamem_alloc</b>()) specified by bus-address <i class="farg">addr</i> and of size <i class="farg">size</i> into kernel virtual address space for DMA channel <i class="farg">chan</i>. Valid values for the <i class="farg">flags</i> argument are the same as for <b class="fname">bus_dmamem_map</b>() (see <a class="link-man" href="../9/bus_dma">bus_dma(9)</a>). The kernel virtual address is returned in <i class="farg">kvap</i>. This function returns zero on success or an error value on failure.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">isa_dmamem_unmap</b>(<i class="farg">ic</i>, <i class="farg">chan</i>, <i class="farg">kva</i>, <i class="farg">size</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Unmaps memory (previously mapped with <b class="fname">isa_dmamem_map</b>()) of size <i class="farg">size</i> for channel <i class="farg">chan</i>. The kernel virtual address space used by the mapping is freed.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">isa_malloc</b>(<i class="farg">ic</i>, <i class="farg">chan</i>, <i class="farg">size</i>, <i class="farg">pool</i>, <i class="farg">flags</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
This function is a shortcut for allocating and mapping DMA-safe memory in a single step. The arguments correspond with the arguments to <b class="fname">isa_dmamem_alloc</b>() and <b class="fname">isa_dmamem_map</b>(). The argument <i class="farg">pool</i> is a pool to record the memory allocation. This function returns a pointer to the DMA-safe memory.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">isa_free</b>(<i class="farg">addrp</i>, <i class="farg">pool</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
This function is a shortcut for unmapping and deallocating DMA-safe memory in a single step. It replaces <b class="fname">isa_dmamem_unmap</b>() and <b class="fname">isa_dmamem_free</b>(). The argument <i class="farg">addrp</i> is the pointer to the DMA-safe memory returned by <b class="fname">isa_malloc</b>(). The argument <i class="farg">pool</i> is the same as the value passed to <b class="fname">isa_malloc</b>().</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">isa_dmastart</b>(<i class="farg">ic</i>, <i class="farg">chan</i>, <i class="farg">addr</i>, <i class="farg">size</i>, <i class="farg">lwp</i>, <i class="farg">flags</i>, <i class="farg">bf</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Load DMA memory specified by address <i class="farg">addr</i> of size <i class="farg">size</i> into the DMA controller at channel <i class="farg">chan</i> and set it in motion. The argument <i class="farg">lwp</i> is used to indicate the address space in which the buffer is located. If NULL, the buffer is assumed to be in kernel space. Otherwise, the buffer is assumed to be in lwp <i class="farg">lwp 's</i> address space. The argument <i class="farg">flags</i> describes the type of ISA DMA. Valid values are:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
DMAMODE_WRITE</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
DMA transfer from host to device.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
DMAMODE_READ</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
DMA transfer to host from device.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
DMAMODE_SINGLE</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Transfer buffer once and stop.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
DMAMODE_DEMAND</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Demand mode.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
DMAMODE_LOOP</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Transfer buffer continuously in loop until notified to stop.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
DMAMODE_LOOPDEMAND</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Transfer buffer continuously in loop and demand mode.</dd>
</dl>
<p>
The argument <i class="farg">bf</i> is the bus-space flags. Valid values are the same as for <b class="fname">bus_dmamap_load</b>() (see <a class="link-man" href="../9/bus_dma">bus_dma(9)</a>).</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">isa_dmaabort</b>(<i class="farg">ic</i>, <i class="farg">chan</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Abort a DMA transfer on channel <i class="farg">chan</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">isa_dmacount</b>(<i class="farg">ic</i>, <i class="farg">chan</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Returns the offset in the DMA memory of the current DMA transfer on channel <i class="farg">chan</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">isa_dmadone</b>(<i class="farg">ic</i>, <i class="farg">chan</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Unloads the DMA memory on channel <i class="farg">chan</i> after a DMA transfer has completed.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">isa_dmamaxsize</b>(<i class="farg">ic</i>, <i class="farg">chan</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Returns the maximum allowable DMA transfer size for channel <i class="farg">chan</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">isa_drq_isfree</b>(<i class="farg">ic</i>, <i class="farg">chan</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
If the <i class="farg">ia_drq</i> or <i class="farg">ia_drq2</i> members of <i class="farg">struct isa_attach_args</i> are wildcarded, then the driver is expected to probe the hardware for valid DMA channels. In this case, the driver can check to see if the hardware-supported DMA channel <i class="farg">chan</i> is available for use.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">isa_dmacascade</b>(<i class="farg">ic</i>, <i class="farg">chan</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Programs the 8237 DMA controller channel <i class="farg">chan</i> to accept external DMA control by the device hardware.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">isa_mappage</b>(<i class="farg">mem</i>, <i class="farg">offset</i>, <i class="farg">prot</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Provides support for user <a class="link-man" href="../2/mmap">mmap(2)</a>'ing of DMA-safe memory.</dd>
</dl>
</div>
<div class="section">
<h1 id="x4155544f434f4e46494755524154494f4e">AUTOCONFIGURATION</h1> The ISA bus is an indirect-connection bus. During autoconfiguration each driver is required to probe the bus for the presence of a device. An ISA driver will receive a pointer to <i class="farg">struct isa_attach_args</i> hinting at "locations" on the ISA bus where the device may be located. They should use the <span class="emph">ia_iobase</span>, <span class="emph">ia_iosize</span>, <span class="emph">ia_maddr</span>, and <span class="emph">ia_msize</span> members. Not all of these hints will be necessary; locators may be wildcarded with IOBASEUNK and MADDRUNK for <span class="emph">ia_iobase</span> and <span class="emph">ia_maddr</span> respectively. If a driver can probe the device for configuration information at default locations, it may update the members of <i class="farg">struct isa_attach_args</i>. The IRQ and DMA locators can also be wildcarded with IRQUNK and DRQUNK respectively.<p>
During the driver attach step, the I/O and memory address spaces should be mapped (see <a class="link-man" href="../9/bus_space">bus_space(9)</a>).</div>
<div class="section">
<h1 id="x444d4120535550504f5254">DMA SUPPORT</h1> Extensive DMA facilities are provided for the ISA bus. A driver can use up to two DMA channels simultaneously. The DMA channels allocated during autoconfiguration are passed to the driver during the driver attach using the <i class="farg">ia_drq</i> and <i class="farg">ia_drq2</i> members of <i class="farg">struct isa_attach_args</i>.<p>
Before allocating resources for DMA transfers on the ISA bus, a driver should check the maximum allowable DMA transfer size for the DMA channel using <b class="fname">isa_dmamaxsize</b>().<p>
A DMA map should be created first using <b class="fname">isa_dmamap_create</b>(). A DMA map describes how DMA memory is loaded into the DMA controllers. Only DMA-safe memory can be used for DMA transfers. DMA-safe memory is allocated using <b class="fname">isa_dmamem_alloc</b>(). The memory allocated by <b class="fname">isa_dmamem_alloc</b>() must now be mapped into kernel virtual address space by <b class="fname">isa_dmamem_map</b>() so that it can be accessed by the driver.<p>
For a DMA transfer from the host to the device, the driver will fill the DMA memory with the data to be transferred. The DMA-transfer of the memory is started using <b class="fname">isa_dmastart</b>() with <i class="farg">flags</i> containing DMAMODE_WRITE. When the DMA transfer is completed, a call to <b class="fname">isa_dmadone</b>() cleans up the DMA transfer by unloading the memory from the controller.<p>
For a DMA transfer from the device to the host, the DMA-transfer is started using <b class="fname">isa_dmastart</b>() with <i class="farg">flags</i> containing DMAMODE_READ. When the DMA transfer is completed, a call to <b class="fname">isa_dmadone</b>() cleans up the DMA transfer by unloading the memory from the controller. The memory can now be access by the driver.<p>
When the DMA resources are no longer required they should be released using <b class="fname">isa_dmamem_unmap</b>(), <b class="fname">isa_dmamem_free</b>() and <b class="fname">isa_dmamap_destroy</b>().</div>
<div class="section">
<h1 id="x434f4445205245464552454e434553">CODE REFERENCES</h1> The ISA subsystem itself is implemented within the files <i class="file">sys/dev/isa/isa.c</i> and <i class="file">sys/dev/isa/isadma.c</i>.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../4/isa">isa(4)</a>, <a class="link-man" href="../9/autoconf">autoconf(9)</a>, <a class="link-man" href="../9/bus_dma">bus_dma(9)</a>, <a class="link-man" href="../9/bus_space">bus_space(9)</a>, <a class="link-man" href="../9/driver">driver(9)</a>, <a class="link-man" href="../9/isapnp">isapnp(9)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The machine-independent <b class="name">ISA</b> subsystem appeared in <span class="unix">NetBSD&#160;1.2</span>.</div>
<div class="section">
<h1 id="x42554753">BUGS</h1> The previous behaviour of <b class="fname">isa_intr_establish</b>() was to invoke <b class="fname">panic</b>() on failure. <b class="fname">isa_intr_establish</b>() now returns NULL on failure. Some old drivers written for the former behaviour discard the return value.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
January 29, 2006</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

