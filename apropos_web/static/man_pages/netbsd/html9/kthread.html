<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
KTHREAD(9)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
KTHREAD(9)</td>
<td class="head-vol" align="center">
Kernel Developer's Manual</td>
<td class="head-rtitle" align="right">
KTHREAD(9)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">kthread_create</b>, <b class="name">kthread_exit</b>, <b class="name">kthread_join</b> &#8212; <span class="desc">kernel threads</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">sys/kthread.h</a>&gt;</b><p>
<i class="ftype">int</i><br>
<b class="fname">kthread_create</b>(<i class="farg" style="white-space:nowrap;">pri_t pri</i>, <i class="farg" style="white-space:nowrap;">int flags</i>, <i class="farg" style="white-space:nowrap;">struct cpu_info *ci</i>, <i class="farg" style="white-space:nowrap;">void (*func)(void *)</i>, <i class="farg" style="white-space:nowrap;">void *arg</i>, <i class="farg" style="white-space:nowrap;">lwp_t **newlp</i>, <i class="farg" style="white-space:nowrap;">const char *fmt</i>, <i class="farg" style="white-space:nowrap;">...</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">kthread_exit</b>(<i class="farg" style="white-space:nowrap;">int ecode</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">kthread_join</b>(<i class="farg" style="white-space:nowrap;">lwp_t *l</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> Kernel threads are light-weight processes which execute entirely within the kernel.<p>
Any process can request the creation of a new kernel thread. Kernel threads are not swapped out during memory congestion. The VM space and limits are shared with proc0 (usually swapper).</div>
<div class="section">
<h1 id="x46554e4354494f4e53">FUNCTIONS</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">kthread_create</b>(<i class="farg">pri</i>, <i class="farg">flags</i>, <i class="farg">ci</i>, <i class="farg">func</i>, <i class="farg">arg</i>, <i class="farg">newlp</i>, <i class="farg">fmt</i>, <i class="farg">...</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Create a kernel thread. The arguments are as follows.<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">pri</i></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Priority level for the thread. If no priority level is desired specify <span class="define">PRI_NONE</span>, causing <b class="fname">kthread_create</b>() to select the default priority level.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">flags</i></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Flags that can be logically ORed together to alter the thread's behaviour.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">ci</i></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
If non-<span class="define">NULL</span>, the thread will be created bound to the CPU specified by <i class="farg">ci</i>, meaning that it will only ever execute on that CPU. By default, the threads are free to execute on any CPU in the system.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">func</i></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
A function to be called when the thread begins executing. This function must not return. If the thread runs to completion, it must call <b class="fname">kthread_exit</b>() to properly terminate itself.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">arg</i></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
An argument to be passed to <b class="fname">func</b>(). May be <span class="define">NULL</span> if not required.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">newlp</i></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
A pointer to receive the new LWP structure for the kernel thread. May be <span class="define">NULL</span>, unless <span class="define">KTHREAD_MUSTJOIN</span> is specified in <i class="farg">flags</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">fmt</i></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
A string containing format information used to display the kernel thread name. Must not be <span class="define">NULL</span>.</dd>
</dl>
<p>
The following <b class="var">flags</b> are defined.<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">KTHREAD_IDLE</span></dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
Causes the thread to be created in the <span class="define">LSIDL</span> (idle) state. By default, the threads are created in the <span class="define">LSRUN</span> (runnable) state, meaning they will begin execution shortly after creation.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">KTHREAD_MPSAFE</span></dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
Specifies that the thread does its own locking and so is multiprocessor safe. If not specified, the global kernel lock will be held whenever the thread is running (unless explicitly dropped by the thread).</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">KTHREAD_INTR</span></dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
Specifies that the thread services device interrupts. This flag is intended for kernel internal use and should not normally be specified.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">KTHREAD_TS</span></dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
Causes the kthread to be created in the <span class="define">SCHED_OTHER</span> class (timeshared). The thread's priority will be dynamically adjusted by the scheduler. Increased activity by the kthread will cause its priority to fall; decreased activity will cause its priority to rise. By default, kthreads are created in the <span class="define">SCHED_RR</span> class, with a fixed priority specified by <i class="arg">pri</i>. Threads in the <span class="define">SCHED_RR</span> class do not have their priority dynamically adjusted by the scheduler.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">KTHREAD_MUSTJOIN</span></dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
Indicates that created kthread must be joined. In such case <b class="fname">kthread_exit</b>() will wait until <b class="fname">kthread_join</b>() will be called.</dd>
</dl>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">kthread_exit</b>(<i class="farg">ecode</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Exit from a kernel thread. Must only be called by a kernel thread.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">kthread_join</b>(<i class="farg">l</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Suspend execution of calling thread until the target kthread terminates. Conceptually the function can be compared to the user space <a class="link-man" href="../3/pthread_join">pthread_join(3)</a>, however it must be called only once for kernel thread which was created using the <span class="define">KTHREAD_MUSTJOIN</span> flag and would wait on <i class="farg">kthread_exit</i>.</dd>
</dl>
</div>
<div class="section">
<h1 id="x52455455524e2056414c554553">RETURN VALUES</h1> Upon successful completion, <b class="fname">kthread_create</b>() returns 0. Otherwise, the following error values are returned:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EAGAIN</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
The limit on the total number of system processes would be exceeded.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EAGAIN</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
The limit <span class="define">RLIMIT_NPROC</span> on the total number of processes under execution by this user id would be exceeded.</dd>
</dl>
</div>
<div class="section">
<h1 id="x434f4445205245464552454e434553">CODE REFERENCES</h1> The kthread framework itself is implemented within the file <i class="file">sys/kern/kern_kthread.c</i>. Data structures and function prototypes for the framework are located in <i class="file">sys/sys/kthread.h</i>.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../9/condvar">condvar(9)</a>, <a class="link-man" href="../9/driver">driver(9)</a>, <a class="link-man" href="../9/softint">softint(9)</a>, <a class="link-man" href="../9/workqueue">workqueue(9)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The kthread framework appeared in <span class="unix">NetBSD&#160;1.4</span>.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
April 21, 2015</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

