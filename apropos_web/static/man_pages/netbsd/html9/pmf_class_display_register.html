<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
PMF(9)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
PMF(9)</td>
<td class="head-vol" align="center">
Kernel Developer's Manual</td>
<td class="head-rtitle" align="right">
PMF(9)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">PMF</b>, <b class="name">pmf_device_register</b>, <b class="name">pmf_device_register1</b>, <b class="name">pmf_device_deregister</b>, <b class="name">pmf_device_suspend</b>, <b class="name">pmf_device_resume</b>, <b class="name">pmf_device_recursive_suspend</b>, <b class="name">pmf_device_recursive_resume</b>, <b class="name">pmf_device_resume_subtree</b>, <b class="name">pmf_class_network_register</b>, <b class="name">pmf_class_input_register</b>, <b class="name">pmf_class_display_register</b>, <b class="name">pmf_system_suspend</b>, <b class="name">pmf_system_resume</b>, <b class="name">pmf_system_shutdown</b>, <b class="name">pmf_event_register</b>, <b class="name">pmf_event_deregister</b>, <b class="name">pmf_event_inject</b>, <b class="name">pmf_set_platform</b>, <b class="name">pmf_get_platform</b> &#8212; <span class="desc">power management and inter-driver messaging framework</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">sys/device.h</a>&gt;</b><p>
<i class="ftype">bool</i><br>
<b class="fname">pmf_device_register</b>(<i class="farg" style="white-space:nowrap;">device_t dev</i>, <i class="farg" style="white-space:nowrap;">bool (*suspend)(device_t dev, const pmf_qual_t *qual)</i>, <i class="farg" style="white-space:nowrap;">bool (*resume)(device_t dev, const pmf_qual_t *qual)</i>);<p>
<i class="ftype">bool</i><br>
<b class="fname">pmf_device_register1</b>(<i class="farg" style="white-space:nowrap;">device_t dev</i>, <i class="farg" style="white-space:nowrap;">bool (*suspend)(device_t dev, const pmf_qual_t *qual)</i>, <i class="farg" style="white-space:nowrap;">bool (*resume)(device_t dev, const pmf_qual_t *qual)</i>, <i class="farg" style="white-space:nowrap;">bool (*shutdown)(device_t dev, int how)</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">pmf_device_deregister</b>(<i class="farg" style="white-space:nowrap;">device_t dev</i>);<p>
<i class="ftype">bool</i><br>
<b class="fname">pmf_device_suspend</b>(<i class="farg" style="white-space:nowrap;">device_t dev</i>, <i class="farg" style="white-space:nowrap;">const pmf_qual_t *qual</i>);<p>
<i class="ftype">bool</i><br>
<b class="fname">pmf_device_resume</b>(<i class="farg" style="white-space:nowrap;">device_t dev</i>, <i class="farg" style="white-space:nowrap;">const pmf_qual_t *qual</i>);<p>
<i class="ftype">bool</i><br>
<b class="fname">pmf_device_recursive_suspend</b>(<i class="farg" style="white-space:nowrap;">device_t dev</i>, <i class="farg" style="white-space:nowrap;">const pmf_qual_t *qual</i>);<p>
<i class="ftype">bool</i><br>
<b class="fname">pmf_device_recursive_resume</b>(<i class="farg" style="white-space:nowrap;">device_t dev</i>, <i class="farg" style="white-space:nowrap;">const pmf_qual_t *qual</i>);<p>
<i class="ftype">bool</i><br>
<b class="fname">pmf_device_subtree_resume</b>(<i class="farg" style="white-space:nowrap;">device_t dev</i>, <i class="farg" style="white-space:nowrap;">const pmf_qual_t *qual</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">pmf_class_network_register</b>(<i class="farg" style="white-space:nowrap;">device_t dev</i>, <i class="farg" style="white-space:nowrap;">struct ifnet *ifp</i>);<p>
<i class="ftype">bool</i><br>
<b class="fname">pmf_class_input_register</b>(<i class="farg" style="white-space:nowrap;">device_t dev</i>);<p>
<i class="ftype">bool</i><br>
<b class="fname">pmf_class_display_register</b>(<i class="farg" style="white-space:nowrap;">device_t dev</i>);<p>
<i class="ftype">bool</i><br>
<b class="fname">pmf_system_suspend</b>(<i class="farg" style="white-space:nowrap;">const pmf_qual_t *qual</i>);<p>
<i class="ftype">bool</i><br>
<b class="fname">pmf_system_resume</b>(<i class="farg" style="white-space:nowrap;">const pmf_qual_t *qual</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">pmf_system_shutdown</b>(<i class="farg" style="white-space:nowrap;">int</i>);<p>
<i class="ftype">bool</i><br>
<b class="fname">pmf_event_register</b>(<i class="farg" style="white-space:nowrap;">device_t dev</i>, <i class="farg" style="white-space:nowrap;">pmf_generic_event_t ev</i>, <i class="farg" style="white-space:nowrap;">void (*handler)(device_t dev)</i>, <i class="farg" style="white-space:nowrap;">bool global</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">pmf_event_deregister</b>(<i class="farg" style="white-space:nowrap;">device_t dev</i>, <i class="farg" style="white-space:nowrap;">pmf_generic_event_t ev</i>, <i class="farg" style="white-space:nowrap;">void (*handler)(device_t dev)</i>, <i class="farg" style="white-space:nowrap;">bool global</i>);<p>
<i class="ftype">bool</i><br>
<b class="fname">pmf_event_inject</b>(<i class="farg" style="white-space:nowrap;">device_t dev</i>, <i class="farg" style="white-space:nowrap;">pmf_generic_event_t ev</i>);<p>
<i class="ftype">bool</i><br>
<b class="fname">pmf_set_platform</b>(<i class="farg" style="white-space:nowrap;">const char *key</i>, <i class="farg" style="white-space:nowrap;">const char *value</i>);<p>
<i class="ftype">const char *</i><br>
<b class="fname">pmf_get_platform</b>(<i class="farg" style="white-space:nowrap;">const char *key</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The machine-independent <b class="name">PMF</b> framework provides power management and inter-driver messaging support for device drivers.</div>
<div class="section">
<h1 id="x44415441205459504553">DATA TYPES</h1> Drivers for devices implementing <b class="name">PMF</b> may make use of the following data type:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">pmf_qual_t</i></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
An opaque aggregate of qualifications on a <b class="name">PMF</b> suspend or resume call.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">pmf_generic_event_t</i></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
A device driver can register as a listener for specific events, or inject events into the message queue. The following message types are defined:<ul style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-item">
<li class="list-item" style="margin-top: 0.00em;">
<span class="define">PMFE_DISPLAY_ON</span></li>
<li class="list-item" style="margin-top: 0.00em;">
<span class="define">PMFE_DISPLAY_REDUCED</span></li>
<li class="list-item" style="margin-top: 0.00em;">
<span class="define">PMFE_DISPLAY_STANDBY</span></li>
<li class="list-item" style="margin-top: 0.00em;">
<span class="define">PMFE_DISPLAY_SUSPEND</span></li>
<li class="list-item" style="margin-top: 0.00em;">
<span class="define">PMFE_DISPLAY_OFF</span></li>
<li class="list-item" style="margin-top: 0.00em;">
<span class="define">PMFE_DISPLAY_BRIGHTNESS_UP</span></li>
<li class="list-item" style="margin-top: 0.00em;">
<span class="define">PMFE_DISPLAY_BRIGHTNESS_DOWN</span></li>
<li class="list-item" style="margin-top: 0.00em;">
<span class="define">PMFE_AUDIO_VOLUME_UP</span></li>
<li class="list-item" style="margin-top: 0.00em;">
<span class="define">PMFE_AUDIO_VOLUME_DOWN</span></li>
<li class="list-item" style="margin-top: 0.00em;">
<span class="define">PMFE_AUDIO_VOLUME_TOGGLE</span></li>
<li class="list-item" style="margin-top: 0.00em;">
<span class="define">PMFE_CHASSIS_LID_CLOSE</span></li>
<li class="list-item" style="margin-top: 0.00em;">
<span class="define">PMFE_CHASSIS_LID_OPEN</span></li>
</ul>
</dd>
</dl>
</div>
<div class="section">
<h1 id="x46554e4354494f4e53">FUNCTIONS</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">pmf_device_register</b>(<i class="farg">dev</i>, <i class="farg">suspend</i>, <i class="farg">resume</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Register a device with the power management framework. The <i class="farg">suspend</i> and <i class="farg">resume</i> functions are passed <i class="farg">dev</i> and a <i class="farg">pmf_qual_t</i>, and will be called when the system state changes; they should return <span class="define">true</span> on success and <span class="define">false</span> on failure. If either <i class="farg">suspend</i> or <i class="farg">resume</i> is <span class="define">NULL</span> then it is assumed that device state does not need to be captured and resumed on a power transition. Bus and class-level power management will still be performed. Returns <span class="define">false</span> if there was an error.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">pmf_device_register1</b>(<i class="farg">dev</i>, <i class="farg">suspend</i>, <i class="farg">resume</i>, <i class="farg">shutdown</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Like <b class="fname">pmf_device_register</b>(), but additionally registers a shutdown handler. During system shutdown, <b class="fname">pmf_system_shutdown</b>() calls <i class="farg">shutdown</i> on <i class="farg">dev</i> with the <a class="link-man" href="../html2/reboot.html">reboot(2)</a> &#8220;howto&#8221; in the second argument. <i class="farg">shutdown</i> should return <span class="define">true</span> on success and <span class="define">false</span> on failure.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">pmf_device_deregister</b>(<i class="farg">dev</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Deregister a device with the power management framework.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">pmf_device_suspend</b>(<i class="farg">dev</i>, <i class="farg">qual</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Suspend a device by first calling the class suspend handler, followed by the driver suspend handler, and finally the bus suspend handler.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">pmf_device_resume</b>(<i class="farg">dev</i>, <i class="farg">qual</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Resume a device by first calling the bus resume handler, followed by the driver resume handler, and finally the class resume handler.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">pmf_device_recursive_suspend</b>(<i class="farg">dev</i>, <i class="farg">qual</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
As <b class="fname">pmf_device_suspend</b>(), but ensures that all child devices of <i class="farg">dev</i> are suspended.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">pmf_device_recursive_resume</b>(<i class="farg">dev</i>, <i class="farg">qual</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
As <b class="fname">pmf_device_resume</b>(), but ensures that all parent devices of <i class="farg">dev</i> are resumed.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">pmf_device_subtree_resume</b>(<i class="farg">dev</i>, <i class="farg">qual</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
As <b class="fname">pmf_device_resume</b>(), but ensures that all child devices of <i class="farg">dev</i> are resumed.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">pmf_class_network_register</b>(<i class="farg">dev</i>, <i class="farg">ifp</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Register a device with the power management framework as a network-class device.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">pmf_class_input_register</b>(<i class="farg">dev</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Register a device with the power management framework as an input-class device.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">pmf_class_display_register</b>(<i class="farg">dev</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Register a device with the power management framework as a display-class device.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">pmf_system_suspend</b>(<i class="farg">qual</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Suspend all attached devices. Devices are suspended by traversing the autoconfiguration tree beginning with the leaf nodes. This function will fail if any attached drivers do not support the power management framework.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">pmf_system_resume</b>(<i class="farg">qual</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Resume all attached devices. Devices are resumed by traversing the autoconfiguration tree beginning with devices that do not have a parent. This function will fail if any attached drivers do not support the power management framework.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">pmf_system_shutdown</b>(<i class="farg">int</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Shutdown all attached devices. Devices are shut down by traversing the autoconfiguration tree beginning with the leaf nodes. The integer argument is passed to the driver shutdown functions. It should contain the <a class="link-man" href="../html2/reboot.html">reboot(2)</a> &#8220;howto&#8221; argument. This function ignores the presence of attached drivers that do not support the power management framework.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">pmf_event_register</b>(<i class="farg">dev</i>, <i class="farg">ev</i>, <i class="farg">handler</i>, <i class="farg">global</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Register the callback <i class="farg">handler</i> to be called whenever an <i class="farg">ev</i> event is triggered. If <i class="farg">global</i> is <span class="define">true</span>, <i class="farg">handler</i> accepts anonymous events from <b class="fname">pmf_event_inject</b>().</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">pmf_event_deregister</b>(<i class="farg">dev</i>, <i class="farg">ev</i>, <i class="farg">handler</i>, <i class="farg">global</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Deregister the callback previously registered with <b class="fname">pmf_event_register</b>().</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">pmf_event_inject</b>(<i class="farg">dev</i>, <i class="farg">ev</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Inject an inter-driver message into the message queue. If <i class="farg">dev</i> is <span class="define">NULL</span>, the event is considered to be anonymous and one or more drivers may handle this event, otherwise the event is delivered directly to the callback registered by <i class="farg">dev</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">pmf_set_platform</b>(<i class="farg">key</i>, <i class="farg">value</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Insert a name-value pair into the platform information database.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">pmf_get_platform</b>(<i class="farg">key</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Retrieve the value for <i class="farg">key</i> from the platform information database. Returns <span class="define">NULL</span> if the key is not present.</dd>
</dl>
</div>
<div class="section">
<h1 id="x434f4445205245464552454e434553">CODE REFERENCES</h1> The power management framework is implemented within the files <i class="file">sys/sys/pmf.h</i>, <i class="file">sys/sys/device.h</i>, <i class="file">sys/kern/kern_pmf.c</i>, and <i class="file">sys/kern/subr_autoconf.c</i>.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html9/autoconf.html">autoconf(9)</a>, <a class="link-man" href="../html9/driver.html">driver(9)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="name">PMF</b> framework appeared in <span class="unix">NetBSD&#160;5.0</span>.</div>
<div class="section">
<h1 id="x415554484f5253">AUTHORS</h1> <span class="author">Jared D. McNeill</span> &#60;<a class="link-mail" href="mailto:jmcneill@NetBSD.org">jmcneill@NetBSD.org</a>&#62; <span class="author">Joerg Sonnenberger</span> &#60;<a class="link-mail" href="mailto:joerg@NetBSD.org">joerg@NetBSD.org</a>&#62;</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
April 2, 2012</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

