<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/../4/strict.dtd">
>
<head>
<meta http-equiv="Content-Type" content="te../; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
BUS_DMA(9)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
BUS_DMA(9)</td>
<td class="head-vol" align="center">
Kernel Developer's Manual</td>
<td class="head-rtitle" align="right">
BUS_DMA(9)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">bus_dma</b>, <b class="name">bus_dmamap_create</b>, <b class="name">bus_dmamap_destroy</b>, <b class="name">bus_dmamap_load</b>, <b class="name">bus_dmamap_load_mbuf</b>, <b class="name">bus_dmamap_load_uio</b>, <b class="name">bus_dmamap_load_raw</b>, <b class="name">bus_dmamap_unload</b>, <b class="name">bus_dmamap_sync</b>, <b class="name">bus_dmamem_alloc</b>, <b class="name">bus_dmamem_free</b>, <b class="name">bus_dmamem_map</b>, <b class="name">bus_dmamem_unmap</b>, <b class="name">bus_dmamem_mmap</b>, <b class="name">bus_dmatag_subregion</b>, <b class="name">bus_dmatag_destroy</b> &#8212; <span class="desc">Bus and Machine Independent DMA Mapping Interface</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">sys/bus.h</a>&gt;</b><p>
<i class="ftype">int</i><br>
<b class="fname">bus_dmamap_create</b>(<i class="farg" style="white-space:nowrap;">bus_dma_tag_t tag</i>, <i class="farg" style="white-space:nowrap;">bus_size_t size</i>, <i class="farg" style="white-space:nowrap;">int nsegments</i>, <i class="farg" style="white-space:nowrap;">bus_size_t maxsegsz</i>, <i class="farg" style="white-space:nowrap;">bus_size_t boundary</i>, <i class="farg" style="white-space:nowrap;">int flags</i>, <i class="farg" style="white-space:nowrap;">bus_dmamap_t *dmamp</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">bus_dmamap_destroy</b>(<i class="farg" style="white-space:nowrap;">bus_dma_tag_t tag</i>, <i class="farg" style="white-space:nowrap;">bus_dmamap_t dmam</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">bus_dmamap_load</b>(<i class="farg" style="white-space:nowrap;">bus_dma_tag_t tag</i>, <i class="farg" style="white-space:nowrap;">bus_dmamap_t dmam</i>, <i class="farg" style="white-space:nowrap;">void *buf</i>, <i class="farg" style="white-space:nowrap;">bus_size_t buflen</i>, <i class="farg" style="white-space:nowrap;">struct proc *p</i>, <i class="farg" style="white-space:nowrap;">int flags</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">bus_dmamap_load_mbuf</b>(<i class="farg" style="white-space:nowrap;">bus_dma_tag_t tag</i>, <i class="farg" style="white-space:nowrap;">bus_dmamap_t dmam</i>, <i class="farg" style="white-space:nowrap;">struct mbuf *chain</i>, <i class="farg" style="white-space:nowrap;">int flags</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">bus_dmamap_load_uio</b>(<i class="farg" style="white-space:nowrap;">bus_dma_tag_t tag</i>, <i class="farg" style="white-space:nowrap;">bus_dmamap_t dmam</i>, <i class="farg" style="white-space:nowrap;">struct uio *uio</i>, <i class="farg" style="white-space:nowrap;">int flags</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">bus_dmamap_load_raw</b>(<i class="farg" style="white-space:nowrap;">bus_dma_tag_t tag</i>, <i class="farg" style="white-space:nowrap;">bus_dmamap_t dmam</i>, <i class="farg" style="white-space:nowrap;">bus_dma_segment_t *segs</i>, <i class="farg" style="white-space:nowrap;">int nsegs</i>, <i class="farg" style="white-space:nowrap;">bus_size_t size</i>, <i class="farg" style="white-space:nowrap;">int flags</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">bus_dmamap_unload</b>(<i class="farg" style="white-space:nowrap;">bus_dma_tag_t tag</i>, <i class="farg" style="white-space:nowrap;">bus_dmamap_t dmam</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">bus_dmamap_sync</b>(<i class="farg" style="white-space:nowrap;">bus_dma_tag_t tag</i>, <i class="farg" style="white-space:nowrap;">bus_dmamap_t dmam</i>, <i class="farg" style="white-space:nowrap;">bus_addr_t offset</i>, <i class="farg" style="white-space:nowrap;">bus_size_t len</i>, <i class="farg" style="white-space:nowrap;">int ops</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">bus_dmamem_alloc</b>(<i class="farg" style="white-space:nowrap;">bus_dma_tag_t tag</i>, <i class="farg" style="white-space:nowrap;">bus_size_t size</i>, <i class="farg" style="white-space:nowrap;">bus_size_t alignment</i>, <i class="farg" style="white-space:nowrap;">bus_size_t boundary</i>, <i class="farg" style="white-space:nowrap;">bus_dma_segment_t *segs</i>, <i class="farg" style="white-space:nowrap;">int nsegs</i>, <i class="farg" style="white-space:nowrap;">int *rsegs</i>, <i class="farg" style="white-space:nowrap;">int flags</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">bus_dmamem_free</b>(<i class="farg" style="white-space:nowrap;">bus_dma_tag_t tag</i>, <i class="farg" style="white-space:nowrap;">bus_dma_segment_t *segs</i>, <i class="farg" style="white-space:nowrap;">int nsegs</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">bus_dmamem_map</b>(<i class="farg" style="white-space:nowrap;">bus_dma_tag_t tag</i>, <i class="farg" style="white-space:nowrap;">bus_dma_segment_t *segs</i>, <i class="farg" style="white-space:nowrap;">int nsegs</i>, <i class="farg" style="white-space:nowrap;">size_t size</i>, <i class="farg" style="white-space:nowrap;">void **kvap</i>, <i class="farg" style="white-space:nowrap;">int flags</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">bus_dmamem_unmap</b>(<i class="farg" style="white-space:nowrap;">bus_dma_tag_t tag</i>, <i class="farg" style="white-space:nowrap;">void *kva</i>, <i class="farg" style="white-space:nowrap;">size_t size</i>);<p>
<i class="ftype">paddr_t</i><br>
<b class="fname">bus_dmamem_mmap</b>(<i class="farg" style="white-space:nowrap;">bus_dma_tag_t tag</i>, <i class="farg" style="white-space:nowrap;">bus_dma_segment_t *segs</i>, <i class="farg" style="white-space:nowrap;">int nsegs</i>, <i class="farg" style="white-space:nowrap;">off_t off</i>, <i class="farg" style="white-space:nowrap;">int prot</i>, <i class="farg" style="white-space:nowrap;">int flags</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">bus_dmatag_subregion</b>(<i class="farg" style="white-space:nowrap;">bus_dma_tag_t tag</i>, <i class="farg" style="white-space:nowrap;">bus_addr_t min_addr</i>, <i class="farg" style="white-space:nowrap;">bus_addr_t max_addr</i>, <i class="farg" style="white-space:nowrap;">bus_dma_tag_t *newtag</i>, <i class="farg" style="white-space:nowrap;">int flags</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">bus_dmatag_destroy</b>(<i class="farg" style="white-space:nowrap;">bus_dma_tag_t tag</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> Provide a bus- and machine-independent "DMA mapping interface."</div>
<div class="section">
<h1 id="x494d504c454d454e544154494f4e204e4f544553">IMPLEMENTATION NOTES</h1> All data types and constants will be defined by the port-specific header <b class="includes">&lt;<a class="link-includes">machine/bus_defs.h</a>&gt;</b>. All functions will be defined by the port-specific header <b class="includes">&lt;<a class="link-includes">machine/bus_funcs.h</a>&gt;</b>. Note that this document assumes the existence of types already defined by the current "bus.h" interface.<p>
Unless otherwise noted, all function calls in this interface may be defined as <a class="link-man" href="../1/cpp">cpp(1)</a> macros.</div>
<div class="section">
<h1 id="x44415441205459504553">DATA TYPES</h1> Individual implementations may name these structures whatever they wish, providing that the external representations are:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">bus_dma_tag_t</i></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
A machine-dependent opaque type describing the implementation of DMA for a given bus.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">bus_dma_segment_t</i></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
A structure with at least the following members:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
	bus_addr_t	ds_addr; 
	bus_size_t	ds_len;</pre>
<p>
The structure may have machine-dependent members and arbitrary layout. The values in <i class="farg">ds_addr</i> and <i class="farg">ds_len</i> are suitable for programming into DMA controller address and length registers.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">bus_dmamap_t</i></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
A pointer to a structure with at least the following members:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
	bus_size_t	dm_maxsegsz; 
	bus_size_t	dm_mapsize; 
	int		dm_nsegs; 
	bus_dma_segment_t *dm_segs;</pre>
<p>
The structure may have machine-dependent members and arbitrary layout. The <i class="farg">dm_maxsegsz</i> member indicates the maximum number of bytes that may be transferred by any given DMA segment. The <i class="farg">dm_mapsize</i> member indicates the size of the mapping. A value of 0 indicates the mapping is invalid. The <i class="farg">dm_segs</i> member may be an array of segments or a pointer to an array of segments. The <i class="farg">dm_nsegs</i> member indicates the number of segments in <i class="farg">dm_segs</i>.</dd>
</dl>
</div>
<div class="section">
<h1 id="x46554e4354494f4e53">FUNCTIONS</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">bus_dmamap_create</b>(<i class="farg">tag</i>, <i class="farg">size</i>, <i class="farg">nsegments</i>, <i class="farg">maxsegsz</i>, <i class="farg">boundary</i>, <i class="farg">flags</i>, <i class="farg">dmamp</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Allocates a DMA handle and initializes it according to the parameters provided. Arguments are as follows:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">tag</i></dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
This is the bus_dma_tag_t passed down from the parent driver via <i class="farg">&lt;bus&gt;_attach_args</i>.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">size</i></dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
This is the maximum DMA transfer that can be mapped by the handle.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">nsegments</i></dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
Number of segments the device can support in a single DMA transaction. This may be the number of scatter-gather descriptors supported by the device.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">maxsegsz</i></dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
The maximum number of bytes that may be transferred by any given DMA segment and will be assigned to the <i class="farg">dm_maxsegsz</i> member.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">boundary</i></dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
Some DMA controllers are not able to transfer data that crosses a particular boundary. This argument allows this boundary to be specified. The boundary lines begin at 0, and occur every <i class="farg">boundary</i> bytes. Mappings may begin on a boundary line but may not end on or cross a boundary line. If no boundary condition needs to be observed, a <i class="farg">boundary</i> argument of 0 should be used.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">flags</i></dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
Flags are defined as follows:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">BUS_DMA_WAITOK</span></dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
It is safe to wait (sleep) for resources during this call.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">BUS_DMA_NOWAIT</span></dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
It is not safe to wait (sleep) for resources during this call.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">BUS_DMA_ALLOCNOW</span></dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
Perform any resource allocation this handle may need now. If this is not specified, the allocation may be deferred to <b class="fname">bus_dmamap_load</b>(). If this flag is specified, <b class="fname">bus_dmamap_load</b>() will not block on resource allocation.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">BUS_DMA_BUS[1-4]</span></dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
These flags are placeholders, and may be used by busses to provide bus-dependent functionality.</dd>
</dl>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">dmamp</i></dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
This is a pointer to a bus_dmamap_t. A DMA map will be allocated and pointed to by <i class="farg">dmamp</i> upon successful completion of this routine. <i class="farg">dmamp</i> is undefined if this routine fails.</dd>
</dl>
<p>
Behavior is not defined if invalid arguments are passed to <b class="fname">bus_dmamap_create</b>().<p>
Returns 0 on success, or an error code to indicate mode of failure.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">bus_dmamap_destroy</b>(<i class="farg">tag</i>, <i class="farg">dmam</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Frees all resources associated with a given DMA handle. Arguments are as follows:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">tag</i></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
This is the bus_dma_tag_t passed down from the parent driver via <i class="farg">&lt;bus&gt;_attach_args</i>.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">dmam</i></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
The DMA handle to destroy.</dd>
</dl>
<p>
In the event that the DMA handle contains a valid mapping, the mapping will be unloaded via the same mechanism used by <b class="fname">bus_dmamap_unload</b>().<p>
Behavior is not defined if invalid arguments are passed to <b class="fname">bus_dmamap_destroy</b>().<p>
If given valid arguments, <b class="fname">bus_dmamap_destroy</b>() always succeeds.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">bus_dmamap_load</b>(<i class="farg">tag</i>, <i class="farg">dmam</i>, <i class="farg">buf</i>, <i class="farg">buflen</i>, <i class="farg">p</i>, <i class="farg">flags</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Loads a DMA handle with mappings for a DMA transfer. It assumes that all pages involved in a DMA transfer are wired. Arguments are as follows:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">tag</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This is the bus_dma_tag_t passed down from the parent driver via <i class="farg">&lt;bus&gt;_attach_args</i>.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">dmam</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The DMA handle with which to map the transfer.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">buf</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The buffer to be used for the DMA transfer.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">buflen</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The size of the buffer.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">p</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Used to indicate the address space in which the buffer is located. If <span class="define">NULL</span>, the buffer is assumed to be in kernel space. Otherwise, the buffer is assumed to be in proc <i class="farg">p</i>&#39;s address space.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">flags</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
are defined as follows:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">BUS_DMA_WAITOK</span></dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
It is safe to wait (sleep) for resources during this call.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">BUS_DMA_NOWAIT</span></dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
It is not safe to wait (sleep) for resources during this call.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">BUS_DMA_STREAMING</span></dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
By default, the <b class="name">bus_dma</b> API assumes that there is coherency between memory and the device performing the DMA transaction. Some platforms, however, have special hardware, such as an &#8220;I/O cache&#8221;, which may improve performance of some types of DMA transactions, but which break the assumption that there is coherency between memory and the device performing the DMA transaction. This flag allows the use of this special hardware, provided that the device is doing sequential, unidirectional transfers which conform to certain alignment and size constraints defined by the platform. If the platform does not support the feature, or if the buffer being loaded into the DMA map does not conform to the constraints required for use of the feature, then this flag will be silently ignored. Also refer to the use of this flag with the <b class="fname">bus_dmamem_alloc</b>() function.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">BUS_DMA_READ</span></dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
This is a hint to the machine-dependent back-end that indicates the mapping will be used only for a <span class="emph">device -&gt; memory</span> transaction. The back-end may perform optimizations based on this information.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">BUS_DMA_WRITE</span></dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
This is a hint to the machine-dependent back-end that indicates the mapping will be used only for a <span class="emph">memory -&gt; device</span> transaction. The back-end may perform optimizations based on this information.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">BUS_DMA_BUS[1-4]</span></dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
These flags are placeholders, and may be used by busses to provide bus-dependent functionality.</dd>
</dl>
</dd>
</dl>
<p>
As noted above, if a DMA handle is created with <span class="define">BUS_DMA_ALLOCNOW</span>, <b class="fname">bus_dmamap_load</b>() will never block.<p>
If a call to <b class="fname">bus_dmamap_load</b>() fails, the mapping in the DMA handle will be invalid. It is the responsibility of the caller to clean up any inconsistent device state resulting from incomplete iteration through the uio.<p>
Behavior is not defined if invalid arguments are passed to <b class="fname">bus_dmamap_load</b>().<p>
Returns 0 on success, or an error code to indicate mode of failure. Possible error codes include the following:<p>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="errno">EFBIG</span></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
Too many segments.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="errno">EINVAL</span></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
<i class="farg">buflen</i> is too large for the DMA map.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="errno">ENOMEM</span></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
Could not allocate memory for, e.g., a bounce buffer.</dd>
</dl>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">bus_dmamap_load_mbuf</b>(<i class="farg">tag</i>, <i class="farg">dmam</i>, <i class="farg">chain</i>, <i class="farg">flags</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
This is a variation of <b class="fname">bus_dmamap_load</b>() which maps mbuf chains for DMA transfers. Mbuf chains are assumed to be in kernel virtual address space.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">bus_dmamap_load_uio</b>(<i class="farg">tag</i>, <i class="farg">dmam</i>, <i class="farg">uio</i>, <i class="farg">flags</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
This is a variation of <b class="fname">bus_dmamap_load</b>() which maps buffers pointed to by <i class="farg">uio</i> for DMA transfers. Determination if the buffers are in user or kernel virtual address space is done internally, according to <i class="farg">uio-&gt;uio_vmspace</i>. See <a class="link-man" href="../9/uiomove">uiomove(9)</a> for details of the <span class="define">uio</span> structure.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">bus_dmamap_load_raw</b>(<i class="farg">tag</i>, <i class="farg">dmam</i>, <i class="farg">segs</i>, <i class="farg">nsegs</i>, <i class="farg">size</i>, <i class="farg">flags</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
This is a variation of <b class="fname">bus_dmamap_load</b>() which maps buffers allocated by <b class="fname">bus_dmamem_alloc</b>() (see below). The <i class="farg">segs</i> argument is an array of bus_dma_segment_t's filled in by <b class="fname">bus_dmamem_alloc</b>(). The <i class="farg">nsegs</i> argument is the number of segments in the array. The <i class="farg">size</i> argument is the size of the DMA transfer.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">bus_dmamap_unload</b>(<i class="farg">tag</i>, <i class="farg">dmam</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Deletes the mappings for a given DMA handle. Arguments are as follows:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">tag</i></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
This is the bus_dma_tag_t passed down from the parent driver via <i class="farg">&lt;bus&gt;_attach_args</i>.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">dmam</i></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
The DMA handle containing the mappings which are to be deleted.</dd>
</dl>
<p>
If the DMA handle was created with <span class="define">BUS_DMA_ALLOCNOW</span>, <b class="fname">bus_dmamap_unload</b>() will not free the corresponding resources which were allocated by <b class="fname">bus_dmamap_create</b>(). This is to ensure that <b class="fname">bus_dmamap_load</b>() will never block on resources if the handle was created with <span class="define">BUS_DMA_ALLOCNOW</span>.<p>
<b class="fname">bus_dmamap_unload</b>() will not perform any implicit synchronization of DMA buffers. This must be done explicitly by <b class="fname">bus_dmamap_sync</b>().<p>
<b class="fname">bus_dmamap_unload</b>() will restore the <i class="farg">dm_maxsegsz</i> member to its initial value assigned by <b class="fname">bus_dmamap_create</b>().<p>
Behavior is not defined if invalid arguments are passed to <b class="fname">bus_dmamap_unload</b>().<p>
If given valid arguments, <b class="fname">bus_dmamap_unload</b>() always succeeds.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">bus_dmamap_sync</b>(<i class="farg">tag</i>, <i class="farg">dmam</i>, <i class="farg">offset</i>, <i class="farg">len</i>, <i class="farg">ops</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Performs pre- and post-DMA operation cache and/or buffer synchronization. Arguments are as follows:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">tag</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This is the bus_dma_tag_t passed down from the parent driver via <i class="farg">&lt;bus&gt;_attach_args</i>.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">dmam</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The DMA mapping to be synchronized.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">offset</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The offset into the DMA mapping to synchronize.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">len</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The length of the mapping from <i class="farg">offset</i> to synchronize.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">ops</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
One or more synchronization operation to perform. The following DMA synchronization operations are defined:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">BUS_DMASYNC_PREREAD</span></dt>
<dd class="list-tag" style="margin-left: 21.00ex;">
Perform any pre-read DMA cache and/or bounce operations.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">BUS_DMASYNC_POSTREAD</span></dt>
<dd class="list-tag" style="margin-left: 21.00ex;">
Perform any post-read DMA cache and/or bounce operations.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">BUS_DMASYNC_PREWRITE</span></dt>
<dd class="list-tag" style="margin-left: 21.00ex;">
Perform any pre-write DMA cache and/or bounce operations.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">BUS_DMASYNC_POSTWRITE</span></dt>
<dd class="list-tag" style="margin-left: 21.00ex;">
Perform any post-write DMA cache and/or bounce operations.</dd>
</dl>
<p>
More than one operation may performed in a given synchronization call. Mixing of <span class="emph">PRE</span> and <span class="emph">POST</span> operations is not allowed, and behavior is undefined if this is attempted.</dd>
</dl>
<p>
Synchronization operations are expressed from the perspective of the host RAM, e.g., a <span class="emph">device -&gt; memory</span> operation is a <span class="emph">READ</span> and a <span class="emph">memory -&gt; device</span> operation is a <span class="emph">WRITE</span>.<p>
<b class="fname">bus_dmamap_sync</b>() may consult state kept within the DMA map to determine if the memory is mapped in a DMA coherent fashion. If so, <b class="fname">bus_dmamap_sync</b>() may elect to skip certain expensive operations, such as flushing of the data cache. See <b class="fname">bus_dmamem_map</b>() for more information on this subject.<p>
On platforms which implement a weak memory access ordering model, <b class="fname">bus_dmamap_sync</b>() will always cause the appropriate memory barriers to be issued.<p>
This function exists to ensure that the host and the device have a consistent view of a range of DMA memory, before and after a DMA operation.<p>
An example of using <b class="fname">bus_dmamap_sync</b>(), involving multiple read-write use of a single mapping might look like this:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
bus_dmamap_load(...); 
 
while (not done) { 
	/* invalidate soon-to-be-stale cache blocks */ 
	bus_dmamap_sync(..., BUS_DMASYNC_PREREAD); 
 
	[ do read DMA ] 
 
	/* copy from bounce */ 
	bus_dmamap_sync(..., BUS_DMASYNC_POSTREAD); 
 
	/* read data now in driver-provided buffer */ 
 
	[ computation ] 
 
	/* data to be written now in driver-provided buffer */ 
 
	/* flush write buffers and writeback, copy to bounce */ 
	bus_dmamap_sync(..., BUS_DMASYNC_PREWRITE); 
 
	[ do write DMA ] 
 
	/* probably a no-op, but provided for consistency */ 
	bus_dmamap_sync(..., BUS_DMASYNC_POSTWRITE); 
} 
 
bus_dmamap_unload(...);</pre>
<p>
This function <span class="emph">must</span> be called to synchronize DMA buffers before and after a DMA operation. Other <b class="name">bus_dma</b> functions can <span class="emph">not</span> be relied on to do this synchronization implicitly. If DMA read and write operations are not preceded and followed by the appropriate synchronization operations, behavior is undefined.<p>
Behavior is not defined if invalid arguments are passed to <b class="fname">bus_dmamap_sync</b>().<p>
If given valid arguments, <b class="fname">bus_dmamap_sync</b>() always succeeds.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">bus_dmamem_alloc</b>(<i class="farg">tag</i>, <i class="farg">size</i>, <i class="farg">alignment</i>, <i class="farg">boundary</i>, <i class="farg">segs</i>, <i class="farg">...</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Allocates memory that is "DMA safe" for the bus corresponding to the given tag.<p>
The mapping of this memory is machine-dependent (or "opaque"); machine-independent code is not to assume that the addresses returned are valid in kernel virtual address space, or that the addresses returned are system physical addresses. The address value returned as part of <i class="farg">segs</i> can thus not be used to program DMA controller address registers. Only the values in the <i class="farg">dm_segs</i> array of a successfully loaded DMA map (using <b class="fname">bus_dmamap_load</b>()) can be used for this purpose.<p>
Allocations will always be rounded to the hardware page size. Callers may wish to take advantage of this, and cluster allocation of small data structures. Arguments are as follows:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">tag</i></dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
This is the bus_dma_tag_t passed down from the parent driver via <i class="farg">&lt;bus&gt;_attach_args</i>.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">size</i></dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
The amount of memory to allocate.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">alignment</i></dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
Each segment in the allocated memory will be aligned to this value. If the alignment is less than a hardware page size, it will be rounded up to the hardware page size. This value must be a power of two.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">boundary</i></dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
Each segment in the allocated memory must not cross this boundary (relative to zero). This value must be a power of two. A boundary value less than the size of the allocation is invalid.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">segs</i></dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
An array of bus_dma_segment_t's, filled in as memory is allocated, representing the opaque addresses of the memory chunks.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">nsegs</i></dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
Specifies the number of segments in <i class="farg">segs</i>, and this is the maximum number of segments that the allocated memory may contain.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">rsegs</i></dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
Used to return the actual number of segments the memory contains.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">flags</i></dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
Flags are defined as follows:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">BUS_DMA_WAITOK</span></dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
It is safe to wait (sleep) for resources during this call.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">BUS_DMA_NOWAIT</span></dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
It is not safe to wait (sleep) for resources during this call.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">BUS_DMA_STREAMING</span></dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
Adjusts, if necessary, the size, alignment, and boundary constrains to conform to the platform-dependent requirements for the use of the <span class="define">BUS_DMA_STREAMING</span> flag with the <b class="fname">bus_dmamap_load</b>() function. If the platform does not support the <span class="define">BUS_DMA_STREAMING</span> feature, or if the size, alignment, and boundary constraints would already satisfy the platform's requirements, this flag is silently ignored. The <span class="define">BUS_DMA_STREAMING</span> flag will never relax the constraints specified in the call.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">BUS_DMA_BUS[1-4]</span></dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
These flags are placeholders, and may be used by busses to provide bus-dependent functionality.</dd>
</dl>
</dd>
</dl>
<p>
All pages allocated by <b class="fname">bus_dmamem_alloc</b>() will be wired down until they are freed by <b class="fname">bus_dmamem_free</b>().<p>
Behavior is undefined if invalid arguments are passed to <b class="fname">bus_dmamem_alloc</b>().<p>
Returns 0 on success, or an error code indicating mode of failure.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">bus_dmamem_free</b>(<i class="farg">tag</i>, <i class="farg">segs</i>, <i class="farg">nsegs</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Frees memory previously allocated by <b class="fname">bus_dmamem_alloc</b>(). Any mappings will be invalidated. Arguments are as follows:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">tag</i></dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
This is the bus_dma_tag_t passed down from the parent driver via <i class="farg">&lt;bus&gt;_attach_args</i>.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">segs</i></dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
The array of bus_dma_segment_t's filled in by <b class="fname">bus_dmamem_alloc</b>().</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">nsegs</i></dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
The number of segments in <i class="farg">segs</i>.</dd>
</dl>
<p>
Behavior is undefined if invalid arguments are passed to <b class="fname">bus_dmamem_free</b>().<p>
If given valid arguments, <b class="fname">bus_dmamem_free</b>() always succeeds.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">bus_dmamem_map</b>(<i class="farg">tag</i>, <i class="farg">segs</i>, <i class="farg">nsegs</i>, <i class="farg">size</i>, <i class="farg">kvap</i>, <i class="farg">flags</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Maps memory allocated with <b class="fname">bus_dmamem_alloc</b>() into kernel virtual address space. Arguments are as follows:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">tag</i></dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
This is the bus_dma_tag_t passed down from the parent driver via <i class="farg">&lt;bus&gt;_attach_args</i>.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">segs</i></dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
The array of bus_dma_segment_t's filled in by <b class="fname">bus_dmamem_alloc</b>(), representing the memory regions to map.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">nsegs</i></dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
The number of segments in <i class="farg">segs</i>.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">size</i></dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
The size of the mapping.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">kvap</i></dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
Filled in to specify the kernel virtual address where the memory is mapped.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">flags</i></dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
Flags are defined as follows:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">BUS_DMA_WAITOK</span></dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
It is safe to wait (sleep) for resources during this call.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">BUS_DMA_NOWAIT</span></dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
It is not safe to wait (sleep) for resources during this call.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">BUS_DMA_BUS[1-4]</span></dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
These flags are placeholders, and may be used by busses to provide bus-dependent functionality.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">BUS_DMA_COHERENT</span></dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
This flag is a <span class="emph">hint</span> to machine-dependent code. If possible, map the memory in such a way as it will be DMA coherent. This may include mapping the pages into uncached address space or setting the cache-inhibit bits in page table entries. If DMA coherent mappings are impossible, this flag is silently ignored.<p>
Later, when this memory is loaded into a DMA map, machine-dependent code will take whatever steps are necessary to determine if the memory was mapped in a DMA coherent fashion. This may include checking if the kernel virtual address lies within uncached address space or if the cache-inhibit bits are set in page table entries. If it is determined that the mapping is DMA coherent, state may be placed into the DMA map for use by later calls to <b class="fname">bus_dmamap_sync</b>().<p>
Note that a device driver must not rely on <span class="define">BUS_DMA_COHERENT</span> for correct operation. All calls to <b class="fname">bus_dmamap_sync</b>() must still be made. This flag is provided only as an optimization hint to machine-dependent code.<p>
Also note that this flag only applies to coherency between the CPU and memory. Coherency between memory and the device is controlled with a different flag. See the description of the <b class="fname">bus_dmamap_load</b>() function.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">BUS_DMA_NOCACHE</span></dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
This flag is a <span class="emph">hint</span> to machine-dependent code. If possible, map the uncached memory. This flag may be useful in the case that the memory cache causes unexpected behavior of the device.</dd>
</dl>
</dd>
</dl>
<p>
Behavior is undefined if invalid arguments are passed to <b class="fname">bus_dmamem_map</b>().<p>
Returns 0 on success, or an error code indicating mode of failure.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">bus_dmamem_unmap</b>(<i class="farg">tag</i>, <i class="farg">kva</i>, <i class="farg">size</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Unmaps memory previously mapped with <b class="fname">bus_dmamem_map</b>(), freeing the kernel virtual address space used by the mapping. The arguments are as follows:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">tag</i></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
This is the bus_dma_tag_t passed down from the parent driver via <i class="farg">&lt;bus&gt;_attach_args</i>.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">kva</i></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
The kernel virtual address of the mapped memory.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">size</i></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
The size of the mapping.</dd>
</dl>
<p>
Behavior is undefined if invalid arguments are passed to <b class="fname">bus_dmamem_unmap</b>().<p>
If given valid arguments, <b class="fname">bus_dmamem_unmap</b>() always succeeds.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">bus_dmamem_mmap</b>(<i class="farg">tag</i>, <i class="farg">segs</i>, <i class="farg">nsegs</i>, <i class="farg">off</i>, <i class="farg">prot</i>, <i class="farg">flags</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Provides support for user <a class="link-man" href="../2/mmap">mmap(2)</a>&#39;ing of DMA-safe memory. This function is to be called by a device driver's (*d_mmap)() entry point, which is called by the device pager for each page to be mapped. The arguments are as follows:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">tag</i></dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
This is the bus_dma_tag_t passed down from the parent driver via <i class="farg">&lt;bus&gt;_attach_args</i>.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">segs</i></dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
The array of bus_dma_segment_t's filled in by <b class="fname">bus_dmamem_alloc</b>(), representing the memory to be <a class="link-man" href="../2/mmap">mmap(2)</a>&#39;ed.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">nsegs</i></dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
The number of elements in the <i class="farg">segs</i> array.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">off</i></dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
The offset of the page in DMA memory which is to be mapped.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">prot</i></dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
The protection codes for the mapping.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">flags</i></dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
Flags are defined as follows:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">BUS_DMA_WAITOK</span></dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
It is safe to wait (sleep) for resources during this call.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">BUS_DMA_NOWAIT</span></dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
It is not safe to wait (sleep) for resources during this call.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">BUS_DMA_BUS[1-4]</span></dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
These flags are placeholders, and may be used by busses to provide bus-dependent functionality.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">BUS_DMA_COHERENT</span></dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
See <b class="fname">bus_dmamem_map</b>() above for a description of this flag.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">BUS_DMA_NOCACHE</span></dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
See <b class="fname">bus_dmamem_map</b>() above for a description of this flag.</dd>
</dl>
</dd>
</dl>
<p>
Behavior is undefined if invalid arguments are passed to <b class="fname">bus_dmamem_mmap</b>().<p>
Returns -1 to indicate failure. Otherwise, returns an opaque value to be interpreted by the device pager.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">bus_dmatag_subregion</b>(<i class="farg">tag</i>, <i class="farg">min_addr</i>, <i class="farg">max_addr</i>, <i class="farg">newtag</i>, <i class="farg">flags</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Given a bus_dma_tag_t create a new bus_dma_tag_t with a limited bus address space. This function should not normally be used, but is useful for devices that do not support the full address space of the parent bus. The arguments are as follows:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">tag</i></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
This is the bus_dma_tag_t to subregion.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">min_addr</i></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
The smallest address this new tag can address.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">max_addr</i></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
The largest address this new tag can address.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">newtag</i></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
Pointer filled in with the address of the new bus_dma_tag_t.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="farg">flags</i></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
Flags are defined as follows:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">BUS_DMA_WAITOK</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
It is safe to wait (sleep) for resources during this call.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">BUS_DMA_NOWAIT</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
It is not safe to wait (sleep) for resources during this call.</dd>
</dl>
</dd>
</dl>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">bus_dmatag_destroy</b>(<i class="farg">tag</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Free a tag created by <b class="fname">bus_dmatag_subregion</b>().</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../9/bus_space">bus_space(9)</a>, <a class="link-man" href="../9/mb">mb(9)</a><p>
<span class="ref"><span class="ref-auth">Jason Thorpe</span>, <span class="ref-title">A Machine-Independent DMA Framework for NetBSD</span>, <i class="ref-book">Proceedings of the FREENIX Track: 1998 USENIX Annual Technical Conference</i>, <i class="ref-issue">USENIX Association</i>, <a class="link-ref" href="http://www.usenix.org/publications/library/proceedings/usenix98/freenix/thorpe_dma.pdf">http://www.usenix.org/publications/library/proceedings/usenix98/freenix/thorpe_dma.pdf</a>, <span class="ref-page">1-12</span>, <span class="ref-date">June 15-19, 1998</span>.</span></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="name">bus_dma</b> interface appeared in <span class="unix">NetBSD&#160;1.3</span>.</div>
<div class="section">
<h1 id="x415554484f5253">AUTHORS</h1> The <b class="name">bus_dma</b> interface was designed and implemented by Jason R. Thorpe of the Numerical Aerospace Simulation Facility, NASA Ames Research Center. Additional input on the <b class="name">bus_dma</b> design was provided by Chris Demetriou, Charles Hannum, Ross Harvey, Matthew Jacob, Jonathan Stone, and Matt Thomas.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
July 8, 2011</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
<>

