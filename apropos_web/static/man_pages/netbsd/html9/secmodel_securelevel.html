<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
SECMODEL_SECURELEVEL(9)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
SECMODEL_SECURELEVEL(9)</td>
<td class="head-vol" align="center">
Kernel Developer's Manual</td>
<td class="head-rtitle" align="right">
SECMODEL_SECURELEVEL(9)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">secmodel_securelevel</b> &#8212; <span class="desc">securelevel security model</span></div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The securelevel mechanism is intended to allow protecting the persistence of code and data on the system, or a subset thereof, from modification, even by the <span class="emph">super-user</span>, by providing convenient means of &#8220;locking down&#8221; a system to a degree suited to its environment.<p>
The <span class="emph">super-user</span> can raise the <span class="emph">securelevel</span> using <a class="link-man" href="../html8/sysctl.html">sysctl(8)</a>, but only <a class="link-man" href="../html8/init.html">init(8)</a> can lower it.<p>
Four security levels are provided:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
-1 <span class="emph">Permanently insecure mode</span></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
<ul style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-bul">
<li class="list-bul" style="margin-top: 1.00em;">
Do not raise the <span class="emph">securelevel</span> on boot.</li>
</ul>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#160;0 <span class="emph">Insecure mode</span></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
<ul style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-bul">
<li class="list-bul" style="margin-top: 1.00em;">
The init process (PID 1) may not be traced or accessed by <a class="link-man" href="../html2/ptrace.html">ptrace(2)</a> or procfs.</li>
<li class="list-bul" style="margin-top: 1.00em;">
Immutable and append-only file flags may be changed by <a class="link-man" href="../html1/chflags.html">chflags(1)</a> or by other means.</li>
<li class="list-bul" style="margin-top: 1.00em;">
All devices may be read or written subject to their permissions.</li>
<li class="list-bul" style="margin-top: 1.00em;">
All <a class="link-man" href="../html4/gpio.html">gpio(4)</a> pins can be set and device drivers can be attached to them.</li>
<li class="list-bul" style="margin-top: 1.00em;">
On architectures that support <a class="link-man" href="../html4/module.html">module(4)</a>, kernel modules can be loaded and unloaded.</li>
</ul>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#160;1 <span class="emph">Secure mode</span></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
<ul style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-bul">
<li class="list-bul" style="margin-top: 1.00em;">
All effects of <span class="emph">securelevel</span> 0.</li>
<li class="list-bul" style="margin-top: 1.00em;">
The <a class="link-man" href="../html4/kmem.html">kmem(4)</a> memory files <i class="file">/dev/mem</i> and <i class="file">/dev/kmem</i> may not be written to.</li>
<li class="list-bul" style="margin-top: 1.00em;">
Raw disk devices of mounted file systems are read-only.</li>
<li class="list-bul" style="margin-top: 1.00em;">
Immutable and append-only file flags may not be removed.</li>
<li class="list-bul" style="margin-top: 1.00em;">
Kernel modules may not be loaded or unloaded.</li>
<li class="list-bul" style="margin-top: 1.00em;">
Neither the <b class="var">net.inet.ip.sourceroute</b> nor the <b class="var">vm.user_va0_disable</b> <a class="link-man" href="../html8/sysctl.html">sysctl(8)</a> variables may be changed.</li>
<li class="list-bul" style="margin-top: 1.00em;">
Adding or removing <a class="link-man" href="../html9/sysctl.html">sysctl(9)</a> nodes is denied.</li>
<li class="list-bul" style="margin-top: 1.00em;">
The RTC offset may not be changed.</li>
<li class="list-bul" style="margin-top: 1.00em;">
Set-id coredump settings may not be altered.</li>
<li class="list-bul" style="margin-top: 1.00em;">
Attaching the IP-based kernel debugger, <a class="link-man" href="../html4/ipkdb.html">ipkdb(4)</a>, is not allowed.</li>
<li class="list-bul" style="margin-top: 1.00em;">
Device &#8220;pass-thru&#8221; requests that may be used to perform raw disk and/or memory access are denied.</li>
<li class="list-bul" style="margin-top: 1.00em;">
The <span class="emph">iopl</span> and <span class="emph">ioperm</span> calls are denied.</li>
<li class="list-bul" style="margin-top: 1.00em;">
Access to unmanaged memory is denied.</li>
<li class="list-bul" style="margin-top: 1.00em;">
Only GPIO pins that have been set at <span class="emph">securelevel</span> 0 can be accessed.</li>
</ul>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#160;2 <span class="emph">Highly secure mode</span></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
<ul style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-bul">
<li class="list-bul" style="margin-top: 1.00em;">
All effects of <span class="emph">securelevel</span> 1.</li>
<li class="list-bul" style="margin-top: 1.00em;">
Raw disk devices are always read-only whether mounted or not.</li>
<li class="list-bul" style="margin-top: 1.00em;">
New disks may not be mounted, and existing mounts may only be downgraded from read-write to read-only.</li>
<li class="list-bul" style="margin-top: 1.00em;">
The system clock may not be set backwards or close to overflow.</li>
<li class="list-bul" style="margin-top: 1.00em;">
Per-process coredump name may not be changed.</li>
<li class="list-bul" style="margin-top: 1.00em;">
Packet filtering and NAT rules may not be altered.</li>
<li class="list-bul" style="margin-top: 1.00em;">
CPU ucode loading is denied on platforms that support it.</li>
</ul>
</dd>
</dl>
<p>
Highly secure mode may seem Draconian, but is intended as a last line of defence should the <span class="emph">super-user</span> account be compromised. Its effects preclude circumvention of file flags by direct modification of a raw disk device, or erasure of a file system by means of <a class="link-man" href="../html8/newfs.html">newfs(8)</a>. Further, it can limit the potential damage of a compromised &#8220;firewall&#8221; by prohibiting the modification of packet filter rules. Preventing the system clock from being set backwards aids in post-mortem analysis and helps ensure the integrity of logs. Precision timekeeping is not affected because the clock may still be slowed.<p>
Normally, the system runs in <span class="emph">securelevel</span> 0 while single-user and in <span class="emph">securelevel</span> 1 while multi-user. If a higher <span class="emph">securelevel</span> is desired while running multi-user, it can be set using the <span class="symb">securelevel</span> keyword in the startup script <i class="file">/etc/rc.conf</i>, see <a class="link-man" href="../html5/rc.conf.html">rc.conf(5)</a> for details. Lower securelevels require the kernel to be compiled with <span class="symb">options INSECURE</span>, causing it to always default to <span class="emph">securelevel</span> &#45;1.<p>
In order for this protection to be effective, the administrator must ensure that no program that is run while the security level is 0 or lower, nor any data or configuration file used by any such program, can be modified while the security level is greater than 0. This may be achieved through the careful use of the &#8220;immutable&#8221; file flag to define and protect a Trusted Computing Base (TCB) consisting of all such programs and data, or by ensuring that all such programs and data are on filesystems that are mounted read-only and running at security level 2 or higher. <span class="emph">Particular care must be taken to ensure, if relying upon</span> <span class="emph">security level 1 and the use of file flags, that the integrity of the</span> <span class="emph">TCB cannot be compromised through the use of modifications to the</span> <span class="emph">disklabel or access to overlapping disk partitions, including the</span> <span class="emph">raw partition</span>.<p>
Do not overlook the fact that shell scripts (or anything else fed to an interpreter, through any mechanism) and the kernel itself are "programs that run while the security level is 0" and must be considered part of the TCB.<p>
The following <a class="link-man" href="../html3/sysctl.html">sysctl(3)</a> variables are exported:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
security.models.securelevel.securelevel</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
The system security level. This level may be raised by processes with appropriate privilege. It may only be lowered by process 1 (init).</dd>
</dl>
</div>
<div class="section">
<h1 id="x46554e4354494f4e53">FUNCTIONS</h1> <b class="name">secmodel_securelevel</b> exposes a <a class="link-man" href="../html9/secmodel_eval.html">secmodel_eval(9)</a> evaluation routine to test whether the current <span class="emph">securelevel</span> is above a certain threshold level or not.<p>
The parameters to <a class="link-man" href="../html9/secmodel_eval.html">secmodel_eval(9)</a> are:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
id</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
the unique identifier of <b class="name">secmodel_securelevel</b>: &#8220;<span class="define">org.netbsd.secmodel.securelevel</span>&#8221;.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
what</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
a string, &#8220;<span class="define">is-securelevel-above</span>&#8221;.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
arg</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
a reference to an <span class="define">int</span> representing the threshold level.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
ret</dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
a boolean, set by <b class="name">secmodel_securelevel</b> to <span class="define">true</span> when the <span class="emph">securelevel</span> is strictly above the threshold level, <span class="define">false</span> otherwise.</dd>
</dl>
</div>
<div class="section">
<h1 id="x52455455524e205459504553">RETURN TYPES</h1> If successful, the evaluation returns 0 with the <i class="farg">ret</i> argument being either <span class="define">true</span> or <span class="define">false</span>.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html9/kauth.html">kauth(9)</a>, <a class="link-man" href="../html9/secmodel.html">secmodel(9)</a>, <a class="link-man" href="../html9/secmodel_bsd44.html">secmodel_bsd44(9)</a>, <a class="link-man" href="../html9/secmodel_eval.html">secmodel_eval(9)</a></div>
<div class="section">
<h1 id="x415554484f5253">AUTHORS</h1> <span class="author">Elad Efrat</span> &#60;<a class="link-mail" href="mailto:elad@NetBSD.org">elad@NetBSD.org</a>&#62;</div>
<div class="section">
<h1 id="x42554753">BUGS</h1> Systems without <a class="link-man" href="../html8/sysctl.html">sysctl(8)</a> behave as though they have security level &#45;1.<p>
The security level 2 restrictions relating to TCB integrity protection should be enforced at security level 1. Restrictions dependent upon security level but not relating to TCB integrity protection should be selected by <a class="link-man" href="../html8/sysctl.html">sysctl(8)</a> settings available only at security level 0 or lower.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
November 22, 2012</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

