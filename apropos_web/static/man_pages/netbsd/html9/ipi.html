<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
IPI(9)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
IPI(9)</td>
<td class="head-vol" align="center">
Kernel Developer's Manual</td>
<td class="head-rtitle" align="right">
IPI(9)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">ipi</b> &#8212; <span class="desc">MI IPI interface</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">sys/ipi.h</a>&gt;</b><p>
<span class="type">typedef void (*ipi_func_t)(void *);</span><p>
<i class="ftype">u_int</i><br>
<b class="fname">ipi_register</b>(<i class="farg" style="white-space:nowrap;">ipi_func_t func</i>, <i class="farg" style="white-space:nowrap;">void *arg</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">ipi_unregister</b>(<i class="farg" style="white-space:nowrap;">u_int ipi_id</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">ipi_trigger</b>(<i class="farg" style="white-space:nowrap;">u_int ipi_id</i>, <i class="farg" style="white-space:nowrap;">struct cpu_info *ci</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">ipi_unicast</b>(<i class="farg" style="white-space:nowrap;">ipi_msg_t *msg</i>, <i class="farg" style="white-space:nowrap;">struct cpu_info *ci</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">ipi_multicast</b>(<i class="farg" style="white-space:nowrap;">ipi_msg_t *msg</i>, <i class="farg" style="white-space:nowrap;">const kcpuset_t *target</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">ipi_broadcast</b>(<i class="farg" style="white-space:nowrap;">ipi_msg_t *msg</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">ipi_wait</b>(<i class="farg" style="white-space:nowrap;">ipi_msg_t *msg</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The machine-independent <b class="name">ipi</b> interface provides capability to send inter-processor interrupts (IPIs) amongst CPUs. The interface has two mechanisms: asynchronous IPI to invoke functions with a constant argument and synchronous IPIs with the cross-call support.<p>
Other synchronization interfaces are built using the MI IPI interface. For a general purpose inter-processor cross-calls or remote interrupts, use the <a class="link-man" href="../9/xcall">xcall(9)</a> or <a class="link-man" href="../9/softint">softint(9)</a> interfaces.<p>
The primary use cases of the MI IPIs include the following:<ul style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-hyph">
<li class="list-hyph" style="margin-top: 0.00em;">
provide a facility for the <a class="link-man" href="../9/softint">softint(9)</a> subsystem to schedule software interrupts on remote CPUs</li>
<li class="list-hyph" style="margin-top: 0.00em;">
provide a facility for the <a class="link-man" href="../9/xcall">xcall(9)</a> subsystem</li>
<li class="list-hyph" style="margin-top: 0.00em;">
abstract IPI handling and facilitate machine-dependent code</li>
</ul>
<div class="subsection">
<h2 id="x4173796e6368726f6e6f75732049504920696e74657266616365">Asynchronous IPI interface</h2> This interface allows dynamic registration of IPI handlers with a constant argument and asynchronous triggering of interrupts.<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">ipi_register</b>(<i class="farg">func</i>, <i class="farg">arg</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Register an IPI handler <i class="farg">func</i> with an arbitrary argument <i class="farg">arg</i>. Returns a non-zero IPI identifier on success and zero on failure.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">ipi_unregister</b>(<i class="farg">ipi_id</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Unregister the IPI handler identified by the <i class="farg">ipi_id</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">ipi_trigger</b>(<i class="farg">ipi_id</i>, <i class="farg">ci</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Trigger an IPI identified by <i class="farg">ipi_id</i> on a remote CPU specified by <i class="farg">ci</i>. This function must be called with the kernel preemption disabled and the target CPU must be remote.</dd>
</dl>
</div>
<div class="subsection">
<h2 id="x53796e6368726f6e6f75732049504920696e74657266616365">Synchronous IPI interface</h2> This interface provides capability to perform cross-calls, i.e. invoke an arbitrary function on a remote CPU. The invocations are performed synchronously and the caller must wait for completion. The cross-call is described by an IPI "message". The caller has to fill in an <span class="type">ipi_msg_t</span> structure which has the following public members:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
        ipi_func_t	func; 
        void		arg;</pre>
<p>
The <i class="arg">func</i> member specifies a function to invoke and <i class="arg">arg</i> is the argument to be passed to the function.<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">ipi_unicast</b>(<i class="farg">msg</i>, <i class="farg">ci</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Send an IPI to a remote CPU specified by <i class="farg">ci</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">ipi_multicast</b>(<i class="farg">msg</i>, <i class="farg">target</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Send IPIs to a CPU set specified by <i class="farg">target</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">ipi_broadcast</b>(<i class="farg">msg</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Send IPIs to all CPUs.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">ipi_wait</b>(<i class="farg">msg</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Wait until all IPIs complete.</dd>
</dl>
<p>
All described functions, except <b class="fname">ipi_wait</b>(), must be called with the kernel preemption disabled. All synchronous IPI invocations must be completed (wait for them with the <b class="fname">ipi_wait</b>() function) before the IPI message structure can be destroyed or new cross-call requests can be performed.</div>
</div>
<div class="section">
<h1 id="x4e4f544553">NOTES</h1> Functions being called must be lightweight. They run at <span class="define">IPL_HIGH</span> and should generally not use any other synchronization interfaces such as <a class="link-man" href="../9/mutex">mutex(9)</a>. If spin-locks are used, they must be used carefully and have no contention.</div>
<div class="section">
<h1 id="x434f4445205245464552454e434553">CODE REFERENCES</h1> The <b class="name">ipi</b> interface is implemented within the file <i class="file">sys/kern/subr_ipi.c</i>.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../9/kcpuset">kcpuset(9)</a>, <a class="link-man" href="../9/kpreempt">kpreempt(9)</a>, <a class="link-man" href="../9/softint">softint(9)</a>, <a class="link-man" href="../9/spl">spl(9)</a>, <a class="link-man" href="../9/xcall">xcall(9)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="name">ipi</b> interface first appeared in <span class="unix">NetBSD&#160;7.0</span>.</div>
<div class="section">
<h1 id="x415554484f5253">AUTHORS</h1> <span class="author">Mindaugas Rasiukevicius</span> &#60;<a class="link-mail" href="mailto:rmind@NetBSD.org">rmind@NetBSD.org</a>&#62;</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
May 25, 2014</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

