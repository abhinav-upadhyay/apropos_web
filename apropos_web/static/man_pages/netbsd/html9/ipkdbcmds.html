<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
IPKDB(9)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
IPKDB(9)</td>
<td class="head-vol" align="center">
Kernel Developer's Manual</td>
<td class="head-rtitle" align="right">
IPKDB(9)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">ipkdb</b> &#8212; <span class="desc">machine-dependent interface to ipkdb</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">ipkdb/ipkdb.h</a>&gt;</b><p>
<i class="ftype">void</i><br>
<b class="fname">ipkdb_init</b>(<i class="farg" style="white-space:nowrap;">void</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">ipkdb_connect</b>(<i class="farg" style="white-space:nowrap;">int when</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">ipkdbcmds</b>(<i class="farg" style="white-space:nowrap;">void</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">ipkdbinit</b>(<i class="farg" style="white-space:nowrap;">void</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">ipkdb_trap</b>(<i class="farg" style="white-space:nowrap;">void</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">ipkdb_poll</b>(<i class="farg" style="white-space:nowrap;">void</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">ipkdbif_init</b>(<i class="farg" style="white-space:nowrap;">struct ipkdb_if *kip</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">ipkdbfbyte</b>(<i class="farg" style="white-space:nowrap;">u_char *c</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">ipkdbsbyte</b>(<i class="farg" style="white-space:nowrap;">u_char *c</i>, <i class="farg" style="white-space:nowrap;">int i</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The machine-dependent code must support this interface for operation with <a class="link-man" href="../html4/ipkdb.html">ipkdb(4)</a>.<p>
During system bootstrap, machine-dependent code must invoke <b class="fname">ipkdb_init</b>(). If the kernel is booted with <span class="define">RB_KDB</span> set in <b class="var">boothowto</b> (see <a class="link-man" href="../html9/boothowto.html">boothowto(9)</a>), <a class="link-man" href="../html4/ipkdb.html">ipkdb(4)</a> is enabled by invoking <b class="fname">ipkdb_connect</b>(), setting the <i class="farg">when</i> argument to 0.<p>
<b class="fname">ipkdbcmds</b>() is invoked by machine-dependent code when the trap mechanism determines that the debugger should be entered, i.e., on a single step or breakpoint interrupt from kernel code. The trapping mechanism should already have stored the registers into the global area ipkdbregs. The layout of this area must be the same as that expected by <a class="link-man" href="../html1/gdb.html">gdb(1)</a>. Valid return values are:<p>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">IPKDB_CMD_RUN</span></dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
user wants to continue</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">IPKDB_CMD_STEP</span></dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
user wants to do single stepping</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">IPKDB_CMD_EXIT</span></dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
user has detached from debugging</dd>
</dl>
</div>
<div class="section">
<h1 id="x46554e4354494f4e53">FUNCTIONS</h1> The machine-dependent code must provide the following functions for the machine-independent code.<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="fname">ipkdbinit</b>(<i class="farg"></i>)</dt>
<dd class="list-tag" style="margin-left: 19.00ex;">
This routine gets called when the debugger should be entered for the first time.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="fname">ipkdb_trap</b>(<i class="farg"></i>)</dt>
<dd class="list-tag" style="margin-left: 19.00ex;">
This routine is part of the trap handler. Whenever a trap happens (e.g., when hitting a breakpoint during debugging), <b class="fname">ipkdb_trap</b>() decides if the Debugger needs to be called. If there are other ways to decide that, it's not necessary to provide an <b class="fname">ipkdb_trap</b>() implementation.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="fname">ipkdb_poll</b>(<i class="farg"></i>)</dt>
<dd class="list-tag" style="margin-left: 19.00ex;">
This routine gets called after a panic to check for a key press by the user. If implemented it allows the user to press any key on the console to do the automatic reboot after a panic. Otherwise the debugging interface will wait forever for some remote debugger to attach in case of a panic.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="fname">ipkdbif_init</b>(<i class="farg">kip</i>)</dt>
<dd class="list-tag" style="margin-left: 19.00ex;">
In order to be able to find the debugging interface, the network driver must invoke <b class="fname">ipkdbif_init</b>() with <i class="farg">kip</i> specifying a <i class="farg">struct ipkdb_if</i> plus some additional parameters that allow it to access the devices registers, hopefully using <a class="link-man" href="../html9/bus_space.html">bus_space(9)</a> methods. In the <i class="farg">ipkdb_if</i> structure, the attach routine must initialize the following fields:<p>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
myenetaddr</dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
fill this with the own ethernet address of the device/machine</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
flags</dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
mark at least <span class="define">IPKDB_MYHW</span> here</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
name</dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
name of the device, only used for a message</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
start</dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
routine called every time <b class="name">ipkdb</b> is entered</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
leave</dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
routine called every time <b class="name">ipkdb</b> is left</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
receive</dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
routine called to receive a packet</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
send</dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
routine called to send a packet</dd>
</dl>
<p>
Additional fields that may be set are:<p>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
myinetaddr</dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
fill this with the own internet address, and mark <span class="define">IPKDB_MYIP</span> in flags</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
port</dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
may be used as a pointer to some device</dd>
</dl>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="fname">ipkdbfbyte</b>(<i class="farg">c</i>)</dt>
<dd class="list-tag" style="margin-left: 19.00ex;">
This routine should fetch a byte from address <i class="farg">c</i>. It must not enter any trap handling code, but instead return &#45;1 on inability to access the data.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="fname">ipkdbsbyte</b>(<i class="farg">c</i>, <i class="farg">i</i>)</dt>
<dd class="list-tag" style="margin-left: 19.00ex;">
This routine should set the byte pointed to by <i class="farg">c</i> to the value given as <i class="farg">i</i>. The routine must not enter any trap handling code. Furthermore it should reset the modification bit in the relevant page table entry to the value before the store.</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html4/ipkdb.html">ipkdb(4)</a>, <a class="link-man" href="../html9/boothowto.html">boothowto(9)</a></div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
September 4, 2009</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

