<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="/static/man_pages/netbsd/style.css" type="text/css" media="all">
<title>
XCALL(9)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
XCALL(9)</td>
<td class="head-vol" align="center">
Kernel Developer's Manual</td>
<td class="head-rtitle" align="right">
XCALL(9)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">xcall</b>, <b class="name">xc_broadcast</b>, <b class="name">xc_unicast</b>, <b class="name">xc_wait</b> &#8212; <span class="desc">cross-call interface</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">sys/xcall.h</a>&gt;</b><p>
<span class="type">typedef void (*xcfunc_t)(void *, void *);</span><p>
<i class="ftype">uint64_t</i><br>
<b class="fname">xc_broadcast</b>(<i class="farg" style="white-space:nowrap;">u_int flags</i>, <i class="farg" style="white-space:nowrap;">xcfunc_t func</i>, <i class="farg" style="white-space:nowrap;">void *arg1</i>, <i class="farg" style="white-space:nowrap;">void *arg2</i>);<p>
<i class="ftype">uint64_t</i><br>
<b class="fname">xc_unicast</b>(<i class="farg" style="white-space:nowrap;">u_int flags</i>, <i class="farg" style="white-space:nowrap;">xcfunc_t func</i>, <i class="farg" style="white-space:nowrap;">void *arg1</i>, <i class="farg" style="white-space:nowrap;">void *arg2</i>, <i class="farg" style="white-space:nowrap;">struct cpu_info *ci</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">xc_wait</b>(<i class="farg" style="white-space:nowrap;">uint64_t where</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The machine-independent <b class="name">xcall</b> interface allows any CPU in the system to request that an arbitrary function be executed on any other CPU.<p>
Sometimes it is necessary to modify hardware state that is tied directly to individual CPUs (such as a CPU's local timer), and these updates can not be done remotely by another CPU. The LWP requesting the update may be unable to guarantee that it will be running on the CPU where the update must occur, when the update occurs.<p>
Additionally, it is sometimes necessary to modify per-CPU software state from a remote CPU. Where these update operations are so rare or the access to the per-CPU data so frequent that the cost of using locking or atomic operations to provide coherency is prohibitive, another way must be found.<p>
Cross calls help to solve these types of problem. However, since this facility is heavyweight, it is expected that it will not be used often.<p>
<b class="name">xcall</b> provides a mechanism for making &#8220;low priority&#8221; cross calls. The function to be executed runs on the remote CPU within a thread context, and not from a software interrupt, so it can ensure that it is not interrupting other code running on the CPU, and so has exclusive access to the CPU. Keep in mind that unless disabled, it may cause a kernel preemption.<p>
<b class="name">xcall</b> also provides a mechanism for making &#8220;high priority&#8221; cross calls. The function to be executed runs on the remote CPU within a <span class="define">IPL_SOFTSERIAL</span> software interrupt context, possibly interrupting other lower-priority code running on the CPU.</div>
<div class="section">
<h1 id="x4e4f544553">NOTES</h1> Functions being called should be relatively lightweight. They may block on locks, but carefully and minimally, to not interfere with other cross calls in the system.</div>
<div class="section">
<h1 id="x46554e4354494f4e53">FUNCTIONS</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">xc_broadcast</b>(<i class="farg">flags</i>, <i class="farg">func</i>, <i class="farg">arg1</i>, <i class="farg">arg2</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Call <b class="fname">(*func)</b>(<i class="farg">arg1</i>, <i class="farg">arg2</i>); on all CPUs in the system. Return a <span class="type">uint64_t</span> &#8220;ticket&#8221; to <b class="fname">xc_wait</b>() on for the cross-call to complete. <i class="farg">flags</i> should be <span class="define">XC_HIGHPRI</span> for a "high priority" call, and 0 for a "low priority" call. <b class="fname">xc_broadcast</b>() should not be called from interrupt context.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">xc_unicast</b>(<i class="farg">flags</i>, <i class="farg">func</i>, <i class="farg">arg1</i>, <i class="farg">arg2</i>, <i class="farg">ci</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Like <b class="fname">xc_broadcast</b>(), but call <b class="fname">(*func)</b>() on only the CPU indicated by <i class="farg">ci</i>. <b class="fname">xc_unicast</b>() also returns a &#8220;ticket&#8221;.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">xc_wait</b>(<i class="farg">where</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Wait on the &#8220;ticket&#8221; returned by a prior <b class="fname">xc_broadcast</b>() or <b class="fname">xc_unicast</b>() for the corresponding cross-call to complete. <b class="fname">xc_wait</b>() should be called from a thread context.</dd>
</dl>
</div>
<div class="section">
<h1 id="x434f4445205245464552454e434553">CODE REFERENCES</h1> The <b class="name">xcall</b> interface is implemented within the file <i class="file">sys/kern/subr_xcall.c</i>.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../9/kpreempt">kpreempt(9)</a>, <a class="link-man" href="../9/percpu">percpu(9)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="name">xcall</b> interface first appeared in <span class="unix">NetBSD&#160;5.0</span>.</div>
<div class="section">
<h1 id="x415554484f5253">AUTHORS</h1> <span class="author">Andrew Doran</span> &#60;<a class="link-mail" href="mailto:ad@NetBSD.org">ad@NetBSD.org</a>&#62;</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
November 26, 2013</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

