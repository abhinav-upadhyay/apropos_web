<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="/static/man_pages/netbsd/style.css" type="text/css" media="all">
<title>
VME(9)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
VME(9)</td>
<td class="head-vol" align="center">
Kernel Developer's Manual</td>
<td class="head-rtitle" align="right">
VME(9)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">VME</b>, <b class="name">vme_probe</b>, <b class="name">vme_space_map</b>, <b class="name">vme_space_unmap</b>, <b class="name">vme_intr_map</b>, <b class="name">vme_intr_establish</b>, <b class="name">vme_intr_disestablish</b>, <b class="name">vme_intr_evcnt</b>, <b class="name">vme_dmamap_create</b>, <b class="name">vme_dmamap_destroy</b>, <b class="name">vme_dmamem_alloc</b>, <b class="name">vme_dmamem_free</b>, <b class="name">vme_space_alloc</b>, <b class="name">vme_space_free</b>, <b class="name">vme_space_get</b> &#8212; <span class="desc">Versa Module Euroboard bus</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">sys/bus.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">dev/vme/vmereg.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">dev/vme/vmevar.h</a>&gt;</b><p>
<i class="ftype">int</i><br>
<b class="fname">vme_probe</b>(<i class="farg" style="white-space:nowrap;">void *vc</i>, <i class="farg" style="white-space:nowrap;">vme_addr_t vmeaddr</i>, <i class="farg" style="white-space:nowrap;">vme_size_t len</i>, <i class="farg" style="white-space:nowrap;">vme_am_t am</i>, <i class="farg" style="white-space:nowrap;">vme_datasize_t datasize</i>, <i class="farg" style="white-space:nowrap;">int (*callback)()</i>, <i class="farg" style="white-space:nowrap;">void *arg</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">vme_space_map</b>(<i class="farg">void *vc</i>, <i class="farg">vme_addr_t vmeaddr</i>, <i class="farg">vme_size_t len</i>, <i class="farg">vme_am_t am</i>, <i class="farg">vme_datasize_t datasize</i>, <i class="farg">vme_swap_t swap</i>, <i class="farg">bus_space_tag_t *tag</i>, <i class="farg">bus_space_handle_t *handle</i>, <i class="farg">vme_mapresc_t *resc</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">vme_space_unmap</b>(<i class="farg" style="white-space:nowrap;">void *vc</i>, <i class="farg" style="white-space:nowrap;">vme_mapresc_t resc</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">vme_intr_map</b>(<i class="farg" style="white-space:nowrap;">void *vc</i>, <i class="farg" style="white-space:nowrap;">int level</i>, <i class="farg" style="white-space:nowrap;">int vector</i>, <i class="farg" style="white-space:nowrap;">vme_intr_handle_t *handlep</i>);<p>
<i class="ftype">void *</i><br>
<b class="fname">vme_intr_establish</b>(<i class="farg" style="white-space:nowrap;">void *vc</i>, <i class="farg" style="white-space:nowrap;">vme_intr_handle_t handle</i>, <i class="farg" style="white-space:nowrap;">int prio</i>, <i class="farg" style="white-space:nowrap;">int (*func)(void *)</i>, <i class="farg" style="white-space:nowrap;">void *arg</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">vme_intr_disestablish</b>(<i class="farg" style="white-space:nowrap;">void *vc</i>, <i class="farg" style="white-space:nowrap;">void *cookie</i>);<p>
<i class="ftype">const struct evcnt *</i><br>
<b class="fname">vme_intr_evcnt</b>(<i class="farg" style="white-space:nowrap;">void *vc</i>, <i class="farg" style="white-space:nowrap;">vme_intr_handle_t handle</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">vme_dmamap_create</b>(<i class="farg">void *vc</i>, <i class="farg">vme_size_t size</i>, <i class="farg">vme_am_t am</i>, <i class="farg">vme_datasize_t datasize</i>, <i class="farg">vme_swap_t swap</i>, <i class="farg">int nsegs</i>, <i class="farg">vme_size_t segsz</i>, <i class="farg">vme_addr_t bound</i>, <i class="farg">int flags</i>, <i class="farg">bus_dmamap_t *map</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">vme_dmamap_destroy</b>(<i class="farg" style="white-space:nowrap;">void *vc</i>, <i class="farg" style="white-space:nowrap;">bus_dmamap_t map</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">vme_dmamem_alloc</b>(<i class="farg">void *vc</i>, <i class="farg">vme_size_t size</i>, <i class="farg">vme_am_t am</i>, <i class="farg">vme_datasize_t datasize</i>, <i class="farg">vme_swap_t swap</i>, <i class="farg">bus_dma_segment_t *segs</i>, <i class="farg">int nsegs</i>, <i class="farg">int *rsegs</i>, <i class="farg">int flags</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">vme_dmamem_free</b>(<i class="farg" style="white-space:nowrap;">void *vc</i>, <i class="farg" style="white-space:nowrap;">bus_dma_segment_t *segs</i>, <i class="farg" style="white-space:nowrap;">int nsegs</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">vme_space_alloc</b>(<i class="farg" style="white-space:nowrap;">struct vmebus_softc *tag</i>, <i class="farg" style="white-space:nowrap;">vme_addr_t addr</i>, <i class="farg" style="white-space:nowrap;">vme_size_t size</i>, <i class="farg" style="white-space:nowrap;">vme_am_t ams</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">vme_space_free</b>(<i class="farg" style="white-space:nowrap;">void *vc</i>, <i class="farg" style="white-space:nowrap;">vme_addr_t addr</i>, <i class="farg" style="white-space:nowrap;">vme_size_t size</i>, <i class="farg" style="white-space:nowrap;">vme_am_t ams</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">vme_space_get</b>(<i class="farg" style="white-space:nowrap;">void *vc</i>, <i class="farg" style="white-space:nowrap;">vme_size_t size</i>, <i class="farg" style="white-space:nowrap;">vme_am_t ams</i>, <i class="farg" style="white-space:nowrap;">u_long align</i>, <i class="farg" style="white-space:nowrap;">vme_addr_t *addr</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="name">VME</b> bus provides support for VME devices. The VME bus is a high-performance backplane bus for use in computer systems. It is based on the VMEbus specification initially released by the VMEbus International Trade Association (VITA) in August of 1982. It has since undergone IEC and IEEE standardisation.<p>
The VME bus supports 8, 16, and 32-bit transfers over non-multiplexed 32-bit data and address paths. The latest revisions allow 64-bit, multiplexed transfers. It supports asynchronous, fully handshaken transfers at speeds up to 80 MB/sec. It has a master-slave architecture, encouraging multiprocessing and supports up to seven interrupt levels.</div>
<div class="section">
<h1 id="x44415441205459504553">DATA TYPES</h1> Drivers attached to the <b class="name">VME</b> bus will make use of the following data types:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">vme_chipset_tag_t</i></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
An opaque type identifying the bus controller.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">vme_addr_t</i></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Addresses on the bus.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">vme_am_t</i></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Address modifiers. Valid values are VME_AM_A32, VME_AM_A16, VME_AM_A24, VME_AM_USERDEF (user/vendor definable), VME_AM_MBO, VME_AM_SUPER, VME_AM_USER, VME_AM_DATA, VME_AM_PRG, VME_AM_BLT32 and VME_AM_BLT64.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">vme_datasize_t</i></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
The datasize of the address space. Valid values are VME_D8, VME_D16, and VME_D32.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">vme_mapresc_t</i></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Generic placeholder for any resources needed for a mapping.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">vme_intr_handle_t</i></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
An opaque type describing an interrupt mapping.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">vme_swap_t</i></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Hardware swap capabilities for controlling data endianness. Valid values have not been specified yet.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">struct vme_range</i></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
A structure used to describe an address range on the VME bus. It contains the following members:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
	vme_addr_t offset; 
	vme_size_t size; 
	vme_am_t am;</pre>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">struct vme_attach_args</i></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
A structure used to inform the driver of the device properties. It contains the following members:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
	vme_chipset_tag_t va_vct; 
	bus_dma_tag_t va_bdt; 
	int ivector; 
	int ilevel; 
	int numcfranges; 
	struct vme_range r[VME_MAXCFRANGES];</pre>
</dd>
</dl>
</div>
<div class="section">
<h1 id="x46554e4354494f4e53">FUNCTIONS</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">vme_probe</b>(<i class="farg">vc</i>, <i class="farg">vmeaddr</i>, <i class="farg">len</i>, <i class="farg">am</i>, <i class="farg">datasize</i>, <i class="farg">callback</i>, <i class="farg">arg</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Probes the VME space managed by controller <i class="farg">vc</i> at address <i class="farg">vmeaddr</i>, length <i class="farg">len</i>, with address modifiers <i class="farg">am</i> and datasize <i class="farg">datasize</i> for a device. If a VME device is found, the function <i class="farg">callback()</i> (if it is not NULL) is called to perform device-specific identification. <i class="farg">callback()</i> is called with the argument <i class="farg">arg</i>, and the bus-space tag and bus-space handle for accessing the VME space mapping and should return a nonzero positive integer for a positive device match.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">vme_space_map</b>(<i class="farg">vc</i>, <i class="farg">vmeaddr</i>, <i class="farg">len</i>, <i class="farg">am</i>, <i class="farg">datasize</i>, <i class="farg">swap</i>, <i class="farg">tag</i>, <i class="farg">handle</i>, <i class="farg">resc</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Maps the VME space managed by controller <i class="farg">vc</i> at address <i class="farg">vmeaddr</i>, length <i class="farg">len</i>, with address modifiers <i class="farg">am</i>, datasize <i class="farg">datasize</i> and endianness <i class="farg">swap</i> for a device. If the mapping is successful <i class="farg">tag</i> contains the bus-space tag and <i class="farg">handle</i> contains the bus-space handle for accessing the VME space mapping. <i class="farg">resc</i> contains the resources for the mappings. <b class="fname">vme_space_map</b>() returns 0 on success, and nonzero on error.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">vme_space_unmap</b>(<i class="farg">vc</i>, <i class="farg">resc</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Unmaps the VME space mapping managed by controller <i class="farg">vc</i> and resources <i class="farg">resc</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">vme_intr_map</b>(<i class="farg">vc</i>, <i class="farg">level</i>, <i class="farg">vector</i>, <i class="farg">handlep</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Sets <i class="farg">handlep</i> to a machine-dependent value which identifies a particular interrupt source at level <i class="farg">level</i> and vector <i class="farg">vector</i> on the controller <i class="farg">vc</i>. <b class="fname">vme_intr_map</b>() returns zero on success, and nonzero on failure.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">vme_intr_establish</b>(<i class="farg">vc</i>, <i class="farg">handle</i>, <i class="farg">prio</i>, <i class="farg">func</i>, <i class="farg">arg</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Establishes the interrupt handler <i class="farg">handlep</i>. When the device interrupts, <i class="farg">func()</i> will be called with a single argument <i class="farg">arg</i> and will run at the interrupt priority level <i class="farg">prio</i>. The return value of <b class="fname">vme_intr_establish</b>() may be saved and passed to <b class="fname">vme_intr_disestablish</b>().</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">vme_intr_disestablish</b>(<i class="farg">vc</i>, <i class="farg">cookie</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Disables the interrupt handler when the driver is no longer interested in interrupts from the device. <i class="farg">cookie</i> is the value returned by <b class="fname">vme_intr_establish</b>().</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">vme_intr_evcnt</b>(<i class="farg">vc</i>, <i class="farg">handle</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Increment the interrupt event counter for the interrupt specified by <i class="farg">handle</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">vme_dmamap_create</b>(<i class="farg">vc</i>, <i class="farg">size</i>, <i class="farg">am</i>, <i class="farg">datasize</i>, <i class="farg">swap</i>, <i class="farg">nsegs</i>, <i class="farg">segsz</i>, <i class="farg">bound</i>, <i class="farg">flags</i>, <i class="farg">map</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Allocates a DMA handle and initializes it according to the parameters provided. The VME-specific parameters describe the address-space modifiers <i class="farg">am</i>, datasize <i class="farg">datasize</i>, and endianness <i class="farg">swap</i>. The remaining parameters are described in <a class="link-man" href="../9/bus_dma">bus_dma(9)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">vme_dmamap_destroy</b>(<i class="farg">vc</i>, <i class="farg">map</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Frees all resources associated with a given DMA handle. The parameters are described in <a class="link-man" href="../9/bus_dma">bus_dma(9)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">vme_dmamem_alloc</b>(<i class="farg">vc</i>, <i class="farg">size</i>, <i class="farg">am</i>, <i class="farg">datasize</i>, <i class="farg">swap</i>, <i class="farg">segs</i>, <i class="farg">nsegs</i>, <i class="farg">rsegs</i>, <i class="farg">flags</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Allocates memory that is &#8220;DMA safe&#8221; for the VME bus managed by controller <i class="farg">vc</i>. The VME-specific parameters describe the address-space modifiers <i class="farg">am</i>, datasize <i class="farg">datasize</i>, and endianness <i class="farg">swap</i>. The remaining parameters are described in <a class="link-man" href="../9/bus_dma">bus_dma(9)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">vme_dmamem_free</b>(<i class="farg">vc</i>, <i class="farg">segs</i>, <i class="farg">nsegs</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Frees memory previously allocated by <b class="fname">vme_dmamem_alloc</b>() for the VME space managed by controller <i class="farg">vc</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">vme_space_alloc</b>(<i class="farg">tag</i>, <i class="farg">addr</i>, <i class="farg">size</i>, <i class="farg">ams</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Allocate VME space for the bus-space <i class="farg">tag</i> at address <i class="farg">addr</i> of size <i class="farg">size</i> and address-space modifiers <i class="farg">ams</i>. <b class="fname">vme_space_alloc</b>() returns EINVAL on invalid inputs.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">vme_space_free</b>(<i class="farg">vc</i>, <i class="farg">addr</i>, <i class="farg">size</i>, <i class="farg">ams</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Deallocate VME space for the bus-space <i class="farg">tag</i> at address <i class="farg">addr</i> of size <i class="farg">size</i> and address-space modifiers <i class="farg">ams</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">vme_space_get</b>(<i class="farg">vc</i>, <i class="farg">size</i>, <i class="farg">ams</i>, <i class="farg">align</i>, <i class="farg">addr</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Returns EINVAL on invalid inputs.</dd>
</dl>
</div>
<div class="section">
<h1 id="x4155544f434f4e46494755524154494f4e">AUTOCONFIGURATION</h1> The VME bus is an indirect-connection bus. During autoconfiguration each driver is required to probe the bus for the presence of a device. A VME driver will receive a pointer to a <i class="farg">struct vme_attach_args</i> hinting at "locations" (address ranges) on the VME bus where the device may be located. The driver should check the number of address ranges, allocate the address space of these ranges using <b class="fname">vme_space_alloc</b>(), and probe the address space for the device using <b class="fname">vme_probe</b>().<p>
During driver attach the driver should also map the address ranges using <b class="fname">vme_space_map</b>(). The interrupt locators in <i class="farg">struct vme_attach_args</i> are used by <b class="fname">vme_intr_map</b>() and <b class="fname">vme_intr_establish</b>().</div>
<div class="section">
<h1 id="x444d4120535550504f5254">DMA SUPPORT</h1> Extensive DMA facilities are provided.</div>
<div class="section">
<h1 id="x434f4445205245464552454e434553">CODE REFERENCES</h1> The <b class="name">VME</b> subsystem itself is implemented within the file <i class="file">sys/dev/vme/vme.c</i>.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../4/vme">vme(4)</a>, <a class="link-man" href="../9/autoconf">autoconf(9)</a>, <a class="link-man" href="../9/bus_dma">bus_dma(9)</a>, <a class="link-man" href="../9/bus_space">bus_space(9)</a>, <a class="link-man" href="../9/driver">driver(9)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The machine-independent VME subsystem appeared in <span class="unix">NetBSD&#160;1.5</span>.</div>
<div class="section">
<h1 id="x42554753">BUGS</h1> This page is incomplete.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
June 12, 2001</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

