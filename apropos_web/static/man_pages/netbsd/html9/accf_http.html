<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="/static/man_pages/netbsd/style.css" type="text/css" media="all">
<title>
ACCF_HTTP(9)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
ACCF_HTTP(9)</td>
<td class="head-vol" align="center">
Kernel Developer's Manual</td>
<td class="head-rtitle" align="right">
ACCF_HTTP(9)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">accf_http</b> &#8212; <span class="desc">buffer incoming connections until a certain complete HTTP requests arrive</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="config">options INET</b><br>
<b class="config">pseudo-device accf_http</b></div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> This is a filter to be placed on a socket that will be using <b class="fname">accept</b>() to receive incoming HTTP connections.<p>
Once installed on a listening socket, this filter is activated when a connection becomes ready to receive data (at which point <a class="link-man" href="../2/accept">accept(2)</a> would usually return the connected descriptor to the application). The filter prevents the descriptor from being returned immediately to the application via <a class="link-man" href="../2/accept">accept(2)</a>. The descriptor is made available to the application via <a class="link-man" href="../2/accept">accept(2)</a> only when one of the following conditions is met:<ol style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-enum">
<li class="list-enum" style="margin-top: 1.00em;">
A complete, syntactically valid HTTP/1.0 or HTTP/1.1 HEAD or GET request has been buffered by the kernel.</li>
<li class="list-enum" style="margin-top: 1.00em;">
The data buffered by the kernel cannot be part of a complete, syntactically valid HTTP 1.0 or HTTP/1.1 HEAD or GET request.</li>
</ol>
<p>
The utility of <b class="name">accf_http</b> is that a server will not have to context switch several times before performing the initial parsing of the request. This effectively reduces the amount of required CPU utilization to handle incoming requests by keeping active processes in preforking servers such as Apache low and reducing the size of the file descriptor set that needs to be managed by interfaces such as <b class="fname">select</b>(), <b class="fname">poll</b>() or <b class="fname">kevent</b>() based servers.</div>
<div class="section">
<h1 id="x4558414d504c4553">EXAMPLES</h1> If the accf_data accept filter is present in the kernel configuration, this will enable the http accept filter on the socket <i class="farg">sok</i>.<p>
<pre style="margin-left: 0.00in;" class="lit display">
	struct accept_filter_arg afa; 
 
	bzero(&amp;afa, sizeof(afa)); 
	strcpy(afa.af_name, "httpready"); 
	setsockopt(sok, SOL_SOCKET, SO_ACCEPTFILTER, &amp;afa, sizeof(afa));</pre>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../2/setsockopt">setsockopt(2)</a>, <a class="link-man" href="../9/accept_filter">accept_filter(9)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The accept filter mechanism and the <b class="name">accf_http</b> filter were introduced in <span class="unix">FreeBSD&#160;4.0</span>. They were ported to <span class="unix">NetBSD</span> by Coyote Point Systems and appeared in <span class="unix">NetBSD&#160;5.0</span>.</div>
<div class="section">
<h1 id="x415554484f5253">AUTHORS</h1> This manual page and the filter were written by <span class="author">Alfred Perlstein</span>.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
September 4, 2008</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

