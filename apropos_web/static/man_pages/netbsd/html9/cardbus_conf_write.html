<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
CARDBUS(9)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
CARDBUS(9)</td>
<td class="head-vol" align="center">
Kernel Developer's Manual</td>
<td class="head-rtitle" align="right">
CARDBUS(9)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">Cardbus</b>, <b class="name">cardbus_attach_card</b>, <b class="name">cardbus_detach_card</b>, <b class="name">cardbus_function_enable</b>, <b class="name">cardbus_function_disable</b>, <b class="name">cardbus_mapreg_map</b>, <b class="name">cardbus_mapreg_unmap</b>, <b class="name">cardbus_get_capability</b>, <b class="name">cardbus_make_tag</b>, <b class="name">cardbus_conf_read</b>, <b class="name">cardbus_conf_write</b>, <b class="name">cardbus_intr_establish</b>, <b class="name">cardbus_intr_disestablish</b>, <b class="name">CARDBUS_VENDOR</b>, <b class="name">CARDBUS_PRODUCT</b>, <b class="name">Cardbus_function_enable</b>, <b class="name">Cardbus_function_disable</b>, <b class="name">Cardbus_mapreg_map</b>, <b class="name">Cardbus_mapreg_unmap</b>, <b class="name">Cardbus_make_tag</b>, <b class="name">Cardbus_conf_read</b>, <b class="name">Cardbus_conf_write</b> &#8212; <span class="desc">support for CardBus PC-Card devices</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">sys/bus.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">dev/cardbus/cardbusvar.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">dev/cardbus/cardbusreg.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">dev/cardbus/cardbusdevs.h</a>&gt;</b><p>
<i class="ftype">int</i><br>
<b class="fname">cardbus_attach_card</b>(<i class="farg" style="white-space:nowrap;">struct cardbus_softc *csc</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">cardbus_detach_card</b>(<i class="farg" style="white-space:nowrap;">struct cardbus_softc *csc</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">cardbus_function_enable</b>(<i class="farg" style="white-space:nowrap;">struct cardbus_softc *csc</i>, <i class="farg" style="white-space:nowrap;">int function</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">cardbus_function_disable</b>(<i class="farg" style="white-space:nowrap;">struct cardbus_softc *csc</i>, <i class="farg" style="white-space:nowrap;">int function</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">cardbus_mapreg_map</b>(<i class="farg">struct cardbus_softc *csc</i>, <i class="farg">int cf</i>, <i class="farg">int reg</i>, <i class="farg">pcireg_t type</i>, <i class="farg">int busflags</i>, <i class="farg">bus_space_tag_t *tagp</i>, <i class="farg">bus_space_handle_t *handlep</i>, <i class="farg">bus_addr_t *basep</i>, <i class="farg">bus_size_t *sizep</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">cardbus_mapreg_unmap</b>(<i class="farg" style="white-space:nowrap;">struct cardbus_softc *csc</i>, <i class="farg" style="white-space:nowrap;">int cf</i>, <i class="farg" style="white-space:nowrap;">int reg</i>, <i class="farg" style="white-space:nowrap;">bus_space_tag_t tag</i>, <i class="farg" style="white-space:nowrap;">bus_space_handle_t handle</i>, <i class="farg" style="white-space:nowrap;">bus_size_t size</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">cardbus_get_capability</b>(<i class="farg" style="white-space:nowrap;">cardbus_chipset_tag_t cc</i>, <i class="farg" style="white-space:nowrap;">cardbus_function_tag_t cf</i>, <i class="farg" style="white-space:nowrap;">pcitag_t tag</i>, <i class="farg" style="white-space:nowrap;">int capid</i>, <i class="farg" style="white-space:nowrap;">int *offsetp</i>, <i class="farg" style="white-space:nowrap;">pcireg_t *valuep</i>);<p>
<i class="ftype">pcitag_t</i><br>
<b class="fname">cardbus_make_tag</b>(<i class="farg" style="white-space:nowrap;">cardbus_chipset_tag_t cc</i>, <i class="farg" style="white-space:nowrap;">int cf</i>, <i class="farg" style="white-space:nowrap;">int bus</i>, <i class="farg" style="white-space:nowrap;">int device</i>, <i class="farg" style="white-space:nowrap;">int function</i>);<p>
<i class="ftype">pcireg_t</i><br>
<b class="fname">cardbus_conf_read</b>(<i class="farg" style="white-space:nowrap;">cardbus_chipset_tag_t cc</i>, <i class="farg" style="white-space:nowrap;">int cf</i>, <i class="farg" style="white-space:nowrap;">pcitag_t tag</i>, <i class="farg" style="white-space:nowrap;">int offs</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">cardbus_conf_write</b>(<i class="farg" style="white-space:nowrap;">cardbus_chipset_tag_t cc</i>, <i class="farg" style="white-space:nowrap;">int cf</i>, <i class="farg" style="white-space:nowrap;">pcitag_t tag</i>, <i class="farg" style="white-space:nowrap;">int offs</i>, <i class="farg" style="white-space:nowrap;">busreg_t val</i>);<p>
<i class="ftype">void *</i><br>
<b class="fname">cardbus_intr_establish</b>(<i class="farg" style="white-space:nowrap;">cardbus_chipset_tag_t cc</i>, <i class="farg" style="white-space:nowrap;">cardbus_function_tag_t cf</i>, <i class="farg" style="white-space:nowrap;">cardbus_intr_handle_t irq</i>, <i class="farg" style="white-space:nowrap;">int level</i>, <i class="farg" style="white-space:nowrap;">int (*handler)(void *)</i>, <i class="farg" style="white-space:nowrap;">void *arg</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">cardbus_intr_disestablish</b>(<i class="farg" style="white-space:nowrap;">cardbus_chipset_tag_t cc</i>, <i class="farg" style="white-space:nowrap;">cardbus_function_tag_t cf</i>, <i class="farg" style="white-space:nowrap;">void *ih</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">CARDBUS_VENDOR</b>(<i class="farg" style="white-space:nowrap;">pcireg_t id</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">CARDBUS_PRODUCT</b>(<i class="farg" style="white-space:nowrap;">pcireg_t id</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">Cardbus_function_enable</b>(<i class="farg" style="white-space:nowrap;">cardbus_devfunc_t ct</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">Cardbus_function_disable</b>(<i class="farg" style="white-space:nowrap;">cardbus_devfunc_t ct</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">Cardbus_mapreg_map</b>(<i class="farg" style="white-space:nowrap;">cardbus_devfunc_t ct</i>, <i class="farg" style="white-space:nowrap;">int reg</i>, <i class="farg" style="white-space:nowrap;">pcireg_t type</i>, <i class="farg" style="white-space:nowrap;">int busflags</i>, <i class="farg" style="white-space:nowrap;">bus_space_tag_t *tagp</i>, <i class="farg" style="white-space:nowrap;">bus_space_handle_t *handlep</i>, <i class="farg" style="white-space:nowrap;">bus_addr_t *basep</i>, <i class="farg" style="white-space:nowrap;">bus_size_t *sizep</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">Cardbus_mapreg_unmap</b>(<i class="farg" style="white-space:nowrap;">cardbus_devfunc_t ct</i>, <i class="farg" style="white-space:nowrap;">int reg</i>, <i class="farg" style="white-space:nowrap;">bus_space_tag_t tag</i>, <i class="farg" style="white-space:nowrap;">bus_space_handle_t handle</i>, <i class="farg" style="white-space:nowrap;">bus_size_t size</i>);<p>
<i class="ftype">pcitag_t</i><br>
<b class="fname">Cardbus_make_tag</b>(<i class="farg" style="white-space:nowrap;">cardbus_devfunc_t ct</i>);<p>
<i class="ftype">pcireg_t</i><br>
<b class="fname">Cardbus_conf_read</b>(<i class="farg" style="white-space:nowrap;">cardbus_devfunc_t ct</i>, <i class="farg" style="white-space:nowrap;">pcitag_t tag</i>, <i class="farg" style="white-space:nowrap;">int offs</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">Cardbus_conf_write</b>(<i class="farg" style="white-space:nowrap;">cardbus_devfunc_t ct</i>, <i class="farg" style="white-space:nowrap;">pcitag_t tag</i>, <i class="farg" style="white-space:nowrap;">int offs</i>, <i class="farg" style="white-space:nowrap;">busreg_t val</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The machine-independent <b class="name">Cardbus</b> subsystem provides support for CardBus devices.<p>
The CardBus interface is an improvement to the PC-Card interface supported by <a class="link-man" href="../html9/pcmcia.html">pcmcia(9)</a>. It introduces several new capabilities such as 32-bit addressing, 33MHz operation, busmaster operation and 3.3 volt low-voltage power. It remains compatible with all features of the PC-Card standard.<p>
The CardBus interface signaling protocol is derived from the PCI signaling protocol. There are some differences between PCI and CardBus, however operations are identical for most functions implemented. Since a 32-bit CardBus interface is also defined for 16-bit PC-Cards, the same Card Services client to be used to manage both CardBus and PCMCIA PC-Cards. By interrogating the card upon detection of an insertion event, <span class="unix">NetBSD</span> determines whether the card requires <b class="name">Cardbus</b> support or not, and then applies the appropriate power and signaling protocol requirements.</div>
<div class="section">
<h1 id="x44415441205459504553">DATA TYPES</h1> Drivers attached to the CardBus will make use of the following data types:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
struct cardbus_attach_args</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Devices have their identity recorded in this structure. It contains the following members:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
	cardbus_devfunc_t ca_ct; 
	bus_space_tag_t ca_iot;       /* CardBus I/O space tag */ 
	bus_space_tag_t ca_memt;      /* CardBus MEM space tag */ 
	bus_dma_tag_t ca_dmat;        /* DMA tag */ 
	u_int ca_device; 
	pcitag_t ca_tag; 
	pcireg_t ca_id; 
	pcireg_t ca_class; 
	cardbus_intr_line_t ca_intrline; /* interrupt info */ 
	struct cardbus_cis_info ca_cis;</pre>
</dd>
</dl>
</div>
<div class="section">
<h1 id="x46554e4354494f4e53">FUNCTIONS</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">cardbus_attach_card</b>(<i class="farg">csc</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Attaches the card on the slot by turning on the power, read and analyse the tuple and sets configuration index. This function returns the number of recognised device functions. If no device functions are recognised it returns zero.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">cardbus_detach_card</b>(<i class="farg">csc</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Detaches the card on the slot by release resources and turning off the power. This function must not be called under interrupt context.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">cardbus_function_enable</b>(<i class="farg">csc</i>, <i class="farg">function</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Enables device function <i class="farg">function</i> on the card. Power will be applied if it hasn't already.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">cardbus_function_disable</b>(<i class="farg">csc</i>, <i class="farg">function</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Disables device function <i class="farg">function</i> on the card. When no device functions are enabled, the turn is turned off.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">cardbus_mapreg_map</b>(<i class="farg">csc</i>, <i class="farg">cf</i>, <i class="farg">reg</i>, <i class="farg">type</i>, <i class="farg">busflags</i>, <i class="farg">tagp</i>, <i class="farg">handlep</i>, <i class="farg">basep</i>, <i class="farg">sizep</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Maps bus-space on the value of Base Address Register (BAR) indexed by <i class="farg">reg</i> for device function <i class="farg">cf</i>. The bus-space configuration is returned in <i class="farg">tagp</i>, <i class="farg">handlep</i>, <i class="farg">basep</i>, and <i class="farg">sizep</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">cardbus_mapreg_unmap</b>(<i class="farg">csc</i>, <i class="farg">cf</i>, <i class="farg">reg</i>, <i class="farg">tag</i>, <i class="farg">handle</i>, <i class="farg">bus_size_t size</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Releases bus-space region for device function <i class="farg">cf</i> specified by <i class="farg">tag</i>, <i class="farg">handle</i> and <i class="farg">size</i>. <i class="farg">reg</i> is the offset of the BAR register.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">cardbus_get_capability</b>(<i class="farg">cc</i>, <i class="farg">cf</i>, <i class="farg">tag</i>, <i class="farg">capid</i>, <i class="farg">offsetp</i>, <i class="farg">valuep</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Find the PCI capability for the device function <i class="farg">cf</i> specified by <i class="farg">capid</i>. Returns the capability in <i class="farg">offsetp</i> and <i class="farg">valuep</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">cardbus_make_tag</b>(<i class="farg">cc</i>, <i class="farg">cf</i>, <i class="farg">bus</i>, <i class="farg">device</i>, <i class="farg">function</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Make a tag to access config space of a CardBus card. It works the same as <b class="fname">pci_make_tag</b>().</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">cardbus_conf_read</b>(<i class="farg">cc</i>, <i class="farg">cf</i>, <i class="farg">tag</i>, <i class="farg">offs</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Read the config space of a CardBus card. It works the same as <b class="fname">pci_conf_read</b>().</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">cardbus_conf_write</b>(<i class="farg">cc</i>, <i class="farg">cf</i>, <i class="farg">tag</i>, <i class="farg">offs</i>, <i class="farg">val</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Write to the config space of a CardBus card. It works same as <b class="fname">pci_conf_write</b>().</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">cardbus_intr_establish</b>(<i class="farg">cc</i>, <i class="farg">cf</i>, <i class="farg">irq</i>, <i class="farg">level</i>, <i class="farg">handler</i>, <i class="farg">arg</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Establish an interrupt handler for device function <i class="farg">cf</i>. The priority of the interrupt is specified by <i class="farg">level</i>. When the interrupt occurs the function <i class="farg">handler</i> is called with argument <i class="farg">arg</i>. The return value is a handle for the interrupt handler. <b class="fname">cardbus_intr_establish</b>() returns an opaque handle to an event descriptor if it succeeds, and returns NULL on failure.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">cardbus_intr_disestablish</b>(<i class="farg">cc</i>, <i class="farg">cf</i>, <i class="farg">ih</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Dis-establish the interrupt handler for device function <i class="farg">cf</i> with handle <i class="farg">ih</i>. The handle was returned from <b class="fname">cardbus_intr_establish</b>().</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">CARDBUS_VENDOR</b>(<i class="farg">id</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Return the CardBus vendor ID for device <i class="farg">id</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">CARDBUS_PRODUCT</b>(<i class="farg">id</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Return the CardBus product ID for device <i class="farg">id</i>.</dd>
</dl>
<p>
The <b class="fname">Cardbus_*</b>() functions are convenience functions taking a <i class="farg">cardbus_devfunc_t</i> argument and perform the same operation as their namesake described above.</div>
<div class="section">
<h1 id="x4155544f434f4e46494755524154494f4e">AUTOCONFIGURATION</h1> During autoconfiguration, a <b class="name">Cardbus</b> driver will receive a pointer to <i class="farg">struct isapnp_attach_args</i> describing the device attaches to the CardBus. Drivers match the device using the <i class="farg">ca_id</i> member using <b class="fname">CARDBUS_VENDOR</b>() and <b class="fname">CARDBUS_PRODUCT</b>().<p>
During the driver attach step, drivers should initially map the device I/O and memory resources using <b class="fname">cardbus_mapreg_map</b>() or <b class="fname">Cardbus_mapreg_map</b>(). Upon successful allocation of resources, power can be applied to the device with <b class="fname">cardbus_function_enable</b>() or <b class="fname">Cardbus_function_enable</b>(). so that device-specific interrogation can be performed. Finally, power should be removed from the device using <b class="fname">cardbus_function_disable</b>() or <b class="fname">Cardbus_function_disable</b>().<p>
Since CardBus devices support dynamic configuration, drivers should make use of <b class="fname">pmf</b>(<i class="farg">9</i>) framework. Power can be applied and the interrupt handler should be established through this interface.</div>
<div class="section">
<h1 id="x444d4120535550504f5254">DMA SUPPORT</h1> No additional support is provided for CardBus DMA beyond the facilities provided by the <a class="link-man" href="../html9/bus_dma.html">bus_dma(9)</a> interface.</div>
<div class="section">
<h1 id="x434f4445205245464552454e434553">CODE REFERENCES</h1> The CardBus subsystem itself is implemented within the files <i class="file">sys/dev/cardbus/cardbus.c</i>, <i class="file">sys/dev/cardbus/cardbus_map.c</i> and <i class="file">sys/dev/cardbus/cardslot.c</i>. The database for PCI devices is also used for known CardBus devices. For more details see <a class="link-man" href="../html9/pci.html">pci(9)</a>.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html4/cardbus.html">cardbus(4)</a>, <a class="link-man" href="../html4/pcmcia.html">pcmcia(4)</a>, <a class="link-man" href="../html9/autoconf.html">autoconf(9)</a>, <a class="link-man" href="../html9/bus_dma.html">bus_dma(9)</a>, <a class="link-man" href="../html9/bus_space.html">bus_space(9)</a>, <a class="link-man" href="../html9/driver.html">driver(9)</a>, <a class="link-man" href="../html9/pci.html">pci(9)</a>, <a class="link-man" href="../html9/pcmcia.html">pcmcia(9)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The machine-independent <b class="name">Cardbus</b> subsystem appeared in <span class="unix">NetBSD&#160;1.5</span>.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
July 13, 2014</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

