<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
DEVSW_ATTACH(9)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
DEVSW_ATTACH(9)</td>
<td class="head-vol" align="center">
Kernel Developer's Manual</td>
<td class="head-rtitle" align="right">
DEVSW_ATTACH(9)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">devsw_attach</b>, <b class="name">devsw_detach</b>, <b class="name">bdevsw_lookup</b>, <b class="name">cdevsw_lookup</b>, <b class="name">bdevsw_lookup_major</b>, <b class="name">cdevsw_lookup_major</b> &#8212; <span class="desc">character and block device switch functions</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">sys/conf.h</a>&gt;</b><p>
<i class="ftype">int</i><br>
<b class="fname">devsw_attach</b>(<i class="farg">const char *devname</i>, <i class="farg">const struct bdevsw *bev</i>, <i class="farg">devmajor_t *bmajor</i>, <i class="farg">const struct cdevsw *cdev</i>, <i class="farg">devmajor_t *cmajor</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">devsw_detach</b>(<i class="farg">const struct bdevsw *bdev</i>, <i class="farg">const struct cdevsw *cdev</i>);<p>
<i class="ftype">const struct bdevsw *</i><br>
<b class="fname">bdevsw_lookup</b>(<i class="farg">dev_t dev</i>);<p>
<i class="ftype">const struct cdevsw *</i><br>
<b class="fname">cdevsw_lookup</b>(<i class="farg">dev_t dev</i>);<p>
<i class="ftype">devmajor_t</i><br>
<b class="fname">bdevsw_lookup_major</b>(<i class="farg">const struct bdevsw *bdev</i>);<p>
<i class="ftype">devmajor_t</i><br>
<b class="fname">cdevsw_lookup_major</b>(<i class="farg">const struct cdevsw *cdev</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> If a device driver has character device interfaces accessed from userland, the driver must define a <span class="emph">cdevsw</span> structure. If the driver also has block device interfaces, the driver must additionally define a <span class="emph">bdevsw</span> structure. These structures are constant, and are defined within the <a class="link-man" href="../9/driver">driver(9)</a>.<p>
For drivers which are included in the kernel via <a class="link-man" href="../1/config">config(1)</a>, the <span class="emph">cdevsw</span> and <span class="emph">bdevsw</span> structures are automatically linked into the configuration database. For drivers which are separately loaded, the <b class="fname">devsw_attach</b>() function creates the necessary linkage and associates the <span class="emph">cdev</span> and optional <span class="emph">bdev</span> with the <a class="link-man" href="../9/driver">driver(9)</a>. If there is no block device interface needed, <span class="emph">bdev</span> should be set to <span class="define">NULL</span> and <span class="emph">bmajor</span> to <span class="define">&#45;1</span>. The <span class="emph">devname</span>, major number, and device type (character or block) must correspond to the device file which will be opened by user programs. By passing <span class="define">&#45;1</span> to the function for the <span class="emph">cmajor</span> or <span class="emph">bmajor</span>, the major number can be automatically generated. It can then be returned to userspace (for example, using <a class="link-man" href="../8/sysctl">sysctl(8)</a>) for creation of the device node.<p>
The <b class="fname">devsw_detach</b>() function is used to detach the <span class="emph">bdev</span> and <span class="emph">cdev</span> structures. <b class="fname">devsw_detach</b>() should be called before a loaded device driver is unloaded.<p>
The <b class="fname">bdevsw_lookup</b>() and <b class="fname">cdevsw_lookup</b>() functions return <span class="emph">const struct bdevsw *</span> and <span class="emph">const struct cdevsw *</span> for the given <span class="emph">dev</span>.<p>
The <b class="fname">bdevsw_lookup_major</b>() and <b class="fname">cdevsw_lookup_major</b>() functions return <span class="emph">devmajor_t</span> for the given <span class="emph">const struct bdevsw *</span> or <span class="emph">const struct cdevsw *</span>.</div>
<div class="section">
<h1 id="x52455455524e2056414c554553">RETURN VALUES</h1> Upon successful completion, <b class="fname">devsw_attach</b>() and <b class="fname">devsw_detach</b>() return 0. Otherwise they return an error value.<p>
In case of failure, <b class="fname">bdevsw_lookup</b>() and <b class="fname">cdevsw_lookup</b>() return the <span class="define">NULL</span> value.<p>
The <b class="fname">bdevsw_lookup_major</b>() and <b class="fname">cdevsw_lookup_major</b>() functions return <span class="define">NODEVMAJOR</span> for an unsuccessful completion.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../9/driver">driver(9)</a></div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
May 13, 2015</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

