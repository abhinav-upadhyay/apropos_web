<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="/static/man_pages/netbsd/style.css" type="text/css" media="all">
<title>
NMI(9) (x86)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
NMI(9)</td>
<td class="head-vol" align="center">
Kernel Developer's Manual (x86)</td>
<td class="head-rtitle" align="right">
NMI(9)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">nmi</b>, <b class="name">nmi_establish</b>, <b class="name">nmi_disestablish</b>, &#8212; <span class="desc">NMI</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">x86/nmi.h</a>&gt;</b><p>
<i class="ftype">nmi_handler_t *</i><br>
<b class="fname">nmi_establish</b>(<i class="farg" style="white-space:nowrap;">int (*func)(const struct trapframe *, void *)</i>, <i class="farg" style="white-space:nowrap;">void *arg</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">nmi_disestablish</b>(<i class="farg" style="white-space:nowrap;">nmi_handler_t *handle</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="name">nmi</b> interface lets the kernel establish handlers for x86 Non-Maskable Interrupts (NMIs). An NMI signals to the processor an exception on a processor, memory controller, or I/O bus that is irrecoverable or else needs attention at a high priority. A &#8220;debug switch&#8221; or a performance/watchdog timer may also trigger an NMI.<p>
An NMI handler will run to completion on the same processor where it began without being preempted by any thread or interrupt except for another NMI. An NMI handler must prepare for re-entry. An NMI handler may run simultaneously on more than one CPU.<p>
Synchronizing access to a shared data structure from an NMI handler is a different challenge than synchronizing access from hardware/software interrupt routines or from kernel threads. An NMI handler may not perform any operation that may sleep, acquire a mutex, or schedule a software interrupt. An NMI handler may use <a class="link-man" href="../../3/atomic_ops">atomic_ops(3)</a>. An NMI handler may reference per-CPU storage (<a class="link-man" href="../../9/percpu">percpu(9)</a>).<p>
An NMI handler may not write to the kernel message buffer.</div>
<div class="section">
<h1 id="x46554e4354494f4e53">FUNCTIONS</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">nmi_establish</b>(<i class="farg">func</i>, <i class="farg">arg</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Call this in thread context to establish a handler for non-maskable interrupts. Establish <i class="farg">func</i> as one of the handler functions to call when an NMI occurs. Where <i class="farg">tf</i> is a <span class="type">struct trapframe</span> representation of the processor context where the NMI was received, and <i class="farg">arg</i> is the argument to <b class="fname">nmi_establish</b>(), the kernel will call <b class="fname">(*func)</b>(<i class="farg">tf</i>, <i class="farg">arg</i>); every time an NMI occurs until the handler is removed with <b class="fname">nmi_disestablish</b>(). <i class="farg">func</i> should return non-zero if it handled a condition that causes NMI, or zero if it did not. If, for a given NMI, all handlers return zero, the system will panic or enter the kernel debugger, <a class="link-man" href="../../4/ddb">ddb(4)</a>. <b class="fname">nmi_establish</b>() returns <span class="define">NULL</span> on failure, and a handle for the NMI handler on success.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">nmi_disestablish</b>(<i class="farg">handle</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Call this in thread context to stop the kernel from calling an NMI handler. Indicate the handler to disestablish with the <i class="farg">handle</i> returned by <b class="fname">nmi_establish</b>().</dd>
</dl>
</div>
<div class="section">
<h1 id="x434f4445205245464552454e434553">CODE REFERENCES</h1> The <b class="name">nmi</b> interface is implemented within the file <i class="file">sys/arch/x86/x86/nmi.c</i>.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../../3/atomic_ops">atomic_ops(3)</a>, <a class="link-man" href="../../4/ddb">ddb(4)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="name">nmi</b> interface first appeared in <span class="unix">NetBSD&#160;6.0</span>.</div>
<div class="section">
<h1 id="x415554484f5253">AUTHORS</h1> <span class="author">YAMAMOTO Takashi</span> &#60;<a class="link-mail" href="mailto:yamt@NetBSD.org">yamt@NetBSD.org</a>&#62;</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
March 17, 2011</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

