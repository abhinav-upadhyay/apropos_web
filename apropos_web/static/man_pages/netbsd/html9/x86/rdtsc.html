<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../../style.css" type="text/css" media="all">
<title>
TSC(9) (x86)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
TSC(9)</td>
<td class="head-vol" align="center">
Kernel Developer's Manual (x86)</td>
<td class="head-rtitle" align="right">
TSC(9)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">tsc</b> &#8212; <span class="desc">Time Stamp Counter</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">x86/x86/tsc.h</a>&gt;</b><p>
<i class="ftype">uint64_t</i><br>
<b class="fname">rdtsc</b>(<i class="farg" style="white-space:nowrap;">void</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">tsc_tc_init</b>(<i class="farg" style="white-space:nowrap;">void</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">tsc_sync_ap</b>(<i class="farg" style="white-space:nowrap;">struct cpu_info *ci</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">tsc_sync_bp</b>(<i class="farg" style="white-space:nowrap;">struct cpu_info *ci</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">tsc_sync_drift</b>(<i class="farg" style="white-space:nowrap;">int64_t drift</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The time stamp counter (TSC) is a hardware counter found in all contemporary x86 processors. The counter is implemented as a 64-bit model-specific register (MSR) that is incremented at every clock cycle. The RDTSC (&#8220;read time stamp counter&#8221;) register has been present since the original Pentium.<p>
Already because of the access method, TSC provides a low-overhead and high-resolution way to obtain CPU timing information. This traditional premise was violated when such factors as system sleep states, CPU &#8220;hotplugging&#8221;, &#8220;hibernation&#8221;, and CPU frequency scaling were introduced to the x86 lineage. This was however mainly a short abruption: in many new x86 CPUs the time stamp counter is again invariant with respect to the stability of the clock frequency. Care should be however taken in implementations that rely on this assumption.</div>
<div class="section">
<h1 id="x46554e4354494f4e53">FUNCTIONS</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">rdtsc</b>(<i class="farg"></i>)</dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
The <b class="fname">rdtsc</b>() function returns the value read from <span class="define">RDTSC</span>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">tsc_tc_init</b>(<i class="farg"></i>)</dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
The <b class="fname">tsc_tc_init</b>() function initializes the TSC as a <a class="link-man" href="../../9/timecounter">timecounter(9)</a>. The function is called early in the boot process when the processors attach.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">tsc_sync_bp</b>(<i class="farg">ci</i>)</dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
The <b class="fname">tsc_sync_bp</b>() function synchronizes the counter for the boot processor (BP). The supplied <i class="farg">ci</i> must refer to the BP itself. The <b class="name">tsc</b> interface takes internally care of such issues as out-of-order execution, where instructions are not necessarily performed in the order of execution, possibly causing a misleading cycle count.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">tsc_sync_ap</b>(<i class="farg">ci</i>)</dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
The <b class="fname">tsc_sync_ap</b>() function synchronize the counter for the application processor <i class="farg">ci</i>. Interrupts must be off at machine-level when the function is called.<p>
It is necessary to call both <b class="fname">tsc_sync_ap</b>() and <b class="fname">tsc_sync_bp</b>() during the boot, but additional synchronization may be required also during runtime. As an example, the TSC needs to be synchronized for all processors when the system resumes from an <a class="link-man" href="../../4/acpi">acpi(4)</a> sleep state.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">tsc_sync_drift</b>(<i class="farg">drift</i>)</dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
Finally, the <b class="fname">tsc_sync_drift</b>() function records <i class="farg">drift</i>, measured in clock cycles. This is called when the APs attach.</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../../2/gettimeofday">gettimeofday(2)</a>, <a class="link-man" href="../../4/hpet">hpet(4)</a>, <a class="link-man" href="../../9/hz">hz(9)</a>, <a class="link-man" href="../../9/rdmsr">rdmsr(9)</a>, <a class="link-man" href="../../9/timecounter">timecounter(9)</a></div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
April 4, 2015</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

