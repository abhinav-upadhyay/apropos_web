<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="/static/man_pages/netbsd/style.css" type="text/css" media="all">
<title>
ISAPNP(9)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
ISAPNP(9)</td>
<td class="head-vol" align="center">
Kernel Developer's Manual</td>
<td class="head-rtitle" align="right">
ISAPNP(9)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">ISAPNP</b>, <b class="name">isapnp_devmatch</b>, <b class="name">isapnp_config</b>, <b class="name">isapnp_unconfig</b> &#8212; <span class="desc">Plug 'n' Play ISA bus</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">sys/bus.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">dev/isa/isareg.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">dev/isa/isavar.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">dev/isapnp/isapnpreg.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">dev/isapnp/isapnpvar.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">dev/isapnp/isapnpdevs.h</a>&gt;</b><p>
<i class="ftype">int</i><br>
<b class="fname">isapnp_devmatch</b>(<i class="farg" style="white-space:nowrap;">const struct isapnp_attach_args *ipa</i>, <i class="farg" style="white-space:nowrap;">const struct isapnp_devinfo *dinfo</i>, <i class="farg" style="white-space:nowrap;">int *variant</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">isapnp_config</b>(<i class="farg" style="white-space:nowrap;">bus_space_tag_t iot</i>, <i class="farg" style="white-space:nowrap;">bus_space_tag_t memt</i>, <i class="farg" style="white-space:nowrap;">struct isapnp_attach_args *ipa</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">isapnp_unconfig</b>(<i class="farg" style="white-space:nowrap;">bus_space_tag_t iot</i>, <i class="farg" style="white-space:nowrap;">bus_space_tag_t memt</i>, <i class="farg" style="white-space:nowrap;">struct isapnp_attach_args *ipa</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The machine-independent <b class="name">ISAPNP</b> subsystem provides support for ISAPNP devices. ISAPNP devices were developed to support "plug and play" connection on the ISA bus. In all other aspects, the ISAPNP bus is same as the ISA bus (see <a class="link-man" href="../9/isa">isa(9)</a>).<p>
Devices on the ISAPNP bus are uniquely identified by a 7-character string. Resources, such as I/O address space and interrupts, should be allocated to the devices by the machine firmware. On some machine the firmware seems doesn't work correctly and <span class="unix">NetBSD</span> will attempt to allocate resources as necessary.</div>
<div class="section">
<h1 id="x44415441205459504553">DATA TYPES</h1> Drivers attached to the ISAPNP bus will make use of the following data types:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">struct isapnp_matchinfo</i></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
<span class="unix">NetBSD</span> kernel contains a database of known ISAPNP devices. Each entry in the database has a <span class="emph">struct isapnp_matchinfo</span>. It contains the following members:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
	const char *name;		/* device id string */ 
	int variant;			/* variant flag */</pre>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">struct isapnp_devinfo</i></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Defines the devices supported by a driver. It contains pointer to an array of supported <span class="emph">struct isapnp_matchinfo</span> structures and a pointer to another array of compatibility devices. It contains the following members:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
	struct isapnp_matchinfo *devlogic; 
	int nlogic; 
	struct isapnp_matchinfo *devcompat; 
	int ncompat;</pre>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">struct isapnp_region</i></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Describes ISAPNP bus-space regions. It contains the following members:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
	bus_space_handle_t h; 
	uint32_t base; 
	uint32_t length;</pre>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">struct isapnp_pin</i></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Describes the wiring of interrupts and DMA pins from the ISAPNP bus onto the host processor. It contains the following members:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
	uint8_t  num; 
	uint8_t  flags:4; 
	uint8_t  type:4; 
	uint16_t bits;</pre>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">struct isapnp_attach_args</i></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
A structure used to inform the driver of the device properties. It contains the following members:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
	bus_space_tag_t	ipa_iot;	/* isa i/o space tag */ 
	bus_space_tag_t	ipa_memt;	/* isa mem space tag */ 
	bus_dma_tag_t	ipa_dmat;	/* isa dma tag */ 
	isa_chipset_tag_t	ipa_ic; 
	struct isapnp_region    ipa_io[ISAPNP_NUM_IO]; 
	struct isapnp_region    ipa_mem[ISAPNP_NUM_MEM]; 
	struct isapnp_region    ipa_mem32[ISAPNP_NUM_MEM32]; 
	struct isapnp_pin       ipa_irq[ISAPNP_NUM_IRQ]; 
	struct isapnp_pin       ipa_drq[ISAPNP_NUM_DRQ];</pre>
</dd>
</dl>
</div>
<div class="section">
<h1 id="x46554e4354494f4e53">FUNCTIONS</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">isapnp_devmatch</b>(<i class="farg">ipa</i>, <i class="farg">dinfo</i>, <i class="farg">variant</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Matches the device described by the attachment <i class="farg">ipa</i> with the device-match information in <i class="farg">dinfo</i>. If the device is matched, <b class="fname">isapnp_devmatch</b>() returns a non-zero value and variant is the flag describing the device variant. <b class="fname">isapnp_devmatch</b>() returns zero if the device is not found.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">isapnp_config</b>(<i class="farg">iot</i>, <i class="farg">memt</i>, <i class="farg">ipa</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Allocate device resources specified by <i class="farg">ipa</i>. The device is mapped into the I/O and memory bus spaces specified by bus-space tags <i class="farg">iot</i> and <i class="farg">memt</i> respectively. The <i class="farg">ipa_io</i>, <i class="farg">ipa_mem</i>, <i class="farg">ipa_mem32</i>, <i class="farg">ipa_irq</i>, and <i class="farg">ipa_drq</i> members of <i class="farg">ipa</i> are updated to reflect the allocated and mapped resources. <b class="fname">isapnp_config</b>() returns zero on success and non-zero on error.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">isapnp_unconfig</b>(<i class="farg">iot</i>, <i class="farg">memt</i>, <i class="farg">ipa</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Free the resources allocated by <b class="fname">isapnp_config</b>().</dd>
</dl>
</div>
<div class="section">
<h1 id="x4155544f434f4e46494755524154494f4e">AUTOCONFIGURATION</h1> During autoconfiguration, an ISAPNP driver will receive a pointer to <i class="farg">struct isapnp_attach_args</i> describing the device attached to the ISAPNP bus. Drivers match the device using <b class="fname">ispnp_devmatch</b>().<p>
During the driver attach step, driver should initially allocate and map resources using <b class="fname">isapnp_config</b>(). The I/O (memory) bus-space resources can be accessed using the bus-space tag <i class="farg">ipa_iot</i> (<i class="farg">ipa_memt</i>) and the bus-space handle <i class="farg">ipa_io[0].h</i> (<i class="farg">ipa_mem[0].h</i>) members of <i class="farg">ipa</i>.<p>
Interrupts should be established using <b class="fname">isa_intr_establish</b>() (see <a class="link-man" href="../9/isa">isa(9)</a>) with the IRQ specified by the <i class="farg">ipa_irq[0].num</i> member of <i class="farg">ipa</i>. Similarly, the standard <a class="link-man" href="../9/isa">isa(9)</a> DMA interface should be used with the <i class="farg">ipa_drq[0].num</i> member of <i class="farg">ipa</i>.</div>
<div class="section">
<h1 id="x444d4120535550504f5254">DMA SUPPORT</h1> Extensive DMA facilities are provided through the <a class="link-man" href="../9/isa">isa(9)</a> DMA facilities.</div>
<div class="section">
<h1 id="x434f4445205245464552454e434553">CODE REFERENCES</h1> The <b class="name">ISAPNP</b> subsystem itself is implemented within the file <i class="file">sys/dev/isapnp/isapnp.c</i>. The database of the known devices exists within the file <i class="file">sys/dev/isapnp/isapnpdevs.c</i> and is generated automatically from the file <i class="file">sys/dev/isapnp/isapnpdevs</i>. New devices should be added to this file. The database can be regenerated using the Makefile <i class="file">sys/dev/isapnp/Makefile.isapnpdevs</i>.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../4/isa">isa(4)</a>, <a class="link-man" href="../4/isapnp">isapnp(4)</a>, <a class="link-man" href="../4/pnpbios">pnpbios(4)</a>, <a class="link-man" href="../9/autoconf">autoconf(9)</a>, <a class="link-man" href="../9/bus_dma">bus_dma(9)</a>, <a class="link-man" href="../9/bus_space">bus_space(9)</a>, <a class="link-man" href="../9/driver">driver(9)</a>, <a class="link-man" href="../9/isa">isa(9)</a><p>
<span class="ref"><span class="ref-title">Plug and Play ISA Specification V1.0a</span>, <span class="ref-date">May 5 1994</span>.</span></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The machine-independent ISAPNP subsystem appear in <span class="unix">NetBSD&#160;1.3</span>.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
June 19, 2001</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

