<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/../4/strict.dtd">
>
<head>
<meta http-equiv="Content-Type" content="te../; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
MCA(9)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
MCA(9)</td>
<td class="head-vol" align="center">
Kernel Developer's Manual</td>
<td class="head-rtitle" align="right">
MCA(9)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">MCA</b>, <b class="name">mca_intr_establish</b>, <b class="name">mca_intr_disestablish</b>, <b class="name">mca_intr_evcnt</b>, <b class="name">mca_conf_read</b>, <b class="name">mca_conf_write</b> &#8212; <span class="desc">MicroChannel Architecture bus</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">sys/bus.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">dev/mca/mcavar.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">dev/mca/mcadevs.h</a>&gt;</b><p>
<i class="ftype">void *</i><br>
<b class="fname">mca_intr_establish</b>(<i class="farg" style="white-space:nowrap;">mca_chipset_tag_t mc</i>, <i class="farg" style="white-space:nowrap;">mca_intr_handle_t hdl</i>, <i class="farg" style="white-space:nowrap;">int level</i>, <i class="farg" style="white-space:nowrap;">int (*handler)(void *)</i>, <i class="farg" style="white-space:nowrap;">void *arg</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">mca_intr_disestablish</b>(<i class="farg" style="white-space:nowrap;">mca_chipset_tag_t mc</i>, <i class="farg" style="white-space:nowrap;">mca_intr_handle_t hdl</i>);<p>
<i class="ftype">const struct evcnt *</i><br>
<b class="fname">mca_intr_evcnt</b>(<i class="farg" style="white-space:nowrap;">mca_chipset_tag_t mc</i>, <i class="farg" style="white-space:nowrap;">mca_intr_handle_t hdl</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">mca_conf_read</b>(<i class="farg" style="white-space:nowrap;">mca_chipset_tag_t mc</i>, <i class="farg" style="white-space:nowrap;">int slot</i>, <i class="farg" style="white-space:nowrap;">int reg</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">mca_conf_write</b>(<i class="farg" style="white-space:nowrap;">mca_chipset_tag_t mc</i>, <i class="farg" style="white-space:nowrap;">int slot</i>, <i class="farg" style="white-space:nowrap;">int reg</i>, <i class="farg" style="white-space:nowrap;">int data</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="name">MCA</b> device provides support for IBM's MicroChannel Architecture bus found on IBM PS/2 systems and selected workstations. It was designed as a replacement bus for the ISA bus found on IBM's older machines. However, the bus specifications were only available under license, so MCA did not achieve widespread acceptance in the industry.<p>
Being a replacement for the ISA bus, the MCA bus does share some similar aspects with the ISA bus. Some MCA devices can be detected via the usual ISA-style probing. However, most device detection is done through the Programmable Option Select (POS) registers. These registers provide a window into a device to determine device-specific properties and configuration. The configuration of devices and their POS registers is performed using IBM's system configuration software.<p>
The MCA bus uses level-triggered interrupts while the ISA bus uses edge-triggered interrupts. Level triggered interrupts have the advantage that they can be shared among multiple device. Therefore, most MCA-specific devices should be coded with shared interrupts in mind.</div>
<div class="section">
<h1 id="x44415441205459504553">DATA TYPES</h1> Drivers for devices attached to the MCA bus will make use of the following data types:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">mca_chipset_tag_t</i></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Chipset tag for the MCA bus.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">mca_intr_handle_t</i></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
The opaque handle describing an established interrupt handler.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">struct mca_attach_args</i></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
A structure use to inform the driver of MCA bus properties. It contains the following members:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
	bus_space_tag_t ma_iot;		/* MCA I/O space tag */ 
	bus_space_tag_t ma_memt;	/* MCA mem space tag */ 
	bus_dma_tag_t ma_dmat;		/* MCA DMA tag */ 
	int ma_slot;			/* MCA slot number */ 
	int ma_pos[8];			/* MCA POS values */ 
	int ma_id;			/* MCA device */</pre>
</dd>
</dl>
</div>
<div class="section">
<h1 id="x46554e4354494f4e53">FUNCTIONS</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">mca_intr_establish</b>(<i class="farg">mc</i>, <i class="farg">hdl</i>, <i class="farg">level</i>, <i class="farg">handler</i>, <i class="farg">arg</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Establish a MCA interrupt handler on the MCA bus specified by <i class="farg">mc</i> for the interrupt described completely by <i class="farg">hdl</i>. The priority of the interrupt is specified by <i class="farg">level</i>. When the interrupt occurs the function <i class="farg">handler</i> is called with argument <i class="farg">arg</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">mca_intr_disestablish</b>(<i class="farg">mc</i>, <i class="farg">hdl</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Dis-establish the interrupt handler on the MCA bus specified by <i class="farg">mc</i> for the interrupt described completely <i class="farg">hdl</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">mca_intr_evcnt</b>(<i class="farg">mc</i>, <i class="farg">hdl</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Do interrupt event counting on the MCA bus specified by <i class="farg">mc</i> for the event described completely by <i class="farg">hdl</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">mca_conf_read</b>(<i class="farg">mc</i>, <i class="farg">slot</i>, <i class="farg">reg</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Read the POS register <i class="farg">reg</i> for the device in slot <i class="farg">slot</i> on the MCA bus specified by <i class="farg">mc</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">mca_conf_write</b>(<i class="farg">mc</i>, <i class="farg">slot</i>, <i class="farg">reg</i>, <i class="farg">data</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Write data <i class="farg">data</i> to the POS register <i class="farg">reg</i> for the device in slot <i class="farg">slot</i> on the MCA bus specified by <i class="farg">mc</i>.</dd>
</dl>
</div>
<div class="section">
<h1 id="x4155544f434f4e46494755524154494f4e">AUTOCONFIGURATION</h1> The MCA bus is a direct-connection bus. During autoconfiguration, the parent specifies the MCA device ID for the found device in the <i class="farg">ma_id</i> member of the <span class="emph">mca_attach_args</span> structure. Drivers should match on the device ID. Device capabilities and configuration information should be read from device POS registers using <b class="fname">mca_conf_read</b>(). Some important configuration information found in the POS registers include the I/O base address, memory base address and interrupt number. The location of these configurable options with the POS registers are device specific.</div>
<div class="section">
<h1 id="x444d4120535550504f5254">DMA SUPPORT</h1> The MCA bus supports 32-bit, bidirectional DMA transfers. Currently, no machine-independent support for MCA DMA is available.</div>
<div class="section">
<h1 id="x434f4445205245464552454e434553">CODE REFERENCES</h1> The MCA subsystem itself is implemented within the file <i class="file">sys/dev/mca/mca_subr.c</i>. Machine-dependent portions can be found in <i class="file">sys/arch/&lt;arch&gt;/mca/mca_machdep.c</i>. The database of known devices exists within the file <i class="file">sys/dev/mca/mcadevs_data.h</i> and is generated automatically from the file <i class="file">sys/dev/mca/mcadevs</i>. New vendor and product identifiers should be added to this file. The database can be regenerated using the Makefile <i class="file">sys/dev/mca/Makefile.mcadevs</i>.<p>
A good source of information about MCA devices is IBM's system configuration disk. The disk contains .adf files which describe the location of device configuration options in the POS registers.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../4/mca">mca(4)</a>, <a class="link-man" href="../9/autoconf">autoconf(9)</a>, <a class="link-man" href="../9/bus_dma">bus_dma(9)</a>, <a class="link-man" href="../9/bus_space">bus_space(9)</a>, <a class="link-man" href="../9/driver">driver(9)</a>, <a class="link-man" href="../9/isa">isa(9)</a></div>
<div class="section">
<h1 id="x42554753">BUGS</h1> The machine-independent <b class="name">MCA</b> driver does not currently support DMA. MCA devices which require DMA operation currently access the DMA capabilities directly.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
October 7, 2001</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
<>

