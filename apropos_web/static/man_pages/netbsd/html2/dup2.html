<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/../4/strict.dtd">
>
<head>
<meta http-equiv="Content-Type" content="te../; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
DUP(2)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
DUP(2)</td>
<td class="head-vol" align="center">
System Calls Manual</td>
<td class="head-rtitle" align="right">
DUP(2)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">dup</b>, <b class="name">dup2</b>, <b class="name">dup3</b> &#8212; <span class="desc">duplicate an existing file descriptor</span></div>
<div class="section">
<h1 id="x4c494252415259">LIBRARY</h1> <span class="lib">Standard C Library (libc, &#45;lc)</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">unistd.h</a>&gt;</b><p>
<i class="ftype">int</i><br>
<b class="fname">dup</b>(<i class="farg" style="white-space:nowrap;">int oldfd</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">dup2</b>(<i class="farg" style="white-space:nowrap;">int oldfd</i>, <i class="farg" style="white-space:nowrap;">int newfd</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">dup3</b>(<i class="farg" style="white-space:nowrap;">int oldfd</i>, <i class="farg" style="white-space:nowrap;">int newfd</i>, <i class="farg" style="white-space:nowrap;">int flags</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="fname">dup</b>() family of calls duplicates an existing file descriptor <i class="farg">oldfd</i>. A new file descriptor is produced; it is a new reference to the same underlying system object. The object in question does not distinguish between the descriptors referencing it in any way. Thus for files, <a class="link-man" href="../2/read">read(2)</a>, <a class="link-man" href="../2/write">write(2)</a> and <a class="link-man" href="../2/lseek">lseek(2)</a> calls all move a single shared seek position. Similarly, all object modes, settings, properties, and behavior other than the close-on-exec flag are shared between references. This includes the setting of append mode, non-blocking I/O actions, asynchronous I/O operations in progress, socket options, and so forth. The close-on-exec flag, however, is a property of the descriptor rather than the object and can be set independently for each reference.<p>
To get an independent handle with its own seek position and settings, an additional <a class="link-man" href="../2/open">open(2)</a> call must be issued. (This is not generally possible for pipes and sockets.)<p>
The <b class="name">dup</b> call chooses the new descriptor: it is the lowest-numbered descriptor not currently in use. The <b class="name">dup2</b> and <b class="name">dup3</b> calls allow the caller to choose the new descriptor by passing <i class="farg">newfd</i>, which must be within the range of valid descriptors. If <i class="farg">newfd</i> is the same as <i class="farg">oldfd</i>, the call has no effect. Otherwise, if <i class="farg">newfd</i> is already in use, it is closed as if <a class="link-man" href="../2/close">close(2)</a> had been called.<p>
File descriptors are small non-negative integers that index into the per-process file table. Values 0, 1, and 2 have the special property that they are treated as standard input, standard output, and standard error respectively. (The constants <span class="define">STDIN_FILENO</span>, <span class="define">STDOUT_FILENO</span>, and <span class="define">STDERR_FILENO</span> are provided as symbolic forms for these values.) The maximum value for a file descriptor is one less than the file table size. The file table size can be interrogated with <a class="link-man" href="../3/getdtablesize">getdtablesize(3)</a> and can to some extent be adjusted with <a class="link-man" href="../2/setrlimit">setrlimit(2)</a>.<p>
The <b class="fname">dup3</b>() call includs an additional <i class="farg">flags</i> argument supporting a subset of the <a class="link-man" href="../2/open">open(2)</a> flags:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">O_CLOEXEC</span></dt>
<dd class="list-tag" style="margin-left: 11.00ex;">
Set the close-on-exec flag on <i class="farg">newfd</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">O_NONBLOCK</span></dt>
<dd class="list-tag" style="margin-left: 11.00ex;">
Sets non-blocking I/O.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">O_NOSIGPIPE</span></dt>
<dd class="list-tag" style="margin-left: 11.00ex;">
For pipes and sockets, do not raise <span class="define">SIGPIPE</span> when a write is made to a broken pipe. Instead, the write will fail with <span class="errno">EPIPE</span>.</dd>
</dl>
As described above, only the close-on-exec flag is per-file-descriptor, so passing any of the other <i class="farg">flags</i> will affect both <i class="farg">oldfd</i> and <i class="farg">newfd</i>. These settings are, however, applied atomically along with the rest of the <b class="fname">dup3</b>() operation.<p>
In the case of <b class="fname">dup</b>() and <b class="fname">dup2</b>() the close-on-exec flag on the new file descriptor is always left unset and all the modes and settings of the underlying object are left unchanged.<p>
Functionality similar to <b class="fname">dup</b>() with slightly different semantics is also available via <a class="link-man" href="../2/fcntl">fcntl(2)</a>.</div>
<div class="section">
<h1 id="x52455455524e2056414c554553">RETURN VALUES</h1> These calls return the new file descriptor value. In the case of <b class="fname">dup2</b>() and <b class="fname">dup3</b>() this is always the same as <i class="farg">newfd</i>. If an error occurs, the value &#45;1 is returned and <b class="var">errno</b> is set to indicate what happened.</div>
<div class="section">
<h1 id="x4558414d504c4553">EXAMPLES</h1> A common use for these functions is to set up a pipe as the standard input or standard output of a subprocess. That is done approximately as follows (error handling omitted for clarity):<p>
<pre style="margin-left: 5.00ex;" class="lit display">
#include &lt;unistd.h&gt; 
 
int fds[2]; 
pid_t pid; 
 
pipe(fds); 
pid = fork(); 
if (pid == 0) { 
	/* child; use read end of pipe to stdin */ 
	dup2(fds[0], STDIN_FILENO); 
	close(fds[0]); 
	close(fds[1]); 
	execv("/some/program", args); 
} 
/* parent process; return write end of pipe */ 
close(fds[0]); 
return fds[1];</pre>
</div>
<div class="section">
<h1 id="x4552524f5253">ERRORS</h1> These functions fail if:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EBADF</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
<i class="farg">oldfd</i> is not a valid active descriptor, or for <b class="fname">dup2</b>() and <b class="fname">dup3</b>(), <i class="farg">newfd</i> is not in the range of valid file descriptors.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EINVAL</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
<i class="farg">flags</i> contained an invalid value. Only <b class="fname">dup3</b>() can generate this error.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EMFILE</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
Too many descriptors are active. Only <b class="fname">dup</b>() can generate this error.</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../2/accept">accept(2)</a>, <a class="link-man" href="../2/close">close(2)</a>, <a class="link-man" href="../2/fcntl">fcntl(2)</a>, <a class="link-man" href="../2/getrlimit">getrlimit(2)</a>, <a class="link-man" href="../2/open">open(2)</a>, <a class="link-man" href="../2/pipe">pipe(2)</a>, <a class="link-man" href="../2/setrlimit">setrlimit(2)</a>, <a class="link-man" href="../2/socket">socket(2)</a>, <a class="link-man" href="../2/socketpair">socketpair(2)</a>, <a class="link-man" href="../3/getdtablesize">getdtablesize(3)</a></div>
<div class="section">
<h1 id="x5354414e4441524453">STANDARDS</h1> The <b class="fname">dup</b>() and <b class="fname">dup2</b>() functions conform to IEEE Std 1003.1-1990 (&#8220;POSIX.1&#8221;).</div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="fname">dup3</b>() function originated in Linux and appeared in <span class="unix">NetBSD&#160;6.0</span>.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
December 24, 2013</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
<>

