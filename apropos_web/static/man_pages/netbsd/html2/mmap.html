<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
MMAP(2)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
MMAP(2)</td>
<td class="head-vol" align="center">
System Calls Manual</td>
<td class="head-rtitle" align="right">
MMAP(2)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">mmap</b> &#8212; <span class="desc">map files or devices into memory</span></div>
<div class="section">
<h1 id="x4c494252415259">LIBRARY</h1> <span class="lib">Standard C Library (libc, &#45;lc)</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">sys/mman.h</a>&gt;</b><p>
<i class="ftype">void *</i><br>
<b class="fname">mmap</b>(<i class="farg" style="white-space:nowrap;">void *addr</i>, <i class="farg" style="white-space:nowrap;">size_t len</i>, <i class="farg" style="white-space:nowrap;">int prot</i>, <i class="farg" style="white-space:nowrap;">int flags</i>, <i class="farg" style="white-space:nowrap;">int fd</i>, <i class="farg" style="white-space:nowrap;">off_t offset</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="name">mmap</b> function causes the pages starting at <i class="farg">addr</i> and continuing for at most <i class="farg">len</i> bytes to be mapped from the object described by <i class="farg">fd</i>, starting at byte offset <i class="farg">offset</i>. If <i class="farg">len</i> is not a multiple of the pagesize, the mapped region may extend past the specified range. Any such extension beyond the end of the mapped object will be zero-filled.<p>
If <i class="farg">addr</i> is non-zero, it is used as a hint to the system. (As a convenience to the system, the actual address of the region may differ from the address supplied.) If <i class="farg">addr</i> is zero, an address will be selected by the system. The actual starting address of the region is returned. A successful <i class="farg">mmap</i> deletes any previous mapping in the allocated address range.<p>
The protections (region accessibility) are specified in the <i class="farg">prot</i> argument by <span class="emph">OR</span>'ing the following values:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">PROT_EXEC</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Pages may be executed.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">PROT_READ</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Pages may be read.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">PROT_WRITE</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Pages may be written.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">PROT_NONE</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Pages may not be accessed.</dd>
</dl>
<p>
<div class="symb" style="display:inline;margin-left: 1.00ex;">
Note that, due to hardware limitations, on some platforms <span class="define">PROT_WRITE</span> may imply <span class="define">PROT_READ</span>, and <span class="define">PROT_READ</span> may imply <span class="define">PROT_EXEC</span>. Portable programs should not rely on these flags being separately enforceable.</div>
<p>
The <i class="farg">flags</i> parameter specifies the type of the mapped object, mapping options and whether modifications made to the mapped copy of the page are private to the process or are to be shared with other references. Note that either <span class="define">MAP_SHARED</span> or <span class="define">MAP_PRIVATE</span> must be specified. Sharing, mapping type and options are specified in the <i class="farg">flags</i> argument by <span class="emph">OR</span>'ing the following values:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">MAP_ALIGNED(n)</span></dt>
<dd class="list-tag" style="margin-left: 18.00ex;">
Request that the allocation be aligned to the given boundary. The parameter <i class="arg">n</i> should be the base 2 logarithm of the desired alignment (e.g., to request alignment to 16K, use 14 as the value for n). The alignment must be equal to or greater than the platform's page size as returned by <a class="link-man" href="../html3/sysconf.html">sysconf(3)</a> with the <span class="define">_SC_PAGESIZE</span> request.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">MAP_ANON</span></dt>
<dd class="list-tag" style="margin-left: 18.00ex;">
Map anonymous memory not associated with any specific file. The file descriptor is not used for creating <span class="define">MAP_ANON</span> regions, and must be specified as &#45;1. The mapped memory will be zero filled.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">MAP_FILE</span></dt>
<dd class="list-tag" style="margin-left: 18.00ex;">
Mapped from a regular file or character-special device memory. Read accesses beyond the end of of the file or device but less than the current page size will be zero-filled. Write accesses beyond the end of the file or device but less than the current page size will not affect the file or device. References beyond the end of file that are beyond the current page size will result in the delivery of <span class="define">SIGBUS</span> signal.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">MAP_FIXED</span></dt>
<dd class="list-tag" style="margin-left: 18.00ex;">
Do not permit the system to select a different address than the one specified. If the specified address cannot be used, <b class="name">mmap</b> will fail. If MAP_FIXED is specified, <i class="farg">addr</i> must be a multiple of the pagesize. Use of this option is discouraged.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">MAP_HASSEMAPHORE</span></dt>
<dd class="list-tag" style="margin-left: 18.00ex;">
Notify the kernel that the region may contain semaphores and that special handling may be necessary.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">MAP_INHERIT</span></dt>
<dd class="list-tag" style="margin-left: 18.00ex;">
Permit regions to be inherited across <a class="link-man" href="../html2/execve.html">execve(2)</a> system calls.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">MAP_TRYFIXED</span></dt>
<dd class="list-tag" style="margin-left: 18.00ex;">
Attempt to use the address <i class="farg">addr</i> even if it falls within the normally protected process data or text segment memory regions. If the requested region of memory is actually present in the memory map, a different address will be selected as if <span class="define">MAP_TRYFIXED</span> had not been specified. If <i class="farg">addr</i> is <i class="farg">NULL</i>, this flag is ignored and the system will select a mapping address.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">MAP_WIRED</span></dt>
<dd class="list-tag" style="margin-left: 18.00ex;">
Lock the mapped region into memory as with <a class="link-man" href="../html2/mlock.html">mlock(2)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">MAP_PRIVATE</span></dt>
<dd class="list-tag" style="margin-left: 18.00ex;">
Modifications made by this process are private, however modifications made by other processes using <span class="define">MAP_SHARED</span> will be seen.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">MAP_SHARED</span></dt>
<dd class="list-tag" style="margin-left: 18.00ex;">
Modifications are shared.</dd>
</dl>
<p>
The <a class="link-man" href="../html2/close.html">close(2)</a> function does not unmap pages, see <a class="link-man" href="../html2/munmap.html">munmap(2)</a> for further information.<p>
The current design does not allow a process to specify the location of swap space. In the future we may define an additional mapping type, <span class="define">MAP_SWAP</span>, in which the file descriptor argument specifies a file or device to which swapping should be done.<p>
If <span class="define">MAP_FIXED</span> is not specified, the system will attempt to place the mapping in an unused portion of the address space chosen to minimize possible collision between mapped regions and the heap.</div>
<div class="section">
<h1 id="x52455455524e2056414c554553">RETURN VALUES</h1> Upon successful completion, <b class="name">mmap</b> returns a pointer to the mapped region. Otherwise, a value of <span class="define">MAP_FAILED</span> is returned and <b class="var">errno</b> is set to indicate the error. The symbol <span class="define">MAP_FAILED</span> is defined in the header &#60;<i class="file">sys/mman.h</i>&#62;. No successful return from <b class="fname">mmap</b>() will return the value <span class="define">MAP_FAILED</span>.</div>
<div class="section">
<h1 id="x4552524f5253">ERRORS</h1> <b class="fname">mmap</b>() will fail if:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EACCES</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The flag <span class="define">PROT_READ</span> was specified as part of the <i class="farg">prot</i> parameter and <i class="farg">fd</i> was not open for reading. The flags <span class="define">MAP_SHARED</span> and <span class="define">PROT_WRITE</span> were specified as part of the <i class="farg">flags</i> and <i class="farg">prot</i> parameters and <i class="farg">fd</i> was not open for writing.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EBADF</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
<i class="farg">fd</i> is not a valid open file descriptor.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EINVAL</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
<span class="define">MAP_FIXED</span> was specified and the <i class="farg">addr</i> parameter was not page aligned or was outside of the valid address range for a process. <span class="define">MAP_ANON was specified and</span> <i class="farg">fd</i> was not &#45;1.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ENODEV</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
<i class="farg">fd</i> did not reference a regular or character special file.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ENOMEM</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
<span class="define">MAP_FIXED</span> was specified and the <i class="farg">addr</i> parameter wasn't available. <span class="define">MAP_ANON</span> was specified and insufficient memory was available.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EOVERFLOW</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
<i class="farg">fd</i> references a regular file and the value of <i class="farg">offset</i> plus <i class="farg">len</i> would exceed the offset maximum established in its open file description.</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html2/madvise.html">madvise(2)</a>, <a class="link-man" href="../html2/mincore.html">mincore(2)</a>, <a class="link-man" href="../html2/mlock.html">mlock(2)</a>, <a class="link-man" href="../html2/mprotect.html">mprotect(2)</a>, <a class="link-man" href="../html2/msync.html">msync(2)</a>, <a class="link-man" href="../html2/munmap.html">munmap(2)</a>, <a class="link-man" href="../html3/getpagesize.html">getpagesize(3)</a>, <a class="link-man" href="../html3/sysconf.html">sysconf(3)</a></div>
<div class="section">
<h1 id="x5354414e4441524453">STANDARDS</h1> The <b class="fname">mmap</b>() function conforms to IEEE Std 1003.1b-1993 (&#8220;POSIX.1b&#8221;).</div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="fname">mmap</b>() interface was first designed in <span class="unix">4.2BSD</span>.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
February 27, 2015</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

