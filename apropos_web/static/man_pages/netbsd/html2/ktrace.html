<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
KTRACE(2)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
KTRACE(2)</td>
<td class="head-vol" align="center">
System Calls Manual</td>
<td class="head-rtitle" align="right">
KTRACE(2)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">ktrace</b> &#8212; <span class="desc">process tracing</span></div>
<div class="section">
<h1 id="x4c494252415259">LIBRARY</h1> <span class="lib">Standard C Library (libc, &#45;lc)</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">sys/types.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">sys/uio.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">sys/ktrace.h</a>&gt;</b><p>
<i class="ftype">int</i><br>
<b class="fname">ktrace</b>(<i class="farg" style="white-space:nowrap;">const char *tracefile</i>, <i class="farg" style="white-space:nowrap;">int ops</i>, <i class="farg" style="white-space:nowrap;">int trpoints</i>, <i class="farg" style="white-space:nowrap;">pid_t pid</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">fktrace</b>(<i class="farg" style="white-space:nowrap;">int fd</i>, <i class="farg" style="white-space:nowrap;">int ops</i>, <i class="farg" style="white-space:nowrap;">int trpoints</i>, <i class="farg" style="white-space:nowrap;">pid_t pid</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="fname">ktrace</b>() function enables or disables tracing of one or more processes. Users may only trace their own processes. Only the super-user can trace setuid or setgid programs.<p>
The <i class="arg">tracefile</i> gives the pathname of the file to be used for tracing. The file must exist and be writable by the calling process. All trace records are always appended to the file, so the file must be truncated to zero length to discard previous trace data. If tracing points are being disabled (see KTROP_CLEAR below), <i class="arg">tracefile</i> may be NULL. If using <b class="fname">fktrace</b>() then instead of passing a filename as <i class="arg">tracefile</i>, a file descriptor is passed as <i class="arg">fd</i> and behaviour is otherwise the same.<p>
The <b class="name">ops</b> parameter specifies the requested ktrace operation. The defined operations are:<table style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-col">
<col style="min-width: 18.00ex;">
<tbody>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
KTROP_SET</td>
<td class="list-col" style="margin-top: 1.00em;">
Enable trace points specified in <i class="arg">trpoints</i>.</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
KTROP_CLEAR</td>
<td class="list-col" style="margin-top: 1.00em;">
Disable trace points specified in <i class="arg">trpoints</i>.</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
KTROP_CLEARFILE</td>
<td class="list-col" style="margin-top: 1.00em;">
Stop all tracing.</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
KTRFLAG_DESCEND</td>
<td class="list-col" style="margin-top: 1.00em;">
The tracing change should apply to the specified process and all its current children.</td>
</tr>
</tbody>
</table>
<p>
The <b class="name">trpoints</b> parameter specifies the trace points of interest. The defined trace points are:<table style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-col">
<col style="min-width: 17.00ex;">
<tbody>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
KTRFAC_SYSCALL</td>
<td class="list-col" style="margin-top: 1.00em;">
Trace system calls.</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
KTRFAC_SYSRET</td>
<td class="list-col" style="margin-top: 1.00em;">
Trace return values from system calls.</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
KTRFAC_NAMEI</td>
<td class="list-col" style="margin-top: 1.00em;">
Trace name lookup operations.</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
KTRFAC_GENIO</td>
<td class="list-col" style="margin-top: 1.00em;">
Trace all I/O (note that this option can generate much output).</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
KTRFAC_PSIG</td>
<td class="list-col" style="margin-top: 1.00em;">
Trace posted signals.</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
KTRFAC_CSW</td>
<td class="list-col" style="margin-top: 1.00em;">
Trace context switch points.</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
KTRFAC_EMUL</td>
<td class="list-col" style="margin-top: 1.00em;">
Trace emulation changes.</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
KTRFAC_INHERIT</td>
<td class="list-col" style="margin-top: 1.00em;">
Inherit tracing to future children.</td>
</tr>
</tbody>
</table>
<p>
Each tracing event outputs a record composed of a generic header followed by a trace point specific structure. The generic header is:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
struct ktr_header { 
	int	ktr_len;		/* length of buf */ 
	short	ktr_type;		/* trace record type */ 
	pid_t	ktr_pid;		/* process id */ 
	char	ktr_comm[MAXCOMLEN+1];	/* command name */ 
	struct	timeval ktr_time;	/* timestamp */ 
	caddr_t	ktr_buf; 
};</pre>
<p>
The <b class="name">ktr_len</b> field specifies the length of the <b class="name">ktr_type</b> data that follows this header. The <b class="name">ktr_pid</b> and <b class="name">ktr_comm</b> fields specify the process and command generating the record. The <b class="name">ktr_time</b> field gives the time (with microsecond resolution) that the record was generated. The <b class="name">ktr_buf</b> is an internal kernel pointer and is not useful.<p>
The generic header is followed by <b class="name">ktr_len</b> bytes of a <b class="name">ktr_type</b> record. The type specific records are defined in the <i class="file">&lt;sys/ktrace.h&gt;</i> include file.</div>
<div class="section">
<h1 id="x52455455524e2056414c554553">RETURN VALUES</h1> On successful completion a value of 0 is returned. Otherwise, a value of &#45;1 is returned and <b class="var">errno</b> is set to show the error.</div>
<div class="section">
<h1 id="x4552524f5253">ERRORS</h1> <b class="fname">ktrace</b>() will fail if:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ENOTDIR</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
A component of the path prefix is not a directory.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EINVAL</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
The pathname contains a character with the high-order bit set.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ENAMETOOLONG</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
A component of a pathname exceeded &#123;<span class="define">NAME_MAX</span>&#125; characters, or an entire path name exceeded &#123;<span class="define">PATH_MAX</span>&#125; characters.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ENOENT</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
The named tracefile does not exist.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EACCES</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Search permission is denied for a component of the path prefix.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ELOOP</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Too many symbolic links were encountered in translating the pathname.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EIO</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
An I/O error occurred while reading from or writing to the file system.</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../1/kdump">kdump(1)</a>, <a class="link-man" href="../1/ktrace">ktrace(1)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> A <b class="name">ktrace</b> function call first appeared in <span class="unix">4.4BSD</span>.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
June 4, 1993</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

