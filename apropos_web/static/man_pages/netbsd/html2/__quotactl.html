<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="/static/man_pages/netbsd/style.css" type="text/css" media="all">
<title>
__QUOTACTL(2)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
__QUOTACTL(2)</td>
<td class="head-vol" align="center">
System Calls Manual</td>
<td class="head-rtitle" align="right">
__QUOTACTL(2)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">__quotactl</b> &#8212; <span class="desc">manipulate file system quotas</span></div>
<div class="section">
<h1 id="x4c494252415259">LIBRARY</h1> <span class="lib">Standard C Library (libc, &#45;lc)</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">sys/quota.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">sys/quotactl.h</a>&gt;</b><p>
<i class="ftype">int</i><br>
<b class="fname">__quotactl</b>(<i class="farg" style="white-space:nowrap;">const char *path</i>, <i class="farg" style="white-space:nowrap;">struct quotactl_args *args</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="fname">__quotactl</b>() call manipulates file system quotas. This is an internal interface and is documented for reference purposes only. All application and utility code should use the <a class="link-man" href="../3/libquota">libquota(3)</a> interface.<p>
The <b class="fname">__quotactl</b>() function performs one of several quota-related operations on the file system named by <i class="farg">path</i>. The operation and arguments to that operation are passed in the <i class="farg">args</i> argument. The operation is stored in the <i class="farg">qc_op</i> member of <i class="farg">args</i>. The arguments are placed in a union such that the first and second arguments of the operation <span class="define">QUOTACTL_EXAMPLE</span> are found as the members <i class="farg">u.example.qc_arg1</i> and <i class="farg">u.example.qc_arg2</i>. The descriptions below will refer to the operations as functions of the form <b class="fname">QUOTACTL_EXAMPLE</b>(<i class="farg">int arg1</i>, <i class="farg">int arg2</i>) and elide the encoding of these arguments into the <i class="farg">args</i> structure. Explicit mention of the <i class="farg">path</i> argument is also omitted.<p>
There are fourteen quota control operations. These are:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">QUOTACTL_STAT</b>(<i class="farg">struct quotastat *info</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Information about the quota implementation on the selected volume is returned in <i class="farg">info</i>. The <span class="define">quotastat</span> structure contains the following members:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
qs_implname</dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
A human-readable string describing the underlying implementation of quotas. This is suitable for display to users (and system administrators) but should not be interpreted by software. See <a class="link-man" href="../3/quota_getimplname">quota_getimplname(3)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
qs_numidtypes</dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
The number of ID types supported by this implementation. See <a class="link-man" href="../3/quota_getnumidtypes">quota_getnumidtypes(3)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
qs_numobjtypes</dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
The number of object types supported by this implementation. See <a class="link-man" href="../3/quota_getnumobjtypes">quota_getnumobjtypes(3)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
qs_restrictions</dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
Flags identifying specific semantic limitations of the implementation. See <a class="link-man" href="../3/quota_getrestrictions">quota_getrestrictions(3)</a>.</dd>
</dl>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">QUOTACTL_IDTYPESTAT</b>(<i class="farg">int idtype</i>, <i class="farg">struct quotaidtypestat *info</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Information about a particular ID type on the selected volume is returned in <i class="farg">info</i>. The <span class="define">quotaidtypestat</span> structure contains the following members:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
qis_name</dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
The name of the ID type. See <a class="link-man" href="../3/quota_idtype_getname">quota_idtype_getname(3)</a>.</dd>
</dl>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">QUOTACTL_OBJYPESTAT</b>(<i class="farg">int objtype</i>, <i class="farg">struct quotaobjtypestat *info</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Information about a particular object type on the selected volume is returned in <i class="farg">info</i>. The <span class="define">quotaobjtypestat</span> structure contains the following members:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
qos_name</dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
The name of the object type. See <a class="link-man" href="../3/quota_objtype_getname">quota_objtype_getname(3)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
qos_isbytes</dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
A flag that is nonzero if the object type is something measured in bytes. See <a class="link-man" href="../3/quota_objtype_isbytes">quota_objtype_isbytes(3)</a>.</dd>
</dl>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">QUOTACTL_GET</b>(<i class="farg">const struct quotakey *key</i>, <i class="farg">struct quotaval *val</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Return in <i class="farg">val</i> the quota information selected by <i class="farg">key</i>. See <a class="link-man" href="../3/quota_get">quota_get(3)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">QUOTACTL_PUT</b>(<i class="farg">const struct quotakey *key</i>, <i class="farg">const struct quotaval *val</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The quota information selected by <i class="farg">key</i> is updated to the values provided in <i class="farg">val</i>. Note that the current usage information, which is file system meta-data, cannot be updated via this interface. If the usage information is incorrect a tool such as <a class="link-man" href="../8/fsck">fsck(8)</a> or <a class="link-man" href="../8/quotacheck">quotacheck(8)</a> with file-system-specific knowledge must be used to repair the on-disk information. See <a class="link-man" href="../3/quota_put">quota_put(3)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">QUOTACTL_DELETE</b>(<i class="farg">const struct quotakey *key</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The quota information selected by <i class="farg">key</i> is removed. See <a class="link-man" href="../3/quota_delete">quota_delete(3)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">QUOTACTL_CURSOROPEN</b>(<i class="farg">struct quotakcursor *cursor</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
A cursor for iterating the quota information is created. The <span class="define">quotakcursor</span> structure is a semi-opaque type holding the iteration state used by the quota implementation. The caller is responsible for allocating and maintaining storage for the cursor. Every cursor that is opened should be closed. It is not specified whether a cursor remains valid if <a class="link-man" href="../3/memcpy">memcpy(3)</a> is used to move it to a different location in user memory. It is not specified whether or how a cursor may be duplicated. Passing an uninitialized, corrupted, or closed cursor to operations other than <b class="fname">QUOTACTL_CURSOROPEN</b>() will produce unspecified behavior. As per general standards for system calls such actions must not produce undefined or materially adverse behavior in the kernel; however, the effect on a user process may be arbitrary. The <a class="link-man" href="../3/libquota">libquota(3)</a> interface wraps the system call level quota cursors in a friendlier interface. See <a class="link-man" href="../3/quota_opencursor">quota_opencursor(3)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">QUOTACTL_CURSORCLOSE</b>(<i class="farg">struct quotakcursor *cursor</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The cursor passed in is closed. See <a class="link-man" href="../3/quotacursor_close">quotacursor_close(3)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">QUOTACTL_CURSORSKIPIDTYPE</b>(<i class="farg">struct quotakcursor *cursor</i>, <i class="farg">int idtype</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This operation provides a hint that iteration can skip over a particular ID type. The implementation is not obliged to honor the hint. See <a class="link-man" href="../3/quotacursor_skipidtype">quotacursor_skipidtype(3)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">QUOTACTL_CURSORGET</b>(<i class="farg">struct quotakcursor *cursor</i>, <i class="farg">struct quotakey *keys</i>, <i class="farg">struct quotaval *vals</i>, <i class="farg">unsigned maxnum</i>, <i class="farg">unsigned *ret</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This operation retrieves data at the current cursor position and advances it. Up to <i class="farg">maxnum</i> quota records are retrieved and stored into the arrays named by <i class="farg">keys</i> and <i class="farg">vals</i>. The number of records retrieved is stored into the variable pointed to by <i class="farg">ret</i>. See <a class="link-man" href="../3/quotacursor_get">quotacursor_get(3)</a> and <a class="link-man" href="../3/quotacursor_getn">quotacursor_getn(3)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">QUOTACTL_CURSORATEND</b>(<i class="farg">struct quotakcursor *cursor</i>, <i class="farg">int *ret</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This operation generates a nonzero value if the cursor has reached the end of the available quota information and zero otherwise. The generated value is stored into the variable pointed to by <i class="farg">ret</i>. See <a class="link-man" href="../3/quotacursor_atend">quotacursor_atend(3)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">QUOTACTL_CURSORREWIND</b>(<i class="farg">struct quotakcursor *cursor</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This operation updates the cursor state so that further calls to <b class="fname">QUOTACTL_CURSORGET</b>() will begin again at the start of the iteration. See <a class="link-man" href="../3/quotacursor_rewind">quotacursor_rewind(3)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">QUOTACTL_QUOTAON</b>(<i class="farg">int idtype</i>, <i class="farg">const char *quotafile</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This operation is accepted only by old-style (&#8220;quota1&#8221;) quota implementations. Quotas for the ID type named by <i class="farg">idtype</i> are switched on, and the file <i class="farg">quotafile</i> is used to hold the quota information. This operation can also be used when quotas are already switched on to change the file used to hold the quota information. Note however that as the current usage information in the file must be consistent with the current state of the file system, in general it is not safe to call <b class="fname">QUOTACTL_QUOTAON</b>() except in single-user mode. See <a class="link-man" href="../8/quotaon">quotaon(8)</a> for more information. Normally quotaon 8 is run during the boot sequence after quotacheck 8 . Also see <a class="link-man" href="../3/quota_quotaon">quota_quotaon(3)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">QUOTACTL_QUOTAOFF</b>(<i class="farg">int idtype</i>)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This operation is accepted only by old-style (&#8220;quota1&#8221;) quota implementations. Quotas for the ID type named by <i class="farg">idtype</i> are switched off. Once quotas are switched off the file system behaves as if no quotas are present. Normally quotaoff 8 is run during the shutdown sequence. Also see <a class="link-man" href="../3/quota_quotaoff">quota_quotaoff(3)</a>.</dd>
</dl>
</div>
<div class="section">
<h1 id="x52455455524e2056414c554553">RETURN VALUES</h1> On success, <b class="fname">__quotactl</b>() returns 0. Otherwise the value &#45;1 is returned and an error code reflecting the reason for the failure is placed in <b class="var">errno</b>.</div>
<div class="section">
<h1 id="x4552524f5253">ERRORS</h1> <b class="fname">__quotactl</b>() failures include:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EFAULT</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
A pointer points outside the process's allocated address space.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EINVAL</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The operation code was out of range; or a requested ID or object type was out of range; or a corrupted or invalid cursor was passed in.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ENODEV</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The requested action was inappropriate for (or not supported by) the selected volume.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ENOENT</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
No quota information exists for the requested key.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ENOMEM</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
Memory could not be allocated within the kernel.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ENXIO</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The target file system type is capable of supporting quotas, but quotas are not enabled on the selected volume.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EOPNOTSUPP</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The target file system does not support quotas.</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../1/quota">quota(1)</a>, <a class="link-man" href="../3/libquota">libquota(3)</a>, <a class="link-man" href="../5/fstab">fstab(5)</a>, <a class="link-man" href="../8/edquota">edquota(8)</a>, <a class="link-man" href="../8/quotacheck">quotacheck(8)</a>, <a class="link-man" href="../8/quotaon">quotaon(8)</a>, <a class="link-man" href="../8/quotarestore">quotarestore(8)</a>, <a class="link-man" href="../8/repquota">repquota(8)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The original <b class="fname">quotactl</b>() function call appeared in <span class="unix">4.3BSD-Reno</span>. The current <b class="fname">__quotactl</b>() interface appeared in <span class="unix">NetBSD&#160;6.0</span>.</div>
<div class="section">
<h1 id="x42554753">BUGS</h1> As of this writing the error returns that occur in practice are not always completely consistent with the intent documented above.<p>
There should be some way to integrate this call with the resource limit interface provided by <a class="link-man" href="../2/setrlimit">setrlimit(2)</a> and <a class="link-man" href="../2/getrlimit">getrlimit(2)</a>.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
February 11, 2012</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

