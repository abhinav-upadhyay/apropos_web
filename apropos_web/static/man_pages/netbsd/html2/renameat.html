<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="/static/man_pages/netbsd/style.css" type="text/css" media="all">
<title>
RENAME(2)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
RENAME(2)</td>
<td class="head-vol" align="center">
System Calls Manual</td>
<td class="head-rtitle" align="right">
RENAME(2)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">rename</b>, <b class="name">renameat</b> &#8212; <span class="desc">change the name of a file</span></div>
<div class="section">
<h1 id="x4c494252415259">LIBRARY</h1> <span class="lib">Standard C Library (libc, &#45;lc)</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">stdio.h</a>&gt;</b><p>
<i class="ftype">int</i><br>
<b class="fname">rename</b>(<i class="farg" style="white-space:nowrap;">const char *from</i>, <i class="farg" style="white-space:nowrap;">const char *to</i>);<p>
<b class="includes">#include &lt;<a class="link-includes">unistd.h</a>&gt;</b><p>
<i class="ftype">int</i><br>
<b class="fname">renameat</b>(<i class="farg" style="white-space:nowrap;">int fromfd</i>, <i class="farg" style="white-space:nowrap;">const char *from</i>, <i class="farg" style="white-space:nowrap;">int tofd</i>, <i class="farg" style="white-space:nowrap;">const char *to</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> <b class="fname">rename</b>() causes the link named <i class="farg">from</i> to be renamed as <i class="farg">to</i>. If <i class="farg">to</i> exists, it is first removed. Both <i class="farg">from</i> and <i class="farg">to</i> must be of the same type (that is, both directories or both non-directories), and must reside on the same file system.<p>
<b class="fname">rename</b>() guarantees that an instance of <i class="farg">to</i> will always exist, even if the system should crash in the middle of the operation.<p>
If the final component of <i class="farg">from</i> is a symbolic link, the symbolic link is renamed, not the file or directory to which it points.<p>
If both <i class="farg">from</i> and <i class="farg">to</i> are pathnames of the same existing file in the file system's name space, <b class="fname">rename</b>() returns successfully and performs no other action.<p>
<b class="fname">renameat</b>() works the same way as <b class="fname">rename</b>() except if <i class="farg">from</i> (resp. <i class="farg">to</i>) is relative. In that case, it is looked up from a directory whose file descriptor was passed as <i class="farg">fromfd</i> (resp. <i class="farg">tofd</i>). Search permission is required on the directories named by <i class="farg">fromfd</i> and <i class="farg">tofd</i>. <i class="farg">fromfd</i> or <i class="farg">tofd</i> can be set to <span class="define">AT_FDCWD</span> in order to specify the current directory.</div>
<div class="section">
<h1 id="x52455455524e2056414c554553">RETURN VALUES</h1> The <b class="fname">rename</b>() and <b class="fname">renameat</b>() functions return the value 0 if successful; otherwise the value -1 is returned and the global variable <b class="var">errno</b> is set to indicate the error.</div>
<div class="section">
<h1 id="x4552524f5253">ERRORS</h1> <b class="fname">rename</b>() and <b class="fname">renameat</b>() will fail and neither of the argument files will be affected if:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EACCES</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
A component of either path prefix denies search permission, or the requested link requires writing in a directory with a mode that denies write permission.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EBUSY</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
<i class="farg">from</i> or <i class="farg">to</i> is the mount point for a mounted file system.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EDQUOT</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The directory in which the entry for the new name is being placed cannot be extended because the user's quota of disk blocks on the file system containing the directory has been exhausted.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EFAULT</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
<i class="farg">from</i> or <i class="farg">to</i> points outside the process's allocated address space.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EINVAL</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
<i class="farg">from</i> is a parent directory of <i class="farg">to</i>, or an attempt is made to rename &#8216;<code class="lit">.</code>&#8217; or &#8216;<code class="lit">..</code>&#8217;.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EIO</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
An I/O error occurred while making or updating a directory entry.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EISDIR</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
<i class="farg">to</i> is a directory, but <i class="farg">from</i> is not a directory.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ELOOP</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
Too many symbolic links were encountered in translating either pathname.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ENAMETOOLONG</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
A component of a pathname exceeded &#123;<span class="define">NAME_MAX</span>&#125; characters, or an entire path name exceeded &#123;<span class="define">PATH_MAX</span>&#125; characters.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ENOENT</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
A component of the <i class="farg">from</i> path does not exist, or a path prefix of <i class="farg">to</i> does not exist.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ENOSPC</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The directory in which the entry for the new name is being placed cannot be extended because there is no space left on the file system containing the directory.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ENOTDIR</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
A component of either path prefix is not a directory, or <i class="farg">from</i> is a directory, but <i class="farg">to</i> is not a directory.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ENOTEMPTY</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
<i class="farg">to</i> is a directory and is not empty.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EPERM</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The directory containing <i class="farg">from</i> is marked sticky, and neither the containing directory nor <i class="farg">from</i> are owned by the effective user ID. Or the <i class="farg">to</i> file exists, the directory containing <i class="farg">to</i> is marked sticky, and neither the containing directory nor <i class="farg">to</i> are owned by the effective user ID.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EROFS</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The requested link requires writing in a directory on a read-only file system.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EXDEV</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The link named by <i class="farg">to</i> and the file named by <i class="farg">from</i> are on different logical devices (file systems). Note that this error code will not be returned if the implementation permits cross-device links.</dd>
</dl>
<p>
In addition, <b class="fname">renameat</b>() will fail if:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EBADF</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
<i class="farg">from</i> or <i class="farg">to</i> does not specify an absolute path and <i class="farg">fromfd</i> or <i class="farg">tofd</i>, respectively, is neither <span class="define">AT_FDCWD</span> nor a valid file descriptor open for reading or searching.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ENOTDIR</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
<i class="farg">from</i> or <i class="farg">to</i> is not an absolute path and <i class="farg">fromfd</i> or <i class="farg">tofd</i>, respectively, is a file descriptor associated with a non-directory file.</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../2/open">open(2)</a>, <a class="link-man" href="../7/symlink">symlink(7)</a></div>
<div class="section">
<h1 id="x5354414e4441524453">STANDARDS</h1> The <b class="fname">rename</b>() function deviates from the semantics defined in IEEE Std 1003.1-1990 (&#8220;POSIX.1&#8221;), which specifies that if both <i class="farg">from</i> and <i class="farg">to</i> <span class="emph">link</span> to the same existing file, <b class="fname">rename</b>() shall return successfully and performs no further action, whereas this implementation will remove the file specified by <i class="farg">from</i> unless both <i class="farg">from</i> and <i class="farg">to</i> are pathnames of the same file in the file system's name space.<p>
To retain conformance, a compatibility interface is provided by the <span class="lib">POSIX Compatibility Library (libposix, &#45;lposix)</span> which is also be brought into scope if any of the <span class="define">_POSIX_SOURCE</span>, <span class="define">_POSIX_C_SOURCE</span> or <span class="define">_XOPEN_SOURCE</span> preprocessor symbols are defined at compile-time: the <b class="fname">rename</b>() function conforms to IEEE Std 1003.1-1990 (&#8220;POSIX.1&#8221;) and X/Open Portability Guide Issue&#160;4, Version&#160;2 (&#8220;XPG4.2&#8221;). <b class="fname">renameat</b>() conforms to IEEE Std 1003.1-2008 (&#8220;POSIX.1&#8221;).</div>
<div class="section">
<h1 id="x42554753">BUGS</h1> The system can deadlock if a loop in the file system graph is present. This loop takes the form of an entry in directory &#8216;<code class="lit"><i class="file">a</i></code>&#8217;, say &#8216;<code class="lit"><i class="file">a/foo</i></code>&#8217;, being a hard link to directory &#8216;<code class="lit"><i class="file">b</i></code>&#8217;, and an entry in directory &#8216;<code class="lit"><i class="file">b</i></code>&#8217;, say &#8216;<code class="lit"><i class="file">b/bar</i></code>&#8217;, being a hard link to directory &#8216;<code class="lit"><i class="file">a</i></code>&#8217;. When such a loop exists and two separate processes attempt to perform &#8216;<code class="lit">rename a/foo b/bar</code>&#8217; and &#8216;<code class="lit">rename b/bar a/foo</code>&#8217;, respectively, the system may deadlock attempting to lock both directories for modification. Hard links to directories should be replaced by symbolic links by the system administrator.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
July 28, 2013</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

