<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
FDISCARD(2)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
FDISCARD(2)</td>
<td class="head-vol" align="center">
System Calls Manual</td>
<td class="head-rtitle" align="right">
FDISCARD(2)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">posix_fallocate</b>, <b class="name">fdiscard</b> &#8212; <span class="desc">allocate or discard backing store for files</span></div>
<div class="section">
<h1 id="x4c494252415259">LIBRARY</h1> <span class="lib">Standard C Library (libc, &#45;lc)</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">unistd.h</a>&gt;</b><p>
<i class="ftype">int</i><br>
<b class="fname">posix_fallocate</b>(<i class="farg" style="white-space:nowrap;">int fd</i>, <i class="farg" style="white-space:nowrap;">off_t pos</i>, <i class="farg" style="white-space:nowrap;">off_t length</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">fdiscard</b>(<i class="farg" style="white-space:nowrap;">int fd</i>, <i class="farg" style="white-space:nowrap;">off_t pos</i>, <i class="farg" style="white-space:nowrap;">off_t length</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="fname">posix_fallocate</b>() call allocates backing store for the file referenced by <i class="farg">fd</i> in the region starting at <i class="farg">pos</i> bytes from the start of the file and continuing for <i class="farg">length</i> bytes more. If the region extends past the current end of file, the file size is increased to cover the region.<p>
The <b class="fname">fdiscard</b>() call discards backing store for the file referenced by <i class="farg">fd</i> in the region starting at <i class="farg">pos</i> bytes from the start of the file and continuing for <i class="farg">length</i> bytes more. The file size is not affected.<p>
Both calls operate on the basis of file system blocks, so <b class="fname">posix_fallocate</b>() may allocate more physical space than requested and <b class="fname">fdiscard</b>() may discard less physical space than requested.<p>
When <b class="fname">posix_fallocate</b>() is applied to an unallocated region in a regular file (a &#8220;hole&#8221;), the hole is filled and the visible contents are unaffected; both holes and newly allocated regions read as all zeros. If <b class="fname">posix_fallocate</b>() is applied to an already-allocated region in a regular file, it has no effect.<p>
When <b class="fname">fdiscard</b>() is applied to a regular file, a hole is created and any data in the affected region is thrown away. Subsequent reads of the region return zeros.<p>
If <b class="fname">fdiscard</b>() is applied to a device, and the device supports an underlying discard operation, that operation is invoked. For example, ATA flash devices and solid-state disks support an operation called TRIM that discards blocks at the device level. The behavior of blocks discarded at this level is implementation-defined; as devices vary, specific behavior should not be relied upon. Subsequent reads of the same block may return zeros; such reads may also, however, continue to return the previously written data, or return other data, or return indeterminate garbage; or may switch between any of these behaviors at unpredictable points later on.<p>
For both calls, the file <i class="farg">fd</i> must be open for writing and may not be a directory or socket.</div>
<div class="section">
<h1 id="x5245535452494354494f4e53">RESTRICTIONS</h1> Because there is no way for <b class="fname">posix_fallocate</b>() to report a partial failure, errors may require some or all of the work it has already done to be unwound, which may be expensive. It is recommended to set the file length first with <a class="link-man" href="../html2/ftruncate.html">ftruncate(2)</a> and only then allocate space within the file using <b class="fname">posix_fallocate</b>().<p>
Depending on the implementation, even a failing call to <b class="fname">posix_fallocate</b>() may allocate some space to the target file. Such a call will not, however, change the file size.<p>
Furthermore, in some implementations, the space reservations created by <b class="fname">posix_fallocate</b>() may not be persistent after a crash or reboot if the space reserved has not yet been written to.</div>
<div class="section">
<h1 id="x52455455524e2056414c554553">RETURN VALUES</h1> If successful, the <b class="fname">posix_fallocate</b>() function will return zero. Otherwise an error number will be returned, without setting <b class="var">errno</b>.<p>
If successful, the <b class="fname">fdiscard</b>() function will return zero. Otherwise the value &#45;1 is returned and the global variable <b class="var">errno</b> is set to indicate the error.</div>
<div class="section">
<h1 id="x4552524f5253">ERRORS</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EBADF</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The file handle <i class="farg">fd</i> is invalid or not open for writing.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EDQUOT</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
Allocating the requested blocks would exceed the user's quota.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EINVAL</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The position and/or length values are negative.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EIO</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
A hardware-level I/O error occurred.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EISDIR</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The selected file is a directory.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ENOSPC</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
There was no space in the file system to complete the operation.</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html2/ftruncate.html">ftruncate(2)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="fname">posix_fallocate</b>() and <b class="fname">fdiscard</b>() function calls appeared in <span class="unix">NetBSD&#160;7.0</span>. Similar functions appeared previously in Linux. The <b class="fname">posix_fallocate</b>() function is expected to conform to IEEE Std 1003.1-2004 (&#8220;POSIX.1&#8221;).</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
February 1, 2015</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

