<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/../4/strict.dtd">
>
<head>
<meta http-equiv="Content-Type" content="te../; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
X86_64_GET_MTRR(2) (x86_64)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
X86_64_GET_MTRR(2)</td>
<td class="head-vol" align="center">
System Calls Manual (x86_64)</td>
<td class="head-rtitle" align="right">
X86_64_GET_MTRR(2)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">x86_64_get_mtrr</b>, <b class="name">x86_64_set_mtrr</b> &#8212; <span class="desc">access Memory Type Range Registers</span></div>
<div class="section">
<h1 id="x4c494252415259">LIBRARY</h1> <span class="lib">x86_64 Architecture Library (libx86_64, &#45;lx86_64)</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">sys/types.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">machine/sysarch.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">machine/mtrr.h</a>&gt;</b><p>
<i class="ftype">int</i><br>
<b class="fname">x86_64_get_mtrr</b>(<i class="farg" style="white-space:nowrap;">struct mtrr *mtrrp</i>, <i class="farg" style="white-space:nowrap;">int *n</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">x86_64_set_mtrr</b>(<i class="farg" style="white-space:nowrap;">struct mtrr *mtrrp</i>, <i class="farg" style="white-space:nowrap;">int *n</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> These functions provide an interface to the MTRR registers found on 686-class processors for controlling processor access to memory ranges. This is most useful for accessing devices such as video accelerators on <a class="link-man" href="../4/pci">pci(4)</a> and <a class="link-man" href="../4/agp">agp(4)</a> buses. For example, enabling write-combining allows bus-write transfers to be combined into a larger transfer before bursting over the bus. This can increase performance of write operations 2.5 times or more.<p>
<i class="farg">mtrrp</i> is a pointer to one or more mtrr structures, as described below. The <i class="farg">n</i> argument is a pointer to an integer containing the number of structures pointed to by <i class="farg">mtrrp</i>. For <b class="fname">x86_64_set_mtrr</b>() the integer pointed to by <i class="farg">n</i> will be updated to reflect the actual number of MTRRs successfully set. For <b class="fname">x86_64_get_mtrr</b>() no more than <i class="farg">n</i> structures will be copied out, and the integer value pointed to by <i class="farg">n</i> will be updated to reflect the actual number of valid structures retrieved. A <span class="define">NULL</span> argument to <i class="farg">mtrrp</i> will result in just the number of MTRRs available being returned in the integer pointed to by <i class="farg">n</i>.<p>
The argument <i class="farg">mtrrp</i> has the following structure:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
struct mtrr { 
        uint64_t base; 
        uint64_t len; 
        uint8_t type; 
        int flags; 
        pid_t owner; 
};</pre>
<p>
The location of the mapping is described by its physical base address <span class="emph">base</span> and length <span class="emph">len</span>. Valid values for <span class="emph">type</span> are:<p>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
MTRR_TYPE_UC</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
uncached memory</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
MTRR_TYPE_WC</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
use write-combining</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
MTRR_TYPE_WT</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
use write-through caching</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
MTRR_TYPE_WP</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
write-protected memory</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
MTRR_TYPE_WB</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
use write-back caching</dd>
</dl>
<p>
Valid values for <span class="emph">flags</span> are:<p>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
MTRR_PRIVATE</dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
own range, reset the MTRR when the current process exits</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
MTRR_FIXED</dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
use fixed range MTRR</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
MTRR_VALID</dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
entry is valid</dd>
</dl>
<p>
The <span class="emph">owner</span> member is the PID of the user process which claims the mapping. It is only valid if MTRR_PRIVATE is set in <span class="emph">flags</span>. To clear/reset MTRRs, use a <span class="emph">flags</span> field without MTRR_VALID set.</div>
<div class="section">
<h1 id="x52455455524e2056414c554553">RETURN VALUES</h1> Upon successful completion zero is returned, otherwise &#45;1 is returned on failure, and the global variable <b class="var">errno</b> is set to indicate the error. The integer value pointed to by <i class="farg">n</i> will contain the number of successfully processed mtrr structures in both cases.</div>
<div class="section">
<h1 id="x4552524f5253">ERRORS</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ENOSYS</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
The currently running kernel or CPU has no MTRR support.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EINVAL</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
The currently running kernel has no MTRR support, or one of the mtrr structures pointed to by <i class="farg">mtrrp</i> is invalid.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EBUSY</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
No unused MTRRs are available.</dd>
</dl>
</div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="fname">x86_64_get_mtrr</b>() and <b class="fname">x86_64_set_mtrr</b>() were derived from their i386 counterparts, which appeared in <span class="unix">NetBSD&#160;1.6</span>.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
November 10, 2001</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
<>

