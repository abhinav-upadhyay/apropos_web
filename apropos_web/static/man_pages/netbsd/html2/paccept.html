<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
ACCEPT(2)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
ACCEPT(2)</td>
<td class="head-vol" align="center">
System Calls Manual</td>
<td class="head-rtitle" align="right">
ACCEPT(2)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">accept</b>, <b class="name">paccept</b> &#8212; <span class="desc">accept a connection on a socket</span></div>
<div class="section">
<h1 id="x4c494252415259">LIBRARY</h1> <span class="lib">Standard C Library (libc, &#45;lc)</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">sys/socket.h</a>&gt;</b><p>
<i class="ftype">int</i><br>
<b class="fname">accept</b>(<i class="farg" style="white-space:nowrap;">int s</i>, <i class="farg" style="white-space:nowrap;">struct sockaddr * restrict addr</i>, <i class="farg" style="white-space:nowrap;">socklen_t * restrict addrlen</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">paccept</b>(<i class="farg" style="white-space:nowrap;">int s</i>, <i class="farg" style="white-space:nowrap;">struct sockaddr * restrict addr</i>, <i class="farg" style="white-space:nowrap;">socklen_t * restrict addrlen</i>, <i class="farg" style="white-space:nowrap;">const sigset_t * restrict sigmask</i>, <i class="farg" style="white-space:nowrap;">int flags</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The argument <i class="farg">s</i> is a socket that has been created with <a class="link-man" href="../2/socket">socket(2)</a>, bound to an address with <a class="link-man" href="../2/bind">bind(2)</a>, and is listening for connections after a <a class="link-man" href="../2/listen">listen(2)</a>. The <b class="fname">accept</b>() argument extracts the first connection request on the queue of pending connections, creates a new socket with the same properties of <i class="farg">s</i> and allocates a new file descriptor for the socket. If no pending connections are present on the queue, and the socket is not marked as non-blocking, <b class="fname">accept</b>() blocks the caller until a connection is present. If the socket is marked non-blocking and no pending connections are present on the queue, <b class="fname">accept</b>() returns an error as described below. The accepted socket may not be used to accept more connections. The original socket <i class="farg">s</i> remains open.<p>
The argument <i class="farg">addr</i> is a result parameter that is filled in with the address of the connecting entity, as known to the communications layer. The exact format of the <i class="farg">addr</i> parameter is determined by the domain in which the communication is occurring. The <i class="farg">addrlen</i> is a value-result parameter; it should initially contain the amount of space pointed to by <i class="farg">addr</i>; on return it will contain the actual length (in bytes) of the address returned. This call is used with connection-based socket types, currently with <span class="define">SOCK_STREAM</span>.<p>
It is possible to <a class="link-man" href="../2/select">select(2)</a> or <a class="link-man" href="../2/poll">poll(2)</a> a socket for the purposes of doing an <b class="fname">accept</b>() by selecting or polling it for read.<p>
For certain protocols which require an explicit confirmation, such as ISO or DATAKIT, <b class="fname">accept</b>() can be thought of as merely dequeuing the next connection request and not implying confirmation. Confirmation can be implied by a normal read or write on the new file descriptor, and rejection can be implied by closing the new socket.<p>
One can obtain user connection request data without confirming the connection by issuing a <a class="link-man" href="../2/recvmsg">recvmsg(2)</a> call with an <i class="farg">msg_iovlen</i> of 0 and a non-zero <i class="farg">msg_controllen</i>, or by issuing a <a class="link-man" href="../2/getsockopt">getsockopt(2)</a> request. Similarly, one can provide user connection rejection information by issuing a <a class="link-man" href="../2/sendmsg">sendmsg(2)</a> call with providing only the control information, or by calling <a class="link-man" href="../2/setsockopt">setsockopt(2)</a>.<p>
The <b class="fname">paccept</b>() function behaves exactly like <b class="fname">accept</b>(), but it also allows to set the following <i class="farg">flags</i> on the returned file descriptor:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">SOCK_CLOEXEC</span></dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
Set the close on exec property.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">SOCK_NONBLOCK</span></dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
Sets non-blocking I/O.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">SOCK_NOSIGPIPE</span></dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
Return <span class="errno">EPIPE</span> instead of raising <span class="define">SIGPIPE</span>.</dd>
</dl>
<p>
It can also temporarily replace the signal mask of the calling thread if <i class="farg">sigmask</i> is a non-<span class="define">NULL</span> pointer, then the <b class="fname">paccept</b>() function shall replace the signal mask of the caller by the set of signals pointed to by <i class="farg">sigmask</i> before waiting for a connection, and shall restore the signal mask of the calling thread before returning.</div>
<div class="section">
<h1 id="x52455455524e2056414c554553">RETURN VALUES</h1> The <b class="fname">accept</b>() and <b class="fname">paccept</b>() calls return &#45;1 on error. If they succeed, they return a non-negative integer that is a descriptor for the accepted socket.</div>
<div class="section">
<h1 id="x434f4d5041544942494c495459">COMPATIBILITY</h1> The <b class="fname">accept</b>() implementation makes the new file descriptor inherit file flags (like <span class="define">O_NONBLOCK</span>) from the listening socket. It's a traditional behaviour for BSD derivative systems. On the other hand, there are implementations which don't do so. Linux is an example of such implementations. Portable programs should not rely on either of the behaviours.</div>
<div class="section">
<h1 id="x4552524f5253">ERRORS</h1> The <b class="fname">accept</b>() will fail if:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EAGAIN</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The socket is marked non-blocking and no connections are present to be accepted.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EBADF</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The descriptor is invalid.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ECONNABORTED</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
A connection has been aborted.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EFAULT</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The <i class="farg">addr</i> parameter is not in a writable part of the user address space.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EINTR</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The <b class="fname">accept</b>() call has been interrupted by a signal.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EINVAL</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The socket has not been set up to accept connections (using <a class="link-man" href="../2/bind">bind(2)</a> and <a class="link-man" href="../2/listen">listen(2)</a>).</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EMFILE</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The per-process descriptor table is full.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ENFILE</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The system file table is full.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ENOTSOCK</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The descriptor references a file, not a socket.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EOPNOTSUPP</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The referenced socket is not of type <span class="define">SOCK_STREAM</span>.</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../2/bind">bind(2)</a>, <a class="link-man" href="../2/connect">connect(2)</a>, <a class="link-man" href="../2/listen">listen(2)</a>, <a class="link-man" href="../2/poll">poll(2)</a>, <a class="link-man" href="../2/select">select(2)</a>, <a class="link-man" href="../2/socket">socket(2)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="fname">accept</b>() function appeared in <span class="unix">4.2BSD</span>. The <b class="fname">paccept</b>() function is inspired from Linux and appeared in <span class="unix">NetBSD&#160;6.0</span>.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
March 19, 2012</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

