<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
RECV(2)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
RECV(2)</td>
<td class="head-vol" align="center">
System Calls Manual</td>
<td class="head-rtitle" align="right">
RECV(2)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">recv</b>, <b class="name">recvfrom</b>, <b class="name">recvmsg</b>, <b class="name">recvmmsg</b> &#8212; <span class="desc">receive a message from a socket</span></div>
<div class="section">
<h1 id="x4c494252415259">LIBRARY</h1> <span class="lib">Standard C Library (libc, &#45;lc)</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">sys/socket.h</a>&gt;</b><p>
<i class="ftype">ssize_t</i><br>
<b class="fname">recv</b>(<i class="farg" style="white-space:nowrap;">int s</i>, <i class="farg" style="white-space:nowrap;">void *buf</i>, <i class="farg" style="white-space:nowrap;">size_t len</i>, <i class="farg" style="white-space:nowrap;">int flags</i>);<p>
<i class="ftype">ssize_t</i><br>
<b class="fname">recvfrom</b>(<i class="farg" style="white-space:nowrap;">int s</i>, <i class="farg" style="white-space:nowrap;">void * restrict buf</i>, <i class="farg" style="white-space:nowrap;">size_t len</i>, <i class="farg" style="white-space:nowrap;">int flags</i>, <i class="farg" style="white-space:nowrap;">struct sockaddr * restrict from</i>, <i class="farg" style="white-space:nowrap;">socklen_t * restrict fromlen</i>);<p>
<i class="ftype">ssize_t</i><br>
<b class="fname">recvmsg</b>(<i class="farg" style="white-space:nowrap;">int s</i>, <i class="farg" style="white-space:nowrap;">struct msghdr *msg</i>, <i class="farg" style="white-space:nowrap;">int flags</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">recvmmsg</b>(<i class="farg" style="white-space:nowrap;">int s</i>, <i class="farg" style="white-space:nowrap;">struct mmsghdr *mmsg</i>, <i class="farg" style="white-space:nowrap;">unsigned int vlen</i>, <i class="farg" style="white-space:nowrap;">unsigned int flags</i>, <i class="farg" style="white-space:nowrap;">struct timespec *timeout</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> <b class="fname">recvfrom</b>(), <b class="fname">recvmsg</b>() and <b class="fname">recvmmsg</b>() are used to receive messages from a socket, and may be used to receive data on a socket whether or not it is connection-oriented.<p>
If <i class="farg">from</i> is non-nil, and the socket is not connection-oriented, the source address of the message is filled in. <i class="farg">fromlen</i> is a value-result parameter, initialized to the size of the buffer associated with <i class="farg">from</i>, and modified on return to indicate the actual size of the address stored there.<p>
The <b class="fname">recvmmsg</b>() call be used to receive multiple messages in the same call using an array of <i class="farg">mmsghdr</i> elements with the following form, as defined in &#60;<i class="file">sys/socket.h</i>&#62;:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
struct mmsghdr { 
	struct msghdr	msg_hdr;	/* the message to be sent */ 
	unsigned int	msg_len;	/* number of bytes received */ 
};</pre>
<p>
The <i class="farg">msg_len</i> member contains the number of bytes received for each <i class="farg">msg_hdr</i> member. The array has <i class="farg">vlen</i> elements, which is limited to <span class="define">1024</span>. If there is an error, a number fewer than <i class="farg">vlen</i> may be returned, and the error may be retrieved using <a class="link-man" href="../html2/getsockopt.html">getsockopt(2)</a> with <span class="define">SO_ERROR</span>. If the flag <span class="define">MSG_WAITFORONE</span> is set in <i class="farg">flags</i> then the <b class="fname">recvmmsg</b>() call will wait for one message, and set <span class="define">MSG_DONTWAIT</span> for the rest. If the <i class="farg">timeout</i> parameter is not <span class="define">NULL</span>, then <b class="fname">recvmmsg</b>() will return if that time is exceeded.<p>
The <b class="fname">recv</b>() call is normally used only on a <span class="emph">connected</span> socket (see <a class="link-man" href="../html2/connect.html">connect(2)</a>) and is identical to <b class="fname">recvfrom</b>() with a nil <i class="farg">from</i> parameter. As it is redundant, it may not be supported in future releases.<p>
<b class="fname">recv</b>(), <b class="fname">recvfrom</b>() and <b class="fname">recvmsg</b>() routines return the length of the message on successful completion. <b class="fname">recvmmsg</b>() returns the number of messages received. If a message is too long to fit in the supplied buffer, excess bytes may be discarded depending on the type of socket the message is received from (see <a class="link-man" href="../html2/socket.html">socket(2)</a>).<p>
If no messages are available at the socket, the receive call waits for a message to arrive, unless the socket is nonblocking (see <a class="link-man" href="../html2/fcntl.html">fcntl(2)</a>) in which case the value &#45;1 is returned and the external variable <b class="var">errno</b> set to <span class="errno">EAGAIN</span>. If no data is available and the remote peer was shut down, 0 is returned. The receive calls normally return any data available, up to the requested amount, rather than waiting for receipt of the full amount requested; this behavior is affected by the socket-level options <span class="define">SO_RCVLOWAT</span> and <span class="define">SO_RCVTIMEO</span> described in <a class="link-man" href="../html2/getsockopt.html">getsockopt(2)</a>.<p>
The <a class="link-man" href="../html2/select.html">select(2)</a> or <a class="link-man" href="../html2/poll.html">poll(2)</a> call may be used to determine when more data arrive.<p>
The <i class="farg">flags</i> argument to a recv call is formed by <span class="emph">or</span>&#39;ing one or more of the values:<table style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-col">
<col style="min-width: 16.00ex;">
<tbody>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<span class="define">MSG_CMSG_CLOEXEC</span></td>
<td class="list-col" style="margin-top: 1.00em;">
set the close on exec property for passed file descriptors</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<span class="define">MSG_OOB</span></td>
<td class="list-col" style="margin-top: 1.00em;">
process out-of-band data</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<span class="define">MSG_PEEK</span></td>
<td class="list-col" style="margin-top: 1.00em;">
peek at incoming message</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<span class="define">MSG_WAITALL</span></td>
<td class="list-col" style="margin-top: 1.00em;">
wait for full request or error</td>
</tr>
</tbody>
</table>
The <span class="define">MSG_OOB</span> flag requests receipt of out-of-band data that would not be received in the normal data stream. Some protocols place expedited data at the head of the normal data queue, and thus this flag cannot be used with such protocols. The <span class="define">MSG_PEEK</span> flag causes the receive operation to return data from the beginning of the receive queue without removing that data from the queue. Thus, a subsequent receive call will return the same data. The <span class="define">MSG_WAITALL</span> flag requests that the operation block until the full request is satisfied. However, the call may still return less data than requested if a signal is caught, an error or disconnect occurs, or the next data to be received is of a different type than that returned.<p>
The <b class="fname">recvmsg</b>() call uses a <i class="farg">msghdr</i> structure to minimize the number of directly supplied parameters. This structure has the following form, as defined in &#60;<i class="file">sys/socket.h</i>&#62;:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
struct msghdr { 
	void		*msg_name;	/* optional address */ 
	socklen_t	msg_namelen;	/* size of address */ 
	struct iovec	*msg_iov;	/* scatter/gather array */ 
	int		msg_iovlen;	/* # elements in msg_iov */ 
	void		*msg_control;	/* ancillary data, see below */ 
	socklen_t	msg_controllen; /* ancillary data buffer len */ 
	int		msg_flags;	/* flags on received message */ 
};</pre>
<p>
Here <i class="farg">msg_name</i> and <i class="farg">msg_namelen</i> specify the source address if the socket is unconnected; <i class="farg">msg_name</i> may be given as a null pointer if no names are desired or required. If the socket is connected, <i class="farg">msg_name</i> and <i class="farg">msg_namelen</i> are ignored. <i class="farg">msg_iov</i> and <i class="farg">msg_iovlen</i> describe scatter gather locations, as discussed in <a class="link-man" href="../html2/read.html">read(2)</a>. <i class="farg">msg_control</i>, which has length <i class="farg">msg_controllen</i>, points to a buffer for other protocol control related messages or other miscellaneous ancillary data. The messages are of the form:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
struct cmsghdr { 
	socklen_t	cmsg_len;	/* data byte count, including hdr */ 
	int		cmsg_level;	/* originating protocol */ 
	int		cmsg_type;	/* protocol-specific type */ 
/* followed by 
	u_char		cmsg_data[]; */ 
};</pre>
As an example, one could use this to learn of changes in the data-stream in XNS/SPP, or in ISO, to obtain user-connection-request data by requesting a recvmsg with no data buffer provided immediately after an <b class="fname">accept</b>() call.<p>
Open file descriptors are now passed as ancillary data for <span class="define">AF_LOCAL</span> domain sockets, with <i class="farg">cmsg_level</i> set to <span class="define">SOL_SOCKET</span> and <i class="farg">cmsg_type</i> set to <span class="define">SCM_RIGHTS</span>.<p>
The <i class="farg">msg_flags</i> field is set on return according to the message received. <span class="define">MSG_EOR</span> indicates end-of-record; the data returned completed a record (generally used with sockets of type <span class="define">SOCK_SEQPACKET</span>). <span class="define">MSG_TRUNC</span> indicates that the trailing portion of a datagram was discarded because the datagram was larger than the buffer supplied. <span class="define">MSG_CTRUNC</span> indicates that some control data were discarded due to lack of space in the buffer for ancillary data. <span class="define">MSG_OOB</span> is returned to indicate that expedited or out-of-band data were received.</div>
<div class="section">
<h1 id="x52455455524e2056414c554553">RETURN VALUES</h1> The <b class="fname">recv</b>(), <b class="fname">recvfrom</b>() and <b class="fname">recvmsg</b>() calls return the number of bytes received, or &#45;1 if an error occurred. For connected sockets whose remote peer was shut down, 0 is returned when no more data is available. The <b class="fname">recvmmsg</b>() calls return the number of messages received, or &#45;1 if an error occurred.</div>
<div class="section">
<h1 id="x4552524f5253">ERRORS</h1> The calls fail if:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EAGAIN</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The socket is marked non-blocking, and the receive operation would block, or a receive timeout had been set, and the timeout expired before data were received.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EBADF</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The argument <i class="farg">s</i> is an invalid descriptor.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EFAULT</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The receive buffer pointer(s) point outside the process's address space.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EINTR</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The receive was interrupted by delivery of a signal before any data were available.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EINVAL</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The total length of the I/O is more than can be expressed by the ssize_t return value.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ENOTCONN</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The socket is associated with a connection-oriented protocol and has not been connected (see <a class="link-man" href="../html2/connect.html">connect(2)</a> and <a class="link-man" href="../html2/accept.html">accept(2)</a>).</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ENOTSOCK</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The argument <i class="farg">s</i> does not refer to a socket.</dd>
</dl>
<p>
<b class="fname">recvmsg</b>() will also fail if:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EMSGSIZE</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The <i class="farg">msg_iovlen</i> member of the <i class="farg">msg</i> structure is less than or equal to 0 or is greater than &#123;<span class="define">IOV_MAX</span>&#125;.</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html2/fcntl.html">fcntl(2)</a>, <a class="link-man" href="../html2/getsockopt.html">getsockopt(2)</a>, <a class="link-man" href="../html2/poll.html">poll(2)</a>, <a class="link-man" href="../html2/read.html">read(2)</a>, <a class="link-man" href="../html2/select.html">select(2)</a>, <a class="link-man" href="../html2/socket.html">socket(2)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="fname">recv</b>() function call appeared in <span class="unix">4.2BSD</span>. The <b class="fname">recvmmsg</b>() function call appeared in Linux 2.6.32 and <span class="unix">NetBSD&#160;7.0</span>.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
June 22, 2012</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

