<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
USB(4)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
USB(4)</td>
<td class="head-vol" align="center">
Kernel Interfaces Manual</td>
<td class="head-rtitle" align="right">
USB(4)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">usb</b> &#8212; <span class="desc">Universal Serial Bus driver</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="config">ehci*   at cardbus? function ?</b><br>
<b class="config">ehci*   at pci? dev ? function ?</b><br>
<b class="config">ohci*   at cardbus? function ?</b><br>
<b class="config">ohci*   at pci? dev ? function ?</b><br>
<b class="config">slhci*  at isa? port ? irq ?</b><br>
<b class="config">slhci*  at pcmcia? function ?</b><br>
<b class="config">uhci*   at cardbus? function ?</b><br>
<b class="config">uhci*   at pci? dev ? function ?</b><br>
<b class="config">usb*    at ehci? flags X</b><br>
<b class="config">usb*    at ohci? flags X</b><br>
<b class="config">usb*    at uhci? flags X</b><br>
<b class="config">usb*    at slhci? flags X</b><br>
<b class="config">uhub*   at usb?</b><br>
<b class="config">uhub*   at uhub? port ? configuration ? interface ? vendor ? product ? release ?</b><br>
<b class="config">XX*     at uhub? port ? configuration ? interface ? vendor ? product ? release ?</b><p>
<br>
<b class="config">options USBVERBOSE</b><p>
<br>
<b class="includes">#include &lt;<a class="link-includes">dev/usb/usb.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">dev/usb/usbhid.h</a>&gt;</b></div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> <span class="unix">NetBSD</span> provides machine-independent bus support and drivers for USB devices.<p>
The <span class="unix">NetBSD</span> <b class="name">usb</b> driver has three layers (like <a class="link-man" href="../4/scsi">scsi(4)</a> and <a class="link-man" href="../4/pcmcia">pcmcia(4)</a>): the controller, the bus, and the device layer. The controller attaches to a physical bus (like <a class="link-man" href="../4/pci">pci(4)</a>). The USB bus attaches to the controller and the root hub attaches to the bus. Further devices, which may include further hubs, attach to other hubs. The attachment forms the same tree structure as the physical USB device tree. For each USB device there may be additional drivers attached to it.<p>
The <b class="flag">uhub</b> device controls USB hubs and must always be present since there is at least a root hub in any USB system.<p>
The <b class="var">flags</b> argument to the <b class="var">usb</b> device affects the order in which the device detection happens during cold boot. Normally, only the USB host controller and the <b class="var">usb</b> device are detected during the autoconfiguration when the machine is booted. The rest of the devices are detected once the system becomes functional and the kernel thread for the <b class="var">usb</b> device is started. Sometimes it is desirable to have a device detected early in the boot process, e.g., the console keyboard. To achieve this use a <b class="var">flags</b> value of 1.<p>
<span class="unix">NetBSD</span> supports the following machine-independent USB drivers:<div class="subsection">
<h2 id="x53746f726167652064657669636573">Storage devices</h2><dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 3.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<a class="link-man" href="../4/umass">umass(4)</a></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
USB Mass Storage Devices, e.g., external disk drives</dd>
</dl>
</div>
<div class="subsection">
<h2 id="x5769726564206e6574776f726b20696e7465726661636573">Wired network interfaces</h2><dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 3.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<a class="link-man" href="../4/aue">aue(4)</a></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
ADMtek AN986/ADM8511 Pegasus family 10/100 USB Ethernet device</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<a class="link-man" href="../4/axe">axe(4)</a></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
ASIX Electronics AX88172/AX88178/AX88772 10/100/Gigabit USB Ethernet device</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<a class="link-man" href="../4/axen">axen(4)</a></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
ASIX Electronics AX88178a/AX88179 10/100/Gigabit USB Ethernet device</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<a class="link-man" href="../4/cdce">cdce(4)</a></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
USB Communication Device Class Ethernet device</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<a class="link-man" href="../4/cue">cue(4)</a></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
CATC USB-EL1201A USB Ethernet device</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<a class="link-man" href="../4/kue">kue(4)</a></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Kawasaki LSI KL5KUSB101B USB Ethernet device</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<a class="link-man" href="../4/udav">udav(4)</a></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Davicom DM9601 10/100 USB Ethernet device</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<a class="link-man" href="../4/url">url(4)</a></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Realtek RTL8150L 10/100 USB Ethernet device</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<a class="link-man" href="../4/urndis">urndis(4)</a></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
USB Remote NDIS Ethernet device</dd>
</dl>
</div>
<div class="subsection">
<h2 id="x576972656c657373206e6574776f726b20696e7465726661636573">Wireless network interfaces</h2><dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 3.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<a class="link-man" href="../4/atu">atu(4)</a></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Atmel AT76C50x IEEE 802.11b wireless network device</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<a class="link-man" href="../4/ral">ral(4)</a></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Ralink Technology USB IEEE 802.11b/g wireless network device</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<a class="link-man" href="../4/rum">rum(4)</a></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Ralink Technology USB IEEE 802.11a/b/g wireless network device</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<a class="link-man" href="../4/run">run(4)</a></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Ralink Technology USB IEEE 802.11a/b/g/n wireless network device</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<a class="link-man" href="../4/ubt">ubt(4)</a></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
USB Bluetooth dongles</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<a class="link-man" href="../4/upgt">upgt(4)</a></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Conexant/Intersil PrismGT SoftMAC USB 802.11b/g wireless network device</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<a class="link-man" href="../4/urtwn">urtwn(4)</a></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Realtek RTL8188CU/RTL8192CU USB IEEE 802.11b/g/n wireless network device</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<a class="link-man" href="../4/zyd">zyd(4)</a></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
ZyDAS ZD1211/ZD1211B USB IEEE 802.11b/g wireless network device</dd>
</dl>
</div>
<div class="subsection">
<h2 id="x53657269616c20616e6420706172616c6c656c20696e7465726661636573">Serial and parallel interfaces</h2><dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 3.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<a class="link-man" href="../4/ubsa">ubsa(4)</a></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Belkin USB serial adapter</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<a class="link-man" href="../4/uchcom">uchcom(4)</a></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
WinChipHead CH341/340 based USB serial adapter</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<a class="link-man" href="../4/ucom">ucom(4)</a></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
USB tty support</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<a class="link-man" href="../4/ucycom">ucycom(4)</a></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Cypress microcontroller based USB serial adapter</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<a class="link-man" href="../4/uftdi">uftdi(4)</a></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
FT8U100AX USB serial adapter</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<a class="link-man" href="../4/ugensa">ugensa(4)</a></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
USB generic serial adapter</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<a class="link-man" href="../4/uhmodem">uhmodem(4)</a></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
USB Huawei 3G wireless modem device</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<a class="link-man" href="../4/uipaq">uipaq(4)</a></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
iPAQ USB units</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<a class="link-man" href="../4/ukyopon">ukyopon(4)</a></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
USB Kyocera AIR-EDGE PHONE device</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<a class="link-man" href="../4/ulpt">ulpt(4)</a></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
USB printer support</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<a class="link-man" href="../4/umct">umct(4)</a></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
MCT USB-RS232 USB serial adapter</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<a class="link-man" href="../4/umodem">umodem(4)</a></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
USB modem support</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<a class="link-man" href="../4/uplcom">uplcom(4)</a></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Prolific PL-2303 USB serial adapter</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<a class="link-man" href="../4/uslsa">uslsa(4)</a></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Silicon Laboratories CP2101/CP2102 based USB serial adapter</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<a class="link-man" href="../4/uvisor">uvisor(4)</a></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
USB Handspring Visor</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<a class="link-man" href="../4/uvscom">uvscom(4)</a></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
SUNTAC Slipper U VS-10U USB serial adapter</dd>
</dl>
</div>
<div class="subsection">
<h2 id="x417564696f2064657669636573">Audio devices</h2><dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 3.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<a class="link-man" href="../4/uaudio">uaudio(4)</a></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
USB audio devices</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<a class="link-man" href="../4/umidi">umidi(4)</a></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
USB MIDI devices</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<a class="link-man" href="../4/urio">urio(4)</a></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Diamond Multimedia Rio MP3 players</dd>
</dl>
</div>
<div class="subsection">
<h2 id="x526164696f2072656365697665722064657669636573">Radio receiver devices</h2><dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 3.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<a class="link-man" href="../4/udsbr">udsbr(4)</a></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
D-Link DSB-R100 USB radio device</dd>
</dl>
</div>
<div class="subsection">
<h2 id="x48756d616e20496e746572666163652044657669636573">Human Interface Devices</h2><dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 3.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<a class="link-man" href="../4/uhid">uhid(4)</a></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Generic driver for Human Interface Devices</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<a class="link-man" href="../4/uhidev">uhidev(4)</a></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Base driver for all Human Interface Devices</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<a class="link-man" href="../4/ukbd">ukbd(4)</a></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
USB keyboards that follow the boot protocol</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<a class="link-man" href="../4/ums">ums(4)</a></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
USB mouse devices</dd>
</dl>
</div>
<div class="subsection">
<h2 id="x4d697363656c6c616e656f75732064657669636573">Miscellaneous devices</h2><dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 3.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<a class="link-man" href="../4/stuirda">stuirda(4)</a></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Sigmaltel 4116/4220 USB-IrDA bridge</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<a class="link-man" href="../4/udsir">udsir(4)</a></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
KingSun/DonShine USB IrDA bridge</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<a class="link-man" href="../4/uep">uep(4)</a></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
USB eGalax touch-panel</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<a class="link-man" href="../4/ugen">ugen(4)</a></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
USB generic devices</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<a class="link-man" href="../4/uirda">uirda(4)</a></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
USB IrDA bridges</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<a class="link-man" href="../4/upl">upl(4)</a></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Prolific based host-to-host adapters</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<a class="link-man" href="../4/uscanner">uscanner(4)</a></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
USB scanner support</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<a class="link-man" href="../4/usscanner">usscanner(4)</a></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
SCSI-over-USB scanners</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<a class="link-man" href="../4/ustir">ustir(4)</a></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
SigmaTel STIr4200 USB IrDA bridges</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<a class="link-man" href="../4/utoppy">utoppy(4)</a></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Topfield TF5000PVR range of digital video recorders</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<a class="link-man" href="../4/uyap">uyap(4)</a></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
USB YAP phone firmware loader</dd>
</dl>
</div>
</div>
<div class="section">
<h1 id="x494e54524f44554354494f4e20544f20555342">INTRODUCTION TO USB</h1> The USB 1.x is a 12 Mb/s serial bus with 1.5 Mb/s for low speed devices. USB 2.x handles 480 Mb/s. Each USB has a host controller that is the master of the bus; all other devices on the bus only speak when spoken to.<p>
There can be up to 127 devices (apart from the host controller) on a bus, each with its own address. The addresses are assigned dynamically by the host when each device is attached to the bus.<p>
Within each device there can be up to 16 endpoints. Each endpoint is individually addressed and the addresses are static. Each of these endpoints will communicate in one of four different modes: control, isochronous, bulk, or interrupt. A device always has at least one endpoint. This endpoint has address 0 and is a control endpoint and is used to give commands to and extract basic data, such as descriptors, from the device. Each endpoint, except the control endpoint, is unidirectional.<p>
The endpoints in a device are grouped into interfaces. An interface is a logical unit within a device; e.g., a compound device with both a keyboard and a trackball would present one interface for each. An interface can sometimes be set into different modes, called alternate settings, which affects how it operates. Different alternate settings can have different endpoints within it.<p>
A device may operate in different configurations. Depending on the configuration the device may present different sets of endpoints and interfaces.<p>
Each device located on a hub has several <a class="link-man" href="../1/config">config(1)</a> locators:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="config">port</b></dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
this is the number of the port on closest upstream hub.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="config">configuration</b></dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
this is the configuration the device must be in for this driver to attach. This locator does not set the configuration; it is iterated by the bus enumeration.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="config">interface</b></dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
this is the interface number within a device that an interface driver attaches to.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="config">vendor</b></dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
this is the 16 bit vendor id of the device.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="config">product</b></dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
this is the 16 bit product id of the device.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="config">release</b></dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
this is the 16 bit release (revision) number of the device.</dd>
</dl>
The first locator can be used to pin down a particular device according to its physical position in the device tree. The last three locators can be used to pin down a particular device according to what device it actually is.<p>
The bus enumeration of the USB bus proceeds in several steps:<ol style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-enum">
<li class="list-enum" style="margin-top: 1.00em;">
Any device specific driver can attach to the device.</li>
<li class="list-enum" style="margin-top: 1.00em;">
If none is found, any device class specific driver can attach.</li>
<li class="list-enum" style="margin-top: 1.00em;">
If none is found, all configurations are iterated over. For each configuration all the interface are iterated over and interface drivers can attach. If any interface driver attached in a certain configuration the iteration over configurations is stopped.</li>
<li class="list-enum" style="margin-top: 1.00em;">
If still no drivers have been found, the generic USB driver can attach.</li>
</ol>
</div>
<div class="section">
<h1 id="x55534220434f4e54524f4c4c455220494e54455246414345">USB CONTROLLER INTERFACE</h1> Use the following to get access to the USB specific structures and defines.<p>
<pre style="margin-left: 0.00ex;" class="lit display">
#include &lt;dev/usb/usb.h&gt;</pre>
<p>
The <i class="file">/dev/usbN</i> can be opened and a few operations can be performed on it. The <a class="link-man" href="../2/poll">poll(2)</a> system call will say that I/O is possible on the controller device when a USB device has been connected or disconnected to the bus.<p>
The following <a class="link-man" href="../2/ioctl">ioctl(2)</a> commands are supported on the controller device:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">USB_DEVICEINFO</span> <i class="farg">struct usb_device_info</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This command can be used to retrieve some information about a device on the bus. The <b class="var">addr</b> field should be filled before the call and the other fields will be filled by information about the device on that address. Should no such device exist an error is reported.<p>
<pre style="margin-left: 0.00ex;" class="lit display">
struct usb_device_info { 
	uint8_t	udi_bus; 
	uint8_t	udi_addr; 
	usb_event_cookie_t udi_cookie; 
	char		udi_product[USB_MAX_ENCODED_STRING_LEN]; 
	char		udi_vendor[USB_MAX_ENCODED_STRING_LEN]; 
	char		udi_release[8]; 
	char		udi_serial[USB_MAX_ENCODED_STRING_LEN]; 
	uint16_t	udi_productNo; 
	uint16_t	udi_vendorNo; 
	uint16_t	udi_releaseNo; 
	uint8_t	udi_class; 
	uint8_t	udi_subclass; 
	uint8_t	udi_protocol; 
	uint8_t	udi_config; 
	uint8_t	udi_speed; 
#define USB_SPEED_LOW  1 
#define USB_SPEED_FULL 2 
#define USB_SPEED_HIGH 3 
	int		udi_power; 
	int		udi_nports; 
	char		udi_devnames[USB_MAX_DEVNAMES][USB_MAX_DEVNAMELEN]; 
	uint8_t	udi_ports[16]; 
#define USB_PORT_ENABLED 0xff 
#define USB_PORT_SUSPENDED 0xfe 
#define USB_PORT_POWERED 0xfd 
#define USB_PORT_DISABLED 0xfc 
};</pre>
<p>
The <b class="var">product</b>, <b class="var">vendor</b>, <b class="var">release</b>, and <b class="var">serial</b> fields contain self-explanatory descriptions of the device.<p>
The <b class="var">class</b> field contains the device class.<p>
The <b class="var">config</b> field shows the current configuration of the device.<p>
The <b class="var">lowspeed</b> field is set if the device is a USB low speed device.<p>
The <b class="var">power</b> field shows the power consumption in milli-amps drawn at 5 volts, or zero if the device is self powered.<p>
If the device is a hub the <b class="var">nports</b> field is non-zero and the <b class="var">ports</b> field contains the addresses of the connected devices. If no device is connected to a port one of the <b class="var">USB_PORT_*</b> values indicates its status.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">USB_DEVICESTATS</span> <i class="farg">struct usb_device_stats</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This command retrieves statistics about the controller.<p>
<pre style="margin-left: 0.00ex;" class="lit display">
struct usb_device_stats { 
	u_long	uds_requests[4]; 
};</pre>
<p>
The <b class="var">requests</b> field is indexed by the transfer kind, i.e. <b class="var">UE_*</b>, and indicates how many transfers of each kind have been completed by the controller.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">USB_REQUEST</span> <i class="farg">struct usb_ctl_request</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This command can be used to execute arbitrary requests on the control pipe. This is <span class="emph">DANGEROUS</span> and should be used with great care since it can destroy the bus integrity.</dd>
</dl>
<p>
The include file <b class="includes">&lt;<a class="link-includes">dev/usb/usb.h</a>&gt;</b> contains definitions for the types used by the various <a class="link-man" href="../2/ioctl">ioctl(2)</a> calls. The naming convention of the fields for the various USB descriptors exactly follows the naming in the USB specification. Byte sized fields can be accessed directly, but word (16 bit) sized fields must be access by the <b class="fname">UGETW</b>(<i class="farg">field</i>) and <b class="fname">USETW</b>(<i class="farg">field</i>, <i class="farg">value</i>) macros to handle byte order and alignment properly.<p>
The include file <b class="includes">&lt;<a class="link-includes">dev/usb/usbhid.h</a>&gt;</b> similarly contains the definitions for Human Interface Devices (HID).</div>
<div class="section">
<h1 id="x555342204556454e5420494e54455246414345">USB EVENT INTERFACE</h1> All USB events are reported via the <i class="file">/dev/usb</i> device. This devices can be opened for reading and each <a class="link-man" href="../2/read">read(2)</a> will yield an event record (if something has happened). The <a class="link-man" href="../2/poll">poll(2)</a> system call can be used to determine if an event record is available for reading.<p>
The event record has the following definition:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
struct usb_event { 
        int                                 ue_type; 
#define USB_EVENT_CTRLR_ATTACH 1 
#define USB_EVENT_CTRLR_DETACH 2 
#define USB_EVENT_DEVICE_ATTACH 3 
#define USB_EVENT_DEVICE_DETACH 4 
#define USB_EVENT_DRIVER_ATTACH 5 
#define USB_EVENT_DRIVER_DETACH 6 
        struct timespec                     ue_time; 
        union { 
                struct { 
                        int                 ue_bus; 
                } ue_ctrlr; 
                struct usb_device_info      ue_device; 
                struct { 
                        usb_event_cookie_t  ue_cookie; 
                        char                ue_devname[16]; 
                } ue_driver; 
        } u; 
};</pre>
<p>
The <b class="var">ue_type</b> field identifies the type of event that is described. The possible events are attach/detach of a host controller, a device, or a device driver. The union contains information pertinent to the different types of events.<p>
The <b class="var">ue_bus</b> contains the number of the USB bus for host controller events.<p>
The <b class="var">ue_device</b> record contains information about the device in a device event event.<p>
The <b class="var">ue_cookie</b> is an opaque value that uniquely determines which device a device driver has been attached to (i.e., it equals the cookie value in the device that the driver attached to). The <b class="var">ue_devname</b> contains the name of the device (driver) as seen in, e.g., kernel messages.<p>
Note that there is a separation between device and device driver events. A device event is generated when a physical USB device is attached or detached. A single USB device may have zero, one, or many device drivers associated with it.</div>
<div class="section">
<h1 id="x4b45524e454c2054485245414453">KERNEL THREADS</h1> For each USB bus, i.e., for each host controller, there is a kernel thread that handles attach and detach of devices on that bus. The thread is named <b class="var">usbN</b> where <b class="var">N</b> is the bus number.<p>
In addition there is a kernel thread, <b class="var">usbtask</b>, which handles various minor tasks that are initiated from an interrupt context, but need to sleep, e.g., time-out abort of transfers.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../1/usbhidaction">usbhidaction(1)</a>, <a class="link-man" href="../1/usbhidctl">usbhidctl(1)</a>, <a class="link-man" href="../4/cardbus">cardbus(4)</a>, <a class="link-man" href="../4/ehci">ehci(4)</a>, <a class="link-man" href="../4/isa">isa(4)</a>, <a class="link-man" href="../4/ohci">ohci(4)</a>, <a class="link-man" href="../4/pci">pci(4)</a>, <a class="link-man" href="../4/pcmcia">pcmcia(4)</a>, <a class="link-man" href="../4/slhci">slhci(4)</a>, <a class="link-man" href="../4/uhci">uhci(4)</a>, <a class="link-man" href="../8/usbdevs">usbdevs(8)</a><p>
<span class="ref"><span class="ref-title">Universal Serial Bus Specifications Documents</span>, <a class="link-ref" href="http://www.usb.org/developers/docs/">http://www.usb.org/developers/docs/</a>.</span></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="name">usb</b> driver appeared in <span class="unix">NetBSD&#160;1.4</span>.</div>
<div class="section">
<h1 id="x42554753">BUGS</h1> There should be a serial number locator, but <span class="unix">NetBSD</span> does not have string valued locators.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
January 23, 2014</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

