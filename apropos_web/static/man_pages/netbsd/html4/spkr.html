<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/../4/strict.dtd">
>
<head>
<meta http-equiv="Content-Type" content="te../; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
SPEAKER(4)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
SPEAKER(4)</td>
<td class="head-vol" align="center">
Kernel Interfaces Manual</td>
<td class="head-rtitle" align="right">
SPEAKER(4)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">speaker</b> &#8212; <span class="desc">console speaker audio device driver</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="config">spkr0	at pcppi?</b><br>
<b class="includes">#include &lt;<a class="link-includes">machine/spkr.h</a>&gt;</b> <i class="file">/dev/speaker</i></div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The speaker device driver allows applications to control the console speaker on machines with a PC-like 8253 timer implementation.<p>
Only one process may have this device open at any given time; open() and close() are used to lock and relinquish it. An attempt to open() when another process has the device locked will return -1 with an <span class="errno">EBUSY</span> error indication. Writes to the device are interpreted as 'play strings' in a simple ASCII melody notation. An <b class="fname">ioctl</b>() for tone generation at arbitrary frequencies is also supported.<p>
Sound-generation does <span class="emph">not</span> monopolize the processor; in fact, the driver spends most of its time sleeping while the PC hardware is emitting tones. Other processes may emit beeps while the driver is running.<p>
Applications may call <b class="fname">ioctl</b>() on a speaker file descriptor to control the speaker driver directly; definitions for the <b class="fname">ioctl</b>() interface are in <b class="includes">&lt;<a class="link-includes">machine/spkr.h</a>&gt;</b>. The tone_t structure used in these calls has two fields, specifying a frequency (in hz) and a duration (in 1/100ths of a second). A frequency of zero is interpreted as a rest.<p>
At present there are two such ioctls. SPKRTONE accepts a pointer to a single tone structure as third argument and plays it. SPKRTUNE accepts a pointer to the first of an array of tone structures and plays them in continuous sequence; this array must be terminated by a final member with a zero duration.<p>
The play-string language is modelled on the PLAY statement conventions of IBM BASIC 2.0. The MB, MF and X primitives of PLAY are not useful in a UNIX environment and are omitted. The `octave-tracking' feature is also new.<p>
There are 84 accessible notes numbered 1-83 in 7 octaves, each running from C to B, numbered 0-6; the scale is equal-tempered A440 and octave 3 starts with middle C. By default, the play function emits half-second notes with the last 1/16th second being `rest time'.<p>
Play strings are interpreted left to right as a series of play command groups; letter case is ignored. Play command groups are as follows:<p>
CDEFGAB -- letters A through G cause the corresponding note to be played in the current octave. A note letter may optionally be followed by an <span class="emph">accidental sign</span>, one of # + or -; the first two of these cause it to be sharped one half-tone, the last causes it to be flatted one half-tone. It may also be followed by a time value number and by sustain dots (see below). Time values are interpreted as for the L command below;.<p>
O &lt;n&gt; -- if &lt;n&gt; is numeric, this sets the current octave. &lt;n&gt; may also be one of 'L' or 'N' to enable or disable octave-tracking (it is disabled by default). When octave-tracking is on, interpretation of a pair of letter notes will change octaves if necessary in order to make the smallest possible jump between notes. Thus "olbc" will be played as "olb&gt;c", and "olcb" as "olc&lt;b". Octave locking is disabled for one letter note following by &gt;, &lt; and O[0123456].<p>
&gt; -- bump the current octave up one.<p>
&lt; -- drop the current octave down one.<p>
N &lt;n&gt; -- play note n, n being 1 to 84 or 0 for a rest of current time value. May be followed by sustain dots.<p>
L &lt;n&gt; -- sets the current time value for notes. The default is L4, quarter notes. The lowest possible value is 1; values up to 64 are accepted. L1 sets whole notes, L2 sets half notes, L4 sets quarter notes, etc..<p>
P &lt;n&gt; -- pause (rest), with &lt;n&gt; interpreted as for L. May be followed by sustain dots. May also be written '~'.<p>
T &lt;n&gt; -- Sets the number of quarter notes per minute; default is 120. Musical names for common tempi are:<table style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-col">
<col style="width: 11.00ex;">
<col style="width: 11.00ex;">
<col style="min-width: 16.00ex;">
<tbody>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
</td>
<td class="list-col" style="margin-top: 1.00em;">
<span class="symb">Tempo</span></td>
<td class="list-col" style="margin-top: 1.00em;">
<span class="symb">Beats per Minute</span></td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
very slow</td>
<td class="list-col" style="margin-top: 1.00em;">
Larghissimo</td>
<td class="list-col" style="margin-top: 1.00em;">
</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
</td>
<td class="list-col" style="margin-top: 1.00em;">
Largo</td>
<td class="list-col" style="margin-top: 1.00em;">
40-60</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
</td>
<td class="list-col" style="margin-top: 1.00em;">
Larghetto</td>
<td class="list-col" style="margin-top: 1.00em;">
60-66</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
</td>
<td class="list-col" style="margin-top: 1.00em;">
Grave</td>
<td class="list-col" style="margin-top: 1.00em;">
</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
</td>
<td class="list-col" style="margin-top: 1.00em;">
Lento</td>
<td class="list-col" style="margin-top: 1.00em;">
</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
</td>
<td class="list-col" style="margin-top: 1.00em;">
Adagio</td>
<td class="list-col" style="margin-top: 1.00em;">
66-76</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
slow</td>
<td class="list-col" style="margin-top: 1.00em;">
Adagietto</td>
<td class="list-col" style="margin-top: 1.00em;">
</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
</td>
<td class="list-col" style="margin-top: 1.00em;">
Andante</td>
<td class="list-col" style="margin-top: 1.00em;">
76-108</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
medium</td>
<td class="list-col" style="margin-top: 1.00em;">
Andantino</td>
<td class="list-col" style="margin-top: 1.00em;">
</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
</td>
<td class="list-col" style="margin-top: 1.00em;">
Moderato</td>
<td class="list-col" style="margin-top: 1.00em;">
108-120</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
fast</td>
<td class="list-col" style="margin-top: 1.00em;">
Allegretto</td>
<td class="list-col" style="margin-top: 1.00em;">
</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
</td>
<td class="list-col" style="margin-top: 1.00em;">
Allegro</td>
<td class="list-col" style="margin-top: 1.00em;">
120-168</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
</td>
<td class="list-col" style="margin-top: 1.00em;">
Vivace</td>
<td class="list-col" style="margin-top: 1.00em;">
</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
</td>
<td class="list-col" style="margin-top: 1.00em;">
Veloce</td>
<td class="list-col" style="margin-top: 1.00em;">
</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
</td>
<td class="list-col" style="margin-top: 1.00em;">
Presto</td>
<td class="list-col" style="margin-top: 1.00em;">
168-208</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
very fast</td>
<td class="list-col" style="margin-top: 1.00em;">
Prestissimo</td>
<td class="list-col" style="margin-top: 1.00em;">
</td>
</tr>
</tbody>
</table>
<p>
M[LNS] -- set articulation. MN (N for normal) is the default; the last 1/8th of the note's value is rest time. You can set ML for legato (no rest space) or MS (staccato) 1/4 rest space.<p>
Notes (that is, CDEFGAB or N command character groups) may be followed by sustain dots. Each dot causes the note's value to be lengthened by one-half for each one. Thus, a note dotted once is held for 3/2 of its undotted value; dotted twice, it is held 9/4, and three times would give 27/8.<p>
Whitespace in play strings is simply skipped and may be used to separate melody sections.</div>
<div class="section">
<h1 id="x46494c4553">FILES</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/dev/speaker</i></dt>
<dd class="list-tag" style="margin-left: 32.00ex;">
</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../4/pcppi">pcppi(4)</a></div>
<div class="section">
<h1 id="x415554484f5253">AUTHORS</h1> <span class="author">Eric S. Raymond</span> &#60;<a class="link-mail" href="mailto:esr@snark.thyrsus.com">esr@snark.thyrsus.com</a>&#62;</div>
<div class="section">
<h1 id="x42554753">BUGS</h1> Due to roundoff in the pitch tables and slop in the tone-generation and timer hardware (neither of which was designed for precision), neither pitch accuracy nor timings will be mathematically exact.<p>
There is no volume control.<p>
In play strings which are very long (longer than your system's physical I/O blocks) note suffixes or numbers may occasionally be parsed incorrectly due to crossing a block boundary.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
August 6, 1993</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
<>

