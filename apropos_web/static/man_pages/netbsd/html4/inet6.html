<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="/static/man_pages/netbsd/style.css" type="text/css" media="all">
<title>
INET6(4)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
INET6(4)</td>
<td class="head-vol" align="center">
Kernel Interfaces Manual</td>
<td class="head-rtitle" align="right">
INET6(4)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">inet6</b> &#8212; <span class="desc">Internet protocol version 6 family</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">sys/types.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">netinet/in.h</a>&gt;</b></div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="name">inet6</b> family is an updated version of <a class="link-man" href="../4/inet">inet(4)</a> family. While <a class="link-man" href="../4/inet">inet(4)</a> implements Internet Protocol version 4, <b class="name">inet6</b> implements Internet Protocol version 6.<p>
<b class="name">inet6</b> is a collection of protocols layered atop the <span class="emph">Internet Protocol version 6</span> (IPv6) transport layer, and using the IPv6 address format. The <b class="name">inet6</b> family provides protocol support for the <span class="define">SOCK_STREAM</span>, <span class="define">SOCK_DGRAM</span>, and <span class="define">SOCK_RAW</span> socket types; the <span class="define">SOCK_RAW</span> interface provides access to the IPv6 protocol.</div>
<div class="section">
<h1 id="x41444452455353494e47">ADDRESSING</h1> IPv6 addresses are 16 byte quantities, stored in network standard byteorder. The include file <b class="includes">&lt;<a class="link-includes">netinet/in.h</a>&gt;</b> defines this address as a discriminated union.<p>
Sockets bound to the <b class="name">inet6</b> family use the following addressing structure:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
struct sockaddr_in6 { 
	uint8_t		sin6_len; 
	sa_family_t	sin6_family; 
	in_port_t	sin6_port; 
	uint32_t	sin6_flowinfo; 
	struct in6_addr	sin6_addr; 
	uint32_t	sin6_scope_id; 
};</pre>
<p>
Sockets may be created with the local address &#8220;<span class="define">::</span>&#8221; (which is equal to IPv6 address <span class="define">0:0:0:0:0:0:0:0</span>) to effect &#8220;wildcard&#8221; matching on incoming messages.<p>
The IPv6 specification defines scoped addresses, like link-local or site-local addresses. A scoped address is ambiguous to the kernel, if it is specified without a scope identifier. To manipulate scoped addresses properly from the userland, programs must use the advanced API defined in RFC 2292. A compact description of the advanced API is available in <a class="link-man" href="../4/ip6">ip6(4)</a>. If a scoped address is specified without an explicit scope, the kernel may raise an error. Note that scoped addresses are not for daily use at this moment, both from a specification and an implementation point of view.<p>
The KAME implementation supports an extended numeric IPv6 address notation for link-local addresses, like &#8220;<code class="lit">fe80::1%de0</code>&#8221; to specify &#8220;<code class="lit">fe80::1</code> on <code class="lit">de0</code> interface&#8221;. This notation is supported by <a class="link-man" href="../3/getaddrinfo">getaddrinfo(3)</a> and <a class="link-man" href="../3/getnameinfo">getnameinfo(3)</a>. Some of normal userland programs, such as <a class="link-man" href="../1/telnet">telnet(1)</a> or <a class="link-man" href="../1/ftp">ftp(1)</a>, are able to use this notation. With special programs like <a class="link-man" href="../8/ping6">ping6(8)</a>, you can specify the outgoing interface by an extra command line option to disambiguate scoped addresses.<p>
Scoped addresses are handled specially in the kernel. In kernel structures like routing tables or interface structures, a scoped address will have its interface index embedded into the address. Therefore, the address in some kernel structures is not the same as that on the wire. The embedded index will become visible through a <span class="define">PF_ROUTE</span> socket, kernel memory accesses via <a class="link-man" href="../3/kvm">kvm(3)</a> and on some other occasions. HOWEVER, users should never use the embedded form. For details please consult <a class="link-ext" href="http://www.kame.net/dev/cvsweb2.cgi/kame/IMPLEMENTATION">http://www.kame.net/dev/cvsweb2.cgi/kame/IMPLEMENTATION</a>. Note that the above URL describes the situation with the latest KAME tree, not the <span class="unix">NetBSD</span> tree.</div>
<div class="section">
<h1 id="x50524f544f434f4c53">PROTOCOLS</h1> The <b class="name">inet6</b> family comprises the IPv6 network protocol, Internet Control Message Protocol version 6 (ICMPv6), Transmission Control Protocol (TCP), and User Datagram Protocol (UDP). TCP is used to support the <span class="define">SOCK_STREAM</span> abstraction while UDP is used to support the <span class="define">SOCK_DGRAM</span> abstraction. Note that TCP and UDP are common to <a class="link-man" href="../4/inet">inet(4)</a> and <b class="name">inet6</b>. A raw interface to IPv6 is available by creating an Internet socket of type <span class="define">SOCK_RAW</span>. The ICMPv6 message protocol is accessible from a raw socket.<div class="subsection">
<h2 id="x496e746572616374696f6e206265747765656e20495076342f763620736f636b657473">Interaction between IPv4/v6 sockets</h2> By default, <span class="unix">NetBSD</span> does not route IPv4 traffic to <span class="define">AF_INET6</span> sockets. The default behavior intentionally violates RFC 2553 for security reasons. Listen to two sockets if you want to accept both IPv4 and IPv6 traffic. IPv4 traffic may be routed with certain per-socket/per-node configuration, however, it is not recommended to do so. Consult <a class="link-man" href="../4/ip6">ip6(4)</a> for details.<p>
The behavior of <span class="define">AF_INET6</span> TCP/UDP socket is documented in RFC 2553. Basically, it says this:<ul style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-bul">
<li class="list-bul" style="margin-top: 0.00em;">
A specific bind on an <span class="define">AF_INET6</span> socket (<a class="link-man" href="../2/bind">bind(2)</a> with an address specified) should accept IPv6 traffic to that address only.</li>
<li class="list-bul" style="margin-top: 0.00em;">
If you perform a wildcard bind on an <span class="define">AF_INET6</span> socket (<a class="link-man" href="../2/bind">bind(2)</a> to IPv6 address <code class="lit">::</code>), and there is no wildcard bind <span class="define">AF_INET</span> socket on that TCP/UDP port, IPv6 traffic as well as IPv4 traffic should be routed to that <span class="define">AF_INET6</span> socket. IPv4 traffic should be seen as if it came from an IPv6 address like <code class="lit">::ffff:10.1.1.1</code>. This is called an IPv4 mapped address.</li>
<li class="list-bul" style="margin-top: 0.00em;">
If there are both a wildcard bind <span class="define">AF_INET</span> socket and a wildcard bind <span class="define">AF_INET6</span> socket on one TCP/UDP port, they should behave separately. IPv4 traffic should be routed to the <span class="define">AF_INET</span> socket and IPv6 should be routed to the <span class="define">AF_INET6</span> socket.</li>
</ul>
<p>
However, RFC 2553 does not define the ordering constraint between calls to <a class="link-man" href="../2/bind">bind(2)</a>, nor how IPv4 TCP/UDP port numbers and IPv6 TCP/UDP port numbers relate to each other (should they be integrated or separated). Implemented behavior is very different from kernel to kernel. Therefore, it is unwise to rely too much upon the behavior of <span class="define">AF_INET6</span> wildcard bind sockets. It is recommended to listen to two sockets, one for <span class="define">AF_INET</span> and another for <span class="define">AF_INET6</span>, when you would like to accept both IPv4 and IPv6 traffic.<p>
It should also be noted that malicious parties can take advantage of the complexity presented above, and are able to bypass access control, if the target node routes IPv4 traffic to <span class="define">AF_INET6</span> socket. Users are advised to take care handling connections from IPv4 mapped address to <span class="define">AF_INET6</span> sockets.</div>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../2/ioctl">ioctl(2)</a>, <a class="link-man" href="../2/socket">socket(2)</a>, <a class="link-man" href="../3/sysctl">sysctl(3)</a>, <a class="link-man" href="../4/icmp6">icmp6(4)</a>, <a class="link-man" href="../4/intro">intro(4)</a>, <a class="link-man" href="../4/ip6">ip6(4)</a>, <a class="link-man" href="../4/tcp">tcp(4)</a>, <a class="link-man" href="../4/udp">udp(4)</a><p>
<span class="ref"><span class="ref-auth">Qing Li</span>, <span class="ref-auth">Tatuya Jinmei</span>, and <span class="ref-auth">Keiichi Shima</span>, <i class="ref-book">IPv6 Core Protocols Implementation</i>, <i class="ref-issue">Morgan Kaufmann</i>, <span class="ref-date">2006</span>.</span><p>
<span class="ref"><span class="ref-auth">Qing Li</span>, <span class="ref-auth">Tatuya Jinmei</span>, and <span class="ref-auth">Keiichi Shima</span>, <i class="ref-book">IPv6 Advanced Protocols Implementation</i>, <i class="ref-issue">Morgan Kaufmann</i>, <span class="ref-date">2007</span>.</span></div>
<div class="section">
<h1 id="x5354414e4441524453">STANDARDS</h1> <span class="ref"><span class="ref-auth">Tatuya Jinmei</span> and <span class="ref-auth">Atsushi Onoe</span>, <span class="ref-title">An Extension of Format for IPv6 Scoped Addresses</span>, <span class="ref-rep">internet draft</span>, <span class="ref-num">draft-ietf-ipngwg-scopedaddr-format-02.txt</span>, <span class="ref-date">June 2000</span>, <span class="ref-opt">work in progress material</span>.</span></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="name">inet6</b> protocol interfaces are defined in RFC 2553 and RFC 2292. The implementation described herein appeared in the WIDE/KAME project.</div>
<div class="section">
<h1 id="x42554753">BUGS</h1> The IPv6 support is subject to change as the Internet protocols develop. Users should not depend on details of the current implementation, but rather the services exported.<p>
Users are suggested to implement &#8220;version independent&#8221; code as much as possible, as you will need to support both <a class="link-man" href="../4/inet">inet(4)</a> and <b class="name">inet6</b>.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
March 10, 2010</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

