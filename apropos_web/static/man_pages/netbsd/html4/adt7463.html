<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/../4/strict.dtd">
>
<head>
<meta http-equiv="Content-Type" content="te../; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
DBCOOL(4)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
DBCOOL(4)</td>
<td class="head-vol" align="center">
Kernel Interfaces Manual</td>
<td class="head-rtitle" align="right">
DBCOOL(4)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">dbcool</b>, <b class="name">adm1027</b>, <b class="name">adm1030</b>, <b class="name">adm1031</b>, <b class="name">adt7463</b>, <b class="name">adt7466</b>, <b class="name">adt7467</b>, <b class="name">adt7468</b>, <b class="name">adt7473</b>, <b class="name">adt7475</b>, <b class="name">adt7476</b>, <b class="name">adt7490</b>, <b class="name">emc6d103s</b> &#8212; <span class="desc">dbCool(tm) family of environmental monitors and fan controllers</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="config">dbcool* at ki2c?</b><br>
<b class="config">dbcool* at iic? addr 0x2e</b></div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="name">dbcool</b> driver provides support for the Analog Devices dbCool and the SMSC EMC6D103S environmental monitor chips to be used with the <a class="link-man" href="../4/envsys">envsys(4)</a> API.<p>
These chips support up to fifteen sensors. Not all of the following sensors are supported on all chips.<table style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-col">
<col style="width: 6.00ex;">
<col style="width: 5.00ex;">
<col style="min-width: 7.00ex;">
<tbody>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<span class="symb">Sensor</span></td>
<td class="list-col" style="margin-top: 1.00em;">
<span class="symb">Units</span></td>
<td class="list-col" style="margin-top: 1.00em;">
<span class="symb">Typical Use</span></td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">l_temp</code></td>
<td class="list-col" style="margin-top: 1.00em;">
uK</td>
<td class="list-col" style="margin-top: 1.00em;">
local chip temperature</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">r1_temp</code></td>
<td class="list-col" style="margin-top: 1.00em;">
uK</td>
<td class="list-col" style="margin-top: 1.00em;">
CPU temperature</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">r2_temp</code></td>
<td class="list-col" style="margin-top: 1.00em;">
uK</td>
<td class="list-col" style="margin-top: 1.00em;">
GPU temperature</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">Vccp</code></td>
<td class="list-col" style="margin-top: 1.00em;">
uV DC</td>
<td class="list-col" style="margin-top: 1.00em;">
CPU Vcore</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">Vcc</code></td>
<td class="list-col" style="margin-top: 1.00em;">
uV DC</td>
<td class="list-col" style="margin-top: 1.00em;">
Chip's supply voltage</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">2.5V</code></td>
<td class="list-col" style="margin-top: 1.00em;">
uV DC</td>
<td class="list-col" style="margin-top: 1.00em;">
2.5V supply</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">5V</code></td>
<td class="list-col" style="margin-top: 1.00em;">
uV DC</td>
<td class="list-col" style="margin-top: 1.00em;">
5V supply</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">12V</code></td>
<td class="list-col" style="margin-top: 1.00em;">
uV DC</td>
<td class="list-col" style="margin-top: 1.00em;">
12V supply</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">Vtt</code></td>
<td class="list-col" style="margin-top: 1.00em;">
uV DC</td>
<td class="list-col" style="margin-top: 1.00em;">
PECI ref. voltage (2.25V ref, ADT7490 only)</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">Imon</code></td>
<td class="list-col" style="margin-top: 1.00em;">
uV DC</td>
<td class="list-col" style="margin-top: 1.00em;">
Current monitor (2.25V ref, ADT7490 only)</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">AIN1</code></td>
<td class="list-col" style="margin-top: 1.00em;">
uV DC</td>
<td class="list-col" style="margin-top: 1.00em;">
Analog In (2.25V ref, ADT7466 only)</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">AIN2</code></td>
<td class="list-col" style="margin-top: 1.00em;">
uV DC</td>
<td class="list-col" style="margin-top: 1.00em;">
Analog In (2.25V ref, ADT7466 only)</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">fan1</code></td>
<td class="list-col" style="margin-top: 1.00em;">
RPM</td>
<td class="list-col" style="margin-top: 1.00em;">
Chassis Fan</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">fan2</code></td>
<td class="list-col" style="margin-top: 1.00em;">
RPM</td>
<td class="list-col" style="margin-top: 1.00em;">
Chassis Fan</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">fan3</code></td>
<td class="list-col" style="margin-top: 1.00em;">
RPM</td>
<td class="list-col" style="margin-top: 1.00em;">
Chassis Fan</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">fan4</code></td>
<td class="list-col" style="margin-top: 1.00em;">
RPM</td>
<td class="list-col" style="margin-top: 1.00em;">
Chassis Fan</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">VID</code></td>
<td class="list-col" style="margin-top: 1.00em;">
(none)</td>
<td class="list-col" style="margin-top: 1.00em;">
CPU VID code (selected chips only)</td>
</tr>
</tbody>
</table>
<p>
Each temperature and voltage sensor has programmable hardware high- and low-limits; fan sensors have only a low-limit. These limits can be set using the <a class="link-man" href="../8/envstat">envstat(8)</a> utility. Due to hardware limitations, the minimum permissible value for the fan speed low-limits is 83 RPM.<p>
Temperature sensors also have <span class="emph">Tmin</span>, <span class="emph">Trange</span>, <span class="emph">Thyst</span>, and <span class="emph">Ttherm</span> <a class="link-man" href="../8/sysctl">sysctl(8)</a> variables; these values are used by the fan speed controllers. Their values are in units of degC, since this is the unit which is programmed into the device registers.<p>
All members of the dbCool family support Pulse-Width Modulated (PWM) fan speed control based on temperature thresholds - the fan will spin up when its associated thermal sensor(s) exceeds its configured <span class="emph">Tmin</span> value. The fan will go faster as the temperature rises, and will slow down as the temperature falls. If the temperature exceeds the sensor's <span class="emph">Ttherm</span> value, the THERM signal will be asserted, and if enabled the fan will run at full speed. The fan will be turned off when the sensor(s) that triggered it reports a temperature which is at least <span class="emph">Thyst</span> degrees below its <span class="emph">Tmin</span> threshold.<p>
Each fan controller is programmable using the following <a class="link-man" href="../8/sysctl">sysctl(8)</a> variables.<p>
<pre style="margin-left: 5.00ex;" class="lit display">
hw.dbcool0.fan_ctl_0.behavior 
hw.dbcool0.fan_ctl_0.min_duty 
hw.dbcool0.fan_ctl_0.max_duty 
hw.dbcool0.fan_ctl_0.cur_duty</pre>
<p>
The <span class="emph">behavior</span> variable controls the selection of temperature sensors associated with the fan controller. When the associated temperature sensor reaches its <span class="emph">Tmin</span> value, the fan controller starts the fan at its minimum duty cycle; when the associated temperature sensor reaches its <span class="emph">Ttherm</span> value and asserts the THERM signal (or if an external THERM signal is asserted), the fan controller sets the fan speed to a 100% duty cycle. Between these two settings, each temperature sensor is used to calculate a duty cycle linearly based on the slope defined by the temperature sensor's <span class="emph">range</span> variable. When the associated temperature falls at least <span class="emph">Thyst</span> degress below its <span class="emph">Tmin</span> value, the fan controller will turn off the fan. (On the ADM1030, the value for <span class="emph">Thyst</span> is fixed at 5 degC.)<p>
Valid values for the <span class="emph">behavior</span> variable are:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
local           (not available on ADM1030) 
remote1 
remote2         (not available on ADM1030) 
local+remote2   (not available on ADM1030) 
all-temps 
full-speed      (not available on ADM1030) 
manual 
disabled</pre>
<p>
When the <span class="emph">behavior</span> variable is set to &#8220;manual&#8221;, the <span class="emph">cur-duty</span> variable becomes user-writable and can be set to any value between 0 and 100 inclusive to control the fan's duty cycle manually. In all other <span class="emph">behavior</span> modes, the <span class="emph">cur-duty</span> variable is read-only and updates are ignored.<p>
The <span class="emph">min-duty</span> and <span class="emph">max-duty</span> variables define the range over which the fan controller will manage the fan's duty cycle. On the ADM1030, these values are not separately controllable. The <span class="emph">max-duty</span> is fixed at 100%, and the <span class="emph">cur-duty</span> variable is used to specify the minimum duty cycle when the fan controller is running in automatic mode.<p>
Note that the duty-cycle value does not directly correspond to the fan's speed. That is, a 33% duty cycle does not mean that the fan runs at 33% of its maximum speed; in actuality, a 33% duty cycle drives the fan at a speed close to 50% of its maximum. Fan speed correlates approximately to the square root of the duty cycle.</div>
<div class="section">
<h1 id="x4558414d504c4553">EXAMPLES</h1> The <a class="link-man" href="../8/envstat">envstat(8)</a> utility can be used to determine the sensors supported:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
            Current  CritMax  WarnMax  WarnMin  CritMin Unit 
 l_temp:     44.250                                     degC 
r1_temp:     41.250                                     degC 
r2_temp:        N/A 
   Vccp:      0.002                                     V 
    Vcc:      3.351                                     V 
   fan1:        N/A 
   fan2:        N/A 
   fan3:        N/A 
   fan4:        N/A</pre>
<p>
Using this information, the following commands in <i class="file">/etc/envsys.conf</i> will set appropriate limits for CPU temperature and chip supply voltage, and powerd will be notified if the limits are exceeded:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
dbcool0 { 
        sensor1 { 
                warning-max  = 60C; 
                critical-max = 65C; 
        } 
        sensor4 { 
                critical-min = 3.1; 
                warning-min =  3.2; 
                critical-max = 3.5; 
        } 
}</pre>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../4/envsys">envsys(4)</a>, <a class="link-man" href="../4/iic">iic(4)</a>, <a class="link-man" href="../8/envstat">envstat(8)</a>, <a class="link-man" href="../8/powerd">powerd(8)</a>, <a class="link-man" href="../8/sysctl">sysctl(8)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="name">dbcool</b> device appeared in <span class="unix">NetBSD&#160;5.0</span>.</div>
<div class="section">
<h1 id="x42554753">BUGS</h1> Although the sensor limit registers can be programmed, there is currently no use of the dbCool chips' ability to generate an SMBus interrupt when the limits are exceeded. Limit checking and event generation are done in software, and are performed only when the sensor values are polled and refreshed.<p>
The ADT7466 chip, although officially a member of the dbCool family, is programmed quite differently. The fan controllers on this chip are not currently implemented.<p>
The PECI (Processor Environment Control Interface) temperature sensors and the associated PWM behavior modes on the ADT7490 are not currently supported.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
March 12, 2011</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
<>

