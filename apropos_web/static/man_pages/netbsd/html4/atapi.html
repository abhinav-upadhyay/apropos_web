<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
SCSI(4)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
SCSI(4)</td>
<td class="head-vol" align="center">
Kernel Interfaces Manual</td>
<td class="head-rtitle" align="right">
SCSI(4)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">scsi</b>, <b class="name">scsibus</b> &#8212; <span class="desc">Small Computer Systems Interface (SCSI) bus driver</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="config">scsibus* at scsi?</b><br>
<b class="config">atapibus* at atapi?</b><br>
<b class="config">options SCSIDEBUG</b><br>
<b class="config">options SCSIVERBOSE</b></div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="name">scsi</b> driver is the top, machine-independent layer of the two-layer software system that provides an interface for the implementation of drivers to control various SCSI or ATAPI bus devices, and to use different SCSI bus host adapters or EIDE controllers. SCSI bus is capable of supporting a wide variety of peripherals, including hard disks, removable disks, CD-ROMs, scanners, tape drives, and other miscellaneous high-speed devices.<p>
The bottom layer is composed of the drivers for individual EIDE or SCSI bus controller chips (e.g. NCR 5380), accessed through various host bus interfaces, including, but not limited to PCI, ISA, Sbus, TURBOchannel, and NuBus. These individual devices are referred to as &#8220;host adaptors&#8221; in SCSI terminology, because they connect the SCSI bus to the host computer.<p>
When <span class="unix">NetBSD</span> probes the SCSI busses, it &#8220;attaches&#8221; any devices it finds to the appropriate drivers.<p>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<a class="link-man" href="../html4/sd.html">sd(4)</a></dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
hard disks</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<a class="link-man" href="../html4/cd.html">cd(4)</a></dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
CD-ROM drives</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<a class="link-man" href="../html4/st.html">st(4)</a></dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
tape drives</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<a class="link-man" href="../html4/ch.html">ch(4)</a></dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
media changers</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<a class="link-man" href="../html4/ss.html">ss(4)</a></dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
scanners</dd>
</dl>
<p>
If no specific driver matches the device, then <b class="name">scsi</b> attaches the device to the <a class="link-man" href="../html4/uk.html">uk(4)</a> driver so that user level SCSI <a class="link-man" href="../html2/ioctl.html">ioctl(2)</a> calls may still be performed against the device. Currently, only <a class="link-man" href="../html4/sd.html">sd(4)</a>, <a class="link-man" href="../html4/cd.html">cd(4)</a>, <a class="link-man" href="../html4/st.html">st(4)</a>, and <a class="link-man" href="../html4/uk.html">uk(4)</a> can attach to an atapi bus.<p>
Please see the <a class="link-man" href="../html4/intro.html">intro(4)</a> manual page to see which SCSI bus host adaptors are supported by <span class="unix">NetBSD</span> on your computer system.</div>
<div class="section">
<h1 id="x4b45524e454c20434f4e46494755524154494f4e">KERNEL CONFIGURATION</h1> The <b class="name">scsi</b> software supports some <span class="unix">NetBSD</span> kernel <a class="link-man" href="../html1/config.html">config(1)</a> options. They are:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">SCSIDEBUG</span></dt>
<dd class="list-tag" style="margin-left: 11.00ex;">
Compile in a wide variety of <b class="fname">printf</b>() statements that can be turned on by <a class="link-man" href="../html2/ioctl.html">ioctl(2)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">SCSIVERBOSE</span></dt>
<dd class="list-tag" style="margin-left: 11.00ex;">
Enable additional and more descriptive error and status messages from the <b class="name">scsi</b> software.</dd>
</dl>
<p>
All devices and the SCSI busses support boot time allocation so that an upper number of devices and controllers does not need to be configured.<p>
The devices are either <span class="emph">wired</span> so they appear at a particular device unit number or <span class="emph">counted</span> so that they appear as the next available unused unit number.<p>
To configure a driver in the kernel without wiring down the device use a config line similar to<p>
<b class="config">ch* at scsibus? target ? lun ?</b><p>
to include the <a class="link-man" href="../html4/ch.html">ch(4)</a> changer driver.<p>
To wire down a unit use a config line similar to<p>
<b class="config">ch1 at scsibus0 target 4 lun 0</b><p>
to assign changer 1 as the changer with SCSI ID 4, logical unit 0, on bus 0. Individual SCSI busses can be wired down to specific controllers with a config line similar to<p>
<b class="config">scsibus0 at ahc0</b><p>
which assigns SCSI bus 0 to the first unit using the <a class="link-man" href="../html4/ahc.html">ahc(4)</a> driver.<p>
When you have a mixture of wired down and counted devices then the counting begins with the first non-wired down unit for a particular type. That is, if you have a disk wired down as<p>
<b class="config">sd1 at scsibus0 target 1 lun 0</b><p>
then the first non-wired disk shall come on line as <span class="emph">sd2</span>.</div>
<div class="section">
<h1 id="x494f43544c53">IOCTLS</h1> There are a number of <a class="link-man" href="../html2/ioctl.html">ioctl(2)</a> calls that work on any SCSI device. They are defined in <i class="file">sys/scsiio.h</i> and can be applied against any SCSI device that permits them. For the tape, it must be applied against the control device. See the manual page for each device type for more information about how generic SCSI <a class="link-man" href="../html2/ioctl.html">ioctl(2)</a> calls may be applied to a specific device.<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">SCIOCRESET</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Reset a SCSI device.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">SCIOCDEBUG</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Turn on debugging. All SCSI operations originating from this device's driver will be traced to the console, along with other information. Debugging is controlled by four bits, described in the header file. If no debugging is configured into the kernel, debugging will have no effect. SCSI debugging is controlled by the configuration option <span class="define">SCSIDEBUG</span>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">SCIOCCOMMAND</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Take a SCSI command and data from a user process and apply them to the SCSI device. Return all status information and return data to the process. The <a class="link-man" href="../html2/ioctl.html">ioctl(2)</a> call will return a successful status even if the device rejected the command. As all status is returned to the user, it is up to the user process to examine this information to decide the success of the command.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">SCIOCREPROBE</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Ask the system to probe the SCSI busses for any new devices. If it finds any, they will be attached to the appropriate drivers. The search can be narrowed to a specific bus, target or Logical Unit Number (LUN). The new device may or may not be related to the device on which the ioctl was performed.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">SCIOCIDENTIFY</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Ask the driver what its bus, target and LUN are.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">SCIOCDECONFIG</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Ask the device to disappear. This may not happen if the device is in use.</dd>
</dl>
</div>
<div class="section">
<h1 id="x4144415054455253">ADAPTERS</h1> The system allows common device drivers to work through many different types of adapters. The adapters take requests from the upper layers and do all IO between the SCSI bus and the system. The maximum size of a transfer is governed by the adapter. Most adapters can transfer 64KB in a single operation, however many can transfer larger amounts.</div>
<div class="section">
<h1 id="x544152474554204d4f4445">TARGET MODE</h1> Some adapters support <span class="emph">Target Mode</span> in which the system is capable of operating as a device, responding to operations initiated by another system. Target Mode will be supported for some host adapters, but is not yet complete for this version of the SCSI system.</div>
<div class="section">
<h1 id="x444941474e4f5354494353">DIAGNOSTICS</h1> When the kernel is compiled with option <span class="define">SCSIDEBUG</span>, the <span class="define">SCIOCDEBUG</span> <a class="link-man" href="../html2/ioctl.html">ioctl(2)</a> can be used to enable various amounts of tracing information on any specific device. Devices not being traced will not produce trace information. The four bits that make up the debug level, each control certain types of debugging information.<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">Bit 0</span></dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
shows all SCSI bus operations including SCSI commands, error information and the first 48 bytes of any data transferred.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">Bit 1</span></dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
shows routines called.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">Bit 2</span></dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
shows information about what branches are taken and often some of the return values of functions.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">Bit 3</span></dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
shows more detailed information including DMA scatter-gather logs.</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html1/config.html">config(1)</a>, <a class="link-man" href="../html2/ioctl.html">ioctl(2)</a>, <a class="link-man" href="../html4/ata.html">ata(4)</a>, <a class="link-man" href="../html4/cd.html">cd(4)</a>, <a class="link-man" href="../html4/ch.html">ch(4)</a>, <a class="link-man" href="../html4/intro.html">intro(4)</a>, <a class="link-man" href="../html4/sd.html">sd(4)</a>, <a class="link-man" href="../html4/se.html">se(4)</a>, <a class="link-man" href="../html4/ss.html">ss(4)</a>, <a class="link-man" href="../html4/st.html">st(4)</a>, <a class="link-man" href="../html4/uk.html">uk(4)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> This <b class="name">scsi</b> system appeared in MACH 2.5 at TRW.<p>
This man page was originally written by Julian Elischer &#60;julian@freebsd.org&#62; for <span class="unix">FreeBSD</span> and extensively modified by <span class="author">Erik Fair</span> &#60;fair@NetBSD.org&#62; for <span class="unix">NetBSD</span>.</div>
<div class="section">
<h1 id="x42554753">BUGS</h1> Not every device obeys the SCSI specification as faithfully as it should. As such devices are discovered by the <span class="unix">NetBSD</span> Project, their names are added to a <span class="emph">quirk list</span> compiled into the <b class="name">scsi</b> driver along a list of flags indicating which particular bad behaviors the device exhibits (and that the driver should be prepared to work around).</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
July 26, 2006</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

