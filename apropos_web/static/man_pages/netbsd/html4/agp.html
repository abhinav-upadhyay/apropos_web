<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
AGP(4)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
AGP(4)</td>
<td class="head-vol" align="center">
Kernel Interfaces Manual</td>
<td class="head-rtitle" align="right">
AGP(4)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">agp</b> &#8212; <span class="desc">accelerated graphics port driver</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="config">agp* at pchb?</b></div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="name">agp</b> driver provides machine-independent support for the accelerated graphics port (AGP) found on many PC-based and PCI systems. The AGP specification was designed by Intel.<p>
The AGP chipset is positioned between the PCI-Host bridge and the graphics accelerator to provide a high-performance dedicated graphics bus for moving large amounts of data directly from host memory to the graphics accelerator. The specification currently supports a peak bandwidth of 528 MB/s. AGP uses a Graphics Address Remapping Table (GART) to provide a physically-contiguous view of scattered pages in host memory for DMA transfers.<p>
The <b class="name">agp</b> driver supports the following chipsets:<p>
<ul style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-dash">
<li class="list-dash" style="margin-top: 0.00em;">
ALI M1541 host-to-AGP bridge</li>
<li class="list-dash" style="margin-top: 0.00em;">
AMD 751 and 761 host-to-AGP bridges</li>
<li class="list-dash" style="margin-top: 0.00em;">
Intel 82810, 82810-DC100, 82810E, and 82815 SVGA controllers</li>
<li class="list-dash" style="margin-top: 0.00em;">
SiS 5591 host-to-AGP bridge</li>
<li class="list-dash" style="margin-top: 0.00em;">
VIA</li>
</ul>
<p>
The <b class="name">agp</b> driver also provides an interface to user processes for use by X servers. A user process communicates to the device initially by means of <a class="link-man" href="../html2/ioctl.html">ioctl(2)</a> calls. The calls supported are:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">AGPIOC_INFO</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Get AGP information, setting the members in the <span class="emph">agp_info</span> structure as defined in &lt;sys/agpio.h&gt;:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
typedef struct _agp_info { 
        agp_version version;    /* version of the driver        */ 
        uint32_t bridge_id;     /* bridge vendor/device         */ 
        uint32_t agp_mode;      /* mode info of bridge          */ 
        off_t aper_base;        /* base of aperture             */ 
        size_t aper_size;       /* size of aperture             */ 
        size_t pg_total;        /* max pages (swap + system)    */ 
        size_t pg_system;       /* max pages (system)           */ 
        size_t pg_used;         /* current pages used           */ 
} agp_info;</pre>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">AGPIOC_ACQUIRE</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Acquire AGP.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">AGPIOC_RELEASE</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Release AGP.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">AGPIOC_SETUP</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Set up AGP, using the members in the <span class="emph">agp_setup</span> structure as defined in &lt;sys/agpio.h&gt;:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
typedef struct _agp_setup { 
        uint32_t agp_mode;      /* mode info of bridge          */ 
} agp_setup;</pre>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">AGPIOC_ALLOCATE</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Allocate AGP space, using and setting the members in the <span class="emph">agp_allocate</span> structure as defined in &lt;sys/agpio.h&gt;:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
typedef struct _agp_allocate { 
        int key;                /* tag of allocation            */ 
        size_t pg_count;        /* number of pages              */ 
        uint32_t type;          /* 0 == normal, other devspec   */ 
        uint32_t physical;      /* device specific (some devices 
                                 * need a phys address of the 
                                 * actual page behind the gatt 
                                 * table)                       */ 
} agp_allocate;</pre>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">AGPIOC_DEALLOCATE</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Deallocate AGP space.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">AGPIOC_BIND</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Bind AGP space, using the members in the <span class="emph">agp_bind</span> structure as defined in &lt;sys/agpio.h&gt;:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
typedef struct _agp_bind { 
        int key;                /* tag of allocation            */ 
        off_t pg_start;         /* starting page to populate    */ 
} agp_bind;</pre>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">AGPIOC_UNBIND</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Unbind AGP space, using the members in the <span class="emph">agp_unbind</span> structure as defined in &lt;sys/agpio.h&gt;:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
typedef struct _agp_unbind { 
        int key;                /* tag of allocation            */ 
        uint32_t priority;      /* priority for paging out      */ 
} agp_unbind;</pre>
</dd>
</dl>
</div>
<div class="section">
<h1 id="x46494c4553">FILES</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/dev/agp?</i></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
AGP GART device special files</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/dev/agpgart</i></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
AGP GART device special file</dd>
</dl>
</div>
<div class="section">
<h1 id="x4558414d504c4553">EXAMPLES</h1> This short code fragment is an example of opening the AGP device and performing some basic operations:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
#include &lt;sys/types.h&gt; 
#include &lt;sys/ioctl.h&gt; 
#include &lt;sys/agpio.h&gt; 
#include &lt;fcntl.h&gt; 
#include &lt;err.h&gt; 
 
int 
main(int argc, char **argv) 
{ 
	int fd; 
	agp_info info; 
	agp_allocate alloc; 
	agp_setup setup; 
	agp_bind bind; 
	agp_unbind unbind; 
 
	fd = open("/dev/agp0", O_RDWR); 
	if (fd &lt; 0) 
		err(1, "open"); 
 
	if (ioctl(fd, AGPIOC_INFO, &amp;info) &lt; 0) 
		err(2, "ioctl AGPIOC_INFO"); 
 
	printf("version:	%u.%u\n", info.version.major, 
	    info.version.minor); 
 
	printf("id:		%x\n", info.bridge_id); 
	printf("mode:		%x\n", info.agp_mode); 
	printf("base:		%x\n", info.aper_base); 
	printf("size:		%uM\n", info.aper_size); 
	printf("total mem:	%u\n", info.pg_total); 
	printf("system mem:	%u\n", info.pg_system); 
	printf("used mem:	%u\n\n", info.pg_used); 
 
	setup.agp_mode = info.agp_mode; 
 
	if (ioctl(fd, AGPIOC_SETUP, &amp;setup) &lt; 0) 
		err(3, "ioctl AGPIOC_SETUP"); 
 
	if (ioctl(fd, AGPIOC_ACQUIRE, 0) &lt; 0) 
		err(3, "ioctl AGPIOC_ACQUIRE"); 
 
	alloc.type = 0; 
	alloc.pg_count = 64; 
 
	if (ioctl(fd, AGPIOC_ALLOCATE, &amp;alloc) &lt; 0) 
		err(4, "ioctl AGPIOC_ALLOCATE"); 
 
	printf("alloc key %d, paddr %x\n", alloc.key, alloc.physical); 
	if (ioctl(fd, AGPIOC_INFO, &amp;info) &lt; 0) 
		err(5, "ioctl AGPIOC_INFO"); 
 
	bind.key = alloc.key; 
	bind.pg_start = 0x1000; 
 
	if (ioctl(fd, AGPIOC_BIND, &amp;bind) &lt; 0) 
		err(6, "ioctl AGPIOC_BIND"); 
 
	printf("used mem now:	%u\n\n", info.pg_used); 
 
	unbind.key = alloc.key; 
	unbind.priority = 0; 
 
	if (ioctl(fd, AGPIOC_UNBIND, &amp;unbind) &lt; 0) 
		err(6, "ioctl AGPIOC_BIND"); 
 
	if (ioctl(fd, AGPIOC_DEALLOCATE, &amp;alloc.key) &lt; 0) 
		err(6, "ioctl AGPIOC_DEALLOCATE"); 
 
	if (ioctl(fd, AGPIOC_RELEASE, 0) &lt; 0) 
		err(7, "ioctl AGPIOC_RELEASE"); 
 
	close(fd); 
 
	printf("agp test successful\n"); 
 
	return 0; 
}</pre>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html2/ioctl.html">ioctl(2)</a>, <a class="link-man" href="../html4/pci.html">pci(4)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="name">agp</b> driver first appeared in <span class="unix">FreeBSD&#160;4.1</span>. It was adopted in <span class="unix">NetBSD&#160;1.6</span>.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
October 3, 2010</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

