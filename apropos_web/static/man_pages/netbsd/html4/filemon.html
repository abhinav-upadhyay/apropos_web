<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
FILEMON(4)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
FILEMON(4)</td>
<td class="head-vol" align="center">
Kernel Interfaces Manual</td>
<td class="head-rtitle" align="right">
FILEMON(4)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">filemon</b> &#8212; <span class="desc">track interesting system calls</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">filemon.h</a>&gt;</b></div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> <b class="name">filemon</b> provides a means for tracking the successful system calls performed by a process. It is used by <a class="link-man" href="../html1/make.html">make(1)</a> to track the activities of build scripts, for the purpose of automatically learning dependencies.<p>
The data captured by <b class="name">filemon</b> for the script<p>
<pre style="margin-left: 5.00ex;" class="lit display">
n=`wc -l /etc/motd`; echo "int motd_lines = $n;" &gt; foo.h.new 
cmp -s foo.h foo.h.new 2&gt; /dev/null || mv foo.h.new foo.h</pre>
<p>
looks like:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
# filemon version 4 
# Target pid 24291 
V 4 
E 29676 /bin/sh 
R 29676 /etc/ld.so.conf 
R 29676 /lib/libedit.so.2 
R 29676 /lib/libterminfo.so.1 
R 29676 /lib/libc.so.12 
F 29676 4899 
E 4899 /usr/bin/wc 
R 4899 /etc/ld.so.conf 
R 4899 /usr/lib/libc.so.12 
R 4899 /etc/motd 
X 4899 0 
W 29676 foo.h.new 
X 29676 0 
# Bye bye 
E 3250 /bin/sh 
R 3250 /etc/ld.so.conf 
R 3250 /lib/libedit.so.2 
R 3250 /lib/libterminfo.so.1 
R 3250 /lib/libc.so.12 
W 26673 /dev/null 
E 26673 /usr/bin/cmp 
R 26673 /etc/ld.so.conf 
R 26673 /usr/lib/libc.so.12 
X 26673 2 
E 576 /bin/mv 
R 576 /etc/ld.so.conf 
R 576 /lib/libc.so.12 
M 576 'foo.h.new' 'foo.h' 
X 576 0 
X 3250 0 
# Bye bye</pre>
<p>
Most records follow the format:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
type pid data</pre>
<p>
where <i class="arg">type</i> is one of the list below, and unless otherwise specified, <i class="arg">data</i> is a pathname.<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">C</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
<a class="link-man" href="../html2/chdir.html">chdir(2)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">D</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
<a class="link-man" href="../html2/unlink.html">unlink(2)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">E</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
<a class="link-man" href="../html3/exec.html">exec(3)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">F</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
<a class="link-man" href="../html2/fork.html">fork(2)</a>, <a class="link-man" href="../html2/vfork.html">vfork(2)</a>; <i class="arg">data</i> is the process id of the child.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">L</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
<a class="link-man" href="../html2/link.html">link(2)</a>, <a class="link-man" href="../html2/symlink.html">symlink(2)</a>; <i class="arg">data</i> is two pathnames.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">M</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
<a class="link-man" href="../html2/rename.html">rename(2)</a>; <i class="arg">data</i> is two pathnames.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">R</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
<a class="link-man" href="../html2/open.html">open(2)</a> for read or read-write.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">W</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
<a class="link-man" href="../html2/open.html">open(2)</a> for writing or read-write.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">X</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
<a class="link-man" href="../html3/exit.html">exit(3)</a>; <i class="arg">data</i> is the exit status.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">V</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
indicates the version of <b class="name">filemon</b>.</dd>
</dl>
</div>
<div class="section">
<h1 id="x46494c4553">FILES</h1><pre style="margin-left: 0.00ex;" class="lit display">
/dev/filemon</pre>
</div>
<div class="section">
<h1 id="x4558414d504c4553">EXAMPLES</h1> The following example demonstrates the basic usage of <b class="name">filemon</b>:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
#include &lt;filemon.h&gt; 
 
pid_d pid; 
int fd, tfd; 
int status; 
 
filemon_fd = open("/dev/filemon", O_RDWR); 
temp_fd = mkstemp("/tmp/filemon.XXXXXXX"); 
/* give filemon the temp file to use */ 
ioctl(filemon_fd, FILEMON_SET_FD, &amp;temp_fd); 
/* children do not need these once they exec */ 
fcntl(filemon_fd, F_SETFD, 1); 
fcntl(temp_fd, F_SETFD, 1); 
 
pid = fork(); 
switch(pid) { 
 case -1: 
     err(1, "cannot fork"); 
     break; 
 case 0: 
     pid = getpid(); 
     /* tell filemon to monitor this process */ 
     ioctl(filemon_fd, FILEMON_SET_PID, &amp;pid); 
     execvp(...); 
     _exit(1); 
     break; 
 default: 
     status = wait(); 
     close(filemon_fd); 
     lseek(temp_fd, SEEK_SET, 0); 
     /* read the captured syscalls from temp_fd */ 
     close(temp_fd); 
     break; 
}</pre>
<p>
The output of <b class="name">filemon</b> is intended to be simple to parse. It is possible to achieve almost equivalent results with <a class="link-man" href="../html1/dtrace.html">dtrace(1)</a> though on many systems this requires elevated privileges. Also, <a class="link-man" href="../html1/ktrace.html">ktrace(1)</a> can capture similar data, but records failed system calls as well as successful, and is thus more complex to post-process.</div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> <b class="name">filemon</b> was contributed by Juniper Networks.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
April 5, 2012</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

