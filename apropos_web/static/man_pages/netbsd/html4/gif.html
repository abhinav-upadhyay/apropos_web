<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
GIF(4)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
GIF(4)</td>
<td class="head-vol" align="center">
Kernel Interfaces Manual</td>
<td class="head-rtitle" align="right">
GIF(4)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">gif</b> &#8212; <span class="desc">generic tunnel interface</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="config">pseudo-device gif</b></div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="name">gif</b> interface is a generic tunneling pseudo device for IPv4 and IPv6. It can tunnel IPv[46] traffic over IPv[46]. Therefore, there can be four possible configurations. The behavior of <b class="name">gif</b> is mainly based on RFC 2893 IPv6-over-IPv4 configured tunnel. <b class="name">gif</b> can also tunnel ISO traffic over IPv[46] using EON encapsulation.<p>
To use <b class="name">gif</b>, the administrator must first create the interface and then configure protocol and addresses used for the outer header. This can be done by using <a class="link-man" href="../8/ifconfig">ifconfig(8)</a> <b class="flag">create</b> and <b class="flag">tunnel</b> subcommands, or <span class="define">SIOCIFCREATE</span> and <span class="define">SIOCSIFPHYADDR</span> ioctls. Also, administrator needs to configure protocol and addresses used for the inner header, by using <a class="link-man" href="../8/ifconfig">ifconfig(8)</a>. Note that IPv6 link-local address (those start with <code class="lit">fe80::</code>) will be automatically configured whenever possible. You may need to remove IPv6 link-local address manually using <a class="link-man" href="../8/ifconfig">ifconfig(8)</a>, when you would like to disable the use of IPv6 as inner header (like when you need pure IPv4-over-IPv6 tunnel). Finally, use routing table to route the packets toward <b class="name">gif</b> interface.<p>
<b class="name">gif</b> can be configured to be ECN friendly. This can be configured by <span class="define">IFF_LINK1</span>.<div class="subsection">
<h2 id="x45434e20667269656e646c79206265686176696f72">ECN friendly behavior</h2> <b class="name">gif</b> can be configured to be ECN friendly, as described in <span class="define">draft-ietf-ipsec-ecn-02.txt</span>. This is turned off by default, and can be turned on by <span class="define">IFF_LINK1</span> interface flag.<p>
Without <span class="define">IFF_LINK1</span>, <b class="name">gif</b> will show a normal behavior, like described in RFC 2893. This can be summarized as follows:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
Ingress</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Set outer TOS bit to <span class="define">0</span>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
Egress</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Drop outer TOS bit.</dd>
</dl>
<p>
With <span class="define">IFF_LINK1</span>, <b class="name">gif</b> will copy ECN bits (<span class="define">0x02</span> and <span class="define">0x01</span> on IPv4 TOS byte or IPv6 traffic class byte) on egress and ingress, as follows:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
Ingress</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Copy TOS bits except for ECN CE (masked with <span class="define">0xfe</span>) from inner to outer. set ECN CE bit to <span class="define">0</span>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
Egress</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Use inner TOS bits with some change. If outer ECN CE bit is <span class="define">1</span>, enable ECN CE bit on the inner.</dd>
</dl>
<p>
Note that the ECN friendly behavior violates RFC 2893. This should be used in mutual agreement with the peer.</div>
<div class="subsection">
<h2 id="x5061636b657420666f726d6174">Packet format</h2> Every inner packet is encapsulated in an outer packet. The inner packet may be IPv4, IPv6, or ISO CLNP. The outer packet may be IPv4 or IPv6, and has all the usual IP headers, including a protocol field that identifies the type of inner packet.<p>
When the inner packet is IPv4, the protocol field of the outer packet is 4 (<span class="define">IPPROTO_IPV4</span>). When the inner packet is IPv6, the protocol field of the outer packet is 41 (<span class="define">IPPROTO_IPV6</span>). When the inner packet is ISO CNLP, the protocol field of the outer packet is 80 (<span class="define">IPPROTO_EON</span>).</div>
<div class="subsection">
<h2 id="x5365637572697479">Security</h2> Malicious party may try to circumvent security filters by using tunneled packets. For better protection, <b class="name">gif</b> performs martian filter and ingress filter against outer source address, on egress. Note that martian/ingress filters are no way complete. You may want to secure your node by using packet filters. Ingress filter can be turned off by <span class="define">IFF_LINK2</span> bit.</div>
</div>
<div class="section">
<h1 id="x4558414d504c4553">EXAMPLES</h1> Configuration example:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
Host X--NetBSD A  ----------------tunnel---------- cisco D------Host E 
           \                                          | 
            \                                        / 
             +-----Router B--------Router C---------+ 
</pre>
On <span class="unix">NetBSD</span> system A (<span class="unix">NetBSD</span>):<p>
<pre style="margin-left: 0.00ex;" class="lit display">
   # route add default B 
   # ifconfig gifN create 
   # ifconfig gifN A netmask 0xffffffff tunnel A D up 
   # route add E 0 
   # route change E -ifp gif0</pre>
<p>
On Host D (Cisco):<p>
<pre style="margin-left: 0.00ex;" class="lit display">
   Interface TunnelX 
    ip unnumbered D   ! e.g. address from Ethernet interface 
    tunnel source D   ! e.g. address from Ethernet interface 
    tunnel destination A 
   ip route C &lt;some interface and mask&gt; 
   ip route A mask C 
   ip route X mask tunnelX</pre>
<p>
or on Host D (<span class="unix">NetBSD</span>):<p>
<pre style="margin-left: 0.00ex;" class="lit display">
   # route add default C 
   # ifconfig gifN D A</pre>
<p>
If all goes well, you should see packets flowing.<p>
If you want to reach Host A over the tunnel (from the Cisco D), then you have to have an alias on Host A for e.g. the Ethernet interface like: <b class="cmd">ifconfig</b> <i class="arg">&lt;etherif&gt; alias Y</i> and on the cisco <b class="cmd">ip</b> <i class="arg">route Y mask tunnelX</i>.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../4/etherip">etherip(4)</a>, <a class="link-man" href="../4/inet">inet(4)</a>, <a class="link-man" href="../4/inet6">inet6(4)</a>, <a class="link-man" href="../8/ifconfig">ifconfig(8)</a><p>
<span class="ref"><span class="ref-auth">C. Perkins</span>, <span class="ref-title">IP Encapsulation within IP</span>, <i class="ref-book">RFC 2003</i>, <a class="link-ref" href="ftp://ftp.isi.edu/in-notes/rfc2003.txt">ftp://ftp.isi.edu/in-notes/rfc2003.txt</a>, <span class="ref-date">October 1996</span>.</span><p>
<span class="ref"><span class="ref-auth">R. Gilligan</span> and <span class="ref-auth">E. Nordmark</span>, <span class="ref-title">Transition Mechanisms for IPv6 Hosts and Routers</span>, <i class="ref-book">RFC 2893</i>, <a class="link-ref" href="ftp://ftp.isi.edu/in-notes/rfc2893.txt">ftp://ftp.isi.edu/in-notes/rfc2893.txt</a>, <span class="ref-date">August 2000</span>.</span><p>
<span class="ref"><span class="ref-auth">Sally Floyd</span>, <span class="ref-auth">David L. Black</span>, and <span class="ref-auth">K. K. Ramakrishnan</span>, <span class="ref-title">IPsec Interactions with ECN</span>, <a class="link-ref" href="http://datatracker.ietf.org/internet-drafts/draft-ietf-ipsec-ecn/">http://datatracker.ietf.org/internet-drafts/draft-ietf-ipsec-ecn/</a>, <span class="ref-date">December 1999</span>.</span><p>
<span class="ref"><span class="ref-auth">F. Baker</span> and <span class="ref-auth">P. Savola</span>, <span class="ref-title">Ingress Filtering for Multihomed Networks</span>, <i class="ref-book">RFC 3704</i>, <a class="link-ref" href="ftp://ftp.isi.edu/in-notes/rfc3704.txt">ftp://ftp.isi.edu/in-notes/rfc3704.txt</a>, <span class="ref-date">March 2004</span>.</span></div>
<div class="section">
<h1 id="x5354414e4441524453">STANDARDS</h1> IPv4 over IPv4 encapsulation is compatible with RFC 2003. IPv6 over IPv4 encapsulation is compatible with RFC 2893.</div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="name">gif</b> device first appeared in WIDE hydrangea IPv6 kit.</div>
<div class="section">
<h1 id="x42554753">BUGS</h1> There are many tunneling protocol specifications, defined differently from each other. <b class="name">gif</b> may not interoperate with peers which are based on different specifications, and are picky about outer header fields. For example, you cannot usually use <b class="name">gif</b> to talk with IPsec devices that use IPsec tunnel mode.<p>
The current code does not check if the ingress address (outer source address) configured to <b class="name">gif</b> makes sense. Make sure to configure an address which belongs to your node. Otherwise, your node will not be able to receive packets from the peer, and your node will generate packets with a spoofed source address.<p>
If the outer protocol is IPv6, path MTU discovery for encapsulated packet may affect communication over the interface.<p>
In the past, <b class="name">gif</b> had a multi-destination behavior, configurable via <span class="define">IFF_LINK0</span> flag. The behavior was obsoleted and is no longer supported.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
January 15, 2009</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

