<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
AHC(4)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
AHC(4)</td>
<td class="head-vol" align="center">
Kernel Interfaces Manual</td>
<td class="head-rtitle" align="right">
AHC(4)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">ahc</b> &#8212; <span class="desc">Adaptec VL/EISA/PCI/CardBus SCSI host adapter driver</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> For VL cards:<br>
<b class="config">ahc0 at isa? port ? irq ?</b><p>
For EISA cards:<br>
<b class="config">ahc* at eisa? slot ?</b><p>
For PCI cards:<br>
<b class="config">ahc* at pci? dev ? function ?</b><p>
For CardBus cards:<br>
<b class="config">ahc* at cardbus? function ?</b><p>
To allow PCI adapters to use memory mapped I/O if enabled:<br>
<b class="config">options AHC_ALLOW_MEMIO</b><p>
Disable tagged queuing (avoids hangs on some hardware under load)<br>
<b class="config">options AHC_NO_TAGS</b><p>
Change the default SCSI id for cards without a SEEPROM (default 7):<br>
<b class="config">options AHC_CARDBUS_DEFAULT_SCSI_ID=integer</b><p>
For SCSI buses:<br>
<b class="config">scsibus* at ahc?</b></div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="name">ahc</b> device driver supports SCSI controllers based on Adaptec AIC77xx and AIC78xx SCSI host adapter chips found on many motherboards as well as Adaptec SCSI controller cards.<p>
Driver features include support for twin and wide buses, fast, ultra or ultra2 synchronous transfers depending on controller type, tagged queuing and SCB paging.<p>
Memory mapped I/O can be enabled for PCI devices with the &#8220;<span class="define">AHC_ALLOW_MEMIO</span>&#8221; configuration option. Memory mapped I/O is more efficient than the alternative, programmed I/O. Most PCI BIOSes will map devices so that either technique for communicating with the card is available. In some cases, usually when the PCI device is sitting behind a PCI-&gt;PCI bridge, the BIOS may fail to properly initialize the chip for memory mapped I/O. The typical symptom of this problem is a system hang if memory mapped I/O is attempted. Most modern motherboards perform the initialization correctly and work fine with this option enabled.<p>
Per target configuration performed in the SCSI-Select menu, accessible at boot in non-EISA models, or through an EISA configuration utility for EISA models, is honored by this driver. This includes synchronous/asynchronous transfers, maximum synchronous negotiation rate, wide transfers, disconnection, the host adapter's SCSI ID, and, in the case of EISA Twin Channel controllers, the primary channel selection. For systems that store non-volatile settings in a system specific manner rather than a serial EEPROM directly connected to the aic7xxx controller, the BIOS must be enabled for the driver to access this information. This restriction applies to all EISA and many motherboard configurations.<p>
Note that I/O addresses are determined automatically by the probe routines, but care should be taken when using a 284x (VESA local bus controller) in an EISA system. The jumpers setting the I/O area for the 284x should match the EISA slot into which the card is inserted to prevent conflicts with other EISA cards.<p>
Performance and feature sets vary throughout the aic7xxx product line. The following table provides a comparison of the different chips supported by the <b class="name">ahc</b> driver. Note that wide and twin channel features, although always supported by a particular chip, may be disabled in a particular motherboard or card design.<table style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-col">
<col style="width: 8.00ex;">
<col style="width: 4.00ex;">
<col style="width: 7.00ex;">
<col style="width: 7.00ex;">
<col style="width: 8.00ex;">
<col style="width: 4.00ex;">
<col style="min-width: 13.00ex;">
<tbody>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<span class="symb">Chip</span></td>
<td class="list-col" style="margin-top: 1.00em;">
<span class="symb">MIPS</span></td>
<td class="list-col" style="margin-top: 1.00em;">
<span class="symb">Bus</span></td>
<td class="list-col" style="margin-top: 1.00em;">
<span class="symb">MaxSync</span></td>
<td class="list-col" style="margin-top: 1.00em;">
<span class="symb">MaxWidth</span></td>
<td class="list-col" style="margin-top: 1.00em;">
<span class="symb">SCBs</span></td>
<td class="list-col" style="margin-top: 1.00em;">
<span class="symb">Features</span></td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
aic7770</td>
<td class="list-col" style="margin-top: 1.00em;">
10</td>
<td class="list-col" style="margin-top: 1.00em;">
EISA/VL</td>
<td class="list-col" style="margin-top: 1.00em;">
10MHz</td>
<td class="list-col" style="margin-top: 1.00em;">
16Bit</td>
<td class="list-col" style="margin-top: 1.00em;">
4</td>
<td class="list-col" style="margin-top: 1.00em;">
1</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
aic7850</td>
<td class="list-col" style="margin-top: 1.00em;">
10</td>
<td class="list-col" style="margin-top: 1.00em;">
PCI/32</td>
<td class="list-col" style="margin-top: 1.00em;">
10MHz</td>
<td class="list-col" style="margin-top: 1.00em;">
8Bit</td>
<td class="list-col" style="margin-top: 1.00em;">
3</td>
<td class="list-col" style="margin-top: 1.00em;">
</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
aic7860</td>
<td class="list-col" style="margin-top: 1.00em;">
10</td>
<td class="list-col" style="margin-top: 1.00em;">
PCI/32</td>
<td class="list-col" style="margin-top: 1.00em;">
20MHz</td>
<td class="list-col" style="margin-top: 1.00em;">
8Bit</td>
<td class="list-col" style="margin-top: 1.00em;">
3</td>
<td class="list-col" style="margin-top: 1.00em;">
</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
aic7870</td>
<td class="list-col" style="margin-top: 1.00em;">
10</td>
<td class="list-col" style="margin-top: 1.00em;">
PCI/32</td>
<td class="list-col" style="margin-top: 1.00em;">
10MHz</td>
<td class="list-col" style="margin-top: 1.00em;">
16Bit</td>
<td class="list-col" style="margin-top: 1.00em;">
16</td>
<td class="list-col" style="margin-top: 1.00em;">
</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
aic7880</td>
<td class="list-col" style="margin-top: 1.00em;">
10</td>
<td class="list-col" style="margin-top: 1.00em;">
PCI/32</td>
<td class="list-col" style="margin-top: 1.00em;">
20MHz</td>
<td class="list-col" style="margin-top: 1.00em;">
16Bit</td>
<td class="list-col" style="margin-top: 1.00em;">
16</td>
<td class="list-col" style="margin-top: 1.00em;">
</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
aic7890</td>
<td class="list-col" style="margin-top: 1.00em;">
20</td>
<td class="list-col" style="margin-top: 1.00em;">
PCI/32</td>
<td class="list-col" style="margin-top: 1.00em;">
40MHz</td>
<td class="list-col" style="margin-top: 1.00em;">
16Bit</td>
<td class="list-col" style="margin-top: 1.00em;">
16</td>
<td class="list-col" style="margin-top: 1.00em;">
3 4 5 6 7 8</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
aic7891</td>
<td class="list-col" style="margin-top: 1.00em;">
20</td>
<td class="list-col" style="margin-top: 1.00em;">
PCI/64</td>
<td class="list-col" style="margin-top: 1.00em;">
40MHz</td>
<td class="list-col" style="margin-top: 1.00em;">
16Bit</td>
<td class="list-col" style="margin-top: 1.00em;">
16</td>
<td class="list-col" style="margin-top: 1.00em;">
3 4 5 6 7 8</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
aic7892</td>
<td class="list-col" style="margin-top: 1.00em;">
20</td>
<td class="list-col" style="margin-top: 1.00em;">
PCI/64</td>
<td class="list-col" style="margin-top: 1.00em;">
80MHz</td>
<td class="list-col" style="margin-top: 1.00em;">
16Bit</td>
<td class="list-col" style="margin-top: 1.00em;">
16</td>
<td class="list-col" style="margin-top: 1.00em;">
3 4 5 6 7 8</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
aic7895</td>
<td class="list-col" style="margin-top: 1.00em;">
15</td>
<td class="list-col" style="margin-top: 1.00em;">
PCI/32</td>
<td class="list-col" style="margin-top: 1.00em;">
20MHz</td>
<td class="list-col" style="margin-top: 1.00em;">
16Bit</td>
<td class="list-col" style="margin-top: 1.00em;">
16</td>
<td class="list-col" style="margin-top: 1.00em;">
2 3 4 5</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
aic7895C</td>
<td class="list-col" style="margin-top: 1.00em;">
15</td>
<td class="list-col" style="margin-top: 1.00em;">
PCI/32</td>
<td class="list-col" style="margin-top: 1.00em;">
20MHz</td>
<td class="list-col" style="margin-top: 1.00em;">
16Bit</td>
<td class="list-col" style="margin-top: 1.00em;">
16</td>
<td class="list-col" style="margin-top: 1.00em;">
2 3 4 5 8</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
aic7896</td>
<td class="list-col" style="margin-top: 1.00em;">
20</td>
<td class="list-col" style="margin-top: 1.00em;">
PCI/32</td>
<td class="list-col" style="margin-top: 1.00em;">
40MHz</td>
<td class="list-col" style="margin-top: 1.00em;">
16Bit</td>
<td class="list-col" style="margin-top: 1.00em;">
16</td>
<td class="list-col" style="margin-top: 1.00em;">
2 3 4 5 6 7 8</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
aic7897</td>
<td class="list-col" style="margin-top: 1.00em;">
20</td>
<td class="list-col" style="margin-top: 1.00em;">
PCI/64</td>
<td class="list-col" style="margin-top: 1.00em;">
40MHz</td>
<td class="list-col" style="margin-top: 1.00em;">
16Bit</td>
<td class="list-col" style="margin-top: 1.00em;">
16</td>
<td class="list-col" style="margin-top: 1.00em;">
2 3 4 5 6 7 8</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
aic7899</td>
<td class="list-col" style="margin-top: 1.00em;">
20</td>
<td class="list-col" style="margin-top: 1.00em;">
PCI/64</td>
<td class="list-col" style="margin-top: 1.00em;">
80MHz</td>
<td class="list-col" style="margin-top: 1.00em;">
16Bit</td>
<td class="list-col" style="margin-top: 1.00em;">
16</td>
<td class="list-col" style="margin-top: 1.00em;">
2 3 4 5 6 7 8</td>
</tr>
</tbody>
</table>
<p>
<ol style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-enum">
<li class="list-enum" style="margin-top: 0.00em;">
Multiplexed Twin Channel Device - One controller servicing two buses.</li>
<li class="list-enum" style="margin-top: 0.00em;">
Multi-function Twin Channel Device - Two controllers on one chip.</li>
<li class="list-enum" style="margin-top: 0.00em;">
Command Channel Secondary DMA Engine - Allows scatter gather list and SCB prefetch.</li>
<li class="list-enum" style="margin-top: 0.00em;">
64 Byte SCB Support - SCSI CDB is embedded in the SCB to eliminate an extra DMA.</li>
<li class="list-enum" style="margin-top: 0.00em;">
Block Move Instruction Support - Doubles the speed of certain sequencer operations.</li>
<li class="list-enum" style="margin-top: 0.00em;">
&#8216;Bayonet&#8217; style Scatter Gather Engine - Improves S/G prefetch performance.</li>
<li class="list-enum" style="margin-top: 0.00em;">
Queuing Registers - Allows queuing of new transactions without pausing the sequencer.</li>
<li class="list-enum" style="margin-top: 0.00em;">
Multiple Target IDs - Allows the controller to respond to selection as a target on multiple SCSI IDs.</li>
</ol>
</div>
<div class="section">
<h1 id="x4841524457415245">HARDWARE</h1> Supported SCSI controllers include:<ul style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-item">
<li class="list-item" style="margin-top: 1.00em;">
Adaptec AHA-2742W EISA Fast Wide SCSI adapter</li>
<li class="list-item" style="margin-top: 1.00em;">
Adaptec AHA-274xAT EISA dual channel Fast SCSI adapter</li>
<li class="list-item" style="margin-top: 1.00em;">
Adaptec AHA-284x VL Fast SCSI adapter</li>
<li class="list-item" style="margin-top: 1.00em;">
Adaptec AHA-2910 PCI Fast SCSI adapter (no SCSI BIOS)</li>
<li class="list-item" style="margin-top: 1.00em;">
Adaptec AHA-2915 PCI Fast SCSI adapter (no SCSI BIOS)</li>
<li class="list-item" style="margin-top: 1.00em;">
Adaptec AHA-2920C PCI Fast SCSI adapter<ul style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-item">
<li class="list-item" style="margin-top: 1.00em;">
Note: Adaptec AHA-2920/A which use the Future Domain's chips are not supported by this driver.</li>
</ul>
</li>
<li class="list-item" style="margin-top: 1.00em;">
Adaptec AHA-2930C PCI Ultra SCSI adapter</li>
<li class="list-item" style="margin-top: 1.00em;">
Adaptec AHA-2930U2 PCI Ultra2 Wide LVD SCSI adapter</li>
<li class="list-item" style="margin-top: 1.00em;">
Adaptec AHA-2940 PCI Fast SCSI adapter</li>
<li class="list-item" style="margin-top: 1.00em;">
Adaptec AHA-2940U PCI Ultra SCSI adapter</li>
<li class="list-item" style="margin-top: 1.00em;">
Adaptec AHA-2940AU PCI Ultra SCSI adapter</li>
<li class="list-item" style="margin-top: 1.00em;">
Adaptec AHA-2940UW PCI Ultra Wide SCSI adapter</li>
<li class="list-item" style="margin-top: 1.00em;">
Adaptec AHA-2940UW Dual PCI dual channel Ultra Wide SCSI adapter</li>
<li class="list-item" style="margin-top: 1.00em;">
Adaptec AHA-2940UW Pro PCI Ultra Wide SCSI adapter</li>
<li class="list-item" style="margin-top: 1.00em;">
Adaptec AHA-2940U2W PCI Ultra2 Wide LVD SCSI adapter</li>
<li class="list-item" style="margin-top: 1.00em;">
Adaptec AHA-2940U2B PCI Ultra2 Wide LVD SCSI adapter</li>
<li class="list-item" style="margin-top: 1.00em;">
Adaptec AHA-2944W PCI Fast Wide Differential SCSI adapter</li>
<li class="list-item" style="margin-top: 1.00em;">
Adaptec AHA-2944UW PCI Ultra Wide Differential SCSI adapter</li>
<li class="list-item" style="margin-top: 1.00em;">
Adaptec AHA-2950U2W</li>
<li class="list-item" style="margin-top: 1.00em;">
Adaptec AHA-2950U2B 64bit PCI Ultra2 Wide LVD SCSI adapter</li>
<li class="list-item" style="margin-top: 1.00em;">
Adaptec AHA-19160B PCI Ultra160 Wide LVD SCSI adapter</li>
<li class="list-item" style="margin-top: 1.00em;">
Adaptec ASC-29160 PCI Ultra160 Wide LVD SCSI adapter</li>
<li class="list-item" style="margin-top: 1.00em;">
Adaptec AHA-29160N PCI Ultra160 Wide LVD SCSI adapter</li>
<li class="list-item" style="margin-top: 1.00em;">
Adaptec AHA-29160B 64bit PCI Ultra160 Wide LVD SCSI adapter</li>
<li class="list-item" style="margin-top: 1.00em;">
Adaptec AHA-3940 PCI dual channel Fast SCSI adapter</li>
<li class="list-item" style="margin-top: 1.00em;">
Adaptec AHA-3940U PCI dual channel Ultra SCSI adapter</li>
<li class="list-item" style="margin-top: 1.00em;">
Adaptec AHA-3940AU PCI dual channel Ultra SCSI adapter</li>
<li class="list-item" style="margin-top: 1.00em;">
Adaptec AHA-3940UW PCI dual channel Ultra Wide SCSI adapter</li>
<li class="list-item" style="margin-top: 1.00em;">
Adaptec AHA-3940AUW PCI dual channel Ultra Wide SCSI adapter</li>
<li class="list-item" style="margin-top: 1.00em;">
Adaptec AHA-3940U2W PCI dual channel Ultra2 Wide LVD SCSI adapter</li>
<li class="list-item" style="margin-top: 1.00em;">
Adaptec AHA-3950U2 64bit PCI dual channel Ultra2 Wide LVD SCSI adapter</li>
<li class="list-item" style="margin-top: 1.00em;">
Adaptec AHA-3960 64bit PCI dual channel Ultra160 Wide LVD SCSI adapter</li>
<li class="list-item" style="margin-top: 1.00em;">
Adaptec AHA-3985 PCI dual channel Fast SCSI RAID adapter</li>
<li class="list-item" style="margin-top: 1.00em;">
Adaptec AHA-39160 64bit PCI dual channel Ultra160 Wide LVD SCSI adapter</li>
<li class="list-item" style="margin-top: 1.00em;">
Adaptec AHA-4944UW PCI quad channel PCI Ultra Wide Differential SCSI adapter</li>
<li class="list-item" style="margin-top: 1.00em;">
Other SCSI controllers based on the Adaptec AIC7770, AIC7850, AIC7860, AIC7870, AIC7880, AIC7890, AIC7891, AIC7892, AIC7895, AIC7896, AIC7897 and AIC7899 SCSI host adapter chips.</li>
</ul>
</div>
<div class="section">
<h1 id="x5343534920434f4e54524f4c20424c4f434b5320285343427329">SCSI CONTROL BLOCKS (SCBs)</h1> Every transaction sent to a device on the SCSI bus is assigned a &#8216;SCSI Control Block&#8217; (SCB). The SCB contains all of the information required by the controller to process a transaction. The chip feature table lists the number of SCBs that can be stored in on-chip memory. All chips with model numbers greater than or equal to 7870 allow for the on chip SCB space to be augmented with external SRAM up to a maximum of 255 SCBs. Very few Adaptec controller configurations have external SRAM.<p>
If external SRAM is not available, SCBs are a limited resource. Using the SCBs in a straight forward manner would only allow the driver to handle as many concurrent transactions as there are physical SCBs. To fully use the SCSI bus and the devices on it, requires much more concurrency. The solution to this problem is <span class="emph">SCB Paging</span>, a concept similar to memory paging. SCB paging takes advantage of the fact that devices usually disconnect from the SCSI bus for long periods of time without talking to the controller. The SCBs for disconnected transactions are only of use to the controller when the transfer is resumed. When the host queues another transaction for the controller to execute, the controller firmware will use a free SCB if one is available. Otherwise, the state of the most recently disconnected (and therefor most likely to stay disconnected) SCB is saved, via DMA, to host memory, and the local SCB reused to start the new transaction. This allows the controller to queue up to 255 transactions regardless of the amount of SCB space. Since the local SCB space serves as a cache for disconnected transactions, the more SCB space available, the less host bus traffic consumed saving and restoring SCB data.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../4/aha">aha(4)</a>, <a class="link-man" href="../4/ahb">ahb(4)</a>, <a class="link-man" href="../4/ahd">ahd(4)</a>, <a class="link-man" href="../4/cd">cd(4)</a>, <a class="link-man" href="../4/ch">ch(4)</a>, <a class="link-man" href="../4/intro">intro(4)</a>, <a class="link-man" href="../4/scsi">scsi(4)</a>, <a class="link-man" href="../4/sd">sd(4)</a>, <a class="link-man" href="../4/st">st(4)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="name">ahc</b> driver appeared in <span class="unix">FreeBSD&#160;2.0</span> and <span class="unix">NetBSD&#160;1.1</span>.</div>
<div class="section">
<h1 id="x415554484f5253">AUTHORS</h1> The <b class="name">ahc</b> driver, the AIC7xxx sequencer-code assembler, and the firmware running on the aic7xxx chips was written by <span class="author">Justin T. Gibbs</span>. <span class="unix">NetBSD</span> porting is done by Stefan Grefen, Charles M. Hannum, Michael Graff, Jason R. Thorpe, Pete Bentley, Frank van der Linden and Noriyuki Soda.</div>
<div class="section">
<h1 id="x42554753">BUGS</h1> Some Quantum drives (at least the Empire 2100 and 1080s) will not run on an AIC7870 Rev B in synchronous mode at 10MHz. Controllers with this problem have a 42 MHz clock crystal on them and run slightly above 10MHz. This confuses the drive and hangs the bus. Setting a maximum synchronous negotiation rate of 8MHz in the SCSI-Select utility will allow normal operation.<p>
Target mode is not supported on <span class="unix">NetBSD</span> version of this driver.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
July 16, 2007</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

