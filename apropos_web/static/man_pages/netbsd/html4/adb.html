<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="/static/man_pages/netbsd/style.css" type="text/css" media="all">
<title>
ADB(4)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
ADB(4)</td>
<td class="head-vol" align="center">
Kernel Interfaces Manual</td>
<td class="head-rtitle" align="right">
ADB(4)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">adb</b> &#8212; <span class="desc">Apple Desktop Bus driver</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="config">adb* at obio?</b><p>
<br>
<b class="config">options MRG_ADB</b><p>
<br>
<b class="includes">#include &lt;<a class="link-includes">machine/adbsys.h</a>&gt;</b></div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The Apple Desktop Bus (ADB) is the single-master, multiple-slave, low-speed serial bus interface used by Macintosh computers to connect input devices such as keyboards, mice, trackpads, trackballs, and graphics tablets to the machine. <span class="unix">NetBSD</span> provides support for the Apple Desktop Bus as found on all supported mac68k models, as well as macppc models with on-board ADB (PowerBooks and &#8220;Old World&#8221; models).<p>
The <b class="name">adb</b> driver accesses the ADB controller using the so-called &#8220;HWDIRECT&#8221; method. This method of access bypasses the Macintosh ROM and uses only <span class="unix">NetBSD</span> routines for ADB access. This is the only method supported on macppc and is the default for mac68k systems.<p>
On mac68k systems there is an alternate method of accessing the ADB controller. With the Macintosh ROM Glue (MRG) method, the routines written for MacOS are used. To enable this method of ADB access, uncomment the line:<p>
<b class="config">options MRG_ADB</b><p>
in your kernel configuration file.<p>
The <a class="link-man" href="../2/ioctl">ioctl(2)</a> call is used to control the ADB event device. The following is a list of available <a class="link-man" href="../2/ioctl">ioctl(2)</a> commands:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">ADBIOC_DEVSINFO</span></dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
Get ADB Device Info<p>
The <b class="name">adb</b> event device will return an array of information containing an entry for each device connected to the bus. Each entry contains the current address, default address, and handler ID for the corresponding ADB device.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">ADBIOC_GETREPEAT</span></dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
Get Keyboard Repeat Info<p>
Returns a structure containing the current keyboard repeat delay and keyboard repeat interval.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">ADBIOC_SETREPEAT</span></dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
Set Keyboard Repeat Rate<p>
Sets the keyboard repeat delay and interval to the values specified by <i class="arg">argp</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">ADBIOC_RESET</span></dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
ADB Reset<p>
Perform a reset of the ADB which will reinitialize all of the devices attached to the bus.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">ADBIOC_LISTENCMD</span></dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
ADB Listen Command<p>
Send data to the register of the ADB device specified by <i class="arg">argp</i>. This command is not fully implemented at this time.</dd>
</dl>
</div>
<div class="section">
<h1 id="x535550504f525445442044455649434553">SUPPORTED DEVICES</h1> <span class="unix">NetBSD</span> includes support for the following ADB devices, sorted by driver name:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
abtn</dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
ADB mouse button?</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
aed</dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
ADB event device</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
akbd</dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
ADB keyboard</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
ams</dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
ADB mouse</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
apm</dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
APM emulation</dd>
</dl>
</div>
<div class="section">
<h1 id="x46494c4553">FILES</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/dev/adb</i></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
The ADB event device.</dd>
</dl>
</div>
<div class="section">
<h1 id="x444941474e4f5354494353">DIAGNOSTICS</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-diag">
<dt class="list-diag" style="margin-top: 1.00em;">
<b class="diag">aed0 at adb0 addr 0: ADB Event device</b></dt>
<dd class="list-diag">
This is a normal autoconfiguration message noting the presence of the <b class="name">adb</b> event device.</dd>
<dt class="list-diag" style="margin-top: 1.00em;">
<b class="diag">adb0 at obio0 offset 0x16000 irq 18: 2 targets</b></dt>
<dd class="list-diag">
A standard autoconfiguration message indicating the initialization of the ADB subsystem.</dd>
<dt class="list-diag" style="margin-top: 1.00em;">
<b class="diag">adb: no devices found.</b></dt>
<dd class="list-diag">
No ADB devices were found to be connected to the bus during autoconfiguration.</dd>
<dt class="list-diag" style="margin-top: 1.00em;">
<b class="diag">adb: using %s series hardware support.</b></dt>
<dd class="list-diag">
Indicates the class of ADB hardware support the machine uses.</dd>
<dt class="list-diag" style="margin-top: 1.00em;">
<b class="diag">adb: hardware type unknown for this machine.</b></dt>
<dd class="list-diag">
The ADB hardware in this machine is currently unsupported.</dd>
<dt class="list-diag" style="margin-top: 1.00em;">
<b class="diag">adb: no ROM ADB driver in this kernel for this machine.</b></dt>
<dd class="list-diag">
The kernel lacks the necessary Macintosh ROM Glue (MRG) support for accessing the ADB hardware on this machine.</dd>
<dt class="list-diag" style="margin-top: 1.00em;">
<b class="diag">adb: using serial console.</b></dt>
<dd class="list-diag">
A serial console will be used for user input rather than the ADB event device.</dd>
<dt class="list-diag" style="margin-top: 1.00em;">
<b class="diag">adb: %s at %d.</b></dt>
<dd class="list-diag">
An ADB device of the type specified by <span class="emph">%s</span> has been found at location <span class="emph">%d</span>.</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../4/aed">aed(4)</a>, <a class="link-man" href="../4/akbd">akbd(4)</a>, <a class="link-man" href="../4/ams">ams(4)</a>, <a class="link-man" href="../4/apm">apm(4)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="name">adb</b> interface first appeared in <span class="unix">NetBSD&#160;0.9</span>. It has been under development ever since.</div>
<div class="section">
<h1 id="x415554484f5253">AUTHORS</h1> Bradley A. Grantham wrote the original <b class="name">adb</b> driver, including the MRG support. The hardware direct interface was written by John P. Wittkowski. The PowerManager interface was written by Takashi Hamada.</div>
<div class="section">
<h1 id="x42554753">BUGS</h1><ul style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-bul">
<li class="list-bul" style="margin-top: 1.00em;">
Not every class of ADB hardware is supported yet.</li>
<li class="list-bul" style="margin-top: 1.00em;">
The talk command is currently unimplemented.</li>
<li class="list-bul" style="margin-top: 1.00em;">
The listen command is not implemented yet.</li>
<li class="list-bul" style="margin-top: 1.00em;">
Not all multi-button mice are currently supported.</li>
<li class="list-bul" style="margin-top: 1.00em;">
Only mapped and relative-position ADB devices (i.e. keyboards and mice) are supported. Thus absolute-position and other exotic devices will not work.</li>
<li class="list-bul" style="margin-top: 1.00em;">
Some of the diagnostic messages in this man page need to be updated.</li>
</ul>
<p>
Some mac68k machines contain so-called dirty ROM. These machines are the: Mac SE/30, Mac II, Mac IIx, and Mac IIcx. Machines with dirty ROM may experience trouble booting if the MRG code is used, especially under the following conditions:<ul style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-bul">
<li class="list-bul" style="margin-top: 0.00em;">
Both a keyboard and a mouse are not attached to the computer.</li>
<li class="list-bul" style="margin-top: 0.00em;">
An extended keyboard is attached to the computer.</li>
</ul>
<p>
On (some) machines with dirty ROM, the ROM indicates the presence of a &#8220;ghost&#8221; keyboard or mouse. When this nonexistent device is probed for, the result is an infinite loop. This is believed to be triggered by the <b class="name">adb</b> driver probing for extended mice, and non-EMP Logitech mice.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
September 21, 2003</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

