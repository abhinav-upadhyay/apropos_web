<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/../4/strict.dtd">
>
<head>
<meta http-equiv="Content-Type" content="te../; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
ACPICPU(4)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
ACPICPU(4)</td>
<td class="head-vol" align="center">
Kernel Interfaces Manual</td>
<td class="head-rtitle" align="right">
ACPICPU(4)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">acpicpu</b> &#8212; <span class="desc">ACPI CPU</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="config">acpicpu* at cpu?</b></div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="name">acpicpu</b> device driver supports certain processor features that are either only available via ACPI or that require ACPI to function properly. Typically the ACPI processor functionality is grouped into so-called C-, P-, and T-states.<div class="subsection">
<h2 id="x431e737461746573">C-states</h2> The processor power states, or C-states, are low-power modes that can be used when the CPU is idle. The idea is not new: already in the 80486 processor a specific instruction (HLT) was used for this purpose. This was later accompanied by a pair of other instructions (MONITOR, MWAIT). By default, <span class="unix">NetBSD</span> may use either one; see the <b class="cmd">machdep.idle-mechanism</b> <a class="link-man" href="../8/sysctl">sysctl(8)</a> variable. ACPI provides the latest amendment.<p>
The following C-states are typically available. Additional processor or vendor specific states (C4, ..., Cn) are handled internally by <b class="name">acpicpu</b>.<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">C0</span></dt>
<dd class="list-tag" style="margin-left: 2.00ex;">
This is the normal state of a processor; the CPU is busy executing instructions.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">C1</span></dt>
<dd class="list-tag" style="margin-left: 2.00ex;">
This is the state that is typically reached via the mentioned x86 instructions. On a typical processor, <span class="define">C1</span> turns off the main internal CPU clock, leaving APIC running at full speed. The CPU is free to temporarily leave the state to deal with important requests.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">C2</span></dt>
<dd class="list-tag" style="margin-left: 2.00ex;">
The main difference between <span class="define">C1</span> and <span class="define">C2</span> lies in the internal hardware entry method of the processor. While less power is expected to be consumed than in <span class="define">C1</span>, the bus interface unit is still running. But depending on the processor, the local APIC timer may be stopped. Like with <span class="define">C1</span>, entering and exiting the state are expected to be fast operations.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">C3</span></dt>
<dd class="list-tag" style="margin-left: 2.00ex;">
This is the deepest conventional state. Parts of the CPU are actively powered down. The internal CPU clock is stopped. The local APIC timer is stopped. Depending on the processor, additional timers such as <a class="link-man" href="../9/x86/tsc">x86/tsc(9)</a> may be stopped. Processor caches may be flushed. Entry and exit latencies are expected to be high; the CPU can no longer &#8220;quickly&#8221; respond to bus activity or other interruptions.</dd>
</dl>
<p>
Each state has a latency associated with entry and exit. The higher the state, the lower the power consumption, and the higher the potential performance costs.<p>
The <b class="name">acpicpu</b> driver tries to balance the latency constraints when choosing the appropriate state. One of the checks involves bus master activity; if such activity is detected, a lower state is used. It is known that particularly <a class="link-man" href="../4/usb">usb(4)</a> may cause high activity even when not in use. If maximum power savings are desirable, it may be necessary to use a custom kernel without USB support. And generally: to save power with C-states, one should avoid polling, both in userland and in the kernel.</div>
<div class="subsection">
<h2 id="x501e737461746573">P-states</h2> The processor performance states, or P-states, are used to control the clock frequencies and voltages of a CPU. Underneath the abstractions of ACPI, P-states are associated with such technologies as &#8220;SpeedStep&#8221; (Intel), &#8220;PowerNow!&#8221; (AMD), and &#8220;PowerSaver&#8221; (VIA).<p>
The P0-state is always the highest operating frequency supported by the processor. The number of additional P-states may vary across processors and vendors. Each higher numbered P-state represents lower clock frequencies and hence lower power consumption. Note that while <b class="name">acpicpu</b> always uses the exact frequencies internally, the user-visible values reported by ACPI may be rounded or approximated by the vendor.<p>
Unlike conventional CPU frequency management, ACPI provides support for Dynamic Voltage and Frequency Scaling (DVFS). Among other things, this means that the firmware may request the implementation to dynamically scale the presently supported maximum or minimum clock frequency. For example, if <a class="link-man" href="../4/acpiacad">acpiacad(4)</a> is disconnected, the maximum available frequency may be lowered. By default, the <span class="unix">NetBSD</span> implementation may manipulate the frequencies according to the notifications from the firmware.</div>
<div class="subsection">
<h2 id="x541e737461746573">T-states</h2> Processor T-states, or &#8220;throttling states&#8221;, can be used to actively modulate the time a processor is allowed to execute. Outside the ACPI nomenclature, throttling and T-states may be known as &#8220;on-demand clock modulation&#8221; (ODCM).<p>
The concept of &#8220;duty cycle&#8221; is relevant to T-states. It is generally defined to be a fraction of time that a system is in an &#8220;active&#8221; state. The T0-state has always a duty cycle of 100 %, and thus, comparable to the C0-state, the processor is fully active. Each additional higher-numbered T-state indicates lower duty cycles. At most eight T-states may be available, although also T-states use DVFS.<p>
The duty cycle does not refer to the actual clock signal, but to the time period in which the clock signal is allowed to drive the processor chip. For instance, if a T-state has a duty cycle of 75 %, the CPU runs at the same clock frequency and uses the same voltage, but 25 % of the time the CPU is forced to idle. Because of this, the use of T-states may severely affect system performance.<p>
There are two typical situations for throttling: power management and thermal control. As a technique to save power, T-states are largely an artifact from the past. There was a short period in the x86 lineage when P-states were not yet available and throttling was considered as an option to modulate the processor power consumption. The approach was however quickly abandoned. In modern x86 systems P-states should be preferred in all circumstances. It is also more beneficial to move from the C0-state to deeper C-states than it is to actively force down the duty cycle of a processor.<p>
But T-states have retained their use as a last line of defense against critical thermal conditions. Many x86 processors include a catastrophic shutdown detector. When the processor core temperature reaches this factory defined trip-point, the processor execution is halted without any software control. Before this fatal condition, it is possible to use throttling for a short period of time in order to force the temperatures to lower levels. The thermal control modulation is typically started only when the system is in the highest-power P-state and a high temperature situation exists. After the temperatures have returned to non-critical levels, the modulation ceases.</div>
<div class="subsection">
<h2 id="x53797374656d20436f6e74726f6c205661726961626c6573">System Control Variables</h2> The <b class="name">acpicpu</b> driver uses the same <a class="link-man" href="../8/sysctl">sysctl(8)</a> controls for P-states as the ones provided by <a class="link-man" href="../4/est">est(4)</a> and <a class="link-man" href="../4/powernow">powernow(4)</a>. Depending on the processor, the second-level node is either <b class="cmd">machdep.est</b> or <b class="cmd">machdep.powernow</b>. Please note that future versions of <b class="name">acpicpu</b> may however remove these system control variables without further notice.<p>
In addition, the following two variables are available.<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">hw.acpi.cpu.dynamic</b></dt>
<dd class="list-tag" style="margin-left: 19.00ex;">
A boolean that controls whether the states are allowed to change dynamically. When enabled, C-, P-, and T-states may all change at runtime, and <b class="name">acpicpu</b> may also take actions based on requests from the firmware.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">hw.acpi.cpu.passive</b></dt>
<dd class="list-tag" style="margin-left: 19.00ex;">
A boolean that enables or disables automatic processor thermal management via <a class="link-man" href="../4/acpitz">acpitz(4)</a>.</dd>
</dl>
</div>
<div class="subsection">
<h2 id="x53746174697374696373">Statistics</h2> The <b class="name">acpicpu</b> driver uses event counters to track the times a processor has entered a given state. It is possible to view the statistics by using <a class="link-man" href="../1/vmstat">vmstat(1)</a> (with the <b class="flag">&#45;e</b> flag).</div>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../4/acpi">acpi(4)</a>, <a class="link-man" href="../4/acpitz">acpitz(4)</a>, <a class="link-man" href="../4/est">est(4)</a>, <a class="link-man" href="../4/odcm">odcm(4)</a>, <a class="link-man" href="../4/powernow">powernow(4)</a>, <a class="link-man" href="../9/cpu_idle">cpu_idle(9)</a><p>
<span class="ref"><span class="ref-auth">Etienne Le Sueur</span> and <span class="ref-auth">Gernot Heiser</span>, <span class="ref-title">Dynamic Voltage and Frequency Scaling: The Laws of Diminishing Returns</span>, <a class="link-ref" href="http://www.ertos.nicta.com.au/publications/papers/LeSueur_Heiser_10.pdf">http://www.ertos.nicta.com.au/publications/papers/LeSueur_Heiser_10.pdf</a>, <span class="ref-date">October, 2010</span>, <span class="ref-opt">Proceedings of the 2010 Workshop on Power Aware Computing and Systems (HotPower'10)</span>.</span><p>
<span class="ref"><span class="ref-auth">David C. Snowdon</span>, <span class="ref-title">Operating System Directed Power Management</span>, <i class="ref-issue">School of Computer Science and Engineering, University of New South Wales</i>, <a class="link-ref" href="http://ertos.nicta.com.au/publications/papers/Snowdon:phd.pdf">http://ertos.nicta.com.au/publications/papers/Snowdon:phd.pdf</a>, <span class="ref-date">March, 2010</span>, <span class="ref-opt">PhD Thesis</span>.</span><p>
<span class="ref"><span class="ref-auth">Microsoft Corporation</span>, <span class="ref-title">Windows Native Processor Performance Control</span>, <span class="ref-num">Version 1.1a</span>, <a class="link-ref" href="http://msdn.microsoft.com/en-us/windows/hardware/gg463343">http://msdn.microsoft.com/en-us/windows/hardware/gg463343</a>, <span class="ref-date">November, 2002</span>.</span><p>
<span class="ref"><span class="ref-auth">Venkatesh Pallipadi</span> and <span class="ref-auth">Alexey Starikovskiy</span>, <span class="ref-title">The Ondemand Governor. Past, Present, and Future</span>, <i class="ref-issue">Intel Open Source Technology Center</i>, <a class="link-ref" href="http://www.kernel.org/doc/ols/2006/ols2006v2-pages-223-238.pdf">http://www.kernel.org/doc/ols/2006/ols2006v2-pages-223-238.pdf</a>, <span class="ref-date">July, 2006</span>, <span class="ref-opt">Proceedings of the Linux Symposium</span>.</span></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="name">acpicpu</b> device driver appeared in <span class="unix">NetBSD&#160;6.0</span>.</div>
<div class="section">
<h1 id="x415554484f5253">AUTHORS</h1> <span class="author">Jukka Ruohonen</span> &#60;jruohonen@iki.fi&#62;</div>
<div class="section">
<h1 id="x43415645415453">CAVEATS</h1> At least the following caveats can be mentioned.<ul style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-bul">
<li class="list-bul" style="margin-top: 1.00em;">
It is currently only safe to use <span class="define">C1</span> on <span class="unix">NetBSD</span>. All other C-states are disabled by default.</li>
<li class="list-bul" style="margin-top: 1.00em;">
Processor thermal control (see <a class="link-man" href="../4/acpitz">acpitz(4)</a>) is not yet supported.</li>
<li class="list-bul" style="margin-top: 1.00em;">
Depending on the processor, changes in C-, P-, and T-states may all skew timers and counters such as <a class="link-man" href="../9/x86/tsc">x86/tsc(9)</a>. This is neither handled by <b class="name">acpicpu</b> nor by <a class="link-man" href="../4/est">est(4)</a> or <a class="link-man" href="../4/powernow">powernow(4)</a>.</li>
<li class="list-bul" style="margin-top: 1.00em;">
There is currently neither a well-defined, machine-independent API for processor performance management nor a &#8220;governor&#8221; for different policies. It is only possible to control the CPU frequencies from userland.</li>
</ul>
</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
August 6, 2011</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
<>

