<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="/static/man_pages/netbsd/style.css" type="text/css" media="all">
<title>
PIM(4)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
PIM(4)</td>
<td class="head-vol" align="center">
Kernel Interfaces Manual</td>
<td class="head-rtitle" align="right">
PIM(4)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">pim</b> &#8212; <span class="desc">Protocol Independent Multicast</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="config">options MROUTING</b><br>
<b class="config">options PIM</b><p>
<br>
<b class="includes">#include &lt;<a class="link-includes">sys/types.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">sys/socket.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">netinet/in.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">netinet/ip_mroute.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">netinet/pim.h</a>&gt;</b><p>
<i class="ftype">int</i><br>
<b class="fname">getsockopt</b>(<i class="farg" style="white-space:nowrap;">int s</i>, <i class="farg" style="white-space:nowrap;">IPPROTO_IP</i>, <i class="farg" style="white-space:nowrap;">MRT_PIM</i>, <i class="farg" style="white-space:nowrap;">void *optval</i>, <i class="farg" style="white-space:nowrap;">socklen_t *optlen</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">setsockopt</b>(<i class="farg" style="white-space:nowrap;">int s</i>, <i class="farg" style="white-space:nowrap;">IPPROTO_IP</i>, <i class="farg" style="white-space:nowrap;">MRT_PIM</i>, <i class="farg" style="white-space:nowrap;">const void *optval</i>, <i class="farg" style="white-space:nowrap;">socklen_t optlen</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">getsockopt</b>(<i class="farg" style="white-space:nowrap;">int s</i>, <i class="farg" style="white-space:nowrap;">IPPROTO_IPV6</i>, <i class="farg" style="white-space:nowrap;">MRT6_PIM</i>, <i class="farg" style="white-space:nowrap;">void *optval</i>, <i class="farg" style="white-space:nowrap;">socklen_t *optlen</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">setsockopt</b>(<i class="farg" style="white-space:nowrap;">int s</i>, <i class="farg" style="white-space:nowrap;">IPPROTO_IPV6</i>, <i class="farg" style="white-space:nowrap;">MRT6_PIM</i>, <i class="farg" style="white-space:nowrap;">const void *optval</i>, <i class="farg" style="white-space:nowrap;">socklen_t optlen</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> PIM is the common name for two multicast routing protocols: Protocol Independent Multicast - Sparse Mode (PIM-SM) and Protocol Independent Multicast - Dense Mode (PIM-DM).<p>
PIM-SM is a multicast routing protocol that can use the underlying unicast routing information base or a separate multicast-capable routing information base. It builds unidirectional shared trees rooted at a Rendezvous Point (RP) per group, and optionally creates shortest-path trees per source.<p>
PIM-DM is a multicast routing protocol that uses the underlying unicast routing information base to flood multicast datagrams to all multicast routers. Prune messages are used to prevent future datagrams from propagating to routers with no group membership information.<p>
Both PIM-SM and PIM-DM are fairly complex protocols, though PIM-SM is much more complex. To enable PIM-SM or PIM-DM multicast routing in a router, the user must enable multicast routing and PIM processing in the kernel (see <i class="link-sec"><a class="link-sec" href="#x53594e4f50534953">SYNOPSIS</a></i> about the kernel configuration options), and must run a PIM-SM or PIM-DM capable user-level process. From developer's point of view, the programming guide described in the <i class="link-sec"><a class="link-sec" href="#x50726f6772616d6d696e67204775696465">Programming Guide</a></i> section should be used to control the PIM processing in the kernel.<div class="subsection">
<h2 id="x50726f6772616d6d696e67204775696465">Programming Guide</h2> After a multicast routing socket is open and multicast forwarding is enabled in the kernel (see <a class="link-man" href="../4/multicast">multicast(4)</a>), one of the following socket options should be used to enable or disable PIM processing in the kernel. Note that those options require certain privilege (i.e., root privilege):<p>
<pre style="margin-left: 0.00ex;" class="lit display">
/* IPv4 */ 
int v = 1;        /* 1 to enable, or 0 to disable */ 
setsockopt(mrouter_s4, IPPROTO_IP, MRT_PIM, (void *)&amp;v, sizeof(v));</pre>
<p>
<pre style="margin-left: 0.00ex;" class="lit display">
/* IPv6 */ 
int v = 1;        /* 1 to enable, or 0 to disable */ 
setsockopt(mrouter_s6, IPPROTO_IPV6, MRT6_PIM, (void *)&amp;v, sizeof(v));</pre>
<p>
After PIM processing is enabled, the multicast-capable interfaces should be added (see <a class="link-man" href="../4/multicast">multicast(4)</a>). In case of PIM-SM, the PIM-Register virtual interface must be added as well. This can be accomplished by using the following options:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
/* IPv4 */ 
struct vifctl vc; 
memset(&amp;vc, 0, sizeof(vc)); 
/* Assign all vifctl fields as appropriate */ 
... 
if (is_pim_register_vif) 
    vc.vifc_flags |= VIFF_REGISTER; 
setsockopt(mrouter_s4, IPPROTO_IP, MRT_ADD_VIF, (void *)&amp;vc, 
           sizeof(vc));</pre>
<p>
<pre style="margin-left: 0.00ex;" class="lit display">
/* IPv6 */ 
struct mif6ctl mc; 
memset(&amp;mc, 0, sizeof(mc)); 
/* Assign all mif6ctl fields as appropriate */ 
... 
if (is_pim_register_vif) 
    mc.mif6c_flags |= MIFF_REGISTER; 
setsockopt(mrouter_s6, IPPROTO_IPV6, MRT6_ADD_MIF, (void *)&amp;mc, 
           sizeof(mc));</pre>
<p>
Sending or receiving of PIM packets can be accomplished by opening first a &#8220;raw socket&#8221; (see <a class="link-man" href="../2/socket">socket(2)</a>), with protocol value of <span class="define">IPPROTO_PIM</span>:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
/* IPv4 */ 
int pim_s4; 
pim_s4 = socket(AF_INET, SOCK_RAW, IPPROTO_PIM);</pre>
<p>
<pre style="margin-left: 0.00ex;" class="lit display">
/* IPv6 */ 
int pim_s6; 
pim_s6 = socket(AF_INET6, SOCK_RAW, IPPROTO_PIM);</pre>
<p>
Then, the following system calls can be used to send or receive PIM packets: <a class="link-man" href="../2/sendto">sendto(2)</a>, <a class="link-man" href="../2/sendmsg">sendmsg(2)</a>, <a class="link-man" href="../2/recvfrom">recvfrom(2)</a>, <a class="link-man" href="../2/recvmsg">recvmsg(2)</a>.</div>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../2/getsockopt">getsockopt(2)</a>, <a class="link-man" href="../2/recvfrom">recvfrom(2)</a>, <a class="link-man" href="../2/recvmsg">recvmsg(2)</a>, <a class="link-man" href="../2/sendmsg">sendmsg(2)</a>, <a class="link-man" href="../2/sendto">sendto(2)</a>, <a class="link-man" href="../2/setsockopt">setsockopt(2)</a>, <a class="link-man" href="../2/socket">socket(2)</a>, <a class="link-man" href="../4/inet">inet(4)</a>, <a class="link-man" href="../4/intro">intro(4)</a>, <a class="link-man" href="../4/ip">ip(4)</a>, <a class="link-man" href="../4/multicast">multicast(4)</a></div>
<div class="section">
<h1 id="x5354414e4441524453">STANDARDS</h1> The PIM-SM protocol is specified in RFC 2362 (to be replaced by <span class="ref-title">draft-ietf-pim-sm-v2-new-*).</span> The PIM-DM protocol is specified in <span class="ref-title">draft-ietf-pim-dm-new-v2-*).</span></div>
<div class="section">
<h1 id="x415554484f5253">AUTHORS</h1> <span class="author"></span>The original IPv4 PIM kernel support for IRIX and SunOS-4.x was implemented by <span class="author">Ahmed Helmy</span> (USC and SGI). Later the code was ported to various <span class="unix">BSD</span> flavors and modified by <span class="author">George Edmond Eddy</span> (Rusty) (ISI), <span class="author">Hitoshi Asaeda</span> (WIDE Project), and <span class="author">Pavlin Radoslavov</span> (USC/ISI and ICSI). The IPv6 PIM kernel support was implemented by the KAME project (<a class="link-ext" href="http://www.kame.net">http://www.kame.net</a>), and was based on the IPv4 PIM kernel support.<p>
This manual page was written by <span class="author">Pavlin Radoslavov</span> (ICSI).</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
September 4, 2003</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

