<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../../style.css" type="text/css" media="all">
<title>
PCIBIOS(4) (i386)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
PCIBIOS(4)</td>
<td class="head-vol" align="center">
Kernel Interfaces Manual (i386)</td>
<td class="head-rtitle" align="right">
PCIBIOS(4)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">pcibios</b> &#8212; <span class="desc">introduction to PCI BIOS support</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="config">options   PCIBIOS</b><br>
<b class="config">options   PCIBIOSVERBOSE</b><br>
<b class="config">#options  PCIBIOS_IRQS_HINT=0x0a00 #IRQ 9,11</b><br>
<b class="config">#options  PCIBIOS_INTR_FIXUP_FORCE</b><br>
<b class="config">options   PCIBIOS_INTR_GUESS</b><br>
<b class="config">#options  PCIINTR_DEBUG</b></div>
<div class="section">
<h1 id="x494e54524f44554354494f4e">INTRODUCTION</h1> <b class="name">pcibios</b> provides support for setting up PCI controllers, bridges, and devices using information extracted from the BIOS.<p>
Ideally, the boot firmware of a machine (a.k.a. BIOS) should set up all PCI devices; assigning them I/O and memory addresses and interrupts. Alas, this does not always happen, so there is some PC specific code that can do the initialization when <span class="unix">NetBSD</span> boots.<p>
Options:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 3.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="name">PCIBIOS</b></dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
turn on the PCI BIOS support.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="name">PCIBIOSVERBOSE</b></dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
make the setup procedure verbose.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="name">PCIBIOS_IRQS_HINT</b></dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
hint for IRQ use. When <span class="emph">PCI_INTR_FIXUP</span> cannot guess an adequate IRQ for a device, the hint is used.<p>
The value is a logical or of power-of-2s of allowable interrupts:<table style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 2.00ex;" class="list list-col">
<col style="width: 9.00ex;">
<col style="width: 9.00ex;">
<col style="width: 9.00ex;">
<col style="min-width: 9.00ex;">
<tbody>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
<span class="emph">IRQ Value</span></td>
<td class="list-col" style="margin-top: 0.00em;">
<span class="emph">IRQ Value</span></td>
<td class="list-col" style="margin-top: 0.00em;">
<span class="emph">IRQ Value</span></td>
<td class="list-col" style="margin-top: 0.00em;">
<span class="emph">IRQ Value</span></td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
 0 0x0001</td>
<td class="list-col" style="margin-top: 0.00em;">
 4 0x0010</td>
<td class="list-col" style="margin-top: 0.00em;">
 8 0x0100</td>
<td class="list-col" style="margin-top: 0.00em;">
12 0x1000</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
 1 0x0002</td>
<td class="list-col" style="margin-top: 0.00em;">
 5 0x0020</td>
<td class="list-col" style="margin-top: 0.00em;">
 9 0x0200</td>
<td class="list-col" style="margin-top: 0.00em;">
13 0x2000</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
 2 0x0004</td>
<td class="list-col" style="margin-top: 0.00em;">
 6 0x0040</td>
<td class="list-col" style="margin-top: 0.00em;">
10 0x0400</td>
<td class="list-col" style="margin-top: 0.00em;">
14 0x4000</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 0.00em;">
 3 0x0008</td>
<td class="list-col" style="margin-top: 0.00em;">
 7 0x0080</td>
<td class="list-col" style="margin-top: 0.00em;">
11 0x0800</td>
<td class="list-col" style="margin-top: 0.00em;">
15 0x8000</td>
</tr>
</tbody>
</table>
For example, &#8220;<span class="symb">options PCIBIOS_IRQS_HINT=0x0a00</span>&#8221; allows IRQ 9 and IRQ 11.<p>
The kernel global variable <b class="var">pcibios_irqs_hint</b> holds this value, so a user can override this value without kernel recompilation. For example:<ul style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-bul">
<li class="list-bul" style="margin-top: 0.00em;">
To specify this value on the fly, type the following command at the boot prompt to drop into DDB (the in-kernel debugger; you have to specify &#8220;<span class="symb">options DDB</span>&#8221; to make kernel with DDB):<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit"><b class="cmd">boot -d</b></code></div>
</blockquote>
And type the following command on &#8220;<span class="symb">db&gt;</span>&#8221; prompt:<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit"><b class="cmd">write pcibios_irqs_hint 0x0a00</b></code></div>
</blockquote>
Then type the following to continue to boot:<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit"><b class="cmd">c</b></code></div>
</blockquote>
</li>
<li class="list-bul" style="margin-top: 0.00em;">
To modify kernel image without kernel recompilation, run the following command on shell:<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit"><b class="cmd">gdb --write /netbsd</b></code></div>
</blockquote>
And type the following commands at the &#8220;<span class="symb">(gdb)</span>&#8221; prompt:<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit"><b class="cmd">set pcibios_irqs_hint=0xa00</b></code></div>
</blockquote>
<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit"><b class="cmd">quit</b></code></div>
</blockquote>
</li>
</ul>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="name">PCIBIOS_INTR_FIXUP_FORCE</b></dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
Some buggy BIOS implementations provide inconsistent information between the PCI Interrupt Configuration Register and the PCI Interrupt Routing table. In such case, the PCI Interrupt Configuration Register takes precedence by default. If this happens, a kernel with <span class="emph">PCIBIOSVERBOSE</span> shows &#8220;<span class="symb">WARNING: preserving irq XX</span>&#8221; in the PCI routing table.<p>
If <span class="emph">PCIBIOS_INTR_FIXUP_FORCE</span> is specified in addition to the <span class="emph">PCI_INTR_FIXUP</span>, the PCI Interrupt Routing table takes precedence. In this case, a kernel with <span class="emph">PCIBIOSVERBOSE</span> shows &#8220;<span class="symb">WARNING: overriding irq XX</span>&#8221; in the PCI routing table.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="name">PCIBIOS_INTR_GUESS</b></dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
make <span class="emph">PCI_INTR_FIXUP</span> work with unknown interrupt router.<p>
If a PCI interrupt router is not known, normally interrupt configuration will not be touched.<p>
But if <span class="emph">PCIBIOS_INTR_GUESS</span> is specified in addition to the <span class="emph">PCI_INTR_FIXUP</span>, and if a PCI interrupt routing table entry indicates that only one IRQ is available for the entry, the IRQ is assumed to be already connected to the device, and corresponding PCI Interrupt Configuration Register will be configured accordingly.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="name">PCIINTR_DEBUG</b></dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
make the <span class="emph">PCI_INTR_FIXUP</span> procedure verbose.</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../../4/cardbus">cardbus(4)</a>, <a class="link-man" href="../../4/pci">pci(4)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="name">pcibios</b> code appeared in <span class="unix">NetBSD&#160;1.5</span>.</div>
<div class="section">
<h1 id="x42554753">BUGS</h1> The <span class="emph">PCIBIOS_ADDR_FIXUP</span> option may conflict with the PCI CardBus driver's own address fixup.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
October 9, 2005</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

