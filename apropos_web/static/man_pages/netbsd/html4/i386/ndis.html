<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../../style.css" type="text/css" media="all">
<title>
NDIS(4) (i386)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
NDIS(4)</td>
<td class="head-vol" align="center">
Kernel Interfaces Manual (i386)</td>
<td class="head-rtitle" align="right">
NDIS(4)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">ndis</b> &#8212; <span class="desc">NDIS miniport driver wrapper</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="config">ndis* at pci? dev ? function ?</b></div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="name">ndis</b> wrapper is designed to allow binary Windows&#174; NDIS miniport network drivers to be used with <span class="unix">NetBSD</span>. The <b class="name">ndis</b> driver is provided in source code form (<i class="file">sys/dev/if_ndis</i>) and must be combined with the Windows&#174; driver binary supplied with your network adapter. The <b class="name">ndis</b> driver uses the ndisapi kernel subsystem to relocate and link the Windows&#174; binary so that it can be used in conjunction with native code. The ndisapi subsystem provides an interface between the NDIS API and the <span class="unix">NetBSD</span> networking infrastructure. The Windows&#174; driver is essentially fooled into thinking it is running on Windows&#174;. Note that this means the <b class="name">ndis</b> driver is only useful on x86 machines.<p>
To build a functional driver, the user must have a copy of the driver distribution media for his or her card. From this distribution, the user must extract two files: the <i class="file">.SYS</i> file containing the driver binary code, and its companion <i class="file">.INF</i> file, which contains the definitions for driver-specific registry keys and other installation data such as device identifiers. These two files are converted into a <i class="file">ndis_driver_data.h</i> file using the <a class="link-man" href="../../8/ndiscvt">ndiscvt(8)</a> utility. The resulting file contains a binary image of the driver plus registry key data. The <i class="file">ndis_driver_data.h</i> is included in several files located in <i class="file">sys/dev/if_ndis</i> so it is needed to compile an NDIS kernel. When the <b class="name">ndis</b> driver is loaded, it will create <a class="link-man" href="../../3/sysctl">sysctl(3)</a> nodes for each registry key extracted from the <i class="file">.INF</i> file.<p>
The <b class="name">ndis</b> wrapper is designed to support mainly Ethernet and wireless network devices/drivers with PCI bus attachments. It can support many different media types and speeds.<p>
One limitation however, is that there is no consistent way to learn if an Ethernet device is operating in full or half duplex mode. The NDIS API allows for a generic means for determining link state and speed, but not the duplex setting. There may be driver-specific registry keys to control the media setting which can be configured via the <a class="link-man" href="../../8/sysctl">sysctl(8)</a> command.</div>
<div class="section">
<h1 id="x4558414d504c4553">EXAMPLES</h1> Assuming you have obtained the appropriate <i class="file">.INF</i> and <i class="file">.SYS</i> files for your device, the <i class="file">ndis_driver_data.h</i> file can be built as follows:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
$ ndiscvt -i your_card.INF -s your_card.SYS -o ndis_driver_data.h</pre>
<p>
Next uncomment the following lines from <i class="file">sys/arch/i386/conf/GENERIC</i><p>
<pre style="margin-left: 5.00ex;" class="lit display">
$ cd /usr/src/sys/arch/i386/conf 
$ cp GENERIC NDIS 
$ vi NDIS 
 . 
 . 
 . 
options         COMPAT_NDIS # NDIS network driver 
 . 
 . 
 . 
ndis*   at pci? dev ? function ? # Experimental - NDIS Network Driver</pre>
<p>
Configure your kernel, then copy the <i class="file">ndis_driver_data.h</i> file into the kernel build directory before compiling the kernel:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
$ cd src/sys/arch/i386/conf 
$ config NDIS 
$ cd ../compile/NDIS 
$ cp /path/to/ndis_driver_data.h . 
$ make depend &amp;&amp; make 
$ su 
$ mv /netbsd /onetbsd 
$ cp netbsd /netbsd 
$ reboot</pre>
<p>
The ndis0 device should be detected at boot:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
Matching vendor: 14e4, product: 4324, name: Dell TrueMobile 1400 Dual Band WLAN Mini-PCI Card 
ndis0 at pci2 dev 3 function 0</pre>
<p>
The device can then be configured with <a class="link-man" href="../../8/ifconfig">ifconfig(8)</a>:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
ndis0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500 
        ssid WWUwireless 
        powersave on (100ms sleep) 
        chan 6 
        address: 00:90:4b:69:94:f0 
        media: IEEE802.11 autoselect 
        status: no network 
        inet 140.160.129.226 netmask 0xfffffc00 broadcast 140.160.131.255 
        inet6 fe80::290:4bff:fe69:94f0%ndis0 prefixlen 64 scopeid 0x3</pre>
<p>
If the <b class="name">ndis</b> driver creates any sysctl nodes, they can be viewed and altered with <a class="link-man" href="../../8/sysctl">sysctl(8)</a>:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
$ sysctl ndis0 
 . 
 . 
 . 
ndis0.ndis_10280001 = Dell TrueMobile 1300 WLAN Mini-PCI Card 
ndis0.ndis_Environment = 1 
ndis0.ndis_NdisVersion = 0x00050001 
ndis0.ndis_BusType = 5 
 . 
 . 
 .</pre>
</div>
<div class="section">
<h1 id="x444941474e4f5354494353">DIAGNOSTICS</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-diag">
<dt class="list-diag" style="margin-top: 1.00em;">
<b class="diag">ndis%d: watchdog timeout</b></dt>
<dd class="list-diag">
A packet was queued for transmission and a transmit command was issued, however the device failed to acknowledge the transmission before a timeout expired.</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../../4/arp">arp(4)</a>, <a class="link-man" href="../../4/netintro">netintro(4)</a>, <a class="link-man" href="../../8/ifconfig">ifconfig(8)</a>, <a class="link-man" href="../../8/ndiscvt">ndiscvt(8)</a><p>
<span class="ref"><span class="ref-title">NDIS 5.1 specification</span>, <a class="link-ref" href="http://www.microsoft.com">http://www.microsoft.com</a>.</span></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="name">ndis</b> driver wrapper first appeared in <span class="unix">FreeBSD&#160;5.3</span> and was ported to <span class="unix">NetBSD&#160;4.0</span>.</div>
<div class="section">
<h1 id="x415554484f5253">AUTHORS</h1> The <b class="name">ndis</b> driver was written by <span class="author">Bill Paul</span> &#60;<a class="link-mail" href="mailto:wpaul@windriver.com">wpaul@windriver.com</a>&#62;. It was ported to <span class="unix">NetBSD</span> by <span class="author">Alan Ritter</span> &#60;<a class="link-mail" href="mailto:rittera@NetBSD.org">rittera@NetBSD.org</a>&#62; with help from <span class="author">Phil Nelson</span> &#60;<a class="link-mail" href="mailto:phil@NetBSD.org">phil@NetBSD.org</a>&#62; as part of Google's Summer of Code 2005.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
December 10, 2003</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

