<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
SI(4)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
SI(4)</td>
<td class="head-vol" align="center">
Kernel Interfaces Manual</td>
<td class="head-rtitle" align="right">
SI(4)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">si</b>, <b class="name">sw</b> &#8212; <span class="desc">NCR 5380 SCSI bus host adaptor driver</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1><div class="subsection">
<h2 id="x73756e33">sun3</h2> <b class="config">si0 at obio0 addr 0x140000 ipl 2</b></div>
<div class="subsection">
<h2 id="x73756e3320616e642073756e3378">sun3 and sun3x</h2> <b class="config">si0 at vme2 addr 0x200000 ipl 2 vect 0x40</b><br>
<b class="config">si1 at vme2 addr 0x204000 ipl 2 vect 0x41</b></div>
<div class="subsection">
<h2 id="x73756e332f45">sun3/E</h2> <b class="config">sebuf0 at vme2 addr 0x300000 ipl 2 vect 0x74 # and 0x75</b><br>
<b class="config">sebuf1 at vme2 addr 0x340000 ipl 2 vect 0x76 # and 0x77</b><br>
<b class="config">si* at sebuf?</b></div>
<div class="subsection">
<h2 id="x73756e3420616e642073756e32">sun4 and sun2</h2> <b class="config">si0 at vme0 addr 0x200000 pri 2 vec 0x40</b></div>
<div class="subsection">
<h2 id="x73756e342f313030">sun4/100</h2> <b class="config">sw0 at obio0 addr 0x0a000000 level 3</b></div>
</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="name">si</b> and <b class="name">sw</b> &#8220;SCSI Weird&#8221; drivers provide support for the NCR 5380 SCSI Bus Controller (SBC) chip found on various Sun Microsystems CPU motherboards (obio), and on the &#8220;Sun-3 VME SCSI&#8221; (Sun part # 501-1236) board used in systems with VME bus.<div class="subsection">
<h2 id="x73756e3320616e642073756e3378">sun3 and sun3x</h2> The sun3 and sun3x version of this driver can be configured with a <span class="emph">flags</span> directive in the <a class="link-man" href="../1/config">config(1)</a> file. The values are bits in a bitfield, and are interpreted as follows:<p>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
0x000ff</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Set bit (1&lt;&lt;target) to disable SCSI disconnect/reselect</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
0x0ff00</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Set bit (1&lt;&lt;(target+8)) to disable SCSI parity checking</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
0x10000</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Set this bit to disable DMA interrupts (poll)</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
0x20000</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Set this bit to disable DMA entirely (use PIO)</dd>
</dl>
<p>
For example: &#8220;flags 0x1000f&#8221; would disable DMA interrupts, and disable disconnect/reselect for targets 0-3. The &#8220;target&#8221; is the SCSI ID number of a particular device on a particular SCSI bus.</div>
<div class="subsection">
<h2 id="x73756e34">sun4</h2> The sun4 version of this driver can also be configured with a <span class="emph">flags</span> directive in the <a class="link-man" href="../1/config">config(1)</a> file. The values are bits in a bitfield, and are interpreted as follows:<p>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
0x01</dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
Use DMA (may be polled)</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
0x02</dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
Use DMA completion interrupts</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
0x04</dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
Allow SCSI disconnect/reselect</dd>
</dl>
<p>
For example: &#8220;flags 0x07&#8221; would enable DMA, interrupts, and reselect. By default, DMA is enabled in the sun4 driver.</div>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../4/cd">cd(4)</a>, <a class="link-man" href="../4/ch">ch(4)</a>, <a class="link-man" href="../4/intro">intro(4)</a>, <a class="link-man" href="../4/scsi">scsi(4)</a>, <a class="link-man" href="../4/sd">sd(4)</a>, <a class="link-man" href="../4/st">st(4)</a></div>
<div class="section">
<h1 id="x415554484f5253">AUTHORS</h1> David Jones, <span class="author">Gordon Ross</span> &#60;gwr@NetBSD.org&#62;, <span class="author">Adam Glass</span> &#60;glass@NetBSD.org&#62;, <span class="author">Jason R. Thorpe</span> &#60;thorpej@NetBSD.org&#62;.</div>
<div class="section">
<h1 id="x42554753">BUGS</h1> The VME variant has a bit to enable or disable the DMA engine, but that bit also gates the interrupt line from the NCR5380 (!!). Therefore, in order to get any interrupt from the NCR5380, (i.e. for reselect) one must clear the DMA engine transfer count and then enable DMA. This has the further complication that you CAN NOT touch the NCR5380 while the DMA enable bit is set, so we have to turn DMA back off before we even look at the NCR5380.<p>
Support for the Sun 4/100 <b class="name">sw</b> &#8220;SCSI Weird&#8221; is not complete. DMA works, but interrupts (and, thus, reselection) don't for reasons unknown. Further progress has halted pending the availability of a machine for testing.<p>
DMA, DMA completion interrupts, and reselection work fine on a Sun 4/260 with modern SCSI-II disks attached. There have been reports of reselection failing on Sun Shoebox-type configurations where there are multiple non-SCSI devices behind Emulex or Adaptec bridges. These devices pre-date the SCSI-I spec, and might not behave the way the NCR5380 code expects. For this reason, only DMA is enabled by default in the sun4 driver.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
May 7, 1998</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

