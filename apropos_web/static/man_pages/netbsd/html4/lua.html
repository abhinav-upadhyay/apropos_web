<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/../4/strict.dtd">
>
<head>
<meta http-equiv="Content-Type" content="te../; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
LUA(4)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
LUA(4)</td>
<td class="head-vol" align="center">
Kernel Interfaces Manual</td>
<td class="head-rtitle" align="right">
LUA(4)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">lua</b> &#8212; <span class="desc">control in-kernel Lua states</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="config">lua*</b><p>
<br>
<b class="includes">#include &lt;<a class="link-includes">sys/types.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">sys/lua.h</a>&gt;</b></div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="name">lua</b> device allows to create, control, and delete Lua states in the kernel through an <a class="link-man" href="../2/ioctl">ioctl(2)</a> interface. Moreover, <b class="name">lua</b> can be used to load Lua scripts into a Lua state and to assign modules to an existing state, i.e. perform the equivalent of the Lua command <span class="emph">require</span>. <b class="name">lua</b> is also used to retrieve information about currently active Lua states.</div>
<div class="section">
<h1 id="x4c5541204d4f44554c4553">LUA MODULES</h1> Lua modules are used to provide functionality to Lua scripts not available in the language itself, e.g. to access core kernel functionality like printing text on the console. Unlike in user space Lua, where Lua modules are files in the filesystem, modules must be provided to <b class="name">lua</b> in the form of loadable kernel modules that register their functionality with <b class="name">lua</b>. Modules are loaded using the <b class="cmd">require</b> Lua command; whether this command is available or not is controlled by a <a class="link-man" href="../8/sysctl">sysctl(8)</a> variable. <b class="name">lua</b> by default tries to load a kernel module named <span class="emph">luafoo.kmod</span> when it encounters the Lua command <span class="emph">require 'foo'</span>.</div>
<div class="section">
<h1 id="x53595343544c205641524941424c4553">SYSCTL VARIABLES</h1> The operation of <b class="name">lua</b> can be controlled by means of the following <a class="link-man" href="../8/sysctl">sysctl(8)</a> variables:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">kern.lua.autoload</span></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
When set to 1, <b class="name">lua</b> tries to autoload kernel modules.<p>
The default value is 1.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">kern.lua.bytecode</span></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
When set to 1, loading of Lua bytecode is allowed.<p>
The default value is 0.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">kern.lua.maxcount</span></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
When set to a value &gt; 0, <b class="name">lua</b> limits the number of instructions executed to this number.<p>
The default value is 0.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">kern.lua.require</span></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
When set to 1, enables the <span class="emph">require</span> command in Lua.<p>
The default value is 1.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">kern.lua.verbose</span></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
When set to a value &gt; 0, verbosity is increased.<p>
The default value is 0.</dd>
</dl>
</div>
<div class="section">
<h1 id="x494f43544c20494e54455246414345">IOCTL INTERFACE</h1> The following structures and constants are defined in the <b class="includes">&lt;<a class="link-includes">sys/lua.h</a>&gt;</b> header file:<p>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">LUAINFO(struct lua_info)</span></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
Returns information about the <b class="name">lua</b> states in the <i class="farg">lua_info</i> structure:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
#define MAX_LUA_NAME		16 
#define MAX_LUA_DESC		64 
 
struct lua_state_info { 
	char	name[MAX_LUA_NAME]; 
	char	desc[MAX_LUA_DESC]; 
	bool	user; 
}; 
 
struct lua_info { 
	int num_states;		/* total number of Lua states */ 
	struct lua_state_info *states; 
};</pre>
<p>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">LUACREATE(struct lua_create)</span></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
Create a new named Lua state with name and description in the <i class="farg">lua_create</i> structure:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
struct lua_create { 
	char	name[MAX_LUA_NAME]; 
	char	desc[MAX_LUA_DESC]; 
};</pre>
<p>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">LUADESTROY(struct lua_create)</span></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
Destroy a named Lua state.<p>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">LUAREQUIRE(struct lua_require)</span></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
Perform the equivalent of the Lua command <span class="emph">require</span> in a named state. The name of the state and of the module name is passed in the <i class="farg">lua_require</i> structure:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
#define LUA_MAX_MODNAME		32 
 
struct lua_require { 
	char	state[MAX_LUA_NAME]; 
	char	module[LUA_MAX_MODNAME]; 
};</pre>
<p>
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="define">LUALOAD(struct lua_load)</span></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
Load Lua code from the filesystem into a named Lua state. The name of the state and the path to the Lua code are passed in the <i class="farg">lua_load</i> structure:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
struct lua_load { 
	char	state[MAX_LUA_NAME]; 
	char	path[MAXPATHLEN]; 
};</pre>
<p>
The path element of the <i class="farg">lua_load</i> structure must contain at least one &#8216;/&#8217; character.</dd>
</dl>
</div>
<div class="section">
<h1 id="x46494c4553">FILES</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
/dev/lua</dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
Lua device file.</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../2/ioctl">ioctl(2)</a>, <a class="link-man" href="../8/luactl">luactl(8)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="name">lua</b> device first appeared in <span class="unix">NetBSD&#160;7.0</span>.</div>
<div class="section">
<h1 id="x415554484f5253">AUTHORS</h1> <span class="author"></span>The <b class="name">lua</b> driver was written by <span class="author">Marc Balmer</span> &#60;<a class="link-mail" href="mailto:mbalmer@NetBSD.org">mbalmer@NetBSD.org</a>&#62;.</div>
<div class="section">
<h1 id="x43415645415453">CAVEATS</h1> The <b class="name">lua</b> device is experimental. Incompatible changes might be made in the future.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
July 25, 2014</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
<>

