<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="/static/man_pages/netbsd/style.css" type="text/css" media="all">
<title>
CD(4)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
CD(4)</td>
<td class="head-vol" align="center">
Kernel Interfaces Manual</td>
<td class="head-rtitle" align="right">
CD(4)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">cd</b> &#8212; <span class="desc">SCSI and ATAPI CD-ROM driver</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="config">cd* at scsibus? target ? lun ?</b><br>
<b class="config">cd1 at scsibus0 target 4 lun 0</b><br>
<b class="config">cd* at atapibus? drive ? flags 0x0000</b></div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="name">cd</b> driver provides support for a Small Computer Systems Interface (SCSI) bus and Advanced Technology Attachment Packet Interface (ATAPI) Compact Disc-Read Only Memory (CD-ROM) drive. In an attempt to look like a regular disk, the <b class="name">cd</b> driver synthesizes a partition table, with one partition covering the entire CD-ROM. It is possible to modify this partition table using <a class="link-man" href="../8/disklabel">disklabel(8)</a>, but it will only last until the CD-ROM is unmounted. In general the interfaces are similar to those described by <a class="link-man" href="../4/wd">wd(4)</a> and <a class="link-man" href="../4/sd">sd(4)</a>.<p>
As the SCSI adapter is probed during boot, the SCSI bus is scanned for devices. Any devices found which answer as `Read-only' type devices will be `attached' to the <b class="name">cd</b> driver.<p>
For the use of flags with ATAPI devices, see <a class="link-man" href="../4/wd">wd(4)</a>.<p>
The system utility <a class="link-man" href="../8/disklabel">disklabel(8)</a> may be used to read the synthesized disk label structure, which will contain correct figures for the size of the CD-ROM should that information be required.</div>
<div class="section">
<h1 id="x4b45524e454c20434f4e46494755524154494f4e">KERNEL CONFIGURATION</h1> Any number of CD-ROM devices may be attached to the system regardless of system configuration as all resources are dynamically allocated.</div>
<div class="section">
<h1 id="x494f43544c53">IOCTLS</h1> The following <a class="link-man" href="../2/ioctl">ioctl(2)</a> calls which apply to SCSI CD-ROM drives are defined in the header files <b class="includes">&lt;<a class="link-includes">sys/cdio.h</a>&gt;</b> and <b class="includes">&lt;<a class="link-includes">sys/disklabel.h</a>&gt;</b>.<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">DIOCGDINFO</span></dt>
<dd class="list-tag" style="margin-left: 19.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">DIOCSDINFO</span></dt>
<dd class="list-tag" style="margin-left: 19.00ex;">
(<code class="lit">struct disklabel</code>) Read or write the in-core copy of the disklabel for the drive. The disklabel is initialized with information read from the SCSI inquiry commands, and should be the same as the information printed at boot. This structure is defined in <a class="link-man" href="../5/disklabel">disklabel(5)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">CDIOCPLAYTRACKS</span></dt>
<dd class="list-tag" style="margin-left: 19.00ex;">
(<code class="lit">struct ioc_play_track</code>) Start audio playback given a track address and length. The structure is defined as follows:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
struct ioc_play_track 
{ 
	u_char	start_track; 
	u_char	start_index; 
	u_char	end_track; 
	u_char	end_index; 
};</pre>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">CDIOCPLAYBLOCKS</span></dt>
<dd class="list-tag" style="margin-left: 19.00ex;">
(<code class="lit">struct ioc_play_blocks</code>) Start audio playback given a block address and length. The structure is defined as follows:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
struct ioc_play_blocks 
{ 
	int	blk; 
	int	len; 
};</pre>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">CDIOCPLAYMSF</span></dt>
<dd class="list-tag" style="margin-left: 19.00ex;">
(<code class="lit">struct ioc_play_msf</code>) Start audio playback given a `minutes-seconds-frames' address and length. The structure is defined as follows:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
struct ioc_play_msf 
{ 
	u_char	start_m; 
	u_char	start_s; 
	u_char	start_f; 
	u_char	end_m; 
	u_char	end_s; 
	u_char	end_f; 
};</pre>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">CDIOCREADSUBCHANNEL</span></dt>
<dd class="list-tag" style="margin-left: 19.00ex;">
(<code class="lit">struct ioc_read_subchannel</code>) Read information from the subchannel at the location specified by this structure:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
struct ioc_read_subchannel { 
	u_char address_format; 
#define CD_LBA_FORMAT	1 
#define CD_MSF_FORMAT	2 
	u_char data_format; 
#define CD_SUBQ_DATA		0 
#define CD_CURRENT_POSITION	1 
#define CD_MEDIA_CATALOG	2 
#define CD_TRACK_INFO		3 
	u_char track; 
	int	data_len; 
	struct  cd_sub_channel_info *data; 
};</pre>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">CDIOREADTOCHEADER</span></dt>
<dd class="list-tag" style="margin-left: 19.00ex;">
(<code class="lit">struct ioc_toc_header</code>) Return summary information about the table of contents for the mounted CD-ROM. The information is returned into the following structure:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
struct ioc_toc_header { 
	u_short len; 
	u_char  starting_track; 
	u_char  ending_track; 
};</pre>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">CDIOREADTOCENTRYS</span></dt>
<dd class="list-tag" style="margin-left: 19.00ex;">
(<code class="lit">struct ioc_read_toc_entry</code>) Return information from the table of contents entries mentioned. (Yes, this command name is misspelled). The argument structure is defined as follows:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
struct ioc_read_toc_entry { 
	u_char	address_format; 
	u_char	starting_track; 
	u_short	data_len; 
	struct  cd_toc_entry *data; 
};</pre>
The requested data is written into an area of size <code class="lit">data_len</code> and pointed to by <code class="lit">data</code>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">CDIOCSETPATCH</span></dt>
<dd class="list-tag" style="margin-left: 19.00ex;">
(<code class="lit">struct ioc_patch</code>) Attach various audio channels to various output channels. The argument structure is defined thusly:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
struct ioc_patch { 
	u_char	patch[4]; 
	/* one for each channel */ 
};</pre>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">CDIOCGETVOL</span></dt>
<dd class="list-tag" style="margin-left: 19.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">CDIOCSETVOL</span></dt>
<dd class="list-tag" style="margin-left: 19.00ex;">
(<code class="lit">struct ioc_vol</code>) Get (set) information about the volume settings of the output channels. The argument structure is as follows:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
struct	ioc_vol 
{ 
	u_char	vol[4]; 
	/* one for each channel */ 
};</pre>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">CDIOCSETMONO</span></dt>
<dd class="list-tag" style="margin-left: 19.00ex;">
Patch all output channels to all source channels.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">CDIOCSETSTEREO</span></dt>
<dd class="list-tag" style="margin-left: 19.00ex;">
Patch left source channel to the left output channel and the right source channel to the right output channel.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">CDIOCSETMUTE</span></dt>
<dd class="list-tag" style="margin-left: 19.00ex;">
Mute output without changing the volume settings.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">CDIOCSETLEFT</span></dt>
<dd class="list-tag" style="margin-left: 19.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">CDIOCSETRIGHT</span></dt>
<dd class="list-tag" style="margin-left: 19.00ex;">
Attach both output channels to the left (right) source channel.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">CDIOCSETDEBUG</span></dt>
<dd class="list-tag" style="margin-left: 19.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">CDIOCCLRDEBUG</span></dt>
<dd class="list-tag" style="margin-left: 19.00ex;">
Turn on (off) debugging for the appropriate device.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">CDIOCPAUSE</span></dt>
<dd class="list-tag" style="margin-left: 19.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">CDIOCRESUME</span></dt>
<dd class="list-tag" style="margin-left: 19.00ex;">
Pause (resume) audio play, without resetting the location of the read-head.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">CDIOCRESET</span></dt>
<dd class="list-tag" style="margin-left: 19.00ex;">
Reset the drive.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">CDIOCSTART</span></dt>
<dd class="list-tag" style="margin-left: 19.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">CDIOCSTOP</span></dt>
<dd class="list-tag" style="margin-left: 19.00ex;">
Tell the drive to spin-up (-down) the CD-ROM.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">CDIOCALLOW</span></dt>
<dd class="list-tag" style="margin-left: 19.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">CDIOCPREVENT</span></dt>
<dd class="list-tag" style="margin-left: 19.00ex;">
Tell the drive to allow (prevent) manual ejection of the CD-ROM disc. Not all drives support this feature.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">CDIOCEJECT</span></dt>
<dd class="list-tag" style="margin-left: 19.00ex;">
Eject the CD-ROM.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">CDIOCLOADUNLOAD</span></dt>
<dd class="list-tag" style="margin-left: 19.00ex;">
Cause the ATAPI changer to load or unload discs.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">CDIOCCLOSE</span></dt>
<dd class="list-tag" style="margin-left: 19.00ex;">
Tell the drive to close its door and load the media. Not all drives support this feature.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">DIOCTUR</span></dt>
<dd class="list-tag" style="margin-left: 19.00ex;">
Test unit ready - to allow userland to silently check for presence of media.</dd>
</dl>
<p>
In addition the general <a class="link-man" href="../4/scsi">scsi(4)</a> ioctls may be used with the <b class="name">cd</b> driver, if used against the `whole disk' partition (i.e. <i class="file">/dev/rcd0d</i> for the bebox and i386 port, <i class="file">/dev/rcd0c</i> for all other ports).</div>
<div class="section">
<h1 id="x4e4f544553">NOTES</h1> When a CD-ROM is changed in a drive controlled by the <b class="name">cd</b> driver, then the act of changing the media will invalidate the disklabel and information held within the kernel. To stop corruption, all accesses to the device will be discarded until there are no more open file descriptors referencing the device. During this period, all new open attempts will be rejected. When no more open file descriptors reference the device, the first next open will load a new set of parameters (including disklabel) for the drive.<p>
The audio code in the <b class="name">cd</b> driver only support SCSI-2 standard audio commands. Because many CD-ROM manufacturers have not followed the standard, there are many CD-ROM drives for which audio will not work. Some work is planned to support some of the more common `broken' CD-ROM drives; however, this is not yet under way.</div>
<div class="section">
<h1 id="x46494c4553">FILES</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/dev/cd[0-9][a-h]</i></dt>
<dd class="list-tag" style="margin-left: 18.00ex;">
block mode CD-ROM devices</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/dev/rcd[0-9][a-h]</i></dt>
<dd class="list-tag" style="margin-left: 18.00ex;">
raw mode CD-ROM devices</dd>
</dl>
</div>
<div class="section">
<h1 id="x444941474e4f5354494353">DIAGNOSTICS</h1> None.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../4/intro">intro(4)</a>, <a class="link-man" href="../4/scsi">scsi(4)</a>, <a class="link-man" href="../4/sd">sd(4)</a>, <a class="link-man" href="../4/wd">wd(4)</a>, <a class="link-man" href="../5/disklabel">disklabel(5)</a>, <a class="link-man" href="../8/disklabel">disklabel(8)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="name">cd</b> driver appeared in 386BSD 0.1.</div>
<div class="section">
<h1 id="x42554753">BUGS</h1> The names of the structures used for the third argument to <b class="fname">ioctl</b>() were poorly chosen, and a number of spelling errors have survived in the names of the <b class="fname">ioctl</b>() commands.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
June 23, 2012</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

