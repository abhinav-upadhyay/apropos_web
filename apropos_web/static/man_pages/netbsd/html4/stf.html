<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
STF(4)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
STF(4)</td>
<td class="head-vol" align="center">
Kernel Interfaces Manual</td>
<td class="head-rtitle" align="right">
STF(4)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">stf</b> &#8212; <span class="desc">6to4 tunnel interface</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="config">pseudo-device stf</b></div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="name">stf</b> interface supports &#8220;6to4&#8221; IPv6 in IPv4 encapsulation. It can tunnel IPv6 traffic over IPv4, as specified in <code class="lit">RFC3056</code>. <b class="name">stf</b> interfaces are dynamically created and destroyed with the <a class="link-man" href="../html8/ifconfig.html">ifconfig(8)</a> <b class="flag">create</b> and <b class="flag">destroy</b> subcommands. Only one <b class="name">stf</b> interface may be created.<p>
For ordinary nodes in 6to4 sites, you do not need a <b class="name">stf</b> interface. The <b class="name">stf</b> interface is only necessary on the site border router (called the &#8220;6to4 router&#8221; in the specification).<p>
Due to the way the 6to4 protocol is specified, <b class="name">stf</b> interfaces require certain configuration to work properly. A single (no more than one) valid 6to4 address needs to be configured on the interface. &#8220;A valid 6to4 address&#8221; is an address which has the following properties. If any of the following properties are not satisfied, <b class="name">stf</b> raises a runtime error on packet transmission. Read the specification for more details.<ul style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-bul">
<li class="list-bul" style="margin-top: 1.00em;">
matches <code class="lit">2002:xxyy:zzuu::/48</code>, where <code class="lit">xxyy:zzuu</code> is the hexadecimal notation of an IPv4 address for the node. The IPv4 address used can be taken from any interface your node has. Since the specification forbids the use of IPv4 private address, the address needs to be a global IPv4 address.</li>
<li class="list-bul" style="margin-top: 1.00em;">
Subnet identifier portion (48th to 63rd bit) and interface identifier portion (lower 64 bits) are properly filled to avoid address collisions.</li>
</ul>
<p>
If you would like the node to behave as a relay router, the prefix length for the IPv6 interface address needs to be 16 so that the node would consider any 6to4 destination as &#8220;on-link&#8221;. If you would like to restrict 6to4 peers to be inside a certain IPv4 prefix, you may want to configure the IPv6 prefix length to be &#8220;16 + IPv4 prefix length&#8221;. The <b class="name">stf</b> interface will check the IPv4 source address on packets if the IPv6 prefix length is larger than 16.<p>
<b class="name">stf</b> can be configured to be ECN (Explicit Congestion Notification) friendly. This can be configured by <span class="define">IFF_LINK1</span>. See <a class="link-man" href="../html4/gif.html">gif(4)</a> for details.<p>
Please note that the 6to4 specification is written as an &#8220;accept tunneled packet from everyone&#8221; tunneling device. By enabling the <b class="name">stf</b> device, you are making it much easier for malicious parties to inject fabricated IPv6 packets to your node. Also, malicious parties can inject IPv6 packets with fabricated source addresses to make your node generate improper tunneled packets. Administrators must be cautious when enabling the interface. To prevent possible attacks, the <b class="name">stf</b> interface filters out the following packets (note that the checks are in no way complete):<ul style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-bul">
<li class="list-bul" style="margin-top: 1.00em;">
Packets with IPv4 unspecified addresses as outer IPv4 source/destination (<code class="lit">0.0.0.0/8</code>)</li>
<li class="list-bul" style="margin-top: 1.00em;">
Packets with the loopback address as outer IPv4 source/destination (<code class="lit">127.0.0.0/8</code>)</li>
<li class="list-bul" style="margin-top: 1.00em;">
Packets with IPv4 multicast addresses as outer IPv4 source/destination (<code class="lit">224.0.0.0/4</code>)</li>
<li class="list-bul" style="margin-top: 1.00em;">
Packets with limited broadcast addresses as outer IPv4 source/destination (<code class="lit">255.0.0.0/8</code>)</li>
<li class="list-bul" style="margin-top: 1.00em;">
Packets with private addresses as outer IPv4 source/destination (<code class="lit">10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16</code>)</li>
<li class="list-bul" style="margin-top: 1.00em;">
Packets with IPv4 link-local addresses as outer IPv4 source/destination (<code class="lit">169.254.0.0/16</code>)</li>
<li class="list-bul" style="margin-top: 1.00em;">
Packets with subnet broadcast addresses as outer IPv4 source/destination. The check is made against subnet broadcast addresses for all of the directly connected subnets.</li>
<li class="list-bul" style="margin-top: 1.00em;">
Packets that do not pass ingress filtering. Outer IPv4 source addresses must meet the IPv4 topology on the routing table. Ingress filtering can be turned off by <span class="define">IFF_LINK2</span> bit.</li>
<li class="list-bul" style="margin-top: 1.00em;">
The same set of rules are applied against the IPv4 address embedded into the inner IPv6 address, if the IPv6 address matches the 6to4 prefix.</li>
<li class="list-bul" style="margin-top: 1.00em;">
Packets with site-local or link-local unicast addresses as inner IPv6 source/destination</li>
<li class="list-bul" style="margin-top: 1.00em;">
Packets with node-local or link-local multicast addresses as inner IPv6 source/destination</li>
</ul>
<p>
It is recommended to filter/audit incoming IPv4 packets with IP protocol number 41, as necessary. It is also recommended to filter/audit encapsulated IPv6 packets as well. You may also want to run normal ingress filtering against inner IPv6 addresses to avoid spoofing.<p>
By setting the <span class="define">IFF_LINK0</span> flag on the <b class="name">stf</b> interface, it is possible to disable the input path, making direct attacks from the outside impossible. Note, however, that other security risks exist. If you wish to use the configuration, you must not advertise your 6to4 addresses to others.</div>
<div class="section">
<h1 id="x4558414d504c4553">EXAMPLES</h1> Note that <code class="lit">8504:0506</code> is equal to <code class="lit">133.4.5.6</code>, written in hexadecimal.<p>
<pre style="margin-left: 0.00ex;" class="lit display">
# ifconfig ne0 inet 133.4.5.6 netmask 0xffffff00 
# ifconfig stf0 create inet6 2002:8504:0506:0000:a00:5aff:fe38:6f86 \ 
	prefixlen 16 alias</pre>
<p>
The following configuration accepts packets from IPv4 source address <code class="lit">9.1.0.0/16</code> only. It emits 6to4 packets only for IPv6 destination 2002:0901::/32 (IPv4 destination will match <code class="lit">9.1.0.0/16</code>).<p>
<pre style="margin-left: 0.00ex;" class="lit display">
# ifconfig ne0 inet 9.1.2.3 netmask 0xffff0000 
# ifconfig stf0 create inet6 2002:0901:0203:0000:a00:5aff:fe38:6f86 \ 
	prefixlen 32 alias</pre>
<p>
The following configuration uses the <b class="name">stf</b> interface as an output-only device. You need to have alternative IPv6 connectivity (other than 6to4) to use this configuration. For outbound traffic, you can reach other 6to4 networks efficiently via <b class="name">stf</b>. For inbound traffic, you will not receive any 6to4-tunneled packets (less security drawbacks). Be careful not to advertise your 6to4 prefix to others (<code class="lit">2002:8504:0506::/48</code>), and not to use your 6to4 prefix as a source address.<p>
<pre style="margin-left: 0.00ex;" class="lit display">
# ifconfig ne0 inet 133.4.5.6 netmask 0xffffff00 
# ifconfig stf0 create inet6 2002:8504:0506:0000:a00:5aff:fe38:6f86 \ 
	prefixlen 16 alias deprecated link0 
# route add -inet6 2002:: -prefixlen 16 ::1 -ifp stf0</pre>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html4/gif.html">gif(4)</a>, <a class="link-man" href="../html4/inet.html">inet(4)</a>, <a class="link-man" href="../html4/inet6.html">inet6(4)</a><p>
<p>
<span class="ref"><span class="ref-auth">Brian Carpenter</span> and <span class="ref-auth">Keith Moore</span>, <span class="ref-title">Connection of IPv6 Domains via IPv4 Clouds</span>, <span class="ref-rep">RFC</span>, <span class="ref-num">3056</span>, <span class="ref-date">February 2001</span>.</span><p>
<span class="ref"><span class="ref-auth">C. Huitema</span>, <span class="ref-title">An Anycast Prefix for 6to4 Relay Routers</span>, <span class="ref-rep">RFC</span>, <span class="ref-num">3068</span>, <span class="ref-date">June 2001</span>.</span><p>
<span class="ref"><span class="ref-auth">F. Baker</span> and <span class="ref-auth">P. Savola</span>, <span class="ref-title">Ingress Filtering for Multihomed Networks</span>, <span class="ref-rep">RFC</span>, <span class="ref-num">3704</span>, <span class="ref-date">March 2004</span>.</span><p>
<span class="ref"><span class="ref-auth">P. Savola</span> and <span class="ref-auth">C. Patel</span>, <span class="ref-title">Security Considerations for 6to4</span>, <span class="ref-rep">RFC</span>, <span class="ref-num">3964</span>, <span class="ref-date">December 2004</span>.</span><p>
<span class="ref"><span class="ref-auth">Jun-ichiro itojun Hagino</span>, <span class="ref-title">Possible abuse against IPv6 transition technologies</span>, <span class="ref-num">draft-itojun-ipv6-transition-abuse-01.txt</span>, <span class="ref-date">July 2000</span>, <span class="ref-opt">expired, work in progress</span>.</span></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="name">stf</b> device first appeared in WIDE/KAME IPv6 stack.</div>
<div class="section">
<h1 id="x42554753">BUGS</h1> No more than one <b class="name">stf</b> interface is allowed for a node, and no more than one IPv6 interface address is allowed for an <b class="name">stf</b> interface. This is to avoid source address selection conflicts between the IPv6 layer and the IPv4 layer, and to cope with ingress filtering rules on the other side. This is a feature to make <b class="name">stf</b> work right for all occasions.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
January 2, 2011</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

