<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="/static/man_pages/netbsd/style.css" type="text/css" media="all">
<title>
VIDEO(4)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
VIDEO(4)</td>
<td class="head-vol" align="center">
Kernel Interfaces Manual</td>
<td class="head-rtitle" align="right">
VIDEO(4)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">video</b> &#8212; <span class="desc">device-independent video driver layer</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">sys/videoio.h</a>&gt;</b></div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="name">video</b> driver provides support for various video peripherals. It provides a uniform programming interface layer above different underlying video hardware drivers. The video layer provides a Video4Linux2 compatible API. A number of <a class="link-man" href="../2/ioctl">ioctl(2)</a> commands are supported controlling the device.<p>
The device file for video operation is <i class="file">/dev/video</i>.</div>
<div class="section">
<h1 id="x52454144494e4720564944454f2053414d504c4553">READING VIDEO SAMPLES</h1> Video data is separated into logical video samples which will typically be one complete video frame. With compressed formats, a video sample may be one logical chunk and not one complete frame depending on the compression format. Video samples may be read from <i class="file">/dev/video</i> in one of several different modes.<p>
In read mode, calls to <a class="link-man" href="../2/read">read(2)</a> will return at most the data of one video sample. If the entire sample is not read, then subsequent reads will return at most the remaining data in that video sample.<p>
Video samples may be mapped into memory with <a class="link-man" href="../2/mmap">mmap(2)</a>. The driver allocates internal buffers for a number of video samples which are mapped into memory. Initiating this mode requires several <a class="link-man" href="../2/ioctl">ioctl(2)</a> commands: <span class="define">VIDIOC_REQBUFS</span> to request the driver reserve buffers, <span class="define">VIDIOC_QUERYBUF</span> to query the details of each buffer, <a class="link-man" href="../2/mmap">mmap(2)</a> to map each buffer into memory, <span class="define">VIDIOC_QBUF</span> to queue the buffers for receiving video data, <span class="define">VIDIOC_STREAMON</span> to begin streaming of video data, and <span class="define">VIDIOC_DQBUF</span> to remove a filled buffer from the queue. At this point the video data from the dequeued buffer is valid.</div>
<div class="section">
<h1 id="x444556494345204341504142494c4954494553">DEVICE CAPABILITIES</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">VIDIOC_QUERYCAP (struct v4l2_capability)</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This command queries the capabilities of the device. The first three fields are informational NULL terminated strings filled by the driver: <b class="var">driver</b> describes the driver used by this device, <b class="var">card</b> describes the video capture card or camera, and <b class="var">buf_info</b> represents the bus to which the hardware device is attached.<p>
The <b class="var">capabilities</b> field contains a number of flags indicating various features supported by the driver or hardware:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">V4L2_CAP_VIDEO_CAPTURE</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
support video capturing</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">V4L2_CAP_READWRITE</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
supports the <a class="link-man" href="../2/read">read(2)</a> and/or <a class="link-man" href="../2/write">write(2)</a> mode</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">V4L2_CAP_STREAMING</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
supports <a class="link-man" href="../2/mmap">mmap(2)</a> mode</dd>
</dl>
<p>
<pre style="margin-left: 0.00ex;" class="lit display">
struct v4l2_capability { 
	uint8_t		driver[16]; 
	uint8_t		card[32]; 
	uint8_t		bus_info[32]; 
	uint32_t	version; 
	uint32_t	capabilities; 
	uint32_t	reserved[4]; 
};</pre>
</dd>
</dl>
</div>
<div class="section">
<h1 id="x53545245414d494e4720494e54455246414345">STREAMING INTERFACE</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">VIDIOC_REQBUFS (struct v4l2_requestbuffers)</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This command requests that the driver reserve space for <b class="var">count</b> samples. <b class="var">type</b> must be set to <span class="define">V4L2_BUF_TYPE_VIDEO_CAPTURE</span> and <b class="var">memory</b> to <span class="define">V4L2_MEMORY_MMAP</span>. The returned <b class="var">count</b> represents the actual number of samples reserved which may be more or fewer than requested.<p>
<pre style="margin-left: 0.00ex;" class="lit display">
struct v4l2_requestbuffers { 
	uint32_t		count; 
	enum v4l2_buf_type	type; 
	enum v4l2_memory	memory; 
	uint32_t		reserved[2]; 
};</pre>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">VIDIOC_QUERYBUF (struct v4l2_buffer)</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This command should be called for each buffer in <b class="var">count</b> above. The fields <b class="var">index</b>, <b class="var">type</b>, and <b class="var">memory</b> must be set to a valid index from 0 to <b class="var">count-1</b>, and the same type and memory as used in <span class="define">VIDIOC_QUERYBUF</span>. The driver returns <b class="var">m.offset</b> and <b class="var">length</b>.<p>
<pre style="margin-left: 0.00ex;" class="lit display">
struct v4l2_buffer { 
	uint32_t		index; 
	enum v4l2_buf_type	type; 
	uint32_t		bytesused; 
	uint32_t		flags; 
	enum v4l2_field		field; 
	struct timeval		timestamp; 
	struct v4l2_timecode	timecode; 
	uint32_t		sequence; 
	enum v4l2_memory	memory; 
	union { 
		uint32_t	offset; 
		unsigned long	userptr; 
	} m; 
	uint32_t		length; 
	uint32_t		input; 
	uint32_t		reserved; 
};</pre>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<a class="link-man" href="../2/mmap">mmap(2)</a></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Each buffer must be mapped with a call to <a class="link-man" href="../2/mmap">mmap(2)</a>, passing the <b class="var">length</b> and <b class="var">m.offset</b> values obtained above. The prot <span class="define">PROT_READ|PROT_WRITE</span> and flags <span class="define">MAP_SHARED</span> are recommended.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">VIDIOC_QBUF (struct v4l2_buffer)</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This command indicates to the driver that the buffer is ready to receive a video sample. The following fields must be set: <b class="var">index</b>, set to a valid buffer index from 0 to <b class="var">count</b> &#45; 1; <b class="var">type</b>, set to the same type used above; and <b class="var">memory</b>, set to the same memory used above. Each buffer should be queued with this command. Order is not important.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">VIDIOC_STREAMON (int)</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This command starts streaming. Queued buffers will be filled with data. <a class="link-man" href="../2/select">select(2)</a> will indicate that a buffer is done and available for reading.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">VIDIOC_DQBUF (struct v4l2_buffer)</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This command dequeues an available buffer from the driver. If no buffer is available, it blocks until one is, unless <span class="define">O_NONBLOCK</span> was specified to <a class="link-man" href="../2/open">open(2)</a>, in which case it returns <span class="errno">EAGAIN</span>. <a class="link-man" href="../2/select">select(2)</a>, or <a class="link-man" href="../2/poll">poll(2)</a> prior to initiating any other mode will begin streaming of video for reading with <a class="link-man" href="../2/read">read(2)</a>. In this streaming mode <a class="link-man" href="../2/select">select(2)</a> or <a class="link-man" href="../2/poll">poll(2)</a> indicate the availability of a video frame. Calls to <a class="link-man" href="../2/read">read(2)</a> will return at most the video data of one video sample. If the entire sample is not read, then subsequent reads will return at most the remaining data in that video sample.</dd>
</dl>
</div>
<div class="section">
<h1 id="x46494c4553">FILES</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/dev/video</i></dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../4/auvitek">auvitek(4)</a>, <a class="link-man" href="../4/pseye">pseye(4)</a>, <a class="link-man" href="../4/uvideo">uvideo(4)</a>, <a class="link-man" href="../9/video">video(9)</a><p>
<a class="link-ext" href="http://v4l2spec.bytesex.org/">V4L2 API Specification</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="name">video</b> device driver first appeared in <span class="unix">NetBSD&#160;5.0</span>.</div>
<div class="section">
<h1 id="x415554484f5253">AUTHORS</h1> <span class="author">Patrick Mahoney</span> &#60;<a class="link-mail" href="mailto:pat@polycrystal.org">pat@polycrystal.org</a>&#62;</div>
<div class="section">
<h1 id="x42554753">BUGS</h1> Does not support the complete V4L2 API. Only supports the capture interface. Does not support writing, overlay, VBI, tuner, audio, radio, or asyncio.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
March 5, 2011</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

