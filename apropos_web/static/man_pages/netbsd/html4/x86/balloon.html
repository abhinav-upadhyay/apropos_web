<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="..//static/man_pages/netbsd/style.css" type="text/css" media="all">
<title>
BALLOON(4) (Xen)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
BALLOON(4)</td>
<td class="head-vol" align="center">
Kernel Interfaces Manual (Xen)</td>
<td class="head-rtitle" align="right">
BALLOON(4)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">balloon</b> &#8212; <span class="desc">Xen memory balloon driver</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="config">balloon* at xenbus?</b></div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="name">balloon</b> driver supports the memory ballooning operations offered in Xen environments. It allows shrinking or extending a domain's available memory by passing pages between different domains. At any time, the total memory available to a domain is called the ``reservation''.<p>
Pages are moved via the use of the balloon, a reserved quantity of memory available to all domains that can be freely deflated (or inflated) at a domain's will. Deflating balloon means that pages are moved out from it, and bound to domain's virtual memory. Respectively, inflating balloon indicates that pages are moved out of domain's memory and pushed inside balloon. This is similar to a dynamic allocation of wired physical memory, except that the pages are not available to domain anymore.<p>
Any domain is free to request memory from <b class="name">balloon</b> up to the maximum value set by the host's administrator through the <b class="cmd">mem-max</b> command of <a class="link-man" href="../../1/xm">xm(1)</a>. Alternatively, the host's administrator is free to request to a particular domain to give some memory back. This command requires the targeted domain's cooperation and requires <b class="name">balloon</b> support within it. This can be done through the <b class="cmd">mem-set</b> command of <a class="link-man" href="../../1/xm">xm(1)</a>. Alternatively, one can control the ballooning directly by writing under the &#8220;memory/target&#8221; node inside Xenstore. This entry controls the target memory reservation of a given domain, indicated in kilobytes (KiB).<p>
An interface to control <b class="name">balloon</b> is also available through <a class="link-man" href="../../8/sysctl">sysctl(8)</a> under &#8220;machdep.xen.balloon&#8221; (all values being in kilobytes):<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
current</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
(read-only) The current memory reservation of the domain.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
min</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
(read-write) The minimum reservation value acceptable by the domain's <b class="name">balloon</b> driver. Any request that would require domain to reduce its reservation below this threshold will be refused by the driver. This can be used by a domain's administrator to control the number of memory pages that will be kept available to domain.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
max</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
(read-only) The maximum reservation accessible to a domain. Its value can only be changed by the dom0's administrator, through the <b class="cmd">mem-max</b> command of <a class="link-man" href="../../1/xm">xm(1)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
target</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
(read-write) The target reservation of the domain. This entry serves the same purpose as the &#8220;memory/target&#8221; entry in Xenstore. This controls the targeted number of pages that the domain should have. Note that this is only a target, and may not be achieved for a variety of reasons.</dd>
</dl>
</div>
<div class="section">
<h1 id="x444941474e4f5354494353">DIAGNOSTICS</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-diag">
<dt class="list-diag" style="margin-top: 1.00em;">
<b class="diag">WARNING: balloon could not reach target %zu (current %zu)</b></dt>
<dd class="list-diag">
<b class="name">balloon</b> failed to reach the target reservation. This is typically due to a target set too low; the kernel prevented memory exhaustion by refusing further allocation.</dd>
<dt class="list-diag" style="margin-top: 1.00em;">
<b class="diag">increase reservation incomplete: was %zu, returned %d</b></dt>
<dd class="list-diag">
The hypervisor only gave a partial set of memory pages to domain. This happens when host's memory consumption is high, and hypervisor is unable to give enough free pages back to domain.</dd>
<dt class="list-diag" style="margin-top: 1.00em;">
<b class="diag">memory 'hot-plug' unsupported - clipping reservation %zu =&gt; %zu pages.</b></dt>
<dd class="list-diag">
An attempt was made by domain to get more memory than initially obtained during boot. As physical memory pages cannot be added to memory management sub-system dynamically, <b class="name">balloon</b> will limit reservation up to the maximum value it can handle.</dd>
</dl>
</div>
<div class="section">
<h1 id="x4552524f5253">ERRORS</h1> When setting the minimum threshold or target reservation entries through &#8220;machdep.xen.balloon&#8221;, the following errors can be returned:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EPERM</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The value passed is beyond limits. The new value is either too low (&#8220;min&#8221; is below driver's safeguard value, or &#8220;target&#8221; is below minimum value), or too high (&#8220;target&#8221; is above maximum value).</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../../1/xm">xm(1)</a>, <a class="link-man" href="../../4/xenbus">xenbus(4)</a>, <a class="link-man" href="../../9/uvm">uvm(9)</a><p>
<span class="ref"><span class="ref-auth">Carl A. Waldspurger</span>, <span class="ref-title">Memory Resource Management in VMware ESX Server</span>, <i class="ref-book">Proceedings of the 5th Symposium on Operating Systems Design and Implementation</i>, <i class="ref-issue">USENIX Association</i>, <a class="link-ref" href="http://www.usenix.org/events/osdi02/tech/full_papers/waldspurger/waldspurger.pdf">http://www.usenix.org/events/osdi02/tech/full_papers/waldspurger/waldspurger.pdf</a>, <span class="ref-date">December 9-11, 2002</span>.</span></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="name">balloon</b> driver first appeared in <span class="unix">NetBSD&#160;6.0</span>.</div>
<div class="section">
<h1 id="x415554484f5253">AUTHORS</h1> <span class="author"></span>The <b class="name">balloon</b> driver was written by <span class="author">Cherry G. Mathew</span> &#60;<a class="link-mail" href="mailto:cherry@NetBSD.org">cherry@NetBSD.org</a>&#62; and <span class="author">Jean-Yves Migeon</span> &#60;<a class="link-mail" href="mailto:jym@NetBSD.org">jym@NetBSD.org</a>&#62;.</div>
<div class="section">
<h1 id="x42554753">BUGS</h1> There are a number of reasons why a domain may not attain the targeted memory reservation: <b class="name">balloon</b> can be empty and cannot be collapsed further, domain may not have enough free memory pages (due to memory fragmentation, memory exhaustion, ...) so it cannot give enough back to <b class="name">balloon</b>.<p>
Currently, the virtual memory sub-system of <span class="unix">NetBSD</span> is not capable of ``hot-plugging'' new memory pages into place. This means that increasing a domain's memory reservation above its initial maximum value is pointless, as new memory pages cannot be consumed by the memory management sub-system.<p>
Over expanding <b class="name">balloon</b> generates high kernel memory pressure. While the driver tries to stay as conservative as possible to avoid crashes, a very low memory reservation will lead to unwanted swap or even <b class="fname">panic</b>().</div>
<div class="section">
<h1 id="x534543555249545920434f4e53494445524154494f4e53">SECURITY CONSIDERATIONS</h1> Ballooning involves moving pages between different domains. This includes their content, which can lead to information leak. If you are running domains of different sensitivities on the same host, consider disabling the use of ballooning altogether. The <span class="unix">NetBSD</span> kernel zeroes all pages before relinquishing them to <b class="name">balloon</b> but this may not be the case for other operating systems.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
July 30, 2011</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

