<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
MK48TXX(4)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
MK48TXX(4)</td>
<td class="head-vol" align="center">
Kernel Interfaces Manual</td>
<td class="head-rtitle" align="right">
MK48TXX(4)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">mk48txx</b> &#8212; <span class="desc">Mostek time-of-day clock driver</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">dev/ic/mk48txxreg.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">dev/ic/mk48txxvar.h</a>&gt;</b><p>
<b class="config">define mk48txx</b><br>
<b class="config">file   dev/ic/mk48txx.c    mk48txx</b></div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="name">mk48txx</b> driver provides access to several models of Mostek time-of-day clock chips. Access methods to retrieve and set date and time are provided through the <span class="emph">TODR</span> interface defined in <a class="link-man" href="../9/todr">todr(9)</a>.<p>
To tie an instance of this device to the system, use the <b class="fname">mk48txx_attach</b>() function and the mk48txx_softc structure defined as follows:<p>
<i class="ftype">void</i> <b class="fname">mk48txx_attach</b>(<i class="farg">struct mk48txx_softc *</i>)<p>
<pre style="margin-left: 0.00ex;" class="lit display">
typedef uint8_t (*mk48txx_nvrd_t)(struct mk48txx_softc *, int off); 
typedef void (*mk48txx_nvwr_t)(struct mk48txx_softc *, int off, 
    uint8_t datum);</pre>
<p>
<pre style="margin-left: 0.00ex;" class="lit display">
struct mk48txx_softc { 
	struct device   sc_dev; 
	bus_space_tag_t sc_bst; 
	bus_space_handle_t sc_bsh; 
	struct todr_chip_handle sc_handle; 
	const char	*sc_model; 
	bus_size_t	sc_nvramsz; 
	bus_size_t	sc_clkoffset; 
	u_int		sc_year0; 
	u_int		sc_flag; 
	mk48txx_nvrd_t	sc_nvrd; 
	mk48txx_nvwr_t	sc_nvwr; 
};</pre>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">sc_bst</i></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">sc_bsh</i></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Specify bus space access to the chip's non-volatile memory (including the clock registers).</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">sc_handle</i></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
TODR handle passed to the <b class="fname">todr_attach</b>() function to register <a class="link-man" href="../9/todr">todr(9)</a> interface.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">sc_model</i></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
The chip model which this instance should serve. Must be one of &#8220;mk48t02&#8221;, &#8220;mk48t08&#8221;, &#8220;mk48t18&#8221;, or &#8220;mk48t59&#8221;.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">sc_nvramsz</i></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Size of non-volatile RAM in the Mostek chip. This value is set by <b class="fname">mk48txx_attach</b>().</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">sc_clkoffset</i></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Offset into the control registers of the Mostek chip. This value is set by <b class="fname">mk48txx_attach</b>().</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">sc_year0</i></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
The actual year represented by the clock's &#8216;year&#8217; counter. This is generally dependent on the system configuration in which the clock device is mounted. For instance, on Sun Microsystems machines the convention is to have clock's two-digit year represent the year 1968.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">sc_flag</i></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
This flag is used to specify machine-dependent features.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">sc_nvread</i></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">sc_nvwrite</i></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Specify alternate access methods for reading resp. writing clock device registers. The default, when <span class="define">NULL</span> is passed as an access method, is to access the chip memory (and clock registers) as if they were direct-mapped with using the specified bus space.<p>
Otherwise, the driver will call the respective function to perform the access, passing it the specified bus space and the offset <b class="var">off</b> of the chip memory (or clock register) location to be read from or written to, respectively.</dd>
</dl>
<p>
Note that if the resulting date retrieved with the todr_gettime() method is earlier that January 1, 1970, the driver will assume that the chip's year counter actually represents a year in the 21st century. This behaviour can be overridden by setting the <b class="var">MK48TXX_NO_CENT_ADJUST</b> flag in <i class="farg">sc_flag</i>.</div>
<div class="section">
<h1 id="x4841524457415245">HARDWARE</h1> The following models are supported:<p>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
Mostek MK48T02</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
Mostek MK48T08</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
Mostek MK48T18</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
Mostek MK48T59</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../4/intro">intro(4)</a>, <a class="link-man" href="../9/todr">todr(9)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="name">mk48txx</b> driver first appeared in <span class="unix">NetBSD&#160;1.5</span>.</div>
<div class="section">
<h1 id="x415554484f5253">AUTHORS</h1> The <b class="name">mk48txx</b> driver was written by <span class="author">Paul Kranenburg</span> &#60;pk@NetBSD.org&#62;.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
October 1, 2006</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

