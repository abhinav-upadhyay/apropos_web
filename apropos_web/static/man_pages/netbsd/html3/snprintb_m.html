<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
SNPRINTB(3)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
SNPRINTB(3)</td>
<td class="head-vol" align="center">
Library Functions Manual</td>
<td class="head-rtitle" align="right">
SNPRINTB(3)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">snprintb</b> &#8212; <span class="desc">bitmask output conversion</span></div>
<div class="section">
<h1 id="x4c494252415259">LIBRARY</h1> <span class="lib">System Utilities Library (libutil, &#45;lutil)</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">util.h</a>&gt;</b><p>
<i class="ftype">int</i><br>
<b class="fname">snprintb</b>(<i class="farg" style="white-space:nowrap;">char *buf</i>, <i class="farg" style="white-space:nowrap;">size_t buflen</i>, <i class="farg" style="white-space:nowrap;">const char *fmt</i>, <i class="farg" style="white-space:nowrap;">uint64_t val</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">snprintb_m</b>(<i class="farg" style="white-space:nowrap;">char *buf</i>, <i class="farg" style="white-space:nowrap;">size_t buflen</i>, <i class="farg" style="white-space:nowrap;">const char *fmt</i>, <i class="farg" style="white-space:nowrap;">uint64_t val</i>, <i class="farg" style="white-space:nowrap;">size_t max</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="fname">snprintb</b>() function formats a bitmask into a mnemonic form suitable for printing.<p>
This conversion is useful for decoding bit fields in device registers. It formats the integer <i class="farg">val</i> into the buffer <i class="farg">buf</i>, of size <i class="farg">buflen</i>, using a specified radix and an interpretation of the bits within that integer as though they were flags. The buffer is always NUL-terminated. If the buffer <i class="farg">buf</i> is too small to hold the formatted output, <b class="fname">snprintb</b>() will fill as much as it can, and return the number of bytes that would have written if the buffer was long enough excluding the terminating NUL.<p>
The decoding directive string <i class="farg">fmt</i> describes how the bitfield is to be interpreted and displayed. It follows two possible syntaxes, referred to as &#8220;old&#8221; and &#8220;new&#8221;. The main advantage of the &#8220;new&#8221; formatting is that it is capable of handling multi-bit fields.<p>
The first character of <i class="farg">fmt</i> may be <code class="lit">&#92;177</code>, indicating that the remainder of the format string follows the &#8220;new&#8221; syntax. The second character (the first for the old format) is a binary character representation of the output numeral base in which the bitfield will be printed before it is decoded. Recognized radix values (in C escape-character format) are <code class="lit">&#92;10</code> (octal), <code class="lit">&#92;12</code> (decimal), and <code class="lit">&#92;20</code> (hexadecimal).<p>
The remaining characters in <i class="farg">fmt</i> are interpreted as a list of bit-position&#8211;description pairs. From here the syntaxes diverge.<p>
The &#8220;old&#8221; format syntax is series of bit-position&#8211;description pairs. Each begins with a binary character value that represents the position of the bit being described. A bit position value of one describes the least significant bit. Whereas a position value of 32 (octal 40, hexadecimal 20, the ASCII space character) describes the most significant bit.<p>
The remaining characters in a bit-position&#8211;description pair are the characters to print should the bit being described be set. Description strings are delimited by the next bit position value character encountered (distinguishable by its value being &#8804; 32), or the end of the decoding directive string itself.<p>
For the &#8220;new&#8221; format syntax, a bit-position&#8211;description begins with a field type followed by a binary bit-position and possibly a field length. The least significant bit is bit-position zero, unlike the &#8220;old&#8221; syntax where it is one.<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">b&#92;B</b></dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
Describes a bit position. The bit-position <i class="farg">B</i> indicates the corresponding bit, as in the &#8220;old&#8221; format.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">f&#92;B&#92;L</b></dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
Describes a multi-bit field beginning at bit-position <i class="farg">B</i> and having a bit-length of <i class="farg">L</i>. The remaining characters are printed as a description of the field followed by &#8216;=&#8217; and the value of the field. The value of the field is printed in the base specified as the second character of the decoding directive string <i class="arg">fmt</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">F&#92;B&#92;L</b></dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
Describes a multi-bit field like &#8216;f&#8217;, but just extracts the value for use with the &#8216;=&#8217; and &#8216;:&#8217; formatting directives described below.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">=&#92;V</b></dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
The field previously extracted by the last &#8216;f&#8217; or &#8216;F&#8217; operator is compared to the byte &#8216;<b class="flag">V</b>&#8217; (for values 0 through 255). If they are equal, &#8216;=&#8217; followed by the string following &#8216;<b class="flag">V</b>&#8217; is printed. This and the &#8216;:&#8217; operator may be repeated to annotate multiple possible values.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">:&#92;V</b></dt>
<dd class="list-tag" style="margin-left: 5.00ex;">
Operates like the &#8216;=&#8217; operator, but omits the leading &#8216;=&#8217;.</dd>
</dl>
<p>
Finally, each field is delimited by a NUL (&#8216;&#92;0&#8217;) character. By convention, the format string has an additional NUL character at the end, following that delimiting the last bit-position&#8211;description pair.<p>
The <b class="fname">snprintb_m</b>() function accepts an additional <i class="farg">max</i> argument. If this argument is zero, the <b class="fname">snprintb_m</b>() function returns exactly the same results in the <i class="farg">buf</i> as the <b class="fname">snprintb</b>() function. If the <i class="farg">max</i> argument is present and has a non-zero value, it represents the maximum length of a formatted string. If the formatted string would require more than <i class="farg">max</i> characters, the <b class="fname">snprintb_m</b>() function returns multiple formatted strings in the output buffer <i class="farg">buf</i>. Each string is NUL-terminated, and the last string is followed by an additional NUL character (or, if you prefer, a zero-length string).</div>
<div class="section">
<h1 id="x52455455524e2056414c554553">RETURN VALUES</h1> The <b class="fname">snprintb</b>() and <b class="fname">snprintb_m</b>() functions return the number of bytes that would have written to the buffer if there was adequate space, excluding the final terminating NUL, or &#45;1 in case an error occurred. For <b class="fname">snprintb_m</b>(), the NUL characters terminating each individual string are included in the total number of bytes.</div>
<div class="section">
<h1 id="x4558414d504c4553">EXAMPLES</h1> Two examples of the old formatting style:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
snprintb(buf, buflen, "&#92;10&#92;2BITTWO&#92;1BITONE", 3) 
&#8658; "03&lt;BITTWO,BITONE&gt;" 
 
snprintb(buf, buflen, 
       "&#92;20&#92;x10NOTBOOT&#92;x0f" "FPP&#92;x0eSDVMA&#92;x0cVIDEO" 
       "&#92;x0bLORES&#92;x0a" "FPA&#92;x09" "DIAG&#92;x07" "CACHE" 
       "&#92;x06IOCACHE&#92;x05LOOPBACK&#92;x04" "DBGCACHE", 
       0xe860) 
&#8658; "0xe860&lt;NOTBOOT,FPP,SDVMA,VIDEO,CACHE,IOCACHE&gt;"</pre>
<p>
An example of the new formatting style:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
snprintb(buf, buflen, 
       "&#92;177&#92;020b&#92;0LSB&#92;0b&#92;1_BITONE&#92;0f&#92;4&#92;4NIBBLE2&#92;0" 
       "f&#92;x10&#92;4BURST&#92;0=&#92;4FOUR&#92;0=&#92;xfSIXTEEN&#92;0" 
       "b&#92;x1fMSB&#92;0&#92;0", 
       0x800f0701) 
&#8658; "0x800f0701&lt;LSB,NIBBLE2=0x0,BURST=0xf=SIXTEEN,MSB&gt;"</pre>
<p>
An example using snprintb_m:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
snprintb_m(buf, buflen, 
       "&#92;177&#92;020b&#92;0LSB&#92;0b&#92;1_BITONE&#92;0f&#92;4&#92;4NIBBLE2&#92;0" 
       "f&#92;x10&#92;4BURST&#92;0=&#92;4FOUR&#92;0=&#92;xfSIXTEEN&#92;0" 
       "b&#92;x1fMSB&#92;0&#92;0", 
       0x800f0701, 34) 
&#8658; "0x800f0701&lt;LSB,NIBBLE2=0x0&gt;&#92;00x800f0701&lt;BURST=0xf=SIXTEEN,MSB&gt;&#92;0"</pre>
</div>
<div class="section">
<h1 id="x4552524f5253">ERRORS</h1> <b class="fname">snprintb</b>() will fail if:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EINVAL</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The leading character does not describe a supported format, or <b class="fname">snprintf</b>() failed.</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../3/printf">printf(3)</a>, <a class="link-man" href="../3/snprintf">snprintf(3)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="fname">snprintb</b>() function was originally implemented as a non-standard <code class="lit">%b</code> format string for the kernel <b class="fname">printf</b>() function in <span class="unix">NetBSD&#160;1.5</span> and earlier releases. It was called <b class="fname">bitmask_snprintf</b>() in <span class="unix">NetBSD&#160;5.0</span> and earlier releases.</div>
<div class="section">
<h1 id="x415554484f5253">AUTHORS</h1> The &#8220;new&#8221; format was the invention of <span class="author">Chris Torek</span>.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
May 7, 2009</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

