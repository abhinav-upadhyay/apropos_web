<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
MANDOC(3)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
MANDOC(3)</td>
<td class="head-vol" align="center">
Library Functions Manual</td>
<td class="head-rtitle" align="right">
MANDOC(3)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">mandoc</b>, <b class="name">mandoc_escape</b>, <b class="name">man_meta</b>, <b class="name">man_mparse</b>, <b class="name">man_node</b>, <b class="name">mchars_alloc</b>, <b class="name">mchars_free</b>, <b class="name">mchars_num2char</b>, <b class="name">mchars_num2uc</b>, <b class="name">mchars_spec2cp</b>, <b class="name">mchars_spec2str</b>, <b class="name">mdoc_meta</b>, <b class="name">mdoc_node</b>, <b class="name">mparse_alloc</b>, <b class="name">mparse_free</b>, <b class="name">mparse_getkeep</b>, <b class="name">mparse_keep</b>, <b class="name">mparse_readfd</b>, <b class="name">mparse_reset</b>, <b class="name">mparse_result</b>, <b class="name">mparse_strerror</b>, <b class="name">mparse_strlevel</b> &#8212; <span class="desc">mandoc macro compiler library</span></div>
<div class="section">
<h1 id="x4c494252415259">LIBRARY</h1> <span class="lib">Mandoc Macro Compiler Library (libmandoc, &#45;lmandoc)</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">man.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">mdoc.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">mandoc.h</a>&gt;</b><p>
<i class="ftype">enum mandoc_esc</i><br>
<b class="fname">mandoc_escape</b>(<i class="farg">const char const **end</i>, <i class="farg">const char const **start</i>, <i class="farg">int *sz</i>);<p>
<i class="ftype">const struct man_meta *</i><br>
<b class="fname">man_meta</b>(<i class="farg">const struct man *man</i>);<p>
<i class="ftype">const struct mparse *</i><br>
<b class="fname">man_mparse</b>(<i class="farg">const struct man *man</i>);<p>
<i class="ftype">const struct man_node *</i><br>
<b class="fname">man_node</b>(<i class="farg">const struct man *man</i>);<p>
<i class="ftype">struct mchars *</i><br>
<b class="fname">mchars_alloc</b>(<i class="farg" style="white-space:nowrap;">void</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">mchars_free</b>(<i class="farg" style="white-space:nowrap;">struct mchars *p</i>);<p>
<i class="ftype">char</i><br>
<b class="fname">mchars_num2char</b>(<i class="farg" style="white-space:nowrap;">const char *cp</i>, <i class="farg" style="white-space:nowrap;">size_t sz</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">mchars_num2uc</b>(<i class="farg" style="white-space:nowrap;">const char *cp</i>, <i class="farg" style="white-space:nowrap;">size_t sz</i>);<p>
<i class="ftype">const char *</i><br>
<b class="fname">mchars_spec2str</b>(<i class="farg">const struct mchars *p</i>, <i class="farg">const char *cp</i>, <i class="farg">size_t sz</i>, <i class="farg">size_t *rsz</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">mchars_spec2cp</b>(<i class="farg">const struct mchars *p</i>, <i class="farg">const char *cp</i>, <i class="farg">size_t sz</i>);<p>
<i class="ftype">const struct mdoc_meta *</i><br>
<b class="fname">mdoc_meta</b>(<i class="farg">const struct mdoc *mdoc</i>);<p>
<i class="ftype">const struct mdoc_node *</i><br>
<b class="fname">mdoc_node</b>(<i class="farg">const struct mdoc *mdoc</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">mparse_alloc</b>(<i class="farg">enum mparset type</i>, <i class="farg">enum mandoclevel wlevel</i>, <i class="farg">mandocmsg msg</i>, <i class="farg">void *msgarg</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">mparse_free</b>(<i class="farg">struct mparse *parse</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">mparse_getkeep</b>(<i class="farg">const struct mparse *parse</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">mparse_keep</b>(<i class="farg">struct mparse *parse</i>);<p>
<i class="ftype">enum mandoclevel</i><br>
<b class="fname">mparse_readfd</b>(<i class="farg">struct mparse *parse</i>, <i class="farg">int fd</i>, <i class="farg">const char *fname</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">mparse_reset</b>(<i class="farg">struct mparse *parse</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">mparse_result</b>(<i class="farg">struct mparse *parse</i>, <i class="farg">struct mdoc **mdoc</i>, <i class="farg">struct man **man</i>);<p>
<i class="ftype">const char *</i><br>
<b class="fname">mparse_strerror</b>(<i class="farg">enum mandocerr</i>);<p>
<i class="ftype">const char *</i><br>
<b class="fname">mparse_strlevel</b>(<i class="farg">enum mandoclevel</i>);<p>
<span class="type">extern const char * const * man_macronames;</span><br>
<span class="type">extern const char * const * mdoc_argnames;</span><br>
<span class="type">extern const char * const * mdoc_macronames;</span><p>
<b class="macro">#define ASCII_NBRSP</b><br>
<b class="macro">#define ASCII_HYPH</b></div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="name">mandoc</b> library parses a <span class="unix">UNIX</span> manual into an abstract syntax tree (AST). <span class="unix">UNIX</span> manuals are composed of <a class="link-man" href="../7/mdoc">mdoc(7)</a> or <a class="link-man" href="../7/man">man(7)</a>, and may be mixed with <a class="link-man" href="../7/roff">roff(7)</a>, <a class="link-man" href="../7/tbl">tbl(7)</a>, and <a class="link-man" href="../7/eqn">eqn(7)</a> invocations.<p>
The following describes a general parse sequence:<ol style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-enum">
<li class="list-enum" style="margin-top: 1.00em;">
initiate a parsing sequence with <b class="fname">mparse_alloc</b>();</li>
<li class="list-enum" style="margin-top: 1.00em;">
parse files or file descriptors with <b class="fname">mparse_readfd</b>();</li>
<li class="list-enum" style="margin-top: 1.00em;">
retrieve a parsed syntax tree, if the parse was successful, with <b class="fname">mparse_result</b>();</li>
<li class="list-enum" style="margin-top: 1.00em;">
iterate over parse nodes with <b class="fname">mdoc_node</b>() or <b class="fname">man_node</b>();</li>
<li class="list-enum" style="margin-top: 1.00em;">
free all allocated memory with <b class="fname">mparse_free</b>(), or invoke <b class="fname">mparse_reset</b>() and parse new files.</li>
</ol>
<p>
The <b class="name">mandoc</b> library also contains routines for translating character strings into glyphs (see <b class="fname">mchars_alloc</b>()) and parsing escape sequences from strings (see <b class="fname">mandoc_escape</b>()).</div>
<div class="section">
<h1 id="x5245464552454e4345">REFERENCE</h1> This section documents the functions, types, and variables available via <b class="includes">&lt;<a class="link-includes">mandoc.h</a>&gt;</b>.<div class="subsection">
<h2 id="x5479706573">Types</h2><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-ohang">
<dt class="list-ohang" style="margin-top: 1.00em;">
<span class="type">enum mandoc_esc</span></dt>
<dd class="list-ohang">
An escape sequence classification.</dd>
<dt class="list-ohang" style="margin-top: 1.00em;">
<span class="type">enum mandocerr</span></dt>
<dd class="list-ohang">
A fatal error, error, or warning message during parsing.</dd>
<dt class="list-ohang" style="margin-top: 1.00em;">
<span class="type">enum mandoclevel</span></dt>
<dd class="list-ohang">
A classification of an <span class="type">enum mandoclevel</span> as regards system operation.</dd>
<dt class="list-ohang" style="margin-top: 1.00em;">
<span class="type">struct mchars</span></dt>
<dd class="list-ohang">
An opaque pointer to an object allowing for translation between character strings and glyphs. See <b class="fname">mchars_alloc</b>().</dd>
<dt class="list-ohang" style="margin-top: 1.00em;">
<span class="type">enum mparset</span></dt>
<dd class="list-ohang">
The type of parser when reading input. This should usually be <span class="define">MPARSE_AUTO</span> for auto-detection.</dd>
<dt class="list-ohang" style="margin-top: 1.00em;">
<span class="type">struct mparse</span></dt>
<dd class="list-ohang">
An opaque pointer to a running parse sequence. Created with <b class="fname">mparse_alloc</b>() and freed with <b class="fname">mparse_free</b>(). This may be used across parsed input if <b class="fname">mparse_reset</b>() is called between parses.</dd>
<dt class="list-ohang" style="margin-top: 1.00em;">
<span class="type">mandocmsg</span></dt>
<dd class="list-ohang">
A prototype for a function to handle fatal error, error, and warning messages emitted by the parser.</dd>
</dl>
</div>
<div class="subsection">
<h2 id="x46756e6374696f6e73">Functions</h2><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-ohang">
<dt class="list-ohang" style="margin-top: 1.00em;">
<b class="fname">mandoc_escape</b>()</dt>
<dd class="list-ohang">
Scan an escape sequence, i.e., a character string beginning with &#8216;&#92;&#8217;. Pass a pointer to the character after the &#8216;&#92;&#8217; as <b class="var">end</b>; it will be set to the supremum of the parsed escape sequence unless returning <span class="define">ESCAPE_ERROR</span>, in which case the string is bogus and should be thrown away. If not <span class="define">ESCAPE_ERROR</span> or <span class="define">ESCAPE_IGNORE</span>, <b class="var">start</b> is set to the first relevant character of the substring (font, glyph, whatever) of length <b class="var">sz</b>. Both <b class="var">start</b> and <b class="var">sz</b> may be <span class="define">NULL</span>. Declared in <b class="includes">&lt;<a class="link-includes">mandoc.h</a>&gt;</b>, implemented in <i class="file">mandoc.c</i>.</dd>
<dt class="list-ohang" style="margin-top: 1.00em;">
<b class="fname">man_meta</b>()</dt>
<dd class="list-ohang">
Obtain the meta-data of a successful parse. This may only be used on a pointer returned by <b class="fname">mparse_result</b>(). Declared in <b class="includes">&lt;<a class="link-includes">man.h</a>&gt;</b>, implemented in <i class="file">man.c</i>.</dd>
<dt class="list-ohang" style="margin-top: 1.00em;">
<b class="fname">man_mparse</b>()</dt>
<dd class="list-ohang">
Get the parser used for the current output. Declared in <b class="includes">&lt;<a class="link-includes">man.h</a>&gt;</b>, implemented in <i class="file">man.c</i>.</dd>
<dt class="list-ohang" style="margin-top: 1.00em;">
<b class="fname">man_node</b>()</dt>
<dd class="list-ohang">
Obtain the root node of a successful parse. This may only be used on a pointer returned by <b class="fname">mparse_result</b>(). Declared in <b class="includes">&lt;<a class="link-includes">man.h</a>&gt;</b>, implemented in <i class="file">man.c</i>.</dd>
<dt class="list-ohang" style="margin-top: 1.00em;">
<b class="fname">mchars_alloc</b>()</dt>
<dd class="list-ohang">
Allocate an <span class="type">struct mchars *</span> object for translating special characters into glyphs. See <a class="link-man" href="../7/mandoc_char">mandoc_char(7)</a> for an overview of special characters. The object must be freed with <b class="fname">mchars_free</b>(). Declared in <b class="includes">&lt;<a class="link-includes">mandoc.h</a>&gt;</b>, implemented in <i class="file">chars.c</i>.</dd>
<dt class="list-ohang" style="margin-top: 1.00em;">
<b class="fname">mchars_free</b>()</dt>
<dd class="list-ohang">
Free an object created with <b class="fname">mchars_alloc</b>(). Declared in <b class="includes">&lt;<a class="link-includes">mandoc.h</a>&gt;</b>, implemented in <i class="file">chars.c</i>.</dd>
<dt class="list-ohang" style="margin-top: 1.00em;">
<b class="fname">mchars_num2char</b>()</dt>
<dd class="list-ohang">
Convert a character index (e.g., the &#92;N&#39;&#39; escape) into a printable ASCII character. Returns &#92;0 (the nil character) if the input sequence is malformed. Declared in <b class="includes">&lt;<a class="link-includes">mandoc.h</a>&gt;</b>, implemented in <i class="file">chars.c</i>.</dd>
<dt class="list-ohang" style="margin-top: 1.00em;">
<b class="fname">mchars_num2uc</b>()</dt>
<dd class="list-ohang">
Convert a hexadecimal character index (e.g., the &#92;[uNNNN] escape) into a Unicode codepoint. Returns &#92;0 (the nil character) if the input sequence is malformed. Declared in <b class="includes">&lt;<a class="link-includes">mandoc.h</a>&gt;</b>, implemented in <i class="file">chars.c</i>.</dd>
<dt class="list-ohang" style="margin-top: 1.00em;">
<b class="fname">mchars_spec2cp</b>()</dt>
<dd class="list-ohang">
Convert a special character into a valid Unicode codepoint. Returns &#45;1 on failure or a non-zero Unicode codepoint on success. Declared in <b class="includes">&lt;<a class="link-includes">mandoc.h</a>&gt;</b>, implemented in <i class="file">chars.c</i>.</dd>
<dt class="list-ohang" style="margin-top: 1.00em;">
<b class="fname">mchars_spec2str</b>()</dt>
<dd class="list-ohang">
Convert a special character into an ASCII string. Returns <span class="define">NULL</span> on failure. Declared in <b class="includes">&lt;<a class="link-includes">mandoc.h</a>&gt;</b>, implemented in <i class="file">chars.c</i>.</dd>
<dt class="list-ohang" style="margin-top: 1.00em;">
<b class="fname">mdoc_meta</b>()</dt>
<dd class="list-ohang">
Obtain the meta-data of a successful parse. This may only be used on a pointer returned by <b class="fname">mparse_result</b>(). Declared in <b class="includes">&lt;<a class="link-includes">mdoc.h</a>&gt;</b>, implemented in <i class="file">mdoc.c</i>.</dd>
<dt class="list-ohang" style="margin-top: 1.00em;">
<b class="fname">mdoc_node</b>()</dt>
<dd class="list-ohang">
Obtain the root node of a successful parse. This may only be used on a pointer returned by <b class="fname">mparse_result</b>(). Declared in <b class="includes">&lt;<a class="link-includes">mdoc.h</a>&gt;</b>, implemented in <i class="file">mdoc.c</i>.</dd>
<dt class="list-ohang" style="margin-top: 1.00em;">
<b class="fname">mparse_alloc</b>()</dt>
<dd class="list-ohang">
Allocate a parser. The same parser may be used for multiple files so long as <b class="fname">mparse_reset</b>() is called between parses. <b class="fname">mparse_free</b>() must be called to free the memory allocated by this function. Declared in <b class="includes">&lt;<a class="link-includes">mandoc.h</a>&gt;</b>, implemented in <i class="file">read.c</i>.</dd>
<dt class="list-ohang" style="margin-top: 1.00em;">
<b class="fname">mparse_free</b>()</dt>
<dd class="list-ohang">
Free all memory allocated by <b class="fname">mparse_alloc</b>(). Declared in <b class="includes">&lt;<a class="link-includes">mandoc.h</a>&gt;</b>, implemented in <i class="file">read.c</i>.</dd>
<dt class="list-ohang" style="margin-top: 1.00em;">
<b class="fname">mparse_getkeep</b>()</dt>
<dd class="list-ohang">
Acquire the keep buffer. Must follow a call of <b class="fname">mparse_keep</b>(). Declared in <b class="includes">&lt;<a class="link-includes">mandoc.h</a>&gt;</b>, implemented in <i class="file">read.c</i>.</dd>
<dt class="list-ohang" style="margin-top: 1.00em;">
<b class="fname">mparse_keep</b>()</dt>
<dd class="list-ohang">
Instruct the parser to retain a copy of its parsed input. This can be acquired with subsequent <b class="fname">mparse_getkeep</b>() calls. Declared in <b class="includes">&lt;<a class="link-includes">mandoc.h</a>&gt;</b>, implemented in <i class="file">read.c</i>.</dd>
<dt class="list-ohang" style="margin-top: 1.00em;">
<b class="fname">mparse_readfd</b>()</dt>
<dd class="list-ohang">
Parse a file or file descriptor. If <b class="var">fd</b> is -1, <b class="var">fname</b> is opened for reading. Otherwise, <b class="var">fname</b> is assumed to be the name associated with <b class="var">fd</b>. This may be called multiple times with different parameters; however, <b class="fname">mparse_reset</b>() should be invoked between parses. Declared in <b class="includes">&lt;<a class="link-includes">mandoc.h</a>&gt;</b>, implemented in <i class="file">read.c</i>.</dd>
<dt class="list-ohang" style="margin-top: 1.00em;">
<b class="fname">mparse_reset</b>()</dt>
<dd class="list-ohang">
Reset a parser so that <b class="fname">mparse_readfd</b>() may be used again. Declared in <b class="includes">&lt;<a class="link-includes">mandoc.h</a>&gt;</b>, implemented in <i class="file">read.c</i>.</dd>
<dt class="list-ohang" style="margin-top: 1.00em;">
<b class="fname">mparse_result</b>()</dt>
<dd class="list-ohang">
Obtain the result of a parse. Only successful parses (i.e., those where <b class="fname">mparse_readfd</b>() returned less than MANDOCLEVEL_FATAL) should invoke this function, in which case one of the two pointers will be filled in. Declared in <b class="includes">&lt;<a class="link-includes">mandoc.h</a>&gt;</b>, implemented in <i class="file">read.c</i>.</dd>
<dt class="list-ohang" style="margin-top: 1.00em;">
<b class="fname">mparse_strerror</b>()</dt>
<dd class="list-ohang">
Return a statically-allocated string representation of an error code. Declared in <b class="includes">&lt;<a class="link-includes">mandoc.h</a>&gt;</b>, implemented in <i class="file">read.c</i>.</dd>
<dt class="list-ohang" style="margin-top: 1.00em;">
<b class="fname">mparse_strlevel</b>()</dt>
<dd class="list-ohang">
Return a statically-allocated string representation of a level code. Declared in <b class="includes">&lt;<a class="link-includes">mandoc.h</a>&gt;</b>, implemented in <i class="file">read.c</i>.</dd>
</dl>
</div>
<div class="subsection">
<h2 id="x5661726961626c6573">Variables</h2><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-ohang">
<dt class="list-ohang" style="margin-top: 1.00em;">
<b class="var">man_macronames</b></dt>
<dd class="list-ohang">
The string representation of a man macro as indexed by <span class="type">enum mant</span>.</dd>
<dt class="list-ohang" style="margin-top: 1.00em;">
<b class="var">mdoc_argnames</b></dt>
<dd class="list-ohang">
The string representation of a mdoc macro argument as indexed by <span class="type">enum mdocargt</span>.</dd>
<dt class="list-ohang" style="margin-top: 1.00em;">
<b class="var">mdoc_macronames</b></dt>
<dd class="list-ohang">
The string representation of a mdoc macro as indexed by <span class="type">enum mdoct</span>.</dd>
</dl>
</div>
</div>
<div class="section">
<h1 id="x494d504c454d454e544154494f4e204e4f544553">IMPLEMENTATION NOTES</h1> This section consists of structural documentation for <a class="link-man" href="../7/mdoc">mdoc(7)</a> and <a class="link-man" href="../7/man">man(7)</a> syntax trees and strings.<div class="subsection">
<h2 id="x4d616e20616e64204d646f6320537472696e6773">Man and Mdoc Strings</h2> Strings may be extracted from mdoc and man meta-data, or from text nodes (MDOC_TEXT and MAN_TEXT, respectively). These strings have special non-printing formatting cues embedded in the text itself, as well as <a class="link-man" href="../7/roff">roff(7)</a> escapes preserved from input. Implementing systems will need to handle both situations to produce human-readable text. In general, strings may be assumed to consist of 7-bit ASCII characters.<p>
The following non-printing characters may be embedded in text strings:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">ASCII_NBRSP</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
A non-breaking space character.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">ASCII_HYPH</span></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
A soft hyphen.</dd>
</dl>
<p>
Escape characters are also passed verbatim into text strings. An escape character is a sequence of characters beginning with the backslash (&#8216;&#92;&#8217;). To construct human-readable text, these should be intercepted with <b class="fname">mandoc_escape</b>() and converted with one of <b class="fname">mchars_num2char</b>(), <b class="fname">mchars_spec2str</b>(), and so on.</div>
<div class="subsection">
<h2 id="x4d616e2041627374726163742053796e7461782054726565">Man Abstract Syntax Tree</h2> This AST is governed by the ontological rules dictated in <a class="link-man" href="../7/man">man(7)</a> and derives its terminology accordingly.<p>
The AST is composed of <span class="type">struct man_node</span> nodes with element, root and text types as declared by the <b class="var">type</b> field. Each node also provides its parse point (the <b class="var">line</b>, <b class="var">sec</b>, and <b class="var">pos</b> fields), its position in the tree (the <b class="var">parent</b>, <b class="var">child</b>, <b class="var">next</b> and <b class="var">prev</b> fields) and some type-specific data.<p>
The tree itself is arranged according to the following normal form, where capitalised non-terminals represent nodes.<p>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
ROOT</dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
&#8592; mnode+</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
mnode</dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
&#8592; ELEMENT | TEXT | BLOCK</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
BLOCK</dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
&#8592; HEAD BODY</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
HEAD</dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
&#8592; mnode*</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
BODY</dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
&#8592; mnode*</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
ELEMENT</dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
&#8592; ELEMENT | TEXT*</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
TEXT</dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
&#8592; [[:ascii:]]*</dd>
</dl>
<p>
The only elements capable of nesting other elements are those with next-lint scope as documented in <a class="link-man" href="../7/man">man(7)</a>.</div>
<div class="subsection">
<h2 id="x4d646f632041627374726163742053796e7461782054726565">Mdoc Abstract Syntax Tree</h2> This AST is governed by the ontological rules dictated in <a class="link-man" href="../7/mdoc">mdoc(7)</a> and derives its terminology accordingly. &#8220;In-line&#8221; elements described in <a class="link-man" href="../7/mdoc">mdoc(7)</a> are described simply as &#8220;elements&#8221;.<p>
The AST is composed of <span class="type">struct mdoc_node</span> nodes with block, head, body, element, root and text types as declared by the <b class="var">type</b> field. Each node also provides its parse point (the <b class="var">line</b>, <b class="var">sec</b>, and <b class="var">pos</b> fields), its position in the tree (the <b class="var">parent</b>, <b class="var">child</b>, <b class="var">nchild</b>, <b class="var">next</b> and <b class="var">prev</b> fields) and some type-specific data, in particular, for nodes generated from macros, the generating macro in the <b class="var">tok</b> field.<p>
The tree itself is arranged according to the following normal form, where capitalised non-terminals represent nodes.<p>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
ROOT</dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
&#8592; mnode+</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
mnode</dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
&#8592; BLOCK | ELEMENT | TEXT</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
BLOCK</dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
&#8592; HEAD [TEXT] (BODY [TEXT])+ [TAIL [TEXT]]</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
ELEMENT</dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
&#8592; TEXT*</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
HEAD</dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
&#8592; mnode*</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
BODY</dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
&#8592; mnode* [ENDBODY mnode*]</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
TAIL</dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
&#8592; mnode*</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
TEXT</dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
&#8592; [[:ascii:]]*</dd>
</dl>
<p>
Of note are the TEXT nodes following the HEAD, BODY and TAIL nodes of the BLOCK production: these refer to punctuation marks. Furthermore, although a TEXT node will generally have a non-zero-length string, in the specific case of &#8216;.Bd &#45;literal&#8217;, an empty line will produce a zero-length string. Multiple body parts are only found in invocations of &#8216;Bl &#45;column&#8217;, where a new body introduces a new phrase.<p>
The <a class="link-man" href="../7/mdoc">mdoc(7)</a> syntax tree accommodates for broken block structures as well. The ENDBODY node is available to end the formatting associated with a given block before the physical end of that block. It has a non-null <b class="var">end</b> field, is of the BODY <b class="var">type</b>, has the same <b class="var">tok</b> as the BLOCK it is ending, and has a <b class="var">pending</b> field pointing to that BLOCK's BODY node. It is an indirect child of that BODY node and has no children of its own.<p>
An ENDBODY node is generated when a block ends while one of its child blocks is still open, like in the following example:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
.Ao ao 
.Bo bo ac 
.Ac bc 
.Bc end</pre>
<p>
This example results in the following block structure:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
BLOCK Ao 
    HEAD Ao 
    BODY Ao 
        TEXT ao 
        BLOCK Bo, pending -&gt; Ao 
            HEAD Bo 
            BODY Bo 
                TEXT bo 
                TEXT ac 
                ENDBODY Ao, pending -&gt; Ao 
                TEXT bc 
TEXT end</pre>
<p>
Here, the formatting of the &#8216;Ao&#8217; block extends from TEXT ao to TEXT ac, while the formatting of the &#8216;Bo&#8217; block extends from TEXT bo to TEXT bc. It renders as follows in <b class="flag">&#45;T</b><b class="flag">ascii</b> mode:<p>
<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit">&lt;ao [bo ac&gt; bc] end</code></div>
</blockquote>
<p>
Support for badly-nested blocks is only provided for backward compatibility with some older <a class="link-man" href="../7/mdoc">mdoc(7)</a> implementations. Using badly-nested blocks is <span class="emph">strongly discouraged</span>; for example, the <b class="flag">&#45;T</b><b class="flag">html</b> and <b class="flag">&#45;T</b><b class="flag">xhtml</b> front-ends to <a class="link-man" href="../1/mandoc">mandoc(1)</a> are unable to render them in any meaningful way. Furthermore, behaviour when encountering badly-nested blocks is not consistent across troff implementations, especially when using  multiple levels of badly-nested blocks.</div>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../1/mandoc">mandoc(1)</a>, <a class="link-man" href="../7/eqn">eqn(7)</a>, <a class="link-man" href="../7/man">man(7)</a>, <a class="link-man" href="../7/mandoc_char">mandoc_char(7)</a>, <a class="link-man" href="../7/mdoc">mdoc(7)</a>, <a class="link-man" href="../7/roff">roff(7)</a>, <a class="link-man" href="../7/tbl">tbl(7)</a></div>
<div class="section">
<h1 id="x415554484f5253">AUTHORS</h1> The <b class="name">mandoc</b> library was written by <span class="author">Kristaps Dzonsons</span> &#60;<a class="link-mail" href="mailto:kristaps@bsd.lv">kristaps@bsd.lv</a>&#62;.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
October 6, 2013</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

