<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
RCMD(3)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
RCMD(3)</td>
<td class="head-vol" align="center">
Library Functions Manual</td>
<td class="head-rtitle" align="right">
RCMD(3)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">rcmd</b>, <b class="name">orcmd</b>, <b class="name">rcmd_af</b>, <b class="name">orcmd_af</b>, <b class="name">rresvport</b>, <b class="name">rresvport_af</b>, <b class="name">iruserok</b>, <b class="name">ruserok</b>, <b class="name">iruserok_sa</b> &#8212; <span class="desc">routines for returning a stream to a remote command</span></div>
<div class="section">
<h1 id="x4c494252415259">LIBRARY</h1> <span class="lib">Standard C Library (libc, &#45;lc)</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">unistd.h</a>&gt;</b><p>
<i class="ftype">int</i><br>
<b class="fname">rcmd</b>(<i class="farg" style="white-space:nowrap;">char **ahost</i>, <i class="farg" style="white-space:nowrap;">int inport</i>, <i class="farg" style="white-space:nowrap;">const char *locuser</i>, <i class="farg" style="white-space:nowrap;">const char *remuser</i>, <i class="farg" style="white-space:nowrap;">const char *cmd</i>, <i class="farg" style="white-space:nowrap;">int *fd2p</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">orcmd</b>(<i class="farg" style="white-space:nowrap;">char **ahost</i>, <i class="farg" style="white-space:nowrap;">int inport</i>, <i class="farg" style="white-space:nowrap;">const char *locuser</i>, <i class="farg" style="white-space:nowrap;">const char *remuser</i>, <i class="farg" style="white-space:nowrap;">const char *cmd</i>, <i class="farg" style="white-space:nowrap;">int *fd2p</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">rcmd_af</b>(<i class="farg" style="white-space:nowrap;">char **ahost</i>, <i class="farg" style="white-space:nowrap;">int inport</i>, <i class="farg" style="white-space:nowrap;">const char *locuser</i>, <i class="farg" style="white-space:nowrap;">const char *remuser</i>, <i class="farg" style="white-space:nowrap;">const char *cmd</i>, <i class="farg" style="white-space:nowrap;">int *fd2p</i>, <i class="farg" style="white-space:nowrap;">int af</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">orcmd_af</b>(<i class="farg" style="white-space:nowrap;">char **ahost</i>, <i class="farg" style="white-space:nowrap;">int inport</i>, <i class="farg" style="white-space:nowrap;">const char *locuser</i>, <i class="farg" style="white-space:nowrap;">const char *remuser</i>, <i class="farg" style="white-space:nowrap;">const char *cmd</i>, <i class="farg" style="white-space:nowrap;">int *fd2p</i>, <i class="farg" style="white-space:nowrap;">int af</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">rresvport</b>(<i class="farg" style="white-space:nowrap;">int *port</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">rresvport_af</b>(<i class="farg" style="white-space:nowrap;">int *port</i>, <i class="farg" style="white-space:nowrap;">int family</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">iruserok</b>(<i class="farg" style="white-space:nowrap;">uint32_t raddr</i>, <i class="farg" style="white-space:nowrap;">int superuser</i>, <i class="farg" style="white-space:nowrap;">const char *ruser</i>, <i class="farg" style="white-space:nowrap;">const char *luser</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">ruserok</b>(<i class="farg" style="white-space:nowrap;">const char *rhost</i>, <i class="farg" style="white-space:nowrap;">int superuser</i>, <i class="farg" style="white-space:nowrap;">const char *ruser</i>, <i class="farg" style="white-space:nowrap;">const char *luser</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">iruserok_sa</b>(<i class="farg" style="white-space:nowrap;">const void *raddr</i>, <i class="farg" style="white-space:nowrap;">int rlen</i>, <i class="farg" style="white-space:nowrap;">int superuser</i>, <i class="farg" style="white-space:nowrap;">const char *ruser</i>, <i class="farg" style="white-space:nowrap;">const char *luser</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="fname">rcmd</b>() function is available for use by anyone to run commands on a remote system.  It acts like the <b class="fname">orcmd</b>() command, with the exception that it makes a call out to the <a class="link-man" href="../html1/rcmd.html">rcmd(1)</a> command, or any other user-specified command, to perform the actual connection (thus not requiring that the caller be running as the super-user), and is only available for the &#8220;shell/tcp&#8221; port. The <b class="fname">orcmd</b>() function is used by the super-user to execute a command on a remote machine using an authentication scheme based on reserved port numbers. While <b class="fname">rcmd</b>() and <b class="fname">orcmd</b>() can only handle IPv4 address in the first argument, <b class="fname">rcmd_af</b>() and <b class="fname">orcmd_af</b>() can handle other cases as well. The <b class="fname">rresvport</b>() function returns a descriptor to a socket with an address in the privileged port space. The <b class="fname">rresvport_af</b>() function is similar to <b class="fname">rresvport</b>(), but you can explicitly specify the address family to use. Calling <b class="fname">rresvport_af</b>() with <span class="define">AF_INET</span> has the same effect as <b class="fname">rresvport</b>(). The <b class="fname">iruserok</b>() and <b class="fname">ruserok</b>() functions are used by servers to authenticate clients requesting service with <b class="fname">rcmd</b>(). All six functions are present in the same file and are used by the <a class="link-man" href="../html8/rshd.html">rshd(8)</a> server (among others). <b class="fname">iruserok_sa</b>() is an address family independent variant of <b class="fname">iruserok</b>().<p>
The <b class="fname">rcmd</b>() function looks up the host <i class="farg">*ahost</i> using <a class="link-man" href="../html3/gethostbyname.html">gethostbyname(3)</a>, returning &#45;1 if the host does not exist. Otherwise <i class="farg">*ahost</i> is set to the standard name of the host and a connection is established to a server residing at the well-known Internet port <i class="farg">inport</i>.<p>
If the connection succeeds, a socket in the Internet domain of type <span class="define">SOCK_STREAM</span> is returned to the caller, and given to the remote command as <span class="emph">stdin</span> and <span class="emph">stdout</span>. If <i class="farg">fd2p</i> is non-zero, then an auxiliary channel to a control process will be set up, and a descriptor for it will be placed in <i class="farg">*fd2p</i>. The control process will return diagnostic output from the command (unit 2) on this channel, and will also accept bytes on this channel as being <span class="unix">UNIX</span> signal numbers, to be forwarded to the process group of the command. If <i class="farg">fd2p</i> is 0, then the <span class="emph">stderr</span> (unit 2 of the remote command) will be made the same as the <span class="emph">stdout</span> and no provision is made for sending arbitrary signals to the remote process, although you may be able to get its attention by using out-of-band data.<p>
<b class="fname">rcmd_af</b>() and <b class="fname">orcmd_af</b>() take address family in the last argument. If the last argument is <span class="define">PF_UNSPEC</span>, interpretation of <i class="farg">*ahost</i> will obey the underlying address resolution like DNS.<p>
The protocol is described in detail in <a class="link-man" href="../html8/rshd.html">rshd(8)</a>.<p>
The <b class="fname">rresvport</b>() and <b class="fname">rresvport_af</b>() functions are used to obtain a socket with a privileged address bound to it.  This socket is suitable for use by <b class="fname">rcmd</b>() and several other functions.  Privileged Internet ports are those in the range 0 to 1023.  Only the super-user is allowed to bind an address of this sort to a socket.<p>
The <b class="fname">iruserok</b>() and <b class="fname">ruserok</b>() functions take a remote host's IP address or name, respectively, two user names and a flag indicating whether the local user's name is that of the super-user. Then, if the user is <span class="emph">NOT</span> the super-user, it checks the <i class="file">/etc/hosts.equiv</i> file. If that lookup is not done, or is unsuccessful, the <i class="file">.rhosts</i> in the local user's home directory is checked to see if the request for service is allowed.<p>
If this file does not exist, is not a regular file, is owned by anyone other than the user or the super-user, or is writable by anyone other than the owner, the check automatically fails. Zero is returned if the machine name is listed in the &#8220;<i class="file">hosts.equiv</i>&#8221; file, or the host and remote user name are found in the &#8220;<i class="file">.rhosts</i>&#8221; file; otherwise <b class="fname">iruserok</b>() and <b class="fname">ruserok</b>() return &#45;1. If the local domain (as obtained from <a class="link-man" href="../html3/gethostname.html">gethostname(3)</a>) is the same as the remote domain, only the machine name need be specified.<p>
If the IP address of the remote host is known, <b class="fname">iruserok</b>() should be used in preference to <b class="fname">ruserok</b>(), as it does not require trusting the DNS server for the remote host's domain.<p>
While <b class="fname">iruserok</b>() can handle IPv4 addresses only, <b class="fname">iruserok_sa</b>() and <b class="fname">ruserok</b>() can handle other address families as well, like IPv6. The first argument of <b class="fname">iruserok_sa</b>() is typed as <i class="farg">void *</i> to avoid dependency between <b class="includes">&lt;<a class="link-includes">unistd.h</a>&gt;</b> and <b class="includes">&lt;<a class="link-includes">sys/socket.h</a>&gt;</b>.</div>
<div class="section">
<h1 id="x454e5649524f4e4d454e54">ENVIRONMENT</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="env">RCMD_CMD</span></dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
When using the <b class="fname">rcmd</b>() function, this variable is used as the program to run instead of <a class="link-man" href="../html1/rcmd.html">rcmd(1)</a>.</dd>
</dl>
</div>
<div class="section">
<h1 id="x444941474e4f5354494353">DIAGNOSTICS</h1> The <b class="fname">rcmd</b>() function returns a valid socket descriptor on success. It returns &#45;1 on error and prints a diagnostic message on the standard error.<p>
The <b class="fname">rresvport</b>() and <b class="fname">rresvport_af</b>() function return a valid, bound socket descriptor on success. They return &#45;1 on error with the global value <b class="var">errno</b> set according to the reason for failure. The error code <span class="define">EAGAIN</span> is overloaded to mean ``All network ports in use.''</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html1/rcmd.html">rcmd(1)</a>, <a class="link-man" href="../html1/rlogin.html">rlogin(1)</a>, <a class="link-man" href="../html1/rsh.html">rsh(1)</a>, <a class="link-man" href="../html2/intro.html">intro(2)</a>, <a class="link-man" href="../html3/rexec.html">rexec(3)</a>, <a class="link-man" href="../html5/hosts.equiv.html">hosts.equiv(5)</a>, <a class="link-man" href="../html5/rhosts.html">rhosts(5)</a>, <a class="link-man" href="../html8/rexecd.html">rexecd(8)</a>, <a class="link-man" href="../html8/rlogind.html">rlogind(8)</a>, <a class="link-man" href="../html8/rshd.html">rshd(8)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="fname">orcmd</b>(), <b class="fname">rresvport</b>(), <b class="fname">iruserok</b>() and <b class="fname">ruserok</b>() functions appeared in <span class="unix">4.2BSD</span>, where the <b class="fname">orcmd</b>() function was called <b class="fname">rcmd</b>(). The (newer) <b class="fname">rcmd</b>() function appeared in <span class="unix">NetBSD&#160;1.3</span>. <b class="fname">rcmd_af</b>() and <b class="fname">rresvport_af</b>() were defined in RFC2292.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
March 30, 2005</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

