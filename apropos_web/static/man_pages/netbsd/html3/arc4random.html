<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/../4/strict.dtd">
>
<head>
<meta http-equiv="Content-Type" content="te../; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
ARC4RANDOM(3)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
ARC4RANDOM(3)</td>
<td class="head-vol" align="center">
Library Functions Manual</td>
<td class="head-rtitle" align="right">
ARC4RANDOM(3)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">arc4random</b>, <b class="name">arc4random_uniform</b>, <b class="name">arc4random_buf</b>, <b class="name">arc4random_stir</b>, <b class="name">arc4random_addrandom</b> &#8212; <span class="desc">random number generator</span></div>
<div class="section">
<h1 id="x4c494252415259">LIBRARY</h1> <span class="lib">Standard C Library (libc, &#45;lc)</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">stdlib.h</a>&gt;</b><p>
<i class="ftype">uint32_t</i><br>
<b class="fname">arc4random</b>(<i class="farg" style="white-space:nowrap;">void</i>);<p>
<i class="ftype">uint32_t</i><br>
<b class="fname">arc4random_uniform</b>(<i class="farg" style="white-space:nowrap;">uint32_t bound</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">arc4random_buf</b>(<i class="farg" style="white-space:nowrap;">void *buf</i>, <i class="farg" style="white-space:nowrap;">size_t len</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">arc4random_stir</b>(<i class="farg" style="white-space:nowrap;">void</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">arc4random_addrandom</b>(<i class="farg" style="white-space:nowrap;">unsigned char *buf</i>, <i class="farg" style="white-space:nowrap;">int len</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="name">arc4random</b> family of functions provides a cryptographic pseudorandom number generator automatically seeded from the system entropy pool and safe to use from multiple threads. <b class="name">arc4random</b> is designed to prevent an adversary from guessing outputs, unlike <a class="link-man" href="../3/rand">rand(3)</a> and <a class="link-man" href="../3/random">random(3)</a>, and is faster and more convenient than reading from <i class="file">/dev/urandom</i> directly.<p>
<b class="fname">arc4random</b>() returns an integer in [0, 2^32) chosen independently with uniform distribution.<p>
<b class="fname">arc4random_uniform</b>() returns an integer in [0, <i class="farg">bound</i>) chosen independently with uniform distribution.<p>
<b class="fname">arc4random_buf</b>() stores <i class="farg">len</i> bytes into the memory pointed to by <i class="farg">buf</i>, each byte chosen independently from [0, 256) with uniform distribution.<p>
<b class="fname">arc4random_stir</b>() draws entropy from the operating system and incorporates it into the library's PRNG state to influence future outputs.<p>
<b class="fname">arc4random_addrandom</b>() incorporates <i class="farg">len</i> bytes, which must be nonnegative, from the buffer <i class="farg">buf</i>, into the library's PRNG state to influence future outputs.<p>
It is not necessary for an application to call <b class="fname">arc4random_stir</b>() or <b class="fname">arc4random_addrandom</b>() before calling other <b class="name">arc4random</b> functions. The first call to any <b class="name">arc4random</b> function will initialize the PRNG state unpredictably from the system entropy pool.</div>
<div class="section">
<h1 id="x5345435552495459204d4f44454c">SECURITY MODEL</h1> The <b class="name">arc4random</b> functions provide the following security properties against three different classes of attackers, assuming enough entropy is provided by the operating system:<ul style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 4.00ex;" class="list list-bul">
<li class="list-bul" style="margin-top: 1.00em;">
An attacker who has seen some outputs of any of the <b class="name">arc4random</b> functions cannot predict past or future unseen outputs.</li>
<li class="list-bul" style="margin-top: 1.00em;">
An attacker who has seen the library's PRNG state in memory cannot predict past outputs.</li>
<li class="list-bul" style="margin-top: 1.00em;">
An attacker who has seen one process's PRNG state cannot predict past or future outputs in other processes, particularly its parent or siblings.</li>
</ul>
<p>
One &#8216;output&#8217; means the result of any single request to an <b class="name">arc4random</b> function, no matter how short it is.</div>
<div class="section">
<h1 id="x494d504c454d454e544154494f4e204e4f544553">IMPLEMENTATION NOTES</h1> The <b class="name">arc4random</b> functions are currently implemented using the ChaCha20 pseudorandom function family. For any 32-byte string <i class="farg">s</i>, ChaCha20_<i class="farg">s</i> is a function from 16-byte strings to 64-byte strings. It is conjectured that if <i class="farg">s</i> is chosen with uniform distribution, then the distribution on ChaCha20_<i class="farg">s</i> is indistinguishable to a computationally bounded adversary from a uniform distribution on all functions from 16-byte strings to 64-byte strings.<p>
The PRNG state is a 32-byte ChaCha20 key <i class="farg">s</i>. Each request to an <b class="name">arc4random</b> function<ul style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 4.00ex;" class="list list-bul">
<li class="list-bul" style="margin-top: 0.00em;">
computes the 64-byte quantity <i class="farg">x</i> = ChaCha20_<i class="farg">s</i>(0),</li>
<li class="list-bul" style="margin-top: 0.00em;">
splits <i class="farg">x</i> into two 32-byte quantities <i class="farg">s'</i> and <i class="farg">k</i>,</li>
<li class="list-bul" style="margin-top: 0.00em;">
replaces <i class="farg">s</i> by <i class="farg">s'</i>, and</li>
<li class="list-bul" style="margin-top: 0.00em;">
uses <i class="farg">k</i> as output.</li>
</ul>
<p>
<b class="fname">arc4random</b>() yields the first four bytes of <i class="farg">k</i> as output directly. <b class="fname">arc4random_buf</b>() either yields up to 32 bytes of <i class="farg">k</i> as output directly, or, for longer requests, uses <i class="farg">k</i> as a ChaCha20 key and yields the concatenation ChaCha20_<i class="farg">k</i>(0) || ChaCha20_<i class="farg">k</i>(1) || ... as output. <b class="fname">arc4random_uniform</b>() repeats <b class="fname">arc4random</b>() until it obtains an integer in [2^32 % <i class="farg">bound</i>, 2^32), and reduces that modulo <i class="farg">bound</i>.<p>
The PRNG state is per-thread, unless memory allocation fails inside the library, in which case some threads may share global PRNG state with a mutex. The global PRNG state is zeroed on fork in the parent via <a class="link-man" href="../3/pthread_atfork">pthread_atfork(3)</a>, and the per-thread PRNG state is zeroed on fork in the child via <a class="link-man" href="../2/minherit">minherit(2)</a> with <span class="define">MAP_INHERIT_ZERO</span>, so that the child cannot reuse or see the parent's PRNG state. The PRNG state is reseeded automatically from the system entropy pool on the first use of an <b class="name">arc4random</b> function after zeroing.<p>
The first use of an <b class="name">arc4random</b> function may abort the process in the highly unlikely event that library initialization necessary to implement the security model fails. Additionally, <b class="fname">arc4random_stir</b>() and <b class="fname">arc4random_addrandom</b>() may abort the process in the highly unlikely event that the operating system fails to provide entropy.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../3/rand">rand(3)</a>, <a class="link-man" href="../3/random">random(3)</a>, <a class="link-man" href="../4/rnd">rnd(4)</a>, <a class="link-man" href="../9/cprng">cprng(9)</a><p>
<span class="ref"><span class="ref-auth">Daniel J. Bernstein</span>, <span class="ref-title">ChaCha, a variant of Salsa20</span>, <a class="link-ref" href="http://cr.yp.to/papers#chacha">http://cr.yp.to/papers#chacha</a>, <span class="ref-date">2008-01-28</span>, <span class="ref-opt">Document ID: 4027b5256e17b9796842e6d0f68b0b5e</span>.</span></div>
<div class="section">
<h1 id="x42554753">BUGS</h1> There is no way to get deterministic, reproducible results out of <b class="name">arc4random</b> for testing purposes.<p>
The name &#8216;arc4random&#8217; was chosen for hysterical raisins -- it was originally implemented using the RC4 stream cipher, which has been known since shortly after it was published in 1994 to have observable biases in the output, and is now known to be broken badly enough to admit practical attacks in the real world. Unfortunately, the library found widespread adoption and the name stuck before anyone recognized that it was silly.<p>
The signature of <b class="fname">arc4random_addrandom</b>() is silly. There is no reason to require casts or accept negative lengths: it should take a <span class="type">void *</span> buffer and a <span class="type">size_t</span> length. But it's too late to change that now.<p>
<b class="fname">arc4random_uniform</b>() does not help to choose integers in [0, <i class="farg">n</i>) uniformly at random when <i class="farg">n</i> &gt; 2^32.<p>
The security model of <b class="name">arc4random</b> is stronger than many applications need, and stronger than other operating systems provide. For example, applications encrypting messages with random, but not secret, initialization vectors need only prevent an adversary from guessing future outputs, since past outputs will have been published already.<p>
On the one hand, <b class="name">arc4random</b> could be marginally faster if it were not necessary to prevent an adversary who sees the state from predicting past outputs. On the other hand, there are applications in the wild that use <b class="name">arc4random</b> to generate key material, such as OpenSSH, so for the sake of <span class="unix">NetBSD</span> users it would be imprudent to weaken the security model. On the third hand, relying on the security model of <b class="name">arc4random</b> in <span class="unix">NetBSD</span> may lead you to an unpleasant surprise on another operating system whose implementation of <b class="name">arc4random</b> has a weaker security model.<p>
One may be tempted to create new APIs to accommodate different security models and performance constraints without unpleasant surprises on different operating systems. This should not be done lightly, though, because there are already too many different choices, and too many opportunities for programmers to reach for one and pick the wrong one.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
November 16, 2014</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
<>

