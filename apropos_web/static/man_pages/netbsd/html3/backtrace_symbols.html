<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/../4/strict.dtd">
>
<head>
<meta http-equiv="Content-Type" content="te../; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
BACKTRACE(3)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
BACKTRACE(3)</td>
<td class="head-vol" align="center">
Library Functions Manual</td>
<td class="head-rtitle" align="right">
BACKTRACE(3)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">backtrace</b> &#8212; <span class="desc">fill in the backtrace of the currently executing thread</span></div>
<div class="section">
<h1 id="x4c494252415259">LIBRARY</h1> <span class="lib">Backtrace Information Library (libexecinfo, &#45;lexecinfo)</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">execinfo.h</a>&gt;</b><p>
<i class="ftype">size_t</i><br>
<b class="fname">backtrace</b>(<i class="farg" style="white-space:nowrap;">void **addrlist</i>, <i class="farg" style="white-space:nowrap;">size_t len</i>);<p>
<i class="ftype">char **</i><br>
<b class="fname">backtrace_symbols</b>(<i class="farg" style="white-space:nowrap;">void * const *addrlist</i>, <i class="farg" style="white-space:nowrap;">size_t len</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">backtrace_symbols_fd</b>(<i class="farg" style="white-space:nowrap;">void * const *addrlist</i>, <i class="farg" style="white-space:nowrap;">size_t len</i>, <i class="farg" style="white-space:nowrap;">int fd</i>);<p>
<i class="ftype">char **</i><br>
<b class="fname">backtrace_symbols_fmt</b>(<i class="farg" style="white-space:nowrap;">void * const *addrlist</i>, <i class="farg" style="white-space:nowrap;">size_t len</i>, <i class="farg" style="white-space:nowrap;">const char *fmt</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">backtrace_symbols_fmt_fd</b>(<i class="farg" style="white-space:nowrap;">void * const *addrlist</i>, <i class="farg" style="white-space:nowrap;">size_t len</i>, <i class="farg" style="white-space:nowrap;">const char *fmt</i>, <i class="farg" style="white-space:nowrap;">int fd</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="fname">backtrace</b>() function places into the array pointed by <i class="farg">addrlist</i> the array of the values of the program counter for each frame called up to <i class="farg">len</i> frames. The number of frames found (which can be fewer than <i class="farg">len</i>) is returned.<p>
The <b class="fname">backtrace_symbols_fmt</b>() function takes an array of previously filled addresses from <b class="fname">backtrace</b>() in <i class="farg">addrlist</i> of <i class="farg">len</i> elements, and uses <i class="farg">fmt</i> to format them. The formatting characters available are:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">a</span></dt>
<dd class="list-tag" style="margin-left: 1.00ex;">
The numeric address of each element as would be printed using %p.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">n</span></dt>
<dd class="list-tag" style="margin-left: 1.00ex;">
The name of the nearest function symbol (smaller than the address element) as determined by <a class="link-man" href="../3/dladdr">dladdr(3)</a> if the symbol was dynamic, or looked up in the executable if static and the /proc filesystem is available to determine the executable path.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">d</span></dt>
<dd class="list-tag" style="margin-left: 1.00ex;">
The difference of the symbol address and the address element printed using 0x%tx.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">D</span></dt>
<dd class="list-tag" style="margin-left: 1.00ex;">
The difference of the symbol addresss and the address element printed using +0x%tx if non-zero, or nothing if zero.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">f</span></dt>
<dd class="list-tag" style="margin-left: 1.00ex;">
The filename of the symbol as determined by <a class="link-man" href="../3/dladdr">dladdr(3)</a>.</dd>
</dl>
<p>
The array of formatted strings is returned as a contiguous memory address which can be freed by a single <a class="link-man" href="../3/free">free(3)</a>.<p>
The <b class="fname">backtrace_symbols</b>() function is equivalent of calling <b class="fname">backtrace_symbols_fmt</b>() with a format argument of <span class="define">%a &lt;%n%D&gt; at %f</span><p>
The <b class="fname">backtrace_symbols_fd</b>() and <b class="fname">backtrace_symbols_fmt_fd</b>() are similar to the non _fd named functions, only instead of returning an array or strings, they print a new-line separated array of strings in fd, and return <span class="define">0</span> on success and <span class="define">&#45;1</span> on failure.</div>
<div class="section">
<h1 id="x52455455524e2056414c554553">RETURN VALUES</h1> The <b class="fname">backtrace</b>() function returns the number of elements that were filled in the backtrace. The <b class="fname">backtrace_symbols</b>() and <b class="fname">backtrace_symbols_fmt</b>() return a string array on success, and <span class="define">NULL</span> on failure, setting <b class="var">errno</b>. Diagnostic output may also be produced by the ELF symbol lookup functions.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../3/dladdr">dladdr(3)</a>, <a class="link-man" href="../3/elf">elf(3)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="fname">backtrace</b>() library of functions first appeared in <span class="unix">NetBSD&#160;7.0</span>.</div>
<div class="section">
<h1 id="x42554753">BUGS</h1><ol style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-enum">
<li class="list-enum" style="margin-top: 1.00em;">
Errors should not be printed but communicated to the caller differently.</li>
<li class="list-enum" style="margin-top: 1.00em;">
Because these functions use <a class="link-man" href="../3/elf">elf(3)</a> this is a separate library instead of being part of libc/libutil so that no library dependencies are introduced.</li>
<li class="list-enum" style="margin-top: 1.00em;">
The Linux versions of the functions (there are no _fmt variants) use <i class="ftype">int</i> instead of <i class="ftype">size_t</i> arguments.</li>
<li class="list-enum" style="margin-top: 1.00em;">
Since <a class="link-man" href="../3/dladdr">dladdr(3)</a> only deals with dynamic symbols, we need to find the symbols from the main portion of the program. For that we need to locate the executable, and we use procfs for finding it, which is not portable.</li>
</ol>
</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
May 26, 2012</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
<>

