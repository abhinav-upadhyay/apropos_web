<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
PTHREAD_SPIN(3)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
PTHREAD_SPIN(3)</td>
<td class="head-vol" align="center">
Library Functions Manual</td>
<td class="head-rtitle" align="right">
PTHREAD_SPIN(3)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">pthread_spin</b> &#8212; <span class="desc">spin lock interface</span></div>
<div class="section">
<h1 id="x4c494252415259">LIBRARY</h1> <span class="lib">POSIX Threads Library (libpthread, &#45;lpthread)</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">pthread.h</a>&gt;</b><p>
<i class="ftype">int</i><br>
<b class="fname">pthread_spin_init</b>(<i class="farg" style="white-space:nowrap;">pthread_spinlock_t *lock</i>, <i class="farg" style="white-space:nowrap;">int pshared</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">pthread_spin_destroy</b>(<i class="farg" style="white-space:nowrap;">pthread_spinlock_t *lock</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">pthread_spin_lock</b>(<i class="farg" style="white-space:nowrap;">pthread_spinlock_t *lock</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">pthread_spin_trylock</b>(<i class="farg" style="white-space:nowrap;">pthread_spinlock_t *lock</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">pthread_spin_unlock</b>(<i class="farg" style="white-space:nowrap;">pthread_spinlock_t *lock</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="fname">pthread_spin_init</b>() function is used to initialize a spin lock. In the <span class="unix">NetBSD</span> implementation the <i class="farg">pshared</i> parameter is currently unused and all spin locks exhibit the <span class="define">PTHREAD_PROCESS_SHARED</span> property, implying that all spin locks may be accessed by threads of multiple processes. The results of calling <b class="fname">pthread_spin_init</b>() with an already initialized lock are undefined.<p>
The <b class="fname">pthread_spin_destroy</b>() function is used to destroy a spin lock previously created with <b class="fname">pthread_spin_init</b>(). It is undefined what happens if the function is called when a thread holds the lock, or if the function is called with an uninitialized spin lock.<p>
The <b class="fname">pthread_spin_lock</b>() function acquires a spin lock on <i class="farg">lock</i>, provided that <i class="farg">lock</i> is not presently held. If the lock cannot be immediately acquired, the calling thread repeatedly retries until it can acquire the lock. Undefined behavior may follow if the calling thread holds the lock at the time the call is made.<p>
The <b class="fname">pthread_spin_trylock</b>() function performs the same locking action, but does not block if the lock cannot be immediately obtained; if the lock is held, the call fails.<p>
The <b class="fname">pthread_spin_unlock</b>() function is used to release the read/write lock previously obtained by <b class="fname">pthread_spin_lock</b>() or <b class="fname">pthread_spin_trylock</b>(). The results are undefined if the lock is not held by the calling thread.</div>
<div class="section">
<h1 id="x52455455524e2056414c554553">RETURN VALUES</h1> If successful, all described functions return zero. Otherwise an error number will be returned to indicate the error.</div>
<div class="section">
<h1 id="x4552524f5253">ERRORS</h1> The <b class="fname">pthread_spin_init</b>() function shall fail if:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ENOMEM</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
Insufficient memory exists to initialize the lock.</dd>
</dl>
<p>
The <b class="fname">pthread_spin_init</b>() function may fail if:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EINVAL</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The <i class="farg">lock</i> parameter was <span class="define">NULL</span> or the <i class="farg">pshared</i> parameter was neither <span class="define">PTHREAD_PROCESS_SHARED</span> nor <span class="define">PTHREAD_PROCESS_PRIVATE</span>.</dd>
</dl>
<p>
The <b class="fname">pthread_spin_destroy</b>() function may fail if:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EBUSY</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The system has detected an attempt to destroy the object referenced by <i class="farg">lock</i> while it is locked.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EINVAL</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The value specified by <i class="farg">lock</i> is invalid.</dd>
</dl>
<p>
The <b class="fname">pthread_spin_trylock</b>() function shall fail if:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EBUSY</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The lock could not be acquired because a writer holds the lock or was blocked on it.</dd>
</dl>
<p>
The <b class="fname">pthread_spin_lock</b>() function may fail if:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EDEADLK</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The current thread already owns <i class="farg">lock</i> for writing.</dd>
</dl>
<p>
The <b class="fname">pthread_spin_lock</b>() and <b class="fname">pthread_spin_trylock</b>() functions may fail if:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EINVAL</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The value specified by <i class="farg">lock</i> is invalid.</dd>
</dl>
<p>
The <b class="fname">pthread_spin_unlock</b>() function may fail if:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EINVAL</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The value specified by <i class="farg">lock</i> is invalid.</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html3/pthread.html">pthread(3)</a>, <a class="link-man" href="../html3/pthread_barrier.html">pthread_barrier(3)</a>, <a class="link-man" href="../html3/pthread_cond.html">pthread_cond(3)</a>, <a class="link-man" href="../html3/pthread_mutex.html">pthread_mutex(3)</a>, <a class="link-man" href="../html3/pthread_rwlock.html">pthread_rwlock(3)</a></div>
<div class="section">
<h1 id="x5354414e4441524453">STANDARDS</h1> These functions conform to IEEE Std 1003.1-2001 (&#8220;POSIX.1&#8221;).</div>
<div class="section">
<h1 id="x43415645415453">CAVEATS</h1> Applications using spin locks are vulnerable to the effects of priority inversion. Applications using real-time threads (<span class="define">SCHED_FIFO</span>), (<span class="define">SCHED_RR</span>) should not use these interfaces. Outside carefully controlled environments, priority inversion with spin locks can lead to system deadlock. Mutexes are preferable in nearly every possible use case.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
July 8, 2010</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

