<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/../4/strict.dtd">
>
<head>
<meta http-equiv="Content-Type" content="te../; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
KVM_OPEN(3)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
KVM_OPEN(3)</td>
<td class="head-vol" align="center">
Library Functions Manual</td>
<td class="head-rtitle" align="right">
KVM_OPEN(3)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">kvm_open</b>, <b class="name">kvm_openfiles</b>, <b class="name">kvm_close</b> &#8212; <span class="desc">initialize kernel virtual memory access</span></div>
<div class="section">
<h1 id="x4c494252415259">LIBRARY</h1> <span class="lib">Kernel Data Access Library (libkvm, &#45;lkvm)</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">fcntl.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">kvm.h</a>&gt;</b><p>
<i class="ftype">kvm_t *</i><br>
<b class="fname">kvm_open</b>(<i class="farg" style="white-space:nowrap;">const char *execfile</i>, <i class="farg" style="white-space:nowrap;">const char *corefile</i>, <i class="farg" style="white-space:nowrap;">char *swapfile</i>, <i class="farg" style="white-space:nowrap;">int flags</i>, <i class="farg" style="white-space:nowrap;">const char *errstr</i>);<p>
<i class="ftype">kvm_t *</i><br>
<b class="fname">kvm_openfiles</b>(<i class="farg" style="white-space:nowrap;">const char *execfile</i>, <i class="farg" style="white-space:nowrap;">const char *corefile</i>, <i class="farg" style="white-space:nowrap;">char *swapfile</i>, <i class="farg" style="white-space:nowrap;">int flags</i>, <i class="farg" style="white-space:nowrap;">char *errbuf</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">kvm_close</b>(<i class="farg" style="white-space:nowrap;">kvm_t *kd</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The functions <b class="fname">kvm_open</b>() and <b class="fname">kvm_openfiles</b>() return a descriptor used to access kernel virtual memory via the <a class="link-man" href="../3/kvm">kvm(3)</a> library routines. Both active kernels and crash dumps are accessible through this interface.<p>
<i class="farg">execfile</i> is the executable image of the kernel being examined. This file must contain a symbol table. If this argument is <span class="define">NULL</span>, the currently running system is assumed; in this case, the functions will attempt to use the <a class="link-man" href="../4/ksyms">ksyms(4)</a> device indicated by <span class="define">_PATH_KSYMS</span> in <b class="includes">&lt;<a class="link-includes">paths.h</a>&gt;</b>; if that fails, then they will use the file indicated by the <a class="link-man" href="../3/sysctl">sysctl(3)</a> variable <b class="var">machdep.booted_kernel</b>, or (if the sysctl information is not available) the default kernel path indicated by <span class="define">_PATH_UNIX</span> in <b class="includes">&lt;<a class="link-includes">paths.h</a>&gt;</b>.<p>
<i class="farg">corefile</i> is the kernel memory device file. It can be either <i class="file">/dev/mem</i> or a crash dump core generated by <a class="link-man" href="../8/savecore">savecore(8)</a>. If <i class="farg">corefile</i> is <span class="define">NULL</span>, the default indicated by <span class="define">_PATH_MEM</span> from <b class="includes">&lt;<a class="link-includes">paths.h</a>&gt;</b> is used.<p>
<i class="farg">swapfile</i> should indicate the swap device. If <span class="define">NULL</span>, <span class="define">_PATH_DRUM</span> from <b class="includes">&lt;<a class="link-includes">paths.h</a>&gt;</b> is used.<p>
The <i class="farg">flags</i> argument indicates read/write access as in <a class="link-man" href="../2/open">open(2)</a> and applies only to the core file. The only permitted flags from <a class="link-man" href="../2/open">open(2)</a> are <span class="define">O_RDONLY</span>, <span class="define">O_WRONLY</span>, and <span class="define">O_RDWR</span>.<p>
As a special case, a <i class="farg">flags</i> argument of <span class="define">KVM_NO_FILES</span> will initialize the <a class="link-man" href="../3/kvm">kvm(3)</a> library for use on active kernels only using <a class="link-man" href="../3/sysctl">sysctl(3)</a> for retrieving kernel data and ignores the <i class="farg">execfile</i>, <i class="farg">corefile</i> and <i class="farg">swapfile</i> arguments. Only a small subset of the <a class="link-man" href="../3/kvm">kvm(3)</a> library functions are available using this method. These are currently <a class="link-man" href="../3/kvm_getproc2">kvm_getproc2(3)</a>, <a class="link-man" href="../3/kvm_getargv2">kvm_getargv2(3)</a> and <a class="link-man" href="../3/kvm_getenvv2">kvm_getenvv2(3)</a>.<p>
There are two open routines which differ only with respect to the error mechanism. One provides backward compatibility with the SunOS kvm library, while the other provides an improved error reporting framework.<p>
The <b class="fname">kvm_open</b>() function is the Sun kvm compatible open call. Here, the <i class="farg">errstr</i> argument indicates how errors should be handled. If it is <span class="define">NULL</span>, no errors are reported and the application cannot know the specific nature of the failed kvm call. If it is not <span class="define">NULL</span>, errors are printed to stderr with <i class="farg">errstr</i> prepended to the message, as in <a class="link-man" href="../3/perror">perror(3)</a>. Normally, the name of the program is used here. The string is assumed to persist at least until the corresponding <b class="fname">kvm_close</b>() call.<p>
The <b class="fname">kvm_openfiles</b>() function provides <span class="unix">BSD</span> style error reporting. Here, error messages are not printed out by the library. Instead, the application obtains the error message corresponding to the most recent kvm library call using <b class="fname">kvm_geterr</b>() (see <a class="link-man" href="../3/kvm_geterr">kvm_geterr(3)</a>). The results are undefined if the most recent kvm call did not produce an error. Since <b class="fname">kvm_geterr</b>() requires a kvm descriptor, but the open routines return <span class="define">NULL</span> on failure, <b class="fname">kvm_geterr</b>() cannot be used to get the error message if open fails. Thus, <b class="fname">kvm_openfiles</b>() will place any error message in the <i class="farg">errbuf</i> argument. This buffer should be _POSIX2_LINE_MAX characters large (from <b class="includes">&lt;<a class="link-includes">limits.h</a>&gt;</b>).</div>
<div class="section">
<h1 id="x52455455524e2056414c554553">RETURN VALUES</h1> The <b class="fname">kvm_open</b>() and <b class="fname">kvm_openfiles</b>() functions both return a descriptor to be used in all subsequent kvm library calls. The library is fully re-entrant. On failure, <span class="define">NULL</span> is returned, in which case <b class="fname">kvm_openfiles</b>() writes the error message into <i class="farg">errbuf</i>.<p>
The <b class="fname">kvm_close</b>() function returns 0 on success and -1 on failure.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../2/open">open(2)</a>, <a class="link-man" href="../3/kvm">kvm(3)</a>, <a class="link-man" href="../3/kvm_getargv">kvm_getargv(3)</a>, <a class="link-man" href="../3/kvm_getenvv">kvm_getenvv(3)</a>, <a class="link-man" href="../3/kvm_geterr">kvm_geterr(3)</a>, <a class="link-man" href="../3/kvm_getkernelname">kvm_getkernelname(3)</a>, <a class="link-man" href="../3/kvm_getprocs">kvm_getprocs(3)</a>, <a class="link-man" href="../3/kvm_nlist">kvm_nlist(3)</a>, <a class="link-man" href="../3/kvm_read">kvm_read(3)</a>, <a class="link-man" href="../3/kvm_write">kvm_write(3)</a></div>
<div class="section">
<h1 id="x42554753">BUGS</h1> There should not be two open calls. The ill-defined error semantics of the Sun library and the desire to have a backward-compatible library for <span class="unix">BSD</span> left little choice.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
September 14, 2011</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
<>

