<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
FUNOPEN(3)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
FUNOPEN(3)</td>
<td class="head-vol" align="center">
Library Functions Manual</td>
<td class="head-rtitle" align="right">
FUNOPEN(3)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">funopen</b>, <b class="name">funopen2</b>, <b class="name">fropen</b>, <b class="name">fropen2</b>, <b class="name">fwopen</b>, <b class="name">fwopen2</b> &#8212; <span class="desc">open a stream</span></div>
<div class="section">
<h1 id="x4c494252415259">LIBRARY</h1> <span class="lib">Standard C Library (libc, &#45;lc)</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">stdio.h</a>&gt;</b><p>
<i class="ftype">FILE *</i><br>
<b class="fname">funopen</b>(<i class="farg" style="white-space:nowrap;">void *cookie</i>, <i class="farg" style="white-space:nowrap;">int (*readfn)(void *, char *, int)</i>, <i class="farg" style="white-space:nowrap;">int (*writefn)(void *, const char *, int)</i>, <i class="farg" style="white-space:nowrap;">off_t (*seekfn)(void *, off_t, int)</i>, <i class="farg" style="white-space:nowrap;">int (*closefn)(void *)</i>);<p>
<b class="fname">funopen2</b>(<i class="farg" style="white-space:nowrap;">void *cookie</i>, <i class="farg" style="white-space:nowrap;">ssize_t (*readfn)(void *, void *, size_t)</i>, <i class="farg" style="white-space:nowrap;">ssize_t (*writefn)(void *, const void *, size_t)</i>, <i class="farg" style="white-space:nowrap;">off_t (*seekfn)(void *, off_t, int)</i>, <i class="farg" style="white-space:nowrap;">int (*flushfn)(void *)</i>, <i class="farg" style="white-space:nowrap;">int (*closefn)(void *)</i>);<p>
<i class="ftype">FILE *</i><br>
<b class="fname">fropen</b>(<i class="farg" style="white-space:nowrap;">void *cookie</i>, <i class="farg" style="white-space:nowrap;">int (*readfn)(void *, char *, int)</i>);<p>
<i class="ftype">FILE *</i><br>
<b class="fname">fropen2</b>(<i class="farg" style="white-space:nowrap;">void *cookie</i>, <i class="farg" style="white-space:nowrap;">ssize_t (*readfn)(void *, void *, size_t)</i>);<p>
<i class="ftype">FILE *</i><br>
<b class="fname">fwopen</b>(<i class="farg" style="white-space:nowrap;">void *cookie</i>, <i class="farg" style="white-space:nowrap;">int (*writefn)(void *, const char *, int)</i>);<p>
<i class="ftype">FILE *</i><br>
<b class="fname">fwopen2</b>(<i class="farg" style="white-space:nowrap;">void *cookie</i>, <i class="farg" style="white-space:nowrap;">ssize_t (*writefn)(void *, const void *, size_t)</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="fname">funopen</b>() function associates a stream with up to four &#8220;I/O functions&#8221;. Either <i class="farg">readfn</i> or <i class="farg">writefn</i> must be specified; the others can be given as an appropriately-typed <span class="define">NULL</span> pointer. These I/O functions will be used to read, write, seek and close the new stream.<p>
The <b class="fname">funopen2</b>() function provides sightly different read and write signatures, which match better the corresponding system calls, plus the ability to augment the streams default flushing function. If a flushing function is provided, then it is called after all data has been written to the stream.<p>
In general, omitting a function means that any attempt to perform the associated operation on the resulting stream will fail. If the close function is omitted, closing the stream will flush any buffered output and then succeed.<p>
The calling conventions of <i class="farg">readfn</i>, <i class="farg">writefn</i>, <i class="farg">seekfn</i> and <i class="farg">closefn</i> must match those, respectively, of <a class="link-man" href="../html2/read.html">read(2)</a>, <a class="link-man" href="../html2/write.html">write(2)</a>, <a class="link-man" href="../html2/lseek.html">lseek(2)</a>, and <a class="link-man" href="../html2/close.html">close(2)</a>; except that they are passed the <i class="farg">cookie</i> argument specified to <b class="fname">funopen</b>() in place of the traditional file descriptor argument.<p>
Read and write I/O functions are allowed to change the underlying buffer on fully buffered or line buffered streams by calling <a class="link-man" href="../html3/setvbuf.html">setvbuf(3)</a>. They are also not required to completely fill or empty the buffer. They are not, however, allowed to change streams from unbuffered to buffered or to change the state of the line buffering flag. They must also be prepared to have read or write calls occur on buffers other than the one most recently specified.<p>
All user I/O functions can report an error by returning &#45;1. Additionally, all of the functions should set the external variable <b class="var">errno</b> appropriately if an error occurs.<p>
An error on <b class="fname">closefn</b>() does not keep the stream open.<p>
As a convenience, the include file <b class="includes">&lt;<a class="link-includes">stdio.h</a>&gt;</b> defines the macros <b class="fname">fropen</b>() and <b class="fname">fwopen</b>() as calls to <b class="fname">funopen</b>() with only a read or write function specified.</div>
<div class="section">
<h1 id="x52455455524e2056414c554553">RETURN VALUES</h1> Upon successful completion, <b class="fname">funopen</b>() returns a <span class="define">FILE</span> pointer. Otherwise, <span class="define">NULL</span> is returned and the global variable <b class="var">errno</b> is set to indicate the error.</div>
<div class="section">
<h1 id="x4552524f5253">ERRORS</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EINVAL</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The <b class="fname">funopen</b>() function was called without either a read or write function. The <b class="fname">funopen</b>() function may also fail and set <b class="var">errno</b> for any of the errors specified for the routine <a class="link-man" href="../html3/malloc.html">malloc(3)</a>.</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html2/fcntl.html">fcntl(2)</a>, <a class="link-man" href="../html2/open.html">open(2)</a>, <a class="link-man" href="../html3/fclose.html">fclose(3)</a>, <a class="link-man" href="../html3/fopen.html">fopen(3)</a>, <a class="link-man" href="../html3/fseek.html">fseek(3)</a>, <a class="link-man" href="../html3/setbuf.html">setbuf(3)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="fname">funopen</b>() functions first appeared in <span class="unix">4.4BSD</span>. The <b class="fname">funopen2</b>() functions first appeared in <span class="unix">NetBSD&#160;7.0</span>.</div>
<div class="section">
<h1 id="x43415645415453">CAVEATS</h1> All three functions are specific to <span class="unix">NetBSD</span> and thus unportable.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
March 16, 2012</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

