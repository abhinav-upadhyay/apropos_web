<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="/static/man_pages/netbsd/style.css" type="text/css" media="all">
<title>
UNVIS(3)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
UNVIS(3)</td>
<td class="head-vol" align="center">
Library Functions Manual</td>
<td class="head-rtitle" align="right">
UNVIS(3)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">unvis</b>, <b class="name">strunvis</b> &#8212; <span class="desc">decode a visual representation of characters</span></div>
<div class="section">
<h1 id="x4c494252415259">LIBRARY</h1> <span class="lib">Standard C Library (libc, &#45;lc)</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">vis.h</a>&gt;</b><p>
<i class="ftype">int</i><br>
<b class="fname">unvis</b>(<i class="farg" style="white-space:nowrap;">char *cp</i>, <i class="farg" style="white-space:nowrap;">int c</i>, <i class="farg" style="white-space:nowrap;">int *astate</i>, <i class="farg" style="white-space:nowrap;">int flag</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">strunvis</b>(<i class="farg" style="white-space:nowrap;">char *dst</i>, <i class="farg" style="white-space:nowrap;">const char *src</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">strnunvis</b>(<i class="farg" style="white-space:nowrap;">char *dst</i>, <i class="farg" style="white-space:nowrap;">size_t dlen</i>, <i class="farg" style="white-space:nowrap;">const char *src</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">strunvisx</b>(<i class="farg" style="white-space:nowrap;">char *dst</i>, <i class="farg" style="white-space:nowrap;">const char *src</i>, <i class="farg" style="white-space:nowrap;">int flag</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">strnunvisx</b>(<i class="farg" style="white-space:nowrap;">char *dst</i>, <i class="farg" style="white-space:nowrap;">size_t dlen</i>, <i class="farg" style="white-space:nowrap;">const char *src</i>, <i class="farg" style="white-space:nowrap;">int flag</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="fname">unvis</b>(), <b class="fname">strunvis</b>() and <b class="fname">strunvisx</b>() functions are used to decode a visual representation of characters, as produced by the <a class="link-man" href="../3/vis">vis(3)</a> function, back into the original form.<p>
The <b class="fname">unvis</b>() function is called with successive characters in <i class="arg">c</i> until a valid sequence is recognized, at which time the decoded character is available at the character pointed to by <i class="arg">cp</i>.<p>
The <b class="fname">strunvis</b>() function decodes the characters pointed to by <i class="arg">src</i> into the buffer pointed to by <i class="arg">dst</i>. The <b class="fname">strunvis</b>() function simply copies <i class="arg">src</i> to <i class="arg">dst</i>, decoding any escape sequences along the way, and returns the number of characters placed into <i class="arg">dst</i>, or &#45;1 if an invalid escape sequence was detected. The size of <i class="arg">dst</i> should be equal to the size of <i class="arg">src</i> (that is, no expansion takes place during decoding).<p>
The <b class="fname">strunvisx</b>() function does the same as the <b class="fname">strunvis</b>() function, but it allows you to add a flag that specifies the style the string <i class="arg">src</i> is encoded with. Currently, the supported flags are: <span class="define">VIS_HTTPSTYLE</span> and <span class="define">VIS_MIMESTYLE</span>.<p>
The <b class="fname">unvis</b>() function implements a state machine that can be used to decode an arbitrary stream of bytes. All state associated with the bytes being decoded is stored outside the <b class="fname">unvis</b>() function (that is, a pointer to the state is passed in), so calls decoding different streams can be freely intermixed. To start decoding a stream of bytes, first initialize an integer to zero. Call <b class="fname">unvis</b>() with each successive byte, along with a pointer to this integer, and a pointer to a destination character. The <b class="fname">unvis</b>() function has several return codes that must be handled properly. They are:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<code class="lit">0</code> (zero)</dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
Another character is necessary; nothing has been recognized yet.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">UNVIS_VALID</span></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
A valid character has been recognized and is available at the location pointed to by <i class="farg">cp</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">UNVIS_VALIDPUSH</span></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
A valid character has been recognized and is available at the location pointed to by <i class="farg">cp</i>; however, the character currently passed in should be passed in again.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">UNVIS_NOCHAR</span></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
A valid sequence was detected, but no character was produced. This return code is necessary to indicate a logical break between characters.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">UNVIS_SYNBAD</span></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
An invalid escape sequence was detected, or the decoder is in an unknown state. The decoder is placed into the starting state.</dd>
</dl>
<p>
When all bytes in the stream have been processed, call <b class="fname">unvis</b>() one more time with flag set to <span class="define">UNVIS_END</span> to extract any remaining character (the character passed in is ignored).<p>
The <i class="farg">flag</i> argument is also used to specify the encoding style of the source. If set to <span class="define">VIS_HTTPSTYLE</span> or <span class="define">VIS_HTTP1808</span>, <b class="fname">unvis</b>() will decode URI strings as specified in RFC 1808. If set to <span class="define">VIS_HTTP1866</span>, <b class="fname">unvis</b>() will decode entity references and numeric character references as specified in RFC 1866. If set to <span class="define">VIS_MIMESTYLE</span>, <b class="fname">unvis</b>() will decode MIME Quoted-Printable strings as specified in RFC 2045. If set to <span class="define">VIS_NOESCAPE</span>, <b class="fname">unvis</b>() will not decode &#8216;<code class="lit">&#92;</code>&#8217; quoted characters.<p>
The following code fragment illustrates a proper use of <b class="fname">unvis</b>().<p>
<pre style="margin-left: 5.00ex;" class="lit display">
int state = 0; 
char out; 
 
while ((ch = getchar()) != EOF) { 
again: 
	switch(unvis(&amp;out, ch, &amp;state, 0)) { 
	case 0: 
	case UNVIS_NOCHAR: 
		break; 
	case UNVIS_VALID: 
		(void)putchar(out); 
		break; 
	case UNVIS_VALIDPUSH: 
		(void)putchar(out); 
		goto again; 
	case UNVIS_SYNBAD: 
		errx(EXIT_FAILURE, "Bad character sequence!"); 
	} 
} 
if (unvis(&amp;out, '&#92;0', &amp;state, UNVIS_END) == UNVIS_VALID) 
	(void)putchar(out);</pre>
</div>
<div class="section">
<h1 id="x4552524f5253">ERRORS</h1> The functions <b class="fname">strunvis</b>(), <b class="fname">strnunvis</b>(), <b class="fname">strunvisx</b>(), and <b class="fname">strnunvisx</b>() will return &#45;1 on error and set <b class="var">errno</b> to:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EINVAL</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
An invalid escape sequence was detected, or the decoder is in an unknown state.</dd>
</dl>
<p>
In addition the functions <b class="fname">strnunvis</b>() and <b class="fname">strnunvisx</b>() will can also set <b class="var">errno</b> on error to:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ENOSPC</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
Not enough space to perform the conversion.</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../1/unvis">unvis(1)</a>, <a class="link-man" href="../1/vis">vis(1)</a>, <a class="link-man" href="../3/vis">vis(3)</a><p>
<span class="ref"><span class="ref-auth">R. Fielding</span>, <span class="ref-title">Relative Uniform Resource Locators</span>, <span class="ref-opt">RFC1808</span>.</span></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="fname">unvis</b>() function first appeared in <span class="unix">4.4BSD</span>. The <b class="fname">strnunvis</b>() and <b class="fname">strnunvisx</b>() functions appeared in <span class="unix">NetBSD&#160;6.0</span>.</div>
<div class="section">
<h1 id="x42554753">BUGS</h1> The names <span class="define">VIS_HTTP1808</span> and <span class="define">VIS_HTTP1866</span> are wrong. Percent-encoding was defined in RFC 1738, the original RFC for URL. RFC 1866 defines HTML 2.0, an application of SGML, from which it inherits concepts of numeric character references and entity references.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
March 12, 2011</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

