<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
CRYPT(3)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
CRYPT(3)</td>
<td class="head-vol" align="center">
Library Functions Manual</td>
<td class="head-rtitle" align="right">
CRYPT(3)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">crypt</b>, <b class="name">setkey</b>, <b class="name">encrypt</b>, <b class="name">des_setkey</b>, <b class="name">des_cipher</b> &#8212; <span class="desc">password encryption</span></div>
<div class="section">
<h1 id="x4c494252415259">LIBRARY</h1> <span class="lib">Crypt Library (libcrypt, &#45;lcrypt)</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">unistd.h</a>&gt;</b><p>
<i class="ftype">char *</i><br>
<b class="fname">crypt</b>(<i class="farg" style="white-space:nowrap;">const char *key</i>, <i class="farg" style="white-space:nowrap;">const char *setting</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">encrypt</b>(<i class="farg" style="white-space:nowrap;">char *block</i>, <i class="farg" style="white-space:nowrap;">int flag</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">des_setkey</b>(<i class="farg" style="white-space:nowrap;">const char *key</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">des_cipher</b>(<i class="farg" style="white-space:nowrap;">const char *in</i>, <i class="farg" style="white-space:nowrap;">char *out</i>, <i class="farg" style="white-space:nowrap;">long salt</i>, <i class="farg" style="white-space:nowrap;">int count</i>);<p>
<b class="includes">#include &lt;<a class="link-includes">stdlib.h</a>&gt;</b><p>
<i class="ftype">int</i><br>
<b class="fname">setkey</b>(<i class="farg" style="white-space:nowrap;">const char *key</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="fname">crypt</b>() function performs password encryption. The encryption scheme used by <b class="fname">crypt</b>() is dependent upon the contents of the <span class="define">NUL</span>-terminated string <i class="arg">setting</i>. If it begins with a string character (&#8216;<code class="lit">$</code>&#8217;) and a number then a different algorithm is used depending on the number. At the moment a &#8216;<code class="lit">$1</code>&#8217; chooses MD5 hashing and a &#8216;<code class="lit">$2</code>&#8217; chooses Blowfish hashing; see below for more information. If <i class="arg">setting</i> begins with the ``_'' character, DES encryption with a user specified number of perturbations is selected. If <i class="arg">setting</i> begins with any other character, DES encryption with a fixed number of perturbations is selected.<div class="subsection">
<h2 id="x44455320656e6372797074696f6e">DES encryption</h2> The DES encryption scheme is derived from the NBS Data Encryption Standard. Additional code has been added to deter key search attempts and to use stronger hashing algorithms. In the DES case, the second argument to <b class="fname">crypt</b>() is a character array, 9 bytes in length, consisting of an underscore (``_'') followed by 4 bytes of iteration count and 4 bytes of salt. Both the iteration <i class="farg">count</i> and the <i class="farg">salt</i> are encoded with 6 bits per character, least significant bits first. The values 0 to 63 are encoded by the characters ``./0-9A-Za-z'', respectively.<p>
The <i class="farg">salt</i> is used to induce disorder in to the DES algorithm in one of 16777216 possible ways (specifically, if bit <span class="emph">i</span> of the <i class="arg">salt</i> is set then bits <span class="emph">i</span> and <span class="emph">i+24</span> are swapped in the DES ``E'' box output). The <i class="arg">key</i> is divided into groups of 8 characters (a short final group is null-padded) and the low-order 7 bits of each character (56 bits per group) are used to form the DES key as follows: the first group of 56 bits becomes the initial DES key. For each additional group, the XOR of the group bits and the encryption of the DES key with itself becomes the next DES key. Then the final DES key is used to perform <i class="arg">count</i> cumulative encryptions of a 64-bit constant. The value returned is a <span class="define">NUL</span>-terminated string, 20 bytes in length, consisting of the <i class="arg">setting</i> followed by the encoded 64-bit encryption.<p>
For compatibility with historical versions of <b class="fname">crypt</b>(), the <i class="arg">setting</i> may consist of 2 bytes of salt, encoded as above, in which case an iteration <i class="arg">count</i> of 25 is used, fewer perturbations of DES are available, at most 8 characters of <i class="arg">key</i> are used, and the returned value is a <span class="define">NUL</span>-terminated string 13 bytes in length.<p>
The functions <b class="fname">encrypt</b>(), <b class="fname">setkey</b>(), <b class="fname">des_setkey</b>() and <b class="fname">des_cipher</b>() allow limited access to the DES algorithm itself. The <i class="arg">key</i> argument to <b class="fname">setkey</b>() is a 64 character array of binary values (numeric 0 or 1). A 56-bit key is derived from this array by dividing the array into groups of 8 and ignoring the last bit in each group.<p>
The <b class="fname">encrypt</b>() argument <i class="farg">block</i> is also a 64 character array of binary values. If the value of <i class="farg">flag</i> is 0, the argument <i class="farg">block</i> is encrypted, otherwise it is decrypted. The encryption or decryption is returned in the original array <i class="farg">block</i> after using the key specified by <b class="fname">setkey</b>() to process it.<p>
The <b class="fname">des_setkey</b>() and <b class="fname">des_cipher</b>() functions are faster but less portable than <b class="fname">setkey</b>() and <b class="fname">encrypt</b>(). The argument to <b class="fname">des_setkey</b>() is a character array of length 8. The <span class="emph">least</span> significant bit in each character is ignored and the next 7 bits of each character are concatenated to yield a 56-bit key. The function <b class="fname">des_cipher</b>() encrypts (or decrypts if <i class="farg">count</i> is negative) the 64-bits stored in the 8 characters at <i class="farg">in</i> using <a class="link-man" href="../html3/abs.html">abs(3)</a> of <i class="farg">count</i> iterations of DES and stores the 64-bit result in the 8 characters at <i class="farg">out</i>. The <i class="farg">salt</i> specifies perturbations to DES as described above.</div>
<div class="subsection">
<h2 id="x4d443520656e6372797074696f6e">MD5 encryption</h2> For the MD5 encryption scheme, the version number (in this case ``1''), <i class="farg">salt</i> and the hashed password are separated by the ``$'' character. A valid password looks like this:<p>
``$1$2qGr5PPQ$eT08WBFev3RPLNChixg0H.''.<p>
The entire password string is passed as <i class="farg">setting</i> for interpretation.</div>
<div class="subsection">
<h2 id="x426c6f7766697368206372797074">Blowfish crypt</h2> The Blowfish version of <b class="fname">crypt</b>() has 128 bits of <i class="farg">salt</i> in order to make building dictionaries of common passwords space consuming. The initial state of the Blowfish cipher is expanded using the <i class="farg">salt</i> and the <i class="farg">password</i> repeating the process a variable number of rounds, which is encoded in the password string. The maximum password length is 72. The final Blowfish password entry is created by encrypting the string<p>
&#8220;OrpheanBeholderScryDoubt&#8221;<p>
with the Blowfish state 64 times.<p>
The version number, the logarithm of the number of rounds and the concatenation of salt and hashed password are separated by the &#8216;<code class="lit">$</code>&#8217; character. An encoded &#8216;8&#8217; would specify 256 rounds. A valid Blowfish password looks like this:<p>
&#8220;$2a$12$eIAq8PR8sIUnJ1HaohxX2O9x9Qlm2vK97LJ5dsXdmB.eXF42qjchC&#8221;.<p>
The whole Blowfish password string is passed as <i class="farg">setting</i> for interpretation.</div>
</div>
<div class="section">
<h1 id="x52455455524e2056414c554553">RETURN VALUES</h1> The function <b class="fname">crypt</b>() returns a pointer to the encrypted value on success.<p>
The behavior of <b class="fname">crypt</b>() on errors isn't well standardized. Some implementations simply can't fail (unless the process dies, in which case they obviously can't return), others return <span class="define">NULL</span> or a fixed string. Most implementations don't set <b class="var">errno</b>, but some do. Version&#160;2 of the Single UNIX Specification (&#8220;SUSv2&#8221;) specifies only returning <span class="define">NULL</span> and setting <b class="var">errno</b> as a valid behavior, and defines only one possible error (<span class="errno">ENOSYS</span>, &#8220;The functionality is not supported on this implementation.&#8221;) Unfortunately, most existing applications aren't prepared to handle <span class="define">NULL</span> returns from <b class="fname">crypt</b>(). The description below corresponds to this implementation of <b class="fname">crypt</b>() only. The behavior may change to match standards, other implementations or existing applications.<p>
<b class="fname">crypt</b>() may only fail (and return) when passed an invalid or unsupported <i class="farg">setting</i>, in which case it returns a pointer to a magic string that is shorter than 13 characters and is guaranteed to differ from <i class="farg">setting</i>. This behavior is safe for older applications which assume that <b class="fname">crypt</b>() can't fail, when both setting new passwords and authenticating against existing password hashes.<p>
The functions <b class="fname">setkey</b>(), <b class="fname">encrypt</b>(), <b class="fname">des_setkey</b>(), and <b class="fname">des_cipher</b>() return 0 on success and 1 on failure. Historically, the functions <b class="fname">setkey</b>() and <b class="fname">encrypt</b>() did not return any value. They have been provided return values primarily to distinguish implementations where hardware support is provided but not available or where the DES encryption is not available due to the usual political silliness.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html1/login.html">login(1)</a>, <a class="link-man" href="../html1/passwd.html">passwd(1)</a>, <a class="link-man" href="../html1/pwhash.html">pwhash(1)</a>, <a class="link-man" href="../html3/getpass.html">getpass(3)</a>, <a class="link-man" href="../html3/md5.html">md5(3)</a>, <a class="link-man" href="../html5/passwd.html">passwd(5)</a>, <a class="link-man" href="../html5/passwd.conf.html">passwd.conf(5)</a><p>
<span class="ref"><span class="ref-auth">Wayne Patterson</span>, <span class="ref-title">Mathematical Cryptology for Computer Scientists and Mathematicians</span>, <span class="ref-num">ISBN 0-8476-7438-X</span>, <span class="ref-date">1987</span>.</span><p>
<span class="ref"><span class="ref-auth">R. Morris</span> and <span class="ref-auth">Ken Thompson</span>, <span class="ref-title">Password Security: A Case History</span>, <i class="ref-jrnl">Communications of the ACM</i>, <span class="ref-vol">vol. 22</span>, <span class="ref-page">pp. 594-597</span>, <span class="ref-date">Nov. 1979</span>.</span><p>
<span class="ref"><span class="ref-auth">M.E. Hellman</span>, <span class="ref-title">DES will be Totally Insecure within Ten Years</span>, <i class="ref-jrnl">IEEE Spectrum</i>, <span class="ref-vol">vol. 16</span>, <span class="ref-page">pp. 32-39</span>, <span class="ref-date">July 1979</span>.</span></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> A rotor-based <b class="fname">crypt</b>() function appeared in Version&#160;6 AT&amp;T UNIX. The current style <b class="fname">crypt</b>() first appeared in Version&#160;7 AT&amp;T UNIX.</div>
<div class="section">
<h1 id="x42554753">BUGS</h1> Dropping the <span class="emph">least</span> significant bit in each character of the argument to <b class="fname">des_setkey</b>() is ridiculous.<p>
The <b class="fname">crypt</b>() function leaves its result in an internal static object and returns a pointer to that object. Subsequent calls to <b class="fname">crypt</b>() will modify the same object.<p>
Before <span class="unix">NetBSD&#160;6.0</span> <b class="fname">crypt</b>() returned either <span class="define">NULL</span> or <span class="define">:</span> on error.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
January 1, 2012</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

