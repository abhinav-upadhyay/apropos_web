<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="/static/man_pages/netbsd/style.css" type="text/css" media="all">
<title>
PTHREAD_KEY_CREATE(3)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
PTHREAD_KEY_CREATE(3)</td>
<td class="head-vol" align="center">
Library Functions Manual</td>
<td class="head-rtitle" align="right">
PTHREAD_KEY_CREATE(3)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">pthread_key_create</b> &#8212; <span class="desc">thread-specific data</span></div>
<div class="section">
<h1 id="x4c494252415259">LIBRARY</h1> <span class="lib">POSIX Threads Library (libpthread, &#45;lpthread)</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">pthread.h</a>&gt;</b><p>
<i class="ftype">int</i><br>
<b class="fname">pthread_key_create</b>(<i class="farg" style="white-space:nowrap;">pthread_key_t *key</i>, <i class="farg" style="white-space:nowrap;">void (*destructor)(void *)</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">pthread_key_delete</b>(<i class="farg" style="white-space:nowrap;">pthread_key_t key</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="fname">pthread_key_create</b>() function creates a thread-specific data key visible to all threads in the process. Key values are opaque objects used to locate thread-specific data. The same key value may be used by different threads, but the values bound to the key by <b class="fname">pthread_setspecific</b>() are maintained on a per-thread basis and persist for the life of the calling thread.<p>
Upon key creation, the value <span class="define">NULL</span> is associated with the new key in all active threads. Upon thread creation, the value <span class="define">NULL</span> is associated with all defined keys in the new thread.<p>
An optional destructor function may be associated with each key value. At thread exit, if a key value has a non-<span class="define">NULL</span> destructor pointer, and the thread has a non-<span class="define">NULL</span> value associated with the key, the function pointed to is called with the current associated value as its sole argument. The order of destructor calls is unspecified if more than one destructor exists for a thread when it exits.<p>
If, after all the destructors have been called for all non-<span class="define">NULL</span> values with associated destructors, there are still some non-<span class="define">NULL</span> values with associated destructors, then the process is repeated. If, after at least <span class="define">PTHREAD_DESTRUCTOR_ITERATIONS</span> iterations of destructor calls for outstanding non-<span class="define">NULL</span> values, there are still some non-<span class="define">NULL</span> values with associated destructors, the implementation stops calling destructors.<p>
The <b class="fname">pthread_key_delete</b>() function deletes a thread-specific data key previously returned by <b class="fname">pthread_key_create</b>(). The thread-specific data values associated with <i class="farg">key</i> need not be <span class="define">NULL</span> at the time of the call. It is the responsibility of the application to free any application storage or perform any cleanup actions for data structures related to the deleted key or associated thread-specific data in any threads; this cleanup can be done either before or after <b class="fname">pthread_key_delete</b>() is called. Any attempt to use <i class="farg">key</i> following the call to <b class="fname">pthread_key_delete</b>() results in undefined behavior.<p>
The <b class="fname">pthread_key_delete</b>() function itself is callable from within destructor functions, but destructor functions are not invoked by the function. Any destructor function that may have been associated with <i class="farg">key</i> will no longer be called upon thread exit.</div>
<div class="section">
<h1 id="x52455455524e2056414c554553">RETURN VALUES</h1> If successful, the <b class="fname">pthread_key_create</b>() function will store the newly created key value at the location specified by <i class="farg">key</i> and returns zero. Also <b class="fname">pthread_key_delete</b>() will return zero upon success. Upon failure both functions return an error number to indicate the cause.</div>
<div class="section">
<h1 id="x454e5649524f4e4d454e54">ENVIRONMENT</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="env">PTHREAD_KEYS_MAX</span></dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
Maximum per-process thread-specific data keys. This cannot be set below <span class="define">_POSIX_THREAD_KEYS_MAX</span>.</dd>
</dl>
</div>
<div class="section">
<h1 id="x4552524f5253">ERRORS</h1> The <b class="fname">pthread_key_create</b>() may fail if:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EAGAIN</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The system lacked the necessary resources to create another thread-specific data key, or the system-imposed limit on the total number of keys per-process <span class="define">PTHREAD_KEYS_MAX</span> would be exceeded.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ENOMEM</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
Insufficient memory exists to create the key.</dd>
</dl>
<p>
The <b class="fname">pthread_key_delete</b>() function may fail if:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EINVAL</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The <i class="farg">key</i> value is invalid.</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../3/pthread_getspecific">pthread_getspecific(3)</a></div>
<div class="section">
<h1 id="x5354414e4441524453">STANDARDS</h1> These functions conform to IEEE Std 1003.1-2001 (&#8220;POSIX.1&#8221;).</div>
<div class="section">
<h1 id="x42554753">BUGS</h1> The current specifications are flawed and do not permit a clean implementation without potential problems. The current implementation in <span class="unix">NetBSD</span> addresses these problems by not supporting key reuse.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
May 29, 2015</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

