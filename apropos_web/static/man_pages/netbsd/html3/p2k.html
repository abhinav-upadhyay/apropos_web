<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="/static/man_pages/netbsd/style.css" type="text/css" media="all">
<title>
P2K(3)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
P2K(3)</td>
<td class="head-vol" align="center">
Library Functions Manual</td>
<td class="head-rtitle" align="right">
P2K(3)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">p2k</b> &#8212; <span class="desc">puffs to kernel vfs translation library</span></div>
<div class="section">
<h1 id="x4c494252415259">LIBRARY</h1> p2k Library (libp2k, &#45;lp2k)</div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">rump/p2k.h</a>&gt;</b><p>
<i class="ftype">struct p2k_mount *</i><br>
<b class="fname">p2k_init</b>(<i class="farg" style="white-space:nowrap;">uint32_t puffs_flags</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">p2k_cancel</b>(<i class="farg" style="white-space:nowrap;">struct p2k_mount *p2m</i>, <i class="farg" style="white-space:nowrap;">int error</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">p2k_setup_fs</b>(<i class="farg">struct p2k_mount *p2m</i>, <i class="farg">const char *vfsname</i>, <i class="farg">const char *devpath</i>, <i class="farg">const char *mountpath</i>, <i class="farg">int mntflags</i>, <i class="farg">void *arg</i>, <i class="farg">size_t alen</i>);<p>
<b class="fname">p2k_setup_diskfs</b>(<i class="farg">struct p2k_mount *p2m</i>, <i class="farg">const char *vfsname</i>, <i class="farg">const char *devpath</i>, <i class="farg">int partition</i>, <i class="farg">const char *mountpath</i>, <i class="farg">int mntflags</i>, <i class="farg">void *arg</i>, <i class="farg">size_t alen</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">p2k_mainloop</b>(<i class="farg" style="white-space:nowrap;">struct p2k_mount *p2m</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">p2k_run_fs</b>(<i class="farg">const char *vfsname</i>, <i class="farg">const char *devpath</i>, <i class="farg">const char *mountpath</i>, <i class="farg">int mntflags</i>, <i class="farg">void *arg</i>, <i class="farg">size_t alen</i>, <i class="farg">uint32_t puffs_flags</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">p2k_run_diskfs</b>(<i class="farg">const char *vfsname</i>, <i class="farg">const char *devpath</i>, <i class="farg">int partition</i>, <i class="farg">const char *mountpath</i>, <i class="farg">int mntflags</i>, <i class="farg">void *arg</i>, <i class="farg">size_t alen</i>, <i class="farg">uint32_t puffs_flags</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="name">p2k</b> library translates the puffs protocol to the kernel <a class="link-man" href="../9/vfs">vfs(9)</a> protocol and back again. It can therefore be used to mount and run kernel file system code as a userspace daemon.<p>
Calling the library interface function mounts the file system and, if succesful, starts handling requests. The parameters are handled by <b class="fname">ukfs_mount</b>() (see <a class="link-man" href="../3/ukfs">ukfs(3)</a>), with the exception that <i class="farg">mountpath</i> and <i class="farg">puffs_flags</i> are handled by <a class="link-man" href="../3/puffs">puffs(3)</a>. The "run_fs" variants of the interfaces are provided as a convenience for the common case. They execute all of init, setup and mainloop in one call.</div>
<div class="section">
<h1 id="x454e5649524f4e4d454e54">ENVIRONMENT</h1> The following environment variables affect the behaviour of <b class="name">p2k</b>. They are useful mostly for debugging purposes. The flags are environment variables because typically the command line arguments to <b class="name">p2k</b> utilities are parsed using versions not aware of <b class="name">p2k</b> options; for example, the <a class="link-man" href="../8/rump_cd9660">rump_cd9660(8)</a> arguments are really parsed by <a class="link-man" href="../8/mount_cd9660">mount_cd9660(8)</a>.<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 2.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">P2K_DEBUG</span></dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
Do not detach from tty and print information about each puffs operation. In case the daemon receives <span class="define">SIGINFO</span> (typically from ctrl-T), it dumps out the status of the mount point. Sending <span class="define">SIGUSR1</span> causes a dump of all the vnodes (verbose).</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">P2K_NODETACH</span></dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
Do not detach from tty.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">P2K_NOCACHE_PAGE</span></dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
Do not use the puffs page cache.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">P2K_NOCACHE_NAME</span></dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
Do not use the puffs name cache.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">P2K_NOCACHE</span></dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
Do not use the puffs page or name cache.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">P2K_WIZARDUID</span></dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
If set, use the value of the variable to determine the UID of the caller of each operation instead of the actual caller supplied by <a class="link-man" href="../3/puffs">puffs(3)</a>. This can be used for example to simplify modifying an OS installation's root image as a non-root user.</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../3/puffs">puffs(3)</a>, <a class="link-man" href="../3/rump">rump(3)</a>, <a class="link-man" href="../3/ukfs">ukfs(3)</a>, <a class="link-man" href="../8/rump_cd9660">rump_cd9660(8)</a>, <a class="link-man" href="../8/rump_efs">rump_efs(8)</a>, <a class="link-man" href="../8/rump_ext2fs">rump_ext2fs(8)</a>, <a class="link-man" href="../8/rump_ffs">rump_ffs(8)</a>, <a class="link-man" href="../8/rump_hfs">rump_hfs(8)</a>, <a class="link-man" href="../8/rump_lfs">rump_lfs(8)</a>, <a class="link-man" href="../8/rump_msdos">rump_msdos(8)</a>, <a class="link-man" href="../8/rump_nfs">rump_nfs(8)</a>, <a class="link-man" href="../8/rump_ntfs">rump_ntfs(8)</a>, <a class="link-man" href="../8/rump_smbfs">rump_smbfs(8)</a>, <a class="link-man" href="../8/rump_syspuffs">rump_syspuffs(8)</a>, <a class="link-man" href="../8/rump_sysvbfs">rump_sysvbfs(8)</a>, <a class="link-man" href="../8/rump_tmpfs">rump_tmpfs(8)</a>, <a class="link-man" href="../8/rump_udf">rump_udf(8)</a></div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
January 7, 2011</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

