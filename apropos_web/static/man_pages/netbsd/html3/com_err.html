<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
COM_ERR(3)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
COM_ERR(3)</td>
<td class="head-vol" align="center">
Library Functions Manual</td>
<td class="head-rtitle" align="right">
COM_ERR(3)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">com_err</b>, <b class="name">com_err_va</b>, <b class="name">error_message</b>, <b class="name">error_table_name</b>, <b class="name">init_error_table</b>, <b class="name">set_com_err_hook</b>, <b class="name">reset_com_err_hook</b>, <b class="name">add_to_error_table</b>, <b class="name">initialize_error_table_r</b> <b class="name">free_error_table</b>, <b class="name">com_right</b> &#8212; <span class="desc">common error display library</span></div>
<div class="section">
<h1 id="x4c494252415259">LIBRARY</h1> Common Error Library (libcom_err, -lcom_err)</div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include <a class="link-includes">&lt;stdio.h&gt;</a></b><br>
<b class="includes">#include <a class="link-includes">&lt;stdarg.h&gt;</a></b><br>
<b class="includes">#include <a class="link-includes">&lt;krb5/com_err.h&gt;</a></b><br>
<b class="includes">#include <a class="link-includes">"XXX_err.h"</a></b><p>
typedef void (*errf)(const char *, long, const char *, ...);<br>
<i class="ftype">void</i><br>
<b class="fname">com_err</b>(<i class="farg" style="white-space:nowrap;">const char *whoami</i>, <i class="farg" style="white-space:nowrap;">long code</i>, <i class="farg" style="white-space:nowrap;">const char *format</i>, <i class="farg" style="white-space:nowrap;">...</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">com_err_va</b>(<i class="farg" style="white-space:nowrap;">const char *whoami</i>, <i class="farg" style="white-space:nowrap;">long code</i>, <i class="farg" style="white-space:nowrap;">const char *format</i>, <i class="farg" style="white-space:nowrap;">...</i>);<p>
<i class="ftype">const char *</i><br>
<b class="fname">error_message</b>(<i class="farg" style="white-space:nowrap;">long code</i>);<p>
<i class="ftype">const char *</i><br>
<b class="fname">error_table_name</b>(<i class="farg" style="white-space:nowrap;">int num</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">init_error_table</b>(<i class="farg" style="white-space:nowrap;">const char **msgs</i>, <i class="farg" style="white-space:nowrap;">long base</i>, <i class="farg" style="white-space:nowrap;">int count</i>);<p>
<i class="ftype">errf</i><br>
<b class="fname">set_com_err_hook</b>(<i class="farg" style="white-space:nowrap;">errf func</i>);<p>
<i class="ftype">errf</i><br>
<b class="fname">reset_com_err_hook</b>(<i class="farg" style="white-space:nowrap;"></i>);<p>
<i class="ftype">void</i><br>
<b class="fname">add_to_error_table</b>(<i class="farg" style="white-space:nowrap;">struct et_list *new_table</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">initialize_error_table_r</b>(<i class="farg" style="white-space:nowrap;">struct et_list **et_list</i>, <i class="farg" style="white-space:nowrap;">const char **msgs</i>, <i class="farg" style="white-space:nowrap;">int base</i>, <i class="farg" style="white-space:nowrap;">long count</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">free_error_table</b>(<i class="farg" style="white-space:nowrap;">struct et_list *</i>);<p>
<i class="ftype">const char *</i><br>
<b class="fname">com_right</b>(<i class="farg" style="white-space:nowrap;">struct et_list *list</i>, <i class="farg" style="white-space:nowrap;">long</i>, <i class="farg" style="white-space:nowrap;">code"</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="name">com_err</b> library provides a common error-reporting mechanism for defining and accessing error codes and descriptions for application software packages.  Error descriptions are defined in a table and error codes are used to index the table.  The error table, the descriptions and the error codes are generated using <a class="link-man" href="../html1/compile_et.html">compile_et(1)</a>.<p>
The error table is registered with the <b class="name">com_err</b> library by calling its initialisation function defined in its header file.  The initialisation function is generally defined as <b class="fname">initialize_&lt;name&gt;_error_table</b>(), where <span class="emph">name</span> is the name of the error table.<p>
If a thread-safe version of the library is needed <b class="fname">initialize_&lt;name&gt;_error_table_r</b>() that internally calls <b class="fname">initialize_error_table_r</b>() instead be used.<p>
Any variable which is to contain an error code should be declared <span class="emph">&lt;name&gt;_error_number</span> where <span class="emph">name</span> is the name of the error table.</div>
<div class="section">
<h1 id="x46554e4354494f4e53">FUNCTIONS</h1> The following functions are available to the application developer:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">com_err</b>(<i class="farg">whoami</i>, <i class="farg">code</i>, <i class="farg">format</i>, <i class="farg">...</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Displays an error message on standard error composed of the <i class="farg">whoami</i> string, which should specify the program name, followed by an error message generated from <i class="farg">code</i>, and a string produced using the <a class="link-man" href="../html3/printf.html">printf(3)</a> <i class="farg">format</i> string and any following arguments.  If <i class="farg">format</i> is NULL, the formatted message will not be printed.  The argument <i class="farg">format</i> may not be omitted.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">com_err_va</b>(<i class="farg">whoami</i>, <i class="farg">code</i>, <i class="farg">format</i>, <i class="farg">va_list args</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
This routine provides an interface, equivalent to <b class="fname">com_err</b>(), which may be used by higher-level variadic functions (functions which accept variable numbers of arguments).</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">error_message</b>(<i class="farg">code</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Returns the character string error message associated with <i class="farg">code</i>. If <i class="farg">code</i> is associated with an unknown error table, or if <i class="farg">code</i> is associated with a known error table but is not in the table, a string of the form `Unknown code XXXX NN' is returned, where XXXX is the error table name produced by reversing the compaction performed on the error table number implied by that error code, and NN is the offset from that base value.<p>
Although this routine is available for use when needed, its use should be left to circumstances which render <b class="fname">com_err</b>() unusable.<p>
<b class="fname">com_right</b>() returns the error string just like <i class="farg">com_err</i> but in a thread-safe way.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">error_table_name</b>(<i class="farg">num</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Convert a machine-independent error table number <i class="farg">num</i> into an error table name.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">init_error_table</b>(<i class="farg">msgs</i>, <i class="farg">base</i>, <i class="farg">count</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Initialise the internal error table with the array of character string error messages in <i class="farg">msgs</i> of length <i class="farg">count</i>. The error codes are assigned incrementally from <i class="farg">base</i>. This function is useful for using the error-reporting mechanism with custom error tables that have not been generated with <a class="link-man" href="../html1/compile_et.html">compile_et(1)</a>. Although this routine is available for use when needed, its use should be restricted.<p>
<b class="fname">initialize_error_table_r</b>() initialize the <i class="farg">et_list</i> in the same way as <b class="fname">init_error_table</b>(), but in a thread-safe way.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">set_com_err_hook</b>(<i class="farg">func</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Provides a hook into the <b class="name">com_err</b> library to allow the routine <i class="farg">func</i> to be dynamically substituted for <b class="fname">com_err</b>(). After <b class="fname">set_com_err_hook</b>()<br>
 has been called, calls to <b class="fname">com_err</b>() will turn into calls to the new hook routine.  This function is intended to be used in daemons to use a routine which calls <a class="link-man" href="../html3/syslog.html">syslog(3)</a>, or in a window system application to pop up a dialogue box.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">reset_com_err_hook</b>(<i class="farg"></i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Turns off the hook set in <b class="fname">set_com_err_hook</b>().</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">add_to_error_table</b>(<i class="farg">new_table</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Add the error table, its messages strings and error codes in <i class="farg">new_table</i> to the internal error table.</dd>
</dl>
</div>
<div class="section">
<h1 id="x4558414d504c4553">EXAMPLES</h1> The following is an example using the table defined in <a class="link-man" href="../html1/compile_et.html">compile_et(1)</a>:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
	#include &lt;stdio.h&gt; 
	#include &lt;stdarg.h&gt; 
	#include &lt;syslog.h&gt; 
 
	#include "test_err.h" 
 
	void 
	hook(const char *whoami, long code, 
		const char *format, va_list args) 
	{ 
		char buffer[BUFSIZ]; 
		static int initialized = 0; 
 
		if (!initialized) { 
			openlog(whoami, LOG_NOWAIT, LOG_DAEMON); 
			initialized = 1; 
		} 
		vsprintf(buffer, format, args); 
		syslog(LOG_ERR, "%s %s", error_message(code), buffer); 
	} 
 
	int 
	main(int argc, char *argv[]) 
	{ 
		char *whoami = argv[0]; 
 
		initialize_test_error_table(); 
		com_err(whoami, TEST_INVAL, "before hook"); 
		set_com_err_hook(hook); 
		com_err(whoami, TEST_IO, "after hook"); 
		return (0); 
	}</pre>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html1/compile_et.html">compile_et(1)</a></div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
July 7, 2005</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

