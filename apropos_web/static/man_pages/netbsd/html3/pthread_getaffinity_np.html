<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
AFFINITY(3)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
AFFINITY(3)</td>
<td class="head-vol" align="center">
Library Functions Manual</td>
<td class="head-rtitle" align="right">
AFFINITY(3)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">pthread_setaffinity_np</b>, <b class="name">pthread_getaffinity_np</b> &#8212; <span class="desc">affinity of threads</span></div>
<div class="section">
<h1 id="x4c494252415259">LIBRARY</h1> <span class="lib">POSIX Threads Library (libpthread, &#45;lpthread)</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">pthread.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">sched.h</a>&gt;</b><p>
<i class="ftype">int</i><br>
<b class="fname">pthread_setaffinity_np</b>(<i class="farg" style="white-space:nowrap;">pthread_t thread</i>, <i class="farg" style="white-space:nowrap;">size_t size</i>, <i class="farg" style="white-space:nowrap;">cpuset_t *set</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">pthread_getaffinity_np</b>(<i class="farg" style="white-space:nowrap;">pthread_t thread</i>, <i class="farg" style="white-space:nowrap;">size_t size</i>, <i class="farg" style="white-space:nowrap;">cpuset_t *set</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> Thread affinity allows to run the thread on specified CPU or CPUs only.<p>
The <b class="fname">pthread_setaffinity_np</b>() function sets the affinity mask <i class="farg">set</i> for <i class="farg">thread</i>. At least one valid CPU must be set in the mask.<p>
The <b class="fname">pthread_getaffinity_np</b>() function gets the affinity mask of <i class="farg">thread</i> into <i class="farg">set</i>. Note that <i class="farg">set</i> must be created and initialized using the <a class="link-man" href="../3/cpuset">cpuset(3)</a> functions.</div>
<div class="section">
<h1 id="x494d504c454d454e544154494f4e204e4f544553">IMPLEMENTATION NOTES</h1> Setting CPU <b class="name">pthread_setaffinity_np</b> requires super-user privileges. Ordinary users can be allowed to control CPU affinity of their threads via the <i class="file">security.models.extensions.user_set_cpu_affinity</i> <a class="link-man" href="../7/sysctl">sysctl(7)</a>. See <a class="link-man" href="../9/secmodel_extensions">secmodel_extensions(9)</a>.<p>
Portable applications should not use the <b class="fname">pthread_setaffinity_np</b>() and <b class="fname">pthread_getaffinity_np</b>() functions.</div>
<div class="section">
<h1 id="x52455455524e2056414c554553">RETURN VALUES</h1> The <b class="fname">pthread_setaffinity_np</b>() and <b class="fname">pthread_getaffinity_np</b>() functions return 0 on success. Otherwise, an error number is returned to indicate the error.</div>
<div class="section">
<h1 id="x4558414d504c4553">EXAMPLES</h1> An example of code fragment, which sets the affinity for the current thread to the CPU whose ID is 0:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
	cpuset_t *cset; 
	pthread_t pth; 
	cpuid_t ci; 
 
	cset = cpuset_create(); 
	if (cset == NULL) { 
		err(EXIT_FAILURE, "cpuset_create"); 
	} 
	ci = 0; 
	cpuset_set(ci, cset); 
 
	pth = pthread_self(); 
	error = pthread_setaffinity_np(pth, cpuset_size(cset), cset); 
	if (error) { 
		... 
	} 
	cpuset_destroy(cset);</pre>
</div>
<div class="section">
<h1 id="x434f4d5041544942494c495459">COMPATIBILITY</h1> Both functions are non-standard extensions.</div>
<div class="section">
<h1 id="x4552524f5253">ERRORS</h1> Both functions may fail if:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EINVAL</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The specified <i class="farg">set</i> was invalid.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EPERM</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The calling process lacks the appropriate privileges to perform the operation.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ESRCH</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
No thread could be found corresponding to the one specified by <i class="farg">thread</i>.</dd>
</dl>
</div>
<div class="section">
<h1 id="x4e4f544553">NOTES</h1> There is an alternative processor sets interface, see <a class="link-man" href="../3/pset">pset(3)</a>. However, thread affinity and processor sets are mutually exclusive, hence mixing of these interfaces is prohibited.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../3/cpuset">cpuset(3)</a>, <a class="link-man" href="../3/pset">pset(3)</a>, <a class="link-man" href="../3/pthread_getschedparam">pthread_getschedparam(3)</a>, <a class="link-man" href="../3/pthread_setschedparam">pthread_setschedparam(3)</a>, <a class="link-man" href="../3/sched">sched(3)</a>, <a class="link-man" href="../8/schedctl">schedctl(8)</a></div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
December 4, 2011</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

