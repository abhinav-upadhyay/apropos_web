<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
LIBMAGIC(3)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
LIBMAGIC(3)</td>
<td class="head-vol" align="center">
Library Functions Manual</td>
<td class="head-rtitle" align="right">
LIBMAGIC(3)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">magic_open</b>, <b class="name">magic_close</b>, <b class="name">magic_error</b>, <b class="name">magic_errno</b>, <b class="name">magic_descriptor</b>, <b class="name">magic_buffer</b>, <b class="name">magic_setflags</b>, <b class="name">magic_check</b>, <b class="name">magic_compile</b>, <b class="name">magic_list</b>, <b class="name">magic_load</b>, <b class="name">magic_load_buffers</b>, <b class="name">magic_setparam</b>, <b class="name">magic_getparam</b>, <b class="name">magic_version</b> &#8212; <span class="desc">Magic number recognition library</span></div>
<div class="section">
<h1 id="x4c494252415259">LIBRARY</h1> <span class="lib">Magic Number Recognition Library (libmagic, &#45;lmagic)</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">magic.h</a>&gt;</b><p>
<i class="ftype">magic_t</i><br>
<b class="fname">magic_open</b>(<i class="farg" style="white-space:nowrap;">int flags</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">magic_close</b>(<i class="farg" style="white-space:nowrap;">magic_t cookie</i>);<p>
<i class="ftype">const char *</i><br>
<b class="fname">magic_error</b>(<i class="farg" style="white-space:nowrap;">magic_t cookie</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">magic_errno</b>(<i class="farg" style="white-space:nowrap;">magic_t cookie</i>);<p>
<i class="ftype">const char *</i><br>
<b class="fname">magic_descriptor</b>(<i class="farg" style="white-space:nowrap;">magic_t cookie</i>, <i class="farg" style="white-space:nowrap;">int fd</i>);<p>
<i class="ftype">const char *</i><br>
<b class="fname">magic_file</b>(<i class="farg" style="white-space:nowrap;">magic_t cookie</i>, <i class="farg" style="white-space:nowrap;">const char *filename</i>);<p>
<i class="ftype">const char *</i><br>
<b class="fname">magic_buffer</b>(<i class="farg" style="white-space:nowrap;">magic_t cookie</i>, <i class="farg" style="white-space:nowrap;">const void *buffer</i>, <i class="farg" style="white-space:nowrap;">size_t length</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">magic_setflags</b>(<i class="farg" style="white-space:nowrap;">magic_t cookie</i>, <i class="farg" style="white-space:nowrap;">int flags</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">magic_check</b>(<i class="farg" style="white-space:nowrap;">magic_t cookie</i>, <i class="farg" style="white-space:nowrap;">const char *filename</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">magic_compile</b>(<i class="farg" style="white-space:nowrap;">magic_t cookie</i>, <i class="farg" style="white-space:nowrap;">const char *filename</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">magic_list</b>(<i class="farg" style="white-space:nowrap;">magic_t cookie</i>, <i class="farg" style="white-space:nowrap;">const char *filename</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">magic_load</b>(<i class="farg" style="white-space:nowrap;">magic_t cookie</i>, <i class="farg" style="white-space:nowrap;">const char *filename</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">magic_load_buffers</b>(<i class="farg" style="white-space:nowrap;">magic_t cookie</i>, <i class="farg" style="white-space:nowrap;">void **buffers</i>, <i class="farg" style="white-space:nowrap;">size_t *sizes</i>, <i class="farg" style="white-space:nowrap;">size_t nbuffers</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">magic_getparam</b>(<i class="farg" style="white-space:nowrap;">magic_t cookie</i>, <i class="farg" style="white-space:nowrap;">int param</i>, <i class="farg" style="white-space:nowrap;">void *value</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">magic_setparam</b>(<i class="farg" style="white-space:nowrap;">magic_t cookie</i>, <i class="farg" style="white-space:nowrap;">int param</i>, <i class="farg" style="white-space:nowrap;">const void *value</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">magic_version</b>(<i class="farg" style="white-space:nowrap;">void</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> These functions operate on the magic database file which is described in <a class="link-man" href="../5/magic">magic(5)</a>.<p>
The function <b class="fname">magic_open</b>() creates a magic cookie pointer and returns it. It returns <span class="define">NULL</span> if there was an error allocating the magic cookie. The <i class="arg">flags</i> argument specifies how the other magic functions should behave:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">MAGIC_NONE</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
No special handling.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">MAGIC_DEBUG</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Print debugging messages to stderr.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">MAGIC_SYMLINK</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
If the file queried is a symlink, follow it.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">MAGIC_COMPRESS</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
If the file is compressed, unpack it and look at the contents.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">MAGIC_DEVICES</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
If the file is a block or character special device, then open the device and try to look in its contents.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">MAGIC_MIME_TYPE</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Return a MIME type string, instead of a textual description.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">MAGIC_MIME_ENCODING</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Return a MIME encoding, instead of a textual description.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">MAGIC_MIME</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
A shorthand for MAGIC_MIME_TYPE | MAGIC_MIME_ENCODING.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">MAGIC_CONTINUE</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Return all matches, not just the first.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">MAGIC_CHECK</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Check the magic database for consistency and print warnings to stderr.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">MAGIC_PRESERVE_ATIME</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
On systems that support <a class="link-man" href="../3/utime">utime(3)</a> or <a class="link-man" href="../2/utimes">utimes(2)</a>, attempt to preserve the access time of files analysed.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">MAGIC_RAW</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Don't translate unprintable characters to a &#92;ooo octal representation.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">MAGIC_ERROR</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Treat operating system errors while trying to open files and follow symlinks as real errors, instead of printing them in the magic buffer.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">MAGIC_APPLE</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Return the Apple creator and type.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">MAGIC_NO_CHECK_APPTYPE</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Don't check for <span class="define">EMX</span> application type (only on EMX).</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">MAGIC_NO_CHECK_CDF</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Don't get extra information on MS Composite Document Files.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">MAGIC_NO_CHECK_COMPRESS</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Don't look inside compressed files.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">MAGIC_NO_CHECK_ELF</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Don't print ELF details.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">MAGIC_NO_CHECK_ENCODING</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Don't check text encodings.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">MAGIC_NO_CHECK_SOFT</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Don't consult magic files.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">MAGIC_NO_CHECK_TAR</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Don't examine tar files.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">MAGIC_NO_CHECK_TEXT</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Don't check for various types of text files.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">MAGIC_NO_CHECK_TOKENS</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Don't look for known tokens inside ascii files.</dd>
</dl>
<p>
The <b class="fname">magic_close</b>() function closes the <a class="link-man" href="../5/magic">magic(5)</a> database and deallocates any resources used.<p>
The <b class="fname">magic_error</b>() function returns a textual explanation of the last error, or <span class="define">NULL</span> if there was no error.<p>
The <b class="fname">magic_errno</b>() function returns the last operating system error number (<a class="link-man" href="../2/errno">errno(2)</a>) that was encountered by a system call.<p>
The <b class="fname">magic_file</b>() function returns a textual description of the contents of the <i class="arg">filename</i> argument, or <span class="define">NULL</span> if an error occurred. If the <i class="arg">filename</i> is <span class="define">NULL</span>, then stdin is used.<p>
The <b class="fname">magic_descriptor</b>() function returns a textual description of the contents of the <i class="arg">fd</i> argument, or <span class="define">NULL</span> if an error occurred.<p>
The <b class="fname">magic_buffer</b>() function returns a textual description of the contents of the <i class="arg">buffer</i> argument with <i class="arg">length</i> bytes size.<p>
The <b class="fname">magic_setflags</b>() function sets the <i class="arg">flags</i> described above. Note that using both MIME flags together can also return extra information on the charset.<p>
The <b class="fname">magic_check</b>() function can be used to check the validity of entries in the colon separated database files passed in as <i class="arg">filename</i>, or <span class="define">NULL</span> for the default database. It returns 0 on success and &#45;1 on failure.<p>
The <b class="fname">magic_compile</b>() function can be used to compile the the colon separated list of database files passed in as <i class="arg">filename</i>, or <span class="define">NULL</span> for the default database. It returns 0 on success and &#45;1 on failure. The compiled files created are named from the <a class="link-man" href="../1/basename">basename(1)</a> of each file argument with &#8220;.mgc&#8221; appended to it.<p>
The <b class="fname">magic_list</b>() function dumps all magic entries in a human readable format, dumping first the entries that are matched against binary files and then the ones that match text files. It takes and optional <i class="farg">filename</i> argument which is a colon separated list of database files, or <span class="define">NULL</span> for the default database.<p>
The <b class="fname">magic_load</b>() function must be used to load the the colon separated list of database files passed in as <i class="arg">filename</i>, or <span class="define">NULL</span> for the default database file before any magic queries can performed.<p>
The default database file is named by the MAGIC environment variable. If that variable is not set, the default database file name is <i class="file">/usr/share/misc/magic</i>. <b class="fname">magic_load</b>() adds &#8220;.mgc&#8221; to the database filename as appropriate.<p>
The <b class="fname">magic_load_buffers</b>() function takes an array of size <i class="farg">nbuffers</i> of <i class="farg">buffers</i> with a respective size for each in the array of <i class="farg">sizes</i> loaded with the contents of the magic databases from the filesystem. This function can be used in environment where the magic library does not have direct access to the filesystem, but can access the magic database via shared memory or other IPC means.<p>
The <b class="fname">magic_getparam</b>() and <b class="fname">magic_setparam</b>() allow getting and setting various limits related to the the magic library.<table style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-col">
<col style="width: 25.00ex;">
<col style="width: 6.00ex;">
<col style="min-width: 7.00ex;">
<tbody>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<span class="symb">Parameter</span></td>
<td class="list-col" style="margin-top: 1.00em;">
<span class="symb">Type</span></td>
<td class="list-col" style="margin-top: 1.00em;">
<span class="symb">Default</span></td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">MAGIC_PARAM_INDIR_MAX</code></td>
<td class="list-col" style="margin-top: 1.00em;">
size_t</td>
<td class="list-col" style="margin-top: 1.00em;">
15</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">MAGIC_PARAM_NAME_MAX</code></td>
<td class="list-col" style="margin-top: 1.00em;">
size_t</td>
<td class="list-col" style="margin-top: 1.00em;">
30</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">MAGIC_PARAM_ELF_NOTES_MAX</code></td>
<td class="list-col" style="margin-top: 1.00em;">
size_t</td>
<td class="list-col" style="margin-top: 1.00em;">
256</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">MAGIC_PARAM_ELF_PHNUM_MAX</code></td>
<td class="list-col" style="margin-top: 1.00em;">
size_t</td>
<td class="list-col" style="margin-top: 1.00em;">
128</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
<code class="lit">MAGIC_PARAM_ELF_SHNUM_MAX</code></td>
<td class="list-col" style="margin-top: 1.00em;">
size_t</td>
<td class="list-col" style="margin-top: 1.00em;">
32768</td>
</tr>
</tbody>
</table>
<p>
The <span class="define">MAGIC_PARAM_INDIR_RECURSION</span> parameter controls how many levels of recursion will be followed for indirect magic entries.<p>
The <span class="define">MAGIC_PARAM_NAME_RECURSION</span> parameter controls how many levels of recursion will be followed for for name/use calls.<p>
The <span class="define">MAGIC_PARAM_NAME_MAX</span> parameter controls the maximum number of calls for name/use.<p>
The <span class="define">MAGIC_PARAM_NOTES_MAX</span> parameter controls how many ELF notes will be processed.<p>
The <span class="define">MAGIC_PARAM_PHNUM_MAX</span> parameter controls how many ELF program sections will be processed.<p>
The <span class="define">MAGIC_PARAM_SHNUM_MAX</span> parameter controls how many ELF sections will be processed.<p>
The <b class="fname">magic_version</b>() command returns the version number of this library which is compiled into the shared library using the constant <span class="define">MAGIC_VERSION</span> from <b class="includes">&lt;<a class="link-includes">magic.h</a>&gt;</b>. This can be used by client programs to verify that the version they compile against is the same as the version that they run against.</div>
<div class="section">
<h1 id="x52455455524e2056414c554553">RETURN VALUES</h1> The function <b class="fname">magic_open</b>() returns a magic cookie on success and <span class="define">NULL</span> on failure setting errno to an appropriate value. It will set errno to <span class="errno">EINVAL</span> if an unsupported value for flags was given. The <b class="fname">magic_list</b>(), <b class="fname">magic_load</b>(), <b class="fname">magic_compile</b>(), and <b class="fname">magic_check</b>() functions return 0 on success and &#45;1 on failure. The <b class="fname">magic_buffer</b>(), <b class="fname">magic_getpath</b>(), and <b class="fname">magic_file</b>(), functions return a string on success and <span class="define">NULL</span> on failure. The <b class="fname">magic_error</b>() function returns a textual description of the errors of the above functions, or <span class="define">NULL</span> if there was no error. The <b class="fname">magic_version</b>() always returns the version number of the library. Finally, <b class="fname">magic_setflags</b>() returns &#45;1 on systems that don't support <a class="link-man" href="../3/utime">utime(3)</a>, or <a class="link-man" href="../2/utimes">utimes(2)</a> when <span class="define">MAGIC_PRESERVE_ATIME</span> is set.</div>
<div class="section">
<h1 id="x46494c4553">FILES</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/usr/share/misc/magic</i></dt>
<dd class="list-tag" style="margin-left: 25.00ex;">
The non-compiled default magic database.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/usr/share/misc/magic.mgc</i></dt>
<dd class="list-tag" style="margin-left: 25.00ex;">
The compiled default magic database.</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../1/file">file(1)</a>, <a class="link-man" href="../5/magic">magic(5)</a></div>
<div class="section">
<h1 id="x415554484f5253">AUTHORS</h1> <span class="author">M&#229;ns Rullg&#229;rd</span> Initial libmagic implementation, and configuration. <span class="author">Christos Zoulas</span> API cleanup, error code and allocation handling.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
December 16, 2014</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

