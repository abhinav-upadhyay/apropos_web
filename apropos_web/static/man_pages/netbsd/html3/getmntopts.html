<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
GETMNTOPTS(3)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
GETMNTOPTS(3)</td>
<td class="head-vol" align="center">
Library Functions Manual</td>
<td class="head-rtitle" align="right">
GETMNTOPTS(3)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">getmntopts</b> &#8212; <span class="desc">scan mount options</span></div>
<div class="section">
<h1 id="x4c494252415259">LIBRARY</h1> <span class="lib">System Utilities Library (libutil, &#45;lutil)</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">mntopts.h</a>&gt;</b><p>
<i class="ftype">mntoptparse_t</i><br>
<b class="fname">getmntopts</b>(<i class="farg" style="white-space:nowrap;">const char *options</i>, <i class="farg" style="white-space:nowrap;">const struct mntopt *mopts</i>, <i class="farg" style="white-space:nowrap;">int *flagp</i>, <i class="farg" style="white-space:nowrap;">int *altflagp</i>);<p>
<i class="ftype">const char *</i><br>
<b class="fname">getmntoptstr</b>(<i class="farg" style="white-space:nowrap;">mntoptparse_t mp</i>, <i class="farg" style="white-space:nowrap;">const char *opt</i>);<p>
<i class="ftype">long</i><br>
<b class="fname">getmntoptnum</b>(<i class="farg" style="white-space:nowrap;">mntoptparse_t mp</i>, <i class="farg" style="white-space:nowrap;">const char *opt</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">freemntopts</b>(<i class="farg" style="white-space:nowrap;">mntoptparse_t mp</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="fname">getmntopts</b>() function takes a comma separated option list and a list of valid option names, and computes the bitmasks corresponding to the requested set of options.<p>
The string <i class="arg">options</i> is broken down into a sequence of comma separated tokens. Each token is looked up in the table described by <i class="arg">mopts</i> and the bits in the word referenced by either <i class="arg">flagp</i> or <i class="arg">altflagp</i> (depending on the <span class="define">m_altloc</span> field of the option's table entry) are updated. The flag words are not initialized by <b class="fname">getmntopts</b>(). The table, <i class="arg">mopts</i>, has the following format:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
struct mntopt { 
	const char *m_option;	/* option name */ 
	int m_inverse;		/* negative option, e.g., "dev" */ 
	int m_flag;		/* bit to set, e.g., MNT_RDONLY */ 
	int m_altloc;		/* use altflagp rather than flagp */ 
};</pre>
<p>
The members of this structure are:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">m_option</i></dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
the option name, for example &#8220;suid&#8221;.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">m_inverse</i></dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
tells <b class="fname">getmntopts</b>() that the name has the inverse meaning of the bit. For example, &#8220;suid&#8221; is the string, whereas the mount flag is <span class="define">MNT_NOSUID</span>. In this case, the sense of the string and the flag are inverted, so the <i class="farg">m_inverse</i> flag should be set.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">m_flag</i></dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
the value of the bit to be set or cleared in the flag word when the option is recognized. The bit is set when the option is discovered, but cleared if the option name was preceded by the letters &#8220;no&#8221;. The <i class="farg">m_inverse</i> flag causes these two operations to be reversed.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">m_altloc</i></dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
the bit should be set or cleared in <i class="arg">altflagp</i> rather than <i class="arg">flagp</i>.</dd>
</dl>
<p>
Each of the user visible <span class="define">MNT_</span> flags has a corresponding <span class="define">MOPT_</span> macro which defines an appropriate <code class="lit">struct mntopt</code> entry. To simplify the program interface and ensure consistency across all programs, a general purpose macro, <span class="define">MOPT_STDOPTS</span>, is defined which contains an entry for all the generic VFS options. In addition, the macros <span class="define">MOPT_FORCE</span> and <span class="define">MOPT_UPDATE</span> exist to enable the <span class="define">MNT_FORCE</span> and <span class="define">MNT_UPDATE</span> flags to be set. Finally, the table must be terminated by an entry with a <span class="define">NULL</span> first element.<p>
<b class="fname">getmntopts</b>() returns a <code class="lit">mntoptparse_t</code> handle that can be used in subsequent <b class="fname">getmntoptstr</b>() and <b class="fname">getmntoptnum</b>() calls to fetch a value for an option and that must be freed with a call to <b class="fname">freemntopts</b>(). If an error occurred, then if the external integer value <b class="var">getmnt_silent</b> is zero then <b class="fname">getmntopts</b>() prints an error message and exits; if <b class="var">getmnt_silent</b> is non-zero then <b class="fname">getmntopts</b>() returns <span class="define">NULL</span>.<p>
The <b class="fname">getmntoptstr</b>() function returns the string value of the named option, if such a value was set in the option string. If the value was not set, then if the external integer value <b class="var">getmnt_silent</b> is zero then <b class="fname">getmntoptstr</b>() prints an error message and exits; if <b class="var">getmnt_silent</b> is non-zero then <b class="fname">getmntoptstr</b>() returns <span class="define">NULL</span>.<p>
The <b class="fname">getmntoptnum</b>() returns the long value of the named option, if such a value was set in the option string. If the value was not set, or could not be converted from a string to a long, then if the external integer value <b class="var">getmnt_silent</b> is zero then <b class="fname">getmntoptnum</b>() prints an error message and exits; if <b class="var">getmnt_silent</b> is non-zero then <b class="fname">getmntoptnum</b>() returns &#45;1.<p>
The <b class="fname">freemntopts</b>() frees the storage used by <b class="fname">getmntopts</b>().</div>
<div class="section">
<h1 id="x52455455524e2056414c554553">RETURN VALUES</h1> <b class="fname">getmntopts</b>() returns <span class="define">NULL</span> if an error occurred. Note that some bits may already have been set in <b class="var">flagp</b> and <b class="var">altflagp</b> even if <span class="define">NULL</span> is returned. <b class="fname">getmntoptstr</b>() returns <span class="define">NULL</span> if an error occurred. <b class="fname">getmntoptnum</b>() returns &#45;1 if an error occurred.</div>
<div class="section">
<h1 id="x4558414d504c4553">EXAMPLES</h1> Most commands will use the standard option set. Local filesystems which support the <span class="define">MNT_UPDATE</span> flag, would also have an <span class="define">MOPT_UPDATE</span> entry. This can be declared and used as follows:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
#include &lt;mntopts.h&gt; 
 
static const struct mntopt mopts[] = { 
	MOPT_STDOPTS, 
	MOPT_UPDATE, 
	{ NULL } 
}; 
 
... 
 
long val; 
mntoptparse_t mp; 
mntflags = mntaltflags = 0; 
 
... 
 
mp = getmntopts(options, mopts, &amp;mntflags, &amp;mntaltflags); 
 
if (mp == NULL) 
	err(EXIT_FAILURE, "getmntopts"); 
 
... 
 
val = getmntoptnum(mp, "rsize"); 
freemntopts(mp);</pre>
</div>
<div class="section">
<h1 id="x444941474e4f5354494353">DIAGNOSTICS</h1> If the external integer variable <b class="var">getmnt_silent</b> is zero then the <b class="fname">getmntopts</b>(), <b class="fname">getmntoptstr</b>(), and <b class="fname">getmntoptnum</b>() functions display an error message and exit if an error occurred. By default <b class="var">getmnt_silent</b> is zero.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html3/err.html">err(3)</a>, <a class="link-man" href="../html8/mount.html">mount(8)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="fname">getmntopts</b>() function appeared in <span class="unix">4.4BSD</span>. It was moved to the utilities library and enhanced to retrieve option values in <span class="unix">NetBSD&#160;2.0</span>.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
May 4, 2010</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

