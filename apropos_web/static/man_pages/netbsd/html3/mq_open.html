<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/../4/strict.dtd">
>
<head>
<meta http-equiv="Content-Type" content="te../; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
MQ_OPEN(3)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
MQ_OPEN(3)</td>
<td class="head-vol" align="center">
Library Functions Manual</td>
<td class="head-rtitle" align="right">
MQ_OPEN(3)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">mq_open</b> &#8212; <span class="desc">open a message queue (REALTIME)</span></div>
<div class="section">
<h1 id="x4c494252415259">LIBRARY</h1> <span class="lib">POSIX Real&#45;time Library (librt, &#45;lrt)</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">mqueue.h</a>&gt;</b><p>
<i class="ftype">mqd_t</i><br>
<b class="fname">mq_open</b>(<i class="farg" style="white-space:nowrap;">const char *name</i>, <i class="farg" style="white-space:nowrap;">int oflag</i>);<p>
<i class="ftype">mqd_t</i><br>
<b class="fname">mq_open</b>(<i class="farg" style="white-space:nowrap;">const char *name</i>, <i class="farg" style="white-space:nowrap;">int oflag</i>, <i class="farg" style="white-space:nowrap;">mode_t mode</i>, <i class="farg" style="white-space:nowrap;">struct mq_attr *attr</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="fname">mq_open</b>() function establishes the connection between a process and a message queue with a message queue descriptor. It creates an open message queue description that refers to the message queue, and a message queue descriptor that refers to that open message queue description. The message queue descriptor is used by other functions to refer to that message queue. The <i class="farg">name</i> argument points to a string naming a message queue, which should conform to the construction rules for a pathname. The <i class="farg">name</i> should begin with a slash character. The processes calling <b class="fname">mq_open</b>() with the same value of <i class="farg">name</i> will refer to the same message queue object, as long as that name has not been removed. If the <i class="farg">name</i> argument is not the name of an existing message queue and creation is not requested, <b class="fname">mq_open</b>() fails and returns an error.<p>
The <i class="farg">oflag</i> argument requests the desired receive and/or send access to the message queue. The requested access permission to receive messages or send messages are granted if the calling process would be granted read or write access, respectively, to an equivalently protected file.<p>
The value of <i class="farg">oflag</i> is the bitwise-inclusive OR of values from the following list. Applications must specify exactly one of the first three values (access modes) below in the value of <i class="farg">oflag</i>:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">O_RDONLY</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Open the message queue for receiving messages. The process can use the returned message queue descriptor with <a class="link-man" href="../3/mq_receive">mq_receive(3)</a>, but not <a class="link-man" href="../3/mq_send">mq_send(3)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">O_WRONLY</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Open the queue for sending messages. The process can use the returned message queue descriptor with <a class="link-man" href="../3/mq_send">mq_send(3)</a> but not <a class="link-man" href="../3/mq_receive">mq_receive(3)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">O_RDWR</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Open the queue for both receiving and sending messages. The process can use any of the functions allowed for <span class="define">O_RDONLY</span> and <span class="define">O_WRONLY</span>.</dd>
</dl>
<p>
In all cases, a message queue may be open multiple times in the same or different processes for sending/receiving messages.<p>
Any combination of the remaining flags may be specified in the value of <i class="farg">oflag</i>:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">O_CREAT</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Create a message queue. It requires two additional arguments: <i class="farg">mode</i> and <i class="farg">attr</i>. If the pathname <i class="farg">name</i> has already been used to create a message queue that still exists, then this flag will have no effect, except as noted under <span class="define">O_EXCL</span>. Otherwise, a message queue will be created without any messages in it. The user ID of the message queue will be set to the effective user ID of the process, and the group ID of the message queue will be set to the effective group ID of the process. The permission bits of the message queue will be set to the value of the <i class="farg">mode</i> argument, except those set in the file mode creation mask of the process. When bits in <i class="farg">mode</i> other than the file permission bits are specified, the effect is unspecified. If <i class="farg">attr</i> is <span class="define">NULL</span>, the message queue will be created with implementation-defined default message queue attributes. If <i class="farg">attr</i> is non-<span class="define">NULL</span> and the calling process has the appropriate privilege on <i class="farg">name</i>, the message queue <b class="var">mq_maxmsg</b> and <b class="var">mq_msgsize</b> attributes will be set to the values of the corresponding members in the <span class="type">mq_attr</span> structure referred to by <i class="farg">attr</i>. If <i class="farg">attr</i> is non-<span class="define">NULL</span>, but the calling process does not have the appropriate privilege on <i class="farg">name</i>, the <b class="fname">mq_open</b>() function will fail and return an error without creating the message queue.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">O_EXCL</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
If <span class="define">O_EXCL</span> and <span class="define">O_CREAT</span> are set, <b class="fname">mq_open</b>() fails if the message queue <i class="farg">name</i> exists. The check for the existence of the message queue and the creation of the message queue if it does not exist will be atomic with respect to other threads executing <b class="fname">mq_open</b>() naming the same <i class="farg">name</i> with <span class="define">O_EXCL</span> and <span class="define">O_CREAT</span> set. If <span class="define">O_EXCL</span> is set and <span class="define">O_CREAT</span> is not set, the result is undefined.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">O_NONBLOCK</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Determines whether an <a class="link-man" href="../3/mq_send">mq_send(3)</a> or <a class="link-man" href="../3/mq_receive">mq_receive(3)</a> waits for resources or messages that are not currently available, or fails with errno set to <span class="errno">EAGAIN</span>.</dd>
</dl>
<p>
The <b class="fname">mq_open</b>() function does not add or remove messages from the queue.</div>
<div class="section">
<h1 id="x494d504c454d454e544154494f4e204e4f544553">IMPLEMENTATION NOTES</h1> The <a class="link-man" href="../2/select">select(2)</a> and <a class="link-man" href="../2/poll">poll(2)</a> system calls to the message queue descriptor are supported by <span class="unix">NetBSD</span>, however, it is not portable.</div>
<div class="section">
<h1 id="x52455455524e2056414c554553">RETURN VALUES</h1> Upon successful completion, <b class="fname">mq_open</b>() returns a message queue descriptor. Otherwise, the function returns (<span class="define">mqd_t</span>) &#45;1 and sets the global variable <b class="var">errno</b> to indicate the error.</div>
<div class="section">
<h1 id="x4552524f5253">ERRORS</h1> The <b class="fname">mq_open</b>() function fails if:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EACCES</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The message queue exists and the permissions specified by <i class="farg">oflag</i> are denied, or the message queue does not exist and permission to create the message queue is denied.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EEXIST</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
<span class="define">O_CREAT</span> and <span class="define">O_EXCL</span> are set and the named message queue already exists.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EINTR</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The <b class="fname">mq_open</b>() function was interrupted by a signal.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EINVAL</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The <b class="fname">mq_open</b>() function is not supported for the given name, or <span class="define">O_CREAT</span> was specified in <i class="farg">oflag</i>, the value of <i class="farg">attr</i> is not <span class="define">NULL</span>, and either <b class="var">mq_maxmsg</b> or <b class="var">mq_msgsize</b> was less than or equal to zero.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EMFILE</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
Too many message queue descriptors or file descriptors are currently in use by this process.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ENAMETOOLONG</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The length of the <i class="farg">name</i> argument exceeds &#123;<span class="define">PATH_MAX</span>&#125; or a pathname component is longer than &#123;<span class="define">NAME_MAX</span>&#125;.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ENFILE</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
Too many message queues are currently open in the system.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ENOENT</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
<span class="define">O_CREAT</span> is not set and the named message queue does not exist.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ENOSPC</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
There is insufficient space for the creation of the new message queue.</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../3/mq">mq(3)</a>, <a class="link-man" href="../3/mq_close">mq_close(3)</a>, <a class="link-man" href="../3/mq_unlink">mq_unlink(3)</a></div>
<div class="section">
<h1 id="x5354414e4441524453">STANDARDS</h1> This function conforms to the IEEE Std 1003.1-2001 (&#8220;POSIX.1&#8221;) standard.</div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> This function first appeared in <span class="unix">NetBSD&#160;5.0</span>.</div>
<div class="section">
<h1 id="x434f50595249474854">COPYRIGHT</h1> Portions of this text are reprinted and reproduced in electronic form from IEEE Std 1003.1, 2003 Edition, Standard for Information Technology -- Portable Operating System Interface (POSIX), The Open Group Base Specifications Issue 6, Copyright (C) 2001-2003 by the Institute of Electrical and Electronics Engineers, Inc and The Open Group. In the event of any discrepancy between this version and the original IEEE and The Open Group Standard, the original IEEE and The Open Group Standard is the referee document. The original Standard can be obtained online at <a class="link-ext" href="http://www.opengroup.org/unix/online">http://www.opengroup.org/unix/online</a>.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
June 7, 2010</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
<>

