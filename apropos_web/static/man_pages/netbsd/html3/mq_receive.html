<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="/static/man_pages/netbsd/style.css" type="text/css" media="all">
<title>
MQ_RECEIVE(3)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
MQ_RECEIVE(3)</td>
<td class="head-vol" align="center">
Library Functions Manual</td>
<td class="head-rtitle" align="right">
MQ_RECEIVE(3)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">mq_receive, mq_timedreceive</b> &#8212; <span class="desc">receive a message from a message queue (REALTIME)</span></div>
<div class="section">
<h1 id="x4c494252415259">LIBRARY</h1> <span class="lib">POSIX Real&#45;time Library (librt, &#45;lrt)</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">mqueue.h</a>&gt;</b><p>
<i class="ftype">ssize_t</i><br>
<b class="fname">mq_receive</b>(<i class="farg">mqd_t mqdes</i>, <i class="farg">char *msg_ptr</i>, <i class="farg">size_t msg_len</i>, <i class="farg">unsigned *msg_prio</i>);<p>
<b class="includes">#include &lt;<a class="link-includes">mqueue.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">time.h</a>&gt;</b><p>
<i class="ftype">ssize_t</i><br>
<b class="fname">mq_timedreceive</b>(<i class="farg">mqd_t mqdes</i>, <i class="farg">char *restrict msg_ptr</i>, <i class="farg">size_t msg_len</i>, <i class="farg">unsigned *restrict msg_prio</i>, <i class="farg">const struct timespec *restrict abs_timeout</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="fname">mq_receive</b>() function receives the oldest of the highest priority message(s) from the message queue specified by <i class="farg">mqdes</i>. If the size of the buffer in bytes, specified by the <i class="farg">msg_len</i> argument, is less than the <b class="var">mq_msgsize</b> attribute of the message queue, the function fails and returns an error. Otherwise, the selected message will be removed from the queue and copied to the buffer pointed to by the <i class="farg">msg_ptr</i> argument.<p>
If the argument <i class="farg">msg_prio</i> is not <span class="define">NULL</span>, the priority of the selected message will be stored in the location referenced by <i class="farg">msg_prio</i>.<p>
If the specified message queue is empty and <span class="define">O_NONBLOCK</span> is not set in the message queue description associated with <i class="farg">mqdes</i>, <b class="fname">mq_receive</b>() blocks until a message is enqueued on the message queue or until <b class="fname">mq_receive</b>() is interrupted by a signal. If more than one thread is waiting to receive a message when a message arrives at an empty queue, then the thread of highest priority that has been waiting the longest will be selected to receive the message. If the specified message queue is empty and <span class="define">O_NONBLOCK</span> is set in the message queue description associated with <i class="farg">mqdes</i>, no message will be removed from the queue, and <b class="fname">mq_receive</b>() returns an error.<p>
The timeout expires when the absolute time specified by <i class="farg">abs_timeout</i> passes, as measured by the clock on which timeouts are based (that is, when the value of that clock equals or exceeds <i class="farg">abs_timeout</i>), or if the absolute time specified by <i class="farg">abs_timeout</i> has already been passed at the time of the call.<p>
The resolution of the timeout is based on the CLOCK_REALTIME clock. The <i class="farg">timespec</i> argument is defined in the <b class="includes">&lt;<a class="link-includes">time.h</a>&gt;</b> header.<p>
Under no circumstance will the operation fail with a timeout if a message can be removed from the message queue immediately. The validity of the <i class="farg">abs_timeout</i> parameter will not be checked if a message can be removed from the message queue immediately.</div>
<div class="section">
<h1 id="x52455455524e2056414c554553">RETURN VALUES</h1> Upon successful completion, the <b class="fname">mq_receive</b>() and <b class="fname">mq_timedreceive</b>() functions return a value of zero. Otherwise, no message will be removed from the queue, the functions return a value of &#45;1, and set the global variable <b class="var">errno</b> to indicate the error.</div>
<div class="section">
<h1 id="x4552524f5253">ERRORS</h1> The <b class="fname">mq_receive</b>() and <b class="fname">mq_timedreceive</b>() functions fail if:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EAGAIN</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
<span class="define">O_NONBLOCK</span> was set in the message description associated with <i class="farg">mqdes</i>, and the specified message queue is empty.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EBADF</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The <i class="farg">mqdes</i> argument is not a valid message queue descriptor open for reading.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EINTR</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The <b class="fname">mq_receive</b>() or <b class="fname">mq_timedreceive</b>() operation was interrupted by a signal.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EINVAL</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The process or thread would have blocked, and the <i class="farg">abs_timeout</i> parameter specified a nanoseconds field value less than zero or greater than or equal to 1000 million.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EMSGSIZE</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The specified message buffer size, <i class="farg">msg_len</i>, is less than the message size attribute of the message queue.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ETIMEDOUT</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The <span class="define">O_NONBLOCK</span> flag was not set when the message queue was opened, but no message arrived on the queue before the specified timeout expired.</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../3/mq">mq(3)</a>, <a class="link-man" href="../3/mq_send">mq_send(3)</a></div>
<div class="section">
<h1 id="x5354414e4441524453">STANDARDS</h1> These functions are expected to conform to the IEEE Std 1003.1-2001 (&#8220;POSIX.1&#8221;) standard.</div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="fname">mq_receive</b>() and <b class="fname">mq_timedreceive</b>() functions first appeared in <span class="unix">NetBSD&#160;5.0</span>.</div>
<div class="section">
<h1 id="x434f50595249474854">COPYRIGHT</h1> Portions of this text are reprinted and reproduced in electronic form from IEEE Std 1003.1, 2003 Edition, Standard for Information Technology -- Portable Operating System Interface (POSIX), The Open Group Base Specifications Issue 6, Copyright (C) 2001-2003 by the Institute of Electrical and Electronics Engineers, Inc and The Open Group. In the event of any discrepancy between this version and the original IEEE and The Open Group Standard, the original IEEE and The Open Group Standard is the referee document. The original Standard can be obtained online at <a class="link-ext" href="http://www.opengroup.org/unix/online">http://www.opengroup.org/unix/online</a>.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
June 7, 2010</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

