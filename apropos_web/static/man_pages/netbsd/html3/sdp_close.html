<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
SDP(3)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
SDP(3)</td>
<td class="head-vol" align="center">
Library Functions Manual</td>
<td class="head-rtitle" align="right">
SDP(3)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">sdp_open</b>, <b class="name">sdp_open_local</b>, <b class="name">sdp_close</b>, <b class="name">sdp_service_search</b>, <b class="name">sdp_service_attribute</b>, <b class="name">sdp_service_search_attribute</b>, <b class="name">sdp_record_insert</b>, <b class="name">sdp_record_update</b>, <b class="name">sdp_record_remove</b> &#8212; <span class="desc">Service Discovery Protocol session routines</span></div>
<div class="section">
<h1 id="x4c494252415259">LIBRARY</h1> <span class="lib">Bluetooth Library (libbluetooth, &#45;lbluetooth)</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">sdp.h</a>&gt;</b><p>
<i class="ftype">sdp_session_t</i><br>
<b class="fname">sdp_open</b>(<i class="farg" style="white-space:nowrap;">const bdaddr_t *laddr</i>, <i class="farg" style="white-space:nowrap;">const bdaddr_t *raddr</i>);<p>
<i class="ftype">sdp_session_t</i><br>
<b class="fname">sdp_open_local</b>(<i class="farg" style="white-space:nowrap;">const char *control</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">sdp_close</b>(<i class="farg" style="white-space:nowrap;">sdp_session_t ss</i>);<p>
<i class="ftype">bool</i><br>
<b class="fname">sdp_service_search</b>(<i class="farg">sdp_session_t ss</i>, <i class="farg">sdp_data_t *ssp</i>, <i class="farg">uint32_t *handlep</i>, <i class="farg">int *num</i>);<p>
<i class="ftype">bool</i><br>
<b class="fname">sdp_service_attribute</b>(<i class="farg">sdp_session_t ss</i>, <i class="farg">uint32_t handle</i>, <i class="farg">sdp_data_t *ail</i>, <i class="farg">sdp_data_t *response</i>);<p>
<i class="ftype">bool</i><br>
<b class="fname">sdp_service_search_attribute</b>(<i class="farg">sdp_session_t ss</i>, <i class="farg">sdp_data_t *ssp</i>, <i class="farg">sdp_data_t *ail</i>, <i class="farg">sdp_data_t *response</i>);<p>
<i class="ftype">bool</i><br>
<b class="fname">sdp_record_insert</b>(<i class="farg">sdp_session_t ss</i>, <i class="farg">bdaddr_t *bdaddr</i>, <i class="farg">uint32_t *handlep</i>, <i class="farg">sdp_data_t *record</i>);<p>
<i class="ftype">bool</i><br>
<b class="fname">sdp_record_update</b>(<i class="farg" style="white-space:nowrap;">sdp_session_t ss</i>, <i class="farg" style="white-space:nowrap;">uint32_t handle</i>, <i class="farg" style="white-space:nowrap;">sdp_data_t *record</i>);<p>
<i class="ftype">bool</i><br>
<b class="fname">sdp_record_remove</b>(<i class="farg" style="white-space:nowrap;">sdp_session_t ss</i>, <i class="farg" style="white-space:nowrap;">uint32_t handle</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The SDP library provides means for client programs to perform Bluetooth Service Discovery, and to advertise Service Records on the local host.<p>
The Service Discovery API reflects the Bluetooth SDP specification, providing access to complete ServiceSearch, ServiceAttribute or ServiceSearchAttribute transactions and using SDP data element lists directly which can be constructed and parsed with the <a class="link-man" href="../html3/sdp_data.html">sdp_data(3)</a> library functions.<p>
The ServiceSearchPattern is a list of UUID data elements. The list must contain at least one UUID and the maximum number of UUIDs is 12. A service record will be matched when all the UUIDs from the ServiceSearchPattern are contained in the record.<p>
The AttributeIDList is a list of data elements where each is either an attribute ID encoded as an unsigned 16-bit integer, or a range of attribute IDs encoded as an unsigned 32-bit integer where the high order 16-bits are the start of the range and the low order 16-bits are the end of the range (inclusive). The AttributeIDList should be arranged in ascending order and there should be no duplicate attribute ID values. If <span class="define">NULL</span> is passed, all attributes (0x0000-0xffff) will be requested.<p>
ServiceRecords to be registered with the local <a class="link-man" href="../html8/sdpd.html">sdpd(8)</a> server should consist of a list of attribute ID/value pairs, where the attribute ID is a 16-bit unsigned integer element, and the attribute value is any data element. The attribute IDs should be in ascending order, and the first one must be <span class="define">SDP_ATTR_SERVICE_RECORD_HANDLE</span> (0x0000), otherwise the server will reject the record. For consistency, records should also contain a BrowseGroupList with the PublicBrowseGroup UUID, plus at least a ServiceName string in the native language with an associated LanguageBaseAttributeIDList although this is not currently enforced.</div>
<div class="section">
<h1 id="x46554e4354494f4e53">FUNCTIONS</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">sdp_open</b>(<i class="farg">laddr</i>, <i class="farg">raddr</i>)</dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
Open a SDP session to a remote Bluetooth device. <i class="farg">laddr</i> refers to the local bluetooth device address and may be <span class="define">NULL</span> in which case it will default to <span class="define">BDADDR_ANY</span>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">sdp_open_local</b>(<i class="farg">control</i>)</dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
Open a SDP session to a server using a local socket. The <i class="farg">control</i> socket path may be given as <span class="define">NULL</span> in which case the default control path <i class="file">/var/run/sdp</i> will be used.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">sdp_close</b>(<i class="farg">ss</i>)</dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
Close SDP session and release all resources.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">sdp_service_search</b>(<i class="farg">ss</i>, <i class="farg">ssp</i>, <i class="farg">handlep</i>, <i class="farg">num</i>)</dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
Perform a complete ServiceSearch transaction on the SDP session. At most <i class="farg">num</i> service record handles matching the ServiceSearchPattern <i class="farg">ssp</i> will be returned in the array pointed to by <i class="farg">handlep</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">sdp_service_attribute</b>(<i class="farg">ss</i>, <i class="farg">handle</i>, <i class="farg">ail</i>, <i class="farg">response</i>)</dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
Perform a complete ServiceAttribute transaction on the SDP session. The ServiceRecord with ServiceRecordHandle <i class="farg">handle</i> will be parsed using the AttributeIDList <i class="farg">ail</i>. If the transaction succeeds, the <i class="farg">response</i> data buffer will contain a validated data element list of attribute ID/value pairs from the selected record.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">sdp_service_search_attribute</b>(<i class="farg">ss</i>, <i class="farg">ssp</i>, <i class="farg">ail</i>, <i class="farg">response</i>)</dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
Perform a complete ServiceSearchAttribute transaction on the SDP session. All ServiceRecords matching the ServiceSearchPattern <i class="farg">ssp</i> will be parsed using the AttributeIDList <i class="farg">ail</i>. If the transaction succeeds, the <i class="farg">response</i> data buffer will contain a valid data element list of sequences, where each sequence is the attribute ID/value list from a matched record.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">sdp_record_insert</b>(<i class="farg">ss</i>, <i class="farg">bdaddr</i>, <i class="farg">handlep</i>, <i class="farg">record</i>)</dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
Insert a ServiceRecord <i class="farg">record</i>. If <i class="farg">bdaddr</i> is given, the service record will be restricted to clients connecting through the Bluetooth controller with that BD_ADDR. When the <i class="farg">handlep</i> pointer is non NULL, the resulting ServiceRecordHandle will be written to the address given. The record will be valid while the session is active and will be purged when the session is closed.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">sdp_record_update</b>(<i class="farg">ss</i>, <i class="farg">handle</i>, <i class="farg">record</i>)</dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
Update a ServiceRecord that is owned by this session. <i class="farg">handle</i> is the identifier returned by the <b class="fname">sdp_record_insert</b>() call, and <i class="farg">record</i> is the updated ServiceRecord as described above.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">sdp_record_remove</b>(<i class="farg">ss</i>, <i class="farg">handle</i>)</dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
Remove a ServiceRecord owned by this session. <i class="farg">handle</i> is the identifier returned by the <b class="fname">sdp_record_insert</b>() call.</dd>
</dl>
<p>
A single response buffer is maintained for each session, so the results of a ServiceAttribute or ServiceSearchAttribute request will only be valid until another request is made or the session is closed. The SDP specifications do not mandate a limit on the size of the response buffer but this implementation has a default limit of UINT16_MAX bytes. This limit can be increased at runtime by setting the environment variable <span class="env">SDP_RESPONSE_MAX</span> to a numeric value.<p>
Records are only allowed to be removed or updated by the session that inserted them, and records will be removed automatically when the session is closed. Further, manipulating service records will normally only be possible for privileged users on a SDP session connected with a local socket. See <a class="link-man" href="../html8/sdpd.html">sdpd(8)</a> and your local system administrator for details.</div>
<div class="section">
<h1 id="x52455455524e2056414c554553">RETURN VALUES</h1> Session open routines will return a session handle on success and <span class="define">NULL</span> on failure. For service lookup and record manipulation routines, a boolean value is returned indicating success or failure. On failure, <b class="var">errno</b> will be set to indicate the error.</div>
<div class="section">
<h1 id="x46494c4553">FILES</h1> <i class="file">/var/run/sdp</i></div>
<div class="section">
<h1 id="x4552524f5253">ERRORS</h1> In addition to errors returned by the standard C library IO functions, the following errors may be detected by <b class="name">libbluetooth</b>:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EINVAL</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
A provided function argument was not valid.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EIO</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
A response from the remote server was not understood.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ENOATTR</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
The record <i class="farg">handle</i> did not exist on the server.</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html1/sdpquery.html">sdpquery(1)</a>, <a class="link-man" href="../html3/bluetooth.html">bluetooth(3)</a>, <a class="link-man" href="../html3/sdp_data.html">sdp_data(3)</a>, <a class="link-man" href="../html8/sdpd.html">sdpd(8)</a><p>
The &#8220;Service Discovery Protocol&#8221; section of the Bluetooth Core specifications, available at <a class="link-ext" href="http://www.bluetooth.com/">http://www.bluetooth.com/</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The first Service Discovery implementation was written for <span class="unix">FreeBSD</span> and was ported to <span class="unix">NetBSD&#160;4.0</span>. This, the second version API, was designed by <span class="author">Iain Hibbert</span> for <span class="unix">NetBSD&#160;6.0</span> in order to simplify the <a class="link-man" href="../html8/sdpd.html">sdpd(8)</a> daemon and allow client code greater control over all aspects of the service records. The original API is still available when <span class="define">SDP_COMPAT</span> is defined but will eventually be removed.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
May 7, 2009</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

