<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
ICONV(3)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
ICONV(3)</td>
<td class="head-vol" align="center">
Library Functions Manual</td>
<td class="head-rtitle" align="right">
ICONV(3)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">iconv_open</b>, <b class="name">iconv_close</b>, <b class="name">iconv</b> &#8212; <span class="desc">codeset conversion functions</span></div>
<div class="section">
<h1 id="x4c494252415259">LIBRARY</h1> <span class="lib">Standard C Library (libc, &#45;lc)</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">iconv.h</a>&gt;</b><p>
<i class="ftype">iconv_t</i><br>
<b class="fname">iconv_open</b>(<i class="farg" style="white-space:nowrap;">const char *dstname</i>, <i class="farg" style="white-space:nowrap;">const char *srcname</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">iconv_close</b>(<i class="farg" style="white-space:nowrap;">iconv_t cd</i>);<p>
<i class="ftype">size_t</i><br>
<b class="fname">iconv</b>(<i class="farg" style="white-space:nowrap;">iconv_t cd</i>, <i class="farg" style="white-space:nowrap;">const char ** restrict src</i>, <i class="farg" style="white-space:nowrap;">size_t * restrict srcleft</i>, <i class="farg" style="white-space:nowrap;">char ** restrict dst</i>, <i class="farg" style="white-space:nowrap;">size_t * restrict dstleft</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="fname">iconv_open</b>() function opens a converter from the codeset <i class="farg">srcname</i> to the codeset <i class="farg">dstname</i> and returns its descriptor.<p>
The <b class="fname">iconv_close</b>() function closes the specified converter <i class="farg">cd</i>.<p>
The <b class="fname">iconv</b>() function converts the string in the buffer <i class="farg">*src</i> of length <i class="farg">*srcleft</i> bytes and stores the converted string in the buffer <i class="farg">*dst</i> of size <i class="farg">*dstleft</i> bytes. After calling <b class="fname">iconv</b>(), the values pointed to by <i class="farg">src</i>, <i class="farg">srcleft</i>, <i class="farg">dst</i>, and <i class="farg">dstleft</i> are updated as follows:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">*src</i></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
Pointer to the byte just after the last character fetched.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">*srcleft</i></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
Number of remaining bytes in the source buffer.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">*dst</i></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
Pointer to the byte just after the last character stored.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">*dstleft</i></dt>
<dd class="list-tag" style="margin-left: 8.00ex;">
Number of remainder bytes in the destination buffer.</dd>
</dl>
<p>
If the string pointed to by <i class="farg">*src</i> contains a byte sequence which is not a valid character in the source codeset, the conversion stops just after the last successful conversion. If the output buffer is too small to store the converted character, the conversion also stops in the same way. In these cases, the values pointed to by <i class="farg">src</i>, <i class="farg">srcleft</i>, <i class="farg">dst</i>, and <i class="farg">dstleft</i> are updated to the state just after the last successful conversion.<p>
If the string pointed to by <i class="farg">*src</i> contains a character which is valid under the source codeset but can not be converted to the destination codeset, the character is replaced by an &#8220;invalid character&#8221; which depends on the destination codeset, e.g., &#8216;?&#8217;, and the conversion is continued. <b class="fname">iconv</b>() returns the number of such &#8220;invalid conversions&#8221;.<p>
If <i class="farg">src</i> or <i class="farg">*src</i> is <span class="define">NULL</span> and the source and/or destination codesets are stateful, <b class="fname">iconv</b>() places these into their initial state.<ol style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-enum">
<li class="list-enum" style="margin-top: 1.00em;">
If both <i class="farg">dst</i> and <i class="farg">*dst</i> are non-<span class="define">NULL</span>, <b class="fname">iconv</b>() stores the shift sequence for the destination switching to the initial state in the buffer pointed to by <i class="farg">*dst</i>. The buffer size is specified by the value pointed to by <i class="farg">dstleft</i> as above. <b class="fname">iconv</b>() will fail if the buffer is too small to store the shift sequence.</li>
<li class="list-enum" style="margin-top: 1.00em;">
On the other hand, <i class="farg">dst</i> or <i class="farg">*dst</i> may be <span class="define">NULL</span>. In this case, the shift sequence for the destination switching to the initial state is discarded.</li>
</ol>
</div>
<div class="section">
<h1 id="x52455455524e2056414c554553">RETURN VALUES</h1> Upon successful completion of <b class="fname">iconv_open</b>(), it returns a conversion descriptor. Otherwise, <b class="fname">iconv_open</b>() returns (iconv_t)&#45;1 and sets <b class="var">errno</b> to indicate the error.<p>
Upon successful completion of <b class="fname">iconv_close</b>(), it returns 0. Otherwise, <b class="fname">iconv_close</b>() returns &#45;1 and sets errno to indicate the error.<p>
Upon successful completion of <b class="fname">iconv</b>(), it returns the number of &#8220;invalid&#8221; conversions. Otherwise, <b class="fname">iconv</b>() returns (size_t)&#45;1 and sets errno to indicate the error.</div>
<div class="section">
<h1 id="x4552524f5253">ERRORS</h1> The <b class="fname">iconv_open</b>() function may cause an error in the following cases:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EINVAL</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
There is no converter specified by <i class="farg">srcname</i> and <i class="farg">dstname</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ENOMEM</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
Memory is exhausted.</dd>
</dl>
<p>
The <b class="fname">iconv_close</b>() function may cause an error in the following case:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EBADF</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The conversion descriptor specified by <i class="farg">cd</i> is invalid.</dd>
</dl>
<p>
The <b class="fname">iconv</b>() function may cause an error in the following cases:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">E2BIG</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The output buffer pointed to by <i class="farg">*dst</i> is too small to store the result string.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EBADF</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The conversion descriptor specified by <i class="farg">cd</i> is invalid.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EILSEQ</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The string pointed to by <i class="farg">*src</i> contains a byte sequence which does not describe a valid character of the source codeset.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">EINVAL</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
The string pointed to by <i class="farg">*src</i> terminates with an incomplete character or shift sequence.</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html1/iconv.html">iconv(1)</a></div>
<div class="section">
<h1 id="x5354414e4441524453">STANDARDS</h1> <b class="fname">iconv_open</b>(), <b class="fname">iconv_close</b>(), and <b class="fname">iconv</b>() conform to IEEE Std 1003.1-2001 (&#8220;POSIX.1&#8221;).<p>
Historically, the definition of <i class="ftype">iconv</i> has not been consistent across operating systems. This is due to an unfortunate historical mistake, documented in <a class="link-ext" href="https://www5.opengroup.org/sophocles2/show_mail.tpl?&amp;source=L&amp;listname=austin-group-l&amp;id=7404">this e-mail</a>. The standards page for the header file <b class="includes">&lt;<a class="link-includes">iconv.h</a>&gt;</b> defined the second argument of <b class="fname">iconv</b>() as <i class="ftype">char **</i>, but the standards page for the <b class="fname">iconv</b>() implementation defined it as <i class="ftype">const char **</i>. The standards committee later chose to change the function definition to follow the header file definition (without const), even though the version with const is arguably more correct. <span class="unix">NetBSD</span> has always used the const form. It was decided to reject the committee's regression and become (technically) incompatible. GNU libiconv has taken the <a class="link-ext" href="http://www.gnu.org/savannah-checkouts/gnu/libiconv/documentation/libiconv-1.14/">same route</a>. Most third party software affected by this issue already handles it during configuration.</div>
<div class="section">
<h1 id="x42554753">BUGS</h1> If <b class="fname">iconv</b>() is aborted due to the occurrence of some error, the &#8220;invalid conversion&#8221; count mentioned above is unfortunately lost.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
March 11, 2013</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

