<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/../4/strict.dtd">
>
<head>
<meta http-equiv="Content-Type" content="te../; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
ISNS(3)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
ISNS(3)</td>
<td class="head-vol" align="center">
Library Functions Manual</td>
<td class="head-rtitle" align="right">
ISNS(3)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">isns</b> &#8212; <span class="desc">iSNS protocol support library</span></div>
<div class="section">
<h1 id="x4c494252415259">LIBRARY</h1> <span class="lib">Internet Storage Name Service Library (libisns, &#45;lisns)</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">isns.h</a>&gt;</b><p>
<i class="ftype">int</i><br>
<b class="fname">isns_init</b>(<i class="farg" style="white-space:nowrap;">ISNS_HANDLE *h</i>, <i class="farg" style="white-space:nowrap;">int is_server</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">isns_stop</b>(<i class="farg" style="white-space:nowrap;">ISNS_HANDLE h</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">isns_add_servercon</b>(<i class="farg" style="white-space:nowrap;">ISNS_HANDLE h</i>, <i class="farg" style="white-space:nowrap;">int fd</i>, <i class="farg" style="white-space:nowrap;">struct addrinfo *ai</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">isns_init_reg_refresh</b>(<i class="farg" style="white-space:nowrap;">ISNS_HANDLE h</i>, <i class="farg" style="white-space:nowrap;">const char *node</i>, <i class="farg" style="white-space:nowrap;">int interval</i>);<p>
<i class="ftype">ISNS_TRANS</i><br>
<b class="fname">isns_new_trans</b>(<i class="farg" style="white-space:nowrap;">ISNS_HANDLE h</i>, <i class="farg" style="white-space:nowrap;">uint16_t func_id</i>, <i class="farg" style="white-space:nowrap;">uint16_t pdu_flags</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">isns_add_tlv</b>(<i class="farg" style="white-space:nowrap;">ISNS_TRANS t</i>, <i class="farg" style="white-space:nowrap;">uint32_t tag</i>, <i class="farg" style="white-space:nowrap;">int data_len</i>, <i class="farg" style="white-space:nowrap;">const void *data_p</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">isns_add_string</b>(<i class="farg" style="white-space:nowrap;">ISNS_TRANS t</i>, <i class="farg" style="white-space:nowrap;">uint32_t tag</i>, <i class="farg" style="white-space:nowrap;">const char *s</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">isns_send_trans</b>(<i class="farg" style="white-space:nowrap;">ISNS_TRANS t</i>, <i class="farg" style="white-space:nowrap;">const struct timespec *timeout_p</i>, <i class="farg" style="white-space:nowrap;">uint32_t *status_p</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">isns_get_tlv</b>(<i class="farg" style="white-space:nowrap;">ISNS_TRANS t</i>, <i class="farg" style="white-space:nowrap;">int which_tlv</i>, <i class="farg" style="white-space:nowrap;">uint32_t *tag_p</i>, <i class="farg" style="white-space:nowrap;">int data_len_p</i>, <i class="farg" style="white-space:nowrap;">void **data_pp</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">isns_free_trans</b>(<i class="farg" style="white-space:nowrap;">ISNS_TRANS t</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="name">isns</b> library exports an API that simplifies Internet Storage Name Service (iSNS) client implementations. The API defines a transactional model in support of:<p>
<ul style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-bul">
<li class="list-bul" style="margin-top: 0.00em;">
generating iSNS messages composed of iSNS attributes expressed in Tag-Length-Value (TLV) data format</li>
<li class="list-bul" style="margin-top: 0.00em;">
submitting iSNS Protocol (iSNSP) messages</li>
<li class="list-bul" style="margin-top: 0.00em;">
optionally waiting for iSNSP responses</li>
</ul>
<p>
<b class="name">isns</b> does not currently support receipt of iSNS Heartbeat messages, State Change Notification (SCN) messages, or Entity Status Inquiry (ESI) messages.</div>
<div class="section">
<h1 id="x494e495449414c495a4154494f4e">INITIALIZATION</h1> An iSNS client that uses <b class="name">isns</b> must call <b class="fname">isns_init</b>() to initialize the iSNS environment. This call will create a thread to handle client-server communication, and as such should only be called when thread creation is appropriate (such as after a daemonized program forks).<p>
The value passed as <i class="arg">is_server</i> is used to set iSNSP message format Flags "Sender is the iSNS client" (bit position 16) and "Sender is the iSNS server" (bit position 17). For now the value 0 (zero) should be passed for <i class="arg">is_server</i>. The value returned in <i class="arg">h</i> should be considered opaque by the caller. This value is passed unchanged to <b class="fname">isns_add_servercon</b>(), <b class="fname">isns_init_reg_refresh</b>(), <b class="fname">isns_stop</b>(), and <b class="fname">isns_new_trans</b>().<p>
<b class="fname">isns_stop</b>() should be called when the iSNS environment is no longer needed. This call will kill any threads created by <b class="fname">isns_init</b>().</div>
<div class="section">
<h1 id="x434f4e46494755524154494f4e">CONFIGURATION</h1> Following initialization, <b class="fname">isns_add_servercon</b>() should be used to make the iSNS environment aware of the iSNS server to which iSNSP queries and requests are to be sent. This routine should not be called by a program acting as an iSNS server.<p>
A connected TCP socket descriptor is passed as parameter <i class="arg">fd</i>. Parameter <i class="arg">ai</i> is the address of the remote TCP endpoint. It is included so that reconnection may be attempted by <b class="name">isns</b> in the event that the TCP connection is broken.<p>
Certain iSNS servers will limit registration lifetimes, and will refresh registrations after any request from a given iSNS entity. The <b class="fname">isns_init_reg_refresh</b>() function offers a way for <b class="name">isns</b> to refresh registrations on behalf of the iSNS client.<p>
Parameter <i class="arg">node</i> is the &#8220;iSCSI Name&#8221; attribute used for the periodic queries. It should be the name of an iSCSI node within the registered iSNS entity. The desired refresh interval, in seconds, is passed in parameter <i class="arg">interval</i>.</div>
<div class="section">
<h1 id="x5452414e53414354494f4e53">TRANSACTIONS</h1> <b class="fname">isns_new_trans</b>() creates new iSNS transactions.<p>
Parameter <i class="arg">func_id</i> is used as the iSNSP message id. Parameter <i class="arg">pdu_flags</i> is used to set iSNSP message format Flags and is exposed to allow callers to set flag "Replace flag" (bit position 19). This provides callers with a way to specify whether a Device Attribute Registration Request is intended to update or replace an existing registration. This is currently the only use defined for parameter <i class="arg">pdu_flags</i>.<p>
Once a new transaction has been created, callers can specify iSNS attributes used for registration and query requests. TLV data may be added using either <b class="fname">isns_add_tlv</b>() or <b class="fname">isns_add_string</b>().<p>
Parameter <i class="arg">tag</i> is the iSNS Tag corresponding to the attribute being added. Parameter <i class="arg">data_len</i> is the length of the attribute value. Parameter <i class="arg">data_p</i> references the attribute value. The caller does not need to handle iSNS attribute 4-byte alignment requirements. This is handled by the iSNS environment on behalf of the caller. <b class="fname">isns_add_string</b>() may be used if the attribute value is a NUL terminated C string.<p>
Once a transaction has been populated with any required TLV data, <b class="fname">isns_send_trans</b>() can be used to submit an iSNSP registration or query message.<p>
Callers that submit iSNSP query messages may need to wait for returned data. <b class="fname">isns_send_trans</b>() supports bounded waits. Successful waits, those that do not time out, return the iSNSP response status code received in the iSNSP response message. If a wait does time out, the value of <i class="arg">status_p</i> is undefined. Callers that do not need to wait for returned data can simply pass <span class="define">NULL</span> for parameter <i class="arg">timeout_p</i>. Callers should set parameter <i class="arg">status_p</i> to <span class="define">NULL</span> if not waiting.<p>
<b class="fname">isns_get_tlv</b>() is used to retrieve TLV data returned in a transaction. The first call to <b class="fname">isns_get_tlv</b>() should pass the value <span class="define">ISNS_TLV_FIRST</span> for parameter <i class="arg">which_tlv</i>. Each subsequent TLV can be retrieved by passing in <span class="define">ISNS_TLV_NEXT</span> in place of <span class="define">ISNS_TLV_FIRST</span>.<p>
When a caller is done with a transaction, having submitted either a registration or a query message and retrieved any returned TLV data, <b class="fname">isns_free_trans</b>() should be used to release resources used by the transaction.</div>
<div class="section">
<h1 id="x52455455524e2056414c554553">RETURN VALUES</h1> <b class="fname">isns_init</b>(), <b class="fname">isns_add_servercon</b>(), <b class="fname">isns_init_reg_refresh</b>(), <b class="fname">isns_add_tlv</b>(), <b class="fname">isns_add_string</b>(), and <b class="fname">isns_send_trans</b>() return 0 on success, or &#45;1 on failure. <b class="fname">isns_new_trans</b>() returns 0 on success, or <span class="define">ISNS_INVALID_TRANS</span> on failure. <b class="fname">isns_get_tlv</b>() returns 0 on success, or <span class="errno">ENOENT</span> if there are no TLVs to retrieve.</div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> <b class="name">isns</b> first appeared in <span class="unix">NetBSD&#160;6.0</span>. The <b class="name">isns</b> implementation was contributed to the <span class="unix">NetBSD</span> Foundation by Wasabi Systems, Inc.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
October 1, 2009</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
<>

