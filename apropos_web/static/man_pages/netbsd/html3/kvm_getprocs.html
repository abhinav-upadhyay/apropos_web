<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
KVM_GETPROCS(3)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
KVM_GETPROCS(3)</td>
<td class="head-vol" align="center">
Library Functions Manual</td>
<td class="head-rtitle" align="right">
KVM_GETPROCS(3)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">kvm_getprocs</b>, <b class="name">kvm_getargv</b>, <b class="name">kvm_getenvv</b> &#8212; <span class="desc">access user process state</span></div>
<div class="section">
<h1 id="x4c494252415259">LIBRARY</h1> <span class="lib">Kernel Data Access Library (libkvm, &#45;lkvm)</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">kvm.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">sys/param.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">sys/sysctl.h</a>&gt;</b><p>
<i class="ftype">struct kinfo_proc *</i><br>
<b class="fname">kvm_getprocs</b>(<i class="farg" style="white-space:nowrap;">kvm_t *kd</i>, <i class="farg" style="white-space:nowrap;">int op</i>, <i class="farg" style="white-space:nowrap;">int arg</i>, <i class="farg" style="white-space:nowrap;">int *cnt</i>);<p>
<i class="ftype">char **</i><br>
<b class="fname">kvm_getargv</b>(<i class="farg" style="white-space:nowrap;">kvm_t *kd</i>, <i class="farg" style="white-space:nowrap;">const struct kinfo_proc *p</i>, <i class="farg" style="white-space:nowrap;">int nchr</i>);<p>
<i class="ftype">char **</i><br>
<b class="fname">kvm_getenvv</b>(<i class="farg" style="white-space:nowrap;">kvm_t *kd</i>, <i class="farg" style="white-space:nowrap;">const struct kinfo_proc *p</i>, <i class="farg" style="white-space:nowrap;">int nchr</i>);<p>
<i class="ftype">struct kinfo_proc2 *</i><br>
<b class="fname">kvm_getproc2</b>(<i class="farg" style="white-space:nowrap;">kvm_t *kd</i>, <i class="farg" style="white-space:nowrap;">int op</i>, <i class="farg" style="white-space:nowrap;">int arg</i>, <i class="farg" style="white-space:nowrap;">int elemsize</i>, <i class="farg" style="white-space:nowrap;">int *cnt</i>);<p>
<i class="ftype">char **</i><br>
<b class="fname">kvm_getargv2</b>(<i class="farg" style="white-space:nowrap;">kvm_t *kd</i>, <i class="farg" style="white-space:nowrap;">const struct kinfo_proc2 *p</i>, <i class="farg" style="white-space:nowrap;">int nchr</i>);<p>
<i class="ftype">char **</i><br>
<b class="fname">kvm_getenvv2</b>(<i class="farg" style="white-space:nowrap;">kvm_t *kd</i>, <i class="farg" style="white-space:nowrap;">const struct kinfo_proc2 *p</i>, <i class="farg" style="white-space:nowrap;">int nchr</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> <b class="fname">kvm_getprocs</b>() returns a (sub-)set of active processes in the kernel indicated by <i class="farg">kd</i>. The <i class="farg">op</i> and <i class="farg">arg</i> arguments constitute a predicate which limits the set of processes returned. The value of <i class="farg">op</i> describes the filtering predicate as follows:<p>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="symb">KERN_PROC_ALL</span></dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
all processes</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="symb">KERN_PROC_PID</span></dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
processes with process id <i class="farg">arg</i></dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="symb">KERN_PROC_PGRP</span></dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
processes with process group <i class="farg">arg</i></dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="symb">KERN_PROC_SESSION</span></dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
processes with session id <i class="farg">arg</i></dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="symb">KERN_PROC_TTY</span></dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
processes with tty device <i class="farg">arg</i></dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="symb">KERN_PROC_UID</span></dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
processes with effective user id <i class="farg">arg</i></dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="symb">KERN_PROC_RUID</span></dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
processes with real user id <i class="farg">arg</i></dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="symb">KERN_PROC_GID</span></dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
processes with effective group id <i class="farg">arg</i></dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="symb">KERN_PROC_RGID</span></dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
processes with real group id <i class="farg">arg</i></dd>
</dl>
<p>
The number of processes found is returned in the reference parameter <i class="farg">cnt</i>. The processes are returned as a contiguous array of <span class="symb">kinfo_proc</span> structures. This memory is locally allocated, and subsequent calls to <b class="fname">kvm_getprocs</b>() and <b class="fname">kvm_close</b>() will overwrite this storage.<p>
If the <i class="farg">op</i> argument for <b class="fname">kvm_getprocs</b>() is <span class="symb">KERN_PROC_TTY</span>, <i class="farg">arg</i> can also be <span class="symb">KERN_PROC_TTY_NODEV</span> to select processes with no controlling tty and <span class="symb">KERN_PROC_TTY_REVOKE</span> to select processes which have had their controlling tty revoked.<p>
<b class="fname">kvm_getargv</b>() returns a null-terminated argument vector that corresponds to the command line arguments passed to process indicated by <i class="farg">p</i>. Most likely, these arguments correspond to the values passed to <a class="link-man" href="../html3/exec.html">exec(3)</a> on process creation. This information is, however, deliberately under control of the process itself. Note that the original command name can be found, unaltered, in the p_comm field of the process structure returned by <b class="fname">kvm_getprocs</b>().<p>
The <i class="farg">nchr</i> argument indicates the maximum number of characters, including null bytes, to use in building the strings. If this amount is exceeded, the string causing the overflow is truncated and the partial result is returned. This is handy for programs like <a class="link-man" href="../html1/ps.html">ps(1)</a> and <a class="link-man" href="../html1/w.html">w(1)</a> that print only a one line summary of a command and should not copy out large amounts of text only to ignore it. If <i class="farg">nchr</i> is zero, no limit is imposed and all argument strings are returned in their entirety.<p>
The memory allocated to the argv pointers and string storage is owned by the kvm library. Subsequent <b class="fname">kvm_getprocs</b>() and <a class="link-man" href="../html3/kvm_close.html">kvm_close(3)</a> calls will clobber this storage.<p>
The <b class="fname">kvm_getenvv</b>() function is similar to <b class="fname">kvm_getargv</b>() but returns the vector of environment strings. This data is also alterable by the process.<p>
<b class="fname">kvm_getproc2</b>() is similar to <b class="fname">kvm_getprocs</b>() but returns an array of <span class="symb">kinfo_proc2</span> structures. Additionally, only the first <i class="farg">elemsize</i> bytes of each array entry are returned. If the size of the <span class="symb">kinfo_proc2</span> structure increases in size in a future release of <span class="unix">NetBSD</span> the kernel will only return the requested amount of data for each array entry and programs that use <b class="fname">kvm_getproc2</b>() will continue to function without the need for recompilation.<p>
The <b class="fname">kvm_getargv2</b>() and <b class="fname">kvm_getenvv2</b>() are equivalents to the <b class="fname">kvm_getargv</b>() and <b class="fname">kvm_getenvv</b>() functions but use a <span class="symb">kinfo_proc2</span> structure to specify the process.<p>
If called against an active kernel, the <b class="fname">kvm_getproc2</b>(), <b class="fname">kvm_getargv2</b>(), and <b class="fname">kvm_getenvv2</b>() functions will use the <a class="link-man" href="../html3/sysctl.html">sysctl(3)</a> interface and do not require access to the kernel memory device file or swap device.</div>
<div class="section">
<h1 id="x52455455524e2056414c554553">RETURN VALUES</h1> <b class="fname">kvm_getprocs</b>(), <b class="fname">kvm_getargv</b>(), <b class="fname">kvm_getenvv</b>(), <b class="fname">kvm_getproc2</b>(), <b class="fname">kvm_getargv2</b>(), and <b class="fname">kvm_getenvv2</b>() all return <span class="define">NULL</span> on failure.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html3/kvm.html">kvm(3)</a>, <a class="link-man" href="../html3/kvm_close.html">kvm_close(3)</a>, <a class="link-man" href="../html3/kvm_geterr.html">kvm_geterr(3)</a>, <a class="link-man" href="../html3/kvm_nlist.html">kvm_nlist(3)</a>, <a class="link-man" href="../html3/kvm_open.html">kvm_open(3)</a>, <a class="link-man" href="../html3/kvm_openfiles.html">kvm_openfiles(3)</a>, <a class="link-man" href="../html3/kvm_read.html">kvm_read(3)</a>, <a class="link-man" href="../html3/kvm_write.html">kvm_write(3)</a></div>
<div class="section">
<h1 id="x42554753">BUGS</h1> These routines do not belong in the kvm interface.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
February 10, 2004</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

