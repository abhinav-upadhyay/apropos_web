<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
INET6_OPTION_SPACE(3)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
INET6_OPTION_SPACE(3)</td>
<td class="head-vol" align="center">
Library Functions Manual</td>
<td class="head-rtitle" align="right">
INET6_OPTION_SPACE(3)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">inet6_option_space</b>, <b class="name">inet6_option_init</b>, <b class="name">inet6_option_append</b>, <b class="name">inet6_option_alloc</b>, <b class="name">inet6_option_next</b>, <b class="name">inet6_option_find</b> &#8212; <span class="desc">IPv6 Hop-by-Hop and Destination Options manipulation</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">netinet/in.h</a>&gt;</b><p>
<i class="ftype">int</i><br>
<b class="fname">inet6_option_space</b>(<i class="farg" style="white-space:nowrap;">int nbytes</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">inet6_option_init</b>(<i class="farg" style="white-space:nowrap;">void *bp</i>, <i class="farg" style="white-space:nowrap;">struct cmsghdr **cmsgp</i>, <i class="farg" style="white-space:nowrap;">int type</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">inet6_option_append</b>(<i class="farg" style="white-space:nowrap;">struct cmsghdr *cmsg</i>, <i class="farg" style="white-space:nowrap;">const uint8_t *typep</i>, <i class="farg" style="white-space:nowrap;">int multx</i>, <i class="farg" style="white-space:nowrap;">int plusy</i>);<p>
<i class="ftype">uint8_t *</i><br>
<b class="fname">inet6_option_alloc</b>(<i class="farg" style="white-space:nowrap;">struct cmsghdr *cmsg</i>, <i class="farg" style="white-space:nowrap;">int datalen</i>, <i class="farg" style="white-space:nowrap;">int multx</i>, <i class="farg" style="white-space:nowrap;">int plusy</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">inet6_option_next</b>(<i class="farg" style="white-space:nowrap;">const struct cmsghdr *cmsg</i>, <i class="farg" style="white-space:nowrap;">uint8_t **tptrp</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">inet6_option_find</b>(<i class="farg" style="white-space:nowrap;">const struct cmsghdr *cmsg</i>, <i class="farg" style="white-space:nowrap;">uint8_t **tptrp</i>, <i class="farg" style="white-space:nowrap;">int type</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> Building and parsing the Hop-by-Hop and Destination options is complicated due to alignment constraints, padding and ancillary data manipulation. RFC 2292 defines a set of functions to help the application. The function prototypes for these functions are all in the <b class="includes">&lt;<a class="link-includes">netinet/in.h</a>&gt;</b> header.<div class="subsection">
<h2 id="x696e6574365f6f7074696f6e5f7370616365">inet6_option_space</h2> <b class="fname">inet6_option_space</b>() returns the number of bytes required to hold an option when it is stored as ancillary data, including the <code class="lit">cmsghdr</code> structure at the beginning, and any padding at the end (to make its size a multiple of 8 bytes). The argument is the size of the structure defining the option, which must include any pad bytes at the beginning (the value <code class="lit">y</code> in the alignment term &#8220;<code class="lit">xn + y</code>&#8221;), the type byte, the length byte, and the option data.<p>
Note: If multiple options are stored in a single ancillary data object, which is the recommended technique, this function overestimates the amount of space required by the size of <code class="lit">N-1</code> <code class="lit">cmsghdr</code> structures, where <code class="lit">N</code> is the number of options to be stored in the object. This is of little consequence, since it is assumed that most Hop-by-Hop option headers and Destination option headers carry only one option (appendix B of [RFC 2460]).</div>
<div class="subsection">
<h2 id="x696e6574365f6f7074696f6e5f696e6974">inet6_option_init</h2> <b class="fname">inet6_option_init</b>() is called once per ancillary data object that will contain either Hop-by-Hop or Destination options. It returns <code class="lit">0</code> on success or <code class="lit">-1</code> on an error.<p>
<i class="farg">bp</i> is a pointer to previously allocated space that will contain the ancillary data object. It must be large enough to contain all the individual options to be added by later calls to <b class="fname">inet6_option_append</b>() and <b class="fname">inet6_option_alloc</b>().<p>
<i class="farg">cmsgp</i> is a pointer to a pointer to a <code class="lit">cmsghdr</code> structure. <i class="farg">*cmsgp</i> is initialized by this function to point to the <code class="lit">cmsghdr</code> structure constructed by this function in the buffer pointed to by <i class="farg">bp</i>.<p>
<i class="farg">type</i> is either <span class="define">IPV6_HOPOPTS</span> or <span class="define">IPV6_DSTOPTS</span>. This <i class="farg">type</i> is stored in the <code class="lit">cmsg_type</code> member of the <code class="lit">cmsghdr</code> structure pointed to by <i class="farg">*cmsgp</i>.</div>
<div class="subsection">
<h2 id="x696e6574365f6f7074696f6e5f617070656e64">inet6_option_append</h2> This function appends a Hop-by-Hop option or a Destination option into an ancillary data object that has been initialized by <b class="fname">inet6_option_init</b>(). This function returns <code class="lit">0</code> if it succeeds or <code class="lit">-1</code> on an error.<p>
<i class="farg">cmsg</i> is a pointer to the <code class="lit">cmsghdr</code> structure that must have been initialized by <b class="fname">inet6_option_init</b>().<p>
<i class="farg">typep</i> is a pointer to the 8-bit option type. It is assumed that this field is immediately followed by the 8-bit option data length field, which is then followed immediately by the option data. The caller initializes these three fields (the type-length-value, or TLV) before calling this function.<p>
The option type must have a value from <code class="lit">2</code> to <code class="lit">255</code>, inclusive. (<code class="lit">0</code> and <code class="lit">1</code> are reserved for the <code class="lit">Pad1</code> and <code class="lit">PadN</code> options, respectively.)<p>
The option data length must have a value between <code class="lit">0</code> and <code class="lit">255</code>, inclusive, and is the length of the option data that follows.<p>
<i class="farg">multx</i> is the value <code class="lit">x</code> in the alignment term &#8220;<code class="lit">xn + y</code>&#8221;. It must have a value of <code class="lit">1</code>, <code class="lit">2</code>, <code class="lit">4</code>, or <code class="lit">8</code>.<p>
<i class="farg">plusy</i> is the value <code class="lit">y</code> in the alignment term &#8220;<code class="lit">xn + y</code>&#8221;. It must have a value between <code class="lit">0</code> and <code class="lit">7</code>, inclusive.</div>
<div class="subsection">
<h2 id="x696e6574365f6f7074696f6e5f616c6c6f63">inet6_option_alloc</h2> This function appends a Hop-by-Hop option or a Destination option into an ancillary data object that has been initialized by <b class="fname">inet6_option_init</b>(). This function returns a pointer to the 8-bit option type field that starts the option on success, or <span class="define">NULL</span> on an error.<p>
The difference between this function and <b class="fname">inet6_option_append</b>() is that the latter copies the contents of a previously built option into the ancillary data object while the current function returns a pointer to the space in the data object where the option's TLV must then be built by the caller.<p>
<i class="farg">cmsg</i> is a pointer to the <code class="lit">cmsghdr</code> structure that must have been initialized by <b class="fname">inet6_option_init</b>().<p>
<i class="farg">datalen</i> is the value of the option data length byte for this option. This value is required as an argument to allow the function to determine if padding must be appended at the end of the option. (The <b class="fname">inet6_option_append</b>() function does not need a data length argument since the option data length must already be stored by the caller.)<p>
<i class="farg">multx</i> is the value <code class="lit">x</code> in the alignment term &#8220;<code class="lit">xn + y</code>&#8221;. It must have a value of <code class="lit">1</code>, <code class="lit">2</code>, <code class="lit">4</code>, or <code class="lit">8</code>.<p>
<i class="farg">plusy</i> is the value <code class="lit">y</code> in the alignment term &#8220;<code class="lit">xn + y</code>&#8221;. It must have a value between <code class="lit">0</code> and <code class="lit">7</code>, inclusive.</div>
<div class="subsection">
<h2 id="x696e6574365f6f7074696f6e5f6e657874">inet6_option_next</h2> This function processes the next Hop-by-Hop option or Destination option in an ancillary data object. If another option remains to be processed, the return value of the function is <code class="lit">0</code> and <i class="farg">*tptrp</i> points to the 8-bit option type field (which is followed by the 8-bit option data length, followed by the option data). If no more options remain to be processed, the return value is <code class="lit">-1</code> and <i class="farg">*tptrp</i> is <span class="define">NULL</span>. If an error occurs, the return value is <code class="lit">-1</code> and <i class="farg">*tptrp</i> is not <span class="define">NULL</span>.<p>
<i class="farg">cmsg</i> is a pointer to <code class="lit">cmsghdr</code> structure of which <code class="lit">cmsg_level</code> equals <span class="define">IPPROTO_IPV6</span> and <code class="lit">cmsg_type</code> equals either <span class="define">IPV6_HOPOPTS</span> or <span class="define">IPV6_DSTOPTS</span>.<p>
<i class="farg">tptrp</i> is a pointer to a pointer to an 8-bit byte and <i class="farg">*tptrp</i> is used by the function to remember its place in the ancillary data object each time the function is called. The first time this function is called for a given ancillary data object, <i class="farg">*tptrp</i> must be set to <span class="define">NULL</span>.<p>
Each time this function returns success, <i class="farg">*tptrp</i> points to the 8-bit option type field for the next option to be processed.</div>
<div class="subsection">
<h2 id="x696e6574365f6f7074696f6e5f66696e64">inet6_option_find</h2> This function is similar to the previously described <b class="fname">inet6_option_next</b>() function, except this function lets the caller specify the option type to be searched for, instead of always returning the next option in the ancillary data object. <i class="farg">cmsg</i> is a pointer to <code class="lit">cmsghdr</code> structure of which <code class="lit">cmsg_level</code> equals <span class="define">IPPROTO_IPV6</span> and <code class="lit">cmsg_type</code> equals either <span class="define">IPV6_HOPOPTS</span> or <span class="define">IPV6_DSTOPTS</span>.<p>
<i class="farg">tptrp</i> is a pointer to a pointer to an 8-bit byte and <i class="farg">*tptrp</i> is used by the function to remember its place in the ancillary data object each time the function is called. The first time this function is called for a given ancillary data object, <i class="farg">*tptrp</i> must be set to <span class="define">NULL</span>. <i class="file">~</i> This function starts searching for an option of the specified type beginning after the value of <i class="farg">*tptrp</i>. If an option of the specified type is located, this function returns <code class="lit">0</code> and <i class="farg">*tptrp</i> points to the 8- bit option type field for the option of the specified type. If an option of the specified type is not located, the return value is <code class="lit">-1</code> and <i class="farg">*tptrp</i> is <span class="define">NULL</span>. If an error occurs, the return value is <code class="lit">-1</code> and <i class="farg">*tptrp</i> is not <span class="define">NULL</span>.</div>
</div>
<div class="section">
<h1 id="x4558414d504c4553">EXAMPLES</h1> RFC 2292 gives comprehensive examples in chapter 6.</div>
<div class="section">
<h1 id="x444941474e4f5354494353">DIAGNOSTICS</h1> <b class="fname">inet6_option_init</b>() and <b class="fname">inet6_option_append</b>() return <code class="lit">0</code> on success or <code class="lit">-1</code> on an error.<p>
<b class="fname">inet6_option_alloc</b>() returns <span class="define">NULL</span> on an error.<p>
On errors, <b class="fname">inet6_option_next</b>() and <b class="fname">inet6_option_find</b>() return <code class="lit">-1</code> setting <i class="farg">*tptrp</i> to non <span class="define">NULL</span> value.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <span class="ref"><span class="ref-auth">W. Stevens</span> and <span class="ref-auth">M. Thomas</span>, <span class="ref-title">Advanced Sockets API for IPv6</span>, <span class="ref-num">RFC 2292</span>, <span class="ref-date">February 1998</span>.</span><p>
<span class="ref"><span class="ref-auth">S. Deering</span> and <span class="ref-auth">R. Hinden</span>, <span class="ref-title">Internet Protocol, Version 6 (IPv6) Specification</span>, <span class="ref-num">RFC 2460</span>, <span class="ref-date">December 1998</span>.</span></div>
<div class="section">
<h1 id="x5354414e4441524453">STANDARDS</h1> The functions are documented in &#8220;Advanced Sockets API for IPv6&#8221; (RFC 2292).</div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The implementation first appeared in KAME advanced networking kit.</div>
<div class="section">
<h1 id="x42554753">BUGS</h1> The text was shamelessly copied from RFC 2292.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
December 10, 1999</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

