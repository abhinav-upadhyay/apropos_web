<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
RESOLVER(3)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
RESOLVER(3)</td>
<td class="head-vol" align="center">
Library Functions Manual</td>
<td class="head-rtitle" align="right">
RESOLVER(3)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">res_ninit</b>, <b class="name">res_ourserver_p</b>, <b class="name">fp_resstat</b>, <b class="name">res_hostalias</b>, <b class="name">res_pquery</b>, <b class="name">res_nquery</b>, <b class="name">res_nsearch</b>, <b class="name">res_nquerydomain</b>, <b class="name">res_nmkquery</b>, <b class="name">res_nsend</b>, <b class="name">res_nupdate</b>, <b class="name">res_nmkupdate</b>, <b class="name">res_nclose</b>, <b class="name">res_nsendsigned</b>, <b class="name">res_findzonecut</b>, <b class="name">res_getservers</b>, <b class="name">res_setservers</b>, <b class="name">res_ndestroy</b>, <b class="name">dn_comp</b>, <b class="name">dn_expand</b>, <b class="name">res_init</b>, <b class="name">res_isourserver</b>, <b class="name">fp_nquery</b>, <b class="name">p_query</b>, <b class="name">hostalias</b>, <b class="name">res_query</b>, <b class="name">res_search</b>, <b class="name">res_querydomain</b>, <b class="name">res_mkquery</b>, <b class="name">res_send</b>, <b class="name">res_update</b>, <b class="name">res_close</b>, &#8212; <span class="desc">resolver routines</span></div>
<div class="section">
<h1 id="x4c494252415259">LIBRARY</h1> <span class="lib">Standard C Library (libc, &#45;lc)</span><br>
<span class="lib">DNS Resolver Library (libresolv, &#45;lresolv)</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">resolv.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">res_update.h</a>&gt;</b><p>
<span class="type">typedef struct __res_state *res_state</span>;<p>
<br>
<i class="ftype">int</i><br>
<b class="fname">res_ninit</b>(<i class="farg" style="white-space:nowrap;">res_state statp</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">res_ourserver_p</b>(<i class="farg" style="white-space:nowrap;">const res_state statp</i>, <i class="farg" style="white-space:nowrap;">const struct sockaddr_in *addr</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">fp_resstat</b>(<i class="farg" style="white-space:nowrap;">const res_state statp</i>, <i class="farg" style="white-space:nowrap;">FILE *fp</i>);<p>
<i class="ftype">const char *</i><br>
<b class="fname">res_hostalias</b>(<i class="farg" style="white-space:nowrap;">const res_state statp</i>, <i class="farg" style="white-space:nowrap;">const char *name</i>, <i class="farg" style="white-space:nowrap;">char *buf</i>, <i class="farg" style="white-space:nowrap;">size_t buflen</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">res_pquery</b>(<i class="farg" style="white-space:nowrap;">const res_state statp</i>, <i class="farg" style="white-space:nowrap;">const u_char *msg</i>, <i class="farg" style="white-space:nowrap;">int msglen</i>, <i class="farg" style="white-space:nowrap;">FILE *fp</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">res_nquery</b>(<i class="farg" style="white-space:nowrap;">res_state statp</i>, <i class="farg" style="white-space:nowrap;">const char *dname</i>, <i class="farg" style="white-space:nowrap;">int class</i>, <i class="farg" style="white-space:nowrap;">int type</i>, <i class="farg" style="white-space:nowrap;">u_char *answer</i>, <i class="farg" style="white-space:nowrap;">int anslen</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">res_nsearch</b>(<i class="farg" style="white-space:nowrap;">res_state statp</i>, <i class="farg" style="white-space:nowrap;">const char *dname</i>, <i class="farg" style="white-space:nowrap;">int class</i>, <i class="farg" style="white-space:nowrap;">int type</i>, <i class="farg" style="white-space:nowrap;">u_char * answer</i>, <i class="farg" style="white-space:nowrap;">int anslen</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">res_nquerydomain</b>(<i class="farg" style="white-space:nowrap;">res_state statp</i>, <i class="farg" style="white-space:nowrap;">const char *name</i>, <i class="farg" style="white-space:nowrap;">const char *domain</i>, <i class="farg" style="white-space:nowrap;">int class</i>, <i class="farg" style="white-space:nowrap;">int type</i>, <i class="farg" style="white-space:nowrap;">u_char *answer</i>, <i class="farg" style="white-space:nowrap;">int anslen</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">res_nmkquery</b>(<i class="farg">res_state statp</i>, <i class="farg">int op</i>, <i class="farg">const char *dname</i>, <i class="farg">int class</i>, <i class="farg">int type</i>, <i class="farg">const u_char *data</i>, <i class="farg">int datalen</i>, <i class="farg">const u_char *newrr</i>, <i class="farg">u_char *buf</i>, <i class="farg">int buflen</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">res_nsend</b>(<i class="farg" style="white-space:nowrap;">res_state statp</i>, <i class="farg" style="white-space:nowrap;">const u_char *msg</i>, <i class="farg" style="white-space:nowrap;">int msglen</i>, <i class="farg" style="white-space:nowrap;">u_char *answer</i>, <i class="farg" style="white-space:nowrap;">int anslen</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">res_nupdate</b>(<i class="farg" style="white-space:nowrap;">res_state statp</i>, <i class="farg" style="white-space:nowrap;">ns_updrec *rrecp_in</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">res_nmkupdate</b>(<i class="farg" style="white-space:nowrap;">res_state statp</i>, <i class="farg" style="white-space:nowrap;">ns_updrec *rrecp_in</i>, <i class="farg" style="white-space:nowrap;">u_char *buf</i>, <i class="farg" style="white-space:nowrap;">int buflen</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">res_nclose</b>(<i class="farg" style="white-space:nowrap;">res_state statp</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">res_nsendsigned</b>(<i class="farg" style="white-space:nowrap;">res_state statp</i>, <i class="farg" style="white-space:nowrap;">const u_char *msg</i>, <i class="farg" style="white-space:nowrap;">int msglen</i>, <i class="farg" style="white-space:nowrap;">ns_tsig_key *key</i>, <i class="farg" style="white-space:nowrap;">u_char *answer</i>, <i class="farg" style="white-space:nowrap;">int anslen</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">res_findzonecut</b>(<i class="farg" style="white-space:nowrap;">res_state statp</i>, <i class="farg" style="white-space:nowrap;">const char *dname</i>, <i class="farg" style="white-space:nowrap;">ns_class class</i>, <i class="farg" style="white-space:nowrap;">int options</i>, <i class="farg" style="white-space:nowrap;">char *zname</i>, <i class="farg" style="white-space:nowrap;">size_t zsize</i>, <i class="farg" style="white-space:nowrap;">struct in_addr *addrs</i>, <i class="farg" style="white-space:nowrap;">int naddrs</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">res_getservers</b>(<i class="farg" style="white-space:nowrap;">res_state statp</i>, <i class="farg" style="white-space:nowrap;">union res_sockaddr_union *set</i>, <i class="farg" style="white-space:nowrap;">int cnt</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">res_setservers</b>(<i class="farg" style="white-space:nowrap;">res_state statp</i>, <i class="farg" style="white-space:nowrap;">const union res_sockaddr_union *set</i>, <i class="farg" style="white-space:nowrap;">int cnt</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">res_ndestroy</b>(<i class="farg" style="white-space:nowrap;">res_state statp</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">dn_comp</b>(<i class="farg" style="white-space:nowrap;">const char *exp_dn</i>, <i class="farg" style="white-space:nowrap;">u_char *comp_dn</i>, <i class="farg" style="white-space:nowrap;">int length</i>, <i class="farg" style="white-space:nowrap;">u_char **dnptrs</i>, <i class="farg" style="white-space:nowrap;">u_char **lastdnptr</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">dn_expand</b>(<i class="farg" style="white-space:nowrap;">const u_char *msg</i>, <i class="farg" style="white-space:nowrap;">const u_char *eomorig</i>, <i class="farg" style="white-space:nowrap;">const u_char *comp_dn</i>, <i class="farg" style="white-space:nowrap;">char *exp_dn</i>, <i class="farg" style="white-space:nowrap;">int  length</i>);<div class="subsection">
<h2 id="x44455052454341544544">DEPRECATED</h2> <b class="includes">#include &lt;<a class="link-includes">sys/types.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">netinet/in.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">arpa/nameser.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">resolv.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">res_update.h</a>&gt;</b><p>
<i class="ftype">int</i><br>
<b class="fname">res_init</b>(<i class="farg" style="white-space:nowrap;">void</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">res_isourserver</b>(<i class="farg" style="white-space:nowrap;">const struct sockaddr_in *addr</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">fp_nquery</b>(<i class="farg" style="white-space:nowrap;">const u_char *msg</i>, <i class="farg" style="white-space:nowrap;">int msglen</i>, <i class="farg" style="white-space:nowrap;">FILE *fp</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">p_query</b>(<i class="farg" style="white-space:nowrap;">const u_char *msg</i>, <i class="farg" style="white-space:nowrap;">FILE *fp</i>);<p>
<i class="ftype">const char *</i><br>
<b class="fname">hostalias</b>(<i class="farg" style="white-space:nowrap;">const char *name</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">res_query</b>(<i class="farg" style="white-space:nowrap;">const char *dname</i>, <i class="farg" style="white-space:nowrap;">int class</i>, <i class="farg" style="white-space:nowrap;">int type</i>, <i class="farg" style="white-space:nowrap;">u_char *answer</i>, <i class="farg" style="white-space:nowrap;">int anslen</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">res_search</b>(<i class="farg" style="white-space:nowrap;">const char *dname</i>, <i class="farg" style="white-space:nowrap;">int class</i>, <i class="farg" style="white-space:nowrap;">int type</i>, <i class="farg" style="white-space:nowrap;">u_char *answer</i>, <i class="farg" style="white-space:nowrap;">int anslen</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">res_querydomain</b>(<i class="farg" style="white-space:nowrap;">const char *name</i>, <i class="farg" style="white-space:nowrap;">const char *domain</i>, <i class="farg" style="white-space:nowrap;">int class</i>, <i class="farg" style="white-space:nowrap;">int type</i>, <i class="farg" style="white-space:nowrap;">u_char *answer</i>, <i class="farg" style="white-space:nowrap;">int anslen</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">res_mkquery</b>(<i class="farg">int op</i>, <i class="farg">const char *dname</i>, <i class="farg">int class</i>, <i class="farg">int type</i>, <i class="farg">const char *data</i>, <i class="farg">int datalen</i>, <i class="farg">struct rrec *newrr</i>, <i class="farg">u_char *buf</i>, <i class="farg">int buflen</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">res_send</b>(<i class="farg" style="white-space:nowrap;">const u_char *msg</i>, <i class="farg" style="white-space:nowrap;">int msglen</i>, <i class="farg" style="white-space:nowrap;">u_char *answer</i>, <i class="farg" style="white-space:nowrap;">int anslen</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">res_update</b>(<i class="farg" style="white-space:nowrap;">ns_updrec *rrecp_in</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">res_close</b>(<i class="farg" style="white-space:nowrap;">void</i>);</div>
</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> These routines are used for making, sending and interpreting query and reply messages with Internet domain name servers.<p>
State information is kept in <i class="farg">statp</i> and is used to control the behavior of these functions. <i class="farg">statp</i> should be set to all zeros prior to the first call to any of these functions.<p>
The functions <b class="fname">res_init</b>(), <b class="fname">res_isourserver</b>(), <b class="fname">fp_nquery</b>(), <b class="fname">p_query</b>(), <b class="fname">hostalias</b>(), <b class="fname">res_query</b>(), <b class="fname">res_search</b>(), <b class="fname">res_querydomain</b>(), <b class="fname">res_mkquery</b>(), <b class="fname">res_send</b>(), <b class="fname">res_update</b>(), <b class="fname">res_close</b>() are deprecated and are supplied for compatability with old source code. They use global configuration and state information that is kept in the structure <i class="ftype">_res</i> rather than that referenced through <i class="ftype">statp</i>.<p>
Most of the values in <i class="ftype">statp</i> and <i class="ftype">_res</i> are initialized on the first call to <b class="fname">res_ninit</b>() / <b class="fname">res_init</b>() to reasonable defaults and can be ignored. Options stored in <i class="ftype">statp-&gt;options</i> / <i class="ftype">_res.options</i> are defined in <i class="file">resolv.h</i> and are as follows. Options are stored as a simple bit mask containing the bitwise &#8220;OR&#8221; of the options enabled.<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">RES_INIT</span></dt>
<dd class="list-tag" style="margin-left: 13.00ex;">
True if the initial name server address and default domain name are initialized (i.e., <b class="fname">res_ninit</b>() / <b class="fname">res_init</b>() has been called).</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">RES_DEBUG</span></dt>
<dd class="list-tag" style="margin-left: 13.00ex;">
Print debugging messages.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">RES_AAONLY</span></dt>
<dd class="list-tag" style="margin-left: 13.00ex;">
Accept authoritative answers only. Should continue until it finds an authoritative answer or finds an error. Currently this is not implemented.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">RES_USEVC</span></dt>
<dd class="list-tag" style="margin-left: 13.00ex;">
Use TCP connections for queries instead of UDP datagrams.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">RES_STAYOPEN</span></dt>
<dd class="list-tag" style="margin-left: 13.00ex;">
Used with <span class="define">RES_USEVC</span> to keep the TCP connection open between queries. This is useful only in programs that regularly do many queries. UDP should be the normal mode used.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">RES_IGNTC</span></dt>
<dd class="list-tag" style="margin-left: 13.00ex;">
Ignore truncation errors, i.e., don't retry with TCP.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">RES_RECURSE</span></dt>
<dd class="list-tag" style="margin-left: 13.00ex;">
Set the recursion-desired bit in queries. This is the default. (<b class="fname">res_nsend</b>() / <b class="fname">res_send</b>() does not do iterative queries and expects the name server to handle recursion.)</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">RES_DEFNAMES</span></dt>
<dd class="list-tag" style="margin-left: 13.00ex;">
If set, <b class="fname">res_nsearch</b>() / <b class="fname">res_search</b>() will append the default domain name to single-component names (those that do not contain a dot). This option is enabled by default.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">RES_DNSRCH</span></dt>
<dd class="list-tag" style="margin-left: 13.00ex;">
If this option is set, <b class="fname">res_nsearch</b>() / <b class="fname">res_search</b>() will search for host names in the current domain and in parent domains; see <a class="link-man" href="../html7/hostname.html">hostname(7)</a>. This is used by the standard host lookup routine <a class="link-man" href="../html3/gethostbyname.html">gethostbyname(3)</a>. This option is enabled by default.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">RES_USE_INET6</span></dt>
<dd class="list-tag" style="margin-left: 13.00ex;">
Enables support for IPv6-only applications. This causes IPv4 addresses to be returned as an IPv4 mapped address. For example, 10.1.1.1 will be returned as ::ffff:10.1.1.1. The option is meaningful with certain kernel configuration only.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">RES_USE_EDNS0</span></dt>
<dd class="list-tag" style="margin-left: 13.00ex;">
Enables support for OPT pseudo-RR for EDNS0 extension. With the option, resolver code will attach OPT pseudo-RR into DNS queries, to inform of our receive buffer size. The option will allow DNS servers to take advantage of non-default receive buffer size, and to send larger replies. DNS query packets with EDNS0 extension is not compatible with non-EDNS0 DNS servers.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">RES_NOALIASES</span></dt>
<dd class="list-tag" style="margin-left: 13.00ex;">
This option turns off the user level aliasing feature controlled by the <span class="env">HOSTALIASES</span> environment variable. Network daemons should set this option.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">RES_ROTATE</span></dt>
<dd class="list-tag" style="margin-left: 13.00ex;">
This options causes the <b class="fname">res_nsend</b>() / <b class="fname">res_send</b>() to rotate the list of nameservers in <i class="farg">statp-&gt;nsaddr_list</i> / <i class="farg">_res.nsaddr_list</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">RES_KEEPTSIG</span></dt>
<dd class="list-tag" style="margin-left: 13.00ex;">
This option causes <b class="fname">res_nsendsigned</b>() to leave the message unchanged after TSIG verification; otherwise the TSIG record would be removed and the header updated.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">RES_NOTLDQUERY</span></dt>
<dd class="list-tag" style="margin-left: 13.00ex;">
This option causes <b class="fname">res_nsearch</b>() to not attempt to resolve an unqualified name as if it were a top level domain (TLD). This option can cause problems if the site has "localhost" as a TLD rather than having localhost on one or more elements of the search list. This option has no effect if neither <span class="define">RES_DEFNAMES</span> or <span class="define">RES_DNSRCH</span> is set.</dd>
</dl>
<p>
The <b class="fname">res_ninit</b>() / <b class="fname">res_init</b>() routine reads the configuration file (if any; see <a class="link-man" href="../html5/resolv.conf.html">resolv.conf(5)</a>) to get the default domain name, search list and the Internet address of the local name server(s). If no server is configured, the host running the resolver is tried. The current domain name is defined by the hostname if not specified in the configuration file; it can be overridden by the environment variable <span class="env">LOCALDOMAIN</span>. This environment variable may contain several blank-separated tokens if you wish to override the <i class="farg">search list</i> on a per-process basis. This is similar to the <i class="farg">search</i> command in the configuration file. Another environment variable <span class="env">RES_OPTIONS</span> can be set to override certain internal resolver options which are otherwise set by changing fields in the <i class="ftype">statp</i> / <i class="ftype">_res</i> structure or are inherited from the configuration file's <i class="farg">options</i> command. The syntax of the <span class="env">RES_OPTIONS</span> environment variable is explained in <a class="link-man" href="../html5/resolv.conf.html">resolv.conf(5)</a>. Initialization normally occurs on the first call to one of the other resolver routines.<p>
In <span class="unix">NetBSD</span> the initialization code also sets up a <a class="link-man" href="../html2/kqueue.html">kqueue(2)</a> and creates a <a class="link-man" href="../html2/kevent.html">kevent(2)</a> watching a file descriptor that points to the resolver file. Every resolver function calls the internal function <b class="fname">__res_check</b>() which checks for a new <a class="link-man" href="../html2/kevent.html">kevent(2)</a> related to the <a class="link-man" href="../html5/resolv.conf.html">resolv.conf(5)</a> file, and reloads the file if necessary. This does not work if the file is accessed through a symlink and the symlink changes to point to a different file. To fix the symlink issue one could add a system call per resolver call to get the current time, and reload every so often. This is not done currently, but it is under consideration.<p>
The memory referred to by <i class="ftype">statp</i> must be set to all zeros prior to the first call to <b class="fname">res_ninit</b>(). <b class="fname">res_ndestroy</b>() should be call to free memory allocated by <b class="fname">res_ninit</b>() after last use.<p>
The <b class="fname">res_nquery</b>() / <b class="fname">res_query</b>() functions provides interfaces to the server query mechanism. They constructs a query, sends it to the local server, awaits a response, and makes preliminary checks on the reply. The query requests information of the specified <i class="farg">type</i> and <i class="farg">class</i> for the specified fully-qualified domain name <i class="farg">dname</i>. The reply message is left in the <i class="farg">answer</i> buffer with length <i class="farg">anslen</i> supplied by the caller. <b class="fname">res_nquery</b>() / <b class="fname">res_query</b>() return &#45;1 on error or the length of the answer.<p>
The <b class="fname">res_nsearch</b>() / <b class="fname">res_search</b>() routines make a query and awaits a response like <b class="fname">res_nquery</b>() / <b class="fname">res_query</b>(), but in addition, it implements the default and search rules controlled by the <span class="define">RES_DEFNAMES</span> and <span class="define">RES_DNSRCH</span> options. It returns the length of the first successful reply which is stored in <i class="ftype">answer</i> or &#45;1 on error.<p>
The remaining routines are lower-level routines used by <b class="fname">res_nquery</b>() / <b class="fname">res_query</b>(). The <b class="fname">res_nmkquery</b>() / <b class="fname">res_mkquery</b>() functions constructs a standard query message and places it in <i class="farg">buf</i>. It returns the size of the query, or &#45;1 if the query is larger than <i class="farg">buflen</i>. The query type <i class="farg">op</i> is usually <span class="define">QUERY</span>, but can be any of the query types defined in &#60;<i class="file">arpa/nameser.h</i>&#62;. The domain name for the query is given by <i class="farg">dname</i>. <i class="farg">newrr</i> is currently unused but is intended for making update messages.<p>
The <b class="fname">res_nsend</b>() / <b class="fname">res_send</b>() / <b class="fname">res_nsendsigned</b>() routines sends a pre-formatted query and returns an answer. It will call <b class="fname">res_ninit</b>() / <b class="fname">res_init</b>() if <span class="define">RES_INIT</span> is not set, send the query to the local name server, and handle timeouts and retries. Additionally, <b class="fname">res_nsendsigned</b>() will use TSIG signatures to add authentication to the query and verify the response. In this case, only one nameserver will be contacted. The length of the reply message is returned, or &#45;1 if there were errors.<p>
<b class="fname">res_nquery</b>() / <b class="fname">res_query</b>(), <b class="fname">res_nsearch</b>() / <b class="fname">res_search</b>() and <b class="fname">res_nsend</b>() / <b class="fname">res_send</b>() return a length that may be bigger than <i class="farg">anslen</i>. In that case the query should be retried with a bigger buffer. NOTE the answer to the second query may be larger still so supplying a buffer that bigger that the answer returned by the previous query is recommended.<p>
<i class="farg">answer</i> MUST be big enough to receive a maximum UDP response from the server or parts of the answer will be silently discarded. The default maximum UDP response size is 512 bytes.<p>
The function <b class="fname">res_ourserver_p</b>() returns true when <i class="farg">inp</i> is one of the servers in <i class="farg">statp-&gt;nsaddr_list</i> / <i class="farg">_res.nsaddr_list</i>.<p>
The functions <b class="fname">fp_nquery</b>() / <b class="fname">p_query</b>() print out the query and any answer in <i class="farg">msg</i> on <i class="farg">fp</i>. <b class="fname">p_query</b>() is equivalent to <b class="fname">fp_nquery</b>() with <i class="farg">msglen</i> set to 512.<p>
The function <b class="fname">fp_resstat</b>() prints out the active flag bits in <i class="farg">statp-&gt;options</i> preceeded by the text ";; res options:" on <i class="farg">file</i>.<p>
The functions <b class="fname">res_hostalias</b>() / <b class="fname">hostalias</b>() lookup up name in the file referred to by the <span class="env">HOSTALIASES</span> files return a fully qualified hostname if found or NULL if not found or an error occurred. <b class="fname">res_hostalias</b>() uses <i class="farg">buf</i> to store the result in, <b class="fname">hostalias</b>() uses a static buffer.<p>
The functions <b class="fname">res_getservers</b>() and <b class="fname">res_setservers</b>() are used to get and set the list of server to be queried.<p>
The functions <b class="fname">res_nupdate</b>() / <b class="fname">res_update</b>() take a list of ns_updrec <i class="farg">rrecp_in</i>. Identifies the containing zone for each record and groups the records according to containing zone maintaining in zone order then sends and update request to the servers for these zones. The number of zones updated is returned or &#45;1 on error. Note that <b class="fname">res_nupdate</b>() will perform TSIG authenticated dynamic update operations if the key is not NULL.<p>
The function <b class="fname">res_findzonecut</b>() discovers the closest enclosing zone cut for a specified domain name, and finds the IP addresses of the zone's master servers.<p>
The functions <b class="fname">res_nmkupdate</b>() / <b class="fname">res_mkupdate</b>() take a linked list of ns_updrec <i class="farg">rrecp_in</i> and construct a UPDATE message in <i class="farg">buf</i>. <b class="fname">res_nmkupdate</b>() / <b class="fname">res_mkupdate</b>() return the length of the constructed message on no error or one of the following error values.<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-inset">
<dt class="list-inset" style="margin-top: 1.00em;">
&#45;1</dt>
<dd class="list-inset" style="margin-left: 2.00ex;">
An error occurred parsing <i class="farg">rrecp_in</i>.</dd>
<dt class="list-inset" style="margin-top: 1.00em;">
&#45;2</dt>
<dd class="list-inset" style="margin-left: 2.00ex;">
The buffer <i class="farg">buf</i> was too small.</dd>
<dt class="list-inset" style="margin-top: 1.00em;">
&#45;3</dt>
<dd class="list-inset" style="margin-left: 2.00ex;">
The first record was not a zone section or there was a section order problem. The section order is S_ZONE, S_PREREQ and S_UPDATE.</dd>
<dt class="list-inset" style="margin-top: 1.00em;">
&#45;4</dt>
<dd class="list-inset" style="margin-left: 2.00ex;">
A number overflow occurred.</dd>
<dt class="list-inset" style="margin-top: 1.00em;">
&#45;5</dt>
<dd class="list-inset" style="margin-left: 2.00ex;">
Unknown operation or no records.</dd>
</dl>
<p>
The functions <b class="fname">res_nclose</b>() / <b class="fname">res_close</b>() close any open files referenced through <i class="farg">statp</i> / <i class="farg">_res</i>.<p>
The function <b class="fname">res_ndestroy</b>() calls <b class="fname">res_nclose</b>() then frees any memory allocated by <b class="fname">res_ninit</b>().<p>
The <b class="fname">dn_comp</b>() function compresses the domain name <i class="farg">exp_dn</i> and stores it in <i class="farg">comp_dn</i>. The size of the compressed name is returned or &#45;1 if there were errors. The size of the array pointed to by <i class="farg">comp_dn</i> is given by <i class="farg">length</i>. The compression uses an array of pointers <i class="farg">dnptrs</i> to previously-compressed names in the current message. The first pointer points to the beginning of the message and the list ends with <span class="define">NULL</span>. The limit to the array is specified by <i class="farg">lastdnptr</i>. A side effect of <b class="fname">dn_comp</b>() is to update the list of pointers for labels inserted into the message as the name is compressed. If <i class="farg">dnptr</i> is <span class="define">NULL</span>, names are not compressed. If <i class="farg">lastdnptr</i> is <span class="define">NULL</span>, the list of labels is not updated.<p>
The <b class="fname">dn_expand</b>() entry expands the compressed domain name <i class="farg">comp_dn</i> to a full domain name. The compressed name is contained in a query or reply message; <i class="farg">msg</i> is a pointer to the beginning of the message. <i class="farg">eomorig</i> is a pointer to the first location after the message. The uncompressed name is placed in the buffer indicated by <i class="farg">exp_dn</i> which is of size <i class="farg">length</i>. The size of compressed name is returned or &#45;1 if there was an error.<p>
The variables <i class="ftype">statp-&gt;res_h_errno</i> / <i class="ftype">_res.res_h_errno</i> and external variable <i class="ftype">h_errno</i> is set whenever an error occurs during resolver operation. The following definitions are given in &#60;<i class="file">netdb.h</i>&#62;:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
#define NETDB_INTERNAL -1 
/* see errno */ 
#define NETDB_SUCCESS  0 
/* no problem */ 
#define HOST_NOT_FOUND 1 
/* Authoritative Answer Host not found */ 
#define TRY_AGAIN      2 
/* Non-Authoritative not found, or SERVFAIL */ 
#define NO_RECOVERY    3 
/* Non-Recoverable: FORMERR, REFUSED, NOTIMP */ 
#define NO_DATA        4 
/* Valid name, no data for requested type */</pre>
<p>
The following functions are only in <span class="define">libresolv</span>: <b class="fname">res_findzonecut</b>(), <b class="fname">res_nmkupdate</b>(), <b class="fname">res_nsendsigned</b>(), and <b class="fname">res_nupdate</b>(). All the rest are in both <span class="define">libc</span> and <span class="define">libresolv</span>.</div>
<div class="section">
<h1 id="x46494c4553">FILES</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="file">/etc/resolv.conf</i></dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
The configuration file, see <a class="link-man" href="../html5/resolv.conf.html">resolv.conf(5)</a>.</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html3/getaddrinfo.html">getaddrinfo(3)</a>, <a class="link-man" href="../html3/gethostbyaddr.html">gethostbyaddr(3)</a>, <a class="link-man" href="../html3/gethostbyname.html">gethostbyname(3)</a>, <a class="link-man" href="../html3/getnameinfo.html">getnameinfo(3)</a>, <a class="link-man" href="../html5/resolv.conf.html">resolv.conf(5)</a>, <a class="link-man" href="../html7/hostname.html">hostname(7)</a>, <a class="link-man" href="../html8/named.html">named(8)</a><p>
<span class="ref-title">RFC 974,</span> <span class="ref-title">RFC 1032,</span> <span class="ref-title">RFC 1033,</span> <span class="ref-title">RFC 1034,</span> <span class="ref-title">RFC 1035,</span> <span class="ref-title">RFC 1535</span><p>
<span class="ref"><span class="ref-title">Name Server Operations Guide for BIND</span>.</span></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="name">res_ninit</b> function appeared in <span class="unix">4.3BSD</span>.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
November 13, 2013</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

