<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/../4/strict.dtd">
>
<head>
<meta http-equiv="Content-Type" content="te../; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
SYSLOG(3)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
SYSLOG(3)</td>
<td class="head-vol" align="center">
Library Functions Manual</td>
<td class="head-rtitle" align="right">
SYSLOG(3)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">syslog</b>, <b class="name">syslog_r</b>, <b class="name">vsyslog</b>, <b class="name">vsyslog_r</b>, <b class="name">syslogp</b>, <b class="name">syslogp_r</b>, <b class="name">vsyslogp</b>, <b class="name">vsyslogp_r</b>, <b class="name">openlog</b>, <b class="name">openlog_r</b>, <b class="name">closelog</b>, <b class="name">closelog_r</b>, <b class="name">setlogmask</b>, <b class="name">setlogmask_r</b> &#8212; <span class="desc">control system log</span></div>
<div class="section">
<h1 id="x4c494252415259">LIBRARY</h1> <span class="lib">Standard C Library (libc, &#45;lc)</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">syslog.h</a>&gt;</b><p>
<i class="ftype">void</i><br>
<b class="fname">syslog</b>(<i class="farg" style="white-space:nowrap;">int priority</i>, <i class="farg" style="white-space:nowrap;">const char *message</i>, <i class="farg" style="white-space:nowrap;">...</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">syslog_r</b>(<i class="farg" style="white-space:nowrap;">int priority</i>, <i class="farg" style="white-space:nowrap;">struct syslog_data *data</i>, <i class="farg" style="white-space:nowrap;">const char *message</i>, <i class="farg" style="white-space:nowrap;">...</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">syslogp</b>(<i class="farg" style="white-space:nowrap;">int priority</i>, <i class="farg" style="white-space:nowrap;">const char *msgid</i>, <i class="farg" style="white-space:nowrap;">const char *sdfmt</i>, <i class="farg" style="white-space:nowrap;">const char *message</i>, <i class="farg" style="white-space:nowrap;">...</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">syslogp_r</b>(<i class="farg" style="white-space:nowrap;">int priority</i>, <i class="farg" style="white-space:nowrap;">struct syslog_data *data</i>, <i class="farg" style="white-space:nowrap;">const char *msgid</i>, <i class="farg" style="white-space:nowrap;">const char *sdfmt</i>, <i class="farg" style="white-space:nowrap;">const char *message</i>, <i class="farg" style="white-space:nowrap;">...</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">openlog</b>(<i class="farg" style="white-space:nowrap;">const char *ident</i>, <i class="farg" style="white-space:nowrap;">int logopt</i>, <i class="farg" style="white-space:nowrap;">int facility</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">openlog_r</b>(<i class="farg" style="white-space:nowrap;">const char *ident</i>, <i class="farg" style="white-space:nowrap;">int logopt</i>, <i class="farg" style="white-space:nowrap;">int facility</i>, <i class="farg" style="white-space:nowrap;">struct syslog_data *data</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">closelog</b>(<i class="farg" style="white-space:nowrap;">void</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">closelog_r</b>(<i class="farg" style="white-space:nowrap;">struct syslog_data *data</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">setlogmask</b>(<i class="farg" style="white-space:nowrap;">int maskpri</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">setlogmask_r</b>(<i class="farg" style="white-space:nowrap;">int maskpri</i>, <i class="farg" style="white-space:nowrap;">struct syslog_data *data</i>);<p>
<b class="includes">#include &lt;<a class="link-includes">stdarg.h</a>&gt;</b><p>
<i class="ftype">void</i><br>
<b class="fname">vsyslog</b>(<i class="farg" style="white-space:nowrap;">int priority</i>, <i class="farg" style="white-space:nowrap;">const char *message</i>, <i class="farg" style="white-space:nowrap;">va_list args</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">vsyslog_r</b>(<i class="farg" style="white-space:nowrap;">int priority</i>, <i class="farg" style="white-space:nowrap;">struct syslog_data *data</i>, <i class="farg" style="white-space:nowrap;">const char *message</i>, <i class="farg" style="white-space:nowrap;">va_list args</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">vsyslogp</b>(<i class="farg" style="white-space:nowrap;">int priority</i>, <i class="farg" style="white-space:nowrap;">const char *msgid</i>, <i class="farg" style="white-space:nowrap;">const char *sdfmt</i>, <i class="farg" style="white-space:nowrap;">const char *message</i>, <i class="farg" style="white-space:nowrap;">va_list args</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">vsyslogp_r</b>(<i class="farg" style="white-space:nowrap;">int priority</i>, <i class="farg" style="white-space:nowrap;">struct syslog_data *data</i>, <i class="farg" style="white-space:nowrap;">const char *msgid</i>, <i class="farg" style="white-space:nowrap;">const char *sdfmt</i>, <i class="farg" style="white-space:nowrap;">const char *message</i>, <i class="farg" style="white-space:nowrap;">va_list args</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="fname">syslog</b>() function writes <i class="farg">message</i> to the system message logger. The message is then written to the system console, log files, logged-in users, or forwarded to other machines as appropriate (see <a class="link-man" href="../8/syslogd">syslogd(8)</a>).<p>
The message is identical to a <a class="link-man" href="../3/printf">printf(3)</a> format string, except that &#8216;<code class="lit">%m</code>&#8217; is replaced by the current error message. (As denoted by the global variable <b class="var">errno</b>; see <a class="link-man" href="../3/strerror">strerror(3)</a>.) A trailing newline is added if none is present.<p>
The <b class="fname">syslog_r</b>() function is a multithread-safe version of the <b class="fname">syslog</b>() function. It takes a pointer to a <i class="farg">syslog_data</i> structure which is used to store information. This parameter must be initialized before <b class="fname">syslog_r</b>() is called. The <span class="define">SYSLOG_DATA_INIT</span> constant is used for this purpose. The <i class="farg">syslog_data</i> structure and the <span class="define">SYSLOG_DATA_INIT</span> constant are defined as:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
struct syslog_data { 
        int             log_file; 
        int             connected; 
        int             opened; 
        int             log_stat; 
        const char     *log_tag; 
        int             log_fac; 
        int             log_mask; 
}; 
 
#define SYSLOG_DATA_INIT { &#92; 
    .log_file = -1, &#92; 
    .log_fac = LOG_USER, &#92; 
    .log_mask = 0xff, &#92; 
}</pre>
<p>
The structure is composed of the following elements:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="var">log_file</b></dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
contains the file descriptor of the file where the message is logged</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="var">connected</b></dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
indicates if connect has been done</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="var">opened</b></dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
indicates if <b class="fname">openlog_r</b>() has been called</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="var">log_stat</b></dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
status bits, set by <b class="fname">openlog_r</b>()</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="var">log_tag</b></dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
string to tag the entry with</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="var">log_fac</b></dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
facility code</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="var">log_mask</b></dt>
<dd class="list-tag" style="margin-left: 9.00ex;">
mask of priorities to be logged</dd>
</dl>
<p>
The <b class="fname">vsyslog</b>() function is an alternative form in which the arguments have already been captured using the variable-length argument facilities of <a class="link-man" href="../3/stdarg">stdarg(3)</a>.<p>
The <b class="fname">syslogp</b>() variants take additional arguments which correspond to new fields in the syslog-protocol message format. All three arguments are evaluated as <a class="link-man" href="../3/printf">printf(3)</a> format strings and any of them can be <span class="define">NULL</span>. This enables applications to use message IDs, structured data, and UTF-8 encoded content in messages.<p>
The message is tagged with <i class="farg">priority</i>. Priorities are encoded as a <i class="farg">facility</i> and a <span class="emph">level</span>. The facility describes the part of the system generating the message. The level is selected from the following <span class="emph">ordered</span> (high to low) list:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">LOG_EMERG</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
A panic condition. This is normally broadcast to all users.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">LOG_ALERT</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
A condition that should be corrected immediately, such as a corrupted system database.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">LOG_CRIT</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Critical conditions, e.g., hard device errors.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">LOG_ERR</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Errors.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">LOG_WARNING</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Warning messages.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">LOG_NOTICE</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Conditions that are not error conditions, but should possibly be handled specially.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">LOG_INFO</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Informational messages.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">LOG_DEBUG</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Messages that contain information normally of use only when debugging a program.</dd>
</dl>
<p>
The <b class="fname">vsyslog_r</b>() is used the same way as <b class="fname">vsyslog</b>() except that it takes an additional pointer to a <i class="farg">syslog_data</i> structure. It is a multithread-safe version of the <b class="fname">vsyslog</b>() function described above.<p>
The <b class="fname">openlog</b>() function provides for more specialized processing of the messages sent by <b class="fname">syslog</b>() and <b class="fname">vsyslog</b>(). The parameter <i class="farg">ident</i> is a string that will be prepended to every message. The <i class="farg">logopt</i> argument is a bit field specifying logging options, which is formed by OR'ing one or more of the following values:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">LOG_CONS</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
If <b class="fname">syslog</b>() cannot pass the message to <a class="link-man" href="../8/syslogd">syslogd(8)</a> it will attempt to write the message to the console (&#8220;<i class="file">/dev/console</i>&#8221;).</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">LOG_NDELAY</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Open the connection to <a class="link-man" href="../8/syslogd">syslogd(8)</a> immediately. Normally the open is delayed until the first message is logged. Useful for programs that need to manage the order in which file descriptors are allocated.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">LOG_PERROR</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Write the message to standard error output as well to the system log.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">LOG_PID</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Log the process id with each message: useful for identifying instantiations of daemons. (This PID is placed within brackets between the ident and the message.)</dd>
</dl>
<p>
The <i class="farg">facility</i> parameter encodes a default facility to be assigned to all messages that do not have an explicit facility encoded:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">LOG_AUTH</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
The authorization system: <a class="link-man" href="../1/login">login(1)</a>, <a class="link-man" href="../1/su">su(1)</a>, <a class="link-man" href="../8/getty">getty(8)</a>, etc.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">LOG_AUTHPRIV</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
The same as <span class="define">LOG_AUTH</span>, but logged to a file readable only by selected individuals.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">LOG_CRON</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
The cron daemon: <a class="link-man" href="../8/cron">cron(8)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">LOG_DAEMON</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
System daemons, such as <a class="link-man" href="../8/routed">routed(8)</a>, that are not provided for explicitly by other facilities.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">LOG_FTP</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
The file transfer protocol daemon: <a class="link-man" href="../8/ftpd">ftpd(8)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">LOG_KERN</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Messages generated by the kernel. These cannot be generated by any user processes.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">LOG_LPR</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
The line printer spooling system: <a class="link-man" href="../1/lpr">lpr(1)</a>, <a class="link-man" href="../8/lpc">lpc(8)</a>, <a class="link-man" href="../8/lpd">lpd(8)</a>, etc.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">LOG_MAIL</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
The mail system.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">LOG_NEWS</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
The network news system.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">LOG_SYSLOG</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Messages generated internally by <a class="link-man" href="../8/syslogd">syslogd(8)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">LOG_USER</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Messages generated by random user processes. This is the default facility identifier if none is specified.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">LOG_UUCP</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
The uucp system.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">LOG_LOCAL0</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Reserved for local use. Similarly for <span class="define">LOG_LOCAL1</span> through <span class="define">LOG_LOCAL7</span>.</dd>
</dl>
<p>
The <b class="fname">openlog_r</b>() function is the multithread-safe version of the <b class="fname">openlog</b>() function. It takes an additional pointer to a <i class="farg">syslog_data</i> structure. This function must be used in conjunction with the other multithread-safe functions.<p>
The <b class="fname">closelog</b>() function can be used to close the log file.<p>
The <b class="fname">closelog_r</b>() does the same thing as <a class="link-man" href="../3/closelog">closelog(3)</a> but in a multithread-safe way and takes an additional pointer to a <i class="farg">syslog_data</i> structure.<p>
The <b class="fname">setlogmask</b>() function sets the log priority mask to <i class="farg">maskpri</i> and returns the previous mask. Calls to <b class="fname">syslog</b>() with a priority not set in <i class="farg">maskpri</i> are rejected. The mask for an individual priority <i class="farg">pri</i> is calculated by the macro <b class="fname">LOG_MASK</b>(<i class="farg">pri</i>); the mask for all priorities up to and including <i class="farg">toppri</i> is given by the macro <b class="fname">LOG_UPTO</b>(<i class="farg">toppri</i>). The default allows all priorities to be logged.<p>
The <b class="fname">setlogmask_r</b>() function is the multithread-safe version of <b class="fname">setlogmask</b>(). It takes an additional pointer to a <i class="farg">syslog_data</i> structure.</div>
<div class="section">
<h1 id="x52455455524e2056414c554553">RETURN VALUES</h1> The routines <b class="fname">closelog</b>(), <b class="fname">closelog_r</b>(), <b class="fname">openlog</b>(), <b class="fname">openlog_r</b>(), <b class="fname">syslog</b>(), <b class="fname">syslog_r</b>(), <b class="fname">vsyslog</b>(), <b class="fname">vsyslog_r</b>(), <b class="fname">syslogp</b>(), <b class="fname">syslogp_r</b>(), <b class="fname">vsyslogp</b>(), and <b class="fname">vsyslogp_r</b>() return no value.<p>
The routines <b class="fname">setlogmask</b>() and <b class="fname">setlogmask_r</b>() always return the previous log mask level.</div>
<div class="section">
<h1 id="x4558414d504c4553">EXAMPLES</h1><pre style="margin-left: 5.00ex;" class="lit display">
syslog(LOG_ALERT, "who: internal error 23"); 
 
openlog("ftpd", LOG_PID | LOG_NDELAY, LOG_FTP); 
 
setlogmask(LOG_UPTO(LOG_ERR)); 
 
syslog(LOG_INFO, "Connection from host %d", CallingHost); 
 
syslog(LOG_INFO|LOG_LOCAL2, "foobar error: %m"); 
 
syslogp(LOG_INFO|LOG_LOCAL2, NULL, NULL, "foobar error: %m"); 
 
syslogp(LOG_INFO, "ID%d", "[meta language=&#92;"en-US&#92;"]", 
        "event: %s", 42, EventDescription);</pre>
<p>
For the multithread-safe functions:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
struct syslog_data sdata = SYSLOG_DATA_INIT; 
 
syslog_r(LOG_INFO|LOG_LOCAL2, &amp;sdata, "foobar error: %m");</pre>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../1/logger">logger(1)</a>, <a class="link-man" href="../8/syslogd">syslogd(8)</a><p>
<span class="ref"><span class="ref-title">The BSD syslog Protocol</span>, <span class="ref-rep">RFC</span>, <span class="ref-num">3164</span>, <span class="ref-date">August 2001</span>.</span><p>
<span class="ref"><span class="ref-title">The syslog Protocol</span>, <span class="ref-rep">Internet-Draft</span>, <span class="ref-num">draft-ietf-syslog-protocol-23</span>, <span class="ref-date">September 2007</span>.</span></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> These non-multithread-safe functions appeared in <span class="unix">4.2BSD</span>. The multithread-safe functions appeared in <span class="unix">OpenBSD&#160;3.1</span> and then in <span class="unix">NetBSD&#160;4.0</span>. The async-signal-safe functions appeared in <span class="unix">NetBSD&#160;4.0</span>. The syslog-protocol functions appeared in <span class="unix">NetBSD&#160;5.0</span>.</div>
<div class="section">
<h1 id="x43415645415453">CAVEATS</h1> It is important never to pass a string with user-supplied data as a format without using &#8216;<code class="lit">%s</code>&#8217;. An attacker can put format specifiers in the string to mangle your stack, leading to a possible security hole. This holds true even if you have built the string &#8220;by hand&#8221; using a function like <b class="fname">snprintf</b>(), as the resulting string may still contain user-supplied conversion specifiers for later interpolation by <b class="fname">syslog</b>().<p>
Always be sure to use the proper secure idiom:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
syslog(priority, "%s", string);</pre>
<p>
With <b class="fname">syslogp</b>() the caller is responsible to use the right formatting for the message fields. A <i class="farg">msgid</i> must only contain up to 32 ASCII characters. A <i class="farg">sdfmt</i> has strict rules for paranthesis and character quoting. If the <i class="farg">msgfmt</i> contains UTF-8 characters, then it has to start with a Byte Order Mark.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
May 3, 2010</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
<>

