<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
YPCLNT(3)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
YPCLNT(3)</td>
<td class="head-vol" align="center">
Library Functions Manual</td>
<td class="head-rtitle" align="right">
YPCLNT(3)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">yp_all</b>, <b class="name">yp_bind</b>, <b class="name">yp_first</b>, <b class="name">yp_get_default_domain</b>, <b class="name">yp_master</b>, <b class="name">yp_match</b>, <b class="name">yp_next</b>, <b class="name">yp_order</b>, <b class="name">yp_unbind</b>, <b class="name">yperr_string</b>, <b class="name">ypprot_err</b> <b class="name">yp_setbindtries</b> &#8212; <span class="desc">Interface to the YP subsystem</span></div>
<div class="section">
<h1 id="x4c494252415259">LIBRARY</h1> <span class="lib">Standard C Library (libc, &#45;lc)</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">sys/types.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">rpc/rpc.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">rpcsvc/ypclnt.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">rpcsvc/yp_prot.h</a>&gt;</b><p>
<i class="ftype">int</i><br>
<b class="fname">yp_all</b>(<i class="farg" style="white-space:nowrap;">const char *indomain</i>, <i class="farg" style="white-space:nowrap;">const char *inmap</i>, <i class="farg" style="white-space:nowrap;">struct ypall_callback *incallback</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">yp_bind</b>(<i class="farg" style="white-space:nowrap;">const char *dom</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">yp_first</b>(<i class="farg" style="white-space:nowrap;">const char *indomain</i>, <i class="farg" style="white-space:nowrap;">const char *inmap</i>, <i class="farg" style="white-space:nowrap;">char **outkey</i>, <i class="farg" style="white-space:nowrap;">int *outkeylen</i>, <i class="farg" style="white-space:nowrap;">char **outval</i>, <i class="farg" style="white-space:nowrap;">int *outvallen</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">yp_get_default_domain</b>(<i class="farg" style="white-space:nowrap;">char **outdomain</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">yp_master</b>(<i class="farg" style="white-space:nowrap;">const char *indomain</i>, <i class="farg" style="white-space:nowrap;">const char *inmap</i>, <i class="farg" style="white-space:nowrap;">char **outname</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">yp_match</b>(<i class="farg" style="white-space:nowrap;">const char *indomain</i>, <i class="farg" style="white-space:nowrap;">const char *inmap</i>, <i class="farg" style="white-space:nowrap;">const char *inkey</i>, <i class="farg" style="white-space:nowrap;">int inkeylen</i>, <i class="farg" style="white-space:nowrap;">char **outval</i>, <i class="farg" style="white-space:nowrap;">int *outvallen</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">yp_next</b>(<i class="farg" style="white-space:nowrap;">const char *indomain</i>, <i class="farg" style="white-space:nowrap;">const char *inmap</i>, <i class="farg" style="white-space:nowrap;">const char *inkey</i>, <i class="farg" style="white-space:nowrap;">int inkeylen</i>, <i class="farg" style="white-space:nowrap;">char **outkey</i>, <i class="farg" style="white-space:nowrap;">int *outkeylen</i>, <i class="farg" style="white-space:nowrap;">char **outval</i>, <i class="farg" style="white-space:nowrap;">int *outvallen</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">yp_order</b>(<i class="farg" style="white-space:nowrap;">const char *indomain</i>, <i class="farg" style="white-space:nowrap;">const char *inmap</i>, <i class="farg" style="white-space:nowrap;">int *outorder</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">yp_unbind</b>(<i class="farg" style="white-space:nowrap;">const char *dom</i>);<p>
<i class="ftype">char *</i><br>
<b class="fname">yperr_string</b>(<i class="farg" style="white-space:nowrap;">int incode</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">ypprot_err</b>(<i class="farg" style="white-space:nowrap;">unsigned int incode</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">yp_setbindtries</b>(<i class="farg" style="white-space:nowrap;">int ntries</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="name">ypclnt</b> suite provides an interface to the YP subsystem. For a general description of the YP subsystem, see <a class="link-man" href="../html8/yp.html">yp(8)</a>.<p>
For all functions, input values begin with <i class="file">in</i> and output values begin with <i class="file">out</i>.<p>
Any output values of type <span class="emph">char **</span> should be the addresses of uninitialized character pointers. These values will be reset to the null pointer (unless the address itself is the null pointer, in which case the error <span class="errno">YPERR_BADARGS</span> will be returned). If necessary, memory will be allocated by the YP client routines using <b class="fname">malloc</b>(), and the result will be stored in the appropriate output value. If the invocation of a YP client routine doesn't return an error, and an output value is not the null pointer, then this memory should be freed by the user when there is no additional need for the data stored there. For <i class="file">outkey</i> and <i class="file">outval</i>, two extra bytes of memory are allocated for a &#8216;<code class="lit">&#92;n</code>&#8217; and &#8216;<code class="lit">&#92;0</code>&#8217;, which are not reflected in the values of <i class="file">outkeylen</i> or <i class="file">outvallen</i>.<p>
All occurrences of <i class="file">indomain</i> and <i class="file">inmap</i> must be non-null, NUL-terminated strings. All input strings which also have a corresponding length parameter cannot be the null pointer unless the corresponding length value is zero. Such strings need not be NUL-terminated.<p>
All YP lookup calls (the functions <b class="fname">yp_all</b>(), <b class="fname">yp_first</b>(), <b class="fname">yp_master</b>(), <b class="fname">yp_match</b>(), <b class="fname">yp_next</b>(), <b class="fname">yp_order</b>()) require a YP domain name and a YP map name. The default domain name may be obtained by calling <b class="fname">yp_get_default_domain</b>(), and should thus be used before all other YP calls in a client program. The value it places <i class="file">outdomain</i> is suitable for use as the <i class="file">indomain</i> parameter to all subsequent YP calls.<p>
In order for YP lookup calls to succeed, the client process must be bound to a YP server process. The client process need not explicitly bind to the server, as it happens automatically whenever a lookup occurs. The function <b class="fname">yp_bind</b>() is provided for a backup strategy, e.g. a local file, when a YP server process is not available. Each binding uses one socket descriptor on the client process, which may be explicitly freed using <b class="fname">yp_unbind</b>(), which frees all per-process and per-node resources to bind the domain and marks the domain unbound.<p>
If, during a YP lookup, an RPC failure occurs, the domain used in the lookup is automatically marked unbound and the <b class="name">ypclnt</b> layer retries the lookup as long as <a class="link-man" href="../html8/ypbind.html">ypbind(8)</a> is running and either the client process cannot bind to a server for the domain specified in the lookup, or RPC requests to the YP server process fail. If an error is not RPC-related, one of the YP error codes described below is returned and control given back to the user code.<p>
The <b class="name">ypclnt</b> suite provides the following functionality:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">yp_match</b>()</dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Provides the value associated with the given key.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">yp_first</b>()</dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Provides the first key-value pair from the given map in the named domain.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">yp_next</b>()</dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Provides the next key-value pair in the given map. To obtain the second pair, the <i class="file">inkey</i> value should be the <i class="file">outkey</i> value provided by the initial call to <b class="fname">yp_first</b>(). In the general case, the next key-value pair may be obtained by using the <i class="file">outkey</i> value from the previous call to <b class="fname">yp_next</b>() as the value for <i class="file">inkey</i>.<p>
Of course, the notions of &#8220;first&#8221; and &#8220;next&#8221; are particular to the type of YP map being accessed, and thus there is no guarantee of lexical order. The only guarantees provided with <b class="fname">yp_first</b>() and <b class="fname">yp_next</b>(), providing that the same map on the same server is polled repeatedly until <b class="fname">yp_next</b>() returns YPERR_NOMORE, are that all key-value pairs in that map will be accessed exactly once, and if the entire procedure is repeated, the order will be the same.<p>
If the server is heavily loaded or the server fails for some reason, the domain being used may become unbound. If this happens, and the client process re-binds, the retrieval rules will break: some entries may be seen twice, and others not at all. For this reason, the function <b class="fname">yp_all</b>() provides a better solution for reading all of the entries in a particular map.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">yp_all</b>()</dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
This function provides a way to transfer an entire map from the server to the client process with a single request. This transfer uses TCP, unlike all other functions in the <b class="name">ypclnt</b> suite, which use UDP. The entire transaction occurs in a single RPC request-response. The third argument to this function provides a way to supply the name of a function to process each key-value pair in the map. <b class="fname">yp_all</b>() returns after the entire transaction is complete, or the <i class="file">foreach</i> function decides that it does not want any more key-value pairs. The third argument to <b class="fname">yp_all</b>() is:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
struct ypall_callback *incallback { 
	int (*foreach)(); 
	char *data; 
};</pre>
<p>
The <span class="emph">char *data</span> argument is an opaque pointer for use by the callback function. The <i class="file">foreach</i> function should return non-zero when it no longer wishes to process key-value pairs, at which time <b class="fname">yp_all</b>() returns a value of 0, and is called with the following arguments:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
int foreach ( 
	int instatus, 
	char *inkey, 
	int inkeylen, 
	char *inval, 
	int invallen, 
	char *indata 
);</pre>
<p>
Where:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">instatus</i></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Holds one of the return status values described in <b class="includes">&lt;<a class="link-includes">rpcsvc/yp_prot.h</a>&gt;</b>: see <b class="fname">ypprot_err</b>() below for a function that will translate YP protocol errors into a <b class="name">ypclnt</b> layer error code as described in <b class="includes">&lt;<a class="link-includes">rpcsvc/ypclnt.h</a>&gt;</b>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">inkey, inval</i></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
The key and value arguments are somewhat different here than described above. In this case, the memory pointed to by <i class="farg">inkey</i> and <i class="farg">inval</i> is private to <b class="fname">yp_all</b>(), and is overwritten with each subsequent key-value pair, thus the <i class="file">foreach</i> function should do something useful with the contents of that memory during each iteration. If the key-value pairs are not terminated with either &#8216;<code class="lit">&#92;n</code>&#8217; or &#8216;<code class="lit">&#92;0</code>&#8217; in the map, then they will not be terminated as such when given to the <i class="file">foreach</i> function, either.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="farg">indata</i></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
This is the contents of the <i class="file">incallback-&gt;data</i> element of the callback structure. It is provided as a means to share state between the <i class="file">foreach</i> function and the user code. Its use is completely optional: cast it to something useful or simply ignore it.</dd>
</dl>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">yp_order</b>()</dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Returns the order number for a map.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">yp_master</b>()</dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Returns the hostname for the machine on which the master YP server process for a map is running.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">yperr_string</b>()</dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Returns a pointer to a NUL-terminated error string that does not contain a &#8216;<code class="lit">.</code>&#8217; or &#8216;<code class="lit">&#92;n</code>&#8217;.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">ypprot_err</b>()</dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Converts a YP protocol error code to a <b class="name">ypclnt</b> error code suitable for <b class="fname">yperr_string</b>().</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">yp_setbindtries</b>()</dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Set the number of tries to attempt to bind to the domain before returning an error. The default is <span class="define">0</span> which means wait forever if no ypserver is not found of if the RPC communication with the yp server fails. If the number passed is negative, the current number of tries is not modified.<p>
This function is an extention to the client library that allows application to catch communication problems with the ypserver without blocking forever.</dd>
</dl>
</div>
<div class="section">
<h1 id="x52455455524e2056414c554553">RETURN VALUES</h1> All functions in the <b class="name">ypclnt</b> suite which are of type <span class="emph">int</span> return 0 upon success or one of the following error codes upon failure:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">YPERR_BADARGS</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
The passed arguments to the function are invalid.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">YPERR_BADDB</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
The YP map that was polled is defective.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">YPERR_DOMAIN</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
Client process cannot bind to server on this YP domain.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">YPERR_KEY</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
The key passed does not exist.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">YPERR_MAP</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
There is no such map in the server's domain.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">YPERR_DOM</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
The local YP domain is not set.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">YPERR_NOMORE</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
There are no more records in the queried map.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">YPERR_PMAP</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
Cannot communicate with portmapper (see <a class="link-man" href="../html8/rpcbind.html">rpcbind(8)</a>).</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">YPERR_RESRC</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
A resource allocation failure occurred.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">YPERR_RPC</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
An RPC failure has occurred. The domain has been marked unbound.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">YPERR_VERS</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
Client/server version mismatch. If the server is running version 1 of the YP protocol, <b class="fname">yp_all</b>() functionality does not exist.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">YPERR_BIND</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
Cannot communicate with <a class="link-man" href="../html8/ypbind.html">ypbind(8)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">YPERR_YPERR</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
An internal server or client error has occurred.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">YPERR_YPSERV</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
The client cannot communicate with the YP server process.</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html3/malloc.html">malloc(3)</a>, <a class="link-man" href="../html8/yp.html">yp(8)</a>, <a class="link-man" href="../html8/ypbind.html">ypbind(8)</a>, <a class="link-man" href="../html8/ypserv.html">ypserv(8)</a></div>
<div class="section">
<h1 id="x415554484f5253">AUTHORS</h1> <span class="author">Theo De Raadt</span></div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
March 2, 2012</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

