<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
DIRECTORY(3)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
DIRECTORY(3)</td>
<td class="head-vol" align="center">
Library Functions Manual</td>
<td class="head-rtitle" align="right">
DIRECTORY(3)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">fdopendir</b>, <b class="name">opendir</b>, <b class="name">readdir</b>, <b class="name">readdir_r</b>, <b class="name">telldir</b>, <b class="name">seekdir</b>, <b class="name">rewinddir</b>, <b class="name">closedir</b>, <b class="name">dirfd</b> &#8212; <span class="desc">directory operations</span></div>
<div class="section">
<h1 id="x4c494252415259">LIBRARY</h1> <span class="lib">Standard C Library (libc, &#45;lc)</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">dirent.h</a>&gt;</b><p>
<i class="ftype">DIR *</i><br>
<b class="fname">opendir</b>(<i class="farg" style="white-space:nowrap;">const char *filename</i>);<p>
<i class="ftype">DIR *</i><br>
<b class="fname">fdopendir</b>(<i class="farg" style="white-space:nowrap;">int fd</i>);<p>
<i class="ftype">struct dirent *</i><br>
<b class="fname">readdir</b>(<i class="farg" style="white-space:nowrap;">DIR *dirp</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">readdir_r</b>(<i class="farg" style="white-space:nowrap;">DIR * restrict dirp</i>, <i class="farg" style="white-space:nowrap;">struct dirent * restrict entry</i>, <i class="farg" style="white-space:nowrap;">struct dirent ** restrict result</i>);<p>
<i class="ftype">long</i><br>
<b class="fname">telldir</b>(<i class="farg" style="white-space:nowrap;">DIR *dirp</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">seekdir</b>(<i class="farg" style="white-space:nowrap;">DIR *dirp</i>, <i class="farg" style="white-space:nowrap;">long loc</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">rewinddir</b>(<i class="farg" style="white-space:nowrap;">DIR *dirp</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">closedir</b>(<i class="farg" style="white-space:nowrap;">DIR *dirp</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">dirfd</b>(<i class="farg" style="white-space:nowrap;">DIR *dirp</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The type <span class="type">DIR</span> represents a directory stream; an ordered sequence of all directory entries in a particular directory. The purpose of the <span class="type">DIR</span> structure is similar to that of the <span class="type">FILE</span> structure maintained by the <a class="link-man" href="../3/stdio">stdio(3)</a> library functions.</div>
<div class="section">
<h1 id="x46554e4354494f4e53">FUNCTIONS</h1> The following standard directory operations are defined.<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">opendir</b>(<i class="farg">filename</i>)</dt>
<dd class="list-tag" style="margin-left: 3.00ex;">
The <b class="fname">opendir</b>() function opens the directory named by <i class="farg">filename</i> and associates a directory stream with it. The directory stream is positioned at the first entry. Upon successful completion, a pointer to <span class="type">DIR</span> type is returned. Otherwise, <b class="fname">opendir</b>() returns <span class="define">NULL</span>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">fdopendir</b>(<i class="farg">fd</i>)</dt>
<dd class="list-tag" style="margin-left: 3.00ex;">
The <b class="fname">fdopendir</b>() function associates a directory stream with the directory file descriptor <i class="farg">fd</i>. The file offset associated with <i class="farg">fd</i> at the time of the call determines which entries are returned.<p>
Upon failure, <b class="fname">fdopendir</b>() returns <span class="define">NULL</span>. Otherwise the file descriptor is under the control of the system, and if any attempt is made to close the file descriptor, or to modify the state of the associated description, other than by means of <b class="fname">closedir</b>(), <b class="fname">readdir</b>(), <b class="fname">readdir_r</b>(), <b class="fname">rewinddir</b>(), the behavior is undefined. The file descriptor can be closed by calling <b class="fname">closedir</b>().</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">readdir</b>(<i class="farg">dirp</i>)</dt>
<dd class="list-tag" style="margin-left: 3.00ex;">
The <b class="fname">readdir</b>() function returns a pointer to the directory entry at the current position in the directory stream specified by <i class="farg">dirp</i>, and positions the directory stream at the next entry. It returns <span class="define">NULL</span> upon reaching the end of the directory or detecting an invalid <b class="fname">seekdir</b>() operation. The returned structure is described in <a class="link-man" href="../3/dirent">dirent(3)</a>.<p>
The returned pointer to the <span class="emph">dirent</span> structure points to data which may be overwritten by another call to <b class="fname">readdir</b>() on the same directory stream. This data is not however overwritten by another call to <b class="fname">readdir</b>() on a different directory stream.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">readdir_r</b>(<i class="farg">dirp</i>, <i class="farg">entry</i>, <i class="farg">result</i>)</dt>
<dd class="list-tag" style="margin-left: 3.00ex;">
The <b class="fname">readdir_r</b>() function provides the same functionality as <b class="fname">readdir</b>(), but the caller must provide a directory <i class="farg">entry</i> buffer to store the results in. If the read succeeds, <i class="farg">result</i> is pointed at the <i class="farg">entry</i>; upon reaching the end of the directory <i class="farg">result</i> is set to <span class="define">NULL</span>. The <b class="fname">readdir_r</b>() function returns 0 on success or an error number to indicate failure.<p>
Like <b class="fname">readdir</b>(), the <b class="fname">readdir_r</b>() function may buffer several directory entries per actual read operation. Both functions mark for update the <span class="emph">st_atime</span> field (see <a class="link-man" href="../2/stat">stat(2)</a>) of the directory each time the directory is actually read.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">telldir</b>(<i class="farg">dirp</i>)</dt>
<dd class="list-tag" style="margin-left: 3.00ex;">
The <b class="fname">telldir</b>() function returns the current location associated with the directory stream specified by <i class="farg">dirp</i>.<p>
If the most recent operation on the particular directory stream was a <b class="fname">seekdir</b>(), the directory position returned from <b class="fname">telldir</b>() is the same as <i class="farg">loc</i> supplied as an argument to the <b class="fname">seekdir</b>() call.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">seekdir</b>(<i class="farg">dirp</i>, <i class="farg">loc</i>)</dt>
<dd class="list-tag" style="margin-left: 3.00ex;">
The <b class="fname">seekdir</b>() function sets the position of the next <b class="fname">readdir</b>() operation on the directory stream specified by <i class="farg">dirp</i>. The value of <i class="farg">loc</i> should come from a previous call to <b class="fname">telldir</b>() using the same directory stream.<p>
The new position reverts to the one associated with the directory stream when the <b class="fname">telldir</b>() operation was performed. Values returned by <b class="fname">telldir</b>() are good only for the lifetime of the <span class="type">DIR</span> pointer, <i class="farg">dirp</i>, from which they are derived. If the directory is closed and then reopened, the <b class="fname">telldir</b>() value cannot be re-used.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">rewinddir</b>(<i class="farg">dirp</i>)</dt>
<dd class="list-tag" style="margin-left: 3.00ex;">
The <b class="fname">rewinddir</b>() function resets the position of the named directory stream to the beginning of the directory. It also causes the directory stream to refer to the current state of the corresponding directory, as if a call to <b class="fname">opendir</b>() would have been made.<p>
If <i class="farg">dirp</i> does not refer to a valid directory stream, the behavior is undefined.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">closedir</b>(<i class="farg">dirp</i>)</dt>
<dd class="list-tag" style="margin-left: 3.00ex;">
The <b class="fname">closedir</b>() function closes the directory stream and frees the structure associated with the <i class="farg">dirp</i> pointer, returning 0 on success and &#45;1 on failure.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">dirfd</b>(<i class="farg">dirp</i>)</dt>
<dd class="list-tag" style="margin-left: 3.00ex;">
The <b class="fname">dirfd</b>() function returns the integer file descriptor associated with the directory stream specified by <i class="farg">dirp</i>. Upon failure, <b class="fname">dirfd</b>() returns &#45;1. The returned file descriptor should be closed by <b class="fname">closedir</b>() instead of <a class="link-man" href="../2/close">close(2)</a>.<p>
The rationale of <b class="fname">dirfd</b>() is to provide a mechanism by which a file descriptor can be obtained for the use of the <a class="link-man" href="../2/fchdir">fchdir(2)</a> function.</dd>
</dl>
</div>
<div class="section">
<h1 id="x4558414d504c4553">EXAMPLES</h1> Sample code which searches a directory for entry &#8220;name&#8221; is:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
len = strlen(name); 
dirp = opendir("."); 
if (dirp != NULL) { 
	while ((dp = readdir(dirp)) != NULL) 
		if (dp-&gt;d_namlen == len &amp;&amp; 
		    !strcmp(dp-&gt;d_name, name)) { 
			(void)closedir(dirp); 
			return (FOUND); 
		} 
	(void)closedir(dirp); 
} 
return (NOT_FOUND);</pre>
</div>
<div class="section">
<h1 id="x434f4d5041544942494c495459">COMPATIBILITY</h1> The described directory operations have traditionally been problematic in terms of portability. A good example is the semantics around &#8216;.&#8217; (dot) and &#8216;..&#8217; (dot-dot). Based on historical implementations, the rules about file descriptors apply to directory streams as well. The IEEE Std 1003.1-2008 (&#8220;POSIX.1&#8221;) standard does not however any more mandate that directory streams are necessarily implemented by using file descriptors.<p>
The following additional remarks can be noted from the IEEE Std 1003.1-2008 (&#8220;POSIX.1&#8221;) standard.<ul style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 2.00ex;" class="list list-bul">
<li class="list-bul" style="margin-top: 1.00em;">
If the type <span class="type">DIR</span> is implemented using a file descriptor, like in <span class="unix">NetBSD</span>, applications should be able to open only <span class="define">OPEN_MAX</span> files and directories. Otherwise the limit is left as unspecified.</li>
<li class="list-bul" style="margin-top: 1.00em;">
When a file descriptor is used to implement the directory stream, the <b class="fname">closedir</b>() function behaves as if the <span class="define">FD_CLOEXEC</span> had been set for the file descriptor. In another words, it is mandatory that <b class="fname">closedir</b>() deallocates the file descriptor.</li>
<li class="list-bul" style="margin-top: 1.00em;">
If directory streams are not implemented by using file descriptors, functions such as <b class="fname">dirfd</b>() may fail with <span class="errno">ENOTSUP</span>.</li>
<li class="list-bul" style="margin-top: 1.00em;">
If a file is removed from or added to the directory after the most recent call to <b class="fname">opendir</b>() or <b class="fname">rewinddir</b>(), it is unspecified whether a subsequent call to <b class="fname">readdir</b>() returns an entry for that file.</li>
<li class="list-bul" style="margin-top: 1.00em;">
When using the function <b class="fname">seekdir</b>(), note that if the value of <i class="farg">loc</i> was not obtained from an earlier call to <b class="fname">telldir</b>(), or if a call to <b class="fname">rewinddir</b>() occurred between the calls to <b class="fname">telldir</b>() and <b class="fname">seekdir</b>(), any subsequent call to <b class="fname">readdir</b>() is unspecified, possibly resulting undefined behavior.</li>
<li class="list-bul" style="margin-top: 1.00em;">
After a call to <a class="link-man" href="../2/fork">fork(2)</a>, either the parent or child (but not both) can continue processing the directory stream using <b class="fname">readdir</b>(), <b class="fname">rewinddir</b>(), or <b class="fname">seekdir</b>(). However, if both the parent and child processes use these functions, the result is undefined.</li>
</ul>
</div>
<div class="section">
<h1 id="x4552524f5253">ERRORS</h1> All described functions may set <span class="type">errno</span> to indicate the error.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../2/close">close(2)</a>, <a class="link-man" href="../2/lseek">lseek(2)</a>, <a class="link-man" href="../2/open">open(2)</a>, <a class="link-man" href="../2/read">read(2)</a>, <a class="link-man" href="../3/dirent">dirent(3)</a></div>
<div class="section">
<h1 id="x5354414e4441524453">STANDARDS</h1> The <b class="fname">opendir</b>(), <b class="fname">readdir</b>(), <b class="fname">rewinddir</b>() and <b class="fname">closedir</b>() functions conform to IEEE Std 1003.1-1990 (&#8220;POSIX.1&#8221;). The other functions conform to IEEE Std 1003.1-2008 (&#8220;POSIX.1&#8221;).</div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="fname">opendir</b>(), <b class="fname">readdir</b>(), <b class="fname">telldir</b>(), <b class="fname">seekdir</b>(), <b class="fname">rewinddir</b>(), <b class="fname">closedir</b>(), and <b class="fname">dirfd</b>() functions appeared in <span class="unix">4.2BSD</span>. The <b class="fname">fdopendir</b>() function appeared in <span class="unix">NetBSD&#160;6.0</span>.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
October 15, 2011</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

