<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="/static/man_pages/netbsd/style.css" type="text/css" media="all">
<title>
ATTRIBUTE(3)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
ATTRIBUTE(3)</td>
<td class="head-vol" align="center">
Library Functions Manual</td>
<td class="head-rtitle" align="right">
ATTRIBUTE(3)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">attribute</b> &#8212; <span class="desc">non-standard compiler attribute extensions</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">sys/cdefs.h</a>&gt;</b><p>
<b class="cmd">__dead</b><p>
<b class="cmd">__pure</b><p>
<b class="cmd">__constfunc</b><p>
<b class="cmd">__noinline</b><p>
<b class="cmd">__unused</b><p>
<b class="cmd">__used</b><p>
<b class="cmd">__diagused</b><p>
<b class="cmd">__debugused</b><p>
<b class="cmd">__packed</b><p>
<br>
<b class="fname">__aligned</b>(<i class="farg" style="white-space:nowrap;">x</i>);<p>
<b class="fname">__section</b>(<i class="farg" style="white-space:nowrap;">section</i>);<p>
<b class="cmd">__read_mostly</b><p>
<b class="cmd">__cacheline_aligned</b><p>
<br>
<b class="fname">__predict_true</b>(<i class="farg" style="white-space:nowrap;">exp</i>);<p>
<br>
<b class="fname">__predict_false</b>(<i class="farg" style="white-space:nowrap;">exp</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> As an extension to the C standard, some compilers allow non-standard attributes to be associated with functions, variables, or types, to modify some aspect of the way the compiler treats the associated item. The GNU Compiler Collection (GCC), and LLVM/Clang, use the <span class="emph">__attribute__</span> syntax for such attributes, but different versions of the compilers support different attributes, and other compilers may use entirely different syntax.<p>
<span class="unix">NetBSD</span> code should usually avoid direct use of the <span class="emph">__attribute__</span> or similar syntax provided by specific compilers. Instead, <span class="unix">NetBSD</span>&#39;s <b class="includes">&lt;<a class="link-includes">sys/cdefs.h</a>&gt;</b> header file provides several attribute macros in a namespace reserved for the implementation (beginning with &#8216;<code class="lit">__</code>&#8217;), that expand to the appropriate syntax for the compiler that is in use.</div>
<div class="section">
<h1 id="x41545452494255544553">ATTRIBUTES</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">__dead</b></dt>
<dd class="list-tag" style="margin-left: 3.00ex;">
Certain functions, such as <a class="link-man" href="../3/abort">abort(3)</a> and <a class="link-man" href="../3/exit">exit(3)</a>, can never return any value. When such a function is declared with <b class="cmd">__dead</b>, certain optimizations are possible. Obviously a <b class="cmd">__dead</b> function can never have return type other than <span class="type">void</span>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">__pure</b></dt>
<dd class="list-tag" style="margin-left: 3.00ex;">
A <b class="cmd">__pure</b> function is defined to be one that has no effects except the return value, which is assumed to depend only on the function parameters and/or global variables. Any access to parameters and/or global variables must also be read-only. A function that depends on volatile memory, or other comparable system resource that can change between two consecutive calls, can never be <b class="cmd">__pure</b>. Many <a class="link-man" href="../3/math">math(3)</a> functions satisfy the definition of a <b class="cmd">__pure</b> function, at least in theory. Other examples include <a class="link-man" href="../3/strlen">strlen(3)</a> and <a class="link-man" href="../3/strcmp">strcmp(3)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">__constfunc</b></dt>
<dd class="list-tag" style="margin-left: 3.00ex;">
A &#8220;const function&#8221; is a stricter variant of &#8220;pure functions&#8221;. In addition to the restrictions of pure functions, a function declared with <b class="cmd">__constfunc</b> can never access global variables nor take pointers as parameters. The return value of these functions must depend only on the passed-by-value parameters. Note also that a function that calls non-const functions can not be <b class="cmd">__constfunc</b>. The canonical example of a const function would be <a class="link-man" href="../3/abs">abs(3)</a>. As with pure functions, certain micro-optimizations are possible for functions declared with <b class="cmd">__constfunc</b>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">__noinline</b></dt>
<dd class="list-tag" style="margin-left: 3.00ex;">
Sometimes it is known that inlining is undesirable or that a function will perform incorrectly when inlined. The <b class="cmd">__noinline</b> macro expands to a function attribute that prevents the compiler from inlining the function, irrespective of whether the function was declared with the <span class="emph">inline</span> keyword. The attribute takes precedence over all other compiler options related to inlining.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">__unused</b></dt>
<dd class="list-tag" style="margin-left: 3.00ex;">
Marking an unused function with the <b class="cmd">__unused</b> macro inhibits warnings that a function is defined but not used. Marking a variable with the <b class="cmd">__unused</b> macro inhibits warnings that the variable is unused, or that it is set but never read.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">__used</b></dt>
<dd class="list-tag" style="margin-left: 3.00ex;">
The <b class="cmd">__used</b> macro expands to an attribute that informs the compiler that a static variable or function is to be always retained in the object file even if it is unreferenced.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">__diagused</b></dt>
<dd class="list-tag" style="margin-left: 3.00ex;">
The <b class="cmd">__diagused</b> macro expands to an attribute that informs the compiler that a variable or function is used only in diagnostic code, and may be unused in non-diagnostic code.<p>
In the kernel, variables that are used when <span class="define">DIAGNOSTIC</span> is defined, but unused when <span class="define">DIAGNOSTIC</span> is not defined, may be declared with <b class="cmd">__diagused</b>. In userland, variables that are used when <span class="define">NDEBUG</span> is not defined, but unused when <span class="define">NDEBUG</span> is defined, may be declared with <b class="cmd">__diagused</b>.<p>
Variables used only in <a class="link-man" href="../3/assert">assert(3)</a> or <a class="link-man" href="../9/KASSERT">KASSERT(9)</a> macros are likely candidates for being declared with <b class="cmd">__diagused</b>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">__debugused</b></dt>
<dd class="list-tag" style="margin-left: 3.00ex;">
The <b class="cmd">__debugused</b> macro expands to an attribute that informs the compiler that a variable or function is used only in debug code, and may be unused in non-debug code.<p>
In either the kernel or userland, variables that are used when <span class="define">DEBUG</span> is defined, but unused when <span class="define">DEBUG</span> is not defined, may be declared with <b class="cmd">__debugused</b>.<p>
In the kernel, variables used only in <a class="link-man" href="../9/KDASSERT">KDASSERT(9)</a> macros are likely candidates for being declared with <b class="cmd">__debugused</b>. There is no established convention for the use of <span class="define">DEBUG</span> in userland code.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">__packed</b></dt>
<dd class="list-tag" style="margin-left: 3.00ex;">
The <b class="cmd">__packed</b> macro expands to an attribute that forces a variable or structure field to have the smallest possible alignment, potentially disregarding architecture specific alignment requirements. The smallest possible alignment is effectively one byte for variables and one bit for fields. If specified on a <span class="type">struct</span> or <span class="type">union</span>, all variables therein are also packed. The <b class="cmd">__packed</b> macro is often useful when dealing with data that is in a particular static format on the disk, wire, or memory.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">__aligned</b>(<i class="farg">x</i>)</dt>
<dd class="list-tag" style="margin-left: 3.00ex;">
The <b class="fname">__aligned</b>() macro expands to an attribute that specifies the minimum alignment in bytes for a variable, structure field, or function. In other words, the specified object should have an alignment of at least <i class="farg">x</i> bytes, as opposed to the minimum alignment requirements dictated by the architecture and the ABI. Possible use cases include:<ul style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-bul">
<li class="list-bul" style="margin-top: 1.00em;">
Mixing assembly and C code.</li>
<li class="list-bul" style="margin-top: 1.00em;">
Dealing with hardware that may impose alignment requirements greater than the architecture itself.</li>
<li class="list-bul" style="margin-top: 1.00em;">
Using instructions that may impose special alignment requirements. Typical example would be alignment of frequently used objects along processor cache lines.</li>
</ul>
<p>
Note that when used with functions, structures, or structure members, <b class="fname">__aligned</b>() can only be used to increase the alignment. If the macro is however used as part of a <span class="type">typedef</span>, the alignment can both increase and decrease. Otherwise it is only possible to decrease the alignment for variables and fields by using the <b class="cmd">__packed</b> macro. The effectiveness of <b class="fname">__aligned</b>() is largely dependent on the linker. The <a class="link-man" href="../3/__alignof__">__alignof__(3)</a> operator can be used to examine the alignment.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">__section</b>(<i class="farg">section</i>)</dt>
<dd class="list-tag" style="margin-left: 3.00ex;">
The <b class="fname">__section</b>() macro expands to an attribute that specifies a particular <i class="farg">section</i> to which a variable or function should be placed. Normally the compiler places the generated objects to sections such as &#8220;data&#8221; or &#8220;text&#8221;. By using <b class="fname">__section</b>(), it is possible to override this behavior, perhaps in order to place some variables into particular sections specific to unique hardware.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">__read_mostly</b></dt>
<dd class="list-tag" style="margin-left: 3.00ex;">
The <b class="cmd">__read_mostly</b> macro uses <b class="fname">__section</b>() to place a variable or function into the &#8220;.data.read_mostly&#8221; section of the (kernel) <a class="link-man" href="../5/elf">elf(5)</a>. The use of <b class="cmd">__read_mostly</b> allows infrequently modified data to be grouped together; it is expected that the cachelines of rarely and frequently modified data structures are this way separated. Candidates for <b class="cmd">__read_mostly</b> include variables that are initialized once, read very often, and seldom written to.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">__cacheline_aligned</b></dt>
<dd class="list-tag" style="margin-left: 3.00ex;">
The <b class="cmd">__cacheline_aligned</b> macro behaves like <b class="cmd">__read_mostly</b>, but the used section is &#8220;.data.cacheline_aligned&#8221; instead. It also uses <b class="fname">__aligned</b>() to set the minimum alignment into a predefined coherency unit. This should ensure that frequently used data structures are aligned on cacheline boundaries. Both <b class="cmd">__cacheline_aligned</b> and <b class="cmd">__read_mostly</b> are only available for the kernel.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">__predict_true</b></dt>
<dd class="list-tag" style="margin-left: 3.00ex;">
A branch is generally defined to be a conditional execution of a program depending on whether a certain flow control mechanism is altered. Typical example would be a &#8220;if-then-else&#8221; sequence used in high-level languages or a jump instruction used in machine-level code. A branch prediction would then be defined as an attempt to guess whether a conditional branch will be taken.<p>
The macros <b class="fname">__predict_true</b>() and <b class="fname">__predict_false</b>() annotate the likelihood of whether a branch will evaluate to true or false. The rationale is to improve instruction pipelining. Semantically <b class="cmd">__predict_true</b> expects that the integral expression <i class="farg">exp</i> yields nonzero.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">__predict_false</b></dt>
<dd class="list-tag" style="margin-left: 3.00ex;">
The <b class="cmd">__predict_false</b> expands to an attribute that instructs the compiler to predict that a given branch will be likely false. As programmers are notoriously bad at predicting the likely behavior of their code, profiling and empirical evidence should precede the use of <b class="cmd">__predict_false</b> and <b class="cmd">__predict_true</b>.</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../1/clang">clang(1)</a>, <a class="link-man" href="../1/gcc">gcc(1)</a>, <a class="link-man" href="../3/__builtin_object_size">__builtin_object_size(3)</a>, <a class="link-man" href="../3/cdefs">cdefs(3)</a>, <a class="link-man" href="../7/c">c(7)</a></div>
<div class="section">
<h1 id="x43415645415453">CAVEATS</h1> It goes without saying that portable applications should steer clear from non-standard extensions specific to any given compiler. Even when portability is not a concern, use these macros sparsely and wisely.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
October 25, 2013</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

