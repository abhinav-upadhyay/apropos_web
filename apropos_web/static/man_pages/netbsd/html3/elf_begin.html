<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
ELF_BEGIN(3)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
ELF_BEGIN(3)</td>
<td class="head-vol" align="center">
Library Functions Manual</td>
<td class="head-rtitle" align="right">
ELF_BEGIN(3)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">elf_begin</b> &#8212; <span class="desc">open an ELF file or ar(1) archive</span></div>
<div class="section">
<h1 id="x4c494252415259">LIBRARY</h1> <span class="lib">ELF Access Library (libelf, &#45;lelf)</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">libelf.h</a>&gt;</b><p>
<i class="ftype">Elf *</i><br>
<b class="fname">elf_begin</b>(<i class="farg" style="white-space:nowrap;">int fd</i>, <i class="farg" style="white-space:nowrap;">Elf_Cmd cmd</i>, <i class="farg" style="white-space:nowrap;">Elf *elf</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> Function <b class="fname">elf_begin</b>() is used to open ELF files and <a class="link-man" href="../html1/ar.html">ar(1)</a> archives for further processing by other APIs in the <a class="link-man" href="../html3/elf.html">elf(3)</a> library. It is also used to access individual ELF members of an <a class="link-man" href="../html1/ar.html">ar(1)</a> archive in combination with the <a class="link-man" href="../html3/elf_next.html">elf_next(3)</a> and <a class="link-man" href="../html3/elf_rand.html">elf_rand(3)</a> APIs.<p>
Argument <i class="arg">fd</i> is an open file descriptor returned from an <a class="link-man" href="../html2/open.html">open(2)</a> system call. Function <b class="fname">elf_begin</b>() uses argument <i class="arg">fd</i> for reading or writing depending on the value of argument <i class="arg">cmd</i>. Argument <i class="arg">elf</i> is primarily used for iterating through archives.<p>
The argument <i class="arg">cmd</i> can have the following values:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
ELF_C_NULL</dt>
<dd class="list-tag" style="margin-left: 11.00ex;">
Causes <b class="fname">elf_begin</b>() to return NULL. Arguments <i class="arg">fd</i> and <i class="arg">elf</i> are ignored, and no additional error is signalled.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
ELF_C_READ</dt>
<dd class="list-tag" style="margin-left: 11.00ex;">
This value is to be when the application wishes to examine (but not modify) the contents of the file specified by the arguments <i class="arg">fd</i> and <i class="arg">elf</i>. It can be used for both <a class="link-man" href="../html1/ar.html">ar(1)</a> archives and for ELF objects.<p>
If argument <i class="arg">elf</i> is NULL, the library will allocate a new ELF descriptor for the file being processed. The argument <i class="arg">fd</i> should have been opened for reading.<p>
If argument <i class="arg">elf</i> is not NULL, and references a regular ELF file previously opened with <b class="fname">elf_begin</b>(), then the activation count for the descriptor referenced by argument <i class="arg">elf</i> is incremented. The value in argument <i class="arg">fd</i> should match that used to open the descriptor argument <i class="arg">elf</i>.<p>
If argument <i class="arg">elf</i> is not NULL, and references a descriptor for an <a class="link-man" href="../html1/ar.html">ar(1)</a> archive opened earlier with <b class="fname">elf_begin</b>(), a descriptor for an element in the archive is returned as described in the section <i class="link-sec"><a class="link-sec" href="#x50726f63657373696e67206172283129206172636869766573">Processing ar(1) archives</a></i> below. The value for argument <i class="arg">fd</i> should match that used to open the archive earlier.<p>
If argument <i class="arg">elf</i> is not NULL, and references an <a class="link-man" href="../html1/ar.html">ar(1)</a> archive opened earlier with <b class="fname">elf_memory</b>(), then the value of the argument <i class="arg">fd</i> is ignored.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">ELF_C_RDWR</span></dt>
<dd class="list-tag" style="margin-left: 11.00ex;">
This command is used to prepare an ELF file for reading and writing. This command is not supported for <a class="link-man" href="../html1/ar.html">ar(1)</a> archives.<p>
Argument <i class="arg">fd</i> should have been opened for reading and writing. If argument <i class="arg">elf</i> is NULL, the library will allocate a new ELF descriptor for the file being processed. If the argument <i class="arg">elf</i> is non-null, it should point to a descriptor previously allocated with <b class="fname">elf_begin</b>() with the same values for arguments <i class="arg">fd</i> and <i class="arg">cmd</i>; in this case the library will increment the activation count for descriptor <i class="arg">elf</i> and return the same descriptor.<p>
Changes to the in-memory image of the ELF file may be written back to disk using the <a class="link-man" href="../html3/elf_update.html">elf_update(3)</a> function.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">ELF_C_WRITE</span></dt>
<dd class="list-tag" style="margin-left: 11.00ex;">
This command is used when the application wishes to create a new ELF file. Argument <i class="arg">fd</i> should have been opened for writing. Argument <i class="arg">elf</i> is ignored, and the previous contents of file referenced by argument <i class="arg">fd</i> are overwritten.</dd>
</dl>
<div class="subsection">
<h2 id="x50726f63657373696e67206172283129206172636869766573">Processing ar(1) archives</h2> An <a class="link-man" href="../html1/ar.html">ar(1)</a> archive may be opened in read mode (with argument <i class="arg">cmd</i> set to <span class="define">ELF_C_READ</span>) using <b class="fname">elf_begin</b>() or <b class="fname">elf_memory</b>(). The returned ELF descriptor can be passed into to subsequent calls to <b class="fname">elf_begin</b>() to access individual members of the archive.<p>
Random access within an opened archive is possible using the <a class="link-man" href="../html3/elf_next.html">elf_next(3)</a> and <a class="link-man" href="../html3/elf_rand.html">elf_rand(3)</a> functions.<p>
The symbol table of the archive may be retrieved using <a class="link-man" href="../html3/elf_getarsym.html">elf_getarsym(3)</a>.</div>
</div>
<div class="section">
<h1 id="x52455455524e2056414c554553">RETURN VALUES</h1> The function returns a pointer to a ELF descriptor if successful, or NULL if an error occurred.</div>
<div class="section">
<h1 id="x4558414d504c4553">EXAMPLES</h1> To iterate through the members of an <a class="link-man" href="../html1/ar.html">ar(1)</a> archive, use:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
Elf_Cmd c; 
Elf *ar_e, *elf_e; 
... 
c = ELF_C_READ; 
if ((ar_e = elf_begin(fd, c, (Elf *) 0)) == 0) { 
	... handle error in opening the archive ... 
} 
while ((elf_e = elf_begin(fd, c, ar_e)) != 0) { 
	... process member referenced by elf_e here ... 
	c = elf_next(elf_e); 
	elf_end(elf_e); 
}</pre>
<p>
To create a new ELF file, use:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
int fd; 
Elf *e; 
... 
if ((fd = open("filename", O_RDWR|O_TRUNC|O_CREAT, 0666)) &lt; 0) { 
	... handle the error from open(2) ... 
} 
if ((e = elf_begin(fd, ELF_C_WRITE, (Elf *) 0)) == 0) { 
	... handle the error from elf_begin() ... 
} 
... create the ELF image using other elf(3) APIs ... 
elf_update(e, ELF_C_WRITE); 
elf_end(e);</pre>
</div>
<div class="section">
<h1 id="x4552524f5253">ERRORS</h1> Function <b class="fname">elf_begin</b>() can fail with the following errors:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ELF_E_ARCHIVE</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
The archive denoted by argument <i class="arg">elf</i> could not be parsed.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ELF_E_ARGUMENT</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
The value in argument <i class="arg">cmd</i> was unrecognized.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ELF_E_ARGUMENT</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
A non-null value for argument <i class="arg">elf</i> was specified when <i class="arg">cmd</i> was set to <span class="define">ELF_C_RDWR</span>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ELF_E_ARGUMENT</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
The value of argument <i class="arg">fd</i> differs from the one the ELF descriptor <i class="arg">elf</i> was created with.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ELF_E_ARGUMENT</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
Argument <i class="arg">cmd</i> differs from the value specified when ELF descriptor <i class="arg">elf</i> was created.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ELF_E_ARGUMENT</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
An <a class="link-man" href="../html1/ar.html">ar(1)</a> archive was opened with with <i class="arg">cmd</i> set to <span class="define">ELF_C_RDWR</span>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ELF_E_ARGUMENT</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
The file referenced by argument <i class="arg">fd</i> was empty.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ELF_E_ARGUMENT</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
The underlying file for argument <i class="arg">fd</i> was of an unsupported type.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ELF_E_IO</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
The file descriptor in argument <i class="arg">fd</i> was invalid.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ELF_E_IO</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
The file descriptor in argument <i class="arg">fd</i> could not be read or written to.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ELF_E_RESOURCE</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
An out of memory condition was encountered.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ELF_E_SEQUENCE</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
Function <b class="fname">elf_begin</b>() was called before a working version was established with <a class="link-man" href="../html3/elf_version.html">elf_version(3)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ELF_E_VERSION</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
The ELF object referenced by argument <i class="arg">fd</i> was of an unsupported ELF version.</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html3/elf.html">elf(3)</a>, <a class="link-man" href="../html3/elf_end.html">elf_end(3)</a>, <a class="link-man" href="../html3/elf_errno.html">elf_errno(3)</a>, <a class="link-man" href="../html3/elf_memory.html">elf_memory(3)</a>, <a class="link-man" href="../html3/elf_next.html">elf_next(3)</a>, <a class="link-man" href="../html3/elf_rand.html">elf_rand(3)</a>, <a class="link-man" href="../html3/elf_update.html">elf_update(3)</a>, <a class="link-man" href="../html3/gelf.html">gelf(3)</a></div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
December 11, 2011</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

