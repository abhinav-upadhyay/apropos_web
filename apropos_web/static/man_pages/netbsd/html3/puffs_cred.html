<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/../4/strict.dtd">
>
<head>
<meta http-equiv="Content-Type" content="te../; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
PUFFS_CRED(3)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
PUFFS_CRED(3)</td>
<td class="head-vol" align="center">
Library Functions Manual</td>
<td class="head-rtitle" align="right">
PUFFS_CRED(3)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">puffs_cred</b> &#8212; <span class="desc">puffs credential and access control routines</span></div>
<div class="section">
<h1 id="x4c494252415259">LIBRARY</h1> <span class="lib">puffs Convenience Library (libpuffs, &#45;lpuffs)</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">puffs.h</a>&gt;</b><p>
<i class="ftype">int</i><br>
<b class="fname">puffs_cred_getuid</b>(<i class="farg" style="white-space:nowrap;">const struct puffs_cred *pcr</i>, <i class="farg" style="white-space:nowrap;">uid_t *uid</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">puffs_cred_getgid</b>(<i class="farg" style="white-space:nowrap;">const struct puffs_cred *pcr</i>, <i class="farg" style="white-space:nowrap;">gid_t *gid</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">puffs_cred_getgroups</b>(<i class="farg">const struct puffs_cred *pcr</i>, <i class="farg">gid_t *gids</i>, <i class="farg">short *ngids</i>);<p>
<br>
<i class="ftype">bool</i><br>
<b class="fname">puffs_cred_isuid</b>(<i class="farg" style="white-space:nowrap;">const struct puffs_cred *pcr</i>, <i class="farg" style="white-space:nowrap;">uid_t uid</i>);<p>
<i class="ftype">bool</i><br>
<b class="fname">puffs_cred_hasgroup</b>(<i class="farg" style="white-space:nowrap;">const struct puffs_cred *pcr</i>, <i class="farg" style="white-space:nowrap;">gid_t gid</i>);<p>
<i class="ftype">bool</i><br>
<b class="fname">puffs_cred_iskernel</b>(<i class="farg" style="white-space:nowrap;">const struct puffs_cred *pcr</i>);<p>
<i class="ftype">bool</i><br>
<b class="fname">puffs_cred_isfs</b>(<i class="farg" style="white-space:nowrap;">const struct puffs_cred *pcr</i>);<p>
<i class="ftype">bool</i><br>
<b class="fname">puffs_cred_isjuggernaut</b>(<i class="farg" style="white-space:nowrap;">const struct puffs_cred *pcr</i>);<p>
<br>
<i class="ftype">int</i><br>
<b class="fname">puffs_access</b>(<i class="farg">enum vtype type</i>, <i class="farg">mode_t file_mode</i>, <i class="farg">uid_t owner</i>, <i class="farg">gid_t group</i>, <i class="farg">mode_t access_mode</i>, <i class="farg">const struct puffs_cred *pcr</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">puffs_access_chown</b>(<i class="farg">uid_t owner</i>, <i class="farg">gid_t group</i>, <i class="farg">uid_t newowner</i>, <i class="farg">gid_t newgroup</i>, <i class="farg">const struct puffs_cred *pcr</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">puffs_access_chmod</b>(<i class="farg">uid_t owner</i>, <i class="farg">gid_t group</i>, <i class="farg">enum vtype type</i>, <i class="farg">mode_t newmode</i>, <i class="farg">const struct puffs_cred *pcr</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">puffs_access_times</b>(<i class="farg">uid_t owner</i>, <i class="farg">gid_t group</i>, <i class="farg">mode_t file_mode</i>, <i class="farg">int va_utimes_null</i>, <i class="farg">const struct puffs_cred *pcr</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> These functions can be used to check operation credentials and perform access control. The structure <span class="type">struct puffs_cred</span> can contain two types of credentials: ones belonging to users and ones belonging to the kernel. The latter is further divided into generic kernel credentials and file system credentials. The general rule is that these should be treated as more powerful than superuser credentials, but the file system is free to treat them as it sees fit.<div class="subsection">
<h2 id="x43726564656e7469616c73">Credentials</h2> The <b class="fname">puffs_cred_get</b>() family of functions fetch the uid or gid(s) from the given credential cookie. They return 0 for success or &#45;1 for an error and set <b class="var">errno</b>. An error happens when the credentials represent kernel or file system credentials and do not contain an uid or gid(s).<p>
For <b class="fname">puffs_cred_getgroups</b>(), the argument <i class="farg">gids</i> should point to an array with room for <i class="farg">*ngids</i> elements.<p>
The <b class="fname">puffs_cred_is</b>() family of functions return 1 if the truth value of the function for <i class="farg">pcr</i> is true and 0 if it is false. The function <b class="fname">puffs_cred_isjuggernaut</b>() is true if <i class="farg">pcr</i> describes superuser, kernel or file system credentials.</div>
<div class="subsection">
<h2 id="x41636365737320436f6e74726f6c">Access Control</h2> To help the programmers task of emulating normal kernel file system access control semantics, several helper functions are provided to check if access is allowed. They return 0 if access should be permitted or an errno value to indicate that access should be denied with the returned value.<p>
<b class="fname">puffs_access</b>() is equivalent to the kernel <b class="fname">vaccess</b>() function. The arguments specify current information of the file to be tested with the exception of <i class="farg">access_mode</i>, which is a combination of <span class="define">PUFFS_VREAD</span>, <span class="define">PUFFS_VWRITE</span> and <span class="define">PUFFS_VEXEC</span> indicating the desired file access mode.<p>
The rest of the functions provide UFS semantics for operations. <b class="fname">puffs_access_chown</b>() checks if it is permissible to chown a file with the current uid and gid to the new uid and gid with the credentials of <i class="farg">pcr</i>.<p>
<b class="fname">puffs_access_chmod</b>() checks against permission to chmod a file of type <i class="farg">type</i> to the mode <i class="farg">newmode</i>.<p>
Finally, <b class="fname">puffs_access_times</b>() checks if it is allowable to update the timestamps of a file. The argument <i class="farg">va_utimes_null</i> signals if the flags <span class="define">VA_UTIMES_NULL</span> was set in <i class="farg">va_vaflags</i> of <b class="var">struct vattr</b>. If coming from a path where this information is unavailable, passing 0 as this argument restricts the permission of modification to the owner and superuser. Otherwise the function checks for write permissions to the node and returns success if the caller has write permissions.</div>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../3/puffs">puffs(3)</a>, <a class="link-man" href="../9/vnode">vnode(9)</a></div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
October 18, 2007</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
<>

