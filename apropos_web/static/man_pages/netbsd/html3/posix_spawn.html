<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
POSIX_SPAWN(3)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
POSIX_SPAWN(3)</td>
<td class="head-vol" align="center">
Library Functions Manual</td>
<td class="head-rtitle" align="right">
POSIX_SPAWN(3)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">posix_spawn</b>, <b class="name">posix_spawnp</b> &#8212; <span class="desc">spawn a process</span></div>
<div class="section">
<h1 id="x4c494252415259">LIBRARY</h1> <span class="lib">Standard C Library (libc, &#45;lc)</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">spawn.h</a>&gt;</b><p>
<i class="ftype">int</i><br>
<b class="fname">posix_spawn</b>(<i class="farg" style="white-space:nowrap;">pid_t *restrict pid</i>, <i class="farg" style="white-space:nowrap;">const char *restrict path</i>, <i class="farg" style="white-space:nowrap;">const posix_spawn_file_actions_t *file_actions</i>, <i class="farg" style="white-space:nowrap;">const posix_spawnattr_t *restrict attrp</i>, <i class="farg" style="white-space:nowrap;">char *const argv[restrict]</i>, <i class="farg" style="white-space:nowrap;">char *const envp[restrict]</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">posix_spawnp</b>(<i class="farg" style="white-space:nowrap;">pid_t *restrict pid</i>, <i class="farg" style="white-space:nowrap;">const char *restrict file</i>, <i class="farg" style="white-space:nowrap;">const posix_spawn_file_actions_t *file_actions</i>, <i class="farg" style="white-space:nowrap;">const posix_spawnattr_t *restrict attrp</i>, <i class="farg" style="white-space:nowrap;">char *const argv[restrict]</i>, <i class="farg" style="white-space:nowrap;">char *const envp[restrict]</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="fname">posix_spawn</b>() and <b class="fname">posix_spawnp</b>() functions create a new process (child process) from the specified process image. The new process image is constructed from a regular executable file called the new process image file.<p>
When a C program is executed as the result of this call, it is entered as a C-language function call as follows:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
int main(int argc, char *argv[]);</pre>
<p>
where <i class="farg">argc</i> is the argument count and <i class="farg">argv</i> is an array of character pointers to the arguments themselves. In addition, the variable:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
extern char **environ;</pre>
<p>
points to an array of character pointers to the environment strings.<p>
The argument <i class="farg">argv</i> is an array of character pointers to null-terminated strings. The last member of this array is a null pointer and is not counted in <i class="farg">argc</i>. These strings constitute the argument list available to the new process image. The value in <i class="farg">argv</i>[0] should point to a filename that is associated with the process image being started by the <b class="fname">posix_spawn</b>() or <b class="fname">posix_spawnp</b>() function.<p>
The argument <i class="farg">envp</i> is an array of character pointers to null-terminated strings. These strings constitute the environment for the new process image. The environment array is terminated by a null pointer.<p>
The <i class="farg">path</i> argument to <b class="fname">posix_spawn</b>() is a pathname that identifies the new process image file to execute.<p>
The <i class="farg">file</i> parameter to <b class="fname">posix_spawnp</b>() is used to construct a pathname that identifies the new process image file. If the file parameter contains a slash character, the file parameter is used as the pathname for the new process image file. Otherwise, the path prefix for this file is obtained by a search of the directories passed as the environment variable &#8220;<span class="env">PATH</span>&#8221;. If this variable is not specified, the default path is set according to the <span class="define">_PATH_DEFPATH</span> definition in <b class="includes">&lt;<a class="link-includes">paths.h</a>&gt;</b>, which is set to &#8220;<span class="env">/usr/bin:/bin</span>&#8221;.<p>
If <i class="farg">file_actions</i> is a null pointer, then file descriptors open in the calling process remain open in the child process, except for those whose close-on-exec flag <span class="define">FD_CLOEXEC</span> is set (see <b class="fname">fcntl</b>()). For those file descriptors that remain open, all attributes of the corresponding open file descriptions, including file locks (see <b class="fname">fcntl</b>()), remain unchanged.<p>
If <i class="farg">file_actions</i> is not <span class="define">NULL</span>, then the file descriptors open in the child process are those open in the calling process as modified by the spawn file actions object pointed to by <i class="farg">file_actions</i> and the <span class="define">FD_CLOEXEC</span> flag of each remaining open file descriptor after the spawn file actions have been processed. The effective order of processing the spawn file actions are:<ol style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-enum">
<li class="list-enum" style="margin-top: 1.00em;">
The set of open file descriptors for the child process initially are the same set as is open for the calling process. All attributes of the corresponding open file descriptions, including file locks (see <b class="fname">fcntl</b>()), remain unchanged.</li>
<li class="list-enum" style="margin-top: 1.00em;">
The signal mask, signal default actions, and the effective user and group IDs for the child process are changed as specified in the attributes object referenced by <i class="farg">attrp</i>.</li>
<li class="list-enum" style="margin-top: 1.00em;">
The file actions specified by the spawn file actions object are performed in the order in which they were added to the spawn file actions object.</li>
<li class="list-enum" style="margin-top: 1.00em;">
Any file descriptor that has its <span class="define">FD_CLOEXEC</span> flag set (see <b class="fname">fcntl</b>()) is closed.</li>
</ol>
<p>
The maximum number of <i class="farg">file_actions</i> objects is limited to the <span class="define">RLIMIT_NOFILE</span> rlimit times 2.<p>
The <span class="type">posix_spawnattr_t</span> spawn attributes object type is defined in <b class="includes">&lt;<a class="link-includes">spawn.h</a>&gt;</b>. It contains the attributes defined below.<p>
If the <span class="define">POSIX_SPAWN_SETPGROUP</span> flag is set in the spawn-flags attribute of the object referenced by <i class="farg">attrp</i>, and the spawn-pgroup attribute of the same object is non-zero, then the child's process group is as specified in the spawn-pgroup attribute of the object referenced by <i class="farg">attrp</i>.<p>
As a special case, if the <span class="define">POSIX_SPAWN_SETPGROUP</span> flag is set in the spawn-flags attribute of the object referenced by <i class="farg">attrp</i>, and the spawn-pgroup attribute of the same object is set to zero, then the child is in a new process group with a process group ID equal to its process ID.<p>
If the <span class="define">POSIX_SPAWN_SETPGROUP</span> flag is not set in the spawn-flags attribute of the object referenced by <i class="farg">attrp</i>, the new child process inherits the parent's process group.<p>
If the <span class="define">POSIX_SPAWN_SETSCHEDPARAM</span> flag is set in the spawn-flags attribute of the object referenced by <i class="farg">attrp</i>, but <span class="define">POSIX_SPAWN_SETSCHEDULER</span> is not set, the new process image initially has the scheduling policy of the calling process with the scheduling parameters specified in the spawn-schedparam attribute of the object referenced by <i class="farg">attrp</i>.<p>
If the <span class="define">POSIX_SPAWN_SETSCHEDULER</span> flag is set in the spawn-flags attribute of the object referenced by <i class="farg">attrp</i> (regardless of the setting of the <span class="define">POSIX_SPAWN_SETSCHEDPARAM</span> flag), the new process image initially has the scheduling policy specified in the spawn-schedpolicy attribute of the object referenced by <i class="farg">attrp</i> and the scheduling parameters specified in the spawn-schedparam attribute of the same object.<p>
The <span class="define">POSIX_SPAWN_RESETIDS</span> flag in the spawn-flags attribute of the object referenced by <i class="farg">attrp</i> governs the effective user ID of the child process. If this flag is not set, the child process inherits the parent process' effective user ID. If this flag is set, the child process' effective user ID is reset to the parent's real user ID. In either case, if the set-user-ID mode bit of the new process image file is set, the effective user ID of the child process becomes that file's owner ID before the new process image begins execution.<p>
The <span class="define">POSIX_SPAWN_RESETIDS</span> flag in the spawn-flags attribute of the object referenced by <i class="farg">attrp</i> also governs the effective group ID of the child process. If this flag is not set, the child process inherits the parent process' effective group ID. If this flag is set, the child process' effective group ID is reset to the parent's real group ID. In either case, if the set-group-ID mode bit of the new process image file is set, the effective group ID of the child process becomes that file's group ID before the new process image begins execution.<p>
If the <span class="define">POSIX_SPAWN_SETSIGMASK</span> flag is set in the spawn-flags attribute of the object referenced by <i class="farg">attrp</i>, the child process initially has the signal mask specified in the spawn-sigmask attribute of the object referenced by <i class="farg">attrp</i>.<p>
If the <span class="define">POSIX_SPAWN_SETSIGDEF</span> flag is set in the spawn-flags attribute of the object referenced by <i class="farg">attrp</i>, the signals specified in the spawn-sigdefault attribute of the same object is set to their default actions in the child process. Signals set to the default action in the parent process is set to the default action in the child process.<p>
Signals set to be caught by the calling process is set to the default action in the child process.<p>
Signals set to be ignored by the calling process image is set to be ignored by the child process, unless otherwise specified by the <span class="define">POSIX_SPAWN_SETSIGDEF</span> flag being set in the spawn-flags attribute of the object referenced by <i class="farg">attrp</i> and the signals being indicated in the spawn-sigdefault attribute of the object referenced by <i class="farg">attrp</i>.<p>
If the value of the <i class="farg">attrp</i> pointer is <span class="define">NULL</span>, then the default values are used.<p>
All process attributes, other than those influenced by the attributes set in the object referenced by <i class="farg">attrp</i> as specified above or by the file descriptor manipulations specified in <i class="farg">file_actions</i>, appear in the new process image as though <b class="fname">vfork</b>() had been called to create a child process and then <b class="fname">execve</b>() had been called by the child process to execute the new process image.<p>
The implementation uses vfork(), thus the fork handlers are not run when <b class="fname">posix_spawn</b>() or <b class="fname">posix_spawnp</b>() is called.</div>
<div class="section">
<h1 id="x52455455524e2056414c554553">RETURN VALUES</h1> Upon successful completion, <b class="fname">posix_spawn</b>() and <b class="fname">posix_spawnp</b>() return the process ID of the child process to the parent process, in the variable pointed to by a non-<span class="define">NULL</span> <i class="farg">pid</i> argument, and return zero as the function return value. Otherwise, no child process is created, no value is stored into the variable pointed to by <i class="farg">pid</i>, and an error number is returned as the function return value to indicate the error. If the <i class="farg">pid</i> argument is a null pointer, the process ID of the child is not returned to the caller.</div>
<div class="section">
<h1 id="x4552524f5253">ERRORS</h1><ol style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-enum">
<li class="list-enum" style="margin-top: 1.00em;">
If <b class="fname">posix_spawn</b>() and <b class="fname">posix_spawnp</b>() fail for any of the reasons that would cause <b class="fname">vfork</b>() or one of the <b class="name">exec</b> to fail, an error value is returned as described by <b class="fname">vfork</b>() and <b class="name">exec</b>, respectively (or, if the error occurs after the calling process successfully returns, the child process exits with exit status 127).</li>
<li class="list-enum" style="margin-top: 1.00em;">
If <b class="name">POSIX_SPAWN_SETPGROUP</b> is set in the spawn-flags attribute of the object referenced by attrp, and <b class="fname">posix_spawn</b>() or <b class="fname">posix_spawnp</b>() fails while changing the child's process group, an error value is returned as described by <b class="fname">setpgid</b>() (or, if the error occurs after the calling process successfully returns, the child process exits with exit status 127).</li>
<li class="list-enum" style="margin-top: 1.00em;">
If <b class="name">POSIX_SPAWN_SETSCHEDPARAM</b> is set and <b class="name">POSIX_SPAWN_SETSCHEDULER</b> is not set in the spawn-flags attribute of the object referenced by attrp, then if <b class="fname">posix_spawn</b>() or <b class="fname">posix_spawnp</b>() fails for any of the reasons that would cause <b class="fname">sched_setparam</b>() to fail, an error value is returned as described by <b class="fname">sched_setparam</b>() (or, if the error occurs after the calling process successfully returns, the child process exits with exit status 127).</li>
<li class="list-enum" style="margin-top: 1.00em;">
If <b class="name">POSIX_SPAWN_SETSCHEDULER</b> is set in the spawn-flags attribute of the object referenced by attrp, and if <b class="fname">posix_spawn</b>() or <b class="fname">posix_spawnp</b>() fails for any of the reasons that would cause <b class="fname">sched_setscheduler</b>() to fail, an error value is returned as described by <b class="fname">sched_setscheduler</b>() (or, if the error occurs after the calling process successfully returns, the child process exits with exit status 127).</li>
<li class="list-enum" style="margin-top: 1.00em;">
If the <i class="farg">file_actions</i> argument is not <span class="define">NULL</span>, and specifies any <b class="fname">close</b>(), <b class="fname">dup2</b>(), or <b class="fname">open</b>() actions to be performed, and if <b class="fname">posix_spawn</b>() or <b class="fname">posix_spawnp</b>() fails for any of the reasons that would cause <b class="fname">close</b>(), <b class="fname">dup2</b>(), or <b class="fname">open</b>() to fail, an error value is returned as described by <b class="fname">close</b>(), <b class="fname">dup2</b>(), and <b class="fname">open</b>(), respectively (or, if the error occurs after the calling process successfully returns, the child process exits with exit status 127). An open file action may, by itself, result in any of the errors described by <b class="fname">close</b>() or <b class="fname">dup2</b>(), in addition to those described by <b class="fname">open</b>(). Finally, if the number of <i class="farg">file_actions</i> objects exceeds the allowed limit, <span class="errno">EINVAL</span> is returned.</li>
</ol>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../2/close">close(2)</a>, <a class="link-man" href="../2/dup2">dup2(2)</a>, <a class="link-man" href="../2/execve">execve(2)</a>, <a class="link-man" href="../2/fcntl">fcntl(2)</a>, <a class="link-man" href="../2/open">open(2)</a>, <a class="link-man" href="../2/setpgid">setpgid(2)</a>, <a class="link-man" href="../2/vfork">vfork(2)</a>, <a class="link-man" href="../3/posix_spawn_file_actions_addclose">posix_spawn_file_actions_addclose(3)</a>, <a class="link-man" href="../3/posix_spawn_file_actions_adddup2">posix_spawn_file_actions_adddup2(3)</a>, <a class="link-man" href="../3/posix_spawn_file_actions_addopen">posix_spawn_file_actions_addopen(3)</a>, <a class="link-man" href="../3/posix_spawn_file_actions_destroy">posix_spawn_file_actions_destroy(3)</a>, <a class="link-man" href="../3/posix_spawn_file_actions_init">posix_spawn_file_actions_init(3)</a>, <a class="link-man" href="../3/posix_spawnattr_destroy">posix_spawnattr_destroy(3)</a>, <a class="link-man" href="../3/posix_spawnattr_getflags">posix_spawnattr_getflags(3)</a>, <a class="link-man" href="../3/posix_spawnattr_getpgroup">posix_spawnattr_getpgroup(3)</a>, <a class="link-man" href="../3/posix_spawnattr_getschedparam">posix_spawnattr_getschedparam(3)</a>, <a class="link-man" href="../3/posix_spawnattr_getschedpolicy">posix_spawnattr_getschedpolicy(3)</a>, <a class="link-man" href="../3/posix_spawnattr_getsigdefault">posix_spawnattr_getsigdefault(3)</a>, <a class="link-man" href="../3/posix_spawnattr_getsigmask">posix_spawnattr_getsigmask(3)</a>, <a class="link-man" href="../3/posix_spawnattr_init">posix_spawnattr_init(3)</a>, <a class="link-man" href="../3/posix_spawnattr_setflags">posix_spawnattr_setflags(3)</a>, <a class="link-man" href="../3/posix_spawnattr_setpgroup">posix_spawnattr_setpgroup(3)</a>, <a class="link-man" href="../3/posix_spawnattr_setschedparam">posix_spawnattr_setschedparam(3)</a>, <a class="link-man" href="../3/posix_spawnattr_setschedpolicy">posix_spawnattr_setschedpolicy(3)</a>, <a class="link-man" href="../3/posix_spawnattr_setsigdefault">posix_spawnattr_setsigdefault(3)</a>, <a class="link-man" href="../3/posix_spawnattr_setsigmask">posix_spawnattr_setsigmask(3)</a>, <a class="link-man" href="../3/sched_setparam">sched_setparam(3)</a>, <a class="link-man" href="../3/sched_setscheduler">sched_setscheduler(3)</a></div>
<div class="section">
<h1 id="x5354414e4441524453">STANDARDS</h1> The <b class="fname">posix_spawn</b>() and <b class="fname">posix_spawnp</b>() functions conform to IEEE Std 1003.1-2001 (&#8220;POSIX.1&#8221;).</div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="fname">posix_spawn</b>() and <b class="fname">posix_spawnp</b>() functions first appeared in <span class="unix">FreeBSD&#160;8.0</span>. The library parts were ported and a kernel implementation of <b class="fname">posix_spawn</b>() added for <span class="unix">NetBSD&#160;6.0</span> during Google Summer of Code by Charles Zhang and Martin Husemann.</div>
<div class="section">
<h1 id="x415554484f5253">AUTHORS</h1> <span class="author">Ed Schouten</span> &#60;<a class="link-mail" href="mailto:ed@FreeBSD.org">ed@FreeBSD.org</a>&#62;</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
February 2, 2014</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

