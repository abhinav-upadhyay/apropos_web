<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
LOGIN_CAP(3)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
LOGIN_CAP(3)</td>
<td class="head-vol" align="center">
Library Functions Manual</td>
<td class="head-rtitle" align="right">
LOGIN_CAP(3)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">login_getclass</b>, <b class="name">login_getcapbool</b>, <b class="name">login_getcapnum</b>, <b class="name">login_getcapsize</b>, <b class="name">login_getcapstr</b>, <b class="name">login_getcaptime</b>, <b class="name">login_getpwclass</b>, <b class="name">login_close</b>, <b class="name">setclasscontext</b>, <b class="name">setusercontext</b> &#8212; <span class="desc">query login.conf database about a user class</span></div>
<div class="section">
<h1 id="x4c494252415259">LIBRARY</h1> <span class="lib">System Utilities Library (libutil, &#45;lutil)</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">sys/types.h</a>&gt;</b><br>
<b class="includes">#include &lt;<a class="link-includes">login_cap.h</a>&gt;</b><p>
<i class="ftype">login_cap_t *</i><br>
<b class="fname">login_getclass</b>(<i class="farg" style="white-space:nowrap;">char *class</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">login_getcapbool</b>(<i class="farg" style="white-space:nowrap;">login_cap_t *lc</i>, <i class="farg" style="white-space:nowrap;">const char *cap</i>, <i class="farg" style="white-space:nowrap;">u_int def</i>);<p>
<i class="ftype">quad_t</i><br>
<b class="fname">login_getcapnum</b>(<i class="farg" style="white-space:nowrap;">login_cap_t *lc</i>, <i class="farg" style="white-space:nowrap;">const char *cap</i>, <i class="farg" style="white-space:nowrap;">quad_t def</i>, <i class="farg" style="white-space:nowrap;">quad_t err</i>);<p>
<i class="ftype">quad_t</i><br>
<b class="fname">login_getcapsize</b>(<i class="farg" style="white-space:nowrap;">login_cap_t *lc</i>, <i class="farg" style="white-space:nowrap;">const char *cap</i>, <i class="farg" style="white-space:nowrap;">quad_t def</i>, <i class="farg" style="white-space:nowrap;">quad_t err</i>);<p>
<i class="ftype">char *</i><br>
<b class="fname">login_getcapstr</b>(<i class="farg" style="white-space:nowrap;">login_cap_t *lc</i>, <i class="farg" style="white-space:nowrap;">const char *cap</i>, <i class="farg" style="white-space:nowrap;">char *def</i>, <i class="farg" style="white-space:nowrap;">char *err</i>);<p>
<i class="ftype">quad_t</i><br>
<b class="fname">login_getcaptime</b>(<i class="farg" style="white-space:nowrap;">login_cap_t *lc</i>, <i class="farg" style="white-space:nowrap;">const char *cap</i>, <i class="farg" style="white-space:nowrap;">quad_t def</i>, <i class="farg" style="white-space:nowrap;">quad_t err</i>);<p>
<i class="ftype">login_cap_t *</i><br>
<b class="fname">login_getpwclass</b>(<i class="farg" style="white-space:nowrap;">struct passwd *pwd</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">login_close</b>(<i class="farg" style="white-space:nowrap;">login_cap_t *lc</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">setclasscontext</b>(<i class="farg" style="white-space:nowrap;">const char *class</i>, <i class="farg" style="white-space:nowrap;">u_int flags</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">setusercontext</b>(<i class="farg" style="white-space:nowrap;">login_cap_t *lc</i>, <i class="farg" style="white-space:nowrap;">const struct passwd *pwd</i>, <i class="farg" style="white-space:nowrap;">uid_t uid</i>, <i class="farg" style="white-space:nowrap;">u_int flags</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="fname">login_getclass</b>() function extracts the entry specified by <i class="arg">class</i> (or <code class="lit">default</code> if <i class="arg">class</i> is <span class="define">NULL</span> or the empty string) from <i class="file">/etc/login.conf</i> (see <a class="link-man" href="../5/login.conf">login.conf(5)</a>). If the entry is found, a <code class="lit">login_cap_t</code> pointer is returned. <span class="define">NULL</span> is returned if the user class is not found. When the <code class="lit">login_cap_t</code> structure is no longer needed, it should be freed by the <b class="fname">login_close</b>() function.<p>
The <b class="fname">login_getpwclass</b>() function is equivalent to:<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit">login_getclass(pwd&#160;? pwd-&gt;pw_class&#160;: NULL)</code></div>
</blockquote>
<p>
Once <i class="arg">lc</i> has been returned by <b class="fname">login_getclass</b>(), any of the other <b class="fname">login_*</b>() functions may be called.<p>
The <b class="fname">login_getcapnum</b>(), <b class="fname">login_getcapsize</b>(), <b class="fname">login_getcapstr</b>(), and <b class="fname">login_getcaptime</b>() functions all query the database entry for a field named <i class="arg">cap</i>. If the field is found, its value is returned. If the field is not found, the value specified by <i class="arg">def</i> is returned. If an error is encountered while trying to find the field, <i class="arg">err</i> is returned. See <a class="link-man" href="../5/login.conf">login.conf(5)</a> for a discussion of the various textual forms the value may take. The <b class="fname">login_getcapbool</b>() function is slightly different. It returns <i class="arg">def</i> if no capabilities were found for this class (typically meaning that the default class was used and the <code class="lit">/etc/login.conf</code> file is missing). It returns a non-zero value if <i class="arg">cap</i>, with no value, was found, zero otherwise.<p>
The <b class="fname">setclasscontext</b>() function takes <i class="arg">class</i>, the name of a user class, and sets the resources defined by that class according to <i class="arg">flags</i>. Only the <span class="define">LOGIN_SETPATH</span>, <span class="define">LOGIN_SETPRIORITY</span>, <span class="define">LOGIN_SETRESOURCES</span>, and <span class="define">LOGIN_SETUMASK</span> bits are used. (See <b class="fname">setusercontext</b>() below). It returns 0 on success and -1 on failure.<p>
The <b class="fname">setusercontext</b>() function sets the resources according to <i class="arg">flags</i>. The <i class="arg">lc</i> argument, if not <span class="define">NULL</span>, contains the class information that should be used. The <i class="arg">pwd</i> argument, if not <span class="define">NULL</span>, provides information about the user. Both <i class="arg">lc</i> and <i class="arg">pwd</i> cannot be <span class="define">NULL</span>. The <i class="arg">uid</i> argument is used in place of the user id contained in the <i class="arg">pwd</i> structure when calling <a class="link-man" href="../2/setuid">setuid(2)</a>. The various bits available to be or-ed together to make up <i class="arg">flags</i> are:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
LOGIN_SETGID</dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
Set the group id. Requires the <i class="arg">pwd</i> field be specified.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
LOGIN_SETGROUPS</dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
Set the group membership list by calling <a class="link-man" href="../3/initgroups">initgroups(3)</a>. Requires the <i class="arg">pwd</i> field be specified.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
LOGIN_SETGROUP</dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
Set the group id and call <a class="link-man" href="../3/initgroups">initgroups(3)</a>. Requires the <i class="arg">pwd</i> field be specified.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
LOGIN_SETLOGIN</dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
Sets the login name by <a class="link-man" href="../2/setlogin">setlogin(2)</a>. Requires the <i class="arg">pwd</i> field be specified.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
LOGIN_SETPATH</dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
Sets the <span class="env">PATH</span> environment variable.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
LOGIN_SETPRIORITY</dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
Sets the priority by <a class="link-man" href="../2/setpriority">setpriority(2)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
LOGIN_SETRESOURCES</dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
Sets the various system resources by <a class="link-man" href="../2/setrlimit">setrlimit(2)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
LOGIN_SETUMASK</dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
Sets the umask by <a class="link-man" href="../2/umask">umask(2)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
LOGIN_SETUSER</dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
Sets the user id to <i class="arg">uid</i> by <a class="link-man" href="../2/setuid">setuid(2)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
LOGIN_SETENV</dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
Sets the environment variables as defined by the setenv keyword, by <a class="link-man" href="../3/setenv">setenv(3)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
LOGIN_SETALL</dt>
<dd class="list-tag" style="margin-left: 20.00ex;">
Sets all of the above.</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../2/setlogin">setlogin(2)</a>, <a class="link-man" href="../2/setpriority">setpriority(2)</a>, <a class="link-man" href="../2/setrlimit">setrlimit(2)</a>, <a class="link-man" href="../2/setuid">setuid(2)</a>, <a class="link-man" href="../2/umask">umask(2)</a>, <a class="link-man" href="../3/initgroups">initgroups(3)</a>, <a class="link-man" href="../3/secure_path">secure_path(3)</a>, <a class="link-man" href="../5/login.conf">login.conf(5)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="name">login_getclass</b> family of functions are largely based on the <span class="unix">BSD/OS</span> implementation of same, and appeared in <span class="unix">NetBSD&#160;1.5</span> by kind permission.</div>
<div class="section">
<h1 id="x43415645415453">CAVEATS</h1> The string returned by <b class="fname">login_getcapstr</b>() is allocated via <a class="link-man" href="../3/malloc">malloc(3)</a> when the specified capability is present and thus it is the responsibility of the caller to <b class="fname">free</b>() this space. However, if the capability was not found or an error occurred and <i class="farg">def</i> or <i class="farg">err</i> (whichever is relevant) are non-<span class="define">NULL</span> the returned value is simply what was passed in to <b class="fname">login_getcapstr</b>(). Therefore it is not possible to blindly <b class="fname">free</b>() the return value without first checking it against <i class="farg">def</i> and <i class="farg">err</i>.<p>
The same warnings set forth in <a class="link-man" href="../2/setlogin">setlogin(2)</a> apply to <b class="fname">setusercontext</b>() when the <span class="define">LOGIN_SETLOGIN</span> flag is used. Specifically, changing the login name affects all processes in the current session, not just the current process. See <a class="link-man" href="../2/setlogin">setlogin(2)</a> for more information.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
June 20, 2013</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

