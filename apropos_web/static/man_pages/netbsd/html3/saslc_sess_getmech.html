<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="/static/man_pages/netbsd/style.css" type="text/css" media="all">
<title>
LIBSASLC(3)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
LIBSASLC(3)</td>
<td class="head-vol" align="center">
Library Functions Manual</td>
<td class="head-rtitle" align="right">
LIBSASLC(3)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">libsaslc</b>, <b class="name">saslc.d</b>, <b class="name">saslc_alloc</b>, <b class="name">saslc_end</b>, <b class="name">saslc_init</b>, <b class="name">saslc_sess_init</b>, <b class="name">saslc_sess_end</b>, <b class="name">saslc_sess_getprop</b>, <b class="name">saslc_sess_setprop</b>, <b class="name">saslc_sess_cont</b>, <b class="name">saslc_sess_decode</b>, <b class="name">saslc_sess_encode</b>, <b class="name">saslc_sess_getmech</b>, <b class="name">saslc_sess_strerror</b>, <b class="name">saslc_strerror</b> &#8212; <span class="desc">Simple Authentication and Security Layer client library</span></div>
<div class="section">
<h1 id="x4c494252415259">LIBRARY</h1> <span class="lib">Simple Authentication and Security Layer client library (libsaslc, &#45;lsaslc)</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">saslc.h</a>&gt;</b><p>
<i class="ftype">saslc_t *</i><br>
<b class="fname">saslc_alloc</b>(<i class="farg" style="white-space:nowrap;">void</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">saslc_end</b>(<i class="farg" style="white-space:nowrap;">saslc_t *ctx</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">saslc_init</b>(<i class="farg" style="white-space:nowrap;">saslc_t *ctx</i>, <i class="farg" style="white-space:nowrap;">const char *appname</i>, <i class="farg" style="white-space:nowrap;">const char *cfgpath</i>);<p>
<i class="ftype">saslc_sess_t *</i><br>
<b class="fname">saslc_sess_init</b>(<i class="farg" style="white-space:nowrap;">saslc_t *ctx</i>, <i class="farg" style="white-space:nowrap;">const char *mechs</i>, <i class="farg" style="white-space:nowrap;">const char *secopts</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">saslc_sess_end</b>(<i class="farg" style="white-space:nowrap;">saslc_sess_t *sess</i>);<p>
<i class="ftype">const char *</i><br>
<b class="fname">saslc_sess_getprop</b>(<i class="farg" style="white-space:nowrap;">saslc_sess_t *sess</i>, <i class="farg" style="white-space:nowrap;">const char *key</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">saslc_sess_setprop</b>(<i class="farg" style="white-space:nowrap;">saslc_sess_t *sess</i>, <i class="farg" style="white-space:nowrap;">const char *key</i>, <i class="farg" style="white-space:nowrap;">const char *value</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">saslc_sess_cont</b>(<i class="farg" style="white-space:nowrap;">saslc_sess_t *sess</i>, <i class="farg" style="white-space:nowrap;">const void *in</i>, <i class="farg" style="white-space:nowrap;">size_t inlen</i>, <i class="farg" style="white-space:nowrap;">void* *out</i>, <i class="farg" style="white-space:nowrap;">size_t *outlen</i>);<p>
<i class="ftype">ssize_t</i><br>
<b class="fname">saslc_sess_decode</b>(<i class="farg" style="white-space:nowrap;">saslc_sess_t *sess</i>, <i class="farg" style="white-space:nowrap;">const void *in</i>, <i class="farg" style="white-space:nowrap;">size_t inlen</i>, <i class="farg" style="white-space:nowrap;">void* *out</i>, <i class="farg" style="white-space:nowrap;">size_t *outlen</i>);<p>
<i class="ftype">ssize_t</i><br>
<b class="fname">saslc_sess_encode</b>(<i class="farg" style="white-space:nowrap;">saslc_sess_t *sess</i>, <i class="farg" style="white-space:nowrap;">const void *in</i>, <i class="farg" style="white-space:nowrap;">size_t inlen</i>, <i class="farg" style="white-space:nowrap;">void* *out</i>, <i class="farg" style="white-space:nowrap;">size_t *outlen</i>);<p>
<i class="ftype">const char *</i><br>
<b class="fname">saslc_sess_getmech</b>(<i class="farg" style="white-space:nowrap;">saslc_sess_t *sess</i>);<p>
<i class="ftype">const char *</i><br>
<b class="fname">saslc_sess_strerror</b>(<i class="farg" style="white-space:nowrap;">saslc_sess_t *sess</i>);<p>
<i class="ftype">const char *</i><br>
<b class="fname">saslc_strerror</b>(<i class="farg" style="white-space:nowrap;">saslc_t *ctx</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="name">libsaslc</b> library offers a client interface for the Simple Authentication and Security Layer (SASL). The library is heavily influenced by its use with <a class="link-man" href="../1/postfix">postfix(1)</a>.</div>
<div class="section">
<h1 id="x46554e4354494f4e53">FUNCTIONS</h1> The following functions are available in the library.<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">saslc_alloc</b>(<i class="farg"></i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
The <b class="fname">saslc_alloc</b>() function allocates and returns a new saslc context. The context is uninitialized: see <b class="fname">saslc_init</b>(). Returns <span class="define">NULL</span> on error.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">saslc_end</b>(<i class="farg">ctx</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
The <b class="fname">saslc_end</b>() function destroys and deallocate resources used by the context <i class="arg">ctx</i>. The context shouldn't have any sessions assigned to it. Returns 0 on success and &#45;1 if the context has active sessions and cannot be deallocated.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">saslc_init</b>(<i class="farg">ctx</i>, <i class="farg">appname</i>, <i class="farg">cfgpath</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
The <b class="fname">saslc_init</b>() function initializes the saslc context <i class="arg">ctx</i>. Based on the application name <i class="arg">appname</i>, it also parses the configuration files as indicated by <i class="arg">cfgpath</i>, sets up the context and mechanism dictionaries, and creates mechanism list for the context. If <i class="arg">cfgpath</i> is <span class="define">NULL</span>, it checks the environment variable <span class="env">SASLC_CONFIG</span> for a location and if that is not found it uses the default path <i class="file">/etc/saslc.d</i>. Returns 0 on success and &#45;1 on failure.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">saslc_sess_init</b>(<i class="farg">ctx</i>, <i class="farg">mechs</i>, <i class="farg">secopts</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
The <b class="fname">saslc_sess_init</b>() function creates new session assigned to the <i class="arg">ctx</i> context. The function chooses the mechanism to use for authentication from the <i class="arg">mechs</i> list taking into account the requirements from the <i class="arg">secopts</i> list. Both lists may be space or comma delimited. The first matching mechanism from the <i class="arg">mechs</i> list is used. See <i class="link-sec"><a class="link-sec" href="#x434f4e46494755524154494f4e">CONFIGURATION</a></i> below for the supported mechanisms. The valid security options are<p>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
&#8220;noanonymous&#8221;</dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
reject anonymous mechanisms</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
&#8220;noplaintext&#8221;</dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
reject plaintext mechanisms</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
&#8220;nodictionary&#8221;</dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
reject mechanisms prone to dictionary attack</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
&#8220;noactive&#8221;</dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
reject mechanisms prone to active non-dictionary attacks</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
&#8220;mutual&#8221;</dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
require mutual authentication mechanisms</dd>
</dl>
<p>
Unknown security options are ignored. Returns a session handle or <span class="define">NULL</span> on error or no match.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">saslc_sess_end</b>(<i class="farg">sess</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
The <b class="fname">saslc_sess_end</b>() function ends the sasl session <i class="arg">sess</i>. It destroys and deallocates all internal resources. This does not fail.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">saslc_sess_getprop</b>(<i class="farg">sess</i>, <i class="farg">key</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
The <b class="fname">saslc_sess_getprop</b>() function gets the property indicated by the <i class="arg">key</i> from the saslc dictionaries. Dictionaries are searched in following order: session <i class="arg">sess</i> dictionary, context dictionary (global configuration), and mechanism dictionary. Returns the property value or <span class="define">NULL</span> if the property is not found.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">saslc_sess_setprop</b>(<i class="farg">sess</i>, <i class="farg">key</i>, <i class="farg">value</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
The <b class="fname">saslc_sess_setprop</b>() function sets the property indexed by <i class="arg">key</i> to the value <i class="arg">value</i> in the session <i class="arg">sess</i> dictionary. If the property already exists in the session dictionary, then the previous value is replaced by the new value. If <i class="arg">value</i> is <span class="define">NULL</span>, then any previous value in the session dictionary is removed. Returns 0 on success or &#45;1 on failure.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">saslc_sess_cont</b>(<i class="farg">sess</i>, <i class="farg">in</i>, <i class="farg">inlen</i>, <i class="farg">out</i>, <i class="farg">outlen</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
The <b class="fname">saslc_sess_cont</b>() function performs one step of the sasl authentication. It reads <i class="arg">inlen</i> bytes of input data (from the server) from the <i class="arg">in</i> buffer and stores <i class="arg">outlen</i> bytes of output data in <i class="arg">out</i> (for the server). The user is responsible for freeing memory allocated for <i class="arg">out</i>. It returns 0 if the authentication process is completed, 1 if another step is required, and &#45;1 on error. Note that the completion of authentication process does not mean the client is authenticated; that is determined by the server.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">saslc_sess_decode</b>(<i class="farg">sess</i>, <i class="farg">in</i>, <i class="farg">inlen</i>, <i class="farg">out</i>, <i class="farg">outlen</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
The <b class="fname">saslc_sess_encode</b>() and <b class="fname">saslc_sess_decode</b>() functions are used to provide the integrity (&#8220;auth-int&#8221;) and  confidentiality (&#8220;auth-int&#8221;) layers for mechanisms that provide them. They encode and, respectively, decode <i class="arg">inlen</i> bytes of data from the <i class="arg">in</i> buffer using the method negotiated during authentication. On error they return &#45;1. Otherwise, they return the number of bytes consumed from <i class="arg">in</i> and output <i class="arg">outlen</i> bytes of data in the <i class="arg">out</i> buffer. The user is responsible for freeing memory allocated for <i class="arg">out</i>. If <i class="arg">outlen</i> is 0, more data is needed before anything can be output. Unused input data is stored internally for use in subsequent calls.<p>
When decoding, the internal buffers can only be flushed by providing the missing packet data and it is an error to call <b class="fname">ssalc_sess_decode</b>() with <i class="arg">inlen</i> = 0. The first call of <b class="fname">saslc_sess_decode</b>() in a session must begin at the start of a packet. Subsequent calls need not be aligned on packet boundaries.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">saslc_sess_encode</b>(<i class="farg">sess</i>, <i class="farg">in</i>, <i class="farg">inlen</i>, <i class="farg">out</i>, <i class="farg">outlen</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
As described above, <b class="fname">saslc_sess_encode</b>() encodes <i class="arg">inlen</i> bytes of data from the <i class="arg">in</i> buffer. Note that unlike when decoding, the internal buffer may be flushed through the encoder by calling <b class="fname">saslc_sess_encode</b>() with <i class="arg">inlen</i> = 0. In this case, <b class="fname">saslc_sess_encode</b>() returns the number of bytes that were flushed from the internal buffer.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">saslc_sess_getmech</b>(<i class="farg">sess</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
The <b class="fname">saslc_sess_getmech</b>() function returns the name of the mechanism used in the session <i class="farg">sess</i>. The function does not fail.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">saslc_sess_strerror</b>(<i class="farg">sess</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
The <b class="fname">saslc_sess_strerror</b>() returns the error message associated with the session <i class="farg">sess</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="fname">saslc_strerror</b>(<i class="farg">ctx</i>)</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
The <b class="fname">saslc_strerror</b>() function operates as <b class="fname">saslc_sess_strerror</b>(), but instead returns the error message string for the last error in the context <i class="farg">ctx</i>. Neither function will ever return <span class="define">NULL</span>.</dd>
</dl>
</div>
<div class="section">
<h1 id="x434f4e46494755524154494f4e">CONFIGURATION</h1> The library uses three types of dictionaries: context (or global), session, and mechanism, and they are searched in that order by <b class="fname">saslc_getprop</b>() and the first matching entry is taken. The context and mechanism dictionaries are loaded from configuration files, while the session dictionary is loaded by the caller via <b class="fname">saslc_setprop</b>().<p>
The configuration file <i class="file">&lt;cfgpath&gt;/&lt;appname&gt;/saslc.conf</i> is used for the configuration context. The <i class="file">&lt;cfgpath&gt;/&lt;appname&gt;/mech/&lt;mechanism&gt;.conf</i> file is used for the mechanism configuration. The <i class="file">&lt;cfgpath&gt;</i> is <i class="file">/etc/saslc.d</i> by default, but this may be overridden by the environment variable <span class="env">SASLC_CONFIG</span>, which in turn may be overridden by <b class="fname">saslc_init</b>(). The <i class="file">&lt;appname&gt;</i> is <i class="file">saslc</i> by default, but may also be overridden by <b class="fname">saslc_init</b>(). Finally, the <i class="file">&lt;mechanism&gt;</i> is the mechanism in use by the session as returned by <b class="fname">saslc_sess_getmech</b>(). Note that this name is case sensitive. The currently supported mechanisms are<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
ANONYMOUS</dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
See RFC 2245 and RFC 4505.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
CRAM-MD5</dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
See RFC 2195.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
DIGEST-MD5</dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
See RFC 2831.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
EXTERNAL</dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
See RFC 2222 section 7.4 and RFC 4422 appendix A.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
GSSAPI</dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
See RFC 2222 section 7.2 and RFC 4752. This requires GSS, Heimdal, or MIT Kerberos.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
LOGIN</dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
Non-standard, but common.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
PLAIN</dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
See RFC 2595 and RFC 4616.</dd>
</dl>
<p>
If any of the mechanism files are missing they are silently ignored, unless debugging is enabled.<p>
The configuration files consists of lines of the form:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
<b>#</b> comment line 
&#60;key&#62; &#160;&#160; &#60;value&#62; &#160;&#160; &#91;<b>#</b> comment&#93;</pre>
<p>
The &#60;key&#62; is a string beginning with an alpha character (<a class="link-man" href="../3/isalpha">isalpha(3)</a>) followed by any number of alpha numeric (<a class="link-man" href="../3/isalnum">isalnum(3)</a>) or underscore &#8216;_&#8217; characters; this is case sensitive. The &#60;value&#62; is a number or a quoted string. More than one &#60;key&#62; and &#60;value&#62; pair may occur on a single line, but they may not be broken across lines. A &#8216;<b>#</b>&#8217; character (outside a quoted string) indicates that the rest of the line is a comment.<p>
NOTE: Currently, no escaping is supported in strings, so they may not contain quotes. Numbers must be between 0 and <span class="define">LLONG_MAX</span>, inclusive. Any base supported by <a class="link-man" href="../3/strtoll">strtoll(3)</a> is allowed.</div>
<div class="section">
<h1 id="x50524f50455254494553">PROPERTIES</h1> Most of the control of the library behavior is done via setting various properties in the context or mechanism dictionaries via the configuration files or in the session dictionary with <b class="fname">saslc_setprop</b>(). The following properties are currently used, as defined in <i class="file">saslc.h</i>:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
SASLC_PROP_AUTHCID (&#8220;AUTHCID&#8221;)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The authentication name (or username) to authenticate with. Used by all mechanisms except EXTERNAL.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
SASLC_PROP_AUTHZID (&#8220;AUTHZID&#8221;)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The authorization string to use. By default, this string is empty. Used by the DIGEST-MD5, EXTERNAL, and PLAIN mechanisms.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
SASLC_PROP_BASE64IO (&#8220;BASE64IO&#8221;)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
If true ("true", "yes", or nonzero), then input and output strings are base64 encoded. Any other value is false and the input and output strings are not base64 encoded. By default, this is assumed true. Used by all mechanisms.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
SASLC_PROP_CIPHERMASK (&#8220;CIPHERMASK&#8221;)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The mask of ciphers to use with the DIGEST-MD5 mechanism when using the &#8220;auth-conf&#8221; QOP. By default all supported ciphers are used, but they may be limited by a comma delimited list of cipher names. The recognized cipher names for DIGEST-MD5 are:<p>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<code class="lit">3des</code></dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
Triple-DES Cipher in CBC "two keys" mode with 112 bit key</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<code class="lit">aes</code></dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
AES Cipher in CBC mode with 128 bit key</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<code class="lit">des</code></dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
DES Cipher in CBC mode with 56 bit key</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<code class="lit">rc4</code></dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
RC4 Cipher with 128 bit key</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<code class="lit">rc4-40</code></dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
RC4 Cipher with 40 bit key</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<code class="lit">rc4-56</code></dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
RC4 Cipher with 56 bit key</dd>
</dl>
<p>
The default value is &#8220;des,3des,rc4,rc4_40,rc4_56,aes&#8221;. (Note that &#8220;aes&#8221; is not part of the official standard.) Used by the DIGEST-MD5 mechanism.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
SASLC_PROP_DEBUG (&#8220;DEBUG&#8221;)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
If true, then enable debug messages. This is implemented as a global variable so it will affect all sessions. If set via <b class="fname">saslc_sess_setprop</b>(), it should be set before the first call to <b class="fname">saslc_sess_cont</b>(). (Also see the environment variable <span class="env">SASLC_ENV_DEBUG</span> in the <i class="link-sec"><a class="link-sec" href="#x454e5649524f4e4d454e54">ENVIRONMENT</a></i> section below.)</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
SASLC_PROP_HOSTNAME (&#8220;HOSTNAME&#8221;)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The fully qualified domain name of the server host. Used by the DIGEST-MD5 and GSSAPI mechanisms.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
SASLC_PROP_MAXBUF (&#8220;MAXBUF&#8221;)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The size of the decode buffer. This info is sent to the server so that it doesn't send packets that won't fit in the decode buffer when decoded. Used by the DIGEST-MD5 and GSSAPI mechanisms.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
SASLC_PROP_PASSWD (&#8220;PASSWD&#8221;)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The password to authenticate with. Used by the CRAM-MD5, DIGEST-MD5, LOGIN, and PLAIN mechanisms.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
SASLC_PROP_QOPMASK (&#8220;QOPMASK&#8221;)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The mask of QOP (quality of protection) to use with the DIGEST-MD5 and GSSAPI mechanisms. By default all supported QOP values are allowed, but they may be limited by a comma delimited list of QOP values. The recognized QOP values are:<p>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<code class="lit">auth</code></dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
authentication only</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<code class="lit">auth-int</code></dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
authentication with integrity</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<code class="lit">auth-conf</code></dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
authentication with confidentiality</dd>
</dl>
<p>
so the default value of the mask is &#8220;auth,auth-int,auth-conf&#8221;. Used by the DIGEST-MD5 and GSSAPI mechanisms.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
SASLC_PROP_REALM (&#8220;REALM&#8221;)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
A comma delimited list of possible realms to use for authentication. The format of each element in the list is &#8220;&#91;<span class="opt">&#60;hostname&#62;:</span>&#93;&#60;realm&#62;&#8221;. The user specified realm is the first realm in the list with a matching hostname or, if none is found, the first realm in the list with no hostname. If the server provides a list of realms, the one matching the user specified realm is selected. If no match is found or if the user didn't provide a realm, the first realm provided by the server is selected. If the server doesn't provide any realms, use the user specified realm if there is one, or the hostname if not. This is useful when the server provides multiple realms or no realm. Used by the DIGEST-MD5 mechanism.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
SASLC_PROP_SECURITY (&#8220;SECURITY&#8221;)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
A comma delimited list of extra security option flags that will be &#8220;or&#8221;-ed together with those passed to <b class="fname">saslc_sess_init</b>(). Since these flags are used to choose the session mechanism, they are only effective if they are in the context configuration file. (See the <i class="link-sec"><a class="link-sec" href="#x434f4e46494755524154494f4e">CONFIGURATION</a></i> section and the <b class="fname">saslc_sess_init</b>() function.)</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
SASLC_PROP_SERVICE (&#8220;SERVICE&#8221;)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The service being used, e.g., smtp, imap, etc. Used by the DIGEST-MD5 and GSSAPI mechanisms.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
SASLC_PROP_SERVNAME (&#8220;SERVNAME&#8221;)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
A comma delimited list of possible service names with elements of the form &#8220;&#91;<span class="opt">&#60;hostname&#62;:</span>&#93;&#60;serv-name&#62;&#8221; and with the same rules as for the SASLC_PROP_REALM list. This should only be used if the client uses a DNS name for the service that is different from the FQDN of the server. For example, the service name <span class="emph">example.com</span> might resolve (via SRV or MX records) into a set of other DNS names, one of which, <span class="emph">mail3.example.com</span>, is the FQDN of the server. (See RFC 2831 section 2.1.2 &#8220;serv-name&#8221;.) Used by the DIGEST-MD5 mechanism.</dd>
</dl>
<p>
The defines in <i class="file">saslc.h</i> should be used in code, but their values need to be used in the config files.</div>
<div class="section">
<h1 id="x454e5649524f4e4d454e54">ENVIRONMENT</h1> The following environment variables (defined in <i class="file">saslc.h</i>) affect the behavior of the library:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="env">SASLC_ENV_CONFIG</span> (&#8220;SASLC_CONFIG&#8221;)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
If the environment variable <span class="env">SASLC_CONFIG</span> is set it overrides the default configuration file location of <i class="file">/etc/saslc.d</i>. This may be overridden by <b class="fname">saslc_init</b>().</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="env">SASLC_ENV_DEBUG</span> (&#8220;SASLC_DEBUG&#8221;)</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
If set, turn on debugging messages. This turns on debugging as early as possible and is a global setting.</dd>
</dl>
</div>
<div class="section">
<h1 id="x47535341504920414e44204b45524245524f53">GSSAPI AND KERBEROS</h1> The following is a minimal (Heimdal) Kerberos 5 setup for use with an smtp server that has been configured to support <span class="emph">SASL</span> with the <span class="emph">GSSAPI</span> mechanism. It assumes that Kerberos and the smtp server will both run on <span class="emph">server.my.domain</span> and that the client is on <span class="emph">client.my.domain</span>. It also assumes that the smtp server runs as user <span class="emph">postfix</span> and group <span class="emph">mail</span>, and that it is not chrooted.<p>
On <span class="emph">server.my.domain</span> run the following script as <span class="emph">root</span> and then start the Kerberos server <a class="link-man" href="../8/kdc">kdc(8)</a>. You will be prompted for a master password for Kerberos and a password for the <span class="emph">postfix</span> principal.<p>
<pre style="margin-left: 5.00ex;" class="lit display">
#/bin/sh 
<p>
cat &lt;&lt;- EOF &gt;&gt; /etc/krb5.conf 
[libdefaults] 
	default_realm = MY.DOMAIN 
[realms] 
	MY.DOMAIN = { 
		kdc = server.my.domain 
		admin_servers = server.my.domain 
	} 
[domain_realm] 
	.my.domain = MY.DOMAIN 
EOF 
<p>
mkdir /var/heimdal 
chown root:wheel /var/heimdal 
chmod 755 /var/heimdal 
<p>
kstash 
kadmin -l init --realm-max-ticket-life=unlimited \ 
               --realm-max-renewable-life=unlimited \ 
               MY.DOMAIN 
kadmin -l add  --max-ticket-life="1 day" \ 
               --max-renewable-life="1 week" \ 
               --expiration-time=never \ 
               --pw-expiration-time=never \ 
               --attributes="" \ 
               postfix 
kadmin -l add  --random-key \ 
               --max-ticket-life="1 day" \ 
               --max-renewable-life="1 week" \ 
               --expiration-time=never \ 
               --pw-expiration-time=never \ 
               --attributes="" \ 
               smtp/server.my.domain 
kadmin -l ext -k /etc/krb5.keytab smtp/server.my.domain 
chown root:mail /etc/krb5.keytab 
chmod 640 /etc/krb5.keytab</pre>
<p>
Note that the keytab <i class="file">/etc/krb5.keytab</i> must be readable by the smtp server or authentication will fail. The location of this keytab file may be changed with the environment variable <span class="env">KRB5_KTNAME</span>. If postfix is the smtp server, note the <span class="emph">import_environment</span> parameter (see <a class="link-man" href="../5/postconf">postconf(5)</a>).<p>
On <span class="emph">client.my.domain</span> copy the keytab file from <i class="file">server.my.domain:/etc/krb5.keytab</i> to <i class="file">/etc/krb5.keytab</i>. Setup the <i class="file">/etc/saslc.d</i> configuration directory (see <i class="link-sec"><a class="link-sec" href="#x434f4e46494755524154494f4e">CONFIGURATION</a></i> above). Add the line<p>
<pre style="margin-left: 5.00ex;" class="lit display">
AUTHCID		"postfix"</pre>
<p>
to the file <i class="file">/etc/saslc.d/postfix/mech/GSSAPI.conf</i> so that the <span class="emph">postfix</span> principal will be used for authentication. Enable <span class="emph">SASL</span> in the smtp client. Assuming the smtp client is postfix, you will need to add the following to the <i class="file">/etc/postfix/main.cf</i> file to do this:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
smtp_sasl_auth_enable = yes 
smtp_sasl_type = saslc 
smtp_sasl_mechanism_filter = GSSAPI 
relayhost = [server.my.domain]:submission</pre>
<p>
Here we have assumed the <span class="emph">submission</span> port is the port the server is listening to. Finally, as <span class="emph">root</span>, run the command<p>
<pre style="margin-left: 5.00ex;" class="lit display">
su -m postfix -c kinit</pre>
<p>
to obtain a ticket for the postfix user with the postfix credential and you should be good to go!</div>
<div class="section">
<h1 id="x46494c4553">FILES</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="file">/etc/saslc.d</i></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
</dd>
</dl>
</div>
<div class="section">
<h1 id="x4558414d504c4553">EXAMPLES</h1> The following code fragments illustrate the possible use of the functions described above.<p>
<pre style="margin-left: 0.00ex;" class="lit display">
int 
decode_stream(saslc_sess_t *sess, int fdin, int fdout) 
{ 
	uint8_t buf[BUFSIZE]; 
	uint8_t *in; 
	void *out; 
	size_t inlen, outlen; 
	ssize_t n, rval; 
<p>
	for (;;) { 
		if ((rval = read(fdin, buf, sizeof(buf))) == &#45;1) 
			return &#45;1; 
		if (rval == 0) 
			break; 
		in = buf; 
		inlen = rval; 
		while (inlen &gt; 0) { 
			rval = saslc_sess_decode(sess, in, inlen, &amp;out, 
			    &amp;outlen); 
			if (rval == &#45;1) 
				return &#45;1; 
			if (outlen &gt; 0) { 
				n = write(fdout, out, outlen); 
				free(out); 
				if (n == &#45;1) 
					return &#45;1; 
			} 
			in += rval; 
			inlen -= rval; 
		} 
	} 
	return 0; 
} 
<p>
int 
encode_stream(saslc_sess_t *sess, int fdin, int fdout) 
{ 
	uint8_t buf[BUFSIZE]; 
	uint8_t *in; 
	void *out; 
	size_t inlen, outlen; 
	ssize_t n, rval; 
<p>
	for (;;) { 
		if ((rval = read(fdin, buf, sizeof(buf))) == &#45;1) 
			return &#45;1; 
		if (rval == 0) 
			break; 
		in = buf; 
		inlen = rval; 
		while (inlen &gt; 0) { 
			rval = saslc_sess_encode(sess, in, inlen, &amp;out, 
			    &amp;outlen); 
			if (rval == &#45;1) 
				return &#45;1; 
			if (outlen &gt; 0) { 
				n = write(fdout, out, outlen); 
				free(out); 
				if (n == &#45;1) 
					return &#45;1; 
			} 
			in += rval; 
			inlen -= rval; 
		} 
	} 
	/* flush internal encoder buffer */ 
	if (saslc_sess_encode(sess, NULL, 0, &amp;out, &amp;outlen) == &#45;1) 
		return &#45;1; 
	if (outlen &gt; 0) 
		if (write(fdout, out, outlen) == &#45;1) 
			return &#45;1; 
	return 0; 
}</pre>
</div>
<div class="section">
<h1 id="x434f4d5041544942494c495459">COMPATIBILITY</h1> There exist other SASL client library implementations including Cyrus SASL (http://asg.web.cmu.edu/sasl/sasl-library) and GNU SASL (http://www.gnu.org/software/gsasl/).</div>
<div class="section">
<h1 id="x5354414e4441524453">STANDARDS</h1> RFC 2195, RFC 2222, RFC 2245, RFC 2595, RFC 2831, RFC 4422, RFC 4505, RFC 4616, RFC 4752.</div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="name">libsaslc</b> library appeared in <span class="unix">NetBSD&#160;6.0</span>.</div>
<div class="section">
<h1 id="x43415645415453">CAVEATS</h1> The API was heavily influenced by its use with <a class="link-man" href="../1/postfix">postfix(1)</a>.<p>
Currently the ANONYMOUS, LOGIN, PLAIN, CRAM-MD5, DIGEST-MD5, and GSSAPI mechanisms have been tested and shown to work for authentication with a <a class="link-man" href="../1/postfix">postfix(1)</a> SMTP server using the cyrus-sasl library. LOGIN, PLAIN, CRAM-MD5, and DIGEST-MD5 have also been tested and shown to work with a <a class="link-man" href="../1/postfix">postfix(1)</a> SMTP server using a dovecot backend for authentication. The DIGEST-MD5 and GSSAPI specs also provide for integrity and confidentiality layers via the <b class="fname">saslc_sess_encode</b>() and <b class="fname">saslc_sess_decode</b>() routines, but these have not yet been tested against any servers.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
September 23, 2011</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

