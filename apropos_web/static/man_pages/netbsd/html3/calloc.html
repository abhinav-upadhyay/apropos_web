<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/../4/strict.dtd">
>
<head>
<meta http-equiv="Content-Type" content="te../; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
MALLOC(3)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
MALLOC(3)</td>
<td class="head-vol" align="center">
Library Functions Manual</td>
<td class="head-rtitle" align="right">
MALLOC(3)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">malloc</b>, <b class="name">calloc</b>, <b class="name">realloc</b>, <b class="name">free</b> &#8212; <span class="desc">general purpose memory allocation functions</span></div>
<div class="section">
<h1 id="x4c494252415259">LIBRARY</h1> <span class="lib">Standard C Library (libc, &#45;lc)</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">stdlib.h</a>&gt;</b><p>
<i class="ftype">void *</i><br>
<b class="fname">malloc</b>(<i class="farg" style="white-space:nowrap;">size_t size</i>);<p>
<i class="ftype">void *</i><br>
<b class="fname">calloc</b>(<i class="farg" style="white-space:nowrap;">size_t number</i>, <i class="farg" style="white-space:nowrap;">size_t size</i>);<p>
<i class="ftype">void *</i><br>
<b class="fname">realloc</b>(<i class="farg" style="white-space:nowrap;">void *ptr</i>, <i class="farg" style="white-space:nowrap;">size_t size</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">free</b>(<i class="farg" style="white-space:nowrap;">void *ptr</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="fname">malloc</b>() function allocates <i class="farg">size</i> bytes of uninitialized memory. The allocated space is suitably aligned (after possible pointer coercion) for storage of any type of object.<p>
The <b class="fname">calloc</b>() function allocates space for <i class="farg">number</i> objects, each <i class="farg">size</i> bytes in length. The result is identical to calling <b class="fname">malloc</b>() with an argument of &#8220;number * size&#8221;, with the exception that the allocated memory is explicitly initialized to zero bytes.<p>
The <b class="fname">realloc</b>() function changes the size of the previously allocated memory referenced by <i class="farg">ptr</i> to <i class="farg">size</i> bytes. The contents of the memory are unchanged up to the lesser of the new and old sizes. If the new size is larger, the value of the newly allocated portion of the memory is undefined. Upon success, the memory referenced by <i class="farg">ptr</i> is freed and a pointer to the newly allocated memory is returned.<p>
Note that <b class="fname">realloc</b>() may move the memory allocation, resulting in a different return value than <i class="farg">ptr</i>. If <i class="farg">ptr</i> is <span class="define">NULL</span>, the <b class="fname">realloc</b>() function behaves identically to <b class="fname">malloc</b>() for the specified size.<p>
The <b class="fname">free</b>() function causes the allocated memory referenced by <i class="farg">ptr</i> to be made available for future allocations. If <i class="farg">ptr</i> is <span class="define">NULL</span>, no action occurs.</div>
<div class="section">
<h1 id="x52455455524e2056414c554553">RETURN VALUES</h1> The <b class="fname">malloc</b>() and <b class="fname">calloc</b>() functions return a pointer to the allocated memory if successful; otherwise a <span class="define">NULL</span> pointer is returned and <b class="var">errno</b> is set to <span class="errno">ENOMEM</span>.<p>
The <b class="fname">realloc</b>() function returns a pointer, possibly identical to <i class="farg">ptr</i>, to the allocated memory if successful; otherwise a <span class="define">NULL</span> pointer is returned, and <b class="var">errno</b> is set to <span class="errno">ENOMEM</span> if the error was the result of an allocation failure. The <b class="fname">realloc</b>() function always leaves the original buffer intact when an error occurs.<p>
The <b class="fname">free</b>() function returns no value.</div>
<div class="section">
<h1 id="x4558414d504c4553">EXAMPLES</h1> When using <b class="fname">malloc</b>(), be careful to avoid the following idiom:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
if ((p = malloc(number * size)) == NULL) 
	err(EXIT_FAILURE, "malloc");</pre>
<p>
The multiplication may lead to an integer overflow. To avoid this, <a class="link-man" href="../3/reallocarr">reallocarr(3)</a> is recommended.<p>
If <b class="fname">malloc</b>() must be used, be sure to test for overflow:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
if (size &amp;&amp; number &gt; SIZE_MAX / size) { 
	errno = EOVERFLOW; 
	err(EXIT_FAILURE, "allocation"); 
}</pre>
<p>
The above test is not sufficient in all cases. For example, multiplying ints requires a different set of checks:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
int num, size; 
... 
 
/* Avoid invalid requests */ 
if (size &lt; 0 || num &lt; 0) 
	errc(1, EOVERFLOW, "overflow"); 
 
/* Check for signed int overflow */ 
if (size &amp;&amp; num &gt; INT_MAX / size) 
	errc(1, EOVERFLOW, "overflow"); 
 
if ((p = malloc(size * num)) == NULL) 
	err(1, "malloc");</pre>
<p>
Assuming the implementation checks for integer overflow as <span class="unix">NetBSD</span> does, it is much easier to use <b class="fname">calloc</b>() or <a class="link-man" href="../3/reallocarr">reallocarr(3)</a>.<p>
The above examples could be simplified to:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
ptr = NULL; 
if ((e = reallocarr(&amp;ptr, num, size))) 
	errx(1, "reallocarr", strerror(e));</pre>
<p>
<pre style="margin-left: 5.00ex;" class="lit display">
or at the cost of initialization: 
if ((p = calloc(num, size)) == NULL) 
	err(1, "calloc");</pre>
<p>
When using <b class="fname">realloc</b>(), one must be careful to avoid the following idiom:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
nsize += 50; 
 
if ((p = realloc(p, nsize)) == NULL) 
	return NULL;</pre>
<p>
Do not adjust the variable describing how much memory has been allocated until it is known that the allocation has been successful. This can cause aberrant program behavior if the incorrect size value is used. In most cases, the above example will also leak memory. As stated earlier, a return value of <span class="define">NULL</span> indicates that the old object still remains allocated. Better code looks like this:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
newsize = size + 50; 
 
if ((p2 = realloc(p, newsize)) == NULL) { 
 
	if (p != NULL) 
		free(p); 
 
	p = NULL; 
	return NULL; 
} 
 
p = p2; 
size = newsize;</pre>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../2/madvise">madvise(2)</a>, <a class="link-man" href="../2/mmap">mmap(2)</a>, <a class="link-man" href="../2/sbrk">sbrk(2)</a>, <a class="link-man" href="../3/alloca">alloca(3)</a>, <a class="link-man" href="../3/atexit">atexit(3)</a>, <a class="link-man" href="../3/getpagesize">getpagesize(3)</a>, <a class="link-man" href="../3/memory">memory(3)</a>, <a class="link-man" href="../3/posix_memalign">posix_memalign(3)</a>, <a class="link-man" href="../3/reallocarr">reallocarr(3)</a><p>
For the implementation details, see <a class="link-man" href="../3/jemalloc">jemalloc(3)</a>.</div>
<div class="section">
<h1 id="x5354414e4441524453">STANDARDS</h1> The <b class="fname">malloc</b>(), <b class="fname">calloc</b>(), <b class="fname">realloc</b>() and <b class="fname">free</b>() functions conform to ISO/IEC 9899:1990 (&#8220;ISO&#160;C90&#8221;).</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
February 5, 2015</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
<>

