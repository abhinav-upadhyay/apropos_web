<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="/static/man_pages/netbsd/style.css" type="text/css" media="all">
<title>
FLOCKFILE(3)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
FLOCKFILE(3)</td>
<td class="head-vol" align="center">
Library Functions Manual</td>
<td class="head-rtitle" align="right">
FLOCKFILE(3)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">flockfile</b>, <b class="name">ftrylockfile</b>, <b class="name">funlockfile</b> &#8212; <span class="desc">stdio stream locking functions</span></div>
<div class="section">
<h1 id="x4c494252415259">LIBRARY</h1> <span class="lib">Standard C Library (libc, &#45;lc)</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">stdio.h</a>&gt;</b><p>
<i class="ftype">void</i><br>
<b class="fname">flockfile</b>(<i class="farg" style="white-space:nowrap;">FILE *file</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">ftrylockfile</b>(<i class="farg" style="white-space:nowrap;">FILE *file</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">funlockfile</b>(<i class="farg" style="white-space:nowrap;">FILE *file</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="fname">flockfile</b>(), <b class="fname">ftrylockfile</b>(), and <b class="fname">funlockfile</b>() functions provide applications with explicit control of locking of stdio stream objects. They can be used by a thread to execute a sequence of I/O operations as a unit, without interference from another thread.<p>
Locks on stdio streams are recursive, and a lock count is maintained. stdio streams are created unlocked, with a lock count of zero. After successful acquisition of the lock, its count is incremented to one, indicating locked state of the stdio stream. Each subsequent relock operation performed by the owner thread increments the lock count by one, and each subsequent unlock operation performed by the owner thread decrements the lock count by one, allowing matching lock and unlock operations to be nested. After its lock count is decremented to zero, the stdio stream returns to unlocked state, and ownership of the stdio stream is relinquished.<p>
The <b class="fname">flockfile</b>() function acquires the ownership of <i class="farg">file</i> for the calling thread. If <i class="farg">file</i> is already owned by another thread, the calling thread is suspended until the acquisition is possible (i.e., <i class="farg">file</i> is relinquished again and the calling thread is scheduled to acquire it).<p>
The <b class="fname">ftrylockfile</b>() function acquires the ownership of <i class="farg">file</i> for the calling thread only if <i class="farg">file</i> is available.<p>
The <b class="fname">funlockfile</b>() function relinquishes the ownership of <i class="farg">file</i> previously granted to the calling thread. Only the current owner of <i class="farg">file</i> may <b class="fname">funlockfile</b>() it.</div>
<div class="section">
<h1 id="x52455455524e2056414c554553">RETURN VALUES</h1> If successful, the <b class="fname">ftrylockfile</b>() function returns 0. Otherwise, it returns non-zero to indicate that the lock cannot be acquired.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../2/flock">flock(2)</a>, <a class="link-man" href="../3/getc_unlocked">getc_unlocked(3)</a>, <a class="link-man" href="../3/getchar_unlocked">getchar_unlocked(3)</a>, <a class="link-man" href="../3/lockf">lockf(3)</a>, <a class="link-man" href="../3/putc_unlocked">putc_unlocked(3)</a>, <a class="link-man" href="../3/putchar_unlocked">putchar_unlocked(3)</a></div>
<div class="section">
<h1 id="x5354414e4441524453">STANDARDS</h1> The <b class="fname">flockfile</b>(), <b class="fname">ftrylockfile</b>() and <b class="fname">funlockfile</b>() functions conform to IEEE Std 1003.1-2001 (&#8220;POSIX.1&#8221;).</div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="fname">flockfile</b>() function first appeared in <span class="unix">FreeBSD&#160;2.0</span>.</div>
<div class="section">
<h1 id="x42554753">BUGS</h1> The design of these interfaces does not allow for addressing the problem of priority inversion.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
October 15, 2011</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

