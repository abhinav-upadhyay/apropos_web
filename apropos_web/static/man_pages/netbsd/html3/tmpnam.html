<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="/static/man_pages/netbsd/style.css" type="text/css" media="all">
<title>
TMPFILE(3)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
TMPFILE(3)</td>
<td class="head-vol" align="center">
Library Functions Manual</td>
<td class="head-rtitle" align="right">
TMPFILE(3)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">tempnam</b>, <b class="name">tmpfile</b>, <b class="name">tmpnam</b> &#8212; <span class="desc">temporary file routines</span></div>
<div class="section">
<h1 id="x4c494252415259">LIBRARY</h1> <span class="lib">Standard C Library (libc, &#45;lc)</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">stdio.h</a>&gt;</b><p>
<i class="ftype">FILE *</i><br>
<b class="fname">tmpfile</b>(<i class="farg" style="white-space:nowrap;">void</i>);<p>
<i class="ftype">char *</i><br>
<b class="fname">tmpnam</b>(<i class="farg" style="white-space:nowrap;">char *str</i>);<p>
<i class="ftype">char *</i><br>
<b class="fname">tempnam</b>(<i class="farg" style="white-space:nowrap;">const char *tmpdir</i>, <i class="farg" style="white-space:nowrap;">const char *prefix</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="fname">tmpfile</b>() function returns a pointer to a stream associated with a file descriptor returned by the routine <a class="link-man" href="../3/mkstemp">mkstemp(3)</a>. The created file is unlinked before <b class="fname">tmpfile</b>() returns, causing the file to be automatically deleted when the last reference to it is closed. The file is opened with the access value &#8216;<code class="lit">w+</code>&#8217;.<p>
The <b class="fname">tmpnam</b>() function returns a pointer to a file name, in the <span class="define">P_tmpdir</span> directory, which did not reference an existing file at some indeterminate point in the past. <span class="define">P_tmpdir</span> is defined in the include file <b class="includes">&lt;<a class="link-includes">stdio.h</a>&gt;</b>. If the argument <i class="farg">s</i> is non-<span class="define">NULL</span>, the file name is copied to the buffer it references. Otherwise, the file name is copied to a static buffer. In either case, <b class="fname">tmpnam</b>() returns a pointer to the file name.<p>
The buffer referenced by <i class="farg">s</i> is expected to be at least <span class="define">L_tmpnam</span> bytes in length. <span class="define">L_tmpnam</span> is defined in the include file <b class="includes">&lt;<a class="link-includes">stdio.h</a>&gt;</b>.<p>
The <b class="fname">tempnam</b>() function is similar to <b class="fname">tmpnam</b>(), but provides the ability to specify the directory which will contain the temporary file and the file name prefix.<p>
The environment variable <span class="env">TMPDIR</span> (if set), the argument <i class="farg">tmpdir</i> (if non-<span class="define">NULL</span>), the directory <span class="define">P_tmpdir</span>, and the directory <i class="file">/tmp</i> are tried, in the listed order, as directories in which to store the temporary file.<p>
The argument <i class="farg">prefix</i>, if non-<span class="define">NULL</span>, is used to specify a file name prefix, which will be the first part of the created file name. <b class="fname">tempnam</b>() allocates memory in which to store the file name; the returned pointer may be used as a subsequent argument to <a class="link-man" href="../3/free">free(3)</a>.</div>
<div class="section">
<h1 id="x52455455524e2056414c554553">RETURN VALUES</h1> The <b class="fname">tmpfile</b>() function returns a pointer to an open file stream on success, and a <span class="define">NULL</span> pointer on error.<p>
The <b class="fname">tmpnam</b>() and <b class="fname">tempnam</b>() functions return a pointer to a file name on success, and a <span class="define">NULL</span> pointer on error.</div>
<div class="section">
<h1 id="x4552524f5253">ERRORS</h1> The <b class="fname">tmpfile</b>() function may fail and set the global variable <b class="var">errno</b> for any of the errors specified for the library functions <a class="link-man" href="../3/fdopen">fdopen(3)</a> or <a class="link-man" href="../3/mkstemp">mkstemp(3)</a>.<p>
The <b class="fname">tmpnam</b>() function may fail and set <b class="var">errno</b> for any of the errors specified for the library function <a class="link-man" href="../3/mktemp">mktemp(3)</a>.<p>
The <b class="fname">tempnam</b>() function may fail and set <b class="var">errno</b> for any of the errors specified for the library functions <a class="link-man" href="../3/malloc">malloc(3)</a> or <a class="link-man" href="../3/mktemp">mktemp(3)</a>.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../3/mkstemp">mkstemp(3)</a>, <a class="link-man" href="../3/mktemp">mktemp(3)</a></div>
<div class="section">
<h1 id="x5354414e4441524453">STANDARDS</h1> The <b class="fname">tmpfile</b>() and <b class="fname">tmpnam</b>() functions conform to ANSI X3.159-1989 (&#8220;ANSI&#160;C89&#8221;). All described functions also conform to IEEE Std 1003.1-2001 (&#8220;POSIX.1&#8221;), albeit the <b class="fname">tempnam</b>() and <b class="fname">tmpnam</b>() functions have been marked as obsolete in the IEEE Std 1003.1-2008 (&#8220;POSIX.1&#8221;) revision.</div>
<div class="section">
<h1 id="x42554753">BUGS</h1> These interfaces are provided for AT&amp;T System&#160;V UNIX and ANSI compatibility only. The <a class="link-man" href="../3/mkstemp">mkstemp(3)</a> interface is strongly preferred.</div>
<div class="section">
<h1 id="x534543555249545920434f4e53494445524154494f4e53">SECURITY CONSIDERATIONS</h1> There are four important problems with these interfaces (as well as with the historic <a class="link-man" href="../3/mktemp">mktemp(3)</a> interface). First, there is an obvious race between file name selection and file creation and deletion: the program is typically written to call <b class="fname">tmpnam</b>(), <b class="fname">tempnam</b>(), or <a class="link-man" href="../3/mktemp">mktemp(3)</a>. Subsequently, the program calls <a class="link-man" href="../2/open">open(2)</a> or <a class="link-man" href="../3/fopen">fopen(3)</a> and erroneously opens a file (or symbolic link, or fifo or other device) that the attacker has placed in the expected file location. Hence <a class="link-man" href="../3/mkstemp">mkstemp(3)</a> is recommended, since it atomically creates the file.<p>
Second, most historic implementations provide only a limited number of possible temporary file names (usually 26) before file names will start being recycled. Third, the AT&amp;T System&#160;V UNIX implementations of these functions (and of <a class="link-man" href="../3/mktemp">mktemp(3)</a>) use the <a class="link-man" href="../2/access">access(2)</a> system call to determine whether or not the temporary file may be created. This has obvious ramifications for setuid or setgid programs, complicating the portable use of these interfaces in such programs. Finally, there is no specification of the permissions with which the temporary files are created.<p>
This implementation of <b class="fname">tmpfile</b>() does not have these flaws, and that of <b class="fname">tmpnam</b>() and <b class="fname">tempnam</b>() only have the first limitation, but portable software cannot depend on that. In particular, the <b class="fname">tmpfile</b>() interface should not be used in software expected to be used on other systems if there is any possibility that the user does not wish the temporary file to be publicly readable and writable.<p>
A link-time warning will be issued if <b class="fname">tmpnam</b>() or <b class="fname">tempnam</b>() is used, and advises the use of <b class="fname">mkstemp</b>() instead.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
April 30, 2010</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

