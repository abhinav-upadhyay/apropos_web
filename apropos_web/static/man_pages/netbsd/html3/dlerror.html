<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="/static/man_pages/netbsd/style.css" type="text/css" media="all">
<title>
DLFCN(3)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
DLFCN(3)</td>
<td class="head-vol" align="center">
Library Functions Manual</td>
<td class="head-rtitle" align="right">
DLFCN(3)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">dlopen</b>, <b class="name">dlclose</b>, <b class="name">dlsym</b>, <b class="name">dlvsym</b>, <b class="name">dladdr</b>, <b class="name">dlctl</b>, <b class="name">dlerror</b> &#8212; <span class="desc">dynamic link interface</span></div>
<div class="section">
<h1 id="x4c494252415259">LIBRARY</h1> (These functions are not in a library. They are included in every dynamically linked program automatically.)</div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">dlfcn.h</a>&gt;</b><p>
<i class="ftype">void *</i><br>
<b class="fname">dlopen</b>(<i class="farg" style="white-space:nowrap;">const char *path</i>, <i class="farg" style="white-space:nowrap;">int mode</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">dlclose</b>(<i class="farg" style="white-space:nowrap;">void *handle</i>);<p>
<i class="ftype">void *</i><br>
<b class="fname">dlsym</b>(<i class="farg" style="white-space:nowrap;">void * restrict handle</i>, <i class="farg" style="white-space:nowrap;">const char * restrict symbol</i>);<p>
<i class="ftype">void *</i><br>
<b class="fname">dlvsym</b>(<i class="farg" style="white-space:nowrap;">void * restrict handle</i>, <i class="farg" style="white-space:nowrap;">const char * restrict symbol</i>, <i class="farg" style="white-space:nowrap;">const char *version</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">dladdr</b>(<i class="farg" style="white-space:nowrap;">void * restrict addr</i>, <i class="farg" style="white-space:nowrap;">Dl_info * restrict dli</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">dlctl</b>(<i class="farg" style="white-space:nowrap;">void *handle</i>, <i class="farg" style="white-space:nowrap;">int cmd</i>, <i class="farg" style="white-space:nowrap;">void *data</i>);<p>
<i class="ftype">char *</i><br>
<b class="fname">dlerror</b>(<i class="farg" style="white-space:nowrap;">void</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> These functions provide an interface to the run-time linker <a class="link-man" href="../1/ld.so">ld.so(1)</a>. They allow new shared objects to be loaded into the process' address space under program control.<p>
The <b class="fname">dlopen</b>() function takes the name of a shared object as the first argument. The <i class="farg">path</i> argument can be specified as either an absolute pathname to a shared object or just the name of the shared object itself. When an absolute pathname is specified, only the path provided will be searched. When just a shared object name is specified, the same search rules apply that are used for &#8220;intrinsic&#8221; shared object searches. (see <a class="link-man" href="../1/ld.elf_so">ld.elf_so(1)</a>)<p>
Shared libraries take the following form: &#8220;lib&#60;name&#62;.so&#91;<span class="opt">.xx&#91;<span class="opt">.yy</span>&#93;</span>&#93;&#8221;.<p>
The shared object is mapped into the address space, relocated, and its external references are resolved in the same way as is done with the implicitly loaded shared libraries at program startup.<p>
If the first argument is <span class="define">NULL</span>, <b class="fname">dlopen</b>() returns a <i class="farg">handle</i> on the global symbol object. This object provides access to all symbols from an ordered set of objects consisting of the original program image and any dependencies loaded during startup.<p>
The <i class="farg">mode</i> parameter specifies symbol resolution time and symbol visibility. One of the following values may be used to specify symbol resolution time:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">RTLD_NOW</span></dt>
<dd class="list-tag" style="margin-left: 13.00ex;">
Symbols are resolved immediately.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">RTLD_LAZY</span></dt>
<dd class="list-tag" style="margin-left: 13.00ex;">
Symbols are resolved when they are first referred to. This is the default value if resolution time is unspecified.</dd>
</dl>
<p>
One of the following values may be used to specify symbol visibility:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">RTLD_GLOBAL</span></dt>
<dd class="list-tag" style="margin-left: 13.00ex;">
The object's symbols and the symbols of its dependencies will be visible to other objects.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">RTLD_LOCAL</span></dt>
<dd class="list-tag" style="margin-left: 13.00ex;">
The object's symbols and the symbols of its dependencies will not be visible to other objects. This is the default value if visibility is unspecified.</dd>
</dl>
<p>
To specify both resolution time and visibility, bitwise inclusive OR one of each of the above values together. If an object was opened with <span class="define">RTLD_LOCAL</span> and later opened with <span class="define">RTLD_GLOBAL</span>, then it is promoted to <span class="define">RTLD_GLOBAL</span>.<p>
Additionally, one of the following flags may be ORed into the <i class="farg">mode</i> argument:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">RTLD_NODELETE</span></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
Prevents unload of the loaded object on <b class="fname">dlclose</b>(). The same behaviour may be requested by <b class="flag">&#45;z nodelete</b> option of the static linker <a class="link-man" href="../1/ld">ld(1)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">RTLD_NOLOAD</span></dt>
<dd class="list-tag" style="margin-left: 15.00ex;">
Only return valid handle for the object if it is already loaded in the process address space, otherwise do not load the object and return <span class="define">NULL</span>.</dd>
</dl>
<p>
<b class="fname">dlopen</b>() returns a <i class="farg">handle</i> to be used in calls to <b class="fname">dlclose</b>(), <b class="fname">dlsym</b>(), <b class="fname">dlvsym</b>(), and <b class="fname">dlctl</b>(). If the named shared object has already been loaded by a previous call to <b class="fname">dlopen</b>() (and not yet unloaded by <b class="fname">dlclose</b>()), a <i class="farg">handle</i> referring to the resident copy is returned.<p>
<b class="fname">dlclose</b>() unlinks and removes the object referred to by <i class="farg">handle</i> from the process address space. If multiple calls to <b class="fname">dlopen</b>() have been done on this object, or the object was one loaded at startup time, or the object is a dependency of another object then the object is removed when its reference count drops to zero. <b class="fname">dlclose</b>() returns 0 on success and non-zero on failure.<p>
<b class="fname">dlsym</b>() looks for a definition of <i class="farg">symbol</i> in the shared object designated by <i class="farg">handle</i>, and all shared objects that are listed as dependencies. The symbol's address is returned. If the symbol cannot be resolved, <span class="define">NULL</span> is returned.<p>
<b class="fname">dlsym</b>() may also be called with special <i class="farg">handle</i> values. <b class="fname">dlsym</b>() respects symbol visibility as specified by the <b class="fname">dlopen</b>() <i class="farg">mode</i> parameter. However, the symbols of an object's dependencies are always visible to it. All shared objects loaded at program startup are globally visible. Only the symbols in the main executable that are referenced by a shared object at link time will be visible unless it has been linked with the --export-dynamic option where all of its symbols will be visible. The following special <i class="farg">handle</i> values may be used with <b class="fname">dlsym</b>():<dl style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">NULL</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
Interpreted as a reference to the executable or shared object from which the call is being made. Thus an object can reference its own symbols and the symbols of its dependencies without calling <b class="fname">dlopen</b>().</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">RTLD_DEFAULT</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
All the visible shared objects and the executable will be searched in the order they were loaded.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">RTLD_NEXT</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
The search for <i class="farg">symbol</i> is limited to the visible shared objects which were loaded after the one issuing the call to <b class="fname">dlsym</b>(). Thus, if <b class="fname">dlsym</b>() is called from the main program, all the visible shared libraries are searched. If it is called from a shared library, all subsequently visible shared libraries are searched.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">RTLD_SELF</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
The search for <i class="farg">symbol</i> is limited to the shared object issuing the call to <b class="fname">dlsym</b>() and those shared objects which were loaded after it that are visible.</dd>
</dl>
<p>
<b class="fname">dlvsym</b>() does the same as <b class="fname">dlsym</b>() but takes a <i class="farg">version</i> string as an additional argument. Both the <i class="farg">symbol</i> and the <i class="farg">version</i> must match in order for the symbol to be resolved.<p>
<b class="fname">dladdr</b>() examines all currently mapped shared objects for a symbol whose address -- as mapped in the process address space -- is closest to but not exceeding the value passed in the first argument <i class="farg">addr</i>. The symbols of a shared object are only eligible if <b class="var">addr</b> is between the base address of the shared object and the value of the symbol &#8220;_end&#8221; in the same shared object. If no object for which this condition holds true can be found, <b class="fname">dladdr</b>() will return 0. Otherwise, a non-zero value is returned and the <i class="farg">dli</i> argument will be used to provide information on the selected symbol and the shared object it is contained in. The <i class="farg">dli</i> argument points at a caller-provided <b class="var">Dl_info</b> structure defined as follows:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
typedef struct { 
	const char  *dli_fname;     /* File defining the symbol */ 
	void	    *dli_fbase;     /* Base address */ 
	const char  *dli_sname;     /* Symbol name */ 
	const void  *dli_saddr;     /* Symbol address */ 
} Dl_info;</pre>
<p>
The structure members are further described as follows:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<code class="lit">dli_fname</code></dt>
<dd class="list-tag" style="margin-left: 11.00ex;">
The pathname of the shared object containing the address <i class="farg">addr</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<code class="lit">dli_fbase</code></dt>
<dd class="list-tag" style="margin-left: 11.00ex;">
The base address at which this shared object is loaded in the process address space. This may be zero if the symbol was found in the internally generated &#8220;copy&#8221; section (see <a class="link-man" href="../5/link">link(5)</a>) which is not associated with a file.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<code class="lit">dli_sname</code></dt>
<dd class="list-tag" style="margin-left: 11.00ex;">
points at the nul-terminated name of the selected symbol</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<code class="lit">dli_saddr</code></dt>
<dd class="list-tag" style="margin-left: 11.00ex;">
is the actual address (as it appears in the process address space) of the symbol.</dd>
</dl>
<p>
Note: both strings pointed at by <b class="var">dli_fname</b> and <b class="var">dli_sname</b> reside in memory private to the run-time linker module and should not be modified by the caller.<p>
In dynamically linked programs, the address of a global function will point to its program linkage table entry, rather than to the entry point of the function itself. This causes most global functions to appear to be defined within the main executable, rather than in the shared libraries where the actual code resides.<p>
<b class="fname">dlctl</b>() provides an interface similar to <a class="link-man" href="../2/ioctl">ioctl(2)</a> to control several aspects of the run-time linker's operation. This interface is currently under development.<p>
<b class="fname">dlerror</b>() returns a character string representing the most recent error that has occurred while processing one of the other functions described here. If no dynamic linking errors have occurred since the last invocation of <b class="fname">dlerror</b>(), <b class="fname">dlerror</b>() returns <span class="define">NULL</span>. Thus, invoking <b class="fname">dlerror</b>() a second time, immediately following a prior invocation, will result in <span class="define">NULL</span> being returned.</div>
<div class="section">
<h1 id="x4552524f5253">ERRORS</h1> The error &#8220;Cannot dlopen non-loadable /usr/lib/libpthread.so.1&#8221; is generated when a program <b class="fname">dlopen</b>()s a module that needs libpthread but isn't linked against it itself.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../1/ld">ld(1)</a>, <a class="link-man" href="../1/rtld">rtld(1)</a>, <a class="link-man" href="../5/link">link(5)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> Some of the <b class="name">dl*</b> functions first appeared in SunOS 4.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
June 25, 2011</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

