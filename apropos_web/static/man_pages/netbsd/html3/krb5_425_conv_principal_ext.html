<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
KRB5_425_CONV_PRINCIPAL(3)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
KRB5_425_CONV_PRINCIPAL(3)</td>
<td class="head-vol" align="center">
Library Functions Manual</td>
<td class="head-rtitle" align="right">
KRB5_425_CONV_PRINCIPAL(3)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">krb5_425_conv_principal</b>, <b class="name">krb5_425_conv_principal_ext</b>, <b class="name">krb5_524_conv_principal</b> &#8212; <span class="desc">converts to and from version 4 principals</span></div>
<div class="section">
<h1 id="x4c494252415259">LIBRARY</h1> Kerberos 5 Library (libkrb5, -lkrb5)</div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">krb5/krb5.h</a>&gt;</b><p>
<i class="ftype">krb5_error_code</i><br>
<b class="fname">krb5_425_conv_principal</b>(<i class="farg" style="white-space:nowrap;">krb5_context context</i>, <i class="farg" style="white-space:nowrap;">const char *name</i>, <i class="farg" style="white-space:nowrap;">const char *instance</i>, <i class="farg" style="white-space:nowrap;">const char *realm</i>, <i class="farg" style="white-space:nowrap;">krb5_principal *principal</i>);<p>
<i class="ftype">krb5_error_code</i><br>
<b class="fname">krb5_425_conv_principal_ext</b>(<i class="farg" style="white-space:nowrap;">krb5_context context</i>, <i class="farg" style="white-space:nowrap;">const char *name</i>, <i class="farg" style="white-space:nowrap;">const char *instance</i>, <i class="farg" style="white-space:nowrap;">const char *realm</i>, <i class="farg" style="white-space:nowrap;">krb5_boolean (*func)(krb5_context, krb5_principal)</i>, <i class="farg" style="white-space:nowrap;">krb5_boolean resolve</i>, <i class="farg" style="white-space:nowrap;">krb5_principal *principal</i>);<p>
<i class="ftype">krb5_error_code</i><br>
<b class="fname">krb5_524_conv_principal</b>(<i class="farg" style="white-space:nowrap;">krb5_context context</i>, <i class="farg" style="white-space:nowrap;">const krb5_principal principal</i>, <i class="farg" style="white-space:nowrap;">char *name</i>, <i class="farg" style="white-space:nowrap;">char *instance</i>, <i class="farg" style="white-space:nowrap;">char *realm</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> Converting between version 4 and version 5 principals can at best be described as a mess.<p>
A version 4 principal consists of a name, an instance, and a realm. A version 5 principal consists of one or more components, and a realm. In some cases also the first component/name will differ between version 4 and version 5.  Furthermore the second component of a host principal will be the fully qualified domain name of the host in question, while the instance of a version 4 principal will only contain the first part (short hostname).  Because of these problems the conversion between principals will have to be site customized.<p>
<b class="fname">krb5_425_conv_principal_ext</b>() will try to convert a version 4 principal, given by <i class="farg">name</i>, <i class="farg">instance</i>, and <i class="farg">realm</i>, to a version 5 principal. This can result in several possible principals, and if <i class="farg">func</i> is non-NULL, it will be called for each candidate principal. <i class="farg">func</i> should return true if the principal was &#8220;good&#8221;. To accomplish this, <b class="fname">krb5_425_conv_principal_ext</b>() will look up the name in <i class="file">krb5.conf</i>. It first looks in the <code class="lit">v4_name_convert/host</code> subsection, which should contain a list of version 4 names whose instance should be treated as a hostname. This list can be specified for each realm (in the <code class="lit">realms</code> section), or in the <code class="lit">libdefaults</code> section.  If the name is found the resulting name of the principal will be the value of this binding. The instance is then first looked up in <code class="lit">v4_instance_convert</code> for the specified realm. If found the resulting value will be used as instance (this can be used for special cases), no further attempts will be made to find a conversion if this fails (with <i class="farg">func</i>). If the <i class="farg">resolve</i> parameter is true, the instance will be looked up with <b class="fname">gethostbyname</b>(). This can be a time consuming, error prone, and unsafe operation.  Next a list of hostnames will be created from the instance and the <code class="lit">v4_domains</code> variable, which should contain a list of possible domains for the specific realm.<p>
On the other hand, if the name is not found in a <code class="lit">host</code> section, it is looked up in a <code class="lit">v4_name_convert/plain</code> binding. If found here the name will be converted, but the instance will be untouched.<p>
This list of default host-type conversions is compiled-in:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
v4_name_convert = { 
	host = { 
		ftp = ftp 
		hprop = hprop 
		imap = imap 
		pop = pop 
		rcmd = host 
		smtp = smtp 
	} 
}</pre>
<p>
It will only be used if there isn't an entry for these names in the config file, so you can override these defaults.<p>
<b class="fname">krb5_425_conv_principal</b>() will call <b class="fname">krb5_425_conv_principal_ext</b>() with <span class="define">NULL</span> as <i class="farg">func</i>, and the value of <code class="lit">v4_instance_resolve</code> (from the <code class="lit">libdefaults</code> section) as <i class="farg">resolve</i>.<p>
<b class="fname">krb5_524_conv_principal</b>() basically does the opposite of <b class="fname">krb5_425_conv_principal</b>(), it just doesn't have to look up any names, but will instead truncate instances found to belong to a host principal. The <i class="farg">name</i>, <i class="farg">instance</i>, and <i class="farg">realm</i> should be at least 40 characters long.</div>
<div class="section">
<h1 id="x4558414d504c4553">EXAMPLES</h1> Since this is confusing an example is in place.<p>
Assume that we have the &#8220;foo.com&#8221;, and &#8220;bar.com&#8221; domains that have shared a single version 4 realm, FOO.COM. The version 4 <i class="file">krb.realms</i> file looked like:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
foo.com		FOO.COM 
.foo.com	FOO.COM 
.bar.com	FOO.COM</pre>
<p>
A <i class="file">krb5.conf</i> file that covers this case might look like:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
[libdefaults] 
	v4_instance_resolve = yes 
[realms] 
	FOO.COM = { 
		kdc = kerberos.foo.com 
		v4_instance_convert = { 
			foo = foo.com 
		} 
		v4_domains = foo.com 
	}</pre>
<p>
With this setup and the following host table:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
foo.com 
a-host.foo.com 
b-host.bar.com</pre>
the following conversions will be made:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
rcmd.a-host	-&gt; host/a-host.foo.com 
ftp.b-host	-&gt; ftp/b-host.bar.com 
pop.foo		-&gt; pop/foo.com 
ftp.other	-&gt; ftp/other.foo.com 
other.a-host	-&gt; other/a-host</pre>
<p>
The first three are what you expect. If you remove the &#8220;v4_domains&#8221;, the fourth entry will result in an error (since the host &#8220;other&#8221; can't be found). Even if &#8220;a-host&#8221; is a valid host name, the last entry will not be converted, since the &#8220;other&#8221; name is not known to represent a host-type principal. If you turn off &#8220;v4_instance_resolve&#8221; the second example will result in &#8220;ftp/b-host.foo.com&#8221; (because of the default domain). And all of this is of course only valid if you have working name resolving.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html3/krb5_build_principal.html">krb5_build_principal(3)</a>, <a class="link-man" href="../html3/krb5_free_principal.html">krb5_free_principal(3)</a>, <a class="link-man" href="../html3/krb5_parse_name.html">krb5_parse_name(3)</a>, <a class="link-man" href="../html3/krb5_sname_to_principal.html">krb5_sname_to_principal(3)</a>, <a class="link-man" href="../html3/krb5_unparse_name.html">krb5_unparse_name(3)</a>, <a class="link-man" href="../html5/krb5.conf.html">krb5.conf(5)</a></div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
September 3, 2003</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

