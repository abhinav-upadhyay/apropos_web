<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
FENV(3)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
FENV(3)</td>
<td class="head-vol" align="center">
Library Functions Manual</td>
<td class="head-rtitle" align="right">
FENV(3)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">feclearexcept</b>, <b class="name">fegetexceptflag</b>, <b class="name">feraiseexcept</b>, <b class="name">fesetexceptflag</b>, <b class="name">fetestexcept</b>, <b class="name">fegetround</b>, <b class="name">fesetround</b>, <b class="name">fegetenv</b>, <b class="name">feholdexcept</b>, <b class="name">fesetenv</b>, <b class="name">feupdateenv</b>, <b class="name">feenableexcept</b>, <b class="name">fedisableexcept</b>, <b class="name">fegetexcept</b> &#8212; <span class="desc">floating-point environment control</span></div>
<div class="section">
<h1 id="x4c494252415259">LIBRARY</h1> <span class="lib">Math Library (libm, &#45;lm)</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">fenv.h</a>&gt;</b><p>
<b class="macro">#pragma STDC FENV_ACCESS ON</b><p>
<i class="ftype">int</i><br>
<b class="fname">feclearexcept</b>(<i class="farg" style="white-space:nowrap;">int excepts</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">fegetexceptflag</b>(<i class="farg" style="white-space:nowrap;">fexcept_t *flagp</i>, <i class="farg" style="white-space:nowrap;">int excepts</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">feraiseexcept</b>(<i class="farg" style="white-space:nowrap;">int excepts</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">fesetexceptflag</b>(<i class="farg" style="white-space:nowrap;">const fexcept_t *flagp</i>, <i class="farg" style="white-space:nowrap;">int excepts</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">fetestexcept</b>(<i class="farg" style="white-space:nowrap;">int excepts</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">fegetround</b>(<i class="farg" style="white-space:nowrap;">void</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">fesetround</b>(<i class="farg" style="white-space:nowrap;">int round</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">fegetenv</b>(<i class="farg" style="white-space:nowrap;">fenv_t *envp</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">feholdexcept</b>(<i class="farg" style="white-space:nowrap;">fenv_t *envp</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">fesetenv</b>(<i class="farg" style="white-space:nowrap;">const fenv_t *envp</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">feupdateenv</b>(<i class="farg" style="white-space:nowrap;">const fenv_t *envp</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">feenableexcept</b>(<i class="farg" style="white-space:nowrap;">int excepts</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">fedisableexcept</b>(<i class="farg" style="white-space:nowrap;">int excepts</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">fegetexcept</b>(<i class="farg" style="white-space:nowrap;">void</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="includes">&lt;<a class="link-includes">fenv.h</a>&gt;</b> routines manipulate the floating-point environment, which includes the exception flags and rounding modes defined in IEEE Std 754-1985.<div class="subsection">
<h2 id="x457863657074696f6e73">Exceptions</h2> Exception flags are set as side-effects of floating-point arithmetic operations and math library routines, and they remain set until explicitly cleared. The following macros expand to bit flags of type <span class="type">int</span> representing the five standard floating-point exceptions.<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">FE_DIVBYZERO</span></dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
A divide-by-zero exception occurs when the program attempts to divide a finite non-zero number by zero.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">FE_INEXACT</span></dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
An inexact exception is raised whenever there is a loss of precision due to rounding.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">FE_INVALID</span></dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
Invalid operation exceptions occur when a program attempts to perform calculations for which there is no reasonable representable answer. For instance, subtraction of infinities, division of zero by zero, ordered comparison involving NaNs, and taking the square root of a negative number are all invalid operations.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">FE_OVERFLOW</span></dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
An overflow exception occurs when the magnitude of the result of a computation is too large to fit in the destination type.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">FE_UNDERFLOW</span></dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
Underflow occurs when the result of a computation is too close to zero to be represented as a non-zero value in the destination type.</dd>
</dl>
<p>
Additionally, the <span class="define">FE_ALL_EXCEPT</span> macro expands to the bitwise OR of the above flags and any architecture-specific flags. Combinations of these flags are passed to the <b class="fname">feclearexcept</b>(), <b class="fname">fegetexceptflag</b>(), <b class="fname">feraiseexcept</b>(), <b class="fname">fesetexceptflag</b>(), and <b class="fname">fetestexcept</b>() functions to clear, save, raise, restore, and examine the processor's floating-point exception flags, respectively.<p>
Exceptions may be <span class="emph">unmasked</span> with <b class="fname">feenableexcept</b>() and masked with <b class="fname">fedisableexcept</b>(). Unmasked exceptions cause a trap when they are produced, and all exceptions are masked by default. The current mask can be tested with <b class="fname">fegetexcept</b>().</div>
<div class="subsection">
<h2 id="x526f756e64696e67204d6f646573">Rounding Modes</h2> IEEE Std 754-1985 specifies four rounding modes. These modes control the direction in which results are rounded from their exact values in order to fit them into binary floating-point variables. The four modes correspond with the following symbolic constants.<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">FE_TONEAREST</span></dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
Results are rounded to the closest representable value. If the exact result is exactly half way between two representable values, the value whose last binary digit is even (zero) is chosen. This is the default mode.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">FE_DOWNWARD</span></dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
Results are rounded towards negative infinity.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">FE_UPWARD</span></dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
Results are rounded towards positive infinity.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">FE_TOWARDZERO</span></dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
Results are rounded towards zero.</dd>
</dl>
<p>
The <b class="fname">fegetround</b>() and <b class="fname">fesetround</b>() functions query and set the rounding mode.</div>
<div class="subsection">
<h2 id="x456e7669726f6e6d656e7420436f6e74726f6c">Environment Control</h2> The <b class="fname">fegetenv</b>() and <b class="fname">fesetenv</b>() functions save and restore the floating-point environment, which includes exception flags, the current exception mask, the rounding mode, and possibly other implementation-specific state. The <b class="fname">feholdexcept</b>() function behaves like <b class="fname">fegetenv</b>(), but with the additional effect of clearing the exception flags and installing a <span class="emph">non-stop</span> mode. In non-stop mode, floating-point operations will set exception flags as usual, but no <span class="define">SIGFPE</span> signals will be generated as a result. Non-stop mode is the default, but it may be altered by non-standard mechanisms. The <b class="fname">feupdateenv</b>() function restores a saved environment similarly to <b class="fname">fesetenv</b>(), but it also re-raises any floating-point exceptions from the old environment.<p>
The macro <span class="define">FE_DFL_ENV</span> expands to a pointer to the default environment.</div>
</div>
<div class="section">
<h1 id="x4558414d504c4553">EXAMPLES</h1> The following routine computes the square root function. It explicitly raises an invalid exception on appropriate inputs using <b class="fname">feraiseexcept</b>(). It also defers inexact exceptions while it computes intermediate values, and then it allows an inexact exception to be raised only if the final answer is inexact.<p>
<pre style="margin-left: 5.00ex;" class="lit display">
#pragma STDC FENV_ACCESS ON 
double sqrt(double n) { 
	double x = 1.0; 
	fenv_t env; 
 
	if (isnan(n) || n &lt; 0.0) { 
		feraiseexcept(FE_INVALID); 
		return (NAN); 
	} 
	if (isinf(n) || n == 0.0) 
		return (n); 
	feholdexcept(&amp;env); 
	while (fabs((x * x) - n) &gt; DBL_EPSILON * 2 * x) 
		x = (x / 2) + (n / (2 * x)); 
	if (x * x == n) 
		feclearexcept(FE_INEXACT); 
	feupdateenv(&amp;env); 
	return (x); 
}</pre>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../1/c99">c99(1)</a>, <a class="link-man" href="../3/feclearexcept">feclearexcept(3)</a>, <a class="link-man" href="../3/fedisableexcept">fedisableexcept(3)</a>, <a class="link-man" href="../3/feenableexcept">feenableexcept(3)</a>, <a class="link-man" href="../3/fegetenv">fegetenv(3)</a>, <a class="link-man" href="../3/fegetexcept">fegetexcept(3)</a>, <a class="link-man" href="../3/fegetexceptflag">fegetexceptflag(3)</a>, <a class="link-man" href="../3/fegetround">fegetround(3)</a>, <a class="link-man" href="../3/feholdexcept">feholdexcept(3)</a>, <a class="link-man" href="../3/feraiseexcept">feraiseexcept(3)</a>, <a class="link-man" href="../3/fesetenv">fesetenv(3)</a>, <a class="link-man" href="../3/fesetexceptflag">fesetexceptflag(3)</a>, <a class="link-man" href="../3/fesetround">fesetround(3)</a>, <a class="link-man" href="../3/fetestexcept">fetestexcept(3)</a>, <a class="link-man" href="../3/feupdateenv">feupdateenv(3)</a></div>
<div class="section">
<h1 id="x5354414e4441524453">STANDARDS</h1> Except as noted below, <b class="includes">&lt;<a class="link-includes">fenv.h</a>&gt;</b> conforms to ISO/IEC 9899:1999 (&#8220;ISO&#160;C99&#8221;). The <b class="fname">feenableexcept</b>(), <b class="fname">fedisableexcept</b>(), and <b class="fname">fegetexcept</b>() routines are extensions.</div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="includes">&lt;<a class="link-includes">fenv.h</a>&gt;</b> header first appeared in <span class="unix">FreeBSD&#160;5.3</span> and <span class="unix">NetBSD&#160;6.0</span>. It supersedes the non-standard routines defined in <b class="includes">&lt;<a class="link-includes">ieeefp.h</a>&gt;</b> and documented in <a class="link-man" href="../3/fpgetround">fpgetround(3)</a>.</div>
<div class="section">
<h1 id="x43415645415453">CAVEATS</h1> The FENV_ACCESS pragma can be enabled with<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit">#pragma STDC FENV_ACCESS ON</code></div>
</blockquote>
and disabled with the<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit">#pragma STDC FENV_ACCESS OFF</code></div>
</blockquote>
directive. This lexically-scoped annotation tells the compiler that the program may access the floating-point environment, so optimizations that would violate strict IEEE-754 semantics are disabled. If execution reaches a block of code for which <span class="define">FENV_ACCESS</span> is off, the floating-point environment will become undefined.</div>
<div class="section">
<h1 id="x42554753">BUGS</h1> The <span class="define">FENV_ACCESS</span> pragma is unimplemented in the system compiler. However, non-constant expressions generally produce the correct side-effects at low optimization levels.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
March 16, 2005</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

