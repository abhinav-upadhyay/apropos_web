<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="/static/man_pages/netbsd/style.css" type="text/css" media="all">
<title>
ELF_UPDATE(3)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
ELF_UPDATE(3)</td>
<td class="head-vol" align="center">
Library Functions Manual</td>
<td class="head-rtitle" align="right">
ELF_UPDATE(3)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">elf_update</b> &#8212; <span class="desc">update an ELF descriptor</span></div>
<div class="section">
<h1 id="x4c494252415259">LIBRARY</h1> <span class="lib">ELF Access Library (libelf, &#45;lelf)</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">libelf.h</a>&gt;</b><p>
<i class="ftype">off_t</i><br>
<b class="fname">elf_update</b>(<i class="farg" style="white-space:nowrap;">Elf *elf</i>, <i class="farg" style="white-space:nowrap;">Elf_Cmd cmd</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> Function <b class="fname">elf_update</b>() causes the library to recalculate the structure of an ELF object and optionally write out the image of the object to file.<p>
Argument <i class="arg">elf</i> should reference a valid ELF descriptor.<p>
Argument <i class="arg">cmd</i> can be one of the following values:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">ELF_C_NULL</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
The library will recalculate structural information flagging modified structures with the <span class="define">ELF_F_DIRTY</span> flag, but will not write data to the underlying file image.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="define">ELF_C_WRITE</span></dt>
<dd class="list-tag" style="margin-left: 14.00ex;">
The library will recalculate structural information and will also write the new image to the underlying file. The ELF descriptor referenced by argument <i class="arg">elf</i> should permit the underlying ELF object to be written or updated (see <a class="link-man" href="../3/elf_begin">elf_begin(3)</a>).</dd>
</dl>
<p>
All pointers to <span class="type">Elf_Scn</span> and <span class="type">Elf_Data</span> descriptors associated with descriptor <i class="arg">elf</i> should be considered invalid after a call to <b class="fname">elf_update</b>().<div class="subsection">
<h2 id="x53706563696679696e67204f626a656374204c61796f7574">Specifying Object Layout</h2> The <span class="lib">ELF Access Library (libelf, &#45;lelf)</span> supports two layout modes.<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
Library Layout</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
If the <span class="define">ELF_F_LAYOUT</span> flag is not set on the ELF descriptor, the ELF library will lay out the ELF object according to the following scheme:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="emph">EHDR</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
The ELF executable header will be placed at the start of the object.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="emph">PHDR</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
If the ELF descriptor contains a program header table, it will be placed after the Executable Header.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="emph">Section Data</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
ELF section data, if any, will be placed next, keeping each section's alignment requirements in mind.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="emph">SHDR</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
The ELF section header table, if any, will be placed last.</dd>
</dl>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
Application Controlled Layout</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The application can take full control of the layout of the ELF object by setting the <span class="define">ELF_F_LAYOUT</span> flag on the ELF descriptor (see <a class="link-man" href="../3/elf_flagelf">elf_flagelf(3)</a>). In this case the library will lay out the ELF object using application-supplied information as below:<p>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="emph">EHDR</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
The ELF executable header will be placed at the start of the object.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="emph">PHDR</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
The ELF program header table, if any, it will be placed at the offset specified in the <b class="var">e_phoff</b> field of the ELF executable header.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="emph">Section Data</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
The data for each ELF section will be placed at the offset specified by the <b class="var">sh_offset</b> field of the section's header. The size of the section will be taken from the <b class="var">sh_size</b> field of the section header.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<span class="emph">SHDR</span></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
The ELF section header table, if any, will be placed at the offset specified by the <b class="var">e_shoff</b> field of the executable header.</dd>
</dl>
</dd>
</dl>
<p>
Gaps in the coverage of the file's contents will be set to the fill value specified by <a class="link-man" href="../3/elf_fill">elf_fill(3)</a>.</div>
<div class="subsection">
<h2 id="x4170706c69636174696f6e20537570706c69656420496e666f726d6174696f6e">Application Supplied Information</h2> The application needs to set the following fields in the data structures associated with the ELF descriptor prior to calling <b class="fname">elf_update</b>().<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
Executable Header</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The fields of the ELF executable header that need to be set by the application are:<p>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="var">e_entry</b></dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
To be set to the desired entry address for executables.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="var">e_flags</b></dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
To be set to the desired processor specific flags.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="var">e_ident[EI_DATA]</b></dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
Must be set to one of <span class="define">ELFDATA2LSB</span> or <span class="define">ELFDATA2MSB</span>.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="var">e_ident[EI_OSABI]</b></dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
To be set to the OS ABI desired. For example, for <span class="unix">FreeBSD</span> executables, this field should be set to <span class="define">ELFOSABI_FREEBSD</span>.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="var">e_machine</b></dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
To be set to the desired machine architecture, one of the <span class="define">EM_*</span> values in the header file <b class="includes">&lt;<a class="link-includes">elfdefinitions.h</a>&gt;</b>.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="var">e_phoff</b></dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
If the application is managing the object's layout, it must set this field to the file offset of the ELF program header table.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="var">e_shoff</b></dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
If the application is managing the object's layout, it must set this field to the file offset of the ELF section header table.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="var">e_shstrndx</b></dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
To be set to the index of the string table containing section names.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="var">e_type</b></dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
To be set to the type of the ELF object, one of the <span class="define">ET_*</span> values in the header file <b class="includes">&lt;<a class="link-includes">elfdefinitions.h</a>&gt;</b>.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="var">e_version</b></dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
To be set to the desired version of the ELF object.</dd>
</dl>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
Program Header</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
All fields of the entries in the program header table need to be set by the application.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
Section Header</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The fields of ELF section headers that need to be set by the application are:<p>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="var">sh_addr</b></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
To be set to the memory address where the section should reside.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="var">sh_addralign</b></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
If the application is managing the file layout, it must set this field to the desired alignment for the section's contents. This value must be a power of two and must be at least as large as the largest alignment needed by any <span class="type">Elf_Data</span> descriptor associated with the section.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="var">sh_entsize</b></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
To be set to the size of each entry, for sections containing fixed size elements, or set to zero for sections without fixed size elements. If the application is not managing file layout, it may leave this field as zero for those sections whose types are known to the library.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="var">sh_flags</b></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
To be set to the desired section flags.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="var">sh_info</b></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
To be set as described in <a class="link-man" href="../5/elf">elf(5)</a>.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="var">sh_link</b></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
To be set as described in <a class="link-man" href="../5/elf">elf(5)</a>.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="var">sh_name</b></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
To be set to the index of the section's name in the string table containing section names.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="var">sh_offset</b></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
If the application is managing the file layout, it must set this field to the file offset of the section's contents.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="var">sh_size</b></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
If the application is managing the file layout, it must set this field to the file size of the section's contents.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="var">sh_type</b></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
To be set to the type of the section.</dd>
</dl>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
Section Data</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The <span class="type">Elf_Data</span> descriptors associated with each section specify its contents (see <a class="link-man" href="../3/elf_getdata">elf_getdata(3)</a>). While all the fields in these descriptors are under application control, the following fields influence object layout:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="var">d_align</b></dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
To be set to the desired alignment, within the containing section, of the descriptor's data.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="var">d_off</b></dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
If the application is managing object layout, it must set this field to the file offset, within the section, at which the descriptor's data should be placed.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="var">d_size</b></dt>
<dd class="list-tag" style="margin-left: 10.00ex;">
To be set to the size in bytes of the memory representation of the descriptor's data.</dd>
</dl>
</dd>
</dl>
</div>
</div>
<div class="section">
<h1 id="x52455455524e2056414c554553">RETURN VALUES</h1> Function <b class="fname">elf_update</b>() returns the total size of the file image if successful, or -1 if an error occurred.</div>
<div class="section">
<h1 id="x4552524f5253">ERRORS</h1> This function may fail with the following errors:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ELF_E_ARGUMENT</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
Argument <i class="arg">elf</i> was null.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ELF_E_ARGUMENT</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
Argument <i class="arg">cmd</i> was not recognized.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ELF_E_ARGUMENT</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
The argument <i class="arg">elf</i> was not a descriptor for an ELF object.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ELF_E_CLASS</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
The <b class="var">e_ident[EI_CLASS]</b> field of the executable header of argument <i class="arg">elf</i> did not match the class of the file.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ELF_E_DATA</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
An <span class="type">Elf_Data</span> descriptor contained in argument <i class="arg">elf</i> specified an unsupported type.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ELF_E_DATA</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
An <span class="type">Elf_Data</span> descriptor specified an alignment that was zero or was not a power of two.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ELF_E_HEADER</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
The ELF header in argument <i class="arg">elf</i> requested a different byte order from the byte order already associated with the file.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ELF_E_IO</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
An I/O error was encountered.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ELF_E_LAYOUT</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
An <span class="type">Elf_Data</span> descriptor contained in argument <i class="arg">elf</i> specified an alignment incompatible with its containing section.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ELF_E_LAYOUT</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
Argument <i class="arg">elf</i> contained section descriptors that overlapped in extent.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ELF_E_LAYOUT</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
Argument <i class="arg">elf</i> contained section descriptors that were incorrectly aligned or were too small for their data.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ELF_E_LAYOUT</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
The flag <span class="define">ELF_F_LAYOUT</span> was set on the Elf descriptor and the executable header overlapped with the program header table.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ELF_E_LAYOUT</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
The flag <span class="define">ELF_F_LAYOUT</span> was set on the Elf descriptor and the program header table was placed at a misaligned file offset.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ELF_E_LAYOUT</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
The flag <span class="define">ELF_F_LAYOUT</span> was set on the Elf descriptor and the section header table overlapped an extent mapped by a section descriptor.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ELF_E_LAYOUT</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
The <span class="define">ELF_F_LAYOUT</span> flag was set on the Elf descriptor, and the <b class="var">d_offset</b> field in an <span class="type">Elf_Data</span> descriptor contained a value that was not a multiple of the descriptor's specified alignment.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ELF_E_MODE</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
An <span class="define">ELF_C_WRITE</span> operation was requested with an ELF descriptor that was not opened for writing or updating.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ELF_E_SECTION</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
Argument <i class="arg">elf</i> contained a section with an unrecognized type.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ELF_E_SECTION</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
The section header at index <span class="define">SHN_UNDEF</span> had an illegal section type.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ELF_E_SEQUENCE</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
An <span class="define">ELF_C_WRITE</span> operation was requested after a prior call to <b class="fname">elf_cntl</b>(<i class="farg">elf</i>, <i class="farg">ELF_C_FDDONE</i>) disassociated the ELF descriptor <i class="arg">elf</i> from its underlying file.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ELF_E_VERSION</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 16.00ex;">
Argument <i class="arg">elf</i> had an unsupported version or contained an <span class="type">Elf_Data</span> descriptor with an unsupported version.</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../3/elf">elf(3)</a>, <a class="link-man" href="../3/elf32_getehdr">elf32_getehdr(3)</a>, <a class="link-man" href="../3/elf32_getphdr">elf32_getphdr(3)</a>, <a class="link-man" href="../3/elf32_newehdr">elf32_newehdr(3)</a>, <a class="link-man" href="../3/elf32_newphdr">elf32_newphdr(3)</a>, <a class="link-man" href="../3/elf64_getehdr">elf64_getehdr(3)</a>, <a class="link-man" href="../3/elf64_getphdr">elf64_getphdr(3)</a>, <a class="link-man" href="../3/elf64_newehdr">elf64_newehdr(3)</a>, <a class="link-man" href="../3/elf64_newphdr">elf64_newphdr(3)</a>, <a class="link-man" href="../3/elf_begin">elf_begin(3)</a>, <a class="link-man" href="../3/elf_cntl">elf_cntl(3)</a>, <a class="link-man" href="../3/elf_fill">elf_fill(3)</a>, <a class="link-man" href="../3/elf_flagehdr">elf_flagehdr(3)</a>, <a class="link-man" href="../3/elf_flagelf">elf_flagelf(3)</a>, <a class="link-man" href="../3/elf_getdata">elf_getdata(3)</a>, <a class="link-man" href="../3/elf_getscn">elf_getscn(3)</a>, <a class="link-man" href="../3/elf_newdata">elf_newdata(3)</a>, <a class="link-man" href="../3/elf_newscn">elf_newscn(3)</a>, <a class="link-man" href="../3/elf_rawdata">elf_rawdata(3)</a>, <a class="link-man" href="../3/gelf">gelf(3)</a>, <a class="link-man" href="../3/gelf_newehdr">gelf_newehdr(3)</a>, <a class="link-man" href="../3/gelf_newphdr">gelf_newphdr(3)</a>, <a class="link-man" href="../5/elf">elf(5)</a></div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
August 14, 2011</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

