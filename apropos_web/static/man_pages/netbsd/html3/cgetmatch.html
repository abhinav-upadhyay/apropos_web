<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
CGETCAP(3)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
CGETCAP(3)</td>
<td class="head-vol" align="center">
Library Functions Manual</td>
<td class="head-rtitle" align="right">
CGETCAP(3)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">cgetent</b>, <b class="name">cgetset</b>, <b class="name">cgetmatch</b>, <b class="name">cgetcap</b>, <b class="name">cgetnum</b>, <b class="name">cgetstr</b>, <b class="name">cgetustr</b>, <b class="name">cgetfirst</b>, <b class="name">cgetnext</b>, <b class="name">cgetclose</b>, <b class="name">cexpandtc</b> &#8212; <span class="desc">capability database access routines</span></div>
<div class="section">
<h1 id="x4c494252415259">LIBRARY</h1> <span class="lib">Standard C Library (libc, &#45;lc)</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1> <b class="includes">#include &lt;<a class="link-includes">stdlib.h</a>&gt;</b><p>
<i class="ftype">int</i><br>
<b class="fname">cgetent</b>(<i class="farg" style="white-space:nowrap;">char **buf</i>, <i class="farg" style="white-space:nowrap;">const char * const *db_array</i>, <i class="farg" style="white-space:nowrap;">const char *name</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">cgetset</b>(<i class="farg" style="white-space:nowrap;">const char *ent</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">cgetmatch</b>(<i class="farg" style="white-space:nowrap;">const char *buf</i>, <i class="farg" style="white-space:nowrap;">const char *name</i>);<p>
<i class="ftype">char *</i><br>
<b class="fname">cgetcap</b>(<i class="farg" style="white-space:nowrap;">char *buf</i>, <i class="farg" style="white-space:nowrap;">const char *cap</i>, <i class="farg" style="white-space:nowrap;">int type</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">cgetnum</b>(<i class="farg" style="white-space:nowrap;">char *buf</i>, <i class="farg" style="white-space:nowrap;">const char *cap</i>, <i class="farg" style="white-space:nowrap;">long *num</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">cgetstr</b>(<i class="farg" style="white-space:nowrap;">char *buf</i>, <i class="farg" style="white-space:nowrap;">const char *cap</i>, <i class="farg" style="white-space:nowrap;">char **str</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">cgetustr</b>(<i class="farg" style="white-space:nowrap;">char *buf</i>, <i class="farg" style="white-space:nowrap;">const char *cap</i>, <i class="farg" style="white-space:nowrap;">char **str</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">cgetfirst</b>(<i class="farg" style="white-space:nowrap;">char **buf</i>, <i class="farg" style="white-space:nowrap;">const char * const *db_array</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">cgetnext</b>(<i class="farg" style="white-space:nowrap;">char **buf</i>, <i class="farg" style="white-space:nowrap;">const char * const *db_array</i>);<p>
<i class="ftype">int</i><br>
<b class="fname">cgetclose</b>(<i class="farg" style="white-space:nowrap;">void</i>);<p>
<i class="ftype">void</i><br>
<b class="fname">csetexpandtc</b>(<i class="farg" style="white-space:nowrap;">int expandtc</i>);</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> <b class="fname">cgetent</b>() extracts the capability <i class="farg">name</i> from the database specified by the <span class="define">NULL</span> terminated file array <i class="farg">db_array</i> and returns a pointer to a <a class="link-man" href="../html3/malloc.html">malloc(3)</a>&#39;d copy of it in <i class="farg">buf</i>. <b class="fname">cgetent</b>() will first look for files ending in <i class="file">.db</i> (see <a class="link-man" href="../html1/cap_mkdb.html">cap_mkdb(1)</a>) before accessing the ASCII file.<p>
<i class="farg">buf</i> must be retained through all subsequent calls to <b class="fname">cgetmatch</b>(), <b class="fname">cgetcap</b>(), <b class="fname">cgetnum</b>(), <b class="fname">cgetstr</b>(), and <b class="fname">cgetustr</b>(), but may then be <a class="link-man" href="../html3/free.html">free(3)</a>&#39;d.<p>
On success 0 is returned, 1 if the returned record contains an unresolved &#8220;tc&#8221; expansion, &#45;1 if the requested record couldn't be found, &#45;2 if a system error was encountered (couldn't open/read a file, etc.) also setting <b class="var">errno</b>, and &#45;3 if a potential reference loop is detected (see &#8220;tc=name&#8221; comments below).<p>
<b class="fname">cgetset</b>() enables the addition of a character buffer containing a single capability record entry to the capability database. Conceptually, the entry is added as the first &#8220;file&#8221; in the database, and is therefore searched first on the call to <b class="fname">cgetent</b>(). The entry is passed in <i class="farg">ent</i>. If <i class="farg">ent</i> is <span class="define">NULL</span>, the current entry is removed from the database.<p>
<b class="fname">cgetset</b>() must precede the database traversal. It must be called before the <b class="fname">cgetent</b>() call. If a sequential access is being performed (see below), it must be called before the first sequential access call (<b class="fname">cgetfirst</b>() or <b class="fname">cgetnext</b>()), or be directly preceded by a <b class="fname">cgetclose</b>() call. On success 0 is returned and &#45;1 on failure.<p>
<b class="fname">cgetmatch</b>() will return 0 if <i class="farg">name</i> is one of the names of the capability record <i class="farg">buf</i>, &#45;1 if not.<p>
<b class="fname">cgetcap</b>() searches the capability record <i class="farg">buf</i> for the capability <i class="farg">cap</i> with type <i class="farg">type</i>. A <i class="farg">type</i> is specified using any single character. If a colon (&#8216;:&#8217;) is used, an untyped capability will be searched for (see below for explanation of types). A pointer to the value of <i class="farg">cap</i> in <i class="farg">buf</i> is returned on success, <span class="define">NULL</span> if the requested capability couldn't be found. The end of the capability value is signaled by a &#8216;:&#8217;. See <a class="link-man" href="../html5/capfile.html">capfile(5)</a> for a description of the capability syntax.<p>
<b class="fname">cgetnum</b>() retrieves the value of the numeric capability <i class="farg">cap</i> from the capability record pointed to by <i class="farg">buf</i>. The numeric value is returned in the <i class="ftype">long</i> pointed to by <i class="farg">num</i>. 0 is returned on success, &#45;1 if the requested numeric capability couldn't be found.<p>
<b class="fname">cgetstr</b>() retrieves the value of the string capability <i class="farg">cap</i> from the capability record pointed to by <i class="farg">buf</i>. A pointer to a decoded, <span class="define">NUL</span> terminated, <a class="link-man" href="../html3/malloc.html">malloc(3)</a>&#39;d copy of the string is returned in the <i class="ftype">char *</i> pointed to by <i class="farg">str</i>. The number of characters in the decoded string not including the trailing <span class="define">NUL</span> is returned on success, &#45;1 if the requested string capability couldn't be found, &#45;2 if a system error was encountered (storage allocation failure).<p>
<b class="fname">cgetustr</b>() is identical to <b class="fname">cgetstr</b>() except that it does not expand special characters, but rather returns each character of the capability string literally.<p>
<b class="fname">cgetfirst</b>(), <b class="fname">cgetnext</b>(), comprise a function group that provides for sequential access of the <span class="define">NULL</span> pointer terminated array of file names, <i class="farg">db_array</i>. <b class="fname">cgetfirst</b>() returns the first record in the database and resets the access to the first record. <b class="fname">cgetnext</b>() returns the next record in the database with respect to the record returned by the previous <b class="fname">cgetfirst</b>() or <b class="fname">cgetnext</b>() call. If there is no such previous call, the first record in the database is returned. Each record is returned in a <a class="link-man" href="../html3/malloc.html">malloc(3)</a>&#39;d copy pointed to by <i class="farg">buf</i>. &#8220;tc&#8221; expansion is done (see &#8220;tc=name&#8221; comments below).<p>
Upon completion of the database 0 is returned,  1 is returned upon successful return of record with possibly more remaining (we haven't reached the end of the database yet), 2 is returned if the record contains an unresolved &#8220;tc&#8221; expansion, &#45;1 is returned if an system error occurred, and &#45;2 is returned if a potential reference loop is detected (see &#8220;tc=name&#8221; comments below). Upon completion of database (0 return) the database is closed.<p>
<b class="fname">cgetclose</b>() closes the sequential access and frees any memory and file descriptors being used. Note that it does not erase the buffer pushed by a call to <b class="fname">cgetset</b>().</div>
<div class="section">
<h1 id="x4341504142494c4954592044415441424153452053454d414e54494353">CAPABILITY DATABASE SEMANTICS</h1> Capability records describe a set of (name, value) bindings. Names may have multiple values bound to them. Different values for a name are distinguished by their <i class="farg">types</i>. <b class="fname">cgetcap</b>() will return a pointer to a value of a name given the capability name and the type of the value.<p>
The types &#8216;#&#8217; and &#8216;=&#8217; are conventionally used to denote numeric and string typed values, but no restriction on those types is enforced. The functions <b class="fname">cgetnum</b>() and <b class="fname">cgetstr</b>() can be used to implement the traditional syntax and semantics of &#8216;#&#8217; and &#8216;=&#8217;. Typeless capabilities are typically used to denote boolean objects with presence or absence indicating truth and false values respectively. This interpretation is conveniently represented by:<p>
<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit">(getcap(buf, name, ':') != NULL)</code></div>
</blockquote>
<p>
A special capability, &#8220;tc=name&#8221;, is used to indicate that the record specified by <i class="farg">name</i> should be substituted for the &#8220;tc&#8221; capability. &#8220;tc&#8221; capabilities may interpolate records which also contain &#8220;tc&#8221; capabilities and more than one &#8220;tc&#8221; capability may be used in a record. A &#8220;tc&#8221; expansion scope (i.e. where the argument is searched for) contains the file in which the &#8220;tc&#8221; is declared and all subsequent files in the file array.<p>
<b class="fname">csetexpandtc</b>() can be used to control if &#8220;tc&#8221; expansion is performed or not.</div>
<div class="section">
<h1 id="x444941474e4f5354494353">DIAGNOSTICS</h1> <b class="fname">cgetent</b>(), <b class="fname">cgetset</b>(), <b class="fname">cgetmatch</b>(), <b class="fname">cgetnum</b>(), <b class="fname">cgetstr</b>(), <b class="fname">cgetustr</b>(), <b class="fname">cgetfirst</b>(), and <b class="fname">cgetnext</b>() return a value greater than or equal to 0 on success and a value less than 0 on failure. <b class="fname">cgetcap</b>() returns a character pointer on success and a <span class="define">NULL</span> on failure.<p>
<b class="fname">cgetclose</b>(), <b class="fname">cgetent</b>(), <b class="fname">cgetfirst</b>(), and <b class="fname">cgetnext</b>() may fail and set <b class="var">errno</b> for any of the errors specified for the library functions: <a class="link-man" href="../html3/fopen.html">fopen(3)</a>, <a class="link-man" href="../html3/fclose.html">fclose(3)</a>, <a class="link-man" href="../html2/open.html">open(2)</a>, and <a class="link-man" href="../html2/close.html">close(2)</a>.<p>
<b class="fname">cgetent</b>(), <b class="fname">cgetset</b>(), <b class="fname">cgetstr</b>(), and <b class="fname">cgetustr</b>() may fail and set <b class="var">errno</b> as follows:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
&#91;<span class="errno">ENOMEM</span>&#93;</dt>
<dd class="list-tag" style="margin-left: 17.00ex;">
No memory to allocate.</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html1/cap_mkdb.html">cap_mkdb(1)</a>, <a class="link-man" href="../html3/malloc.html">malloc(3)</a>, <a class="link-man" href="../html5/capfile.html">capfile(5)</a></div>
<div class="section">
<h1 id="x42554753">BUGS</h1> There are no checks for &#8220;tc=name&#8221; loops in <b class="fname">cgetent</b>().<p>
The buffer added to the database by a call to <b class="fname">cgetset</b>() is not unique to the database but is rather prepended to any database used.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
April 5, 2012</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

