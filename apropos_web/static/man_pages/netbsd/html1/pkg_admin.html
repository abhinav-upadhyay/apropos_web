<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
PKG_ADMIN(1)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
PKG_ADMIN(1)</td>
<td class="head-vol" align="center">
General Commands Manual</td>
<td class="head-rtitle" align="right">
PKG_ADMIN(1)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">pkg_admin</b> &#8212; <span class="desc">perform various administrative tasks to the pkg system</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1><table class="synopsis">
<col style="width: 9.00ex;">
<col>
<tbody>
<tr>
<td>
pkg_admin</td>
<td>
&#91;<span class="opt"><b class="flag">&#45;bqSVv</b></span>&#93; &#91;<span class="opt"><b class="flag">&#45;C</b> <i class="arg">config</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;d</b> <i class="arg">lsdir</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;K</b> <i class="arg">pkg_dbdir</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;s</b> <i class="arg">sfx_pattern</i></span>&#93; <i class="arg">command</i> &#91;<span class="opt">args ...</span>&#93;</td>
</tr>
</tbody>
</table>
</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> This command performs various administrative tasks around the <span class="unix">NetBSD</span> Packages System.</div>
<div class="section">
<h1 id="x4f5054494f4e53">OPTIONS</h1> The following command-line options are supported:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;b</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Print only the base names when matching package names for <b class="flag">lsall</b> and <b class="flag">lsbest</b>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;C</b> <i class="arg">config</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Read the configuration file from <i class="arg">config</i> instead of the system default.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;d</b> <i class="arg">lsdir</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Set <i class="arg">lsdir</i> as the path to the directory in which to find matching package names for <b class="flag">lsall</b> and <b class="flag">lsbest</b>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;K</b> <i class="arg">pkg_dbdir</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Override the value of the <span class="define">PKG_DBDIR</span> configuration option with the value <i class="arg">pkg_dbdir</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;q</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Perform checks in a quiet manner. In normal operation, <b class="name">pkg_admin</b> prints a &#8216;.&#8217; to standard output to indicate progress. This option suppresses this progress indicator.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;S</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Set the shell glob pattern for package suffixes when matching package names for <b class="flag">lsall</b> and <b class="flag">lsbest</b> to be the null suffix.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;s</b> <i class="arg">sfx_pattern</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Set the shell glob pattern for package suffixes when matching package names for <b class="flag">lsall</b> and <b class="flag">lsbest</b>. The default pattern is ".t[bg]z".</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;V</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Print version number and exit.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;v</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Be more verbose.</dd>
</dl>
<p>
The following commands are supported:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">add</b> <i class="arg">pkg ...</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
For each listed package, write the absolute pathnames of the files listed in its <i class="file">+CONTENTS</i> file together with the package they belong to into the package database. This should be used only by <a class="link-man" href="../html1/pkg_view.html">pkg_view(1)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">audit</b> &#91;<span class="opt"><b class="flag">&#45;es</b></span>&#93; &#91;<span class="opt"><b class="flag">&#45;t</b> <i class="arg">type</i></span>&#93; &#91;<span class="opt"><i class="arg">pkg</i></span>&#93; ...</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Check the listed installed packages for vulnerabilities. If no package is given, check all installed packages. If <b class="flag">&#45;e</b> is given, override the <span class="define">CHECK_END_OF_LIFE</span> option from <a class="link-man" href="../html5/pkg_install.conf.html">pkg_install.conf(5)</a> with &#8220;<code class="lit">yes</code>&#8221;. If <b class="flag">&#45;s</b> is given, check the signature of the pkg-vulnerabilities file before using it. <b class="flag">&#45;t</b> restricts the reported vulnerabilities to type <i class="arg">type</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">audit-pkg</b> &#91;<span class="opt"><b class="flag">&#45;es</b></span>&#93; &#91;<span class="opt"><b class="flag">&#45;t</b> <i class="arg">type</i></span>&#93; &#91;<span class="opt"><i class="arg">pkg</i></span>&#93; ...</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Like <b class="flag">audit</b>, but check only the given package names or patterns.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">audit-batch</b> &#91;<span class="opt"><b class="flag">&#45;es</b></span>&#93; &#91;<span class="opt"><b class="flag">&#45;t</b> <i class="arg">type</i></span>&#93; &#91;<span class="opt"><i class="arg">pkg-list</i></span>&#93; ...</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Like <b class="flag">audit-pkg</b>, but read the package names or patterns one per line from the given files.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">audit-history</b> &#91;<span class="opt"><b class="flag">&#45;s</b></span>&#93; &#91;<span class="opt"><b class="flag">&#45;t</b> <i class="arg">type</i></span>&#93; &#91;<span class="opt"><i class="arg">pkgbase</i></span>&#93; ...</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Print all vulnerabilities for the given base package names.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">check</b> &#91;<span class="opt"><i class="arg">pkg ...</i></span>&#93;</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Use this command to check the files belonging to some or all of the packages installed on the local machine against the checksum which was recorded in the <i class="file">+CONTENTS</i> files at package installation time. Symbolic links also have their integrity checked against the recorded value at package installation time. If no additional argument is given, the files of all installed packages are checked, else only the named packages will be checked (wildcards can be used here, see <a class="link-man" href="../html1/pkg_info.html">pkg_info(1)</a>).<p>
The packages' <i class="file">+CONTENTS</i> files will be parsed and the checksum will be checked for every file found. A warning message is printed if the expected checksum differs from the checksum of the file on disk. Symbolic links are also checked, ensuring that the targets on disk are the same as the contents recorded at package installation time.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">check-license</b> <i class="arg">condition</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Check if <i class="arg">condition</i> can be fulfilled with the currently set of accepted licenses. Prints either yes or no to stdout if the condition can be parsed, otherwise it exits with error.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">check-pkg-vulnerabilities</b> &#91;<span class="opt"><b class="flag">&#45;s</b></span>&#93; <i class="arg">file</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Check format and hashes in the pkg-vulnerabilities file <i class="arg">file</i>. If <b class="flag">&#45;s</b> is given, also check the embedded signature.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">check-signature</b> <i class="arg">file ...</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Reports if <i class="arg">file</i> is a correctly signed package.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">check-single-license</b> <i class="arg">license</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Check if <i class="arg">license</i> is a valid license name and if it is in the set of acceptable licenses. Prints either yes or no to stdout if the condition can be parsed, otherwise it exits with error.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">config-var</b> <i class="arg">variable</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Print the current value of <i class="arg">variable</i> as used after parsing the configuration file.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">delete</b> <i class="arg">pkg ...</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
For each listed package, remove all file entries in the package database that belong to the package. This should be used only by <a class="link-man" href="../html1/pkg_view.html">pkg_view(1)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">dump</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Dump the contents of the package database, similar to <b class="flag">pkg_info -F</b>. Columns are printed for the key field used in the pkgdb - the filename -, and the data field - the package the file belongs to.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">fetch-pkg-vulnerabilities</b> &#91;<span class="opt"><b class="flag">&#45;su</b></span>&#93;</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Fetch a new pkg-vulnerabilities file, check the format and if <b class="flag">&#45;s</b> is given the signature. If all checks are passed, write it to pkgdb. If <b class="flag">&#45;u</b> is given, the fetch is conditional and the file transfer is only done if the remote version is newer than the one in pkgdb.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">findbest</b> <i class="arg">pattern ...</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Search the entries of <span class="define">PKG_PATH</span> for packages matching <i class="arg">pattern</i>. Print the URL of the best matching package to stdout for each pattern. If a pattern is not matched, it is skipped and the command will return a failure.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">lsall</b> <i class="arg">/dir/pkgpattern</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">lsbest</b> <i class="arg">/dir/pkgpattern</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
List all/best package matching pattern in the given directory <i class="file">/dir</i>. If the <b class="flag">&#45;d</b> flag is given, then that directory path overrides <i class="file">/dir</i>. Can be used to work around limitations of /bin/sh and other filename globbing mechanisms. This option implements matching of pkg-wildcards against arbitrary files and directories, useful mainly in the build system itself. See <a class="link-man" href="../html1/pkg_info.html">pkg_info(1)</a> for a description of the pattern.<p>
Example:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
yui# cd /usr/pkgsrc/packages/i386ELF/All/ 
yui# ls unzip* 
unzip-5.40.tgz  unzip-5.41.tgz 
yui# pkg_admin lsall 'unzip*' 
/usr/pkgsrc/packages/i386ELF/All/unzip-5.40.tgz 
/usr/pkgsrc/packages/i386ELF/All/unzip-5.41.tgz 
yui# pkg_admin lsall 'unzip&#8805;5.40' 
/usr/pkgsrc/packages/i386ELF/All/unzip-5.40.tgz 
/usr/pkgsrc/packages/i386ELF/All/unzip-5.41.tgz 
yui# pkg_admin lsall 'unzip&#8805;5.41' 
/usr/pkgsrc/packages/i386ELF/All/unzip-5.41.tgz 
yui# pkg_admin lsbest 'unzip&#8805;5.40' 
/usr/pkgsrc/packages/i386ELF/All/unzip-5.41.tgz 
yui# pkg_admin lsall /usr/pkgsrc/packages/i386ELF/All/'{mit,unproven}-pthread*' 
/usr/pkgsrc/packages/i386ELF/All/mit-pthreads-1.60b6.tgz 
/usr/pkgsrc/packages/i386ELF/All/unproven-pthreads-0.15.tgz</pre>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">pmatch</b> <i class="arg">pattern</i> <i class="arg">pkg</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Returns true if <i class="arg">pkg</i> matches <i class="arg">pattern</i>, otherwise returns false.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">rebuild</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Rebuild the package database mapping from scratch, using the <i class="file">+CONTENTS</i> files of the installed packages. This option is only intended for recovery after system crashes during package installation and removal.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">rebuild-tree</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Rebuild the +REQUIRED_BY files from scratch by reresolving all dependencies.<p>
This option is intended to be used for fixing inconsistencies between the records of depending and depended-on packages, such as can arise by the use of <b class="flag">pkg_delete -f</b>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">set</b> <i class="arg">variable=value pkg ...</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Set variable with information about the installed package. Use <b class="flag">unset</b> to remove a variable.<p>
Packages that are not installed directly by the user but pulled in as dependencies are marked by setting &#8220;automatic=YES&#8221;.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">gpg-sign-package pkg spkg</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Sign the binary package <i class="arg">pkg</i> using GPG and write the result to <i class="arg">spkg</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">x509-sign-package pkg spkg key cert</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Sign the binary package <i class="arg">pkg</i> using the key <i class="arg">key</i> and the certificate <i class="arg">cert</i>, using <i class="arg">spkg</i> as output file.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">unset</b> <i class="arg">variable pkg ...</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Remove an installation variable.</dd>
</dl>
</div>
<div class="section">
<h1 id="x454e5649524f4e4d454e54">ENVIRONMENT</h1> See <a class="link-man" href="../html5/pkg_install.conf.html">pkg_install.conf(5)</a> for options, that can also be specified using the environment.</div>
<div class="section">
<h1 id="x46494c4553">FILES</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/var/db/pkg/pkgdb.byfile.db</i></dt>
<dd class="list-tag" style="margin-left: 27.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<i class="file">/var/db/pkg/&lt;pkg&gt;/+CONTENTS</i></dt>
<dd class="list-tag" style="margin-left: 27.00ex;">
</dd>
</dl>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html1/pkg_add.html">pkg_add(1)</a>, <a class="link-man" href="../html1/pkg_create.html">pkg_create(1)</a>, <a class="link-man" href="../html1/pkg_delete.html">pkg_delete(1)</a>, <a class="link-man" href="../html1/pkg_info.html">pkg_info(1)</a>, <a class="link-man" href="../html1/pkg_view.html">pkg_view(1)</a>, <a class="link-man" href="../html5/pkg_install.conf.html">pkg_install.conf(5)</a>, <a class="link-man" href="../html7/pkgsrc.html">pkgsrc(7)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="name">pkg_admin</b> command first appeared in <span class="unix">NetBSD&#160;1.4</span>.</div>
<div class="section">
<h1 id="x415554484f5253">AUTHORS</h1> The <b class="name">pkg_admin</b> command was written by Hubert Feyrer.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
December 14, 2012</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

