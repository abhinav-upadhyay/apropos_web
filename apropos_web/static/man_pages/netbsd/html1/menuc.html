<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
MENUC(1)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
MENUC(1)</td>
<td class="head-vol" align="center">
General Commands Manual</td>
<td class="head-rtitle" align="right">
MENUC(1)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">menuc</b> &#8212; <span class="desc">menu compiler</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1><table class="synopsis">
<col style="width: 5.00ex;">
<col>
<tbody>
<tr>
<td>
menuc</td>
<td>
&#91;<span class="opt"><b class="flag">&#45;o</b> <i class="arg">name</i></span>&#93; <i class="arg">file</i></td>
</tr>
</tbody>
</table>
</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> This implements a curses based menu system. A source file that describes menus, their options, and how to process the options is given to <b class="name">menuc</b> and produces both a .c and a .h file that implement the menu system. The standard base name of the files is <i class="file">menu_defs</i>. The <b class="flag">&#45;o</b> <i class="arg">name</i> can be used to specify a different base name.</div>
<div class="section">
<h1 id="x454e5649524f4e4d454e54">ENVIRONMENT</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<span class="env">MENUDEF</span></dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Can be set to point to a different set of definition files for <b class="name">menuc</b>. The current location defaults to <i class="file">/usr/share/misc</i>.</dd>
</dl>
</div>
<div class="section">
<h1 id="x4d454e55204445534352495054494f4e53">MENU DESCRIPTIONS</h1> The input <i class="arg">file</i> defines static menus and options for processing those menus. It also contains comments, initial C code that is required to provide for definitions and other code necessary for the menu system, and an option declaration if dynamic menus are requested.<p>
Comments may appear anywhere in the input <i class="arg">file</i> and are like a space in the input. They are like C comments starting with <span class="emph">/*</span> and ending with <span class="emph">*/</span>. They are unlike C comments in that they may be nested. A comment does not end until a matching end comment is found.<p>
In many places, C code is included in the definition <i class="arg">file</i>. All C code is passed verbatim to the C output file. <b class="name">menuc</b> comments do not start in C code and comments in the C code are passed verbatim to the output. The C comments are not recognized by <b class="name">menuc</b>. In all cases, C code starts with a left brace (<span class="emph">{</span>) and ends with the matching right brace (<span class="emph">}</span>). It is important to recognize that in code segments, any brace will be counted, even if it is in a C comment inside the code.<p>
The <i class="arg">file</i> contains an initial (and optional) code block followed by any number of menu definition elements in any order. The initial code block usually contains includes of header files used by code in the menu code blocks later in the <i class="arg">file</i>. If <span class="define">USER_MENU_INIT</span> is #defined, then it will be evaluated before the rest of the menu is initialised, if it evaluates to a non-zero value then the initialisation will fail. The file is free format, so the actual formatting of the input <i class="arg">file</i> is to the taste of the programmer.<p>
All other C code that will appear in an <span class="emph">action</span>. This will be specified as &#60;<span class="emph">action</span>&#62; in later text. Such an action will appear as:<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit">action &lt;opt_endwin&gt; &lt;code&gt;</code></div>
</blockquote>
in the <i class="arg">file</i>. The &#60;<span class="emph">opt_endwin</span>&#62;, if present is:<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit">(endwin)</code></div>
</blockquote>
and specifies that the curses <b class="fname">endwin</b>() function should be called before executing the code and then reinstating the current curses window after the code has been run. The &#60;<span class="emph">code</span>&#62; is as described above.<p>
There are four kinds of menu definition elements. The first one just declares whether the programmer wants dynamic menus available. The default is static menus only. The static menus are the ones defined by the menu definitions and do not change at run time. The dynamic menus provide the programmer with a method to create and modify menus during the running of the program. To include dynamic menus, one needs only add the declaration:<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit">allow dynamic menus;</code></div>
</blockquote>
The semicolon is required to terminate this declaration. This declaration may appear anywhere in the <i class="arg">file</i>, but usually appears before any menus are defined.<p>
The next element is a code block to execute if the curses screen can not be successfully initialized. The declaration<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit">error code;</code></div>
</blockquote>
tells the menu system to execute the associated code block if the initialization fails. If no code is provided, a default code block is used that prints<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit">Could not initialize curses.</code></div>
</blockquote>
and exits. This element may appear anywhere in the <i class="arg">file</i> but usually appears before any menus are defined.<p>
The next element defines default options for menus. Each menu is built from a list of options. These options include the location of the upper left corner of the menu, whether there is a "box" drawn around the menu, whether the menu is scrollable, the menu's title, whether shortcut letters are allowed, whether a standard exit option should be included in the menu and text associated with the standard exit option. The general format is:<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit">default &lt;comma separated option list&gt;;</code></div>
</blockquote>
<p>
The supported options are:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">x =</b> <b class="var">startx</b></dt>
<dd class="list-tag" style="margin-left: 22.00ex;">
The column number of the upper left corner of the menu window. If <b class="var">startx</b> is -1 the menu will be centered horizontally.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">y =</b> <b class="var">starty</b></dt>
<dd class="list-tag" style="margin-left: 22.00ex;">
The row number of the upper left corner of the menu window. If <b class="var">starty</b> is negative then the menu will be placed below any message text, but in at least row <b class="var">-starty</b>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">h =</b> <b class="var">height</b></dt>
<dd class="list-tag" style="margin-left: 22.00ex;">
Specifies the number of menu entries to be displayed. If zero, the height will be based on the number of entries.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">h =</b> <b class="var">width</b></dt>
<dd class="list-tag" style="margin-left: 22.00ex;">
Specifies the width of the menu window. If zero, the width will be that of the longest menu text line.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">title</b> <b class="var">text</b></dt>
<dd class="list-tag" style="margin-left: 22.00ex;">
The specified <b class="var">text</b> will be displayed at the top of the menu window (inside any box).</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">box</b></dt>
<dd class="list-tag" style="margin-left: 22.00ex;">
If specified, draw a box around the menu.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">clear</b></dt>
<dd class="list-tag" style="margin-left: 22.00ex;">
If specified, clear the window before performing the <b class="var">action</b>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">exit</b></dt>
<dd class="list-tag" style="margin-left: 22.00ex;">
If specified add an addition option to exit the menu.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">exitstring</b> <b class="var">text</b></dt>
<dd class="list-tag" style="margin-left: 22.00ex;">
The menu label for the <b class="var">exit</b> option. If not specified defaults to "exit".</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">default exit</b></dt>
<dd class="list-tag" style="margin-left: 22.00ex;">
If specified, place the cursor on the <b class="var">exit</b> line of the menu, instead of the top line.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">shortcut</b></dt>
<dd class="list-tag" style="margin-left: 22.00ex;">
If specified, add alphabetic tags to each menu line.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">scrollable</b></dt>
<dd class="list-tag" style="margin-left: 22.00ex;">
If specified, and the menu has more lines than will fit in its window, then only part of the menu will be displayed and the &#8216;&lt;&#8217; and &#8216;&gt;&#8217; keys will scroll the displayed menu lines.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">always scroll</b></dt>
<dd class="list-tag" style="margin-left: 22.00ex;">
If specified, allow for the scroll message line even if the menu doesn't appear to have too many lines. Useful for dynamic menus, when the number of entries isn't known when the menu window is created..</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">sub menu</b></dt>
<dd class="list-tag" style="margin-left: 22.00ex;">
If specified, the screen contents that the menu window overwrites are saved and restored when the menu exits.</dd>
</dl>
The <b class="cmd">box</b>, <b class="cmd">clear</b>, <b class="cmd">exit</b>, <b class="cmd">default exit</b>, <b class="cmd">shortcut</b>, <b class="cmd">scrollable</b>, <b class="cmd">always scroll</b>, and <b class="cmd">sub menu</b> options can be preceded by <b class="cmd">no</b> in order to negate a default.<p>
The <b class="var">text</b> arguments can be either a quoted text string or a name #defined to something suitable for initialising a const char * field.<p>
The default declaration may appear multiple times. Each time, it sets the default values for menu definitions that follow in the <i class="arg">file</i>. In each menu definition, any or all of these default definitions may be overridden for that menu.<p>
The final element is the actual static menu definitions. The format and order for a menu definition is:<p>
<div style="margin-left: 5.00ex;" class="display">
menu &lt;name&gt; &lt;options&gt; ;<br>
  &lt;display action&gt;<br>
  &lt;menu items&gt;<br>
  &lt;exit action&gt;<br>
  &lt;help text&gt;</div>
<p>
Names are unquoted strings of alpha-numeric and underscore characters. They must start with an alpha character. In C source, a menu named &#8220;foo&#8221; is appears as &#8220;MENU_foo&#8221;. (Capitalization is important.) This is important, because the menu is displayed and processed by calling the function<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit">process_menu (MENU_foo, arg);</code></div>
</blockquote>
<p>
The options are a comma separated list of options as in the &#8220;default&#8221; declaration. These override the options from the most recent default declaration.<p>
The display action is optional and provides C code to execute at each and every time the menu is displayed for processing. If it is included, the format is:<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit">display &lt;action&gt;;</code></div>
</blockquote>
<p>
The bulk of the menu definition is the specification of the menu items. The general format of a menu item is:<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit">option &lt;string&gt;, &lt;element_list&gt;;</code></div>
</blockquote>
The &#60;<span class="emph">string</span>&#62; is the text displayed for the menu item, this must be a quoted string or a name #defined to something that will initialise a const char * field. There may be an arbitrary number of these items. (If there are shortcuts in the menu, a practical limit of 51 should be recognized. It produces shortcuts a to w, y, z, and A to Z. x is the shortcut for the exit item.)<p>
The &#60;<span class="emph">element_list</span>&#62; is a comma separated list of what to do when the item is selected. They may appear in any order.<p>
The first element processed when a menu item is selected is the associated action. The next element to be processed is the sub or next menu option. They are declared as:<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit">next menu &lt;name&gt;</code></div>
</blockquote>
<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit">sub menu &lt;name&gt;</code></div>
</blockquote>
The difference between these two is that a sub menu will return to the current menu when exited. The next menu will just replace the current menu and when exited, will return to where the current menu would have gone. Only one of menu element may be used for each menu item. Finally, after processing both the action and a sub menu, the current menu will be exited if the element<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit">exit</code></div>
</blockquote>
is specified. <span class="emph">Note</span>: If <span class="emph">exit</span> is specified, next menu will not work because the menu system will exit the <span class="emph">current</span> menu, even if current has been set by <span class="emph">next menu</span>.<p>
After all menu items, the final two menu definition elements may appear. The exit action is optional and provides C code to execute in the process of exiting a menu. If it is included, the format is:<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit">exit &lt;action&gt;;</code></div>
</blockquote>
<p>
The final part of the menu definition is the optional help string. The format is:<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit">help &lt;text&gt;;</code></div>
</blockquote>
This text is displayed in a full page help window if the question mark is typed. The actual help text starts with a left brace (<span class="emph">{</span>) and ends with the matching right brace (<span class="emph">}</span>). The braces are not included in the help string, but all other characters between them are included. Newlines in the code translate to newlines in the help text. Alternatively, the name of a const char * variable may be given.</div>
<div class="section">
<h1 id="x44594e414d4943204d454e5553">DYNAMIC MENUS</h1> If requested, <b class="name">menuc</b> supports dynamic menus by allowing the user to create new menus. The related definitions for using dynamic menus are:<p>
<pre style="margin-left: 0.00ex;" class="lit display">
struct menudesc; 
 
typedef 
struct menu_ent { 
        const char  *opt_name; 
        int         opt_menu; 
        int         opt_flags; 
        int         (*opt_action)(struct menudesc *, void *); 
} menu_ent ; 
 
/* For opt_menu */ 
#define OPT_NOMENU -1 
 
/* For opt_flags */ 
#define OPT_SUB    1 
#define OPT_ENDWIN 2 
#define OPT_EXIT   4 
 
typedef 
struct menudesc { 
        const char  *title; 
        int         y, x; 
        int         h, w; 
        int         mopt; 
        int         numopts; 
        int         cursel; 
        int         topline; 
        menu_ent    *opts; 
        WINDOW      *mw; 
        WINDOW      *sv_mw; 
        const char  *helpstr; 
        const char  *exitstr; 
        void       (*post_act)(struct menudesc *, void *); 
        void       (*exit_act)(struct menudesc *, void *); 
        void       (*draw_line)(struct menudesc *, int, void *); 
} menudesc ; 
 
/* defines for mopt field. */ 
#define MC_NOEXITOPT 1 
#define MC_NOBOX 2 
#define MC_SCROLL 4 
#define MC_NOSHORTCUT 8 
#define MC_NOCLEAR 16 
#define MC_DFLTEXIT 32 
#define MC_ALWAYS_SCROLL 64 
#define MC_SUBMENU 128 
 
int new_menu(const char *title, menu_ent *opts, int numopts, 
        int x, int y, int h, int w, int mopt, 
        void (*post_act)(struct menudesc *, void *), 
        void (*draw_line)(struct menudesc *, int, void *), 
        void (*exit_act)(struct menudesc *, void *), 
	const char *help, const char *exitstr); 
 
void free_menu (int menu_no);</pre>
<p>
The <i class="arg">title</i> is the title displayed at the top of the menu. The <i class="arg">opts</i> is an array of menu entry definitions that has <i class="arg">numopts</i> elements. The programmer must build this array and fill in all of the fields before processing calling <b class="fname">process_menu</b>() for the new menu. The fields of the <i class="arg">opts</i> may change at any time. For example, <span class="emph">opt_name</span> may change as a result of selecting that option. When the menu is redisplayed, the new text is printed. Arguments, <i class="arg">x</i>, <i class="arg">y</i>, <i class="arg">h</i>, and <i class="arg">w</i> are the same as the options in the menu description. <i class="arg">mopt</i> is the boolean options. Note, box, clear, exit and shortcuts are enabled by default. You need to add option flags to turn them off or turn on scrollable menus. The options <i class="arg">post_act</i>, and <i class="arg">exit_act</i> are function pointers to the display action and the exit action. If they are <span class="define">NULL</span>, no call will be made. <i class="arg">draw_line</i> will be called to display the menu line if the corresponding opt_name field is <span class="define">NULL</span>. <i class="arg">help</i> is the text to display in a help screen. And finally, <i class="arg">exitstr</i> is the text for the 'exit' line of the menu. If <span class="define">NULL</span>, "Exit" is used. A <span class="define">NULL</span> help pointer will disable the help feature for the menu.</div>
<div class="section">
<h1 id="x46494c4553">FILES</h1><ul style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-item">
<li class="list-item" style="margin-top: 1.00em;">
<i class="file">/usr/share/misc/menu_sys.def</i></li>
</ul>
</div>
<div class="section">
<h1 id="x4558414d504c4553">EXAMPLES</h1> The following is a simple menu definition file. It is complete in that the output of <b class="name">menuc</b> may be compiled into a complete program. For example, if the following was in a file called <i class="file">example.mc</i>, an executable program could be produced by the following commands.<p>
<pre style="margin-left: 5.00ex;" class="lit display">
menuc -o example example.mc 
cc -o example example.c -lcurses</pre>
A much more complete example is available with the source distribution in a subdirectory called <span class="emph">testm</span>.<p>
<pre style="margin-left: 0.00ex;" class="lit display">
/* This is an example menu definition file for menuc. */ 
 
{ 
#include &lt;stdio.h&gt; 
#include &lt;unistd.h&gt; 
 
/* Main program! This is often in a different file. */ 
int 
main() 
  { 
    process_menu (MENU_main, NULL); 
    endwin(); 
    return 0; 
  } 
 
/* Example initialize function! */ 
void 
init_main() 
  { 
  } 
} 
 
default x=20, y=10, box, scrollable, exit; 
 
error action { 
   fprintf (stderr, "Example Menu: Could not initialize curses."); 
   exit(1); 
}; 
 
menu main, title "Main Menu", no exit, no shortcut; 
   display action { init_main(); }; 
   option "Option 1", 
      action (endwin) { 
        printf ("That was option 1!"); 
        sleep(3); 
      }; 
   option "Sub Menu", sub menu othermenu; 
   option "Next Menu", next menu othermenu; 
   option "Quit", exit; 
   help { 
This is a simple help screen for an example menu definition file. 
}; 
 
menu othermenu, title "Sub/Next Menu", x=5, y=5, no box; 
   option "Do Nothing!", action { };</pre>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html1/msgc.html">msgc(1)</a></div>
<div class="section">
<h1 id="x415554484f5253">AUTHORS</h1> <span class="author">Philip A. Nelson</span> for Piermont Information Systems Inc. Initial ideas for this were developed and implemented in Pascal at the Leiden University, Netherlands, in the summer of 1980.</div>
<div class="section">
<h1 id="x42554753">BUGS</h1> Both <b class="name">menuc</b> and <b class="name">msgc</b> are probably only used by <b class="name">sysinst</b>. The features of both have been tailored for <b class="name">sysinst</b>, and further changes are likely to occur.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
August 2, 2004</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

