<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/../4/strict.dtd">
>
<head>
<meta http-equiv="Content-Type" content="te../; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
IPFTEST(1)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
IPFTEST(1)</td>
<td class="head-vol" align="center">
General Commands Manual</td>
<td class="head-rtitle" align="right">
IPFTEST(1)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1>NAME</h1> ipftest &#45; test packet filter rules with arbitrary input.</div>
<div class="section">
<h1>SYNOPSIS</h1> <b>ipftest</b> [ <b>&#45;6bCdDoRvx</b> ] [ <b>&#45;F</b> input-format ] [ <b>&#45;i</b> &lt;filename&gt; ] [ <b>&#45;I</b> interface ] [ <b>&#45;l</b> &lt;filename&gt; ] [ <b>&#45;N</b> &lt;filename&gt; ] [ <b>&#45;P</b> &lt;filename&gt; ] [ <b>&#45;r</b> &lt;filename&gt; ] [ <b>&#45;S</b> &lt;ip_address&gt; ] [ <b>&#45;T</b> &lt;optionlist&gt; ]</div>
<div class="section">
<h1>DESCRIPTION</h1>  <b>ipftest</b> is provided for the purpose of being able to test a set of filter rules without having to put them in place, in operation and proceed to test their effectiveness.  The hope is that this minimises disruptions in providing a secure IP environment.<p>
<b>ipftest</b> will parse any standard ruleset for use with <b>ipf</b>,  <b>ipnat</b> and/or <b>ippool</b> and apply input, returning output as to the result.  However,  <b>ipftest</b> will return one of three values for packets passed through the filter: pass, block or nomatch.  This is intended to give the operator a better idea of what is happening with packets passing through their filter ruleset.<p>
At least one of <b>&#45;N</b>, <b>-P</b> or <b>&#45;r</b> must be specified.</div>
<div class="section">
<h1>OPTIONS</h1><dl>
<dt>
<b>&#45;6</b></dt>
<dd>
Use IPv6.</dd>
</dl>
<dl>
<dt>
<b>&#45;b</b></dt>
<dd>
Cause the output to be a brief summary (one-word) of the result of passing the packet through the filter; either "pass", "block" or "nomatch". This is used in the regression testing.</dd>
</dl>
<dl>
<dt>
<b>&#45;C</b></dt>
<dd>
Force the checksums to be (re)calculated for all packets being input into  <b>ipftest</b>.  This may be necessary if pcap files from tcpdump are being fed in where there are partial checksums present due to hardware offloading.</dd>
</dl>
<dl>
<dt>
<b>&#45;d</b></dt>
<dd>
Turn on filter rule debugging.  Currently, this only shows you what caused the rule to not match in the IP header checking (addresses/netmasks, etc).</dd>
</dl>
<dl>
<dt>
<b>&#45;D</b></dt>
<dd>
Dump internal tables before exiting. This excludes log messages.</dd>
</dl>
<dl>
<dt>
<b>&#45;F</b></dt>
<dd>
This option is used to select which input format the input file is in. The following formats are available: etherfind, hex, pcap, snoop, tcpdump,text.</dd>
</dl>
<div style="margin-left: 5.00ex;">
<dl>
<dt>
<b>etherfind</b></dt>
<dd>
The input file is to be text output from etherfind.  The text formats which are currently supported are those which result from the following etherfind option combinations:</dd>
</dl>
<p>
<br>
		etherfind -n<br>
		etherfind -n -t<br>
<dl>
<dt>
<b>hex</b></dt>
<dd>
The input file is to be hex digits, representing the binary makeup of the packet.  No length correction is made, if an incorrect length is put in the IP header.  A packet may be broken up over several lines of hex digits, a blank line indicating the end of the packet.  It is possible to specify both the interface name and direction of the packet (for filtering purposes) at the start of the line using this format: [direction,interface]  To define a packet going in on le0, we would use  <b>[in,le0]</b> - the []'s are required and part of the input syntax.</dd>
</dl>
<p>
<p style="margin-left: 5.00ex;text-indent: -5.00ex;">
<b>pcap</b> The input file specified by  <b>&#45;i</b> is a binary file produced using libpcap (i.e., tcpdump version 3).  Packets are read from this file as being input (for rule purposes).  An interface maybe specified using  <b>&#45;I</b>.<dl>
<dt>
<b>snoop</b></dt>
<dd>
The input file is to be in "snoop" format (see RFC 1761).  Packets are read from this file and used as input from any interface.  This is perhaps the most useful input type, currently.</dd>
</dl>
<dl>
<dt>
<b>tcpdump</b></dt>
<dd>
The input file is to be text output from tcpdump.  The text formats which are currently supported are those which result from the following tcpdump option combinations:</dd>
</dl>
<p>
<br>
		tcpdump -n<br>
		tcpdump -nq<br>
		tcpdump -nqt<br>
		tcpdump -nqtt<br>
		tcpdump -nqte<br>
<dl>
<dt>
<b>text</b></dt>
<dd>
The input file is in <b>ipftest</b> text input format. This is the default if no  <b>&#45;F</b> argument is specified. The format used is as follows:<br>
	"in"|"out" "on" if ["tcp"|"udp"|"icmp"]<br>
		srchost[,srcport] dsthost[,destport] [FSRPAU]<br>
</dd>
</dl>
<p>
This allows for a packet going "in" or "out" of an interface (if) to be generated, being one of the three main protocols (optionally), and if either TCP or UDP, a port parameter is also expected.  If TCP is selected, it is possible to (optionally) supply TCP flags at the end.  Some examples are:<br>
	# a UDP packet coming in on le0<br>
	in on le0 udp 10.1.1.1,2210 10.2.1.5,23<br>
	# an IP packet coming in on le0 from localhost - hmm :)<br>
	in on le0 localhost 10.4.12.1<br>
	# a TCP packet going out of le0 with the SYN flag set.<br>
	out on le0 tcp 10.4.12.1,2245 10.1.1.1,23 S<br>
</div>
<dl>
<dt>
<b>&#45;i</b>&#8194;&lt;filename&gt;</dt>
<dd>
Specify the filename from which to take input.  Default is stdin.</dd>
</dl>
<dl>
<dt>
<b>&#45;I</b>&#8194;&lt;interface&gt;</dt>
<dd>
Set the interface name (used in rule matching) to be the name supplied. This is useful where it is not otherwise possible to associate a packet with an interface.  Normal "text packets" can override this setting.</dd>
</dl>
<dl>
<dt>
<b>&#45;l</b>&#8194;&lt;filename&gt;</dt>
<dd>
Dump log messages generated during testing to the specified file.</dd>
</dl>
<dl>
<dt>
<b>&#45;N</b>&#8194;&lt;filename&gt;</dt>
<dd>
Specify the filename from which to read NAT rules in <b>ipnat</b>(5) format.</dd>
</dl>
<dl>
<dt>
<b>&#45;o</b></dt>
<dd>
Save output packets that would have been written to each interface in a file /tmp/ <i>interface_name</i> in raw format.</dd>
</dl>
<dl>
<dt>
<b>&#45;P</b>&#8194;&lt;filename&gt;</dt>
<dd>
Read IP pool configuration information in <b>ippool</b>(5) format from the specified file.</dd>
</dl>
<dl>
<dt>
<b>&#45;r</b>&#8194;&lt;filename&gt;</dt>
<dd>
Specify the filename from which to read filter rules in <b>ipf</b>(5) format.</dd>
</dl>
<dl>
<dt>
<b>&#45;R</b></dt>
<dd>
Don't attempt to convert IP addresses to hostnames.</dd>
</dl>
<dl>
<dt>
<b>&#45;S</b>&#8194;&lt;ip_address&gt;</dt>
<dd>
The IP address specifived with this option is used by ipftest to determine whether a packet should be treated as "input" or "output".  If the source address in an IP packet matches then it is considered to be inbound.  If it does not match then it is considered to be outbound.  This is primarily for use with tcpdump (pcap) files where there is no in/out information saved with each packet.</dd>
</dl>
<dl>
<dt>
<b>&#45;T</b>&#8194;&lt;optionlist&gt;</dt>
<dd>
This option simulates the run-time changing of IPFilter kernel variables available with the  <b>&#45;T</b> option of <b>ipf</b>. The optionlist parameter is a comma separated list of tuning commands.  A tuning command is either "list" (retrieve a list of all variables in the kernel, their maximum, minimum and current value), a single variable name (retrieve its current value) and a variable name with a following assignment to set a new value.  See  <b>ipf</b>(8) for examples.</dd>
</dl>
<dl>
<dt>
<b>&#45;v</b></dt>
<dd>
Verbose mode.  This provides more information about which parts of rule matching the input packet passes and fails.</dd>
</dl>
<dl>
<dt>
<b>&#45;x</b></dt>
<dd>
Print a hex dump of each packet before printing the decoded contents.</dd>
</dl>
</div>
<div class="section">
<h1>SEE ALSO</h1> ipf(5), ipf(8), snoop(1m), tcpdump(8), etherfind(8c)</div>
<div class="section">
<h1>BUGS</h1> Not all of the input formats are sufficiently capable of introducing a wide enough variety of packets for them to be all useful in testing.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tr>
<td class="foot-date">
</td>
<td class="foot-os" align="right">
</td>
</tr>
</table>
</div>
</body>
<>

