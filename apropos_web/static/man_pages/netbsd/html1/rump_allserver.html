<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
RUMP_SERVER(1)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
RUMP_SERVER(1)</td>
<td class="head-vol" align="center">
General Commands Manual</td>
<td class="head-rtitle" align="right">
RUMP_SERVER(1)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">rump_server</b>, <b class="name">rump_allserver</b> &#8212; <span class="desc">rump kernel server</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1><table class="synopsis">
<col style="width: 11.00ex;">
<col>
<tbody>
<tr>
<td>
rump_server</td>
<td>
&#91;<span class="opt"><b class="flag">&#45;s</b></span>&#93; &#91;<span class="opt"><b class="flag">&#45;c</b> <i class="arg">ncpu</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;d</b> <i class="arg">drivespec</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;l</b> <i class="arg">library</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;m</b> <i class="arg">module</i></span>&#93; <i class="arg">url</i></td>
</tr>
</tbody>
</table>
</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="name">rump_server</b> utility is used to provide a rump kernel service. Clients can use the system calls provided by <b class="name">rump_server</b> via <i class="arg">url</i>.<p>
The difference between <b class="name">rump_server</b> and <b class="name">rump_allserver</b> is that <b class="name">rump_server</b> offers only a minimalistic set of features, while <b class="name">rump_allserver</b> provides all rump kernel components which were available when the system was built. At execution time it is possible to load components from the command line as described in the options section.<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;c</b> <i class="arg">ncpu</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Configure <i class="arg">ncpu</i> virtual CPUs on SMP-capable archs. By default, the number of CPUs equals the number of CPUs on the host.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;d</b> <i class="arg">drivespec</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The argument <i class="arg">drivespec</i> maps a host file in the rump kernel fs namespace. The string <i class="arg">drivespec</i> must be of comma-separated &#8220;name=value&#8221; format and must contain the following tokens:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="arg">key</i></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Block device path in rump kernel namespace. This must be specified according to the rules for a key in <a class="link-man" href="../3/rump_etfs">rump_etfs(3)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="arg">hostpath</i></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Host file used for storage. If the file does not exist, it will be created.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="arg">size</i></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Size of the mapping. Similar to <a class="link-man" href="../1/dd">dd(1)</a>, this argument accepts a suffix as the multiplier for the number. The special value &#8220;host&#8221; indicates that the current size of <i class="arg">hostpath</i> will be used. In this case it is assumed that <i class="arg">hostpath</i> exists and is a regular file.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
OR</dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="arg">disklabel</i></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Use a disklabel partition identifier to specify the offset and size of the mapping. <i class="arg">hostpath</i> must contain an existing and valid disklabel within the first 64k.</dd>
</dl>
<p>
The following are optional:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="arg">offset</i></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Offset of the mapping. The window into <i class="arg">hostpath</i> therefore is [<i class="farg">offset</i>, <i class="farg">offset+size</i>]. In case this parameter is not given, the default value 0 is used.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="arg">type</i></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
The type of file that <i class="arg">key</i> is exposed as within the rump kernel. The possibilities are &#8220;blk&#8221;, &#8220;chr&#8221;, and &#8220;reg&#8221; for block device, character device and regular file, respectively. The default is a block device.<p>
Note: the contents of block devices are cached in the rump kernel's buffer cache. To avoid cache incoherency, it is advisable not to access a file through the host namespace while it is mapped as a block device in a rump kernel.</dd>
</dl>
<p>
In case <i class="arg">hostpath</i> does not exist, it will be created as a regular file with mode 0644 (plus any restrictions placed by umask). In case <i class="arg">hostpath</i> is a regular file and is not large enough to accommodate the specified size, it will be extended to the specified size.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;l</b> <i class="arg">library</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Call <b class="fname">dlopen</b>() on library before initializing the rump kernel. In case <i class="arg">library</i> provides a kernel module, it will appear as a builtin module in the rump kernel. Any rump kernel component present in <i class="arg">library</i> will also be initialized.<p>
The argument <i class="arg">library</i> can contain a full path or a filename, in which case the standard dynamic library search path will be used. By default, lazy resolution is used, and may result in a runtime error due to missing components. To test a configuration, run <b class="name">rump_server</b> with <span class="env">LD_BIND_NOW=1</span> (see examples).</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;m</b> <i class="arg">module</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Load and link a kernel module after the rump kernel is initialized. For this to work, the rump kernel must include the vfs faction, since the module is loaded using kernel vfs code (see <i class="link-sec"><a class="link-sec" href="#x4558414d504c4553">EXAMPLES</a></i>).</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;r</b> <i class="arg">total_ram</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Sets the limit of kernel memory allocatable by the server to <i class="arg">total_ram</i> as opposed to the default which allows the server to allocate as much memory as the host will give it. This parameter is especially useful for VFS servers, since by default the virtual file system will attempt to consume as much memory as it can, and accessing large files can cause an excessive amount of memory to be used as file system cache.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;s</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Do not detach from the terminal. By default, <b class="name">rump_server</b> detaches from the terminal once the service is running on <i class="arg">url</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;v</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Set bootverbose.</dd>
</dl>
<p>
After use, <b class="name">rump_server</b> can be made to exit using <a class="link-man" href="../1/rump.halt">rump.halt(1)</a>.</div>
<div class="section">
<h1 id="x4558414d504c4553">EXAMPLES</h1> Start a server and load the tmpfs file system module, and halt the server immediately afterwards:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
$ rump_server -lrumpvfs -m /modules/tmpfs.kmod unix://sock 
$ env RUMP_SERVER=unix://sock rump.halt</pre>
<p>
Start a server with the one gigabyte host file <i class="file">dk.img</i> mapped as the block device <i class="file">/dev/dk</i> in the rump kernel.<p>
<pre style="margin-left: 5.00ex;" class="lit display">
$ rump_allserver -d key=/dev/dk,hostpath=dk.img,size=1g unix://sock</pre>
<p>
Start a server which listens on INADDR_ANY port 3755<p>
<pre style="margin-left: 5.00ex;" class="lit display">
$ rump_server tcp://0:3755/</pre>
<p>
Test that a configuration contains all of the necessary components:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
$ env LD_BIND_NOW=1 rump_server -lrumpvfs -lrumpfs_ffs unix://tsock</pre>
<p>
Start a FFS server with a 16MB kernel memory limit.<p>
<pre style="margin-left: 5.00ex;" class="lit display">
$ rump_server -lrumpfs_ffs [...] -r 16m unix://ffs</pre>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../1/rump.halt">rump.halt(1)</a>, <a class="link-man" href="../3/dlopen">dlopen(3)</a>, <a class="link-man" href="../3/rump">rump(3)</a>, <a class="link-man" href="../7/rump_sp">rump_sp(7)</a></div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
January 15, 2014</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

