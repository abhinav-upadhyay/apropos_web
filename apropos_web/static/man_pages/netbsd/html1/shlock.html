<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="/static/man_pages/netbsd/style.css" type="text/css" media="all">
<title>
SHLOCK(1)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
SHLOCK(1)</td>
<td class="head-vol" align="center">
General Commands Manual</td>
<td class="head-rtitle" align="right">
SHLOCK(1)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">shlock</b> &#8212; <span class="desc">create or verify a lock file for shell scripts</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1><table class="synopsis">
<col style="width: 6.00ex;">
<col>
<tbody>
<tr>
<td>
shlock</td>
<td>
&#91;<span class="opt"><b class="flag">&#45;du</b></span>&#93; &#91;<span class="opt"><b class="flag">&#45;p</b> <i class="arg">PID</i></span>&#93; <b class="flag">&#45;f</b> <i class="arg">lockfile</i></td>
</tr>
</tbody>
</table>
</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="name">shlock</b> command can create or verify a lock file on behalf of a shell or other script program. When it attempts to create a lock file, if one already exists, <b class="name">shlock</b> verifies that it is or is not valid. If valid, <b class="name">shlock</b> will exit with a non-zero exit code. If invalid, <b class="name">shlock</b> will remove the lock file, and create a new one.<p>
<b class="name">shlock</b> uses the <a class="link-man" href="../2/link">link(2)</a> system call to make the final target lock file, which is an atomic operation (i.e. "dot locking", so named for this mechanism's original use for locking system mailboxes). It puts the process ID ("PID") from the command line into the requested lock file.<p>
<b class="name">shlock</b> verifies that an extant lock file is still valid by using <a class="link-man" href="../2/kill">kill(2)</a> with a zero signal to check for the existence of the process that holds the lock.<p>
The <b class="flag">&#45;d</b> option causes <b class="name">shlock</b> to be verbose about what it is doing.<p>
The <b class="flag">&#45;f</b> argument with <i class="arg">lockfile</i> is always required.<p>
The <b class="flag">&#45;p</b> option with <i class="arg">PID</i> is given when the program is to create a lock file; when absent, <b class="name">shlock</b> will simply check for the validity of the lock file.<p>
The <b class="flag">&#45;u</b> option causes <b class="name">shlock</b> to read and write the PID as a binary pid_t, instead of as ASCII, to be compatible with the locks created by UUCP.</div>
<div class="section">
<h1 id="x4558495420535441545553">EXIT STATUS</h1> A zero exit code indicates a valid lock file.</div>
<div class="section">
<h1 id="x4558414d504c4553">EXAMPLES</h1><div class="subsection">
<h2 id="x424f55524e45205348454c4c">BOURNE SHELL</h2><pre style="margin-left: 0.00ex;" class="lit display">
#!/bin/sh 
lckfile=/tmp/foo.lock 
if shlock -f ${lckfile} -p $$ 
then 
#	do what required the lock 
	rm ${lckfile} 
else 
	echo Lock ${lckfile} already held by `cat ${lckfile}` 
fi</pre>
</div>
<div class="subsection">
<h2 id="x43205348454c4c">C SHELL</h2><pre style="margin-left: 0.00ex;" class="lit display">
#!/bin/csh -f 
set lckfile=/tmp/foo.lock 
shlock -f ${lckfile} -p $$ 
if ($status == 0) then 
#	do what required the lock 
	rm ${lckfile} 
else 
	echo Lock ${lckfile} already held by `cat ${lckfile}` 
endif</pre>
<p>
The examples assume that the file system where the lock file is to be created is writable by the user, and has space available.</div>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../1/flock">flock(1)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> <b class="name">shlock</b> was written for the first Network News Transfer Protocol (NNTP) software distribution, released in March 1986. The algorithm was suggested by Peter Honeyman, from work he did on HoneyDanBer UUCP.</div>
<div class="section">
<h1 id="x415554484f5253">AUTHORS</h1> <span class="author">Erik E. Fair</span> &#60;<a class="link-mail" href="mailto:fair@clock.org">fair@clock.org</a>&#62;</div>
<div class="section">
<h1 id="x42554753">BUGS</h1> Does not work on NFS or other network file system on different systems because the disparate systems have disjoint PID spaces.<p>
Cannot handle the case where a lock file was not deleted, the process that created it has exited, and the system has created a new process with the same PID as in the dead lock file. The lock file will appear to be valid even though the process is unrelated to the one that created the lock in the first place. Always remove your lock files after you're done.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
November 2, 2012</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

