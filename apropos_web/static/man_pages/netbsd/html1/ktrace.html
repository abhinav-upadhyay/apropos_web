<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
KTRACE(1)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
KTRACE(1)</td>
<td class="head-vol" align="center">
General Commands Manual</td>
<td class="head-rtitle" align="right">
KTRACE(1)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">ktrace</b>, <b class="name">ktruss</b> &#8212; <span class="desc">enable kernel process tracing</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1><table class="synopsis">
<col style="width: 6.00ex;">
<col>
<tbody>
<tr>
<td>
ktrace</td>
<td>
&#91;<span class="opt"><b class="flag">&#45;aCcdins</b></span>&#93; &#91;<span class="opt"><b class="flag">&#45;f</b> <i class="arg">trfile</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;g</b> <i class="arg">pgrp</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;p</b> <i class="arg">pid</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;t</b> <i class="arg">trstr</i></span>&#93;</td>
</tr>
</tbody>
</table>
<br>
<table class="synopsis">
<col style="width: 6.00ex;">
<col>
<tbody>
<tr>
<td>
ktrace</td>
<td>
&#91;<span class="opt"><b class="flag">&#45;adis</b></span>&#93; &#91;<span class="opt"><b class="flag">&#45;f</b> <i class="arg">trfile</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;t</b> <i class="arg">trstr</i></span>&#93; <i class="arg">command</i></td>
</tr>
</tbody>
</table>
<br>
<table class="synopsis">
<col style="width: 6.00ex;">
<col>
<tbody>
<tr>
<td>
ktruss</td>
<td>
&#91;<span class="opt"><b class="flag">&#45;aCcdilnRT</b></span>&#93; &#91;<span class="opt"><b class="flag">&#45;e</b> <i class="arg">emulation</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;f</b> <i class="arg">infile</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;g</b> <i class="arg">pgrp</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;m</b> <i class="arg">maxdata</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;o</b> <i class="arg">outfile</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;p</b> <i class="arg">pid</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;t</b> <i class="arg">trstr</i></span>&#93;</td>
</tr>
</tbody>
</table>
<br>
<table class="synopsis">
<col style="width: 6.00ex;">
<col>
<tbody>
<tr>
<td>
ktruss</td>
<td>
&#91;<span class="opt"><b class="flag">&#45;adinRT</b></span>&#93; &#91;<span class="opt"><b class="flag">&#45;e</b> <i class="arg">emulation</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;m</b> <i class="arg">maxdata</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;o</b> <i class="arg">outfile</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;t</b> <i class="arg">trstr</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;v</b> <i class="arg">vers</i></span>&#93; command</td>
</tr>
</tbody>
</table>
</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> <b class="name">ktrace</b> enables kernel trace logging for the specified processes. Kernel trace data is logged to the file <i class="file">ktrace.out</i>. The kernel operations that are traced include system calls, namei translations, signal processing, and I/O.<p>
Once tracing is enabled on a process, trace data will be logged until either the process exits or the trace point is cleared. A traced process can generate enormous amounts of log data quickly; It is strongly suggested that users memorize how to disable tracing before attempting to trace a process. The following command is sufficient to disable tracing on all user owned processes, and, if executed by root, all processes:<p>
<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit">$ ktrace -C</code></div>
</blockquote>
<p>
The trace file is not human readable; use <a class="link-man" href="../html1/kdump.html">kdump(1)</a> to decode it.<p>
<b class="name">ktruss</b> is functionally the same as <b class="name">ktrace</b> except that trace output is printed on standard output or to the file specified with the <b class="flag">&#45;o</b> option. <b class="name">ktruss</b> is useful to see the kernel operations interleaved with the program output.<p>
The options are as follows:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;a</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Append to the trace file instead of truncating it.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;C</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Disable tracing on all user owned processes, and, if executed by root, all processes in the system.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;c</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Clear the trace points associated with the specified file or processes.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;d</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Descendants; perform the operation for all current children of the designated processes.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;f</b> <i class="arg">trfile</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Log trace records to <i class="arg">trfile</i> instead of <i class="file">ktrace.out</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;f</b> <i class="arg">infile</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Read the trace records from <i class="arg">infile</i> and print them in a human readable format to standard out.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;g</b> <i class="arg">pgid</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Enable (disable) tracing on all processes in the process group (only one <b class="flag">&#45;g</b> flag is permitted).</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;i</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Inherit; pass the trace flags to all future children of the designated processes.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;l</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Poll the trace file for new data and print it to standard out. Only for use together with the <b class="flag">&#45;f</b> option.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;m</b> <i class="arg">maxdata</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Print at most <i class="arg">maxdata</i> bytes of data. This is used for pointer type arguments, e.g., strings. The data will be escaped in C-style unless <b class="flag">&#45;x</b> is specified when it will be output in hex and ascii.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;n</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Stop tracing if attempts to write to the trace file would block. This option always affects <b class="name">ktruss</b> and only affects <b class="name">ktrace</b> when writing to <span class="define">stdout</span>. If this flag is not set, then the traced program will block until it can write more data to the trace file descriptor.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;o</b> <i class="arg">outfile</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Log trace records to <i class="arg">outfile</i>. Without this option <b class="name">ktruss</b> will print its output in a human readable format to standard out.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;p</b> <i class="arg">pid</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Enable (disable) tracing on the indicated process id (only one <b class="flag">&#45;p</b> flag is permitted).</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;s</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Write to the trace file with synchronized I/O.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;R</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Display relative time stamps to output.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;T</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Same as the <b class="flag">&#45;R</b> option, but use absolute timestamps instead.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;t</b> <i class="arg">trstr</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The string argument represents the kernel trace points, one per letter. The following table equates the letters with the tracepoints:<p>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="flag">A</b></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
trace all tracepoints</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="flag">a</b></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
trace exec arguments</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="flag">c</b></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
trace system calls</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="flag">e</b></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
trace emulation changes</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="flag">f</b></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
trace open file descriptors after exec</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="flag">i</b></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
trace I/O</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="flag">n</b></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
trace namei translations</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="flag">S</b></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
trace MIB access (sysctl)</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="flag">s</b></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
trace signal processing</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="flag">u</b></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
trace user data</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="flag">v</b></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
trace exec environment</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="flag">w</b></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
trace context switches</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="flag">+</b></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
trace the default set of trace points (c, e, i, n, s, u)</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
<b class="flag">-</b></dt>
<dd class="list-tag" style="margin-left: 4.00ex;">
do not trace following trace points</dd>
</dl>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;e</b> <i class="arg">emulation</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
If an emulation of a process is unknown, interpret system call maps assuming the named emulation instead of default "netbsd".</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="arg">command</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Execute <i class="arg">command</i> with the specified trace flags.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;v</b> <i class="arg">version</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Determines the <i class="arg">version</i> of the file generated. Version 0 is the compatible ktrace format, and version 1 is the new format with lwp IDs and nanosecond (instead of microsecond) timestamps.</dd>
</dl>
<p>
The <b class="flag">&#45;p</b>, <b class="flag">&#45;g</b>, and <i class="arg">command</i> options are mutually exclusive. The <b class="flag">&#45;R</b> and <b class="flag">&#45;T</b> options are also mutually exclusive.</div>
<div class="section">
<h1 id="x4558414d504c4553">EXAMPLES</h1> # trace all kernel operations of process id 34<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit">$ ktrace -p 34</code></div>
</blockquote>
<p>
<pre style="margin-left: 0.00ex;" class="lit display">
# trace all kernel operations of processes in process group 15 and 
# pass the trace flags to all current and future children</pre>
<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit">$ ktrace -idg 15</code></div>
</blockquote>
<p>
# disable all tracing of process 65<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit">$ ktrace -cp 65</code></div>
</blockquote>
<p>
# disable tracing signals on process 70 and all current children<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit">$ ktrace -t s -cdp 70</code></div>
</blockquote>
<p>
# enable tracing of I/O on process 67<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit">$ ktrace -ti -p 67</code></div>
</blockquote>
<p>
# run the command "w", tracing only system calls<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit">$ ktrace -tc w</code></div>
</blockquote>
<p>
# disable all tracing to the file "tracedata"<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit">$ ktrace -c -f tracedata</code></div>
</blockquote>
<p>
# disable tracing of all processes owned by the user<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit">$ ktrace -C</code></div>
</blockquote>
<p>
# run the command "w", displaying to standard output<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit">$ ktruss w</code></div>
</blockquote>
<p>
# trace process 42 and log the records to "ktruss.out"<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit">$ ktruss -p 42 -o ktruss.out</code></div>
</blockquote>
<p>
# poll ktruss.out for available records and print them<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit">$ ktruss -lf ktruss.out</code></div>
</blockquote>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html1/kdump.html">kdump(1)</a>, <a class="link-man" href="../html2/ktrace.html">ktrace(2)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> The <b class="name">ktrace</b> command appears in <span class="unix">4.4BSD</span>.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
January 8, 2015</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

