<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="/static/man_pages/netbsd/style.css" type="text/css" media="all">
<title>
PKG_ADD(1)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
PKG_ADD(1)</td>
<td class="head-vol" align="center">
General Commands Manual</td>
<td class="head-rtitle" align="right">
PKG_ADD(1)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">pkg_add</b> &#8212; <span class="desc">a utility for installing and upgrading software package distributions</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1><table class="synopsis">
<col style="width: 7.00ex;">
<col>
<tbody>
<tr>
<td>
pkg_add</td>
<td>
&#91;<span class="opt"><b class="flag">&#45;AfILnRUuVv</b></span>&#93; &#91;<span class="opt"><b class="flag">&#45;C</b> <i class="arg">config</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;K</b> <i class="arg">pkg_dbdir</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;m</b> <i class="arg">machine</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;P</b> <i class="arg">destdir</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;p</b> <i class="arg">prefix</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;W</b> <i class="arg">viewbase</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;w</b> <i class="arg">view</i></span>&#93; <i class="arg">file ...</i> &#91;<span class="opt">&#91;<span class="opt"><code class="lit">ftp|http</code></span>&#93;<code class="lit">://</code>&#91;<span class="opt"><i class="arg">user</i></span>&#93;&#91;<span class="opt"><code class="lit">:</code><i class="arg">password</i></span>&#93;<code class="lit">@</code></span>&#93;<i class="arg">host</i>&#91;<span class="opt"><code class="lit">:</code><i class="arg">port</i></span>&#93;&#91;<span class="opt"><code class="lit">/</code><i class="arg">path/</i></span>&#93;<i class="arg">pkg-name ...</i></td>
</tr>
</tbody>
</table>
</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="name">pkg_add</b> command is used to extract and upgrade packages that have been previously created with the <a class="link-man" href="../1/pkg_create">pkg_create(1)</a> command. Packages are prepared collections of pre-built binaries, documentation, configurations, installation instructions and/or other files. <b class="name">pkg_add</b> can recursively install other packages that the current package depends on or requires from both local disk and via FTP or HTTP.</div>
<div class="section">
<h1 id="x5741524e494e47">WARNING</h1><div class="emph" style="display:inline;margin-left: 1.00ex;">
Since the <b class="name">pkg_add</b> command may execute scripts or programs contained within a package file, your system may be susceptible to &#8220;Trojan horses&#8221; or other subtle attacks from miscreants who create dangerous package files.<p>
You are advised to verify the competence and identity of those who provide installable package files. For extra protection, use the digital signatures provided where possible (see the <a class="link-man" href="../5/pkg_install.conf">pkg_install.conf(5)</a>), or, failing that, use <a class="link-man" href="../1/tar">tar(1)</a> to extract the package file, and inspect its contents and scripts to ensure it poses no danger to your system's integrity. Pay particular attention to any <i class="file">+INSTALL</i> or <i class="file">+DEINSTALL</i> files, and inspect the <i class="file">+CONTENTS</i> file for <b class="flag">@cwd</b>, <b class="flag">@mode</b> (check for setuid), <b class="flag">@dirrm</b>, <b class="flag">@exec</b>, and <b class="flag">@unexec</b> directives, and/or use the <a class="link-man" href="../1/pkg_info">pkg_info(1)</a> command to examine the package file.</div>
</div>
<div class="section">
<h1 id="x4f5054494f4e53">OPTIONS</h1> The following command line arguments are supported:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="arg">pkg-name</i> [<i class="arg">...</i>]</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The named packages are installed. <b class="name">pkg_add</b> will first try to use <i class="arg">pkg-name</i> as full URL or path name without any wildcard processing. If that fails, <b class="name">pkg_add</b> will try to match packages using wildcard processing. If that fails as well and <i class="arg">pkg-name</i> does not contain any /, the entries of the <span class="define">PKG_PATH</span> variable are searched using the wildcard processing rules.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;A</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Mark package as installed automatically, as dependency of another package. You can use<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit"><b class="cmd">pkg_admin set automatic=YES</b></code></div>
</blockquote>
to mark packages this way after installation, and<blockquote style="margin-top: 0.00em;margin-bottom: 0.00em;">
<div class="display">
<code class="lit"><b class="cmd">pkg_admin unset automatic</b></code></div>
</blockquote>
to remove the mark. If you <b class="name">pkg_add</b> a package without specifying <b class="flag">&#45;A</b> after it had already been automatically installed, the mark is removed.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;C</b> <i class="arg">config</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Read the configuration file from <i class="arg">config</i> instead of the system default.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;f</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Force installation to proceed even if prerequisite packages are not installed or the install script fails. Although <b class="name">pkg_add</b> will still try to find and auto-install missing prerequisite packages, a failure to find one will not be fatal. This flag also overrides the fatal error when the operating system or architecture the package was built on differ from that of the host.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;D</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Force updating even if the dependencies of depending packages are not satisfied by the new package. This is used by "make replace", after which one would typically replace the depending packages.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;I</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
If an installation script exists for a given package, do not execute it.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;K</b> <i class="arg">pkg_dbdir</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Override the value of the <span class="define">PKG_DBDIR</span> configuration option with the value <i class="arg">pkg_dbdir</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;L</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Don't add the package to any views after installation.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;m</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Override the machine architecture returned by uname with <i class="arg">machine</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;n</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Don't actually install a package, just report the steps that would be taken if it was.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;P</b> <i class="arg">destdir</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Prefix all file and directory names with <i class="arg">destdir</i>. For packages without install scripts this has the same behavior as using <a class="link-man" href="../8/chroot">chroot(8)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;p</b> <i class="arg">prefix</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Override the prefix stored in the package with <i class="arg">prefix</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;R</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Do not record the installation of a package. This implies <b class="flag">&#45;I</b>. This means that you cannot deinstall it later, so only use this option if you know what you are doing!</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;U</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Replace an already installed version from a package. Implies <b class="flag">&#45;u</b>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;u</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
If the package that's being installed is already installed, an update is performed. Installed dependent packages are updated recursively, if they are too old to fulfill the dependencies of the to-be-installed version. See below for a more detailed description of the process.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;V</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Print version number and exit.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;v</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Turn on verbose output.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;W</b> <i class="arg">viewbase</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Passed down to <a class="link-man" href="../1/pkg_view">pkg_view(1)</a> for managed views.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;w</b> <i class="arg">view</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Passed down to <a class="link-man" href="../1/pkg_view">pkg_view(1)</a> for managed views.</dd>
</dl>
<p>
One or more <i class="arg">pkg-name</i> arguments may be specified, each being either a file containing the package (these usually ending with the &#8220;.tgz&#8221; suffix) or a URL pointing at a file available on an ftp or web site. Thus you may extract files directly from their anonymous ftp or WWW locations (e.g., <b class="name">pkg_add</b> ftp://ftp.NetBSD.org/pub/pkgsrc/packages/NetBSD/i386/3.1_2007Q2/shells/bash-3.2.9.tgz or <b class="name">pkg_add</b> http://www.example.org/packages/screen-4.0.tbz). Note:  For ftp transfers, if you wish to use<div class="emph" style="display:inline;margin-left: 1.00ex;">
passive mode</div>
ftp in such transfers, set the variable<div class="emph" style="display:inline;margin-left: 1.00ex;">
FTP_PASSIVE_MODE</div>
to some value in your environment. Otherwise, the more standard ACTIVE mode may be used. If <b class="name">pkg_add</b> consistently fails to fetch a package from a site known to work, it may be because you have a firewall that demands the usage of<div class="emph" style="display:inline;margin-left: 1.00ex;">
passive mode</div>
ftp.</div>
<div class="section">
<h1 id="x544543484e4943414c2044455441494c53">TECHNICAL DETAILS</h1> <b class="name">pkg_add</b> extracts each package's meta data (including the &#8220;packing list&#8221;) to memory and then runs through the following sequence to fully extract the contents of the package:<ol style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 5.00ex;" class="list list-enum">
<li class="list-enum" style="margin-top: 1.00em;">
A check is made to determine if the package or another version of it is already recorded as installed. If it is, installation is terminated if the <b class="flag">&#45;u</b> or <b class="flag">&#45;U</b> options are not given.<p>
If the same version is installed and <b class="flag">&#45;U</b> is not given, it is marked as manually installed and process stops. If the <b class="flag">&#45;u</b> option is given, it's assumed the package should be replaced by the new version instead. Before doing so, all packages that depend on the pkg being upgraded are checked if they also work with the new version. If that test is not successful, the dependent packages are updated first. The replacing is then prepared by moving an existing <i class="file">+REQUIRED_BY</i> file aside (if it exists), and running <a class="link-man" href="../1/pkg_delete">pkg_delete(1)</a> on the installed package. Installation then proceeds as if the package was not installed, and restores the <i class="file">+REQUIRED_BY</i> file afterwards.</li>
<li class="list-enum" style="margin-top: 1.00em;">
The package build information is extracted from the <i class="file">+BUILD_INFO</i> file and compared against the result of <a class="link-man" href="../3/uname">uname(3)</a>. If the operating system or architecture of the package differ from that of the host, installation is aborted. This behavior is overridable with the <b class="flag">&#45;f</b> flag.</li>
<li class="list-enum" style="margin-top: 1.00em;">
The package build information from <i class="file">+BUILD_INFO</i> is then checked for <span class="env">USE_ABI_DEPENDS=NO</span> (or <span class="env">IGNORE_RECOMMENDED</span>). If the package was built with ABI dependency recommendations ignored, a warning will be issued.</li>
<li class="list-enum" style="margin-top: 1.00em;">
A check is made to determine if the package conflicts (from <b class="flag">@pkgcfl</b> directives, see <a class="link-man" href="../1/pkg_create">pkg_create(1)</a>) with an already recorded as installed package or if an installed package conflicts with the package. If it is, installation is terminated.</li>
<li class="list-enum" style="margin-top: 1.00em;">
The file list of the package is compared to the file lists of the installed packages. If there is any overlap, the installation is terminated.</li>
<li class="list-enum" style="margin-top: 1.00em;">
All package dependencies (from <b class="flag">@pkgdep</b> directives, see <a class="link-man" href="../1/pkg_create">pkg_create(1)</a>) are read from the packing list. If any of these required packages are not currently installed, an attempt is made to find and install it; if the missing package cannot be found or installed, the installation is terminated.</li>
<li class="list-enum" style="margin-top: 1.00em;">
If the package contains an <i class="arg">install</i> script, it is executed with the following arguments:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="arg">pkg-name</i></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
The name of the package being installed.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">PRE-INSTALL</b></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Keyword denoting that the script is to perform any actions needed before the package is installed.</dd>
</dl>
<p>
If the <i class="arg">install</i> script exits with a non-zero status code, the installation is terminated.</li>
<li class="list-enum" style="margin-top: 1.00em;">
The files from the file list are extracted to the chosen prefix.</li>
<li class="list-enum" style="margin-top: 1.00em;">
If an <i class="arg">install</i> script exists for the package, it is executed with the following arguments:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="arg">pkg_name</i></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
The name of the package being installed.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">POST-INSTALL</b></dt>
<dd class="list-tag" style="margin-left: 12.00ex;">
Keyword denoting that the script is to perform any actions needed after the package has been installed.</dd>
</dl>
</li>
<li class="list-enum" style="margin-top: 1.00em;">
After installation is complete, a copy of the packing list, <i class="arg">deinstall</i> script, description, and display files are copied into <i class="file">&lt;PKG_DBDIR&gt;/&lt;pkg-name&gt;</i> for subsequent possible use by <a class="link-man" href="../1/pkg_delete">pkg_delete(1)</a>. Any package dependencies are recorded in the other packages' <i class="file">+REQUIRED_BY</i> file.</li>
<li class="list-enum" style="margin-top: 1.00em;">
If the package is a depoted package, then add it to the registered by calling <a class="link-man" href="../1/pkg_view">pkg_view(1)</a> accordingly.</li>
<li class="list-enum" style="margin-top: 1.00em;">
Finally, if we were upgrading a package, any <i class="file">+REQUIRED_BY</i> file that was moved aside before upgrading was started is now moved back into place.</li>
</ol>
<p>
The <i class="arg">install</i> script is called with the environment variable <span class="env">PKG_PREFIX</span> set to the installation prefix (see the <b class="flag">&#45;p</b> option above). This allows a package author to write a script that reliably performs some action on the directory where the package is installed, even if the user might change it with the <b class="flag">&#45;p</b> flag to <b class="flag">pkg_add</b>. The scripts are also called with the <span class="env">PKG_METADATA_DIR</span> environment variable set to the location of the <i class="file">+*</i> meta-data files, and with the <span class="env">PKG_REFCOUNT_DBDIR</span> environment variable set to the location of the package reference counts database directory. If the <b class="flag">&#45;P</b> flag was given to <b class="name">pkg_add</b>, <span class="env">PKG_DESTDIR</span> will be set to <i class="arg">destdir</i>. Additionally, <span class="env">PKG_METADATA_DIR</span> and <span class="env">PKG_REFCOUNT_DBDIR</span> are prefixed with <i class="arg">destdir</i>.</div>
<div class="section">
<h1 id="x454e5649524f4e4d454e54">ENVIRONMENT</h1> See <a class="link-man" href="../5/pkg_install.conf">pkg_install.conf(5)</a> for options, that can also be specified using the environment. Packages using views are also affected by the environment variables documented for <a class="link-man" href="../1/pkg_view">pkg_view(1)</a>.</div>
<div class="section">
<h1 id="x4558414d504c4553">EXAMPLES</h1> In all cases, <b class="name">pkg_add</b> will try to install binary packages listed in dependencies list.<p>
You can specify a compiled binary package explicitly on the command line.<p>
<pre style="margin-left: 0.00ex;" class="lit display">
# pkg_add /usr/pkgsrc/packages/All/tcsh-6.14.00.tgz</pre>
<p>
If you omit the version number, <b class="name">pkg_add</b> will install the latest version available. With <b class="flag">&#45;v</b>, <b class="name">pkg_add</b> emits more messages to terminal.<p>
<pre style="margin-left: 0.00ex;" class="lit display">
# pkg_add -v /usr/pkgsrc/packages/All/unzip</pre>
<p>
You can grab a compiled binary package from remote location by specifying a URL. The base URL can also be provided by the configuration variable, <span class="define">PKG_PATH</span>.<p>
<pre style="margin-left: 0.00ex;" class="lit display">
# pkg_add -v ftp://ftp.NetBSD.org/pub/pkgsrc/packages/NetBSD/i386/3.1_2007Q2/All/firefox-2.0.0.4.tgz 
 
# export PKG_PATH=ftp://ftp.NetBSD.org/pub/pkgsrc/packages/NetBSD/i386/3.1_2007Q2/All 
# pkg_add -v firefox</pre>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../1/pkg_admin">pkg_admin(1)</a>, <a class="link-man" href="../1/pkg_create">pkg_create(1)</a>, <a class="link-man" href="../1/pkg_delete">pkg_delete(1)</a>, <a class="link-man" href="../1/pkg_info">pkg_info(1)</a>, <a class="link-man" href="../5/pkg_install.conf">pkg_install.conf(5)</a>, <a class="link-man" href="../7/pkgsrc">pkgsrc(7)</a></div>
<div class="section">
<h1 id="x415554484f5253">AUTHORS</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
Jordan Hubbard</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Initial work and ongoing development.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
John Kohl</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
<span class="unix">NetBSD</span> refinements.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
Hubert Feyrer</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
<span class="unix">NetBSD</span> wildcard dependency processing, pkgdb, upgrading, etc.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
Thomas Klausner</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
HTTP support.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
Joerg Sonnenberger</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Rewrote most of the code base to work without external commands.</dd>
</dl>
</div>
<div class="section">
<h1 id="x42554753">BUGS</h1> Package upgrading needs a lot more work to be really universal.<p>
Sure to be others.</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
June 16, 2010</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

