<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
<link rel="stylesheet" href="../style.css" type="text/css" media="all">
<title>
PKG_DELETE(1)</title>
</head>
<body>
<div class="mandoc">
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
PKG_DELETE(1)</td>
<td class="head-vol" align="center">
General Commands Manual</td>
<td class="head-rtitle" align="right">
PKG_DELETE(1)</td>
</tr>
</tbody>
</table>
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">pkg_delete</b> &#8212; <span class="desc">a utility for deleting previously installed software package distributions</span></div>
<div class="section">
<h1 id="x53594e4f50534953">SYNOPSIS</h1><table class="synopsis">
<col style="width: 10.00ex;">
<col>
<tbody>
<tr>
<td>
pkg_delete</td>
<td>
&#91;<span class="opt"><b class="flag">&#45;ADFfkNnORrVv</b></span>&#93; &#91;<span class="opt"><b class="flag">&#45;K</b> <i class="arg">pkg_dbdir</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;P</b> <i class="arg">destdir</i></span>&#93; &#91;<span class="opt"><b class="flag">&#45;p</b> <i class="arg">prefix</i></span>&#93; <i class="arg">pkg-name ...</i></td>
</tr>
</tbody>
</table>
</div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> The <b class="name">pkg_delete</b> command is used to delete packages that have been previously installed with the <a class="link-man" href="../html1/pkg_add.html">pkg_add(1)</a> command. The given packages are sorted, so that the dependencies needed by a package are deleted after the package. Before any action is executed, <b class="name">pkg_delete</b> checks for packages that are marked as <b class="flag">preserved</b> or have depending packages left. If the <b class="flag">&#45;k</b> flag is given, preserved packages are skipped and not removed. Unless the <b class="flag">&#45;f</b> flag is given, <b class="name">pkg_delete</b> stops on the first error.</div>
<div class="section">
<h1 id="x5741524e494e47">WARNING</h1><div class="emph" style="display:inline;margin-left: 1.00ex;">
Since the <b class="name">pkg_delete</b> command may execute scripts or programs provided by a package file, your system may be susceptible to &#8220;Trojan horses&#8221; or other subtle attacks from miscreants who create dangerous package files.<p>
You are advised to verify the competence and identity of those who provide installable package files. For extra protection, examine all the package control files in the package record directory <i class="file">&lt;PKG_DBDIR&gt;/&lt;pkg-name&gt;/</i>). Pay particular attention to any <i class="file">+INSTALL</i> or <i class="file">+DEINSTALL</i> files, and inspect the <i class="file">+CONTENTS</i> file for <b class="flag">@cwd</b>, <b class="flag">@mode</b> (check for setuid), <b class="flag">@dirrm</b>, <b class="flag">@exec</b>, and <b class="flag">@unexec</b> directives, and/or use the <a class="link-man" href="../html1/pkg_info.html">pkg_info(1)</a> command to examine the installed package control files.</div>
</div>
<div class="section">
<h1 id="x4f5054494f4e53">OPTIONS</h1> The following command line options are supported:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="arg">pkg-name ...</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The named packages are deinstalled, wildcards can be used, see <a class="link-man" href="../html1/pkg_info.html">pkg_info(1)</a>. If no version is given, the one currently installed will be removed. If the <b class="flag">&#45;F</b> flag is given, one or more (absolute) filenames may be specified and the package database will be consulted for the package to which the given file belongs. These packages are then deinstalled.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;A</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Recursively remove all automatically installed packages that were needed by the given packages and are no longer required. Does not remove manually installed packages; see also the <b class="flag">&#45;R</b> flag.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;D</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
If a deinstallation script exists for a given package, do not execute it.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;F</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Any <i class="arg">pkg-name</i> given will be interpreted as pathname which is subsequently transformed in a (real) package name via the package database. That way, packages can be deleted by giving a filename instead of the package-name.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;f</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Force removal of the package, even if a dependency is recorded or the deinstall script fails. This might break the package database; see <a class="link-man" href="../html1/pkg_admin.html">pkg_admin(1)</a> on how to repair it.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;ff</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Force removal of the package, even if the package is marked as a <b class="flag">preserved</b> package. Note that this is a dangerous operation. See also the <b class="flag">&#45;k</b> option.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;K</b> <i class="arg">pkg_dbdir</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Override the value of the <span class="define">PKG_DBDIR</span> configuration option with the value <i class="arg">pkg_dbdir</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;k</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Silently skip all packages that are marked as <b class="flag">preserved</b>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;N</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Remove the package's registration and its entries from the package database, but leave the files installed. Don't run any deinstall scripts or <b class="flag">@unexec</b> lines either.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;n</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Don't actually deinstall a package, just report the steps that would be taken.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;O</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Only delete the package's entries from the package database; do not touch the package or its files itself.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;P</b> <i class="arg">destdir</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Prefix all file and directory names with <i class="arg">destdir</i>. For packages without install scripts this has the same behavior as using <a class="link-man" href="../html8/chroot.html">chroot(8)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;p</b> <i class="arg">prefix</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Set <i class="arg">prefix</i> as the directory in which to delete files from any installed packages which do not explicitly set theirs. For most packages, the prefix will be set automatically to the installed location by <a class="link-man" href="../html1/pkg_add.html">pkg_add(1)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;R</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Recursively remove all packages that were needed by the given packages and are no longer required. This option overrides the <b class="flag">&#45;A</b> flag.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;r</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Recursively remove all packages that require one of the packages given.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;V</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Print version number and exit.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="flag">&#45;v</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Turn on verbose output.</dd>
</dl>
</div>
<div class="section">
<h1 id="x544543484e4943414c2044455441494c53">TECHNICAL DETAILS</h1> <b class="name">pkg_delete</b> does pretty much what it says. It examines installed package records in <i class="file">&lt;PKG_DBDIR&gt;/&lt;pkg-name&gt;</i>, deletes the package contents, and finally removes the package records.<p>
If a package is required by other installed packages, <b class="name">pkg_delete</b> will list those dependent packages and refuse to delete the package (unless the <b class="flag">&#45;f</b> option is given).<p>
If a package has been marked as a <b class="flag">preserved</b> package, it will not be able to be deleted (unless more than one occurrence of the <b class="flag">&#45;f</b> option is given).<p>
If a filename is given instead of a package name, the package of which the given file belongs to can be deleted if the <b class="flag">&#45;F</b> flag is given. The filename needs to be absolute, see the output produced by the <a class="link-man" href="../html1/pkg_info.html">pkg_info(1)</a> <b class="flag">&#45;aF</b> command.<p>
If a <b class="flag">deinstall</b> script exists for the package, it is executed before and after any files are removed. It is this script's responsibility to clean up any additional messy details around the package's installation, since all <b class="name">pkg_delete</b> knows how to do is delete the files created in the original distribution. The <b class="cmd">deinstall</b> script is called as:<div style="margin-left: 5.00ex;" class="display">
<b class="flag">deinstall</b> &#60;<i class="arg">pkg-name</i>&#62; <i class="arg">VIEW-DEINSTALL</i></div>
before removing the package from a view, and as:<div style="margin-left: 5.00ex;" class="display">
<b class="flag">deinstall</b> &#60;<i class="arg">pkg-name</i>&#62; <i class="arg">DEINSTALL</i></div>
before deleting all files and as:<div style="margin-left: 5.00ex;" class="display">
<b class="flag">deinstall</b> &#60;<i class="arg">pkg-name</i>&#62; <i class="arg">POST-DEINSTALL</i></div>
after deleting them. Passing the keywords <i class="arg">VIEW-DEINSTALL</i>, <i class="arg">DEINSTALL</i>, and <i class="arg">POST-DEINSTALL</i> lets you potentially write only one program/script that handles all aspects of installation and deletion.<p>
All scripts are called with the environment variable <span class="env">PKG_PREFIX</span> set to the installation prefix (see the <b class="flag">&#45;p</b> option above). This allows a package author to write a script that reliably performs some action on the directory where the package is installed, even if the user might have changed it by specifying the <b class="flag">&#45;p</b> option when running <b class="name">pkg_delete</b> or <a class="link-man" href="../html1/pkg_add.html">pkg_add(1)</a>. The scripts are also called with the <span class="env">PKG_METADATA_DIR</span> environment variable set to the location of the <i class="file">+*</i> meta-data files, and with the <span class="env">PKG_REFCOUNT_DBDIR</span> environment variable set to the location of the package reference counts database directory. If the <b class="flag">&#45;P</b> flag was given to <b class="name">pkg_delete</b>, <span class="env">PKG_DESTDIR</span> will be set to <i class="arg">destdir</i>.</div>
<div class="section">
<h1 id="x454e5649524f4e4d454e54">ENVIRONMENT</h1> See <a class="link-man" href="../html5/pkg_install.conf.html">pkg_install.conf(5)</a> for options, that can also be specified using the environment.</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man" href="../html1/pkg_add.html">pkg_add(1)</a>, <a class="link-man" href="../html1/pkg_admin.html">pkg_admin(1)</a>, <a class="link-man" href="../html1/pkg_create.html">pkg_create(1)</a>, <a class="link-man" href="../html1/pkg_info.html">pkg_info(1)</a>, <a class="link-man" href="../html5/pkg_install.conf.html">pkg_install.conf(5)</a> <a class="link-man" href="../html7/pkgsrc.html">pkgsrc(7)</a></div>
<div class="section">
<h1 id="x415554484f5253">AUTHORS</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
Jordan Hubbard</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
most of the work</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
John Kohl</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
refined it for <span class="unix">NetBSD</span></dd>
<dt class="list-tag" style="margin-top: 0.00em;">
Hubert Feyrer</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
<span class="unix">NetBSD</span> wildcard dependency processing, pkgdb, recursive "down" delete, etc.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
Joerg Sonnenberger</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Rewrote most of the code to compute correct order of deinstallation and to improve error handling.</dd>
</dl>
</div>
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
January 20, 2010</td>
<td class="foot-os" align="right">
NetBSD 7.99</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>

